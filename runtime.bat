REM = 0; /*
@echo off
cls
title %~f0
cd %~dp0
if "%PROCESSOR_ARCHITECTURE%" EQU "x86" (
  call cscript.exe "%~f0" //Nologo //E:JScript "%~f0" %*
)
if "%PROCESSOR_ARCHITECTURE%" NEQ "x86" (
  call C:\Windows\SysWOW64\CScript.exe "%~f0" //Nologo //E:JScript "%~f0" %*
)
goto LBL_END
*/
var document = new ActiveXObject('htmlfile');
document.write(
  '<!DOCTYPE html><html><head><meta http-equiv=X-UA-Compatible content="IE=edge"><title></title></head><body></body></html>'
);
var window = document.parentWindow;
window.WScript = WScript;
window.ActiveXObject = ActiveXObject;
window.GetObject = GetObject;

var src = 'KGZ1bmN0aW9uICgpIHsKICAndXNlIHN0cmljdCc7CgogIGZ1bmN0aW9uIGV4aXQoc3RhdHVzKSB7DQogICAgV1NjcmlwdC5RdWl0KHN0YXR1cyB8fCAwKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNsZWVwKG1pbGxpcykgew0KICAgIFdTY3JpcHQuU2xlZXAobWlsbGlzKTsNCiAgfQ0KDQogIHZhciBfdmVyc2lvbjsNCg0KICBmdW5jdGlvbiB2ZXJzaW9uX2dldCgpIHsNCiAgICByZXR1cm4gKA0KICAgICAgX3ZlcnNpb24gfHwNCiAgICAgIChfdmVyc2lvbiA9DQogICAgICAgIA0KICAgICAgICBTY3JpcHRFbmdpbmUoKSArDQogICAgICAgICcgJyArDQogICAgICAgIA0KICAgICAgICBTY3JpcHRFbmdpbmVNYWpvclZlcnNpb24oKSArDQogICAgICAgICcuJyArDQogICAgICAgIA0KICAgICAgICBTY3JpcHRFbmdpbmVNaW5vclZlcnNpb24oKSArDQogICAgICAgICcuJyArDQogICAgICAgIA0KICAgICAgICBTY3JpcHRFbmdpbmVCdWlsZFZlcnNpb24oKSkNCiAgICApOw0KICB9DQoNCiAgdmFyIF9hcmd2Ow0KDQogIGZ1bmN0aW9uIGFyZ3ZfZ2V0KCkgew0KICAgIGlmIChfYXJndikgcmV0dXJuIF9hcmd2Ow0KICAgIF9hcmd2ID0gW1dTY3JpcHQuRnVsbE5hbWVdOw0KICAgIHZhciBlbiA9IG5ldyBFbnVtZXJhdG9yKFdTY3JpcHQuQXJndW1lbnRzKTsNCiAgICBmb3IgKDsgIWVuLmF0RW5kKCk7IGVuLm1vdmVOZXh0KCkpIF9hcmd2LnB1c2goZW4uaXRlbSgpKTsNCiAgICByZXR1cm4gX2FyZ3Y7DQogIH0NCg0KICB2YXIgX2VudjsNCg0KICBmdW5jdGlvbiBlbnZfZ2V0KCkgew0KICAgIGlmIChfZW52KSByZXR1cm4gX2VudjsNCiAgICB2YXIgaXQsIGk7DQogICAgdmFyIGVuID0gbmV3IEVudW1lcmF0b3IoX19XU2hlbGwuRW52aXJvbm1lbnQoJ1BST0NFU1MnKSk7DQogICAgX2VudiA9IHt9Ow0KICAgIGZvciAoOyAhZW4uYXRFbmQoKTsgZW4ubW92ZU5leHQoKSkgew0KICAgICAgaXQgPSBlbi5pdGVtKCk7DQogICAgICBpID0gaXQuaW5kZXhPZignPScpOw0KICAgICAgaWYgKGkgPiAwKSB7DQogICAgICAgIF9lbnZbaXQuc2xpY2UoMCwgaSldID0gaXQuc2xpY2UoaSArIDEpOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gX2VudjsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNyZWF0ZUdldHRlcnMocHJvcHMpIHsNCiAgICB2YXIgX3Byb3BzID0ge307DQogICAgZm9yICh2YXIga2V5IGluIHByb3BzKSB7DQogICAgICBfcHJvcHNba2V5XSA9IHsNCiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwNCiAgICAgICAgZ2V0OiBwcm9wc1trZXldDQogICAgICB9Ow0KICAgIH0NCiAgICByZXR1cm4gX3Byb3BzOw0KICB9DQoNCiAgd2luZG93LnByb2Nlc3MgPSBPYmplY3QuY3JlYXRlKA0KICAgIHsNCiAgICAgIGN3ZDogZnVuY3Rpb24gKCkge3JldHVybiAgX19kaXJuYW1lfSwNCiAgICAgIGV4aXQ6IGV4aXQsDQogICAgICBzdGRpbjogV1NjcmlwdC5TdGRJbiwNCiAgICAgIHN0ZG91dDogV1NjcmlwdC5TdGRPdXQsDQogICAgICBzdGRlcnI6IFdTY3JpcHQuU3RkRXJyLA0KICAgICAgc2xlZXA6IHNsZWVwLA0KICAgICAgbW9kdWxlTG9hZExpc3Q6IFtdDQogICAgfSwNCiAgICBjcmVhdGVHZXR0ZXJzKHsNCiAgICAgIHZlcnNpb246IHZlcnNpb25fZ2V0LA0KICAgICAgYXJndjogYXJndl9nZXQsDQogICAgICBlbnY6IGVudl9nZXQNCiAgICB9KQ0KICApOwoKICB2YXIgX2RvYzsNCg0KICBmdW5jdGlvbiBnZXRYbWxEb2MoKSB7DQogICAgcmV0dXJuIF9kb2MgfHwgKF9kb2MgPSBuZXcgQWN0aXZlWE9iamVjdCgnTVNYTUwyLkRPTURvY3VtZW50LjYuMCcpKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHRleHQydmFsdWUodHlwZSwgdGV4dCkgew0KICAgIHZhciBlbCA9IGdldFhtbERvYygpLmNyZWF0ZUVsZW1lbnQoJ3RtcCcpOw0KICAgIGVsLmRhdGFUeXBlID0gdHlwZTsNCiAgICBlbC50ZXh0ID0gdGV4dDsNCiAgICByZXR1cm4gZWwubm9kZVR5cGVkVmFsdWU7DQogIH0NCg0KICBmdW5jdGlvbiB2YWx1ZTJ0ZXh0KHR5cGUsIHZhbHVlKSB7DQogICAgdmFyIGVsID0gZ2V0WG1sRG9jKCkuY3JlYXRlRWxlbWVudCgndG1wJyk7DQogICAgZWwuZGF0YVR5cGUgPSB0eXBlOw0KICAgIGVsLm5vZGVUeXBlZFZhbHVlID0gdmFsdWU7DQogICAgcmV0dXJuIGVsLnRleHQ7DQogIH0NCg0KICBmdW5jdGlvbiBiaW4yaGV4KGJ5dGVzKSB7DQogICAgcmV0dXJuIHZhbHVlMnRleHQoJ2Jpbi5oZXgnLCBieXRlcyk7DQogIH0NCg0KICBmdW5jdGlvbiBoZXgyYmluKGhleCkgew0KICAgIHJldHVybiB0ZXh0MnZhbHVlKCdiaW4uaGV4JywgaGV4KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGJpbjJiYXNlNjQoYnl0ZXMpIHsNCiAgICByZXR1cm4gdmFsdWUydGV4dCgnYmluLmJhc2U2NCcsIGJ5dGVzKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGJhc2U2NDJiaW4oYmFzZTY0KSB7DQogICAgcmV0dXJuIHRleHQydmFsdWUoJ2Jpbi5iYXNlNjQnLCBiYXNlNjQpOw0KICB9DQoNCiAgZnVuY3Rpb24gYmluMnN0cihieXRlcywgZW5jb2RpbmcpIHsNCiAgICB2YXIgc3QgPSBuZXcgQWN0aXZlWE9iamVjdCgnQURPREIuU3RyZWFtJyksDQogICAgICBzdHI7DQogICAgZW5jb2RpbmcgfHwgKGVuY29kaW5nID0gJ1VURi04Jyk7DQogICAgdHJ5IHsNCiAgICAgIHN0Lk9wZW4oKTsNCiAgICAgIHN0LlR5cGUgPSAxOw0KICAgICAgc3QuV3JpdGUoYnl0ZXMpOw0KICAgICAgc3QuUG9zaXRpb24gPSAwOw0KICAgICAgc3QuVHlwZSA9IDI7DQogICAgICBzdC5DaGFyc2V0ID0gZW5jb2Rpbmc7DQogICAgICBzdHIgPSBzdC5SZWFkVGV4dCgpOw0KICAgIH0gZmluYWxseSB7DQogICAgICBzdC5DbG9zZSgpOw0KICAgIH0NCiAgICByZXR1cm4gc3RyOw0KICB9DQoNCiAgZnVuY3Rpb24gc3RyMmJpbihzdHIsIGVuY29kaW5nKSB7DQogICAgdmFyIHN0ID0gbmV3IEFjdGl2ZVhPYmplY3QoJ0FET0RCLlN0cmVhbScpLA0KICAgICAgYmluOw0KICAgIGVuY29kaW5nIHx8IChlbmNvZGluZyA9ICdVVEYtOCcpOw0KICAgIHRyeSB7DQogICAgICBzdC5PcGVuKCk7DQogICAgICBzdC5UeXBlID0gMjsNCiAgICAgIHN0LkNoYXJzZXQgPSBlbmNvZGluZzsNCiAgICAgIHN0LldyaXRlVGV4dChzdHIpOw0KICAgICAgc3QuUG9zaXRpb24gPSAwOw0KICAgICAgc3QuVHlwZSA9IDE7DQogICAgICBlbmNvZGluZyA9IGVuY29kaW5nLnJlcGxhY2UoJy0nLCAnJykudG9Mb3dlckNhc2UoKTsNCiAgICAgIGlmIChlbmNvZGluZyA9PSAndXRmOCcgfHwgZW5jb2RpbmcgPT0gJ3VuaWNvZGUnKSBzdC5Qb3NpdGlvbiA9IDM7DQogICAgICBlbHNlIGlmIChlbmNvZGluZyA9PSAndWZ0MTYnKSBzdC5Qb3NpdGlvbiA9IDI7DQogICAgICBiaW4gPSBzdC5SZWFkKCk7DQogICAgfSBmaW5hbGx5IHsNCiAgICAgIHN0LkNsb3NlKCk7DQogICAgfQ0KICAgIHJldHVybiBiaW47DQogIH0NCg0KICBmdW5jdGlvbiBlbmNvZGUoc3RyLCBlbmNvZGluZykgew0KICAgIHN3aXRjaCAoZW5jb2RpbmcpIHsNCiAgICAgIGNhc2UgJ2hleCc6DQogICAgICAgIHJldHVybiBoZXgyYmluKHN0cik7DQogICAgICBjYXNlICdiYXNlNjQnOg0KICAgICAgICByZXR1cm4gYmFzZTY0MmJpbihzdHIpOw0KICAgICAgZGVmYXVsdDoNCiAgICAgICAgcmV0dXJuIHN0cjJiaW4oc3RyLCBlbmNvZGluZyk7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gZGVjb2RlKGJ5dGVzLCBlbmNvZGluZykgew0KICAgIHN3aXRjaCAoZW5jb2RpbmcpIHsNCiAgICAgIGNhc2UgJ2hleCc6DQogICAgICAgIHJldHVybiBiaW4yaGV4KGJ5dGVzKTsNCiAgICAgIGNhc2UgJ2Jhc2U2NCc6DQogICAgICAgIHJldHVybiBiaW4yYmFzZTY0KGJ5dGVzKTsNCiAgICAgIGNhc2UgJ2JpbmFyeSc6DQogICAgICAgIHJldHVybiBieXRlczsNCiAgICAgIGRlZmF1bHQ6DQogICAgICAgIHJldHVybiBiaW4yc3RyKGJ5dGVzLCBlbmNvZGluZyk7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gYnVmX2luaXQob2JqLCBlbmNvZGluZykgew0KICAgIGlmIChvYmogPT0gbnVsbCB8fCBvYmogPT0gJycgfHwgb2JqLmxlbmd0aCA9PSAwKSB7DQogICAgICB0aGlzLmJ1ZmZlciA9IG5ldyBBY3RpdmVYT2JqZWN0KCdTY3JpcHRpbmcuRGljdGlvbmFyeScpLkl0ZW1zKCk7DQogICAgfSBlbHNlIGlmIChCdWZmZXIkMS5pc0J1ZmZlcihvYmopKSB7DQogICAgICB0aGlzLmJ1ZmZlciA9IG9iai5idWZmZXI7DQogICAgfSBlbHNlIGlmICh0eXBlb2Ygb2JqID09ICdzdHJpbmcnKSB7DQogICAgICB0aGlzLmJ1ZmZlciA9IGVuY29kZShvYmosIGVuY29kaW5nKTsNCiAgICB9IGVsc2UgaWYgKG9iaiAmJiBvYmouY29uc3RydWN0b3IgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBWQkFycmF5KSB7DQogICAgICB0aGlzLmJ1ZmZlciA9IG9iajsNCiAgICB9IGVsc2Ugew0KICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignRmFpbGVkIHRvIGNyZWF0ZSBidWZmZXIuJyk7DQogICAgfQ0KICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAnbGVuZ3RoJywgeyBnZXQ6IHRoaXMuX2dldExlbmd0aCB9KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIEJ1ZmZlciQxKG9iaiwgZW5jb2RpbmcpIHsNCiAgICByZXR1cm4gbmV3IGJ1Zl9pbml0KG9iaiwgZW5jb2RpbmcpOw0KICB9DQoNCiAgdmFyIGJ1Zl9wcm90byA9IChidWZfaW5pdC5wcm90b3R5cGUgPSBCdWZmZXIkMS5wcm90b3R5cGUpOw0KDQogIGJ1Zl9wcm90by50b1N0cmluZyA9IGZ1bmN0aW9uKGVuY29kaW5nKSB7DQogICAgcmV0dXJuIHRoaXMuYnVmZmVyLnVib3VuZCgpID09IC0xID8gJycgOiBkZWNvZGUodGhpcy5idWZmZXIsIGVuY29kaW5nKTsNCiAgfTsNCg0KICBidWZfcHJvdG8uX2dldExlbmd0aCA9IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiB0aGlzLmJ1ZmZlci51Ym91bmQoKSArIDE7DQogIH07DQoNCiAgQnVmZmVyJDEuZnJvbSA9IGZ1bmN0aW9uKG9iaiwgZW5jb2RpbmcpIHsNCiAgICByZXR1cm4gQnVmZmVyJDEob2JqLCBlbmNvZGluZyk7DQogIH07DQoNCiAgQnVmZmVyJDEuaXNCdWZmZXIgPSBmdW5jdGlvbihvYmopIHsNCiAgICByZXR1cm4gb2JqICYmIG9iaiBpbnN0YW5jZW9mIEJ1ZmZlciQxOw0KICB9Ow0KDQogIHdpbmRvdy5CdWZmZXIgPSBCdWZmZXIkMTsKCiAgdmFyIFRPX1NUUiA9IHt9LnRvU3RyaW5nOw0KICB2YXIgSEFTX09XTiA9IHt9Lmhhc093blByb3BlcnR5Ow0KDQoNCg0KICBmdW5jdGlvbiBjaHIobikgew0KICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKG4pOw0KICB9DQoNCiAgZnVuY3Rpb24gb3JkKGMpIHsNCiAgICByZXR1cm4gYy5jaGFyQ29kZUF0KDApOw0KICB9DQoNCiAgZnVuY3Rpb24gaGV4KHgpIHsNCiAgICByZXR1cm4gTnVtYmVyKHgpLnRvU3RyaW5nKDE2KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGJpbih4KSB7DQogICAgcmV0dXJuIE51bWJlcih4KS50b1N0cmluZygyKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIG9jdCh4KSB7DQogICAgcmV0dXJuIE51bWJlcih4KS50b1N0cmluZyg4KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGludCh4LCBiYXNlKSB7DQogICAgcmV0dXJuIHBhcnNlSW50KHgsIGJhc2UpOw0KICB9DQoNCiAgdmFyIEZVTkNfTkFNRV9SRUcgPSAvZnVuY3Rpb24gKyhcdyspLzsNCg0KICBmdW5jdGlvbiBnZXRGdW5jTmFtZShmbikgew0KICAgIGlmIChmbi5uYW1lKSByZXR1cm4gZm4ubmFtZTsNCiAgICB2YXIgbSA9IGZuLnRvU3RyaW5nKCkubWF0Y2goRlVOQ19OQU1FX1JFRyk7DQogICAgcmV0dXJuIG0gPyBtWzFdIDogJyc7DQogIH0NCg0KICBmdW5jdGlvbiBnZXRUYWcodmFsdWUpIHsNCiAgICByZXR1cm4gVE9fU1RSLmNhbGwodmFsdWUpOw0KICB9DQoNCiAgdmFyIFRZUEVfUkVHID0gL1xbb2JqZWN0IChbXlxdXSspXF0vOw0KDQogIGZ1bmN0aW9uIHR5cGVPZihvYmopIHsNCiAgICB2YXIgdHAgPSBvYmogPT09IG51bGwgPyAnbnVsbCcgOiB0eXBlb2Ygb2JqOw0KICAgIGlmICh0cCA9PSAnb2JqZWN0JykNCiAgICAgIHRwID0gVE9fU1RSLmNhbGwob2JqKQ0KICAgICAgICAubWF0Y2goVFlQRV9SRUcpWzFdDQogICAgICAgIC50b0xvd2VyQ2FzZSgpOw0KICAgIGlmICh0cCA9PSAnb2JqZWN0JyAmJiBvYmouY29uc3RydWN0b3IgJiYgdHlwZW9mIG9iai5jb25zdHJ1Y3RvciA9PSAnZnVuY3Rpb24nKQ0KICAgICAgdHAgPSBnZXRGdW5jTmFtZShvYmouY29uc3RydWN0b3IpLnRvTG93ZXJDYXNlKCkgfHwgdHA7DQogICAgcmV0dXJuIHRwOw0KICB9DQoNCiAgdmFyIHR5cGUgPSB0eXBlT2Y7DQoNCiAgZnVuY3Rpb24gaGFzKG9iaiwga2V5KSB7DQogICAgcmV0dXJuIG9iaiAhPSBudWxsICYmIEhBU19PV04uY2FsbChvYmosIGtleSk7DQogIH0NCg0KICBmdW5jdGlvbiBpc0FycmF5KG9iaikgew0KICAgIHJldHVybiBBcnJheS5pc0FycmF5KG9iaik7DQogIH0NCg0KICBmdW5jdGlvbiBpc09iamVjdChvYmopIHsNCiAgICB2YXIgdHlwZSA9IHR5cGVvZiBvYmo7DQogICAgcmV0dXJuIG9iaiAhPSBudWxsICYmICh0eXBlID09ICdvYmplY3QnIHx8IHR5cGUgPT0gJ2Z1bmN0aW9uJyk7DQogIH0NCg0KICBmdW5jdGlvbiBpc0Z1bmN0aW9uKG9iaikgew0KICAgIHJldHVybiB0eXBlb2Ygb2JqID09ICdmdW5jdGlvbic7DQogIH0NCg0KICBmdW5jdGlvbiBpc1N0cmluZyhvYmopIHsNCiAgICByZXR1cm4gdHlwZW9mIG9iaiA9PSAnc3RyaW5nJzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzTnVtYmVyKG9iaikgew0KICAgIHJldHVybiB0eXBlb2Ygb2JqID09ICdudW1iZXInOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNCb29sZWFuKG9iaikgew0KICAgIHJldHVybiBvYmogPT09IHRydWUgfHwgb2JqID09PSBmYWxzZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzRGF0ZShvYmopIHsNCiAgICByZXR1cm4gVE9fU1RSLmNhbGwob2JqKSA9PSAnW29iamVjdCBEYXRlXSc7DQogIH0NCg0KICBmdW5jdGlvbiBpc1JlZ0V4cChvYmopIHsNCiAgICByZXR1cm4gVE9fU1RSLmNhbGwob2JqKSA9PSAnW29iamVjdCBSZWdFeHBdJzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzRXJyb3Iob2JqKSB7DQogICAgcmV0dXJuIFRPX1NUUi5jYWxsKG9iaikgPT0gJ1tvYmplY3QgRXJyb3JdJzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzTWFwKG9iaikgew0KICAgIHJldHVybiBvYmogaW5zdGFuY2VvZiBNYXA7DQogIH0NCg0KICBmdW5jdGlvbiBpc1NldChvYmopIHsNCiAgICByZXR1cm4gb2JqIGluc3RhbmNlb2YgU2V0Ow0KICB9DQoNCiAgZnVuY3Rpb24gaXNXZWFrTWFwKG9iaikgew0KICAgIHJldHVybiBvYmogaW5zdGFuY2VvZiBXZWFrTWFwOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNJbnRlZ2VyKHZhbHVlKSB7DQogICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJyAmJiB2YWx1ZSAlIDEgPT0gMDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzQXJndW1lbnRzKG9iaikgew0KICAgIHJldHVybiBUT19TVFIuY2FsbChvYmopID09ICdbb2JqZWN0IEFyZ3VtZW50c10nOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNPYmplY3RMaWtlKHZhbHVlKSB7DQogICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PSAnb2JqZWN0JyAmJiB2YWx1ZSAhPSBudWxsOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNMZW5ndGgodmFsdWUpIHsNCiAgICByZXR1cm4gaXNJbnRlZ2VyKHZhbHVlKSAmJiB2YWx1ZSA+IC0xICYmIHZhbHVlIDwgOTAwNzE5OTI1NDc0MDk5MjsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzQXJyYXlMaWtlKG9iaikgew0KICAgIHJldHVybiBvYmogIT0gbnVsbCAmJiB0eXBlb2Ygb2JqICE9ICdmdW5jdGlvbicgJiYgaXNMZW5ndGgob2JqLmxlbmd0aCk7DQogIH0NCg0KICBmdW5jdGlvbiBpc0VtcHR5KG9iaikgew0KICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIHRydWU7DQogICAgaWYgKGlzQXJyYXlMaWtlKG9iaikpIHJldHVybiAhb2JqLmxlbmd0aDsNCiAgICBpZiAoaXNNYXAob2JqKSB8fCBpc1NldChvYmopKSByZXR1cm4gIW9iai5zaXplOw0KICAgIGZvciAodmFyIGtleSBpbiBvYmopIHsNCiAgICAgIGlmIChIQVNfT1dOLmNhbGwob2JqLCBrZXkpKSByZXR1cm4gZmFsc2U7DQogICAgfQ0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNCdWZmZXIob2JqKSB7DQogICAgcmV0dXJuIEJ1ZmZlci5pc0J1ZmZlcihvYmopOw0KICB9DQoNCiAgZnVuY3Rpb24gYXBwbHkoZm4sIHRoaXNBcmcsIGFyZ3MpIHsNCiAgICB2YXIgYXJnQ250ID0gKGFyZ3MgJiYgYXJncy5sZW5ndGgpIHx8IDAsDQogICAgICBoYXNUaGlzID0gdGhpc0FyZyA9PSBudWxsOw0KICAgIHN3aXRjaCAoYXJnQ250KSB7DQogICAgICBjYXNlIDA6DQogICAgICAgIHJldHVybiBoYXNUaGlzID8gZm4oKSA6IGZuLmNhbGwodGhpc0FyZyk7DQogICAgICBjYXNlIDE6DQogICAgICAgIHJldHVybiBoYXNUaGlzID8gZm4oYXJnc1swXSkgOiBmbi5jYWxsKHRoaXNBcmcsIGFyZ3NbMF0pOw0KICAgICAgY2FzZSAyOg0KICAgICAgICByZXR1cm4gaGFzVGhpcw0KICAgICAgICAgID8gZm4oYXJnc1swXSwgYXJnc1sxXSkNCiAgICAgICAgICA6IGZuLmNhbGwodGhpc0FyZywgYXJnc1swXSwgYXJnc1sxXSk7DQogICAgICBjYXNlIDM6DQogICAgICAgIHJldHVybiBoYXNUaGlzDQogICAgICAgICAgPyBmbihhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdKQ0KICAgICAgICAgIDogZm4uY2FsbCh0aGlzQXJnLCBhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdKTsNCiAgICAgIGRlZmF1bHQ6DQogICAgICAgIHJldHVybiBmbi5hcHBseSh0aGlzQXJnLCBhcmdzKTsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiByYW5nZShzdGFydCwgZW5kLCBzdGVwKSB7DQogICAgdmFyIGkgPSAtMSwNCiAgICAgIGxlbiwNCiAgICAgIHJlc3VsdCA9IFtdOw0KICAgIGlmIChzdGFydCA9PSBudWxsKSByZXR1cm4gcmVzdWx0Ow0KICAgIGlmIChlbmQgPT0gbnVsbCkgKGVuZCA9IHN0YXJ0KSwgKHN0YXJ0ID0gMCk7DQogICAgaWYgKHN0ZXAgPT0gbnVsbCkgc3RlcCA9IDE7DQogICAgc3RlcCA9IE1hdGguYWJzKHN0ZXApOw0KICAgIGlmIChzdGFydCA+IGVuZCkgc3RlcCA9IC1zdGVwOw0KICAgIGxlbiA9IE1hdGgubWF4KE1hdGguY2VpbCgoZW5kIC0gc3RhcnQpIC8gc3RlcCksIDApOw0KICAgIHJlc3VsdCA9IG5ldyBBcnJheShsZW4pOw0KICAgIHdoaWxlICgrK2kgPCBsZW4pIChyZXN1bHRbaV0gPSBzdGFydCksIChzdGFydCArPSBzdGVwKTsNCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9DQoNCiAgZnVuY3Rpb24gdG9QYXRoKHB0aCkgew0KICAgIGlmIChpc1N0cmluZyhwdGgpKSBwdGggPSBwdGguc3BsaXQoL1suW1xdXS8pLmZpbHRlcihpZGVudGl0eSk7DQogICAgZWxzZSBpZiAoaXNOdW1iZXIocHRoKSkgcHRoID0gW3B0aF07DQogICAgcmV0dXJuIGlzQXJyYXkocHRoKSA/IHB0aCA6IFtdOw0KICB9DQoNCiAgZnVuY3Rpb24gaWRlbnRpdHkodmFsdWUpIHsNCiAgICByZXR1cm4gdmFsdWU7DQogIH0NCg0KICBmdW5jdGlvbiBpdGVyYXRlZSh2YWx1ZSkgew0KICAgIHN3aXRjaCAodHlwZU9mKHZhbHVlKSkgew0KICAgICAgY2FzZSAnZnVuY3Rpb24nOg0KICAgICAgICByZXR1cm4gdmFsdWU7DQogICAgICBjYXNlICdzdHJpbmcnOg0KICAgICAgY2FzZSAnbnVtYmVyJzoNCiAgICAgICAgcmV0dXJuIHByb3BlcnR5KHZhbHVlKTsNCiAgICAgIGNhc2UgJ2FycmF5JzoNCiAgICAgICAgcmV0dXJuIHByb3BlcnRpZXModmFsdWUpOw0KICAgICAgY2FzZSAnb2JqZWN0JzoNCiAgICAgICAgcmV0dXJuIG1hdGNoZXModmFsdWUpOw0KICAgICAgZGVmYXVsdDoNCiAgICAgICAgcmV0dXJuIGlkZW50aXR5Ow0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIHRpbWVpdChmbiwgbGFiZWwpIHsNCiAgICBsYWJlbCB8fCAobGFiZWwgPSAndGltZScpOw0KICAgIGNvbnNvbGUudGltZShsYWJlbCk7DQogICAgZm4oKTsNCiAgICBjb25zb2xlLnRpbWVFbmQobGFiZWwpOw0KICB9DQoNCg0KDQoNCg0KICBmdW5jdGlvbiBlYWNoKG9iaiwgZm4pIHsNCiAgICB2YXIgZW4sIGksIGtleSwgbGVuOw0KICAgIGlmIChpc0FycmF5TGlrZShvYmopKSB7DQogICAgICBmb3IgKGkgPSAwLCBsZW4gPSBvYmoubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCiAgICAgICAgaWYgKGZuKG9ialtpXSwgaSwgb2JqKSA9PT0gZmFsc2UpIGJyZWFrOw0KICAgICAgfQ0KICAgIH0gZWxzZSBpZiAob2JqICYmICFvYmouY29uc3RydWN0b3IgJiYgJ0l0ZW0nIGluIG9iaikgew0KICAgICAgZW4gPSBuZXcgRW51bWVyYXRvcihvYmopOw0KICAgICAgZm9yIChpID0gMDsgIWVuLmF0RW5kKCk7IGVuLm1vdmVOZXh0KCksIGkrKykgew0KICAgICAgICBpZiAoZm4oZW4uaXRlbSgpLCBpLCBvYmopID09PSBmYWxzZSkgYnJlYWs7DQogICAgICB9DQogICAgfSBlbHNlIGlmIChpc0xlbmd0aChvYmopKSB7DQogICAgICBmb3IgKGkgPSAwOyBpIDwgb2JqOyBpKyspIHsNCiAgICAgICAgaWYgKGZuKGksIGksIG9iaikgPT09IGZhbHNlKSBicmVhazsNCiAgICAgIH0NCiAgICB9IGVsc2UgaWYgKGlzT2JqZWN0KG9iaikpIHsNCiAgICAgIGZvciAoa2V5IGluIG9iaikgew0KICAgICAgICBpZiAoaGFzKG9iaiwga2V5KSkgew0KICAgICAgICAgIGlmIChmbihvYmpba2V5XSwga2V5LCBvYmopID09PSBmYWxzZSkgYnJlYWs7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIG9iajsNCiAgfQ0KDQogIHZhciBmb3JFYWNoID0gZWFjaDsNCg0KICBmdW5jdGlvbiBtYXAob2JqLCBmbikgew0KICAgIHZhciByZXN1bHQgPSBbXSwNCiAgICAgIGl0ZSA9IGl0ZXJhdGVlKGZuKTsNCiAgICBlYWNoKG9iaiwgZnVuY3Rpb24gKHYsIGssIG8pICB7DQogICAgICByZXN1bHQucHVzaChpdGUodiwgaywgbykpOw0KICAgIH0pOw0KICAgIHJldHVybiByZXN1bHQ7DQogIH0NCg0KICB2YXIgc2VsZWN0ID0gbWFwOw0KDQogIGZ1bmN0aW9uIHJlZHVjZShvYmosIGZuLCBtZW1vKSB7DQogICAgZWFjaChvYmosIGZ1bmN0aW9uKHYsIGssIG8pIHsNCiAgICAgIG1lbW8gPSBmbihtZW1vLCB2LCBrLCBvKTsNCiAgICB9KTsNCiAgICByZXR1cm4gbWVtbzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGZpbHRlcihvYmosIGZuKSB7DQogICAgdmFyIHJlc3VsdCA9IFtdLA0KICAgICAgaXRlID0gaXRlcmF0ZWUoZm4pOw0KICAgIGVhY2gob2JqLCBmdW5jdGlvbiAodiwgaywgbykgIHsNCiAgICAgIGlmIChpdGUodiwgaywgbykpIHJlc3VsdC5wdXNoKHYpOw0KICAgIH0pOw0KICAgIHJldHVybiByZXN1bHQ7DQogIH0NCg0KICB2YXIgd2hlcmUgPSBmaWx0ZXI7DQoNCiAgZnVuY3Rpb24gdG9BcnJheShvYmopIHsNCiAgICB2YXIgaSwgbGVuLCBhcnI7DQogICAgaWYgKGlzQXJyYXkob2JqKSkgcmV0dXJuIG9iajsNCiAgICBpZiAoaXNBcnJheUxpa2Uob2JqKSkgew0KICAgICAgaSA9IC0xOw0KICAgICAgbGVuID0gb2JqLmxlbmd0aDsNCiAgICAgIGFyciA9IEFycmF5KGxlbik7DQogICAgICB3aGlsZSAoKytpIDwgbGVuKSBhcnJbaV0gPSBvYmpbaV07DQogICAgICByZXR1cm4gYXJyOw0KICAgIH0NCiAgICBpZiAoaXNPYmplY3Qob2JqKSkgcmV0dXJuIG1hcChvYmopOw0KICAgIHJldHVybiBbXTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGJhc2VGaW5kKGFyciwgZm4sIF90aGlzKSB7DQogICAgdmFyIGkgPSAtMSwNCiAgICAgIGxlbiA9IGFyci5sZW5ndGgsDQogICAgICBpdDsNCiAgICBpZiAoX3RoaXMpIHsNCiAgICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgICAgaXQgPSBhcnJbaV07DQogICAgICAgIGlmIChmbi5jYWxsKF90aGlzLCBpdCwgaSwgYXJyKSkgew0KICAgICAgICAgIHJldHVybiBbaXQsIGldOw0KICAgICAgICB9DQogICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgICAgaXQgPSBhcnJbaV07DQogICAgICAgIGlmIChmbihpdCwgaSwgYXJyKSkgew0KICAgICAgICAgIHJldHVybiBbaXQsIGldOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiBbbnVsbCwgLTFdOw0KICB9DQoNCiAgZnVuY3Rpb24gZmluZChhcnIsIGZuKSB7DQogICAgcmV0dXJuIGJhc2VGaW5kKGFyciwgZm4pWzBdOw0KICB9DQoNCiAgZnVuY3Rpb24gZmluZEluZGV4KGFyciwgZm4pIHsNCiAgICByZXR1cm4gYmFzZUZpbmQoYXJyLCBmbilbMV07DQogIH0NCg0KICBmdW5jdGlvbiBmaWxsKGFyciwgdmFsLCBzdGFydCwgZW5kKSB7DQogICAgdmFyIGxlbiA9IGFyci5sZW5ndGg7DQogICAgaWYgKHN0YXJ0ID09IG51bGwpIHN0YXJ0ID0gMDsNCiAgICBpZiAoZW5kID09IG51bGwpIGVuZCA9IGxlbjsNCiAgICBpZiAoZW5kIDwgMCkgZW5kID0gTWF0aC5tYXgoZW5kICsgbGVuLCBsZW4pOw0KICAgIHdoaWxlIChzdGFydCA8IGVuZCkgew0KICAgICAgYXJyW3N0YXJ0XSA9IHZhbDsNCiAgICAgIHN0YXJ0Kys7DQogICAgfQ0KICAgIHJldHVybiBhcnI7DQogIH0NCg0KICBmdW5jdGlvbiBncm91cEJ5KG9iaiwgZm4pIHsNCiAgICB2YXIgcmVzdWx0ID0ge30sDQogICAgICBpdGUgPSBpdGVyYXRlZShmbik7DQogICAgZWFjaChvYmosIGZ1bmN0aW9uKHYsIGssIG8pIHsNCiAgICAgIHZhciBrZXkgPSBpdGUodiwgaywgbyk7DQogICAgICBoYXMocmVzdWx0LCBrZXkpID8gcmVzdWx0W2tleV0ucHVzaCh2KSA6IChyZXN1bHRba2V5XSA9IFt2XSk7DQogICAgfSk7DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNvdW50Qnkob2JqLCBmbikgew0KICAgIHZhciBpdGUgPSBpdGVyYXRlZShmbik7DQogICAgcmV0dXJuIHJlZHVjZSgNCiAgICAgIG9iaiwgZnVuY3Rpb24NCiAgICAgIChyZXN1bHQsIHZhbHVlLCBrZXkpICB7DQogICAgICAgIGtleSA9IGl0ZSh2YWx1ZSk7DQogICAgICAgIGhhcyhyZXN1bHQsIGtleSkgPyByZXN1bHRba2V5XSsrIDogKHJlc3VsdFtrZXldID0gMSk7DQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgICB9LA0KICAgICAge30NCiAgICApOw0KICB9DQoNCiAgZnVuY3Rpb24gc2l6ZShvYmopIHsNCiAgICByZXR1cm4gaXNBcnJheUxpa2Uob2JqKSA/IG9iai5sZW5ndGggOiBPYmplY3Qua2V5cyhvYmopLmxlbmd0aDsNCiAgfQ0KDQogIHZhciBsZW4gPSBzaXplOw0KDQoNCg0KDQoNCiAgZnVuY3Rpb24gdW5pcUJ5KGFyciwgZm4pIHsNCiAgICB2YXIgaXRlID0gaXRlcmF0ZWUoZm4pLA0KICAgICAgcmVzdWx0ID0gW10sDQogICAgICBtZW1vID0gbmV3IFNldCgpLA0KICAgICAgaSA9IC0xLA0KICAgICAgbGVuID0gYXJyLmxlbmd0aCwNCiAgICAgIGl0ZW0sDQogICAgICBjb21wdXRlZDsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICBpdGVtID0gYXJyW2ldOw0KICAgICAgY29tcHV0ZWQgPSBpdGUoaXRlbSk7DQogICAgICBpZiAoIW1lbW8uaGFzKGNvbXB1dGVkKSkgew0KICAgICAgICByZXN1bHQucHVzaChpdGVtKTsNCiAgICAgICAgbWVtby5hZGQoY29tcHV0ZWQpOw0KICAgICAgfQ0KICAgIH0NCiAgICBtZW1vLmNsZWFyKCk7DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfQ0KDQogIGZ1bmN0aW9uIHVuaXEoYXJyKSB7DQogICAgcmV0dXJuIHVuaXFCeShhcnIsIGlkZW50aXR5KTsNCiAgfQ0KDQogIHZhciBkaXN0aW5jdCA9IHVuaXE7DQoNCiAgdmFyIGRpc3RpbmN0QnkgPSB1bmlxQnk7DQoNCiAgZnVuY3Rpb24gY2h1bmsoYXJyLCBuKSB7DQogICAgaWYgKG4gPT0gbnVsbCB8fCBuIDwgMSkgcmV0dXJuIFtdOw0KICAgIHZhciByZXN1bHQgPSBbXSwNCiAgICAgIHRtcCA9IEFycmF5KG4pLA0KICAgICAgaSA9IC0xLA0KICAgICAgbGVuID0gYXJyLmxlbmd0aCwNCiAgICAgIG9mZiA9IDA7DQogICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgdG1wW29mZisrXSA9IGFycltpXTsNCiAgICAgIGlmIChvZmYgPT0gMSkgew0KICAgICAgICByZXN1bHQucHVzaCh0bXApOw0KICAgICAgfSBlbHNlIGlmIChvZmYgPT0gbikgew0KICAgICAgICBvZmYgPSAwOw0KICAgICAgICB0bXAgPSBBcnJheShuKTsNCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNvbmNhdCgpIHsNCiAgICB2YXIgaSA9IC0xLA0KICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aCwNCiAgICAgIHJlc3VsdCA9IFtdLA0KICAgICAgYXJyLA0KICAgICAgaWksDQogICAgICBsZW4yOw0KICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgIGFyciA9IGFyZ3VtZW50c1tpXTsNCiAgICAgIGlpID0gLTE7DQogICAgICBsZW4yID0gYXJyICYmIGFyci5sZW5ndGg7DQogICAgICBpZiAobGVuMiA9PSBudWxsKSB7DQogICAgICAgIHJlc3VsdC5wdXNoKGFycik7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB3aGlsZSAoKytpaSA8IGxlbjIpIHJlc3VsdC5wdXNoKGFycltpaV0pOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9DQoNCiAgZnVuY3Rpb24gc2xpY2UoYXJyLCBzdGFydCwgZW5kKSB7DQogICAgdmFyIGkgPSAtMSwNCiAgICAgIGxlbiA9IChhcnIgJiYgYXJyLmxlbmd0aCkgfHwgMCwNCiAgICAgIHJlc3VsdDsNCiAgICBpZiAoIWxlbikgcmV0dXJuIFtdOw0KICAgIGlmIChzdGFydCA9PSBudWxsKSBzdGFydCA9IDA7DQogICAgaWYgKGVuZCA9PSBudWxsKSBlbmQgPSBsZW47DQogICAgaWYgKHN0YXJ0IDwgMCkgc3RhcnQgPSAtc3RhcnQgPiBsZW4gPyAwIDogbGVuICsgc3RhcnQ7DQogICAgaWYgKGVuZCA8IDApIGVuZCArPSBsZW47DQogICAgZWxzZSBpZiAoZW5kID4gbGVuKSBlbmQgPSBsZW47DQogICAgbGVuID0gc3RhcnQgPiBlbmQgPyAwIDogZW5kIC0gc3RhcnQ7DQogICAgcmVzdWx0ID0gbmV3IEFycmF5KGxlbik7DQogICAgd2hpbGUgKCsraSA8IGxlbikgcmVzdWx0W2ldID0gYXJyW2kgKyBzdGFydF07DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfQ0KDQoNCiAgZnVuY3Rpb24gZHJvcChhcnIsIG4pIHsNCiAgICByZXR1cm4gc2xpY2UoYXJyLCBuIHx8IDEpOw0KICB9DQoNCg0KICBmdW5jdGlvbiB0YWlsKGFycikgew0KICAgIHJldHVybiBkcm9wKGFyciwgMSk7DQogIH0NCg0KDQogIGZ1bmN0aW9uIGluaXRpYWwoYXJyKSB7DQogICAgcmV0dXJuIHNsaWNlKGFyciwgMCwgTWF0aC5tYXgoMCwgYXJyLmxlbmd0aCAtIDEpKTsNCiAgfQ0KDQoNCiAgZnVuY3Rpb24gdGFrZShhcnIsIG4pIHsNCiAgICByZXR1cm4gc2xpY2UoYXJyLCAwLCBuKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHRha2VSaWdodChhcnIsIG4pIHsNCiAgICByZXR1cm4gc2xpY2UoYXJyLCAtbik7DQogIH0NCg0KICBmdW5jdGlvbiBjb250YWlucyhvYmosIHZhbCwgcG9zKSB7DQogICAgcmV0dXJuIG9iai5pbmRleE9mKHZhbCwgcG9zIHx8IDApICE9IC0xOw0KICB9DQoNCiAgdmFyIGluY2x1ZGUgPSBjb250YWluczsNCg0KICB2YXIgaW5jbHVkZXMgPSBjb250YWluczsNCg0KICBmdW5jdGlvbiBmaXJzdChhcnIpIHsNCiAgICByZXR1cm4gYXJyICYmIGFyclswXTsNCiAgfQ0KDQogIHZhciBoZWFkID0gZmlyc3Q7DQoNCiAgZnVuY3Rpb24gbGFzdChhcnIpIHsNCiAgICByZXR1cm4gKGFyciAmJiBhcnIubGVuZ3RoID4gMCAmJiBhcnJbYXJyLmxlbmd0aCAtIDFdKSB8fCB2b2lkIDA7DQogIH0NCg0KICBmdW5jdGlvbiBudGgoYXJyLCBuKSB7DQogICAgcmV0dXJuIGFyciAmJiAobiA8IDAgPyBhcnJbYXJyLmxlbmd0aCArIG5dIDogYXJyW25dKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHB1bGxBbGwoYXJyLCB2YWx1ZXMpIHsNCiAgICBpZiAoIWlzQXJyYXkodmFsdWVzKSkgcmV0dXJuIGFycjsNCiAgICB2YXIgaSA9IGFyci5sZW5ndGg7DQogICAgd2hpbGUgKGktLSkgew0KICAgICAgaWYgKHZhbHVlcy5pbmNsdWRlcyhhcnJbaV0pKSBhcnIuc3BsaWNlKGksIDEpOw0KICAgIH0NCiAgICByZXR1cm4gYXJyOw0KICB9DQoNCiAgZnVuY3Rpb24gcHVsbChhcnIpIHsNCiAgICByZXR1cm4gcHVsbEFsbChhcnIsIHRhaWwoYXJndW1lbnRzKSk7DQogIH0NCg0KICBmdW5jdGlvbiByZW1vdmUoYXJyLCBmbikgew0KICAgIHZhciBpID0gYXJyLmxlbmd0aCwNCiAgICAgIGl0ZSA9IGl0ZXJhdGVlKGZuKTsNCiAgICB3aGlsZSAoaS0tKSB7DQogICAgICBpZiAoaXRlKGFycltpXSwgaSwgYXJyKSkgYXJyLnNwbGljZShpLCAxKTsNCiAgICB9DQogICAgcmV0dXJuIGFycjsNCiAgfQ0KDQogIGZ1bmN0aW9uIGRpZmZlcmVuY2UoYXJyLCB2YWx1ZXMpIHsNCiAgICByZXR1cm4gZmlsdGVyKGFyciwgZnVuY3Rpb24oIGl0ICl7cmV0dXJuICAhaW5jbHVkZXModmFsdWVzLCBpdCl9KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHVuemlwKGFycikgew0KICAgIGlmIChhcnIgPT0gbnVsbCB8fCAhYXJyLmxlbmd0aCkgew0KICAgICAgcmV0dXJuIFtdOw0KICAgIH0NCiAgICB2YXIgbGVuID0gMDsNCiAgICBhcnIgPSBmaWx0ZXIoYXJyLCBmdW5jdGlvbiggaXQgKSB7DQogICAgICBpZiAoaGFzKGl0LCAnbGVuZ3RoJykpIHsNCiAgICAgICAgbGVuID0gTWF0aC5tYXgoaXQubGVuZ3RoLCBsZW4pOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgIH0NCiAgICB9KTsNCiAgICB2YXIgaSA9IC0xLA0KICAgICAgcmVzdWx0ID0gQXJyYXkobGVuKTsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICByZXN1bHRbaV0gPSBtYXAoYXJyLCBpKTsNCiAgICB9DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfQ0KDQogIGZ1bmN0aW9uIHppcCgpIHsNCiAgICByZXR1cm4gdW56aXAoYXJndW1lbnRzKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGZsYXR0ZW4oYXJyKSB7DQogICAgcmV0dXJuIHJlZHVjZSgNCiAgICAgIGFyciwgZnVuY3Rpb24NCiAgICAgIChyc3QsIGl0KSAgew0KICAgICAgICBpZiAoaXNBcnJheShpdCkpIHJzdCA9IHJzdC5jb25jYXQoaXQpOw0KICAgICAgICBlbHNlIHJzdC5wdXNoKGl0KTsNCiAgICAgICAgcmV0dXJuIHJzdDsNCiAgICAgIH0sDQogICAgICBbXQ0KICAgICk7DQogIH0NCg0KDQoNCg0KDQogIGZ1bmN0aW9uIGtleXMob2JqKSB7DQogICAgcmV0dXJuIG9iaiA/IE9iamVjdC5rZXlzKG9iaikgOiBbXTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHZhbHVlcyhvYmopIHsNCiAgICByZXR1cm4gb2JqID8ga2V5cyhvYmopLm1hcChwcm9wZXJ0eU9mKG9iaikpIDogW107DQogIH0NCg0KICBmdW5jdGlvbiBrZXlzSW4ob2JqKSB7DQogICAgdmFyIGFyciA9IFtdOw0KICAgIGlmIChvYmopIHsNCiAgICAgIGZvciAodmFyIGsgaW4gb2JqKSB7DQogICAgICAgIGFyci5wdXNoKGspOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gYXJyOw0KICB9DQoNCiAgZnVuY3Rpb24gdmFsdWVzSW4ob2JqKSB7DQogICAgcmV0dXJuIG9iaiA/IGtleXNJbihvYmopLm1hcChwcm9wZXJ0eU9mKG9iaikpIDogW107DQogIH0NCg0KDQoNCiAgZnVuY3Rpb24gemlwT2JqZWN0KHByb3BzLCB2YWx1ZXMpIHsNCiAgICB2YXIgaSA9IC0xLA0KICAgICAgbGVuID0gcHJvcHMubGVuZ3RoLA0KICAgICAgdkxlbiA9IHZhbHVlcy5sZW5ndGgsDQogICAgICByZXN1bHQgPSB7fTsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICByZXN1bHRbcHJvcHNbaV1dID0gaSA8IHZMZW4gPyB2YWx1ZXNbaV0gOiB2b2lkIDA7DQogICAgfQ0KICAgIHJldHVybiByZXN1bHQ7DQogIH0NCg0KDQoNCiAgZnVuY3Rpb24gZnJvbVBhaXJzKHBhaXJzKSB7DQogICAgdmFyIHJlc3VsdCA9IHt9LA0KICAgICAgaSA9IC0xLA0KICAgICAgbGVuID0gcGFpcnMubGVuZ3RoOw0KICAgIHdoaWxlICgrK2kgPCBsZW4pIHJlc3VsdFtwYWlyc1tpXVswXV0gPSBwYWlyc1tpXVsxXTsNCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9DQoNCiAgZnVuY3Rpb24gb2JqZWN0KGFycjEsIGFycjIpIHsNCiAgICByZXR1cm4gYXJyMiA/IHppcE9iamVjdChhcnIxLCBhcnIyKSA6IGZyb21QYWlycyhhcnIxKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGdldChvYmosIHB0aCwgZGVmVmFsKSB7DQogICAgdmFyIGkgPSAtMSwNCiAgICAgIF9wdGggPSB0b1BhdGgocHRoKSwNCiAgICAgIGxlbiA9IF9wdGgubGVuZ3RoOw0KICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIGRlZlZhbDsNCiAgICAgIG9iaiA9IG9ialtfcHRoW2ldXTsNCiAgICB9DQogICAgcmV0dXJuIG9iajsNCiAgfQ0KDQogIGZ1bmN0aW9uIGF0KG9iaiwgcHRocykgew0KICAgIHJldHVybiBwdGhzLm1hcCggZnVuY3Rpb24ocHRoICl7cmV0dXJuICBnZXQob2JqLCBwdGgpfSk7DQogIH0NCg0KICBmdW5jdGlvbiBwcm9wZXJ0eU9mKG9iaikgew0KICAgIHJldHVybiBmdW5jdGlvbiggcHRoICl7cmV0dXJuICBnZXQob2JqLCBwdGgpfTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHByb3BlcnR5KHB0aCkgew0KICAgIHJldHVybiBmdW5jdGlvbiggb2JqICl7cmV0dXJuICBnZXQob2JqLCBwdGgpfTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHByb3BlcnRpZXMocHRocykgew0KICAgIHJldHVybiBmdW5jdGlvbiggb2JqICl7cmV0dXJuICBhdChvYmosIHB0aHMpfTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNldChvYmosIHB0aCwgdmFsdWUpIHsNCiAgICB2YXIgX3B0aCA9IHRvUGF0aChwdGgpLA0KICAgICAga2V5ID0gbGFzdChfcHRoKSwNCiAgICAgIF9vYmogPSBnZXQob2JqLCBpbml0aWFsKF9wdGgpKTsNCiAgICBpZiAoX29iaiAhPSBudWxsKSB7DQogICAgICBfb2JqW2tleV0gPSB2YWx1ZTsNCiAgICB9DQogICAgcmV0dXJuIG9iajsNCiAgfQ0KDQogIGZ1bmN0aW9uIHVuc2V0KG9iaiwgcHRoKSB7DQogICAgdmFyIF9wdGggPSB0b1BhdGgocHRoKSwNCiAgICAgIGtleSA9IGxhc3QoX3B0aCksDQogICAgICBfb2JqID0gZ2V0KG9iaiwgaW5pdGlhbChfcHRoKSk7DQogICAgaWYgKF9vYmogIT0gbnVsbCAmJiBoYXMoX29iaiwga2V5KSkgew0KICAgICAgZGVsZXRlIF9vYmpba2V5XTsNCiAgICB9DQogICAgcmV0dXJuIG9iajsNCiAgfQ0KDQogIGZ1bmN0aW9uIHVwZGF0ZShvYmosIHB0aCwgZm4pIHsNCiAgICB2YXIgX3B0aCA9IHRvUGF0aChwdGgpLA0KICAgICAga2V5ID0gbGFzdChfcHRoKSwNCiAgICAgIF9vYmogPSBnZXQob2JqLCBpbml0aWFsKF9wdGgpKTsNCiAgICBpZiAoX29iaiAhPSBudWxsKSB7DQogICAgICBfb2JqW2tleV0gPSBmbihfb2JqW2tleV0pOw0KICAgIH0NCiAgICByZXR1cm4gb2JqOw0KICB9DQoNCiAgZnVuY3Rpb24gcGljayhvYmosIHB0aHMpIHsNCiAgICB2YXIgX3B0aHMgPSBwdGhzLm1hcCggZnVuY3Rpb24oaXQgKXtyZXR1cm4gIHRvUGF0aChpdCl9KTsNCiAgICByZXR1cm4gX3B0aHMucmVkdWNlKCBmdW5jdGlvbihyZXN1bHQsIHB0aCkgIHsNCiAgICAgIHZhciB2YWx1ZSA9IGdldChvYmosIHB0aCk7DQogICAgICBpZiAodmFsdWUpIHJlc3VsdFtsYXN0KHB0aCldID0gdmFsdWU7DQogICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0sIHt9KTsNCiAgfQ0KDQoNCg0KICBmdW5jdGlvbiBpc01hdGNoKG9iaiwgYXR0cnMpIHsNCiAgICBpZiAob2JqID09IG51bGwgfHwgYXR0cnMgPT0gbnVsbCkgcmV0dXJuIGZhbHNlOw0KICAgIGZvciAodmFyIGtleSBpbiBhdHRycykgew0KICAgICAgaWYgKCFoYXMoYXR0cnMsIGtleSkpIGNvbnRpbnVlOw0KICAgICAgaWYgKCFoYXMob2JqLCBrZXkpIHx8IGF0dHJzW2tleV0gIT09IG9ialtrZXldKSByZXR1cm4gZmFsc2U7DQogICAgfQ0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCg0KICBmdW5jdGlvbiBtYXRjaGVzKGF0dHJzKSB7DQogICAgcmV0dXJuIGZ1bmN0aW9uKCBvYmogKXtyZXR1cm4gIGlzTWF0Y2gob2JqLCBhdHRycyl9Ow0KICB9DQoNCiAgdmFyIG1hdGNoZXIgPSBtYXRjaGVzOw0KDQogIGZ1bmN0aW9uIGFzc2lnbihvYmopIHsNCiAgICB2YXIga2V5LA0KICAgICAgc3JjLA0KICAgICAgaSA9IDAsDQogICAgICBhcmdzID0gYXJndW1lbnRzLA0KICAgICAgbGVuID0gYXJncy5sZW5ndGg7DQogICAgb2JqIHx8IChvYmogPSB7fSk7DQogICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgc3JjID0gYXJnc1tpXTsNCiAgICAgIGZvciAoa2V5IGluIHNyYykgew0KICAgICAgICBpZiAoaGFzKHNyYywga2V5KSkgew0KICAgICAgICAgIG9ialtrZXldID0gc3JjW2tleV07DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIG9iajsNCiAgfQ0KDQogIGZ1bmN0aW9uIGFzc2lnbkluKG9iaikgew0KICAgIHZhciBrZXksDQogICAgICBzcmMsDQogICAgICBpID0gMCwNCiAgICAgIGFyZ3MgPSBhcmd1bWVudHMsDQogICAgICBsZW4gPSBhcmdzLmxlbmd0aDsNCiAgICBvYmogfHwgKG9iaiA9IHt9KTsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICBzcmMgPSBhcmdzW2ldOw0KICAgICAgZm9yIChrZXkgaW4gc3JjKSB7DQogICAgICAgIGlmIChoYXMoc3JjLCBrZXkpKSB7DQogICAgICAgICAgb2JqW2tleV0gPSBzcmNba2V5XTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gb2JqOw0KICB9DQoNCiAgdmFyIGV4dGVuZCA9IGFzc2lnbkluOw0KDQogIGZ1bmN0aW9uIGRlZmF1bHRzKG9iaikgew0KICAgIHZhciBrZXksDQogICAgICBzcmMsDQogICAgICBpID0gMCwNCiAgICAgIGFyZ3MgPSBhcmd1bWVudHMsDQogICAgICBsZW4gPSBhcmdzLmxlbmd0aDsNCiAgICBvYmogfHwgKG9iaiA9IHt9KTsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICBzcmMgPSBhcmdzW2ldOw0KICAgICAgZm9yIChrZXkgaW4gc3JjKSB7DQogICAgICAgIGlmICghaGFzKG9iaiwga2V5KSkgew0KICAgICAgICAgIG9ialtrZXldID0gc3JjW2tleV07DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIG9iajsNCiAgfQ0KDQogIGZ1bmN0aW9uIGVudHJpZXMob2JqKSB7DQogICAgcmV0dXJuIG9iaiA/IG1hcChvYmosIGZ1bmN0aW9uICh2LCBrKSB7cmV0dXJuICBbaywgdl19KSA6IFtdOw0KICB9DQoNCiAgdmFyIHRvUGFpcnMgPSBlbnRyaWVzOw0KDQoNCg0KDQoNCiAgZnVuY3Rpb24gbWVtb2l6ZShmbiwgcmVzb2x2ZXIpIHsNCiAgICB2YXIgbWVtb2l6ZWQgPSBmdW5jdGlvbihrZXkpIHsNCiAgICAgIHZhciBjYWNoZSA9IG1lbW9pemVkLmNhY2hlLA0KICAgICAgICBhcmdzID0gYXJndW1lbnRzLA0KICAgICAgICBhZGRyID0gcmVzb2x2ZXIgPyBhcHBseShyZXNvbHZlciwgdGhpcywgYXJncykgOiBrZXk7DQogICAgICBpZiAoIWNhY2hlLmhhcyhhZGRyKSkgew0KICAgICAgICBjYWNoZS5zZXQoYWRkciwgYXBwbHkoZm4sIHRoaXMsIGFyZ3MpKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBjYWNoZS5nZXQoYWRkcik7DQogICAgfTsNCiAgICBtZW1vaXplZC5jYWNoZSA9IG5ldyBNYXAoKTsNCiAgICByZXR1cm4gbWVtb2l6ZWQ7DQogIH0NCg0KICBmdW5jdGlvbiBwYXJ0aWFsKGZuLCBib3VuZEFyZ3MpIHsNCiAgICBib3VuZEFyZ3MgPSB0b0FycmF5KGFyZ3VtZW50cykuc2xpY2UoMSk7DQoNCiAgICByZXR1cm4gZnVuY3Rpb24oKSB7DQogICAgICB2YXIgX2FyZ3MgPSB0b0FycmF5KGFyZ3VtZW50cyksDQogICAgICAgIGkgPSAwOw0KICAgICAgdmFyIGFyZ3MgPSBib3VuZEFyZ3MubWFwKCBmdW5jdGlvbihhcmcgKXtyZXR1cm4gIChhcmcgPT09IHBhcnRpYWwuXyA/IF9hcmdzW2krK10gOiBhcmcpfSk7DQogICAgICBhcmdzID0gYXJncy5jb25jYXQoX2FyZ3Muc2xpY2UoaSkpOw0KICAgICAgcmV0dXJuIGFwcGx5KGZuLCB0aGlzLCBhcmdzKTsNCiAgICB9Ow0KICB9DQogIHBhcnRpYWwuXyA9IHt9Ow0KDQogIGZ1bmN0aW9uIGN1cnJ5KGZuKSB7DQogICAgdmFyIGFyZ3NMZW4gPSBmbi5sZW5ndGgsDQogICAgICBhcmdzID0gW107DQogICAgdmFyIGN1cnJpZWQgPSBmdW5jdGlvbigpIHsNCiAgICAgIGFyZ3MgPSBjb25jYXQoYXJncywgYXJndW1lbnRzKTsNCiAgICAgIGlmIChhcmdzTGVuID09PSBhcmdzLmxlbmd0aCkgcmV0dXJuIGFwcGx5KGZuLCB0aGlzLCBhcmdzKTsNCiAgICAgIGVsc2UgcmV0dXJuIGN1cnJpZWQ7DQogICAgfTsNCiAgICByZXR1cm4gYXJnc0xlbiA8IDIgPyBmbiA6IGN1cnJpZWQ7DQogIH0NCg0KICBmdW5jdGlvbiBhcnkoZm4sIG4pIHsNCiAgICByZXR1cm4gbiA9PSBudWxsDQogICAgICA/IGZuDQogICAgICA6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgIHZhciBhcmdzID0gc2xpY2UoYXJndW1lbnRzLCAwLCBuKTsNCiAgICAgICAgICByZXR1cm4gYXBwbHkoZm4sIHRoaXMsIGFyZ3MpOw0KICAgICAgICB9Ow0KICB9DQoNCiAgZnVuY3Rpb24gd3JhcChmbiwgd3JhcHBlcikgew0KICAgIHdyYXBwZXIgfHwgKHdyYXBwZXIgPSBpZGVudGl0eSk7DQogICAgcmV0dXJuIGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuIGFwcGx5KHdyYXBwZXIsIHRoaXMsIGNvbmNhdChbZm5dLCBhcmd1bWVudHMpKTsNCiAgICB9Ow0KICB9DQoNCg0KDQoNCg0KICBmdW5jdGlvbiByYW5kb20obG93ZXIsIHVwcGVyKSB7DQogICAgaWYgKGxvd2VyID09IG51bGwpIHJldHVybiBNYXRoLnJhbmRvbSgpOw0KICAgIGlmICh1cHBlciA9PSBudWxsKSB7DQogICAgICB1cHBlciA9IGxvd2VyOw0KICAgICAgbG93ZXIgPSAwOw0KICAgIH0NCiAgICBpZiAobG93ZXIgPiB1cHBlcikgew0KICAgICAgdmFyIHRlbXAgPSBsb3dlcjsNCiAgICAgIGxvd2VyID0gdXBwZXI7DQogICAgICB1cHBlciA9IHRlbXA7DQogICAgfQ0KICAgIHJldHVybiBsb3dlciArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICh1cHBlciAtIGxvd2VyICsgMSkpOw0KICB9DQoNCiAgZnVuY3Rpb24gc3VtKCkgew0KICAgIHZhciBhcnIgPSBhcmd1bWVudHMubGVuZ3RoID09PSAxID8gYXJndW1lbnRzWzBdIDogYXJndW1lbnRzOw0KICAgIHJldHVybiByZWR1Y2UoYXJyLCBmdW5jdGlvbiAocmVzdWx0LCBpdCkge3JldHVybiAgKHJlc3VsdCArPSBpdCl9LCAwKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGF2ZXJhZ2UoKSB7DQogICAgdmFyIGFyciA9IGFyZ3VtZW50cy5sZW5ndGggPT09IDEgPyBhcmd1bWVudHNbMF0gOiBhcmd1bWVudHM7DQogICAgdmFyIGxlbiA9IGFyci5sZW5ndGg7DQogICAgcmV0dXJuIGxlbiA9PT0gMCA/IDAgOiBzdW0oYXJyKSAvIGxlbjsNCiAgfQ0KDQogIHZhciBhdmcgPSBhdmVyYWdlOw0KDQogIGZ1bmN0aW9uIGRlY2ltYWxBZGp1c3QobWV0aG9kTmFtZSwgbnVtYmVyLCBwcmVjaXNpb24pIHsNCiAgICBpZiAocHJlY2lzaW9uKSB7DQogICAgICB2YXIgdmFsdWUgPSBNYXRoW21ldGhvZE5hbWVdKG51bWJlciArICdlJyArIHByZWNpc2lvbik7DQogICAgICByZXR1cm4gKyh2YWx1ZSArICdlJyArIC1wcmVjaXNpb24pOw0KICAgIH0NCiAgICByZXR1cm4gTWF0aFttZXRob2ROYW1lXShudW1iZXIpOw0KICB9DQoNCiAgZnVuY3Rpb24gcm91bmQobnVtLCBwcmVjaXNpb24pIHsNCiAgICByZXR1cm4gZGVjaW1hbEFkanVzdCgncm91bmQnLCBudW0sIHByZWNpc2lvbik7DQogIH0NCg0KICBmdW5jdGlvbiBmbG9vcihudW0sIHByZWNpc2lvbikgew0KICAgIHJldHVybiBkZWNpbWFsQWRqdXN0KCdmbG9vcicsIG51bSwgcHJlY2lzaW9uKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNlaWwobnVtLCBwcmVjaXNpb24pIHsNCiAgICByZXR1cm4gZGVjaW1hbEFkanVzdCgnY2VpbCcsIG51bSwgcHJlY2lzaW9uKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJhZGlhbnMoeCkgew0KICAgIHJldHVybiAoTWF0aC5QSSAvIDE4MCkgKiB4Ow0KICB9DQoNCg0KDQoNCg0KICBmdW5jdGlvbiB0b1VwcGVyKHgpIHsNCiAgICByZXR1cm4geC50b1VwcGVyQ2FzZSgpOw0KICB9DQoNCiAgZnVuY3Rpb24gdG9Mb3dlcih4KSB7DQogICAgcmV0dXJuIHgudG9Mb3dlckNhc2UoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHRyaW0oeCkgew0KICAgIHJldHVybiB4LnRyaW0oKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlcGVhdChzdHIsIG4pIHsNCiAgICB2YXIgcnN0ID0gJyc7DQogICAgaWYgKCFpc1N0cmluZyhzdHIpKSBzdHIgPSBTdHJpbmcoc3RyKTsNCiAgICBpZiAobiA8IDEgfHwgIWlzRmluaXRlKG4pKSByZXR1cm4gcnN0Ow0KICAgIGRvIHsNCiAgICAgIGlmIChuICUgMikgcnN0ICs9IHN0cjsNCiAgICAgIG4gPSBNYXRoLmZsb29yKG4gLyAyKTsNCiAgICAgIGlmIChuKSBzdHIgKz0gc3RyOw0KICAgIH0gd2hpbGUgKG4pOw0KICAgIHJldHVybiByc3Q7DQogIH0NCg0KICBmdW5jdGlvbiBjcmVhdGVQYWRkaW5nKGxlbiwgY2hycykgew0KICAgIGNocnMgfHwgKGNocnMgPSAnICcpOw0KICAgIHZhciBwYWQgPSBjaHJzLnJlcGVhdChNYXRoLmNlaWwobGVuIC8gY2hycy5sZW5ndGgpKTsNCiAgICByZXR1cm4gcGFkLmxlbmd0aCA+IGxlbiA/IHBhZC5zbGljZSgwLCBsZW4pIDogcGFkOw0KICB9DQoNCiAgZnVuY3Rpb24gcGFkU3RhcnQoc3RyLCBsZW4sIGNocnMpIHsNCiAgICBpZiAoIWlzU3RyaW5nKHN0cikpIHN0ciA9IFN0cmluZyhzdHIpOw0KICAgIHZhciBzdHJMZW4gPSBzdHIubGVuZ3RoOw0KICAgIGlmIChsZW4gPT0gbnVsbCB8fCBsZW4gPD0gc3RyTGVuKSByZXR1cm4gc3RyOw0KICAgIHJldHVybiBjcmVhdGVQYWRkaW5nKGxlbiAtIHN0ckxlbiwgY2hycykgKyBzdHI7DQogIH0NCg0KICBmdW5jdGlvbiBwYWRFbmQoc3RyLCBsZW4sIGNocnMpIHsNCiAgICBpZiAoIWlzU3RyaW5nKHN0cikpIHN0ciA9IFN0cmluZyhzdHIpOw0KICAgIHZhciBzdHJMZW4gPSBzdHIubGVuZ3RoOw0KICAgIGlmIChsZW4gPT0gbnVsbCB8fCBsZW4gPD0gc3RyTGVuKSByZXR1cm4gc3RyOw0KICAgIHJldHVybiBzdHIgKyBjcmVhdGVQYWRkaW5nKGxlbiAtIHN0ckxlbiwgY2hycyk7DQogIH0NCg0KICBmdW5jdGlvbiBzdGFydHNXaXRoKHN0ciwgdGFyZ2V0LCBwb3MpIHsNCiAgICByZXR1cm4gc3RyLnN1YnN0cighcG9zIHx8IHBvcyA8IDAgPyAwIDogK3BvcywgdGFyZ2V0Lmxlbmd0aCkgPT0gdGFyZ2V0Ow0KICB9DQoNCiAgZnVuY3Rpb24gZW5kc1dpdGgoc3RyLCB0YXJnZXQsIHRoaXNfbGVuKSB7DQogICAgaWYgKHRoaXNfbGVuID09IG51bGwgfHwgdGhpc19sZW4gPiBzdHIubGVuZ3RoKSB0aGlzX2xlbiA9IHN0ci5sZW5ndGg7DQogICAgcmV0dXJuIHN0ci5zdWJzdHJpbmcodGhpc19sZW4gLSB0YXJnZXQubGVuZ3RoLCB0aGlzX2xlbikgPT0gdGFyZ2V0Ow0KICB9DQoNCiAgZnVuY3Rpb24gZWFjaE1hdGNoKHN0ciwgcGF0dGVybiwgZm4pIHsNCiAgICBpZiAoIWlzU3RyaW5nKHN0cikgfHwgIWlzUmVnRXhwKHBhdHRlcm4pKSB7DQogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdpbnZhbGlkIGFyZ3VtZW50cycpOw0KICAgIH0NCiAgICBpZiAoIXBhdHRlcm4uZ2xvYmFsKSB7DQogICAgICBwYXR0ZXJuID0gUmVnRXhwKHBhdHRlcm4uc291cmNlLCAnZycpOw0KICAgIH0NCiAgICB2YXIgbWF0Y2g7DQogICAgZm9yICg7Oykgew0KICAgICAgbWF0Y2ggPSBwYXR0ZXJuLmV4ZWMoc3RyKTsNCiAgICAgIGlmICghbWF0Y2gpIGJyZWFrOw0KICAgICAgaWYgKGFwcGx5KGZuLCBudWxsLCBtYXRjaCkgPT09IGZhbHNlKSBicmVhazsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBmaW5kQWxsKHN0ciwgcGF0dGVybikgew0KICAgIHZhciByc3QgPSBbXTsNCiAgICBlYWNoTWF0Y2goc3RyLCBwYXR0ZXJuLCBmdW5jdGlvbiAoKSAgew0KICAgICAgcnN0LnB1c2goYXJndW1lbnRzLmxlbmd0aCA9PSAxID8gYXJndW1lbnRzWzBdIDogYXJndW1lbnRzKTsNCiAgICB9KTsNCiAgICByZXR1cm4gcnN0Ow0KICB9CgogIHZhciB0b29sID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgY2hyOiBjaHIsCiAgICBvcmQ6IG9yZCwKICAgIGhleDogaGV4LAogICAgYmluOiBiaW4sCiAgICBvY3Q6IG9jdCwKICAgIGludDogaW50LAogICAgZ2V0RnVuY05hbWU6IGdldEZ1bmNOYW1lLAogICAgZ2V0VGFnOiBnZXRUYWcsCiAgICB0eXBlT2Y6IHR5cGVPZiwKICAgIHR5cGU6IHR5cGUsCiAgICBoYXM6IGhhcywKICAgIGlzQXJyYXk6IGlzQXJyYXksCiAgICBpc09iamVjdDogaXNPYmplY3QsCiAgICBpc0Z1bmN0aW9uOiBpc0Z1bmN0aW9uLAogICAgaXNTdHJpbmc6IGlzU3RyaW5nLAogICAgaXNOdW1iZXI6IGlzTnVtYmVyLAogICAgaXNCb29sZWFuOiBpc0Jvb2xlYW4sCiAgICBpc0RhdGU6IGlzRGF0ZSwKICAgIGlzUmVnRXhwOiBpc1JlZ0V4cCwKICAgIGlzRXJyb3I6IGlzRXJyb3IsCiAgICBpc01hcDogaXNNYXAsCiAgICBpc1NldDogaXNTZXQsCiAgICBpc1dlYWtNYXA6IGlzV2Vha01hcCwKICAgIGlzSW50ZWdlcjogaXNJbnRlZ2VyLAogICAgaXNBcmd1bWVudHM6IGlzQXJndW1lbnRzLAogICAgaXNPYmplY3RMaWtlOiBpc09iamVjdExpa2UsCiAgICBpc0xlbmd0aDogaXNMZW5ndGgsCiAgICBpc0FycmF5TGlrZTogaXNBcnJheUxpa2UsCiAgICBpc0VtcHR5OiBpc0VtcHR5LAogICAgaXNCdWZmZXI6IGlzQnVmZmVyLAogICAgYXBwbHk6IGFwcGx5LAogICAgcmFuZ2U6IHJhbmdlLAogICAgdG9QYXRoOiB0b1BhdGgsCiAgICBpZGVudGl0eTogaWRlbnRpdHksCiAgICBpdGVyYXRlZTogaXRlcmF0ZWUsCiAgICB0aW1laXQ6IHRpbWVpdCwKICAgIGVhY2g6IGVhY2gsCiAgICBmb3JFYWNoOiBmb3JFYWNoLAogICAgbWFwOiBtYXAsCiAgICBzZWxlY3Q6IHNlbGVjdCwKICAgIHJlZHVjZTogcmVkdWNlLAogICAgZmlsdGVyOiBmaWx0ZXIsCiAgICB3aGVyZTogd2hlcmUsCiAgICB0b0FycmF5OiB0b0FycmF5LAogICAgZmluZDogZmluZCwKICAgIGZpbmRJbmRleDogZmluZEluZGV4LAogICAgZmlsbDogZmlsbCwKICAgIGdyb3VwQnk6IGdyb3VwQnksCiAgICBjb3VudEJ5OiBjb3VudEJ5LAogICAgc2l6ZTogc2l6ZSwKICAgIGxlbjogbGVuLAogICAgdW5pcUJ5OiB1bmlxQnksCiAgICB1bmlxOiB1bmlxLAogICAgZGlzdGluY3Q6IGRpc3RpbmN0LAogICAgZGlzdGluY3RCeTogZGlzdGluY3RCeSwKICAgIGNodW5rOiBjaHVuaywKICAgIGNvbmNhdDogY29uY2F0LAogICAgc2xpY2U6IHNsaWNlLAogICAgZHJvcDogZHJvcCwKICAgIHRhaWw6IHRhaWwsCiAgICBpbml0aWFsOiBpbml0aWFsLAogICAgdGFrZTogdGFrZSwKICAgIHRha2VSaWdodDogdGFrZVJpZ2h0LAogICAgY29udGFpbnM6IGNvbnRhaW5zLAogICAgaW5jbHVkZTogaW5jbHVkZSwKICAgIGluY2x1ZGVzOiBpbmNsdWRlcywKICAgIGZpcnN0OiBmaXJzdCwKICAgIGhlYWQ6IGhlYWQsCiAgICBsYXN0OiBsYXN0LAogICAgbnRoOiBudGgsCiAgICBwdWxsQWxsOiBwdWxsQWxsLAogICAgcHVsbDogcHVsbCwKICAgIHJlbW92ZTogcmVtb3ZlLAogICAgZGlmZmVyZW5jZTogZGlmZmVyZW5jZSwKICAgIHVuemlwOiB1bnppcCwKICAgIHppcDogemlwLAogICAgZmxhdHRlbjogZmxhdHRlbiwKICAgIGtleXM6IGtleXMsCiAgICB2YWx1ZXM6IHZhbHVlcywKICAgIGtleXNJbjoga2V5c0luLAogICAgdmFsdWVzSW46IHZhbHVlc0luLAogICAgemlwT2JqZWN0OiB6aXBPYmplY3QsCiAgICBmcm9tUGFpcnM6IGZyb21QYWlycywKICAgIG9iamVjdDogb2JqZWN0LAogICAgZ2V0OiBnZXQsCiAgICBhdDogYXQsCiAgICBwcm9wZXJ0eU9mOiBwcm9wZXJ0eU9mLAogICAgcHJvcGVydHk6IHByb3BlcnR5LAogICAgcHJvcGVydGllczogcHJvcGVydGllcywKICAgIHNldDogc2V0LAogICAgdW5zZXQ6IHVuc2V0LAogICAgdXBkYXRlOiB1cGRhdGUsCiAgICBwaWNrOiBwaWNrLAogICAgaXNNYXRjaDogaXNNYXRjaCwKICAgIG1hdGNoZXM6IG1hdGNoZXMsCiAgICBtYXRjaGVyOiBtYXRjaGVyLAogICAgYXNzaWduOiBhc3NpZ24sCiAgICBhc3NpZ25JbjogYXNzaWduSW4sCiAgICBleHRlbmQ6IGV4dGVuZCwKICAgIGRlZmF1bHRzOiBkZWZhdWx0cywKICAgIGVudHJpZXM6IGVudHJpZXMsCiAgICB0b1BhaXJzOiB0b1BhaXJzLAogICAgbWVtb2l6ZTogbWVtb2l6ZSwKICAgIHBhcnRpYWw6IHBhcnRpYWwsCiAgICBjdXJyeTogY3VycnksCiAgICBhcnk6IGFyeSwKICAgIHdyYXA6IHdyYXAsCiAgICByYW5kb206IHJhbmRvbSwKICAgIHN1bTogc3VtLAogICAgYXZlcmFnZTogYXZlcmFnZSwKICAgIGF2ZzogYXZnLAogICAgcm91bmQ6IHJvdW5kLAogICAgZmxvb3I6IGZsb29yLAogICAgY2VpbDogY2VpbCwKICAgIHJhZGlhbnM6IHJhZGlhbnMsCiAgICB0b1VwcGVyOiB0b1VwcGVyLAogICAgdG9Mb3dlcjogdG9Mb3dlciwKICAgIHRyaW06IHRyaW0sCiAgICByZXBlYXQ6IHJlcGVhdCwKICAgIHBhZFN0YXJ0OiBwYWRTdGFydCwKICAgIHBhZEVuZDogcGFkRW5kLAogICAgc3RhcnRzV2l0aDogc3RhcnRzV2l0aCwKICAgIGVuZHNXaXRoOiBlbmRzV2l0aCwKICAgIGVhY2hNYXRjaDogZWFjaE1hdGNoLAogICAgZmluZEFsbDogZmluZEFsbAogIH0pOwoKICBmdW5jdGlvbiBpbmhlcml0cyhjdG9yLCBzdXBlckN0b3IpIHsNCiAgICBjdG9yLnN1cGVyXyA9IHN1cGVyQ3RvcjsNCiAgICBjdG9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDdG9yLnByb3RvdHlwZSwgew0KICAgICAgY29uc3RydWN0b3I6IGN0b3INCiAgICB9KTsNCiAgfQ0KDQogIHZhciBGTVRfUkVHID0gLyVbc2RpZmpvTyVdL2c7DQoNCiAgZnVuY3Rpb24gZm9ybWF0KGYpIHsNCiAgICBpZiAoIWlzU3RyaW5nKGYpKSB7DQogICAgICByZXR1cm4gbWFwKGFyZ3VtZW50cywgZnVuY3Rpb24oIGFyZyApe3JldHVybiAgaW5zcGVjdChhcmcpfSkuam9pbignICcpOw0KICAgIH0NCg0KICAgIHZhciBpID0gMSwNCiAgICAgIGFyZ3MgPSBhcmd1bWVudHMsDQogICAgICBsZW4gPSBhcmdzLmxlbmd0aCwNCiAgICAgIHN0ciA9IGYucmVwbGFjZShGTVRfUkVHLCBmdW5jdGlvbiggeCApIHsNCiAgICAgICAgaWYgKHggPT09ICclJScpIHJldHVybiAnJSc7DQogICAgICAgIGlmIChpID49IGxlbikgcmV0dXJuIHg7DQogICAgICAgIHN3aXRjaCAoeCkgew0KICAgICAgICAgIGNhc2UgJyVzJzoNCiAgICAgICAgICBjYXNlICclZCc6DQogICAgICAgICAgY2FzZSAnJWknOg0KICAgICAgICAgIGNhc2UgJyVmJzoNCiAgICAgICAgICAgIHJldHVybiBhcmdzW2krK107DQogICAgICAgICAgY2FzZSAnJWonOg0KICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGFyZ3NbaSsrXSk7DQogICAgICAgICAgY2FzZSAnJW8nOg0KICAgICAgICAgIGNhc2UgJyVPJzoNCiAgICAgICAgICAgIHJldHVybiBpbnNwZWN0KGFyZ3NbaSsrXSk7DQogICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgIHJldHVybiB4Ow0KICAgICAgICB9DQogICAgICB9KTsNCiAgICBmb3IgKHZhciB4ID0gYXJnc1tpXTsgaSA8IGxlbjsgeCA9IGFyZ3NbKytpXSkgew0KICAgICAgaWYgKGlzUHJpbWl0aXZlKHgpKSBzdHIgKz0gJyAnICsgeDsNCiAgICAgIGVsc2Ugc3RyICs9ICcgJyArIGluc3BlY3QoeCk7DQogICAgfQ0KICAgIHJldHVybiBzdHI7DQogIH0NCg0KDQoNCg0KICBmdW5jdGlvbiBkZXByZWNhdGUoZm4sIG1zZykgew0KICAgIA0KICAgIGlmIChnbG9iYWwucHJvY2VzcyA9PT0gdm9pZCAwKSB7DQogICAgICByZXR1cm4gZnVuY3Rpb24gKCkge3JldHVybiAgYXBwbHkoZGVwcmVjYXRlKGZuLCBtc2cpLCBudWxsLCBhcmd1bWVudHMpfTsNCiAgICB9DQoNCiAgICBpZiAocHJvY2Vzcy5ub0RlcHJlY2F0aW9uID09PSB0cnVlKSByZXR1cm4gZm47DQoNCiAgICB2YXIgd2FybmVkID0gZmFsc2U7DQoNCiAgICBmdW5jdGlvbiBkZXByZWNhdGVkKCkgew0KICAgICAgaWYgKCF3YXJuZWQpIHsNCiAgICAgICAgaWYgKHByb2Nlc3MudGhyb3dEZXByZWNhdGlvbikgdGhyb3cgbmV3IEVycm9yKG1zZyk7DQogICAgICAgIGVsc2UgaWYgKHByb2Nlc3MudHJhY2VEZXByZWNhdGlvbikgY29uc29sZS5sb2cobXNnKTsNCiAgICAgICAgZWxzZSBjb25zb2xlLmxvZyhtc2cpOw0KICAgICAgICB3YXJuZWQgPSB0cnVlOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIGFwcGx5KGZuLCBudWxsLCBhcmd1bWVudHMpOw0KICAgIH0NCg0KICAgIHJldHVybiBkZXByZWNhdGVkOw0KICB9DQoNCiAgdmFyIGRlYnVncyA9IHt9Ow0KICB2YXIgZGVidWdFbnZpcm9uOw0KDQogIGZ1bmN0aW9uIGRlYnVnbG9nKHNldCkgew0KICAgIGlmIChkZWJ1Z0Vudmlyb24gPT0gbnVsbCkgZGVidWdFbnZpcm9uID0gcHJvY2Vzcy5lbnYuTk9ERV9ERUJVRyB8fCAnJzsNCiAgICBzZXQgPSBzZXQudG9VcHBlckNhc2UoKTsNCiAgICBpZiAoIWRlYnVnc1tzZXRdKSB7DQogICAgICBpZiAobmV3IFJlZ0V4cCgnXFxiJyArIHNldCArICdcXGInLCAnaScpLnRlc3QoZGVidWdFbnZpcm9uKSkgew0KICAgICAgICB2YXIgcGlkID0gcHJvY2Vzcy5waWQ7DQogICAgICAgIGRlYnVnc1tzZXRdID0gZnVuY3Rpb24gKCkgIHsNCiAgICAgICAgICB2YXIgbXNnID0gYXBwbHkoZm9ybWF0LCBudWxsLCBhcmd1bWVudHMpOw0KICAgICAgICAgIGNvbnNvbGUubG9nKCclcyAlZDogJXMnLCBzZXQsIHBpZCwgbXNnKTsNCiAgICAgICAgfTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGRlYnVnc1tzZXRdID0gZnVuY3Rpb24oKSB7fTsNCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIGRlYnVnc1tzZXRdOw0KICB9DQoNCg0KICBmdW5jdGlvbiBpbnNwZWN0KG9iaiwgc2hvd0hpZGRlbiwgZGVwdGgsIGNvbG9ycykgew0KICAgIA0KICAgIHZhciBjdHggPSB7DQogICAgICBzZWVuOiBbXSwNCiAgICAgIA0KICAgICAgc2hvd0hpZGRlbjogZmFsc2UsDQogICAgICBkZXB0aDogMiwNCiAgICAgIGNvbG9yczogZmFsc2UsDQogICAgICBjdXN0b21JbnNwZWN0OiBmYWxzZSwNCiAgICAgIG1heEFycmF5TGVuZ3RoOiAxMDAsDQogICAgICBicmVha0xlbmd0aDogNjANCiAgICB9Ow0KICAgIGlmIChpc0Jvb2xlYW4oc2hvd0hpZGRlbikpIGN0eC5zaG93SGlkZGVuID0gc2hvd0hpZGRlbjsNCiAgICBpZiAoaXNOdW1iZXIoZGVwdGgpKSBjdHguZGVwdGggPSBkZXB0aDsNCiAgICBpZiAoaXNCb29sZWFuKGNvbG9ycykpIGN0eC5jb2xvcnMgPSBjb2xvcnM7DQogICAgaWYgKGlzT2JqZWN0KHNob3dIaWRkZW4pKSB7DQogICAgICANCiAgICAgIE9iamVjdC5hc3NpZ24oY3R4LCBzaG93SGlkZGVuKTsNCiAgICB9DQogICAgcmV0dXJuIGZvcm1hdFZhbHVlKGN0eCwgb2JqLCAwKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGZvcm1hdFZhbHVlKGN0eCwgdmFsdWUsIHJlY3Vyc2VUaW1lcykgew0KICAgIHZhciByZXN1bHQ7DQogICAgDQogICAgDQogICAgaWYgKA0KICAgICAgY3R4LmN1c3RvbUluc3BlY3QgJiYNCiAgICAgIHZhbHVlICYmDQogICAgICBpc0Z1bmN0aW9uKHZhbHVlLmluc3BlY3QpICYmDQogICAgICANCiAgICAgIHZhbHVlLmluc3BlY3QgIT09IGluc3BlY3QgJiYNCiAgICAgIA0KICAgICAgISh2YWx1ZS5jb25zdHJ1Y3RvciAmJiB2YWx1ZS5jb25zdHJ1Y3Rvci5wcm90b3R5cGUgPT09IHZhbHVlKQ0KICAgICkgew0KICAgICAgcmVzdWx0ID0gdmFsdWUuaW5zcGVjdChyZWN1cnNlVGltZXMsIGN0eCk7DQogICAgICBpZiAoIWlzU3RyaW5nKHJlc3VsdCkpIHsNCiAgICAgICAgcmVzdWx0ID0gZm9ybWF0VmFsdWUoY3R4LCByZXN1bHQsIHJlY3Vyc2VUaW1lcyk7DQogICAgICB9DQogICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIA0KICAgIHJlc3VsdCA9IGZvcm1hdFZhbHVlX3NpbXBsZSh2YWx1ZSk7DQogICAgaWYgKHJlc3VsdCAhPT0gZmFsc2UpIHJldHVybiByZXN1bHQ7DQoNCiAgICANCiAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKHZhbHVlKTsNCiAgICB2YXIgdmlzaWJsZUtleXMgPSBrZXlzLnJlZHVjZSggZnVuY3Rpb24obWVtbywga2V5KSB7cmV0dXJuICAoKG1lbW9ba2V5XSA9IHRydWUpLCBtZW1vKX0sIHt9KTsNCg0KICAgIGlmIChjdHguc2hvd0hpZGRlbikgew0KICAgICAga2V5cyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHZhbHVlKTsNCiAgICB9DQoNCiAgICBpZiAocmVjdXJzZVRpbWVzID4gY3R4LmRlcHRoKSByZXR1cm4gZ2V0VGFnKHZhbHVlKTsNCg0KICAgIGN0eC5zZWVuLnB1c2godmFsdWUpOw0KDQogICAgdmFyIG91dHB1dCwNCiAgICAgIHZUeXBlID0gdHlwZU9mKHZhbHVlKTsNCiAgICBvdXRwdXQgPSBmb3JtYXRPYmplY3QoY3R4LCB2YWx1ZSwgcmVjdXJzZVRpbWVzLCB2aXNpYmxlS2V5cywga2V5cywgdlR5cGUpOw0KICAgIGN0eC5zZWVuLnBvcCgpOw0KDQogICAgcmV0dXJuIHJlZHVjZVRvU2luZ2xlU3RyaW5nKGN0eCwgb3V0cHV0LCByZWN1cnNlVGltZXMsIHZUeXBlKTsNCiAgfQ0KDQogIHZhciBFU0NBUFNFX01BUCA9IHsNCiAgICAiJyI6ICInIiwNCiAgICAnXFwnOiAnXFwnLA0KICAgICdccic6ICdyJywNCiAgICAnXG4nOiAnbicsDQogICAgJ1x1MjAyOCc6ICd1MjAyOCcsDQogICAgJ1x1MjAyOSc6ICd1MjAyOScNCiAgfTsNCg0KICB2YXIgRVNDQVBTRV9SRUcgPSAvJ3xcXHxccnxcbnxcdTIwMjh8XHUyMDI5XS9nOw0KDQogIGZ1bmN0aW9uIGVzY2FwZUNoYXIoYykgew0KICAgIHJldHVybiAnXFwnICsgRVNDQVBTRV9NQVBbY107DQogIH0NCg0KICBmdW5jdGlvbiBmb3JtYXRWYWx1ZV9zaW1wbGUodmFsdWUpIHsNCiAgICBpZiAodmFsdWUgPT09IHZvaWQgMCkgcmV0dXJuICd1bmRlZmluZWQnOw0KICAgIGlmICh2YWx1ZSA9PT0gbnVsbCkgcmV0dXJuICdudWxsJzsNCiAgICBzd2l0Y2ggKHR5cGVPZih2YWx1ZSkpIHsNCiAgICAgIGNhc2UgJ3N0cmluZyc6DQogICAgICAgIHJldHVybiAiJyIgKyB2YWx1ZS5yZXBsYWNlKEVTQ0FQU0VfUkVHLCBlc2NhcGVDaGFyKSArICInIjsNCiAgICAgIGNhc2UgJ251bWJlcic6DQogICAgICBjYXNlICdib29sZWFuJzoNCiAgICAgIGNhc2UgJ3JlZ2V4cCc6DQogICAgICAgIHJldHVybiBTdHJpbmcodmFsdWUpOw0KICAgICAgY2FzZSAnZGF0ZSc6DQogICAgICAgIHJldHVybiB2YWx1ZS50b0pTT04oKTsNCiAgICAgIGNhc2UgJ2Z1bmN0aW9uJzogew0KICAgICAgICB2YXIgbmFtZSA9IGdldEZ1bmNOYW1lKHZhbHVlKTsNCiAgICAgICAgcmV0dXJuIG5hbWUgPyAnW0Z1bmN0aW9uOiAnICsgbmFtZSArICddJyA6ICdbRnVuY3Rpb25dJzsNCiAgICAgIH0NCiAgICAgIGNhc2UgJ2Vycm9yJzoNCiAgICAgICAgcmV0dXJuICdbJyArIHZhbHVlICsgJ10nOw0KICAgICAgY2FzZSAnYnVmZmVyJzogew0KICAgICAgICB2YXIgYnl0ZXMgPSB2YWx1ZS5idWZmZXIsDQogICAgICAgICAgbGVuID0gdmFsdWUubGVuZ3RoLA0KICAgICAgICAgIGkgPSAtMSwNCiAgICAgICAgICBvdmVyZmxvdywNCiAgICAgICAgICBhcnI7DQogICAgICAgIGlmIChsZW4gPiA1MCkgew0KICAgICAgICAgIG92ZXJmbG93ID0gdHJ1ZTsNCiAgICAgICAgICBsZW4gPSA1MDsNCiAgICAgICAgICBhcnIgPSBBcnJheSg1MSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgYXJyID0gQXJyYXkobGVuKTsNCiAgICAgICAgfQ0KICAgICAgICB3aGlsZSAoKytpIDwgbGVuKSBhcnJbaV0gPSBoZXgoYnl0ZXMuZ2V0SXRlbShpKSk7DQogICAgICAgIGlmIChvdmVyZmxvdykgYXJyWzUwXSA9ICcuLi4nOw0KICAgICAgICByZXR1cm4gJzxCdWZmZXIgJyArIGFyci5qb2luKCcgJykgKyAnPic7DQogICAgICB9DQogICAgICBkZWZhdWx0Og0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gZm9ybWF0T2JqZWN0KGN0eCwgb2JqLCByZWN1cnNlVGltZXMsIHZpc2libGVLZXlzLCBrZXlzLCB2VHlwZSkgew0KICAgIHZhciBvdXRwdXQgPSBbXSwNCiAgICAgIGkgPSAwLA0KICAgICAgbGVuLA0KICAgICAga2V5Ow0KICAgIGlmICh2VHlwZSA9PSAnYXJyYXknKSB7DQogICAgICBsZW4gPSBvYmoubGVuZ3RoOw0KICAgICAgZm9yICg7IGkgPCBsZW47IGkrKykgew0KICAgICAgICBpZiAoaSA+PSBjdHgubWF4QXJyYXlMZW5ndGgpIHsNCiAgICAgICAgICBvdXRwdXQucHVzaCgnLi4uICcgKyAobGVuIC0gY3R4Lm1heEFycmF5TGVuZ3RoKSArICcgbW9yZSBpdGVtcycpOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgICAgIG91dHB1dC5wdXNoKGZvcm1hdFByb3BlcnR5KGN0eCwgb2JqW2ldLCByZWN1cnNlVGltZXMsIG51bGwsIHRydWUsIG51bGwpKTsNCiAgICAgIH0NCiAgICAgIGkgPSBsZW47DQogICAgfSBlbHNlIGlmICh2VHlwZSA9PSAnbWFwJykgew0KICAgICAgb2JqLmZvckVhY2goIGZ1bmN0aW9uKHZhbHVlLCBrZXkpICB7DQogICAgICAgIG91dHB1dC5wdXNoKGZvcm1hdFByb3BlcnR5KGN0eCwgdmFsdWUsIHJlY3Vyc2VUaW1lcywga2V5LCB0cnVlLCAnID0+ICcpKTsNCiAgICAgIH0pOw0KICAgIH0gZWxzZSBpZiAodlR5cGUgPT0gJ3NldCcpIHsNCiAgICAgIG9iai5mb3JFYWNoKCBmdW5jdGlvbih2YWx1ZSApIHsNCiAgICAgICAgb3V0cHV0LnB1c2goZm9ybWF0UHJvcGVydHkoY3R4LCB2YWx1ZSwgcmVjdXJzZVRpbWVzLCBudWxsLCB0cnVlLCBudWxsKSk7DQogICAgICB9KTsNCiAgICB9DQoNCiAgICBmb3IgKGxlbiA9IGtleXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCiAgICAgIGtleSA9IGtleXNbaV07DQogICAgICBvdXRwdXQucHVzaCgNCiAgICAgICAgZm9ybWF0UHJvcGVydHkoY3R4LCBvYmpba2V5XSwgcmVjdXJzZVRpbWVzLCBrZXksIHZpc2libGVLZXlzW2tleV0sICc6ICcpDQogICAgICApOw0KICAgIH0NCiAgICByZXR1cm4gb3V0cHV0Ow0KICB9DQoNCiAgZnVuY3Rpb24gZm9ybWF0UHJvcGVydHkoY3R4LCB2YWx1ZSwgcmVjdXJzZVRpbWVzLCBrZXksIGVudW1lcmFibGUsIHNlcCkgew0KICAgIHZhciBuYW1lLCBzdHI7DQoNCiAgICBpZiAoY3R4LnNlZW4uaW5kZXhPZih2YWx1ZSkgPT09IC0xKSB7DQogICAgICBzdHIgPSBmb3JtYXRWYWx1ZShjdHgsIHZhbHVlLCByZWN1cnNlVGltZXMgKyAxKTsNCiAgICB9IGVsc2Ugew0KICAgICAgc3RyID0gJ1tDaXJjdWxhcl0nOw0KICAgIH0NCg0KICAgIGlmIChrZXkgPT0gbnVsbCkgcmV0dXJuIHN0cjsNCg0KICAgIG5hbWUgPSBlbnVtZXJhYmxlID8gU3RyaW5nKGtleSkgOiAnWycgKyBrZXkgKyAnXSc7DQoNCiAgICBpZiAoIS9eXHcrJC8udGVzdChuYW1lKSkgew0KICAgICAgbmFtZSA9ICInIiArIG5hbWUucmVwbGFjZSgvJy9nLCAiXFwnIikgKyAiJyI7DQogICAgfQ0KDQogICAgcmV0dXJuIG5hbWUgKyBzZXAgKyBzdHI7DQogIH0NCg0KICBmdW5jdGlvbiByZWR1Y2VUb1NpbmdsZVN0cmluZyhjdHgsIG91dHB1dCwgcmVjdXJzZVRpbWVzLCB2VHlwZSkgew0KICAgIHZhciBicmFjZXMsDQogICAgICBpbmRlbnQsDQogICAgICBicmVha0xpbmUgPSBmYWxzZSwNCiAgICAgIGxlbiA9IG91dHB1dC5sZW5ndGgsDQogICAgICBpID0gLTEsDQogICAgICBjb3VudCA9IDA7DQogICAgaWYgKHZUeXBlID09ICdhcnJheScpIGJyYWNlcyA9IFsnWycsICddJ107DQogICAgZWxzZSBpZiAodlR5cGUgPT0gJ21hcCcpIGJyYWNlcyA9IFsnTWFwIHsnLCAnfSddOw0KICAgIGVsc2UgaWYgKHZUeXBlID09ICdzZXQnKSBicmFjZXMgPSBbJ1NldCB7JywgJ30nXTsNCiAgICBlbHNlIGlmICh2VHlwZSA9PSAnYXJndW1lbnRzJykgYnJhY2VzID0gWydbQXJndW1lbnRzXSB7JywgJ30nXTsNCiAgICBlbHNlIGJyYWNlcyA9IFsneycsICd9J107DQoNCiAgICBpZiAobGVuID09IDApIHJldHVybiBicmFjZXNbMF0gKyBicmFjZXNbMV07DQoNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICBjb3VudCArPSBvdXRwdXRbaV0ubGVuZ3RoICsgMTsNCiAgICAgIGlmIChjb3VudCA+IGN0eC5icmVha0xlbmd0aCkgew0KICAgICAgICBicmVha0xpbmUgPSB0cnVlOw0KICAgICAgICBicmVhazsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBsZW4gPSBvdXRwdXQucmVkdWNlKCBmdW5jdGlvbihtZW1vLCBjdXIpIHtyZXR1cm4gIG1lbW8gKyBjdXIubGVuZ3RoICsgMX0sIDApOw0KICAgIGluZGVudCA9IHJlcGVhdCgnICAnLCByZWN1cnNlVGltZXMpOw0KICAgIGlmIChicmVha0xpbmUpIHsNCiAgICAgIHJldHVybiB2VHlwZSA9PSAnYXJyYXknDQogICAgICAgID8gYnJhY2VzWzBdICsgJyAnICsgb3V0cHV0LmpvaW4oJyxcclxuICAnICsgaW5kZW50KSArICcgJyArIGJyYWNlc1sxXQ0KICAgICAgICA6IGJyYWNlc1swXSArDQogICAgICAgICAgICAnIFxyXG4gICcgKw0KICAgICAgICAgICAgaW5kZW50ICsNCiAgICAgICAgICAgIG91dHB1dC5qb2luKCcsXHJcbiAgJyArIGluZGVudCkgKw0KICAgICAgICAgICAgJyAnICsNCiAgICAgICAgICAgIGJyYWNlc1sxXTsNCiAgICB9DQogICAgcmV0dXJuIGJyYWNlc1swXSArICcgJyArIG91dHB1dC5qb2luKCcsICcpICsgJyAnICsgYnJhY2VzWzFdOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNQcmltaXRpdmUodmFsdWUpIHsNCiAgICByZXR1cm4gIWlzT2JqZWN0KHZhbHVlKTsNCiAgfQoKICB2YXIgdXRpbCA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgIGluaGVyaXRzOiBpbmhlcml0cywKICAgIGZvcm1hdDogZm9ybWF0LAogICAgZGVwcmVjYXRlOiBkZXByZWNhdGUsCiAgICBkZWJ1Z2xvZzogZGVidWdsb2csCiAgICBpbnNwZWN0OiBpbnNwZWN0LAogICAgaXNQcmltaXRpdmU6IGlzUHJpbWl0aXZlCiAgfSk7CgogIGZ1bmN0aW9uIENvbnNvbGUoc3Rkb3V0LCBzdGRlcnIpIHsNCiAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciAhPT0gQ29uc29sZSkgew0KICAgICAgcmV0dXJuIG5ldyBDb25zb2xlKHN0ZG91dCwgc3RkZXJyKTsNCiAgICB9DQogICAgaWYgKCFzdGRvdXQgfHwgISgnd3JpdGUnIGluIHN0ZG91dCkpIHsNCiAgICAgIHRocm93IG5ldyBFcnJvcignQ29uc29sZSBleHBlY3RzIGEgd3JpdGFibGUgc3RyZWFtIGluc3RhbmNlJyk7DQogICAgfQ0KICAgIGlmICghc3RkZXJyKSB7DQogICAgICBzdGRlcnIgPSBzdGRvdXQ7DQogICAgfQ0KDQogICAgdGhpcy5fc3Rkb3V0ID0gc3Rkb3V0Ow0KICAgIHRoaXMuX3N0ZGVyciA9IHN0ZGVycjsNCiAgICB0aGlzLl90aW1lcyA9IHt9Ow0KDQogICAgDQogICAgZm9yICh2YXIga2V5IGluIENvbnNvbGUucHJvdG90eXBlKSB7DQogICAgICBpZiAoaGFzKENvbnNvbGUucHJvdG90eXBlLCBrZXkpKSB7DQogICAgICAgIHRoaXNba2V5XSA9IHRoaXNba2V5XS5iaW5kKHRoaXMpOw0KICAgICAgfQ0KICAgIH0NCiAgfQ0KDQogIENvbnNvbGUucHJvdG90eXBlLmxvZyA9IGZ1bmN0aW9uKCkgew0KICAgIHRoaXMuX3N0ZG91dC53cml0ZUxpbmUoYXBwbHkoZm9ybWF0LCBudWxsLCBhcmd1bWVudHMpKTsNCiAgfTsNCg0KICBDb25zb2xlLnByb3RvdHlwZS5pbmZvID0gQ29uc29sZS5wcm90b3R5cGUubG9nOw0KDQogIENvbnNvbGUucHJvdG90eXBlLndhcm4gPSBmdW5jdGlvbigpIHsNCiAgICB0aGlzLl9zdGRlcnIud3JpdGVMaW5lKGFwcGx5KGZvcm1hdCwgbnVsbCwgYXJndW1lbnRzKSk7DQogIH07DQoNCiAgQ29uc29sZS5wcm90b3R5cGUuZXJyb3IgPSBDb25zb2xlLnByb3RvdHlwZS53YXJuOw0KDQogIENvbnNvbGUucHJvdG90eXBlLmRpciA9IGZ1bmN0aW9uKG9iamVjdCkgew0KICAgIHRoaXMuX3N0ZG91dC53cml0ZUxpbmUoDQogICAgICBpbnNwZWN0KG9iamVjdCwgew0KICAgICAgICBjdXN0b21JbnNwZWN0OiBmYWxzZQ0KICAgICAgfSkNCiAgICApOw0KICB9Ow0KDQogIENvbnNvbGUucHJvdG90eXBlLnRpbWUgPSBmdW5jdGlvbihsYWJlbCkgew0KICAgIHRoaXMuX3RpbWVzW2xhYmVsXSA9IERhdGUubm93KCk7DQogIH07DQoNCiAgQ29uc29sZS5wcm90b3R5cGUudGltZUVuZCA9IGZ1bmN0aW9uKGxhYmVsKSB7DQogICAgdmFyIHRpbWUgPSB0aGlzLl90aW1lc1tsYWJlbF07DQogICAgaWYgKCF0aW1lKSB7DQogICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHN1Y2ggbGFiZWw6ICcgKyBsYWJlbCk7DQogICAgfQ0KICAgIHZhciBkdXJhdGlvbiA9IERhdGUubm93KCkgLSB0aW1lOw0KICAgIHRoaXMubG9nKCclczogJWRtcycsIGxhYmVsLCBkdXJhdGlvbik7DQogIH07DQoNCiAgQ29uc29sZS5wcm90b3R5cGUuYXNzZXJ0ID0gZnVuY3Rpb24odiApIHsNCiAgICBpZiAoIXYpIHRocm93IG5ldyBFcnJvcihhcHBseShmb3JtYXQsIG51bGwsIHRhaWwoYXJndW1lbnRzKSkpOw0KICB9Ow0KDQogIHdpbmRvdy5jb25zb2xlID0gbmV3IENvbnNvbGUocHJvY2Vzcy5zdGRvdXQsIHByb2Nlc3Muc3RkZXJyKTsKCiAgdmFyIFJPT1RfUkVHRVhQID0gL14oW0Etel06fClbL1xcXS87DQogIHZhciBTRVBfUkVHRVhQID0gL1svXFxdKy87DQogIHZhciBTRVBfUkVHRVhQX0VORCA9IC9bL1xcXSQvOw0KICB2YXIgTE5LX1JFR0VYUCA9IC8oXC5sbmt8XC51cmwpJC87DQoNCiAgdmFyIFNFUCA9ICdcXCc7DQogIHZhciBzZXAgPSBTRVA7DQoNCiAgZnVuY3Rpb24gaXNhYnMocHRoKSB7DQogICAgcmV0dXJuIHB0aCAmJiBST09UX1JFR0VYUC50ZXN0KHB0aCk7DQogIH0NCg0KICB2YXIgaXNBYnNvbHV0ZSA9IGlzYWJzOw0KDQogIGZ1bmN0aW9uIGRpcm5hbWUocHRoKSB7DQogICAgcmV0dXJuIF9fRlNPLkdldFBhcmVudEZvbGRlck5hbWUocHRoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGJhc2VuYW1lKHB0aCwgZXh0KSB7DQogICAgcmV0dXJuIGV4dCA/IF9fRlNPLkdldEJhc2VOYW1lKHB0aCkgOiBfX0ZTTy5HZXRGaWxlTmFtZShwdGgpOw0KICB9DQoNCiAgZnVuY3Rpb24gZXh0bmFtZShwdGgpIHsNCiAgICByZXR1cm4gX19GU08uR2V0RXh0ZW5zaW9uTmFtZShwdGgpOw0KICB9DQoNCiAgZnVuY3Rpb24gYWJzcGF0aChwdGgpIHsNCiAgICBpZiAoIWlzYWJzKHB0aCkpIHB0aCA9IF9fZGlybmFtZSArIFNFUCArIHB0aDsNCiAgICByZXR1cm4gX19GU08uR2V0QWJzb2x1dGVQYXRoTmFtZShwdGgpOw0KICB9DQoNCiAgZnVuY3Rpb24gbm9ybXBhdGgocHRoKSB7DQogICAgdmFyIHBhcnRzID0gcHRoLnNwbGl0KFNFUF9SRUdFWFApLA0KICAgICAgbm9ybVBhcnRzID0gW10sDQogICAgICBsZW4gPSBwYXJ0cy5sZW5ndGgsDQogICAgICBwYXJ0Ow0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsNCiAgICAgIHBhcnQgPSBwYXJ0c1tpXTsNCiAgICAgIGlmIChwYXJ0ID09PSAnLi4nKSBub3JtUGFydHMucG9wKCk7DQogICAgICBlbHNlIGlmIChwYXJ0ID09PSAnLicpIGNvbnRpbnVlOw0KICAgICAgZWxzZSBub3JtUGFydHMucHVzaChwYXJ0KTsNCiAgICB9DQogICAgcmV0dXJuIG5vcm1QYXJ0cy5qb2luKFNFUCk7DQogIH0NCg0KICB2YXIgbm9ybWFsaXplID0gbm9ybXBhdGg7DQoNCiAgZnVuY3Rpb24gam9pbigpIHsNCiAgICB2YXIgcCwNCiAgICAgIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGgsDQogICAgICBwYXJ0cyA9IFtdOw0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsNCiAgICAgIHAgPSBhcmd1bWVudHNbaV07DQogICAgICBpZiAodHlwZW9mIHAgPT09ICdzdHJpbmcnKSBwYXJ0cy5wdXNoKHApOw0KICAgIH0NCiAgICByZXR1cm4gbm9ybXBhdGgocGFydHMuam9pbihTRVApKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlc29sdmUoKSB7DQogICAgdmFyIHAsDQogICAgICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoLA0KICAgICAgcGFydHMgPSBbXTsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7DQogICAgICBwID0gYXJndW1lbnRzW2ldOw0KICAgICAgaWYgKHR5cGVvZiBwID09PSAnc3RyaW5nJykgew0KICAgICAgICBpZiAoUk9PVF9SRUdFWFAudGVzdChwKSkgew0KICAgICAgICAgIHBhcnRzLmxlbmd0aCA9IDA7DQogICAgICAgICAgcGFydHNbMF0gPSBwOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHBhcnRzLnB1c2gocCk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIGFic3BhdGgocGFydHMuam9pbihTRVApKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlbGF0aXZlKGZyb20sIHRvKSB7DQogICAgdmFyIGZyb21fID0gYWJzcGF0aChmcm9tKS50b0xvd2VyQ2FzZSgpLA0KICAgICAgdG9fID0gYWJzcGF0aCh0bykudG9Mb3dlckNhc2UoKSwNCiAgICAgIGZyb21QYXJ0cyA9IGZyb21fLnNwbGl0KFNFUF9SRUdFWFApLA0KICAgICAgdG9QYXJ0cyA9IHRvXy5zcGxpdChTRVBfUkVHRVhQKSwNCiAgICAgIGxlbiA9IE1hdGgubWluKGZyb21QYXJ0cy5sZW5ndGgsIHRvUGFydHMubGVuZ3RoKSwNCiAgICAgIHNhbWVQYXJ0c0xlbiA9IGxlbiwNCiAgICAgIGkgPSAtMTsNCg0KICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgIGlmIChmcm9tUGFydHNbaV0gIT09IHRvUGFydHNbaV0pIHsNCiAgICAgICAgc2FtZVBhcnRzTGVuID0gaTsNCiAgICAgICAgYnJlYWs7DQogICAgICB9DQogICAgfQ0KDQogICAgaWYgKHNhbWVQYXJ0c0xlbiA9PSAwKSByZXR1cm4gdG87DQoNCiAgICB2YXIgb3V0cHV0UGFydHMgPSBbXTsNCiAgICBmb3IgKGkgPSBzYW1lUGFydHNMZW47IGkgPCBmcm9tUGFydHMubGVuZ3RoOyBpKyspIHsNCiAgICAgIG91dHB1dFBhcnRzLnB1c2goJy4uJyk7DQogICAgfQ0KDQogICAgb3V0cHV0UGFydHMgPSBvdXRwdXRQYXJ0cy5jb25jYXQodG9QYXJ0cy5zbGljZShzYW1lUGFydHNMZW4pKTsNCg0KICAgIHJldHVybiBvdXRwdXRQYXJ0cy5qb2luKFNFUCk7DQogIH0NCg0KICBmdW5jdGlvbiBpc2ZpbGUocHRoKSB7DQogICAgcmV0dXJuIF9fRlNPLkZpbGVFeGlzdHMocHRoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzZGlyKHB0aCkgew0KICAgIHJldHVybiBfX0ZTTy5Gb2xkZXJFeGlzdHMocHRoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGV4aXN0cyhwdGgpIHsNCiAgICByZXR1cm4gaXNmaWxlKHB0aCkgfHwgaXNkaXIocHRoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNyZWF0ZVNob3J0Y3V0KHB0aCwgb3B0aW9ucykgew0KICAgIHZhciBzaG9ydGN1dCA9IF9fV1NoZWxsLkNyZWF0ZVNob3J0Y3V0KHB0aCk7DQogICAgaWYgKG9wdGlvbnMudGFyZ2V0KSBzaG9ydGN1dC5UYXJnZXRQYXRoID0gb3B0aW9ucy50YXJnZXQ7DQogICAgaWYgKG9wdGlvbnMucnVuU3R5bGUpIHNob3J0Y3V0LldpbmRvd1N0eWxlID0gb3B0aW9ucy5ydW5TdHlsZTsgDQogICAgaWYgKG9wdGlvbnMuZGVzYykgc2hvcnRjdXQuRGVzY3JpcHRpb24gPSBvcHRpb25zLmRlc2M7DQogICAgc2hvcnRjdXQuU2F2ZSgpOw0KICB9DQoNCiAgZnVuY3Rpb24gZ2V0U2hvcnRjdXRUYXJnZXQocHRoKSB7DQogICAgdmFyIHNob3J0Y3V0ID0gX19XU2hlbGwuQ3JlYXRlU2hvcnRjdXQocHRoKTsNCiAgICByZXR1cm4gc2hvcnRjdXQuVGFyZ2V0UGF0aDsNCiAgfQ0KDQogIHZhciBGSUxFX1BST1RPID0gew0KICAgIGlzZmlsZTogZnVuY3Rpb24oKSB7DQogICAgICByZXR1cm4gKHRoaXMuX2ZpbGUuQXR0cmlidXRlcyAmIDE2KSA9PSAwOw0KICAgIH0sDQogICAgaXNGaWxlOiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiAodGhpcy5fZmlsZS5BdHRyaWJ1dGVzICYgMTYpID09IDA7DQogICAgfSwNCiAgICBpc2RpcjogZnVuY3Rpb24oKSB7DQogICAgICByZXR1cm4gKHRoaXMuX2ZpbGUuQXR0cmlidXRlcyAmIDE2KSA9PSAxNjsNCiAgICB9LA0KICAgIGlzRGlyZWN0b3J5OiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiAodGhpcy5fZmlsZS5BdHRyaWJ1dGVzICYgMTYpID09IDE2Ow0KICAgIH0sDQogICAgaXNTaG9ydGN1dDogZnVuY3Rpb24oKSB7DQogICAgICByZXR1cm4gdGhpcy5pc0ZpbGUoKSAmJiBMTktfUkVHRVhQLnRlc3QodGhpcy5wYXRoKTsNCiAgICB9LA0KICAgIGNyZWF0ZVNob3J0Y3V0OiBmdW5jdGlvbihwdGgsIG9wdGlvbnMpIHsNCiAgICAgIG9wdGlvbnMudGFyZ2V0ID0gdGhpcy5wYXRoOw0KICAgICAgY3JlYXRlU2hvcnRjdXQocHRoLCBvcHRpb25zKTsNCiAgICB9LA0KICAgIGNvcHk6IGZ1bmN0aW9uKGRzdCwgb3cpIHsNCiAgICAgIGlmICghaXNhYnMoZHN0KSkgZHN0ID0gYWJzcGF0aChkc3QpOw0KICAgICAgaWYgKCFTRVBfUkVHRVhQX0VORC50ZXN0KGRzdCkpIGRzdCArPSBTRVA7DQogICAgICBpZiAoIWlzZGlyKGRzdCkpIG1rZGlycyhkc3QpOw0KICAgICAgcmV0dXJuIHRoaXMuX2ZpbGUuQ29weShkc3QsIG93ID09IG51bGwgPyB0cnVlIDogISFvdyk7DQogICAgfSwNCiAgICBkZWxldGU6IGZ1bmN0aW9uKGZvcmNlKSB7DQogICAgICByZXR1cm4gdGhpcy5fZmlsZS5EZWxldGUoISFmb3JjZSk7DQogICAgfSwNCiAgICBtb3ZlOiBmdW5jdGlvbihkc3QpIHsNCiAgICAgIGlmICghaXNhYnMoZHN0KSkgZHN0ID0gYWJzcGF0aChkc3QpOw0KICAgICAgaWYgKCFTRVBfUkVHRVhQX0VORC50ZXN0KGRzdCkpIGRzdCArPSBTRVA7DQogICAgICBpZiAoIWlzZGlyKGRzdCkpIG1rZGlycyhkc3QpOw0KICAgICAgcmV0dXJuIHRoaXMuX2ZpbGUuTW92ZShkc3QpOw0KICAgIH0sDQogICAgZ2V0Q2hpbGRyZW46IGZ1bmN0aW9uKCkgew0KICAgICAgdmFyIHNlbGYgPSB0aGlzLmlzU2hvcnRjdXQoKSA/IGdldFN0YXRzKHRoaXMudGFyZ2V0KSA6IHRoaXM7DQogICAgICBpZiAoc2VsZi5pc0ZpbGUoKSkgcmV0dXJuIG51bGw7DQogICAgICB2YXIgX2VudW0gPSBuZXcgRW51bWVyYXRvcihzZWxmLl9maWxlLkZpbGVzKTsNCiAgICAgIHZhciByc3QgPSBbXTsNCiAgICAgIGZvciAoOyAhX2VudW0uYXRFbmQoKTsgX2VudW0ubW92ZU5leHQoKSkgew0KICAgICAgICByc3QucHVzaChnZXRTdGF0cyhfZW51bS5pdGVtKCkpKTsNCiAgICAgIH0NCiAgICAgIF9lbnVtID0gbmV3IEVudW1lcmF0b3Ioc2VsZi5fZmlsZS5TdWJGb2xkZXJzKTsNCiAgICAgIGZvciAoOyAhX2VudW0uYXRFbmQoKTsgX2VudW0ubW92ZU5leHQoKSkgew0KICAgICAgICByc3QucHVzaChnZXRTdGF0cyhfZW51bS5pdGVtKCkpKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiByc3Q7DQogICAgfQ0KICB9Ow0KDQogIHZhciBGSUxFX1BST1BTID0gew0KICAgIF9maWxlOiB7DQogICAgICB2YWx1ZTogbnVsbCwNCiAgICAgIHdyaXRhYmxlOiB0cnVlDQogICAgfSwNCiAgICBuYW1lOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuX2ZpbGUuTmFtZTsNCiAgICAgIH0sDQogICAgICBzZXQ6IGZ1bmN0aW9uKHYpIHsNCiAgICAgICAgdGhpcy5fZmlsZS5OYW1lID0gdjsNCiAgICAgIH0NCiAgICB9LA0KICAgIHBhdGg6IHsNCiAgICAgIGVudW1lcmFibGU6IHRydWUsDQogICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5fZmlsZS5QYXRoOw0KICAgICAgfQ0KICAgIH0sDQogICAgZGlybmFtZTogew0KICAgICAgZW51bWVyYWJsZTogdHJ1ZSwNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB0aGlzLl9maWxlLlBhcmVudEZvbGRlci5QYXRoOw0KICAgICAgfQ0KICAgIH0sDQogICAgc2l6ZTogew0KICAgICAgZW51bWVyYWJsZTogdHJ1ZSwNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB0aGlzLl9maWxlLlNpemU7DQogICAgICB9DQogICAgfSwNCiAgICB0eXBlOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuX2ZpbGUuVHlwZTsNCiAgICAgIH0NCiAgICB9LA0KICAgIHRhcmdldDogew0KICAgICAgZW51bWVyYWJsZTogdHJ1ZSwNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB0aGlzLmlzU2hvcnRjdXQoKSA/IGdldFNob3J0Y3V0VGFyZ2V0KHRoaXMucGF0aCkgOiBudWxsOw0KICAgICAgfQ0KICAgIH0sDQogICAgYXRpbWU6IHsNCiAgICAgIGVudW1lcmFibGU6IHRydWUsDQogICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gbmV3IERhdGUodGhpcy5fZmlsZS5EYXRlTGFzdEFjY2Vzc2VkKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIG10aW1lOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKHRoaXMuX2ZpbGUuRGF0ZUxhc3RNb2RpZmllZCk7DQogICAgICB9DQogICAgfSwNCiAgICBjdGltZTogew0KICAgICAgZW51bWVyYWJsZTogdHJ1ZSwNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiBuZXcgRGF0ZSh0aGlzLl9maWxlLkRhdGVDcmVhdGVkKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIGF0aW1lTXM6IHsNCiAgICAgIGVudW1lcmFibGU6IHRydWUsDQogICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5hdGltZS5nZXRUaW1lKCk7DQogICAgICB9DQogICAgfSwNCiAgICBtdGltZU1zOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMubXRpbWUuZ2V0VGltZSgpOw0KICAgICAgfQ0KICAgIH0sDQogICAgY3RpbWVNczogew0KICAgICAgZW51bWVyYWJsZTogdHJ1ZSwNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB0aGlzLmN0aW1lLmdldFRpbWUoKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIHJlYWRvbmx5OiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuICEhKHRoaXMuX2ZpbGUuQXR0cmlidXRlcyAmIDEpOw0KICAgICAgfQ0KICAgIH0sDQogICAgaGlkZGVuOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuICEhKHRoaXMuX2ZpbGUuQXR0cmlidXRlcyAmIDIpOw0KICAgICAgfQ0KICAgIH0sDQogICAgc3lzdGVtOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuICEhKHRoaXMuX2ZpbGUuQXR0cmlidXRlcyAmIDQpOw0KICAgICAgfQ0KICAgIH0NCiAgfTsNCg0KICBmdW5jdGlvbiBnZXRTdGF0cyhwdGgpIHsNCiAgICB2YXIgZiwNCiAgICAgIGluc3RhbmNlID0gT2JqZWN0LmNyZWF0ZShGSUxFX1BST1RPLCBGSUxFX1BST1BTKTsNCiAgICBpZiAodHlwZW9mIHB0aCA9PSAnb2JqZWN0Jykgew0KICAgICAgZiA9IHB0aDsNCiAgICB9IGVsc2UgaWYgKHR5cGVvZiBwdGggPT0gJ3N0cmluZycpIHsNCiAgICAgIGlmICghaXNhYnMocHRoKSkgcHRoID0gYWJzcGF0aChwdGgpOw0KICAgICAgaWYgKGlzZmlsZShwdGgpKSB7DQogICAgICAgIGYgPSBfX0ZTTy5HZXRGaWxlKHB0aCk7DQogICAgICB9IGVsc2UgaWYgKGlzZGlyKHB0aCkpIHsNCiAgICAgICAgZiA9IF9fRlNPLkdldEZvbGRlcihwdGgpOw0KICAgICAgfQ0KICAgIH0NCiAgICBpZiAoIWYpIHRocm93IG5ldyBFcnJvcihTdHJpbmcucmF3KHtyYXc6IFsnRU5PRU5ULCBubyBzdWNoIGZpbGUgb3IgZGlyZWN0b3J5ICgnLCcpJ119LHB0aCkpOw0KICAgIGluc3RhbmNlLl9maWxlID0gZjsNCiAgICByZXR1cm4gaW5zdGFuY2U7DQogIH0NCg0KICBmdW5jdGlvbiBzY2FuZGlyKHB0aCkgew0KICAgIHJldHVybiBnZXRTdGF0cyhwdGgpLmdldENoaWxkcmVuKCk7DQogIH0NCg0KICBmdW5jdGlvbiB3YWxrKHB0aCwgZm4pIHsNCiAgICBpZiAoIWlzZGlyKHB0aCkpIHJldHVybjsNCiAgICB2YXIgZGlyLA0KICAgICAgaXRlbXMsDQogICAgICBpdGVtLA0KICAgICAgaSwNCiAgICAgIGxlbiwNCiAgICAgIGJ1ZiA9IFtnZXRTdGF0cyhwdGgpXTsNCiAgICB3aGlsZSAoYnVmLmxlbmd0aCA+IDApIHsNCiAgICAgIGRpciA9IGJ1Zi5zaGlmdCgpOw0KICAgICAgaXRlbXMgPSBkaXIuZ2V0Q2hpbGRyZW4oKTsNCiAgICAgIGkgPSAtMTsNCiAgICAgIGxlbiA9IGl0ZW1zLmxlbmd0aDsNCiAgICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgICAgaXRlbSA9IGl0ZW1zW2ldOw0KICAgICAgICBpZiAoaXRlbS5pc0RpcmVjdG9yeSgpKSBidWYucHVzaChpdGVtKTsNCiAgICAgICAgaWYgKGZuKGl0ZW0pID09PSBmYWxzZSkgcmV0dXJuOw0KICAgICAgfQ0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIG1rZGlyKHB0aCkgew0KICAgIHJldHVybiBfX0ZTTy5DcmVhdGVGb2xkZXIocHRoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1rZGlycyhwdGgpIHsNCiAgICB2YXIgZGlyID0gcHRoLA0KICAgICAgZGlycyA9IFtdOw0KICAgIHdoaWxlIChkaXIpIHsNCiAgICAgIGlmIChpc2RpcihkaXIpKSBicmVhazsNCiAgICAgIGRpcnMucHVzaChkaXIpOw0KICAgICAgZGlyID0gZGlybmFtZShkaXIpOw0KICAgIH0NCiAgICB2YXIgaSA9IGRpcnMubGVuZ3RoOw0KICAgIHdoaWxlIChpLS0pIG1rZGlyKGRpcnNbaV0pOw0KICB9DQoNCiAgZnVuY3Rpb24gcm1kaXIocHRoKSB7DQogICAgcmV0dXJuIGlzZGlyKHB0aCkgJiYgX19GU08uRGVsZXRlRm9sZGVyKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiByZW1vdmUkMShwdGgpIHsNCiAgICByZXR1cm4gaXNmaWxlKHB0aCkgJiYgX19GU08uRGVsZXRlRmlsZShwdGgpOw0KICB9DQoNCiAgZnVuY3Rpb24gY29weWZpbGUocHRoLCBkc3QsIG93KSB7DQogICAgaWYgKCFpc2Ficyhkc3QpKSBkc3QgPSBhYnNwYXRoKGRpcm5hbWUocHRoKSArIFNFUCArIGRzdCk7DQogICAgaWYgKCFTRVBfUkVHRVhQX0VORC50ZXN0KGRzdCkpIGRzdCArPSBTRVA7DQogICAgaWYgKCFpc2Rpcihkc3QpKSBta2RpcnMoZHN0KTsNCiAgICBfX0ZTTy5Db3B5RmlsZShwdGgsIGRzdCwgb3cgfHwgZmFsc2UpOw0KICB9DQoNCiAgZnVuY3Rpb24gcmVwbChwdGgsIGRzdCkgew0KICAgIGlmICghaXNhYnMoZHN0KSkgZHN0ID0gYWJzcGF0aChkaXJuYW1lKHB0aCkgKyBTRVAgKyBkc3QpOw0KICAgIHZhciBkaXIgPSBkaXJuYW1lKGRzdCk7DQogICAgdmFyIG5hbWUgPSBiYXNlbmFtZShkc3QpOw0KICAgIGlmIChpc2ZpbGUoZHN0KSkgdGhyb3cgbmV3IEVycm9yKGRzdCArICcgaXMgZXhpc3RzLiByZXBsIGZhaWQuJyk7DQogICAgaWYgKCFpc2RpcihkaXIpKSBta2RpcnMoZGlyKTsNCiAgICBlbHNlIGlmIChpc2Rpcihkc3QpKSBybWRpcihkc3QpOw0KICAgIHZhciBmID0gZ2V0U3RhdHMocHRoKTsNCiAgICBpZiAoZi5uYW1lICE9IG5hbWUpIGYubmFtZSA9IG5hbWU7DQogICAgaWYgKGYuZGlybmFtZSAhPSBkaXIpIGYubW92ZShkaXIpOw0KICB9CgogIGZ1bmN0aW9uIHN0YXRTeW5jKHB0aCkgew0KICAgIHJldHVybiBnZXRTdGF0cyhwdGgpOw0KICB9DQoNCiAgZnVuY3Rpb24gcmVhZGRpclN5bmMocHRoKSB7DQogICAgcmV0dXJuIHNjYW5kaXIocHRoKS5tYXAoIGZ1bmN0aW9uKGl0ICl7cmV0dXJuICBpdC5uYW1lfSk7DQogIH0NCg0KICBmdW5jdGlvbiB3aXRoU3RyZWFtKG9wdGlvbnMsIGZuKSB7DQogICAgdmFyIHN0ID0gbmV3IEFjdGl2ZVhPYmplY3QoJ0FET0RCLlN0cmVhbScpLA0KICAgICAgZmlsZSA9IG9wdGlvbnMuZmlsZSwNCiAgICAgIGVuY29kaW5nID0gb3B0aW9ucy5lbmNvZGluZywNCiAgICAgIGZsYWcgPSBvcHRpb25zLmZsYWcsDQogICAgICByc3Q7DQogICAgdHJ5IHsNCiAgICAgIGlmIChlbmNvZGluZyA9PSAnYmluYXJ5Jykgc3QuVHlwZSA9IDE7DQogICAgICBlbHNlIHN0LkNoYXJzZXQgPSBlbmNvZGluZzsNCiAgICAgIHN0Lk9wZW4oKTsNCiAgICAgIGlmIChmbGFnID09ICdyJyB8fCBmbGFnID09ICdhJykgew0KICAgICAgICBpZiAoIWlzZmlsZShmaWxlKSkNCiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoU3RyaW5nLnJhdyh7cmF3OiBbJ3dpdGhTdHJlYW06IGZpbGUgbm90IGV4aXN0cy4gKCcsJyknXX0sZmlsZSkpOw0KICAgICAgICBzdC5Mb2FkRnJvbUZpbGUoZmlsZSk7DQogICAgICB9DQogICAgICBpZiAoZmxhZyA9PSAnYScpIHN0LlBvc2l0aW9uID0gc3QuU2l6ZTsNCiAgICAgIHJzdCA9IGZuKHN0KTsNCiAgICB9IGNhdGNoIChlKSB7DQogICAgICB0aHJvdyBlOw0KICAgIH0gZmluYWxseSB7DQogICAgICBzdCAmJiBzdC5TdGF0ZSA9PSAxICYmIHN0LmNsb3NlKCk7DQogICAgfQ0KICAgIHJldHVybiByc3Q7DQogIH0NCg0KICBmdW5jdGlvbiBzYXZlU3RyZWFtKHN0LCBvcHRpb25zKSB7DQogICAgdmFyIHNraXBMZW4gPSAwLA0KICAgICAgZmlsZSA9IG9wdGlvbnMuZmlsZSwNCiAgICAgIGVuY29kaW5nID0gb3B0aW9ucy5lbmNvZGluZy5yZXBsYWNlKCctJywgJycpLnRvTG93ZXJDYXNlKCk7DQogICAgaWYgKGVuY29kaW5nID09ICd1dGY4JyB8fCBlbmNvZGluZyA9PSAndW5pY29kZScpIHNraXBMZW4gPSAzOw0KICAgIGVsc2UgaWYgKGVuY29kaW5nID09ICd1ZnQxNicpIHNraXBMZW4gPSAyOw0KICAgIHN0LlNldEVPUygpOw0KICAgIGlmIChza2lwTGVuKSB7DQogICAgICBzdC5Qb3NpdGlvbiA9IDA7DQogICAgICBzdC5UeXBlID0gMTsNCiAgICAgIHN0LlBvc2l0aW9uID0gc2tpcExlbjsNCiAgICAgIHZhciBiaW5EYXRhID0gc3QuUmVhZCgtMSk7DQogICAgICBzdC5Qb3NpdGlvbiA9IDA7DQogICAgICBzdC5Xcml0ZShiaW5EYXRhKTsNCiAgICAgIHN0LlNldEVPUygpOw0KICAgIH0NCiAgICBzdC5TYXZlVG9GaWxlKGZpbGUsIDIpOw0KICB9DQoNCiAgZnVuY3Rpb24gaW5pdEFyZ3MoZmlsZSwgb3B0aW9ucykgew0KICAgIHZhciB0cCwgZW5jb2RpbmcsIGZsYWc7DQogICAgaWYgKCFpc2FicyhmaWxlKSkgdGhyb3cgbmV3IEVycm9yKCdmczogcmVsYXRpdmUgcGF0aCBpcyBub3Qgc3VwcG9ydGVkJyk7DQogICAgdHAgPSB0eXBlb2Ygb3B0aW9uczsNCiAgICBpZiAodHAgPT0gJ3N0cmluZycpIHsNCiAgICAgIGVuY29kaW5nID0gb3B0aW9uczsNCiAgICB9IGVsc2UgaWYgKHRwID09ICdvYmplY3QnKSB7DQogICAgICBpZiAob3B0aW9ucy5lbmNvZGluZykgZW5jb2RpbmcgPSBvcHRpb25zLmVuY29kaW5nOw0KICAgICAgaWYgKG9wdGlvbnMuZmxhZykgZmxhZyA9IG9wdGlvbnMuZmxhZzsNCiAgICAgIGVsc2UgaWYgKG9wdGlvbnMuZmxhZ3MpIGZsYWcgPSBvcHRpb25zLmZsYWdzOw0KICAgIH0NCiAgICBpZiAoZmxhZyAmJiBmbGFnLmxlbmd0aCA+IDEpIGZsYWcgPSBmbGFnLmNoYXJBdCgwKTsNCiAgICByZXR1cm4geyBmaWxlOiBmaWxlLCBlbmNvZGluZzogZW5jb2RpbmcsIGZsYWc6IGZsYWcgfTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlYWRGaWxlU3luYyhmaWxlLCBvcHRpb25zKSB7DQogICAgdmFyIG9wdHMgPSBpbml0QXJncyhmaWxlLCBvcHRpb25zKTsNCiAgICBvcHRzLmZsYWcgPSAncic7DQogICAgaWYgKCFvcHRzLmVuY29kaW5nKSBvcHRzLmVuY29kaW5nID0gJ2JpbmFyeSc7DQogICAgcmV0dXJuIHdpdGhTdHJlYW0ob3B0cywgZnVuY3Rpb24oc3QpIHsNCiAgICAgIHJldHVybiBvcHRzLmVuY29kaW5nID09ICdiaW5hcnknDQogICAgICAgID8gQnVmZmVyLmZyb20oc3QuUmVhZCgtMSkpDQogICAgICAgIDogc3QuUmVhZFRleHQoLTEpOw0KICAgIH0pOw0KICB9DQoNCiAgZnVuY3Rpb24gd3JpdGVGaWxlU3luYyhmaWxlLCBkYXRhLCBvcHRpb25zKSB7DQogICAgdmFyIG9wdHMgPSBpbml0QXJncyhmaWxlLCBvcHRpb25zKSwNCiAgICAgIGlzQnVmZmVyID0gQnVmZmVyLmlzQnVmZmVyKGRhdGEpOw0KICAgIG9wdHMuZmxhZyA9ICd3JzsNCiAgICBpZiAoaXNCdWZmZXIpIG9wdHMuZW5jb2RpbmcgPSAnYmluYXJ5JzsNCiAgICBlbHNlIGlmICghb3B0cy5lbmNvZGluZykgb3B0cy5lbmNvZGluZyA9ICdVVEYtOCc7DQogICAgd2l0aFN0cmVhbShvcHRzLCBmdW5jdGlvbiggc3QgKSB7DQogICAgICBpc0J1ZmZlciA/IHN0LldyaXRlKGRhdGEuYnVmZmVyKSA6IHN0LldyaXRlVGV4dChkYXRhKTsNCiAgICAgIHNhdmVTdHJlYW0oc3QsIG9wdHMpOw0KICAgIH0pOw0KICB9DQoNCiAgZnVuY3Rpb24gYXBwZW5kRmlsZVN5bmMoZmlsZSwgZGF0YSwgb3B0aW9ucykgew0KICAgIHZhciBvcHRzID0gaW5pdEFyZ3MoZmlsZSwgb3B0aW9ucyksDQogICAgICBpc0J1ZmZlciA9IEJ1ZmZlci5pc0J1ZmZlcihkYXRhKTsNCiAgICBvcHRzLmZsYWcgPSAnYSc7DQogICAgaWYgKGlzQnVmZmVyKSBvcHRzLmVuY29kaW5nID0gJ2JpbmFyeSc7DQogICAgZWxzZSBpZiAoIW9wdHMuZW5jb2RpbmcpIG9wdHMuZW5jb2RpbmcgPSAnVVRGLTgnOw0KICAgIHdpdGhTdHJlYW0ob3B0cywgZnVuY3Rpb24oIHN0ICkgew0KICAgICAgaXNCdWZmZXIgPyBzdC5Xcml0ZShkYXRhLmJ1ZmZlcikgOiBzdC5Xcml0ZVRleHQoZGF0YSk7DQogICAgICBzYXZlU3RyZWFtKHN0LCBvcHRzKTsNCiAgICB9KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1rZGlyU3luYyhwdGgsIG9wdGlvbnMpIHsNCiAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnJlY3Vyc2l2ZSkgbWtkaXJzKHB0aCk7DQogICAgbWtkaXIocHRoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNvcHlGaWxlU3luYyhzcmMsIGRlc3QpIHsNCiAgICBjb3B5ZmlsZShzcmMsIGRlc3QsIHRydWUpOw0KICB9DQoNCg0KDQogIGZ1bmN0aW9uIG1rZGlyc1N5bmMocHRoKSB7DQogICAgbWtkaXJzKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiBlbnN1cmVEaXJTeW5jKHB0aCkgew0KICAgIGlmICghaXNkaXIocHRoKSkgbWtkaXJzKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiBlbnN1cmVGaWxlU3luYyhmaWxlKSB7DQogICAgaWYgKCFpc2FicyhmaWxlKSkgZmlsZSA9IGFic3BhdGgoZmlsZSk7DQogICAgdmFyIGRpciA9IGRpcm5hbWUoZmlsZSk7DQogICAgaWYgKCFpc2RpcihkaXIpKSBta2RpcnMoZGlyKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIG91dHB1dEZpbGVTeW5jKGZpbGUsIGRhdGEsIG9wdGlvbnMpIHsNCiAgICBpZiAoIWlzYWJzKGZpbGUpKSBmaWxlID0gYWJzcGF0aChmaWxlKTsNCiAgICBlbnN1cmVGaWxlU3luYyhmaWxlKTsNCiAgICB3cml0ZUZpbGVTeW5jKGZpbGUsIGRhdGEsIG9wdGlvbnMpOw0KICB9DQoNCiAgZnVuY3Rpb24gb3V0cHV0SnNvblN5bmMoZmlsZSwgb2JqLCBvcHRpb25zKSB7DQogICAgaWYgKCFpc2FicyhmaWxlKSkgZmlsZSA9IGFic3BhdGgoZmlsZSk7DQogICAgZW5zdXJlRmlsZVN5bmMoZmlsZSk7DQogICAgd3JpdGVGaWxlU3luYyhmaWxlLCBKU09OLnN0cmluZ2lmeShvYmopLCBvcHRpb25zKTsNCiAgfQ0KDQogIHZhciBvdXRwdXRKU09OU3luYyA9IG91dHB1dEpzb25TeW5jOw0KDQogIGZ1bmN0aW9uIHJlYWRKc29uU3luYyhmaWxlLCBvcHRpb25zKSB7DQogICAgaWYgKCFpc2FicyhmaWxlKSkgZmlsZSA9IGFic3BhdGgoZmlsZSk7DQogICAgaWYgKCFvcHRpb25zIHx8ICh0eXBlb2Ygb3B0aW9ucyA9PSAnb2JqZWN0JyAmJiAhb3B0aW9ucy5lbmNvZGluZykpDQogICAgICBvcHRpb25zID0gJ1VURi04JzsNCiAgICB2YXIgZGF0YSA9IHJlYWRGaWxlU3luYyhmaWxlLCBvcHRpb25zKTsNCiAgICByZXR1cm4gSlNPTi5wYXJzZShkYXRhKTsNCiAgfQ0KDQogIHZhciByZWFkSlNPTlN5bmMgPSByZWFkSnNvblN5bmM7DQoNCiAgZnVuY3Rpb24gZW1wdHlEaXJTeW5jKGRpcikgew0KICAgIHNjYW5kaXIoZGlyKS5mb3JFYWNoKCBmdW5jdGlvbihpdCApe3JldHVybiAgaXQuZGVsZXRlKHRydWUpfSk7DQogIH0NCg0KICBmdW5jdGlvbiByZWFkTGluZXNTeW5jKGZpbGUsIG9wdGlvbnMpIHsNCiAgICBpZiAoIWlzYWJzKGZpbGUpKSBmaWxlID0gYWJzcGF0aChmaWxlKTsNCiAgICB2YXIgb3B0cyA9IGluaXRBcmdzKGZpbGUsIG9wdGlvbnMpOw0KICAgIG9wdHMuZmxhZyA9ICdyJzsNCiAgICBpZiAoIW9wdHMuZW5jb2RpbmcpIG9wdHMuZW5jb2RpbmcgPSAnVVRGLTgnOw0KICAgIHJldHVybiB3aXRoU3RyZWFtKG9wdHMsIGZ1bmN0aW9uKHN0KSB7DQogICAgICB2YXIgbGluZXMgPSBbXTsNCiAgICAgIHdoaWxlICghc3QuRU9TKSBsaW5lcy5wdXNoKHN0LlJlYWRUZXh0KC0yKSk7DQogICAgICByZXR1cm4gbGluZXM7DQogICAgfSk7DQogIH0KCiAgdmFyIGZzID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgc3RhdFN5bmM6IHN0YXRTeW5jLAogICAgcmVhZGRpclN5bmM6IHJlYWRkaXJTeW5jLAogICAgcmVhZEZpbGVTeW5jOiByZWFkRmlsZVN5bmMsCiAgICB3cml0ZUZpbGVTeW5jOiB3cml0ZUZpbGVTeW5jLAogICAgYXBwZW5kRmlsZVN5bmM6IGFwcGVuZEZpbGVTeW5jLAogICAgbWtkaXJTeW5jOiBta2RpclN5bmMsCiAgICBjb3B5RmlsZVN5bmM6IGNvcHlGaWxlU3luYywKICAgIG1rZGlyc1N5bmM6IG1rZGlyc1N5bmMsCiAgICBlbnN1cmVEaXJTeW5jOiBlbnN1cmVEaXJTeW5jLAogICAgZW5zdXJlRmlsZVN5bmM6IGVuc3VyZUZpbGVTeW5jLAogICAgb3V0cHV0RmlsZVN5bmM6IG91dHB1dEZpbGVTeW5jLAogICAgb3V0cHV0SnNvblN5bmM6IG91dHB1dEpzb25TeW5jLAogICAgb3V0cHV0SlNPTlN5bmM6IG91dHB1dEpTT05TeW5jLAogICAgcmVhZEpzb25TeW5jOiByZWFkSnNvblN5bmMsCiAgICByZWFkSlNPTlN5bmM6IHJlYWRKU09OU3luYywKICAgIGVtcHR5RGlyU3luYzogZW1wdHlEaXJTeW5jLAogICAgcmVhZExpbmVzU3luYzogcmVhZExpbmVzU3luYywKICAgIGV4aXN0c1N5bmM6IGV4aXN0cywKICAgIHJlbmFtZVN5bmM6IHJlcGwsCiAgICBybWRpclN5bmM6IHJtZGlyLAogICAgdW5saW5rU3luYzogcmVtb3ZlJDEKICB9KTsKCiAgdmFyIFBBUlNFX1JFRyA9IC9eKFtBLVphLXpdOlsvXFxdfFsvXFxdfCkoPzooW14/I10qKVsvXFxdfCkoW14vXFw/I10qPykoWy5dW14uPyNdK3wpJC87DQogIHZhciBDQVBUVVJFID0gWydwYXRoJywgJ3Jvb3QnLCAnZGlyJywgJ25hbWUnLCAnZXh0J107DQoNCiAgZnVuY3Rpb24gcGFyc2UocHRoKSB7DQogICAgcHRoIHx8IChwdGggPSAnJyk7DQogICAgdmFyIG1hdGNoID0gcHRoLm1hdGNoKFBBUlNFX1JFRyk7DQogICAgdmFyIHJlc3VsdCA9IENBUFRVUkUucmVkdWNlKGZ1bmN0aW9uKG1lbW8sIG5hbWUsIGluZGV4KSB7DQogICAgICBtZW1vW25hbWVdID0gbWF0Y2hbaW5kZXhdOw0KICAgICAgcmV0dXJuIG1lbW87DQogICAgfSwge30pOw0KICAgIHJlc3VsdC5iYXNlID0gcmVzdWx0Lm5hbWUgKyByZXN1bHQuZXh0Ow0KICAgIHJlc3VsdC5kaXJuYW1lID0gcmVzdWx0LnJvb3QgKyByZXN1bHQuZGlyOw0KICAgIHJldHVybiByZXN1bHQ7DQogIH0NCg0KICB2YXIgZGVsaW1pdGVyID0gJzsnOwoKICB2YXIgUGF0aCA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgIHBhcnNlOiBwYXJzZSwKICAgIGRlbGltaXRlcjogZGVsaW1pdGVyLAogICAgc2VwOiBzZXAsCiAgICBkaXJuYW1lOiBkaXJuYW1lLAogICAgYmFzZW5hbWU6IGJhc2VuYW1lLAogICAgZXh0bmFtZTogZXh0bmFtZSwKICAgIGlzQWJzb2x1dGU6IGlzQWJzb2x1dGUsCiAgICBub3JtYWxpemU6IG5vcm1hbGl6ZSwKICAgIGpvaW46IGpvaW4sCiAgICByZXNvbHZlOiByZXNvbHZlLAogICAgcmVsYXRpdmU6IHJlbGF0aXZlCiAgfSk7CgogIGlmICghT2JqZWN0LmFzc2lnbikgew0KICAgIE9iamVjdC5hc3NpZ24gPSBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiBhcHBseShhc3NpZ24sIG51bGwsIGFyZ3VtZW50cyk7DQogICAgfTsNCiAgfQ0KDQogIGlmICghT2JqZWN0LnZhbHVlcykgew0KICAgIE9iamVjdC52YWx1ZXMgPSB2YWx1ZXM7DQogIH0NCg0KICBmdW5jdGlvbiBkZWZpbmVNZXRob2RzKHRhcmdldCwgZnVuY0RpY3QpIHsNCiAgICB2YXIgcHJvcHMgPSB7fTsNCiAgICBmb3IgKHZhciBrZXkgaW4gZnVuY0RpY3QpIHsNCiAgICAgIGlmICghdGFyZ2V0W2tleV0pIHsNCiAgICAgICAgcHJvcHNba2V5XSA9IHsNCiAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSwNCiAgICAgICAgICB2YWx1ZTogZnVuY0RpY3Rba2V5XQ0KICAgICAgICB9Ow0KICAgICAgfQ0KICAgIH0NCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKTsNCiAgfQ0KDQogIGRlZmluZU1ldGhvZHMoQXJyYXkucHJvdG90eXBlLCB7DQogICAgaW5jbHVkZXM6IGZ1bmN0aW9uKHZhbCwgc3RhcnQpIHsNCiAgICAgIHJldHVybiBpbmNsdWRlcyh0aGlzLCB2YWwsIHN0YXJ0KTsNCiAgICB9LA0KICAgIGZpbmQ6IGZ1bmN0aW9uKGZuLCBfdGhpcykgew0KICAgICAgcmV0dXJuIGZpbmQodGhpcywgZm4sIF90aGlzKVswXTsNCiAgICB9LA0KICAgIGZpbmRJbmRleDogZnVuY3Rpb24oZm4sIF90aGlzKSB7DQogICAgICByZXR1cm4gZmluZEluZGV4KHRoaXMsIGZuLCBfdGhpcylbMV07DQogICAgfSwNCiAgICBmaWxsOiBmdW5jdGlvbih2YWwsIHN0YXJ0LCBlbmQpIHsNCiAgICAgIHJldHVybiBmaWxsKHRoaXMsIHZhbCwgc3RhcnQsIGVuZCk7DQogICAgfQ0KICB9KTsNCg0KICBkZWZpbmVNZXRob2RzKFN0cmluZy5wcm90b3R5cGUsIHsNCiAgICByZXBlYXQ6IGZ1bmN0aW9uKG4pIHsNCiAgICAgIHJldHVybiByZXBlYXQodGhpcywgbik7DQogICAgfSwNCiAgICBzdGFydHNXaXRoOiBmdW5jdGlvbih0YXJnZXQsIHBvcykgew0KICAgICAgcmV0dXJuIHN0YXJ0c1dpdGgodGhpcywgdGFyZ2V0LCBwb3MpOw0KICAgIH0sDQogICAgZW5kc1dpdGg6IGZ1bmN0aW9uKHRhcmdldCwgdGhpc19sZW4pIHsNCiAgICAgIHJldHVybiBlbmRzV2l0aCh0aGlzLCB0YXJnZXQsIHRoaXNfbGVuKTsNCiAgICB9LA0KICAgIGluY2x1ZGVzOiBmdW5jdGlvbih0YXJnZXQsIHBvcykgew0KICAgICAgcmV0dXJuIGluY2x1ZGVzKHRoaXMsIHRhcmdldCwgcG9zKTsNCiAgICB9LA0KICAgIHBhZFN0YXJ0OiBmdW5jdGlvbihsZW4sIGNocnMpIHsNCiAgICAgIHJldHVybiBwYWRTdGFydCh0aGlzLCBsZW4sIGNocnMpOw0KICAgIH0sDQogICAgcGFkRW5kOiBmdW5jdGlvbihsZW4sIGNocnMpIHsNCiAgICAgIHJldHVybiBwYWRFbmQodGhpcywgbGVuLCBjaHJzKTsNCiAgICB9DQogIH0pOw0KDQogIGlmICghU3RyaW5nLnJhdykgew0KICAgIFN0cmluZy5yYXcgPSBmdW5jdGlvbihjYWxsU2l0ZSkgew0KICAgICAgdmFyIGkgPSAwLA0KICAgICAgICBidWYgPSBbXSwNCiAgICAgICAgc3RycyA9IGNhbGxTaXRlLnJhdywNCiAgICAgICAgbGVuID0gc3Rycy5sZW5ndGgsDQogICAgICAgIGFyZ3NDbnQgPSBhcmd1bWVudHMubGVuZ3RoOw0KICAgICAgd2hpbGUgKGkgPCBsZW4pIHsNCiAgICAgICAgYnVmLnB1c2goc3Ryc1tpKytdKTsNCiAgICAgICAgaWYgKGkgPCBhcmdzQ250ICYmIGkgPCBsZW4pIHsNCiAgICAgICAgICBidWYucHVzaChhcmd1bWVudHNbaV0pOw0KICAgICAgICB9DQogICAgICB9DQogICAgICByZXR1cm4gYnVmLmpvaW4oJycpOw0KICAgIH07DQogIH0NCg0KICB3aW5kb3cuX19maWxlbmFtZSA9IFdTY3JpcHQuU2NyaXB0RnVsbE5hbWU7DQogIHdpbmRvdy5fX2Rpcm5hbWUgPSBfX2ZpbGVuYW1lLm1hdGNoKC8oLiopW1xcL10vKVsxXTsNCg0KICBmdW5jdGlvbiBkZWZpbmVHZXR0ZXIodGFyZ2V0LCBmdW5jRGljdCkgew0KICAgIHZhciBwcm9wcyA9IHt9Ow0KICAgIGZvciAodmFyIGtleSBpbiBmdW5jRGljdCkgew0KICAgICAgaWYgKCF0YXJnZXRba2V5XSkgew0KICAgICAgICBwcm9wc1trZXldID0gew0KICAgICAgICAgIGdldDogZnVuY0RpY3Rba2V5XQ0KICAgICAgICB9Ow0KICAgICAgfQ0KICAgIH0NCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKTsNCiAgfQ0KDQogIHZhciBfdmJzLCBfc2hlbGwsIF9mc28sIF9zaGVsbF9hcHA7DQoNCiAgZGVmaW5lR2V0dGVyKHdpbmRvdywgew0KICAgIF9fVkJTOiBmdW5jdGlvbigpIHsNCiAgICAgIGlmICghX3Zicykgew0KICAgICAgICBfdmJzID0gbmV3IEFjdGl2ZVhPYmplY3QoJ1NjcmlwdENvbnRyb2wnKTsNCiAgICAgICAgX3Zicy5MYW5ndWFnZSA9ICdWQlNjcmlwdCc7DQogICAgICB9DQogICAgICByZXR1cm4gX3ZiczsNCiAgICB9LA0KICAgIF9fV1NoZWxsOiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiBfc2hlbGwgfHwgKF9zaGVsbCA9IG5ldyBBY3RpdmVYT2JqZWN0KCdXU2NyaXB0LlNoZWxsJykpOw0KICAgIH0sDQogICAgX19GU086IGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuIF9mc28gfHwgKF9mc28gPSBuZXcgQWN0aXZlWE9iamVjdCgnU2NyaXB0aW5nLkZpbGVTeXN0ZW1PYmplY3QnKSk7DQogICAgfSwNCiAgICBfX1NoZWxsQXBwOiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiBfc2hlbGxfYXBwIHx8IChfc2hlbGxfYXBwID0gbmV3IEFjdGl2ZVhPYmplY3QoJ1NoZWxsLkFwcGxpY2F0aW9uJykpOw0KICAgIH0NCiAgfSk7DQoNCiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgZnVuY3Rpb24oKSB7DQogICAgdmFyIHNjcmlwdHMgPSBkb2N1bWVudC5zY3JpcHRzOw0KICAgIHZhciBpID0gLTEsDQogICAgICBsZW4gPSBzY3JpcHRzLmxlbmd0aDsNCiAgICB2YXIgbmFtZSA9IGJhc2VuYW1lKF9fZmlsZW5hbWUpLnJlcGxhY2UoL1wuW14uXSskLywgJycpOw0KICAgIHZhciBmaWxlLCBmb2xkZXI7DQogICAgZm9sZGVyID0gam9pbihfX2Rpcm5hbWUsIG5hbWUgKyAnX3NyYycpOw0KICAgIGlmICghaXNkaXIoZm9sZGVyKSkgbWtkaXJzU3luYyhmb2xkZXIpOw0KICAgIGNvbnNvbGUubG9nKCcnKTsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICBmaWxlID0gam9pbihmb2xkZXIsIGkgKyAnLmpzJyk7DQogICAgICBvdXRwdXRGaWxlU3luYyhmaWxlLCBzY3JpcHRzW2ldLnRleHQpOw0KICAgICAgY29uc29sZS5sb2coJ3NvdXJjZSAlZDogJXMnLCBpLCBmaWxlKTsNCiAgICB9DQogIH0pOwoKICBmdW5jdGlvbiBleGVjU3luYyhjbWQpIHsNCiAgICB2YXIgcHJvYyA9IF9fV1NoZWxsLkV4ZWMoY21kKTsNCiAgICBmb3IgKDs7KSB7DQogICAgICBpZiAocHJvYy5TdGF0ZXMgIT09IDApIGJyZWFrOw0KICAgIH0NCiAgICBpZiAoIXByb2MuU3RkT3V0LkF0RW5kT2ZTdHJlYW0pIHsNCiAgICAgIHJldHVybiBwcm9jLlN0ZE91dC5SZWFkQWxsKCk7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gZXhlYyhjbWQsIGZ1bmMpIHsNCiAgICB2YXIgcHJvYywgc3Rkb3V0LCBzdGRlcnI7DQogICAgdHJ5IHsNCiAgICAgIHByb2MgPSBfX1dTaGVsbC5FeGVjKGNtZCk7DQogICAgICBmb3IgKDs7KSB7DQogICAgICAgIGlmIChwcm9jLlN0YXRlcyAhPT0gMCkgYnJlYWs7DQogICAgICB9DQogICAgICBpZiAoZnVuYyAmJiB0eXBlb2YgZnVuYyA9PT0gJ2Z1bmN0aW9uJykgew0KICAgICAgICBpZiAoIXByb2MuU3RkT3V0LkF0RW5kT2ZTdHJlYW0pIHsNCiAgICAgICAgICBzdGRvdXQgPSBwcm9jLlN0ZE91dC5SZWFkQWxsKCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFwcm9jLlN0ZEVyci5BdEVuZE9mU3RyZWFtKSB7DQogICAgICAgICAgc3RkZXJyID0gcHJvYy5TdGRFcnIuUmVhZEFsbCgpOw0KICAgICAgICB9DQogICAgICAgIGZ1bmMobnVsbCwgc3Rkb3V0LCBzdGRlcnIpOw0KICAgICAgfQ0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgIGlmIChmdW5jICYmIHR5cGVvZiBmdW5jID09PSAnZnVuY3Rpb24nKSB7DQogICAgICAgIGZ1bmMoZSwgbnVsbCwgbnVsbCk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aHJvdyBlOw0KICAgICAgfQ0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIHJ1bihjbWQsIG9wdGlvbnMpIHsNCiAgICB2YXIgaW50V2luZG93U3R5bGUgPSAxLA0KICAgICAgYldhaXRPblJldHVybiA9IHRydWU7DQogICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsNCiAgICBpZiAob3B0aW9ucy5oaWRlID09PSBmYWxzZSB8fCBvcHRpb25zLmhpZGRlbiA9PT0gZmFsc2UpIGludFdpbmRvd1N0eWxlID0gMDsNCiAgICBpZiAob3B0aW9ucy53YWl0ID09PSBmYWxzZSkgYldhaXRPblJldHVybiA9IGZhbHNlOw0KICAgIHJldHVybiBfX1dTaGVsbC5SdW4oY21kLCBpbnRXaW5kb3dTdHlsZSwgYldhaXRPblJldHVybik7DQogIH0KCiAgdmFyIGNoaWxkX3Byb2Nlc3MgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICBleGVjU3luYzogZXhlY1N5bmMsCiAgICBleGVjOiBleGVjLAogICAgcnVuOiBydW4KICB9KTsKCiAgdmFyIGVzY2FwZSA9IGVuY29kZVVSSUNvbXBvbmVudDsNCg0KICB2YXIgdW5lc2NhcGUgPSBkZWNvZGVVUklDb21wb25lbnQ7DQoNCiAgZnVuY3Rpb24gZm9ybWF0VmFsdWUkMSh2YWx1ZSkgew0KICAgIHN3aXRjaCAodHlwZW9mIHZhbHVlKSB7DQogICAgICBjYXNlICdzdHJpbmcnOg0KICAgICAgICByZXR1cm4gZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKTsNCiAgICAgIGNhc2UgJ251bWJlcic6DQogICAgICBjYXNlICdib29sZWFuJzoNCiAgICAgICAgcmV0dXJuIFN0cmluZyh2YWx1ZSk7DQogICAgICBkZWZhdWx0Og0KICAgICAgICByZXR1cm4gJyc7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gc3RyaW5naWZ5KG9iaiwgc2VwLCBlcSkgew0KICAgIGlmICghb2JqKSByZXR1cm4gJyc7DQogICAgc2VwIHx8IChzZXAgPSAnJicpOw0KICAgIGVxIHx8IChlcSA9ICc9Jyk7DQogICAgdmFyIGJ1ZiA9IFtdLA0KICAgICAgdmFsdWUsDQogICAgICBpLA0KICAgICAgbGVuOw0KICAgIGZvciAodmFyIGtleSBpbiBvYmopIHsNCiAgICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoa2V5KSkgew0KICAgICAgICB2YWx1ZSA9IG9ialtrZXldOw0KICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHsNCiAgICAgICAgICAoaSA9IC0xKSwgKGxlbiA9IHZhbHVlLmxlbmd0aCk7DQogICAgICAgICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgICAgICAgYnVmLnB1c2goa2V5ICsgZXEgKyBmb3JtYXRWYWx1ZSQxKHZhbHVlW2ldKSk7DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGJ1Zi5wdXNoKGtleSArIGVxICsgZm9ybWF0VmFsdWUkMSh2YWx1ZSkpOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiBidWYuam9pbihzZXApOw0KICB9DQoNCiAgZnVuY3Rpb24gcGFyc2UkMShzdHIsIHNlcCwgZXEpIHsNCiAgICBzZXAgfHwgKHNlcCA9ICcmJyk7DQogICAgZXEgfHwgKGVxID0gJz0nKTsNCiAgICB2YXIgYnVmID0gc3RyLnNwbGl0KHNlcCk7DQogICAgdmFyIGkgPSAtMSwNCiAgICAgIGxlbiA9IGJ1Zi5sZW5ndGgsDQogICAgICByZXN1bHQgPSB7fSwNCiAgICAgIGtleURpY3QgPSB7fSwNCiAgICAgIHBhaXIsDQogICAgICBrZXksDQogICAgICB2YWx1ZTsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICBwYWlyID0gYnVmW2ldLnNwbGl0KGVxKTsNCiAgICAgIGtleSA9IHBhaXJbMF07DQogICAgICB2YWx1ZSA9IHBhaXJbMV07DQogICAgICBpZiAoa2V5RGljdFtrZXldKSB7DQogICAgICAgIGlmIChrZXlEaWN0W2tleV0gPT09IDEpIHsNCiAgICAgICAgICBrZXlEaWN0W2tleV0gPSAyOw0KICAgICAgICAgIHJlc3VsdFtrZXldID0gW3Jlc3VsdFtrZXldLCB2YWx1ZV07DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmVzdWx0W2tleV0ucHVzaCh2YWx1ZSk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGtleURpY3Rba2V5XSA9IDE7DQogICAgICAgIHJlc3VsdFtrZXldID0gdmFsdWU7DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiByZXN1bHQ7DQogIH0KCiAgdmFyIHF1ZXJ5c3RyaW5nID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgZXNjYXBlOiBlc2NhcGUsCiAgICB1bmVzY2FwZTogdW5lc2NhcGUsCiAgICBzdHJpbmdpZnk6IHN0cmluZ2lmeSwKICAgIHBhcnNlOiBwYXJzZSQxCiAgfSk7CgogIHZhciBCSU5fVFlQRVMgPSBbJ2FycmF5YnVmZmVyJywgJ2Jsb2InXTsNCg0KICBmdW5jdGlvbiByZXF1ZXN0KG9wdGlvbnMpIHsNCiAgICB2YXIgaHR0cCwgdXJpLCBtZXRob2QsIHRpbWVvdXQ7DQogICAgaHR0cCA9IG5ldyBBY3RpdmVYT2JqZWN0KCdXaW5IdHRwLldpbkh0dHBSZXF1ZXN0LjUuMScpOw0KICAgIHVyaSA9IG9wdGlvbnMudXJpIHx8IG9wdGlvbnMudXJsIHx8IG9wdGlvbnMucGF0aDsNCiAgICBtZXRob2QgPSAob3B0aW9ucy5tZXRob2QgfHwgJ0dFVCcpLnRvVXBwZXJDYXNlKCk7DQogICAgdGltZW91dCA9IG9wdGlvbnMudGltZW91dCB8fCAzMDAwOw0KICAgIGh0dHAuc2V0VGltZW91dHModGltZW91dCwgdGltZW91dCwgdGltZW91dCwgdGltZW91dCk7DQoNCiAgICB0cnkgew0KICAgICAgdmFyIGRhdGEgPSBvcHRpb25zLmZvcm0gfHwgb3B0aW9ucy5kYXRhIHx8IG51bGw7DQogICAgICBpZiAoZGF0YSAmJiB0eXBlb2YgZGF0YSAhPT0gJ3N0cmluZycpIGRhdGEgPSBzdHJpbmdpZnkoZGF0YSk7DQogICAgICBpZiAoZGF0YSkgew0KICAgICAgICBpZiAobWV0aG9kID09PSAnR0VUJykgew0KICAgICAgICAgIGh0dHAub3BlbihtZXRob2QsIHVyaSArICc/JyArIGRhdGEsIGZhbHNlKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBodHRwLm9wZW4obWV0aG9kLCB1cmksIGZhbHNlKTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgaHR0cC5vcGVuKG1ldGhvZCwgdXJpLCBmYWxzZSk7DQogICAgICB9DQogICAgICBhcHBseU9wdGlvbnMoaHR0cCwgb3B0aW9ucyk7DQogICAgICBodHRwLnNlbmQoZGF0YSk7DQoNCiAgICAgIHJldHVybiB7DQogICAgICAgIHN0YXR1c0NvZGU6IGh0dHAuc3RhdHVzLA0KICAgICAgICBoZWFkZXJzOiBwYXJzZUhlYWRlcnMoaHR0cC5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKSksDQogICAgICAgIGJvZHk6IEJJTl9UWVBFUy5pbmNsdWRlcyhvcHRpb25zLnJlc3BvbnNlVHlwZSkNCiAgICAgICAgICA/IEJ1ZmZlci5mcm9tKGh0dHAuUmVzcG9uc2VCb2R5KQ0KICAgICAgICAgIDogaHR0cC5SZXNwb25zZVRleHQNCiAgICAgIH07DQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgdGhyb3cgZTsNCiAgICB9DQogIH0NCg0KICB2YXIgc2V0UmVxT3B0cyA9IEZ1bmN0aW9uKA0KICAgICdodHRwJywNCiAgICBTdHJpbmcucmF3KHtyYXc6IFsnXHJcbmh0dHAuT3B0aW9uKDApID0gXCdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjE7IFRyaWRlbnQvNy4wOyBydjoxMS4wKSBsaWtlIEdlY2tvXCc7XHJcbmh0dHAuT3B0aW9uKDQpID0gMTMwNTY7XHJcbmh0dHAuT3B0aW9uKDYpID0gZmFsc2U7J119KQ0KICApOw0KDQogIGZ1bmN0aW9uIGFwcGx5T3B0aW9ucyhodHRwLCBvcHRpb25zKSB7DQogICAgaWYgKG9wdGlvbnMucHJveHkpIHsNCiAgICAgIHNldFJlcU9wdHMoaHR0cCk7DQogICAgICBodHRwLnNldFByb3h5KCcyJywgb3B0aW9ucy5wcm94eSk7DQogICAgICANCiAgICAgIA0KICAgIH0NCg0KICAgIGlmIChvcHRpb25zLm1ldGhvZCAhPT0gJ0dFVCcpIHsNCiAgICAgIGh0dHAuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcpOw0KICAgIH0NCg0KICAgIHZhciBoZWFkZXJzID0gb3B0aW9ucy5oZWFkZXJzOw0KICAgIGlmIChoZWFkZXJzKSB7DQogICAgICBmb3IgKHZhciBrZXkgaW4gaGVhZGVycykgew0KICAgICAgICBpZiAoa2V5LnRvTG93ZXJDYXNlKCkgPT0gJ2Nvb2tpZScpIHsNCiAgICAgICAgICBodHRwLnNldFJlcXVlc3RIZWFkZXIoJ0Nvb2tpZScsICdzdHJpbmcnKTsNCiAgICAgICAgICBodHRwLnNldFJlcXVlc3RIZWFkZXIoJ0Nvb2tpZScsIGhlYWRlcnNba2V5XSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgaHR0cC5zZXRSZXF1ZXN0SGVhZGVyKGtleSwgaGVhZGVyc1trZXldKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIHBhcnNlSGVhZGVycyhzdHJfaGVhZGVycykgew0KICAgIHZhciByZXN1bHQgPSB7fSwNCiAgICAgIGhlYWRlcnMsDQogICAgICBpLA0KICAgICAgaywNCiAgICAgIHY7DQogICAgaGVhZGVycyA9IHN0cl9oZWFkZXJzLnRyaW0oKS5zcGxpdCgvXHI/XG4vKTsNCiAgICBoZWFkZXJzLmZvckVhY2goIGZ1bmN0aW9uKGhlYWRlciApIHsNCiAgICAgIGkgPSBoZWFkZXIuaW5kZXhPZignOicpOw0KICAgICAgayA9IGhlYWRlci5zbGljZSgwLCBpKS50cmltKCk7DQogICAgICB2ID0gaGVhZGVyLnNsaWNlKGkgKyAxKS50cmltKCk7DQogICAgICBpZiAoay50b0xvd2VyQ2FzZSgpID09ICdzZXQtY29va2llJykgew0KICAgICAgICBpZiAocmVzdWx0W2tdKSByZXN1bHRba10ucHVzaCh2KTsNCiAgICAgICAgZWxzZSByZXN1bHRba10gPSBbdl07DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXN1bHRba10gPSB2Ow0KICAgICAgfQ0KICAgIH0pOw0KICAgIHJldHVybiByZXN1bHQ7DQogIH0NCg0KICBmdW5jdGlvbiBnZXRPcHRpb24oYXJncykgew0KICAgIHZhciBvcHRpb25zOw0KICAgIGlmICh0eXBlb2YgYXJnc1swXSA9PT0gJ3N0cmluZycpIHsNCiAgICAgIG9wdGlvbnMgPSBhcmdzWzFdIHx8IHt9Ow0KICAgICAgb3B0aW9ucy51cmkgPSBhcmdzWzBdOw0KICAgIH0gZWxzZSB7DQogICAgICBvcHRpb25zID0gYXJnc1swXSB8fCB7fTsNCiAgICB9DQogICAgcmV0dXJuIG9wdGlvbnM7DQogIH0NCg0KICB2YXIgaHR0cCA9IHsNCiAgICByZXF1ZXN0OiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiByZXF1ZXN0KGdldE9wdGlvbihhcmd1bWVudHMpKTsNCiAgICB9LA0KICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICB2YXIgb3B0aW9ucyA9IGdldE9wdGlvbihhcmd1bWVudHMpOw0KICAgICAgb3B0aW9ucy5tZXRob2QgPSAnR0VUJzsNCiAgICAgIHJldHVybiByZXF1ZXN0KG9wdGlvbnMpOw0KICAgIH0sDQogICAgcG9zdDogZnVuY3Rpb24oKSB7DQogICAgICB2YXIgb3B0aW9ucyA9IGdldE9wdGlvbihhcmd1bWVudHMpOw0KICAgICAgb3B0aW9ucy5tZXRob2QgPSAnUE9TVCc7DQogICAgICByZXR1cm4gcmVxdWVzdChvcHRpb25zKTsNCiAgICB9DQogIH07CgogIHZhciBodHRwJDEgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICAnZGVmYXVsdCc6IGh0dHAKICB9KTsKCiAgZnVuY3Rpb24gX2NpcGhlcihlbmMsIGJ1Zl9wYXNzd29yZCwgYnVmX2RhdGEpIHsNCiAgICB2YXIgY3J5cHQgPSBuZXcgQWN0aXZlWE9iamVjdCgnU3lzdGVtLlNlY3VyaXR5LkNyeXB0b2dyYXBoeS5SaWpuZGFlbE1hbmFnZWQnKTsNCiAgICB2YXIga2V5SGFzaCA9IG5ldyBBY3RpdmVYT2JqZWN0KCdTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5LlNIQTI1Nk1hbmFnZWQnKTsNCiAgICBrZXlIYXNoLkNvbXB1dGVIYXNoXzIoYnVmX3Bhc3N3b3JkLmJ1ZmZlcik7DQogICAgY3J5cHQuS2V5ID0ga2V5SGFzaC5IYXNoOw0KICAgIGtleUhhc2guQ2xlYXIoKTsNCg0KICAgIHZhciBpdkhhc2ggPSBuZXcgQWN0aXZlWE9iamVjdCgNCiAgICAgICdTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5Lk1ENUNyeXB0b1NlcnZpY2VQcm92aWRlcicNCiAgICApOw0KICAgIGl2SGFzaC5Db21wdXRlSGFzaF8yKGJ1Zl9wYXNzd29yZC5idWZmZXIpOw0KICAgIGNyeXB0LklWID0gaXZIYXNoLkhhc2g7DQogICAgaXZIYXNoLkNsZWFyKCk7DQoNCiAgICB2YXIgZHN0ID0gbnVsbDsNCiAgICB2YXIgdHMgPSBlbmMgPyBjcnlwdC5DcmVhdGVFbmNyeXB0b3IoKSA6IGNyeXB0LkNyZWF0ZURlY3J5cHRvcigpOw0KICAgIHRyeSB7DQogICAgICBkc3QgPSB0cy5UcmFuc2Zvcm1GaW5hbEJsb2NrKGJ1Zl9kYXRhLmJ1ZmZlciwgMCwgYnVmX2RhdGEubGVuZ3RoKTsNCiAgICB9IGZpbmFsbHkgew0KICAgICAgY3J5cHQuQ2xlYXIoKTsNCiAgICB9DQogICAgcmV0dXJuIGRzdDsNCiAgfQ0KDQogIGZ1bmN0aW9uIENpcGhlcihhbGdvcml0aG0sIHBhc3N3b3JkLCBpc0VuY29kZSkgew0KICAgIHRoaXMuYWxnb3JpdGhtID0gYWxnb3JpdGhtOw0KICAgIHRoaXMucGFzc3dvcmQgPSBwYXNzd29yZDsNCiAgICB0aGlzLmlzRW5jb2RlID0gaXNFbmNvZGU7DQogIH0NCg0KICBDaXBoZXIucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKGRhdGEsIGlucHV0RW5jb2RpbmcsIG91dHB1dEVuY29kaW5nKSB7DQogICAgdGhpcy5kYXRhID0gZGF0YTsNCiAgICBpZiAoaW5wdXRFbmNvZGluZykgdGhpcy5pbnB1dEVuY29kaW5nID0gaW5wdXRFbmNvZGluZzsNCiAgICBpZiAob3V0cHV0RW5jb2RpbmcpIHRoaXMub3V0cHV0RW5jb2RpbmcgPSBvdXRwdXRFbmNvZGluZzsNCiAgICByZXR1cm4gdGhpczsNCiAgfTsNCg0KICBDaXBoZXIucHJvdG90eXBlLmZpbmFsID0gZnVuY3Rpb24ob3V0cHV0RW5jb2RpbmcpIHsNCiAgICBpZiAob3V0cHV0RW5jb2RpbmcpIHRoaXMub3V0cHV0RW5jb2RpbmcgPSBvdXRwdXRFbmNvZGluZzsNCiAgICB2YXIgYnl0ZXMgPSBfY2lwaGVyKA0KICAgICAgdGhpcy5pc0VuY29kZSwNCiAgICAgIEJ1ZmZlci5mcm9tKHRoaXMucGFzc3dvcmQpLA0KICAgICAgQnVmZmVyLmZyb20odGhpcy5kYXRhLCB0aGlzLmlucHV0RW5jb2RpbmcpDQogICAgKTsNCiAgICBpZiAodGhpcy5vdXRwdXRFbmNvZGluZyA9PSBudWxsIHx8IHRoaXMub3V0cHV0RW5jb2RpbmcgPT0gJ2JpbmFyeScpIHsNCiAgICAgIHJldHVybiBCdWZmZXIuZnJvbShieXRlcyk7DQogICAgfSBlbHNlIHsNCiAgICAgIHJldHVybiBCdWZmZXIuZnJvbShieXRlcykudG9TdHJpbmcob3V0cHV0RW5jb2RpbmcpOw0KICAgIH0NCiAgfTsNCg0KICBmdW5jdGlvbiBfaGFzaChvYmpuYW1lLCBidWZfZGF0YSwgb3B0X3R5cGUpIHsNCiAgICB2YXIgcHJvdmlkZXIgPSBuZXcgQWN0aXZlWE9iamVjdChvYmpuYW1lKTsNCiAgICBwcm92aWRlci5Db21wdXRlSGFzaF8yKGJ1Zl9kYXRhLmJ1ZmZlcik7DQogICAgdmFyIGhhc2hzID0gcHJvdmlkZXIuSGFzaDsNCiAgICBwcm92aWRlci5DbGVhcigpOw0KICAgIHJldHVybiBCdWZmZXIuZnJvbShoYXNocykudG9TdHJpbmcob3B0X3R5cGUgfHwgJ2hleCcpOw0KICB9DQoNCiAgZnVuY3Rpb24gSGFzaChhbGdvcml0aG0pIHsNCiAgICB0aGlzLmFsZ29yaXRobSA9IGFsZ29yaXRobTsNCiAgfQ0KDQogIEhhc2gucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKGRhdGEsIGlucHV0RW5jb2RpbmcpIHsNCiAgICB0aGlzLmRhdGEgPSBkYXRhOw0KICAgIHRoaXMuaW5wdXRFbmNvZGluZyA9IGlucHV0RW5jb2RpbmcgfHwgJ3V0Zi04JzsNCiAgICByZXR1cm4gdGhpczsNCiAgfTsNCg0KICBIYXNoLnByb3RvdHlwZS5kaWdlc3QgPSBmdW5jdGlvbihlbmNvZGluZykgew0KICAgIGlmICh0aGlzLmFsZ29yaXRobSA9PSAnbWQ1Jykgew0KICAgICAgcmV0dXJuIF9oYXNoKA0KICAgICAgICAnU3lzdGVtLlNlY3VyaXR5LkNyeXB0b2dyYXBoeS5NRDVDcnlwdG9TZXJ2aWNlUHJvdmlkZXInLA0KICAgICAgICBCdWZmZXIuZnJvbSh0aGlzLmRhdGEsIHRoaXMuaW5wdXRFbmNvZGluZyksDQogICAgICAgIGVuY29kaW5nDQogICAgICApOw0KICAgIH0gZWxzZSBpZiAodGhpcy5hbGdvcml0aG0gPT0gJ3NoYTEnKSB7DQogICAgICByZXR1cm4gX2hhc2goDQogICAgICAgICdTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5LlNIQTFDcnlwdG9TZXJ2aWNlUHJvdmlkZXInLA0KICAgICAgICBCdWZmZXIuZnJvbSh0aGlzLmRhdGEsIHRoaXMuaW5wdXRFbmNvZGluZyksDQogICAgICAgIGVuY29kaW5nDQogICAgICApOw0KICAgIH0NCiAgfTsNCg0KICB2YXIgY3J5cHRvID0gew0KICAgIGNyZWF0ZUNpcGhlcjogZnVuY3Rpb24oYWxnb3JpdGhtLCBwYXNzd29yZCkgew0KICAgICAgcmV0dXJuIG5ldyBDaXBoZXIoYWxnb3JpdGhtLCBwYXNzd29yZCwgdHJ1ZSk7DQogICAgfSwNCg0KICAgIGNyZWF0ZURlQ2lwaGVyOiBmdW5jdGlvbihhbGdvcml0aG0sIHBhc3N3b3JkKSB7DQogICAgICByZXR1cm4gbmV3IENpcGhlcihhbGdvcml0aG0sIHBhc3N3b3JkLCBmYWxzZSk7DQogICAgfSwNCg0KICAgIGNyZWF0ZUhhc2g6IGZ1bmN0aW9uKGFsZ29yaXRobSkgew0KICAgICAgcmV0dXJuIG5ldyBIYXNoKGFsZ29yaXRobSk7DQogICAgfQ0KICB9OwoKICB2YXIgY3J5cHRvJDEgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICAnZGVmYXVsdCc6IGNyeXB0bwogIH0pOwoKICB2YXIgREVGQVVMVF9PUFRJT05TID0gew0KICAgIGhlYWRlcnM6IGZhbHNlLA0KICAgIGRlbGltaXRlcjogJywnLA0KICAgIHF1b3RlOiAnIicsDQogICAgZXNjYXBlOiAnIicsDQogICAgdHJpbTogZmFsc2UsDQogICAgcnRyaW06IGZhbHNlLA0KICAgIGx0cmltOiBmYWxzZSwNCiAgICBuZXdsaW5lOiAnXHJcbicNCiAgfTsNCg0KICB2YXIgRU1QVFlfQ0hBUl9SRUdFWFAgPSAvXHMvOw0KDQogIGZ1bmN0aW9uIFBhcnNlcihvcHRpb25zKSB7DQogICAgT2JqZWN0LmFzc2lnbih0aGlzLCBERUZBVUxUX09QVElPTlMpOw0KICAgIGlmIChvcHRpb25zICE9IG51bGwgJiYgdHlwZW9mIG9wdGlvbnMgPT0gJ29iamVjdCcpIHsNCiAgICAgIE9iamVjdC5hc3NpZ24odGhpcywgb3B0aW9ucyk7DQogICAgfQ0KICB9DQoNCiAgdmFyIFBQID0gUGFyc2VyLnByb3RvdHlwZTsNCg0KICBQUC5pbml0ID0gZnVuY3Rpb24oKSB7DQogICAgdGhpcy5yb3dzID0gW107DQogICAgdGhpcy5yb3cgPSBbXTsNCiAgICB0aGlzLmN1cnNvciA9IDA7DQogICAgdGhpcy5wb3MgPSAwOw0KICAgIHRoaXMuYnVmID0gW107DQogICAgdGhpcy5idWZMZW4gPSAwOw0KICAgIHRoaXMuZXNjYXBpbmcgPSBmYWxzZTsNCiAgfTsNCg0KICBQUC5wYXJzZSA9IGZ1bmN0aW9uIGZyb21TdHJpbmcoc3RyKSB7DQogICAgdmFyIGkgPSAwLA0KICAgICAgbGVuID0gc3RyLmxlbmd0aDsNCiAgICB0aGlzLmluaXQoKTsNCiAgICBmb3IgKDsgaSA8IGxlbjsgaSsrKSB7DQogICAgICB0aGlzLl9jaGFyKHN0ci5jaGFyQXQoaSkpOw0KICAgIH0NCiAgICByZXR1cm4gdGhpcy5fZ2V0UmVzdWx0KCk7DQogIH07DQoNCiAgUFAuX2dldFJlc3VsdCA9IGZ1bmN0aW9uKCkgew0KICAgIHZhciByZXN1bHQsIGhlYWRlcnMsIGxlbjsNCiAgICBpZiAodGhpcy5wb3MgIT09IHRoaXMuY3Vyc29yKSB7DQogICAgICB0aGlzLl9yb3coKTsNCiAgICB9DQogICAgbGVuID0gdGhpcy5yb3dzLmxlbmd0aDsNCiAgICByZXN1bHQgPSB0aGlzLnJvd3M7DQogICAgaWYgKHRoaXMuaGVhZGVycyA9PT0gdHJ1ZSAmJiBsZW4gPiAxKSB7DQogICAgICBoZWFkZXJzID0gdGhpcy5yb3dzWzBdOw0KICAgICAgdGhpcy5yb3dzLnNoaWZ0KCk7DQogICAgfSBlbHNlIGlmIChpc0FycmF5KHRoaXMuaGVhZGVycykgJiYgbGVuID4gMCkgew0KICAgICAgaGVhZGVycyA9IHRoaXMuaGVhZGVyczsNCiAgICB9DQogICAgaWYgKGhlYWRlcnMgJiYgaGVhZGVycy5sZW5ndGggPiAwKSB7DQogICAgICByZXN1bHQgPSB0aGlzLnJvd3MubWFwKCBmdW5jdGlvbihyb3cgKXtyZXR1cm4gIHppcE9iamVjdChoZWFkZXJzLCByb3cpfSk7DQogICAgfQ0KICAgIHJldHVybiByZXN1bHQ7DQogIH07DQoNCiAgUFAuX2NoYXIgPSBmdW5jdGlvbihjKSB7DQogICAgaWYgKGMgPT09IHRoaXMuZGVsaW1pdGVyICYmICF0aGlzLmVzY2FwaW5nKSB7DQogICAgICB0aGlzLl9jZWxsKCk7DQogICAgfSBlbHNlIGlmIChjID09PSB0aGlzLnF1b3RlKSB7DQogICAgICB0aGlzLl9wdXNoKGMpOw0KICAgICAgdGhpcy5fcXVvdGUoKTsNCiAgICB9IGVsc2UgaWYgKGMgPT09IHRoaXMuZXNjYXBlKSB7DQogICAgICB0aGlzLl9wdXNoKGMpOw0KICAgICAgdGhpcy5fZXNjYXBlKCk7DQogICAgfSBlbHNlIGlmIChjID09PSAnXG4nICYmICF0aGlzLmVzY2FwaW5nKSB7DQogICAgICB0aGlzLl9yb3coKTsNCiAgICB9IGVsc2Ugew0KICAgICAgdGhpcy5fcHVzaChjKTsNCiAgICB9DQoNCiAgICB0aGlzLmN1cnNvcisrOw0KICB9Ow0KDQogIFBQLl9wdXNoID0gZnVuY3Rpb24oYykgew0KICAgIGlmICh0aGlzLmJ1ZkxlbiA9PT0gMCkgew0KICAgICAgaWYgKCh0aGlzLnRyaW0gfHwgdGhpcy5sdHJpbSkgJiYgRU1QVFlfQ0hBUl9SRUdFWFAudGVzdChjKSkgcmV0dXJuOw0KICAgICAgaWYgKGMgPT09IHRoaXMucXVvdGUpIHJldHVybjsNCiAgICB9DQogICAgdGhpcy5idWZbdGhpcy5idWZMZW5dID0gYzsNCiAgICB0aGlzLmJ1ZkxlbisrOw0KICB9Ow0KDQogIFBQLl9jZWxsID0gZnVuY3Rpb24oKSB7DQogICAgdmFyIGl0ZW0gPSB0aGlzLl9nZXRWYWx1ZSgpOw0KICAgIHRoaXMucm93LnB1c2goaXRlbSk7DQogIH07DQoNCiAgUFAuX2dldFZhbHVlID0gZnVuY3Rpb24oKSB7DQogICAgdmFyIHJlc3VsdCwgYywgaTsNCiAgICBpID0gdGhpcy5idWZMZW47DQogICAgd2hpbGUgKGktLSkgew0KICAgICAgYyA9IHRoaXMuYnVmW2ldOw0KICAgICAgaWYgKEVNUFRZX0NIQVJfUkVHRVhQLnRlc3QoYykpIHsNCiAgICAgICAgaWYgKHRoaXMudHJpbSB8fCB0aGlzLnJ0cmltKSB7DQogICAgICAgICAgdGhpcy5idWZbaV0gPSAnJzsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgaWYgKGMgPT09IHRoaXMucXVvdGUpIHsNCiAgICAgICAgICB0aGlzLmJ1ZltpXSA9ICcnOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICAgIHJlc3VsdCA9IHRoaXMuYnVmLmpvaW4oJycpOw0KICAgIHRoaXMuYnVmLmxlbmd0aCA9IDA7DQogICAgdGhpcy5idWZMZW4gPSAwOw0KICAgIHJldHVybiByZXN1bHQ7DQogIH07DQoNCiAgUFAuX3JvdyA9IGZ1bmN0aW9uKCkgew0KICAgIGlmICh0aGlzLmJ1ZkxlbiA+IDAgJiYgdGhpcy5idWZbdGhpcy5idWZMZW4gLSAxXSA9PT0gJ1xyJykgew0KICAgICAgdGhpcy5idWZbdGhpcy5idWZMZW4gLSAxXSA9ICcnOw0KICAgIH0NCiAgICB0aGlzLl9jZWxsKCk7DQogICAgdGhpcy5yb3dzLnB1c2godGhpcy5yb3cpOw0KICAgIHRoaXMucm93ID0gW107DQogICAgdGhpcy5wb3MgPSB0aGlzLmN1cnNvcjsNCiAgfTsNCg0KICBQUC5fcXVvdGUgPSBmdW5jdGlvbigpIHsNCiAgICB0aGlzLmVzY2FwaW5nID0gIXRoaXMuZXNjYXBpbmc7DQogICAgaWYgKHRoaXMuYnVmTGVuID4gMSAmJiB0aGlzLmJ1Zlt0aGlzLmJ1ZkxlbiAtIDJdID09PSB0aGlzLmVzY2FwZSkgew0KICAgICAgdGhpcy5idWZbdGhpcy5idWZMZW4gLSAyXSA9IHRoaXMuYnVmW3RoaXMuYnVmTGVuIC0gMV07DQogICAgICB0aGlzLmJ1Zlt0aGlzLmJ1ZkxlbiAtIDFdID0gJyc7DQogICAgfQ0KICB9Ow0KDQogIFBQLl9lc2NhcGUgPSBmdW5jdGlvbigpIHsNCiAgICB0aGlzLmVzY2FwaW5nID0gIXRoaXMuZXNjYXBpbmc7DQogIH07DQoNCiAgZnVuY3Rpb24gY3JlYXRlUGFyc2VyKG9wdGlvbnMpIHsNCiAgICByZXR1cm4gbmV3IFBhcnNlcihvcHRpb25zKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHBhcnNlJDIoc3RyLCBvcHRpb25zKSB7DQogICAgcmV0dXJuIG5ldyBQYXJzZXIob3B0aW9ucykucGFyc2Uoc3RyKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIEZvcm1hdHRlcihvcHRpb25zKSB7DQogICAgT2JqZWN0LmFzc2lnbih0aGlzLCBERUZBVUxUX09QVElPTlMpOw0KICAgIGlmIChvcHRpb25zICE9IG51bGwgJiYgdHlwZW9mIG9wdGlvbnMgPT0gJ29iamVjdCcpDQogICAgICBPYmplY3QuYXNzaWduKHRoaXMsIG9wdGlvbnMpOw0KICB9DQoNCiAgdmFyIEZQID0gRm9ybWF0dGVyLnByb3RvdHlwZTsNCg0KICBGUC5pbml0ID0gZnVuY3Rpb24oKSB7DQogICAgdGhpcy5yb3dzID0gW107DQogIH07DQoNCiAgRlAuc3RyaW5naWZ5ID0gZnVuY3Rpb24oZGF0YSkgew0KICAgIHZhciByb3csIGksIGxlbiwgcm93RGF0YUlzQXJyYXk7DQogICAgdGhpcy5pbml0KCk7DQogICAgaWYgKGlzQXJyYXkodGhpcy5oZWFkZXJzKSkgew0KICAgICAgdGhpcy5fYXBwZW5kTGluZSh0aGlzLmhlYWRlcnMpOw0KICAgIH0NCiAgICBsZW4gPSBpc0FycmF5KGRhdGEpICYmIGRhdGEubGVuZ3RoOw0KICAgIGlmIChsZW4gJiYgbGVuID4gMCkgew0KICAgICAgaSA9IDA7DQogICAgICByb3cgPSBkYXRhWzBdOw0KICAgICAgcm93RGF0YUlzQXJyYXkgPSBpc0FycmF5KHJvdyk7DQogICAgICBpZiAocm93RGF0YUlzQXJyYXkpIHsNCiAgICAgICAgaWYgKHRoaXMuaGVhZGVycyA9PT0gdHJ1ZSkgew0KICAgICAgICAgIHRoaXMuaGVhZGVycyA9IHJvdzsNCiAgICAgICAgICB0aGlzLl9hcHBlbmRMaW5lKHRoaXMuaGVhZGVycyk7DQogICAgICAgICAgaSA9IDE7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMuaGVhZGVycyA9IE9iamVjdC5rZXlzKHJvdyk7DQogICAgICAgIHRoaXMuX2FwcGVuZExpbmUodGhpcy5oZWFkZXJzKTsNCiAgICAgIH0NCg0KICAgICAgZm9yICg7IGkgPCBsZW47IGkrKykgew0KICAgICAgICByb3cgPSBkYXRhW2ldOw0KICAgICAgICBpZiAocm93RGF0YUlzQXJyYXkpIHRoaXMuX2FwcGVuZExpbmUocm93KTsNCiAgICAgICAgZWxzZSB0aGlzLl9hcHBlbmRMaW5lKG1hcChyb3cpKTsNCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIHRoaXMuX2dldFJlc3VsdCgpOw0KICB9Ow0KDQogIEZQLl9hcHBlbmRMaW5lID0gZnVuY3Rpb24ocm93KSB7DQogICAgdmFyIHF1b3RlID0gdGhpcy5xdW90ZTsNCiAgICB2YXIgZXNjYXBlX3F1b3RlID0gdGhpcy5lc2NhcGUgKyBxdW90ZTsNCiAgICB2YXIgcXVvdGVSZWdleHAgPSAvIi9nOw0KICAgIHZhciBsaW5lID0gcm93DQogICAgICAubWFwKCBmdW5jdGlvbihpdGVtICkgew0KICAgICAgICBpZiAoaXRlbSA9PSBudWxsKSB7DQogICAgICAgICAgcmV0dXJuICcnOw0KICAgICAgICB9IGVsc2UgaWYgKGlzU3RyaW5nKGl0ZW0pKSB7DQogICAgICAgICAgaWYgKGl0ZW0uaW5jbHVkZXMocXVvdGUpKSB7DQogICAgICAgICAgICByZXR1cm4gcXVvdGUgKyBpdGVtLnJlcGxhY2UocXVvdGVSZWdleHAsIGVzY2FwZV9xdW90ZSkgKyBxdW90ZTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIGl0ZW07DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiBpdGVtICsgJyc7DQogICAgICAgIH0NCiAgICAgIH0pDQogICAgICAuam9pbih0aGlzLmRlbGltaXRlcik7DQogICAgdGhpcy5yb3dzLnB1c2gobGluZSk7DQogIH07DQoNCiAgRlAuX2dldFJlc3VsdCA9IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiB0aGlzLnJvd3Muam9pbih0aGlzLm5ld2xpbmUpOw0KICB9Ow0KDQogIGZ1bmN0aW9uIGNyZWF0ZUZvcm1hdHRlcihvcHRpb25zKSB7DQogICAgcmV0dXJuIG5ldyBGb3JtYXR0ZXIob3B0aW9ucyk7DQogIH0NCg0KICBmdW5jdGlvbiBzdHJpbmdpZnkkMShkYXRhLCBvcHRpb25zKSB7DQogICAgcmV0dXJuIG5ldyBGb3JtYXR0ZXIob3B0aW9ucykuc3RyaW5naWZ5KGRhdGEpOw0KICB9CgogIHZhciBjc3YgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICBjcmVhdGVQYXJzZXI6IGNyZWF0ZVBhcnNlciwKICAgIHBhcnNlOiBwYXJzZSQyLAogICAgY3JlYXRlRm9ybWF0dGVyOiBjcmVhdGVGb3JtYXR0ZXIsCiAgICBzdHJpbmdpZnk6IHN0cmluZ2lmeSQxCiAgfSk7CgogIHZhciBBUFBfSUQgPSAnRXhjZWwuQXBwbGljYXRpb24nOw0KDQogIHZhciBFWENFTF9QUk9UTyA9IHsNCiAgICBjbG9zZTogZnVuY3Rpb24oKSB7DQogICAgICB0aGlzLmFwcCAmJiB0aGlzLmFwcC5RdWl0KCk7DQogICAgICB0aGlzLmFwcCA9IG51bGw7DQogICAgfSwNCiAgICBnZXRCb29rOiBmdW5jdGlvbihuYW1lKSB7DQogICAgICByZXR1cm4gbmFtZSA/IHRoaXMuYXBwLldvcmtCb29rcyhuYW1lKSA6IHRoaXMuYWN0aXZlQm9vazsNCiAgICB9LA0KICAgIGdldFNoZWV0OiBmdW5jdGlvbihzaGVldE5hbWUsIGJvb2tOYW1lKSB7DQogICAgICByZXR1cm4gc2hlZXROYW1lDQogICAgICAgID8gdGhpcy5nZXRCb29rKGJvb2tOYW1lKS5TaGVldHMoc2hlZXROYW1lKQ0KICAgICAgICA6IHRoaXMuYWN0aXZlU2hlZXQ7DQogICAgfSwNCiAgICByYW5nZTogZnVuY3Rpb24oYWRkcikgew0KICAgICAgcmV0dXJuIGFkZHIgPyB0aGlzLmFwcC5SYW5nZShhZGRyKSA6IHRoaXMuc2VsZWN0aW9uOw0KICAgIH0sDQogICAgZ2V0UmFuZ2U6IGZ1bmN0aW9uKHN0clJhbmdlLCBzaGVldE5hbWUsIGJvb2tOYW1lKSB7DQogICAgICByZXR1cm4gc3RyUmFuZ2UNCiAgICAgICAgPyB0aGlzLmdldFNoZWV0KHNoZWV0TmFtZSwgYm9va05hbWUpLlJhbmdlKHN0clJhbmdlKQ0KICAgICAgICA6IHRoaXMuc2VsZWN0aW9uOw0KICAgIH0sDQogICAgY2VsbDogZnVuY3Rpb24ocm93LCBjb2wpIHsNCiAgICAgIHJldHVybiByb3cgJiYgY29sID8gdGhpcy5hcHAuQ2VsbHMocm93LCBjb2wpIDogdGhpcy5hY3RpdmVDZWxsOw0KICAgIH0sDQogICAgZ2V0Q2VsbDogZnVuY3Rpb24ocm93LCBjb2wsIHNoZWV0TmFtZSwgYm9va05hbWUpIHsNCiAgICAgIHJldHVybiByb3cgJiYgY29sDQogICAgICAgID8gdGhpcy5nZXRTaGVldChzaGVldE5hbWUsIGJvb2tOYW1lKS5DZWxscyhyb3csIGNvbCkNCiAgICAgICAgOiB0aGlzLmFjdGl2ZUNlbGw7DQogICAgfSwNCiAgICBnZXRCb29rczogZnVuY3Rpb24oKSB7DQogICAgICByZXR1cm4gbWFwKHRoaXMuYm9va3MpOw0KICAgIH0sDQogICAgb3BlbkJvb2s6IGZ1bmN0aW9uKHBhdGgpIHsNCiAgICAgIGlmICghaXNmaWxlKHBhdGgpKSByZXR1cm4gbnVsbDsNCiAgICAgIHZhciB0YXJnZXQgPSBmaW5kJDEodGhpcy5ib29rcywgZnVuY3Rpb24oIGJvb2sgKXtyZXR1cm4gIGJvb2suTmFtZSA9PSBiYXNlbmFtZShwYXRoKX0pOw0KICAgICAgcmV0dXJuIHRhcmdldCA/IHRhcmdldCA6IHRoaXMuYm9va3MuT3BlbihwYXRoKTsNCiAgICB9LA0KICAgIG5ld0Jvb2s6IGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuIHRoaXMuYm9va3MuYWRkKCk7DQogICAgfSwNCiAgICBnZXRTaGVldHM6IGZ1bmN0aW9uKGJvb2spIHsNCiAgICAgIHJldHVybiBtYXAodGhpcy5nZXRCb29rKGJvb2spLlNoZWV0cyk7DQogICAgfSwNCiAgICBmaW5kQm9vazogZnVuY3Rpb24ocGF0dGVybikgew0KICAgICAgdmFyIGlzTWF0Y2ggPSBtYXRjaGVyJDEocGF0dGVybik7DQogICAgICByZXR1cm4gaXNNYXRjaCAmJiBmaW5kJDEodGhpcy5ib29rcywgaXNNYXRjaCk7DQogICAgfSwNCiAgICBmaW5kU2hlZXQ6IGZ1bmN0aW9uKHBhdHRlcm4sIF9ib29rKSB7DQogICAgICB2YXIgYm9vaywgaXNNYXRjaDsNCiAgICAgIGlmIChfYm9vaykgew0KICAgICAgICBib29rID0gdGhpcy5maW5kQm9vayhfYm9vayk7DQogICAgICAgIGlmICghYm9vaykgYm9vayA9IF9ib29rOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgYm9vayA9IHRoaXMuYWN0aXZlQm9vazsNCiAgICAgIH0NCiAgICAgIGlzTWF0Y2ggPSBtYXRjaGVyJDEocGF0dGVybik7DQogICAgICByZXR1cm4gaXNNYXRjaCAmJiBmaW5kJDEoYm9vay5TaGVldHMsIGlzTWF0Y2gpOw0KICAgIH0sDQogICAgZ2V0VmFsdWVzOiBmdW5jdGlvbihyYW5nZSkgew0KICAgICAgdmFyIHJvd05vLA0KICAgICAgICB0YmwgPSBbXSwNCiAgICAgICAgcm93RGF0YTsNCiAgICAgIGVhY2gocmFuZ2UsIGZ1bmN0aW9uKCByICkgew0KICAgICAgICBpZiAocm93Tm8gIT0gci5Sb3cpIHsNCiAgICAgICAgICBpZiAocm93RGF0YSkgdGJsLnB1c2gocm93RGF0YSk7DQogICAgICAgICAgcm93RGF0YSA9IFtdOw0KICAgICAgICAgIHJvd05vID0gci5Sb3c7DQogICAgICAgIH0NCiAgICAgICAgcm93RGF0YS5wdXNoKHIudmFsdWUpOw0KICAgICAgfSk7DQogICAgICBpZiAocm93RGF0YSkgdGJsLnB1c2gocm93RGF0YSk7DQogICAgICByZXR1cm4gdGJsOw0KICAgIH0sDQogICAgc2V0VmFsdWVzOiBmdW5jdGlvbihyYW5nZSwgdmFscykgew0KICAgICAgaWYgKGlzQXJyYXkodmFscykpIHsNCiAgICAgICAgZWFjaCh2YWxzLCBmdW5jdGlvbiggdmFsICkgew0KICAgICAgICAgIGlmIChpc0FycmF5KHZhbCkpIHsNCiAgICAgICAgICAgIGVhY2godmFsLCBmdW5jdGlvbiAoaXQsIGkpICB7DQogICAgICAgICAgICAgIHJhbmdlLm9mZnNldCgwLCBpKS52YWx1ZSA9IGl0Ow0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJhbmdlLnZhbHVlID0gdmFsOw0KICAgICAgICAgIH0NCiAgICAgICAgICByYW5nZSA9IHJhbmdlLm9mZnNldCgxLCAwKTsNCiAgICAgICAgfSk7DQogICAgICB9DQogICAgfSwNCiAgICBub191cGRhdGU6IGZ1bmN0aW9uKGNiKSB7DQogICAgICB0cnkgew0KICAgICAgICB0aGlzLmFwcC5TY3JlZW5VcGRhdGluZyA9IGZhbHNlOw0KICAgICAgICBjYigpOw0KICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgdGhpcy5hcHAuU2NyZWVuVXBkYXRpbmcgPSB0cnVlOw0KICAgICAgfQ0KICAgIH0sDQogICAgdXBkYXRlOiBmdW5jdGlvbihjYikgew0KICAgICAgdHJ5IHsNCiAgICAgICAgdGhpcy5hcHAuU2NyZWVuVXBkYXRpbmcgPSB0cnVlOw0KICAgICAgICBjYigpOw0KICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgdGhpcy5hcHAuU2NyZWVuVXBkYXRpbmcgPSBmYWxzZTsNCiAgICAgIH0NCiAgICB9DQogIH07DQoNCiAgdmFyIEVYQ0VMX1BST1BTID0gew0KICAgIGFjdGl2ZUJvb2s6IHsNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB0aGlzLmFwcC5BY3RpdmVXb3JrQm9vazsNCiAgICAgIH0NCiAgICB9LA0KICAgIGFjdGl2ZVNoZWV0OiB7DQogICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5hcHAuQWN0aXZlU2hlZXQ7DQogICAgICB9DQogICAgfSwNCiAgICBhY3RpdmVDZWxsOiB7DQogICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5hcHAuQWN0aXZlQ2VsbDsNCiAgICAgIH0NCiAgICB9LA0KICAgIHNlbGVjdGlvbjogew0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuYXBwLlNlbGVjdGlvbjsNCiAgICAgIH0NCiAgICB9LA0KICAgIGJvb2tzOiB7DQogICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5hcHAuV29ya0Jvb2tzOw0KICAgICAgfQ0KICAgIH0NCiAgfTsNCg0KICBmdW5jdGlvbiBFeGNlbChwdGgpIHsNCiAgICB2YXIgYXBwLCB4bDsNCiAgICB0cnkgew0KICAgICAgYXBwID0gR2V0T2JqZWN0KHB0aCB8fCAnJywgQVBQX0lEKTsNCiAgICB9IGNhdGNoIChlKSB7DQogICAgICBhcHAgPSBuZXcgQWN0aXZlWE9iamVjdChBUFBfSUQpOw0KICAgIH0NCiAgICBpZiAoIWFwcC5WaXNpYmxlKSBhcHAuVmlzaWJsZSA9IHRydWU7DQogICAgaWYgKGFwcC5Xb3JrYm9va3MuQ291bnQgPT09IDApIGFwcC5Xb3JrYm9va3MuQWRkKCk7DQogICAgeGwgPSBPYmplY3QuY3JlYXRlKEVYQ0VMX1BST1RPLCBFWENFTF9QUk9QUyk7DQogICAgeGwuYXBwID0gYXBwOw0KICAgIHJldHVybiB4bDsNCiAgfQ0KDQogIGV4dGVuZChFeGNlbCwgew0KICAgIHhsZG93bjogLTQxMjEsDQogICAgeGxUb0xlZnQ6IC00MTU5LA0KICAgIHhsVG9SaWdodDogLTQxNjEsDQogICAgeGx1cDogLTQxNjINCiAgfSk7DQoNCiAgZnVuY3Rpb24gZmluZCQxKGl0ZW1zLCBmbikgew0KICAgIHZhciBlbiA9IG5ldyBFbnVtZXJhdG9yKGl0ZW1zKTsNCiAgICB2YXIgaXRlbTsNCiAgICBmb3IgKHZhciBpID0gMDsgIWVuLmF0RW5kKCk7IGVuLm1vdmVOZXh0KCksIGkrKykgew0KICAgICAgaXRlbSA9IGVuLml0ZW0oKTsNCiAgICAgIGlmIChmbihpdGVtLCBpKSA9PT0gdHJ1ZSkgcmV0dXJuIGl0ZW07DQogICAgfQ0KICAgIHJldHVybiBudWxsOw0KICB9DQoNCiAgZnVuY3Rpb24gbWF0Y2hlciQxKHBhdHRlcm4pIHsNCiAgICB2YXIgaXNNYXRjaDsNCiAgICBpZiAoaXNGdW5jdGlvbihwYXR0ZXJuKSkgaXNNYXRjaCA9IHBhdHRlcm47DQogICAgZWxzZSBpZiAoaXNTdHJpbmcocGF0dGVybikpIGlzTWF0Y2ggPSBmdW5jdGlvbiggaXQgKXtyZXR1cm4gIGl0Lk5hbWUuaW5jbHVkZXMocGF0dGVybil9Ow0KICAgIGVsc2UgaWYgKGlzUmVnRXhwKHBhdHRlcm4pKSBpc01hdGNoID0gZnVuY3Rpb24oIGl0ICl7cmV0dXJuICBwYXR0ZXJuLnRlc3QoaXQuTmFtZSl9Ow0KICAgIGVsc2UgaXNNYXRjaCA9IG51bGw7DQogICAgcmV0dXJuIGlzTWF0Y2g7DQogIH0KCiAgdmFyIGV4Y2VsID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgJ2RlZmF1bHQnOiBFeGNlbAogIH0pOwoKICBmdW5jdGlvbiBnZXRXaW5kb3dzKCkgew0KICAgIHZhciB3aW5zID0gW107DQogICAgZWFjaChfX1NoZWxsQXBwLldpbmRvd3MoKSwgZnVuY3Rpb24oIGFwcCApIHsNCiAgICAgIGlmIChhcHAgJiYgYXBwLk5hbWUgPT09ICdJbnRlcm5ldCBFeHBsb3JlcicpIHsNCiAgICAgICAgd2lucy5wdXNoKGFwcCk7DQogICAgICB9DQogICAgfSk7DQogICAgcmV0dXJuIHdpbnM7DQogIH0NCg0KICBmdW5jdGlvbiBnZXRBY3RpdmUoKSB7DQogICAgdmFyIGllOw0KICAgIGVhY2goX19TaGVsbEFwcC5XaW5kb3dzKCksIGZ1bmN0aW9uKCBhcHAgKSB7DQogICAgICBpZiAoYXBwICYmIGFwcC5OYW1lID09PSAnSW50ZXJuZXQgRXhwbG9yZXInICYmICFhcHAuRG9jdW1lbnQuaGlkZGVuKSB7DQogICAgICAgIGllID0gYXBwOw0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICB9DQogICAgfSk7DQogICAgcmV0dXJuIGllOw0KICB9DQoNCiAgZnVuY3Rpb24gZ2V0SUUoKSB7DQogICAgdmFyIGllOw0KICAgIGVhY2goX19TaGVsbEFwcC5XaW5kb3dzKCksIGZ1bmN0aW9uKCBhcHAgKSB7DQogICAgICBpZiAoYXBwICYmIGFwcC5OYW1lID09PSAnSW50ZXJuZXQgRXhwbG9yZXInKSB7DQogICAgICAgIGllID0gYXBwOw0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICB9DQogICAgfSk7DQogICAgcmV0dXJuIGllOw0KICB9DQoNCiAgZnVuY3Rpb24gd2FpdChpZSwgdGltZW91dCkgew0KICAgIHZhciBlbGFwc2VkID0gMDsNCiAgICB0aW1lb3V0IHx8ICh0aW1lb3V0ID0gNTAwMCk7DQogICAgd2hpbGUgKGllLkJ1c3kgfHwgaWUuUmVhZHlTdGF0ZSAhPT0gNCkgew0KICAgICAgaWYgKGVsYXBzZWQgPj0gdGltZW91dCkgew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0lFIHRpbWVvdXQnKTsNCiAgICAgIH0NCiAgICAgIGVsYXBzZWQgKz0gMTAwOw0KICAgICAgcHJvY2Vzcy5zbGVlcCgxMDApOw0KICAgIH0NCiAgfQ0KDQogIHZhciBJRV9PUFRJT05TID0gWw0KICAgICdBZGRyZXNzQmFyJywNCiAgICAnRnVsbFNjcmVlbicsDQogICAgJ1dpZHRoJywNCiAgICAnSGVpZ2h0JywNCiAgICAnVG9wJywNCiAgICAnTGVmdCcsDQogICAgJ01lbnVCYXInLA0KICAgICdSZXNpemFibGUnLA0KICAgICdTaWxlbnQnLA0KICAgICdTdGF0dXNCYXInLA0KICAgICdUb29sQmFyJywNCiAgICAnVmlzaWJsZScNCiAgXS5yZWR1Y2UoIGZ1bmN0aW9uKG1lbW8sIGl0KSAgew0KICAgIG1lbW9baXRdID0gaXQ7DQogICAgbWVtb1tpdC50b0xvd2VyQ2FzZSgpXSA9IGl0Ow0KICAgIHJldHVybiBtZW1vOw0KICB9LCB7fSk7DQoNCiAgZnVuY3Rpb24gb3Blbih1cmwsIG9wdGlvbnMpIHsNCiAgICB2YXIgaWUgPSBuZXcgQWN0aXZlWE9iamVjdCgnSW50ZXJuZXRFeHBsb3Jlci5BcHBsaWNhdGlvbicpOw0KICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7DQogICAgZWFjaChvcHRpb25zLCBmdW5jdGlvbiAodiwgaykgIHsNCiAgICAgIHZhciBwcm9wID0gSUVfT1BUSU9OU1trXTsNCiAgICAgIGlmIChwcm9wKSBpZVtwcm9wXSA9IHY7DQogICAgfSk7DQogICAgaWYgKCFoYXMob3B0aW9ucywgJ3Zpc2libGUnKSAmJiAhaGFzKG9wdGlvbnMsICdWaXNpYmxlJykpIHsNCiAgICAgIGllLlZpc2libGUgPSB0cnVlOw0KICAgIH0NCiAgICBpZS5OYXZpZ2F0ZSh1cmwgfHwgJ2Fib3V0OmJsYW5rJyk7DQogICAgd2FpdChpZSwgb3B0aW9ucy50aW1lb3V0KTsNCiAgICByZXR1cm4gaWU7DQogIH0KCiAgdmFyIGllID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgZ2V0V2luZG93czogZ2V0V2luZG93cywKICAgIGdldEFjdGl2ZTogZ2V0QWN0aXZlLAogICAgZ2V0SUU6IGdldElFLAogICAgd2FpdDogd2FpdCwKICAgIG9wZW46IG9wZW4KICB9KTsKCiAgdmFyIEFQUF9JRCQxID0gJ091dGxvb2suQXBwbGljYXRpb24nOw0KICB2YXIgb2xNYWlsSXRlbSA9IDA7DQoNCiAgdmFyIE9VVExPT0tfUFJPVE8gPSB7DQogICAgY3JlYXRlTWFpbDogZnVuY3Rpb24ob3B0aW9ucykgew0KICAgICAgdmFyIGl0ZW0gPSB0aGlzLmFwcC5DcmVhdGVJdGVtKG9sTWFpbEl0ZW0pOw0KICAgICAgaWYgKG9wdGlvbnMpIHsNCiAgICAgICAgZWFjaChvcHRpb25zLCBmdW5jdGlvbiAodmFsdWUsIGtleSkgIHsNCiAgICAgICAgICBpdGVtW2tleV0gPSB2YWx1ZTsNCiAgICAgICAgfSk7DQogICAgICB9DQogICAgICBpdGVtLkRpc3BsYXkoKTsNCiAgICAgIHJldHVybiBpdGVtOw0KICAgIH0NCiAgfTsNCg0KICB2YXIgT1VUTE9PS19QUk9QUyA9IHsNCiAgICBhcHA6IHsgdmFsdWU6IG51bGwsIHdyaXRhYmxlOiB0cnVlIH0NCiAgfTsNCg0KICBmdW5jdGlvbiBPdXRsb29rKCkgew0KICAgIHZhciBhcHA7DQogICAgdHJ5IHsNCiAgICAgIGFwcCA9IEdldE9iamVjdCgnJywgQVBQX0lEJDEpOw0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgIGFwcCA9IG5ldyBBY3RpdmVYT2JqZWN0KEFQUF9JRCQxKTsNCiAgICB9DQogICAgdmFyIG9sID0gT2JqZWN0LmNyZWF0ZShPVVRMT09LX1BST1RPLCBPVVRMT09LX1BST1BTKTsNCiAgICBvbC5hcHAgPSBhcHA7DQogICAgcmV0dXJuIG9sOw0KICB9CgogIHZhciBvdXRsb29rID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgJ2RlZmF1bHQnOiBPdXRsb29rCiAgfSk7CgogIHZhciBhZFVzZUNsaWVudCA9IDM7DQogIHZhciBhZFVzZU5vbmUgPSAxOw0KICB2YXIgYWRVc2VTZXJ2ZXIgPSAyOw0KDQogIHZhciBhZExvY2tVbnNwZWNpZmllZCA9IC0xOw0KICB2YXIgYWRMb2NrUmVhZE9ubHkgPSAxOw0KICB2YXIgYWRMb2NrUGVzc2ltaXN0aWMgPSAyOw0KICB2YXIgYWRMb2NrT3B0aW1pc3RpYyA9IDM7DQogIHZhciBhZExvY2tCYXRjaE9wdGltaXN0aWMgPSA0Ow0KDQogIHZhciBhZE9wZW5VbnNwZWNpZmllZCA9IC0xOw0KICB2YXIgYWRPcGVuRm9yd2FyZE9ubHkgPSAwOw0KICB2YXIgYWRPcGVuS2V5c2V0ID0gMTsNCiAgdmFyIGFkT3BlbkR5bmFtaWMgPSAyOw0KICB2YXIgYWRPcGVuU3RhdGljID0gMzsNCg0KICB2YXIgYWRCaWdJbnQgPSAyMDsNCiAgdmFyIGFkQmluYXJ5ID0gMTI4Ow0KICB2YXIgYWRCb29sZWFuID0gMTE7DQogIHZhciBhZENoYXIgPSAxMjk7DQogIHZhciBhZEN1cnJlbmN5ID0gNjsNCiAgdmFyIGFkRGF0ZSA9IDc7DQogIHZhciBhZERCRGF0ZSA9IDEzMzsNCiAgdmFyIGFkREJUaW1lID0gMTM0Ow0KICB2YXIgYWREQlRpbWVTdGFtcCA9IDEzNTsNCiAgdmFyIGFkRGVjaW1hbCA9IDE0Ow0KICB2YXIgYWREb3VibGUgPSA1Ow0KICB2YXIgYWRHVUlEID0gNzI7DQogIHZhciBhZElEaXNwYXRjaCA9IDk7DQogIHZhciBhZEludGVnZXIgPSAzOw0KICB2YXIgYWRMb25nVmFyQmluYXJ5ID0gMjA1Ow0KICB2YXIgYWRMb25nVmFyQ2hhciA9IDIwMTsNCiAgdmFyIGFkTG9uZ1ZhcldDaGFyID0gMjAzOw0KICB2YXIgYWROdW1lcmljID0gMTMxOw0KICB2YXIgYWRTaW5nbGUgPSA0Ow0KICB2YXIgYWRTbWFsbEludCA9IDI7DQogIHZhciBhZFVuc2lnbmVkVGlueUludCA9IDE3Ow0KICB2YXIgYWRWYXJCaW5hcnkgPSAyMDQ7DQogIHZhciBhZFZhckNoYXIgPSAyMDA7DQogIHZhciBhZFZhcmlhbnQgPSAxMjsNCiAgdmFyIGFkVmFyV0NoYXIgPSAyMDI7DQogIHZhciBhZFdDaGFyID0gMTMwOw0KDQogIHZhciBhZFBhcmFtVW5rbm93biA9IDA7DQogIHZhciBhZFBhcmFtSW5wdXQgPSAxOw0KICB2YXIgYWRQYXJhbU91dHB1dCA9IDI7DQogIHZhciBhZFBhcmFtSW5wdXRPdXRwdXQgPSAzOw0KICB2YXIgYWRQYXJhbVJldHVyblZhbHVlID0gNDsNCg0KICB2YXIgYWRTY2hlbWFUYWJsZXMgPSAyMDsNCiAgdmFyIGFkU2NoZW1hQ29sdW1ucyA9IDQ7DQoNCiAgZnVuY3Rpb24gQWRvZGIoKSB7DQogICAgdGhpcy5jb25uID0gbmV3IEFjdGl2ZVhPYmplY3QoJ0FET0RCLkNvbm5lY3Rpb24nKTsNCiAgfQ0KDQogIEFkb2RiLnByb3RvdHlwZSA9IHsNCiAgICBjbG9zZTogZnVuY3Rpb24oKSB7DQogICAgICB0aGlzLmNvbm4gJiYgdGhpcy5jb25uLlN0YXRlICE9IDAgJiYgdGhpcy5jb25uLkNsb3NlKCk7DQogICAgICB0aGlzLmNvbm4gPSBudWxsOw0KICAgIH0sDQoNCiAgICBiZWdpbjogZnVuY3Rpb24oKSB7DQogICAgICB0aGlzLmNvbm4uQmVnaW5UcmFucygpOw0KICAgIH0sDQoNCiAgICBjb21taXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgdGhpcy5jb25uLkNvbW1pdFRyYW5zKCk7DQogICAgfSwNCg0KICAgIHJvbGxiYWNrOiBmdW5jdGlvbigpIHsNCiAgICAgIHRoaXMuY29ubi5Sb2xsYmFja1RyYW5zKCk7DQogICAgfSwNCg0KICAgIGdldE9wdGlvbnM6IGZ1bmN0aW9uKGFyZ3MpIHsNCiAgICAgIGlmICh0eXBlb2YgYXJnc1swXSA9PT0gJ29iamVjdCcgJiYgYXJnc1swXS5faXNfb3B0aW9ucykgcmV0dXJuIGFyZ3NbMF07DQogICAgICB2YXIgaSA9IC0xLA0KICAgICAgICBsZW4gPSBhcmdzLmxlbmd0aCwNCiAgICAgICAgYXJnLA0KICAgICAgICBvcCA9IHsgX2lzX29wdGlvbnM6IHRydWUgfTsNCiAgICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgICAgYXJnID0gYXJnc1tpXTsNCiAgICAgICAgc3dpdGNoICh0eXBlT2YoYXJnKSkgew0KICAgICAgICAgIGNhc2UgJ3N0cmluZyc6DQogICAgICAgICAgICBvcC5zcWwgPSBhcmc7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgICBjYXNlICdhcnJheSc6DQogICAgICAgICAgY2FzZSAnb2JqZWN0JzoNCiAgICAgICAgICAgIG9wLnBhcmFtcyA9IGFyZzsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOg0KICAgICAgICAgICAgb3AucHJlcGFyZWQgPSBhcmc7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgICBjYXNlICdmdW5jdGlvbic6DQogICAgICAgICAgICBvcC5jYWxsYmFjayA9IGFyZzsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgICB9DQogICAgICByZXR1cm4gb3A7DQogICAgfSwNCg0KICAgIGdldERhdGFUeXBlTWFwcGluZzogZnVuY3Rpb24oKSB7DQogICAgICByZXR1cm4gew0KICAgICAgICBzdHJpbmc6IGFkVmFyV0NoYXIsDQogICAgICAgIGludDogYWRTbWFsbEludCwNCiAgICAgICAgZGVjaW1hbDogYWREb3VibGUsDQogICAgICAgIGJvb2xlYW46IGFkQm9vbGVhbiwNCiAgICAgICAgZGF0ZTogYWREYXRlLA0KICAgICAgICBudWxsOiBhZFZhcldDaGFyDQogICAgICB9Ow0KICAgIH0sDQoNCiAgICBjcmVhdGVQYXJhbXM6IGZ1bmN0aW9uKG9wdHMpIHsNCiAgICAgIHZhciBjbWRvYmogPSBvcHRzLmNtZCwNCiAgICAgICAgcGFyYW1zID0gb3B0cy5wYXJhbXM7DQogICAgICBpZiAoIWNtZG9iaiB8fCAhcGFyYW1zKSByZXR1cm47DQogICAgICB2YXIganNUeXBlLA0KICAgICAgICB0cCwNCiAgICAgICAgc2l6ZSA9IDEwLA0KICAgICAgICBkdG1hcCA9IHRoaXMuZ2V0RGF0YVR5cGVNYXBwaW5nKCk7DQogICAgICBlYWNoKHBhcmFtcywgZnVuY3Rpb24gKHZhbHVlLCBuYW1lKSAgew0KICAgICAgICBqc1R5cGUgPSB0eXBlT2YodmFsdWUpOw0KICAgICAgICBzd2l0Y2ggKGpzVHlwZSkgew0KICAgICAgICAgIGNhc2UgJ3N0cmluZyc6DQogICAgICAgICAgICB0cCA9IGR0bWFwWydzdHJpbmcnXTsNCiAgICAgICAgICAgIHNpemUgPSB0cCA9PT0gYWRWYXJpYW50ID8gdmFsdWUubGVuZ3RoICogMiA6IHZhbHVlLmxlbmd0aDsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgIGNhc2UgJ251bWJlcic6DQogICAgICAgICAgICB0cCA9IGlzSW50ZWdlcih2YWx1ZSkgPyBkdG1hcFsnaW50J10gOiBkdG1hcFsnZGVjaW1hbCddOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgY2FzZSAnYm9vbGVhbic6DQogICAgICAgICAgICB0cCA9IGR0bWFwWydib29sZWFuJ107DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgICBjYXNlICdkYXRlJzoNCiAgICAgICAgICAgIHRwID0gZHRtYXBbJ2RhdGUnXTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgIGNhc2UgJ251bGwnOg0KICAgICAgICAgIGNhc2UgJ3VuZGVmaW5lZCc6DQogICAgICAgICAgICB0cCA9IGR0bWFwWydudWxsJ107DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBZG9kYi5jcmVhdGVQYXJhbXM6IHVuZXhwZWN0ZWQgdHlwZSAnICsganNUeXBlKTsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgcGFyYW1vYmogPSBjbWRvYmouQ3JlYXRlUGFyYW1ldGVyKA0KICAgICAgICAgIG5hbWUsDQogICAgICAgICAgdHAsDQogICAgICAgICAgYWRQYXJhbUlucHV0LA0KICAgICAgICAgIHNpemUsDQogICAgICAgICAgdmFsdWUNCiAgICAgICAgKTsNCiAgICAgICAgY21kb2JqLlBhcmFtZXRlcnMuQXBwZW5kKHBhcmFtb2JqKTsNCiAgICAgIH0pOw0KICAgIH0sDQoNCiAgICBleGVjdXRlOiBmdW5jdGlvbigpIHsNCiAgICAgIHZhciBvcCA9IHRoaXMuZ2V0T3B0aW9ucyhhcmd1bWVudHMpOw0KICAgICAgdHJ5IHsNCiAgICAgICAgdmFyIGNtZCA9IG5ldyBBY3RpdmVYT2JqZWN0KCdBRE9EQi5Db21tYW5kJyk7DQogICAgICAgIGNtZC5BY3RpdmVDb25uZWN0aW9uID0gdGhpcy5jb25uOw0KICAgICAgICBjbWQuQ29tbWFuZFR5cGUgPSAxOyANCiAgICAgICAgY21kLlByZXBhcmVkID0gb3AucHJlcGFyZWQgfHwgZmFsc2U7DQogICAgICAgIGNtZC5Db21tYW5kVGV4dCA9IG9wLnNxbDsNCiAgICAgICAgb3AuY21kID0gY21kOw0KICAgICAgICB0aGlzLmNyZWF0ZVBhcmFtcyhvcCk7DQogICAgICAgIHJldHVybiBjbWQuRXhlY3V0ZSgpOw0KICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICBlLnNxbCA9IG9wLnNxbDsNCiAgICAgICAgdGhyb3cgZTsNCiAgICAgIH0NCiAgICB9LA0KDQogICAgc2VsZWN0OiBmdW5jdGlvbigpIHsNCiAgICAgIHZhciBycywNCiAgICAgICAgcm93LA0KICAgICAgICBpLA0KICAgICAgICBsZW4sDQogICAgICAgIG9wID0gdGhpcy5nZXRPcHRpb25zKGFyZ3VtZW50cyk7DQogICAgICB0cnkgew0KICAgICAgICBycyA9IHRoaXMuZXhlY3V0ZShvcCk7DQogICAgICAgIHdoaWxlICghcnMuRU9GKSB7DQogICAgICAgICAgcm93ID0ge307DQogICAgICAgICAgaWYgKGxlbiA9PSBudWxsKSBsZW4gPSBycy5GaWVsZHMuQ291bnQ7DQogICAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7DQogICAgICAgICAgICByb3dbcnMuRmllbGRzKGkpLk5hbWVdID0gdGhpcy5nZXRGaWVsZFZhbHVlKHJzLkZpZWxkcyhpKSk7DQogICAgICAgICAgfQ0KICAgICAgICAgIGlmIChvcC5jYWxsYmFjayhyb3cpID09PSBmYWxzZSkgYnJlYWs7DQogICAgICAgICAgcnMuTW92ZU5leHQoKTsNCiAgICAgICAgfQ0KICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICBlLnNxbCA9IG9wLnNxbDsNCiAgICAgICAgdGhyb3cgZTsNCiAgICAgIH0gZmluYWxseSB7DQogICAgICAgIHJzICYmIHJzLlN0YXRlICE9IDAgJiYgcnMuQ2xvc2UoKTsNCiAgICAgIH0NCiAgICB9LA0KDQogICAgZ2V0RmllbGRWYWx1ZTogZnVuY3Rpb24oZmllbGQpIHsNCiAgICAgIHN3aXRjaCAoZmllbGQuVHlwZSkgew0KICAgICAgICBjYXNlIGFkQmluYXJ5Og0KICAgICAgICBjYXNlIGFkVmFyQmluYXJ5Og0KICAgICAgICAgIHJldHVybiAnW0xPQl0nOw0KICAgICAgICBjYXNlIGFkRGF0ZToNCiAgICAgICAgY2FzZSBhZERCRGF0ZToNCiAgICAgICAgY2FzZSBhZERCVGltZToNCiAgICAgICAgY2FzZSBhZERCVGltZVN0YW1wOg0KICAgICAgICAgIHJldHVybiBEYXRlKGZpZWxkLnZhbHVlKTsNCiAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICByZXR1cm4gZmllbGQudmFsdWU7DQogICAgICB9DQogICAgfSwNCg0KICAgIGVhY2hSb3c6IGZ1bmN0aW9uKCkgew0KICAgICAgdmFyIG9wID0gdGhpcy5nZXRPcHRpb25zKGFyZ3VtZW50cyk7DQogICAgICB0aGlzLnNlbGVjdChvcCk7DQogICAgfSwNCg0KICAgIGZpcnN0Um93OiBmdW5jdGlvbigpIHsNCiAgICAgIHZhciBvcCA9IHRoaXMuZ2V0T3B0aW9ucyhhcmd1bWVudHMpLA0KICAgICAgICBfcm93Ow0KICAgICAgb3AuY2FsbGJhY2sgPSBmdW5jdGlvbiggcm93ICl7cmV0dXJuICAoKF9yb3cgPSByb3cpLCBmYWxzZSl9Ow0KICAgICAgdGhpcy5zZWxlY3Qob3ApOw0KICAgICAgcmV0dXJuIF9yb3c7DQogICAgfSwNCg0KICAgIHJvd3M6IGZ1bmN0aW9uKCkgew0KICAgICAgdmFyIG9wID0gdGhpcy5nZXRPcHRpb25zKGFyZ3VtZW50cyksDQogICAgICAgIHJvd3MgPSBbXTsNCiAgICAgIG9wLmNhbGxiYWNrID0gZnVuY3Rpb24oIHJvdyApIHsNCiAgICAgICAgcm93cy5wdXNoKHJvdyk7DQogICAgICB9Ow0KICAgICAgdGhpcy5zZWxlY3Qob3ApOw0KICAgICAgcmV0dXJuIHJvd3M7DQogICAgfSwNCg0KICAgIGJhdGNoOiBmdW5jdGlvbihjbWQsIGZuKSB7DQogICAgICB2YXIgY29ubiwgcnM7DQogICAgICB0cnkgew0KICAgICAgICBjb25uID0gdGhpcy5jb25uOw0KICAgICAgICBycyA9IG5ldyBBY3RpdmVYT2JqZWN0KCdBRE9EQi5SZWNvcmRzZXQnKTsNCiAgICAgICAgcnMuQ3Vyc29yTG9jYXRpb24gPSBhZFVzZUNsaWVudDsNCiAgICAgICAgcnMuTG9ja1R5cGUgPSBhZExvY2tCYXRjaE9wdGltaXN0aWM7DQogICAgICAgIHJzLkN1cnNvclR5cGUgPSBhZE9wZW5EeW5hbWljOw0KICAgICAgICBycy5PcGVuKGNtZCwgY29ubik7DQogICAgICAgIGZuKHJzKTsNCiAgICAgIH0gZmluYWxseSB7DQogICAgICAgIHJzICYmIHJzLlN0YXRlICE9IDAgJiYgcnMuQ2xvc2UoKTsNCiAgICAgIH0NCiAgICB9LA0KDQogICAgc2V0RmllbGRWYWx1ZTogZnVuY3Rpb24oZmllbGQsIHZhbHVlKSB7DQogICAgICBzd2l0Y2ggKHR5cGVPZih2YWx1ZSkpIHsNCiAgICAgICAgY2FzZSAnZGF0ZSc6DQogICAgICAgICAgZmllbGQuVmFsdWUgPSBmb3JtYXREYXRlKHZhbHVlKTsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAnc3RyaW5nJzoNCiAgICAgICAgY2FzZSAnbnVtYmVyJzoNCiAgICAgICAgICBmaWVsZC5WYWx1ZSA9IHZhbHVlOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgIGZpZWxkLlZhbHVlID0gU3RyaW5nKHZhbHVlKTsNCiAgICAgICAgICBicmVhazsNCiAgICAgIH0NCiAgICB9LA0KDQogICAgYmF0Y2hfaW5zZXJ0OiBmdW5jdGlvbihjbWQsIHJvd3MpIHsNCiAgICAgIHZhciBzZWxmID0gdGhpczsNCiAgICAgIHRoaXMuYmF0Y2goY21kLCBmdW5jdGlvbiggcnMgKSB7DQogICAgICAgIGVhY2gocm93cywgZnVuY3Rpb24oIHJvdyApIHsNCiAgICAgICAgICBycy5BZGROZXcoKTsNCiAgICAgICAgICBlYWNoKHJvdywgZnVuY3Rpb24gKHYsIGspICB7DQogICAgICAgICAgICBzZWxmLnNldEZpZWxkVmFsdWUocnMuRmllbGRzKGspLCB2KTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgfSk7DQogICAgICAgIHJzLlVwZGF0ZUJhdGNoKCk7DQogICAgICB9KTsNCiAgICB9LA0KDQogICAgdGFibGVFeGlzdHM6IGZ1bmN0aW9uKHRhYmxlTmFtZSkgew0KICAgICAgdmFyIGNvbm4sDQogICAgICAgIHJzLA0KICAgICAgICByZXN1bHQgPSBmYWxzZSwNCiAgICAgICAgcGFyYW1zID0gW251bGwsIG51bGwsIHRhYmxlTmFtZSwgJ1RBQkxFJ107DQogICAgICB0cnkgew0KICAgICAgICBjb25uID0gdGhpcy5jb25uOw0KICAgICAgICBycyA9IGNvbm4uT3BlblNjaGVtYShhZFNjaGVtYVRhYmxlcywgcGFyYW1zKTsNCiAgICAgICAgaWYgKCFycy5FT0YpIHJlc3VsdCA9IHRydWU7DQogICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIHRocm93IGU7DQogICAgICB9IGZpbmFsbHkgew0KICAgICAgICBycyAmJiBycy5TdGF0ZSAhPSAwICYmIHJzLkNsb3NlKCk7DQogICAgICB9DQogICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0sDQoNCiAgICBnZXRUYWJsZXM6IGZ1bmN0aW9uKCkgew0KICAgICAgdmFyIGNvbm4sDQogICAgICAgIHJzLA0KICAgICAgICByZXN1bHQgPSBbXSwNCiAgICAgICAgY291bnQgPSAwOw0KICAgICAgdHJ5IHsNCiAgICAgICAgY29ubiA9IHRoaXMuY29ubjsNCiAgICAgICAgcnMgPSBjb25uLk9wZW5TY2hlbWEoYWRTY2hlbWFUYWJsZXMpOw0KICAgICAgICB3aGlsZSAoIXJzLkVPRikgew0KICAgICAgICAgIGlmIChycy5GaWVsZHMoJ1RBQkxFX1RZUEUnKS5WYWx1ZSA9PT0gJ1RBQkxFJykgew0KICAgICAgICAgICAgcmVzdWx0W2NvdW50KytdID0gcnMuRmllbGRzKCdUQUJMRV9OQU1FJykuVmFsdWU7DQogICAgICAgICAgfQ0KICAgICAgICAgIHJzLk1vdmVOZXh0KCk7DQogICAgICAgIH0NCiAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgdGhyb3cgZTsNCiAgICAgIH0gZmluYWxseSB7DQogICAgICAgIHJzICYmIHJzLlN0YXRlICE9IDAgJiYgcnMuQ2xvc2UoKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KICB9Ow0KDQogIGZ1bmN0aW9uIGZvcm1hdERhdGUoZCkgew0KICAgIHJldHVybiAoDQogICAgICBkLmdldEZ1bGxZZWFyKCkgKw0KICAgICAgJy8nICsNCiAgICAgIChkLmdldE1vbnRoKCkgKyAxKSArDQogICAgICAnLycgKw0KICAgICAgZC5nZXREYXRlKCkgKw0KICAgICAgJyAnICsNCiAgICAgIGQuZ2V0SG91cnMoKSArDQogICAgICAnOicgKw0KICAgICAgZC5nZXRNaW51dGVzKCkgKw0KICAgICAgJzonICsNCiAgICAgIGQuZ2V0U2Vjb25kcygpDQogICAgKTsNCiAgfQoKICB2YXIgYWRvZGIgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICBhZFVzZUNsaWVudDogYWRVc2VDbGllbnQsCiAgICBhZFVzZU5vbmU6IGFkVXNlTm9uZSwKICAgIGFkVXNlU2VydmVyOiBhZFVzZVNlcnZlciwKICAgIGFkTG9ja1Vuc3BlY2lmaWVkOiBhZExvY2tVbnNwZWNpZmllZCwKICAgIGFkTG9ja1JlYWRPbmx5OiBhZExvY2tSZWFkT25seSwKICAgIGFkTG9ja1Blc3NpbWlzdGljOiBhZExvY2tQZXNzaW1pc3RpYywKICAgIGFkTG9ja09wdGltaXN0aWM6IGFkTG9ja09wdGltaXN0aWMsCiAgICBhZExvY2tCYXRjaE9wdGltaXN0aWM6IGFkTG9ja0JhdGNoT3B0aW1pc3RpYywKICAgIGFkT3BlblVuc3BlY2lmaWVkOiBhZE9wZW5VbnNwZWNpZmllZCwKICAgIGFkT3BlbkZvcndhcmRPbmx5OiBhZE9wZW5Gb3J3YXJkT25seSwKICAgIGFkT3BlbktleXNldDogYWRPcGVuS2V5c2V0LAogICAgYWRPcGVuRHluYW1pYzogYWRPcGVuRHluYW1pYywKICAgIGFkT3BlblN0YXRpYzogYWRPcGVuU3RhdGljLAogICAgYWRCaWdJbnQ6IGFkQmlnSW50LAogICAgYWRCaW5hcnk6IGFkQmluYXJ5LAogICAgYWRCb29sZWFuOiBhZEJvb2xlYW4sCiAgICBhZENoYXI6IGFkQ2hhciwKICAgIGFkQ3VycmVuY3k6IGFkQ3VycmVuY3ksCiAgICBhZERhdGU6IGFkRGF0ZSwKICAgIGFkREJEYXRlOiBhZERCRGF0ZSwKICAgIGFkREJUaW1lOiBhZERCVGltZSwKICAgIGFkREJUaW1lU3RhbXA6IGFkREJUaW1lU3RhbXAsCiAgICBhZERlY2ltYWw6IGFkRGVjaW1hbCwKICAgIGFkRG91YmxlOiBhZERvdWJsZSwKICAgIGFkR1VJRDogYWRHVUlELAogICAgYWRJRGlzcGF0Y2g6IGFkSURpc3BhdGNoLAogICAgYWRJbnRlZ2VyOiBhZEludGVnZXIsCiAgICBhZExvbmdWYXJCaW5hcnk6IGFkTG9uZ1ZhckJpbmFyeSwKICAgIGFkTG9uZ1ZhckNoYXI6IGFkTG9uZ1ZhckNoYXIsCiAgICBhZExvbmdWYXJXQ2hhcjogYWRMb25nVmFyV0NoYXIsCiAgICBhZE51bWVyaWM6IGFkTnVtZXJpYywKICAgIGFkU2luZ2xlOiBhZFNpbmdsZSwKICAgIGFkU21hbGxJbnQ6IGFkU21hbGxJbnQsCiAgICBhZFVuc2lnbmVkVGlueUludDogYWRVbnNpZ25lZFRpbnlJbnQsCiAgICBhZFZhckJpbmFyeTogYWRWYXJCaW5hcnksCiAgICBhZFZhckNoYXI6IGFkVmFyQ2hhciwKICAgIGFkVmFyaWFudDogYWRWYXJpYW50LAogICAgYWRWYXJXQ2hhcjogYWRWYXJXQ2hhciwKICAgIGFkV0NoYXI6IGFkV0NoYXIsCiAgICBhZFBhcmFtVW5rbm93bjogYWRQYXJhbVVua25vd24sCiAgICBhZFBhcmFtSW5wdXQ6IGFkUGFyYW1JbnB1dCwKICAgIGFkUGFyYW1PdXRwdXQ6IGFkUGFyYW1PdXRwdXQsCiAgICBhZFBhcmFtSW5wdXRPdXRwdXQ6IGFkUGFyYW1JbnB1dE91dHB1dCwKICAgIGFkUGFyYW1SZXR1cm5WYWx1ZTogYWRQYXJhbVJldHVyblZhbHVlLAogICAgYWRTY2hlbWFUYWJsZXM6IGFkU2NoZW1hVGFibGVzLAogICAgYWRTY2hlbWFDb2x1bW5zOiBhZFNjaGVtYUNvbHVtbnMsCiAgICBBZG9kYjogQWRvZGIKICB9KTsKCiAgZnVuY3Rpb24gQWNjREIocGF0aCkgew0KICAgIGlmICghaXNBYnNvbHV0ZShwYXRoKSkgew0KICAgICAgcGF0aCA9IG5vcm1hbGl6ZShwYXRoKTsNCiAgICB9DQogICAgaWYgKCFpc2ZpbGUocGF0aCkpIHsNCiAgICAgIHZhciBhcHAgPSBuZXcgQWN0aXZlWE9iamVjdCgnQWNjZXNzLkFwcGxpY2F0aW9uJyk7DQogICAgICBhcHAuTmV3Q3VycmVudERhdGFiYXNlKHBhdGgpOw0KICAgIH0NCiAgICBBZG9kYi5jYWxsKHRoaXMpOw0KICAgIHRoaXMuY29ubi5Db25uZWN0aW9uU3RyaW5nID0gU3RyaW5nLnJhdyh7cmF3OiBbJ1Byb3ZpZGVyPU1pY3Jvc29mdC5BY2UuT0xFREIuMTIuMDtEYXRhIFNvdXJjZT0nLCcnXX0scGF0aCk7DQogICAgdGhpcy5jb25uLk9wZW4oKTsNCiAgfQ0KDQogIGluaGVyaXRzKEFjY0RCLCBBZG9kYik7DQoNCiAgZnVuY3Rpb24gYWNjZGIocHRoKSB7DQogICAgcmV0dXJuIG5ldyBBY2NEQihwdGgpOw0KICB9CgogIHZhciBhY2NkYiQxID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgQWNjREI6IEFjY0RCLAogICAgJ2RlZmF1bHQnOiBhY2NkYgogIH0pOwoKICBmdW5jdGlvbiBDc3ZEQihwYXRoLCBoYXNIZWFkZXIpIHsNCiAgICBpZiAoIWlzQWJzb2x1dGUocGF0aCkpIHsNCiAgICAgIHBhdGggPSBub3JtYWxpemUocGF0aCk7DQogICAgfQ0KICAgIGlmIChpc2ZpbGUocGF0aCkpIHBhdGggPSBkaXJuYW1lKHBhdGgpOw0KICAgIHZhciBoZHIgPQ0KICAgICAgaGFzSGVhZGVyID09IG51bGwgfHwgaGFzSGVhZGVyID09IHRydWUgfHwgaGFzSGVhZGVyID09ICdZRVMnID8gJ1lFUycgOiAnTk8nOw0KICAgIEFkb2RiLmNhbGwodGhpcyk7DQogICAgdGhpcy5jb25uLkNvbm5lY3Rpb25TdHJpbmcgPSBTdHJpbmcucmF3KHtyYXc6IFsnUHJvdmlkZXI9TWljcm9zb2Z0LkFjZS5PTEVEQi4xMi4wO0RhdGEgU291cmNlPScsJztFeHRlbmRlZCBQcm9wZXJ0aWVzPVwiVGV4dDtIRFI9JywnO0ZNVD1EZWxpbWl0ZWRcIiddfSxwYXRoLGhkcik7DQogICAgdGhpcy5jb25uLk9wZW4oKTsNCiAgfQ0KDQogIGluaGVyaXRzKENzdkRCLCBBZG9kYik7DQoNCiAgZnVuY3Rpb24gY3N2ZGIocGF0aCwgaGFzSGVhZGVyKSB7DQogICAgcmV0dXJuIG5ldyBDc3ZEQihwYXRoLCBoYXNIZWFkZXIpOw0KICB9CgogIHZhciBjc3ZkYiQxID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgQ3N2REI6IENzdkRCLAogICAgJ2RlZmF1bHQnOiBjc3ZkYgogIH0pOwoKICB2YXIgRVhDRUxfVFlQRSA9IHsNCiAgICB4bHM6ICdFeGNlbCA4LjAnLA0KICAgIHhsc3g6ICdFeGNlbCAxMi4wIFhtbCcsDQogICAgeGxzYjogJ0V4Y2VsIDEyLjAnLA0KICAgIHhsc206ICdFeGNlbCAxMi4wIE1hY3JvJw0KICB9Ow0KDQogIGZ1bmN0aW9uIEV4Y2VsREIocGF0aCwgaGFzSGVhZGVyKSB7DQogICAgaWYgKCFpc0Fic29sdXRlKHBhdGgpKSB7DQogICAgICBwYXRoID0gbm9ybWFsaXplKHBhdGgpOw0KICAgIH0NCiAgICB2YXIgZXh0ID0gZXh0bmFtZShwYXRoKS50b0xvd2VyQ2FzZSgpOw0KICAgIHZhciBoZHIgPQ0KICAgICAgaGFzSGVhZGVyID09IG51bGwgfHwgaGFzSGVhZGVyID09IHRydWUgfHwgaGFzSGVhZGVyID09ICdZRVMnID8gJ1lFUycgOiAnTk8nOw0KICAgIGlmICghRVhDRUxfVFlQRVtleHRdKSB0aHJvdyBuZXcgRXJyb3IoZXh0ICsgJyBmaWxlIGlzIG5vdCBzdXBwb3J0ZWQnKTsNCiAgICBBZG9kYi5jYWxsKHRoaXMpOw0KICAgIHRoaXMuY29ubi5Db25uZWN0aW9uU3RyaW5nID0gU3RyaW5nLnJhdyh7cmF3OiBbJ1Byb3ZpZGVyPU1pY3Jvc29mdC5BY2UuT0xFREIuMTIuMDtEYXRhIFNvdXJjZT0nLCc7RXh0ZW5kZWQgUHJvcGVydGllcz1cIicsJztIRFI9JywnXCInXX0scGF0aCxFWENFTF9UWVBFW2V4dF0saGRyKTsNCiAgICB0aGlzLmNvbm4uT3BlbigpOw0KICB9DQoNCiAgaW5oZXJpdHMoRXhjZWxEQiwgQWRvZGIpOw0KDQogIGZ1bmN0aW9uIGV4Y2VsZGIocGF0aCwgaGFzSGVhZGVyKSB7DQogICAgcmV0dXJuIG5ldyBFeGNlbERCKHBhdGgsIGhhc0hlYWRlcik7DQogIH0KCiAgdmFyIGV4Y2VsZGIkMSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgIEV4Y2VsREI6IEV4Y2VsREIsCiAgICAnZGVmYXVsdCc6IGV4Y2VsZGIKICB9KTsKCiAgZnVuY3Rpb24gT3JhY2xlREIoZHMsIHVzciwgcGFzcykgew0KICAgIHRyeSB7DQogICAgICBBZG9kYi5jYWxsKHRoaXMpOw0KICAgICAgdGhpcy5jb25uLkNvbm5lY3Rpb25TdHJpbmcgPQ0KICAgICAgICANCiAgICAgICAgU3RyaW5nLnJhdyh7cmF3OiBbJ1Byb3ZpZGVyPU1TREFPUkE7RGF0YSBTb3VyY2U9JywnO1VzZXIgSUQ9JywnO1Bhc3N3b3JkPScsJyddfSxkcyx1c3IscGFzcyk7DQogICAgICB0aGlzLmNvbm4uT3BlbigpOw0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgIGNvbnNvbGUubG9nKCdEYXRhYmFzZSBjb25uZWN0IGZhaWxlZC4nKTsNCiAgICAgIGNvbnNvbGUubG9nKA0KICAgICAgICAnZGF0YXNvdXJjZTogJXNcbiAgICB1c2VyaWQ6ICVzXG4gIHBhc3N3b3JkOiAlcycsDQogICAgICAgIGRzLA0KICAgICAgICB1c3IsDQogICAgICAgIHBhc3MNCiAgICAgICk7DQogICAgICB0aHJvdyBlOw0KICAgIH0NCiAgfQ0KDQogIGluaGVyaXRzKE9yYWNsZURCLCBBZG9kYik7DQoNCiAgZXh0ZW5kKE9yYWNsZURCLnByb3RvdHlwZSwgew0KICAgIGdldERhdGFUeXBlTWFwcGluZzogZnVuY3Rpb24oKSB7DQogICAgICByZXR1cm4gew0KICAgICAgICBzdHJpbmc6IGFkVmFyaWFudCwNCiAgICAgICAgaW50OiBhZEludGVnZXIsDQogICAgICAgIGRlY2ltYWw6IGFkTnVtZXJpYywNCiAgICAgICAgYm9vbGVhbjogYWRCb29sZWFuLA0KICAgICAgICBkYXRlOiBhZERCVGltZVN0YW1wLA0KICAgICAgICBudWxsOiBhZFZhcmlhbnQNCiAgICAgIH07DQogICAgfSwNCg0KICAgIHRhYmxlRXhpc3RzOiBmdW5jdGlvbih0YWJsZU5hbWUpIHsNCiAgICAgIHZhciByb3cgPSB0aGlzLmZpcnN0Um93KCdzZWxlY3QgMSBmcm9tIHVzZXJfdGFibGVzIHdoZXJlIHRhYmxlX25hbWUgPSA/JywgWw0KICAgICAgICB0YWJsZU5hbWUNCiAgICAgIF0pOw0KICAgICAgcmV0dXJuIHJvdyAhPSBudWxsOw0KICAgIH0sDQoNCiAgICBnZXRUYWJsZXM6IGZ1bmN0aW9uKCkgew0KICAgICAgdmFyIHJvd3MgPSB0aGlzLnJvd3MoJ3NlbGVjdCB0YWJsZV9uYW1lIGZyb20gdXNlcl90YWJsZXMnKTsNCiAgICAgIHJldHVybiByb3dzLm1hcCggZnVuY3Rpb24oaXQgKXtyZXR1cm4gIGl0LlRBQkxFX05BTUV9KTsNCiAgICB9DQogIH0pOw0KDQogIGZ1bmN0aW9uIG9yYWNsZWRiKGRzLCB1c3IsIHBhc3MpIHsNCiAgICByZXR1cm4gbmV3IE9yYWNsZURCKGRzLCB1c3IsIHBhc3MpOw0KICB9DQoNCg0KDQogIHZhciBfdmJzJDEsIF9zZXNzaW9uOw0KDQogIGZ1bmN0aW9uIE9vNG8oZHMsIHVzZXIsIHBhc3MpIHsNCiAgICB0aGlzLnNlc3Npb24gPQ0KICAgICAgX3Nlc3Npb24gfHwNCiAgICAgIChfc2Vzc2lvbiA9IG5ldyBBY3RpdmVYT2JqZWN0KCdPcmFjbGVJblByb2NTZXJ2ZXIuWE9yYVNlc3Npb24nKSk7DQogICAgdGhpcy5kYXRhQmFzZSA9IHRoaXMuc2Vzc2lvbi5PcGVuRGF0YWJhc2UoZHMsIHVzZXIgKyAnLycgKyBwYXNzLCAwKTsNCiAgfQ0KDQogIGluaGVyaXRzKE9vNG8sIE9yYWNsZURCKTsNCg0KICBPYmplY3QuZGVmaW5lUHJvcGVydHkoT280by5wcm90b3R5cGUsICd2YnMnLCB7DQogICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgIGlmIChfdmJzJDEpIHsNCiAgICAgICAgX3ZicyQxID0gX19WQlM7DQogICAgICAgIF92YnMkMS5BZGRDb2RlKFN0cmluZy5yYXcoe3JhdzogWydcclxuRnVuY3Rpb24gUmVhZEJsb2IoZmllbGQpXHJcbiAgRGltIGJ1ZigpXHJcbiAgZmllbGQuR2V0Q2h1bmtCeXRlRXggYnVmLCAwLCBmaWVsZC5GaWVsZFNpemUoKVxyXG4gIFJlYWRCbG9iID0gYnVmXHJcbkVuZCBGdW5jdGlvblxyXG5cclxuRnVuY3Rpb24gUmVhZENsb2IoZmllbGQpXHJcbiAgRGltIGJ1ZlxyXG4gIGZpZWxkLlZhbHVlLlJlYWQgYnVmXHJcbiAgUmVhZENsb2IgPSBidWZcclxuRW5kIEZ1bmN0aW9uXHJcbiAgICAnXX0pKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBfdmJzJDEuQ29kZU9iamVjdDsNCiAgICB9DQogIH0pOw0KDQogIGV4dGVuZChPbzRvLnByb3RvdHlwZSwgew0KICAgIGNsb3NlOiBmdW5jdGlvbigpIHsNCiAgICAgIHRoaXMuZGF0YUJhc2UuQ2xvc2UoKTsNCiAgICAgIHRoaXMuZGF0YUJhc2UgPSBudWxsOw0KICAgICAgdGhpcy5zZXNzaW9uID0gbnVsbDsNCiAgICB9LA0KDQogICAgYmVnaW46IGZ1bmN0aW9uKCkgew0KICAgICAgdGhpcy5zZXNzaW9uLkJlZ2luVHJhbnMoKTsNCiAgICB9LA0KDQogICAgY29tbWl0OiBmdW5jdGlvbigpIHsNCiAgICAgIHRoaXMuc2Vzc2lvbi5Db21taXRUcmFucygpOw0KICAgIH0sDQoNCiAgICByb2xsYmFjazogZnVuY3Rpb24oKSB7DQogICAgICB0aGlzLnNlc3Npb24uUm9sbGJhY2soKTsNCiAgICB9LA0KDQogICAgZ2V0RGF0YVR5cGVNYXBwaW5nOiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiB7DQogICAgICAgIHN0cmluZzogMSwNCiAgICAgICAgbnVtYmVyOiAyLA0KICAgICAgICBib29sZWFuOiAxLA0KICAgICAgICBkYXRlOiAxMiwNCiAgICAgICAgYnVmZmVyOiAxMTMsDQogICAgICAgIG51bGw6IDEsDQogICAgICAgIHVuZGVmaW5lZDogMQ0KICAgICAgfTsNCiAgICB9LA0KDQogICAgY3JlYXRlUGFyYW1zOiBmdW5jdGlvbihvcHRzKSB7DQogICAgICB2YXIgcGFyYW1zID0gb3B0cy5wYXJhbXMsDQogICAgICAgIHNlbGYgPSB0aGlzOw0KICAgICAgaWYgKCFwYXJhbXMpIHJldHVybjsNCiAgICAgIHZhciBkdG1hcCA9IHRoaXMuZ2V0RGF0YVR5cGVNYXBwaW5nKCk7DQogICAgICBlYWNoKHBhcmFtcywgZnVuY3Rpb24gKHYsIGspICB7DQogICAgICAgIHZhciB0eXBlID0gZHRtYXBbdHlwZU9mKHYpXSB8fCAxOw0KICAgICAgICBzZWxmLmRhdGFCYXNlLlBhcmFtZXRlcnMuQWRkKFN0cmluZyhrKSwgdiwgMSwgdHlwZSk7DQoNCiAgICAgICAgaWYgKGlzQXJyYXkocGFyYW1zKSAmJiBvcHRzLnNxbC5pbmNsdWRlcygnPycpKSB7DQogICAgICAgICAgdmFyIGluZGV4ID0gMDsNCiAgICAgICAgICBvcHRzLnNxbCA9IG9wdHMuc3FsLnJlcGxhY2UoL1w/L2csIGZ1bmN0aW9uICgpICB7DQogICAgICAgICAgICByZXR1cm4gJzonICsgaW5kZXgrKzsNCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfSwNCg0KICAgIHJlbW92ZVBhcmFtczogZnVuY3Rpb24ob3B0cykgew0KICAgICAgdmFyIHBhcmFtcyA9IG9wdHMucGFyYW1zLA0KICAgICAgICBzZWxmID0gdGhpczsNCiAgICAgIGlmICghcGFyYW1zKSByZXR1cm47DQogICAgICBlYWNoKHBhcmFtcywgZnVuY3Rpb24gKHYsIGspICB7DQogICAgICAgIHNlbGYuZGF0YUJhc2UuUGFyYW1ldGVycy5SZW1vdmUoU3RyaW5nKGspKTsNCiAgICAgIH0pOw0KICAgIH0sDQoNCiAgICBleGVjdXRlOiBmdW5jdGlvbigpIHsNCiAgICAgIHZhciBvcHRzID0gdGhpcy5nZXRPcHRpb25zKGFyZ3VtZW50cyk7DQogICAgICB0cnkgew0KICAgICAgICB0aGlzLmNyZWF0ZVBhcmFtcyhvcHRzKTsNCiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YUJhc2UuRXhlY3V0ZVNRTChvcHRzLnNxbCk7DQogICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIGUuc3FsID0gb3B0cy5zcWw7DQogICAgICAgIHRocm93IGU7DQogICAgICB9IGZpbmFsbHkgew0KICAgICAgICB0aGlzLnJlbW92ZVBhcmFtcyhvcHRzKTsNCiAgICAgIH0NCiAgICB9LA0KDQogICAgc2VsZWN0OiBmdW5jdGlvbigpIHsNCiAgICAgIHZhciBycywNCiAgICAgICAgcm93LA0KICAgICAgICBpLA0KICAgICAgICBsZW4sDQogICAgICAgIG9wdHMgPSB0aGlzLmdldE9wdGlvbnMoYXJndW1lbnRzKTsNCiAgICAgIHRyeSB7DQogICAgICAgIHRoaXMuY3JlYXRlUGFyYW1zKG9wdHMpOw0KICAgICAgICBycyA9IHRoaXMuZGF0YUJhc2UuQ3JlYXRlRHluYXNldChvcHRzLnNxbCwgMCk7DQogICAgICAgIHdoaWxlICghcnMuRU9GKSB7DQogICAgICAgICAgcm93ID0ge307DQogICAgICAgICAgaWYgKGxlbiA9PSBudWxsKSBsZW4gPSBycy5GaWVsZHMuQ291bnQ7DQogICAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7DQogICAgICAgICAgICByb3dbcnMuRmllbGRzKGkpLk5hbWVdID0gdGhpcy5nZXRGaWVsZFZhbHVlKHJzLkZpZWxkcyhpKSk7DQogICAgICAgICAgfQ0KICAgICAgICAgIGlmIChvcHRzLmNhbGxiYWNrKHJvdykgPT09IGZhbHNlKSBicmVhazsNCiAgICAgICAgICBycy5Nb3ZlTmV4dCgpOw0KICAgICAgICB9DQogICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIGUuc3FsID0gb3B0cy5zcWw7DQogICAgICAgIHRocm93IGU7DQogICAgICB9IGZpbmFsbHkgew0KICAgICAgICB0aGlzLnJlbW92ZVBhcmFtcyhvcHRzKTsNCiAgICAgICAgcnMgJiYgcnMuQ2xvc2UoKTsNCiAgICAgIH0NCiAgICB9LA0KDQogICAgZ2V0RmllbGRWYWx1ZTogZnVuY3Rpb24oZmllbGQpIHsNCiAgICAgIHN3aXRjaCAoZmllbGQuT3JhSURhdGFUeXBlKSB7DQogICAgICAgIGNhc2UgMjoNCiAgICAgICAgY2FzZSA4Og0KICAgICAgICAgIHJldHVybiBOdW1iZXIoZmllbGQudmFsdWUpOw0KICAgICAgICBjYXNlIDExMjoNCiAgICAgICAgICByZXR1cm4gdGhpcy52YnMuUmVhZENsb2IoZmllbGQpOw0KICAgICAgICBjYXNlIDExMzoNCiAgICAgICAgICByZXR1cm4gQnVmZmVyLmZyb20odGhpcy52YnMuUmVhZEJsb2IoZmllbGQpKTsNCiAgICAgICAgY2FzZSAxMjoNCiAgICAgICAgY2FzZSAxODc6DQogICAgICAgIGNhc2UgMTg4Og0KICAgICAgICBjYXNlIDIzMjoNCiAgICAgICAgICByZXR1cm4gRGF0ZShmaWVsZC52YWx1ZSk7DQogICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgcmV0dXJuIGZpZWxkLnZhbHVlOw0KICAgICAgfQ0KICAgIH0sDQoNCiAgICBiYXRjaDogZnVuY3Rpb24oKSB7fSwNCg0KICAgIGJhdGNoX2luc2VydDogZnVuY3Rpb24oY21kLCByb3dzKSB7DQogICAgICB2YXIgc2VsZiA9IHRoaXM7DQogICAgICB2YXIgcnMgPSB0aGlzLmRhdGFCYXNlLkNyZWF0ZUR5bmFzZXQoY21kLCAwKTsNCiAgICAgIHRyeSB7DQogICAgICAgIHRoaXMuYmVnaW4oKTsNCiAgICAgICAgZWFjaChyb3dzLCBmdW5jdGlvbiggcm93ICkgew0KICAgICAgICAgIHJzLkFkZE5ldygpOw0KICAgICAgICAgIGVhY2gocm93LCBmdW5jdGlvbiAodiwgaykgIHsNCiAgICAgICAgICAgIHNlbGYuc2V0RmllbGRWYWx1ZShycy5GaWVsZHMoayksIHYpOw0KICAgICAgICAgIH0pOw0KICAgICAgICAgIHJzLlVwZGF0ZSgpOw0KICAgICAgICB9KTsNCiAgICAgICAgdGhpcy5jb21taXQoKTsNCiAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgdGhpcy5yb2xsYmFjaygpOw0KICAgICAgICB0aHJvdyBlOw0KICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgcnMgJiYgcnMuQ2xvc2UoKTsNCiAgICAgIH0NCiAgICB9DQogIH0pOw0KDQogIGZ1bmN0aW9uIG9vNG8oZHMsIHVzZXIsIHBhc3MpIHsNCiAgICByZXR1cm4gbmV3IE9vNG8oZHMsIHVzZXIsIHBhc3MpOw0KICB9CgogIHZhciBvcmFjbGVkYiQxID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgT3JhY2xlREI6IE9yYWNsZURCLAogICAgJ2RlZmF1bHQnOiBvcmFjbGVkYiwKICAgIE9vNG86IE9vNG8sCiAgICBvbzRvOiBvbzRvCiAgfSk7CgogIHZhciBfc2VydmljZTsNCg0KICBmdW5jdGlvbiBnZXRTZXJ2aWNlKCkgew0KICAgIGlmICghX3NlcnZpY2UpIHsNCiAgICAgIHZhciBsb2NhdG9yID0gbmV3IEFjdGl2ZVhPYmplY3QoJ1diZW1TY3JpcHRpbmcuU1diZW1Mb2NhdG9yJyk7DQogICAgICBfc2VydmljZSA9IGxvY2F0b3IuQ29ubmVjdFNlcnZlcignLicsICdyb290XFxDSU1WMicpOw0KICAgIH0NCiAgICByZXR1cm4gX3NlcnZpY2U7DQogIH0NCg0KICBmdW5jdGlvbiBnZXQkMShjbWQpIHsNCiAgICByZXR1cm4gZ2V0U2VydmljZSgpLkdldChjbWQpOw0KICB9DQoNCiAgZnVuY3Rpb24gZXhlYyQxKHdxbCkgew0KICAgIHJldHVybiBnZXRTZXJ2aWNlKCkuRXhlY1F1ZXJ5KHdxbCk7DQogIH0NCg0KICBmdW5jdGlvbiBxdWVyeSh3cWwpIHsNCiAgICB2YXIgcnMgPSBleGVjJDEod3FsKTsNCiAgICB2YXIgcm93cyA9IG1hcChycywgZnVuY3Rpb24oIHJlY29yZCApIHsNCiAgICAgIHJldHVybiByZWR1Y2UoDQogICAgICAgIHJlY29yZC5Qcm9wZXJ0aWVzXywgZnVuY3Rpb24NCiAgICAgICAgKHJvd0RhdGEsIHByb3ApICB7DQogICAgICAgICAgaWYgKHByb3AuVmFsdWUgIT0gbnVsbCkgew0KICAgICAgICAgICAgcm93RGF0YVtwcm9wLm5hbWVdID0gcHJvcC5Jc0FycmF5DQogICAgICAgICAgICAgID8gbmV3IFZCQXJyYXkocHJvcC5WYWx1ZSkudG9BcnJheSgpDQogICAgICAgICAgICAgIDogcHJvcC5WYWx1ZTsNCiAgICAgICAgICB9DQogICAgICAgICAgcmV0dXJuIHJvd0RhdGE7DQogICAgICAgIH0sDQogICAgICAgIHt9DQogICAgICApOw0KICAgIH0pOw0KICAgIHJzID0gbnVsbDsNCiAgICByZXR1cm4gcm93czsNCiAgfQ0KDQogIGZ1bmN0aW9uIGVhY2hSb3cod3FsLCBjYikgew0KICAgIHZhciBycyA9IGV4ZWMkMSh3cWwpOw0KICAgIGVhY2gocnMsIGZ1bmN0aW9uKCBpdCApe3JldHVybiAgY2IoaXQpfSk7DQogICAgcnMgPSBudWxsOw0KICB9DQoNCiAgZnVuY3Rpb24gZmlyc3RSb3cod3FsKSB7DQogICAgdmFyIG9iajsNCiAgICB2YXIgcnMgPSBleGVjJDEod3FsKTsNCiAgICBlYWNoKHJzLCBmdW5jdGlvbiggaXQgKSB7DQogICAgICBvYmogPSBpdDsNCiAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9KTsNCiAgICBycyA9IG51bGw7DQogICAgcmV0dXJuIG9iajsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNwdSgpIHsNCiAgICByZXR1cm4gcXVlcnkoJ3NlbGVjdCAqIGZyb20gV2luMzJfUHJvY2Vzc29yJylbMF07DQogIH0NCg0KICBmdW5jdGlvbiBzeXMoKSB7DQogICAgcmV0dXJuIHF1ZXJ5KCdzZWxlY3QgKiBmcm9tIFdpbjMyX0NvbXB1dGVyU3lzdGVtJylbMF07DQogIH0NCg0KICBmdW5jdGlvbiBvcygpIHsNCiAgICByZXR1cm4gcXVlcnkoJ3NlbGVjdCAqIGZyb20gV2luMzJfT3BlcmF0aW5nU3lzdGVtJylbMF07DQogIH0NCg0KICBmdW5jdGlvbiBzaHV0ZG93bihmb3JjZWQpIHsNCiAgICByZXR1cm4gZmlyc3RSb3coJ3NlbGVjdCAqIGZyb20gV2luMzJfT3BlcmF0aW5nU3lzdGVtJykuV2luMzJTaHV0ZG93bigNCiAgICAgIDEgKyAoZm9yY2VkID8gNCA6IDApDQogICAgKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGxvZ29mZihmb3JjZWQpIHsNCiAgICByZXR1cm4gZmlyc3RSb3coJ3NlbGVjdCAqIGZyb20gV2luMzJfT3BlcmF0aW5nU3lzdGVtJykuV2luMzJTaHV0ZG93bigNCiAgICAgIDAgKyAoZm9yY2VkID8gNCA6IDApDQogICAgKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlc3RhcnQoZm9yY2VkKSB7DQogICAgcmV0dXJuIGZpcnN0Um93KCdzZWxlY3QgKiBmcm9tIFdpbjMyX09wZXJhdGluZ1N5c3RlbScpLldpbjMyU2h1dGRvd24oDQogICAgICAyICsgKGZvcmNlZCA/IDQgOiAwKQ0KICAgICk7DQogIH0NCg0KICBmdW5jdGlvbiBwb3dlcm9mZihmb3JjZWQpIHsNCiAgICByZXR1cm4gZmlyc3RSb3coJ3NlbGVjdCAqIGZyb20gV2luMzJfT3BlcmF0aW5nU3lzdGVtJykuV2luMzJTaHV0ZG93bigNCiAgICAgIDggKyAoZm9yY2VkID8gNCA6IDApDQogICAgKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHBzKGwpIHsNCiAgICB2YXIgcHJvcHMgPSBbJ1Byb2Nlc3NJZCcsICdDYXB0aW9uJ107DQogICAgaWYgKGwpIHByb3BzLnB1c2goJ1BhcmVudFByb2Nlc3NJZCcsICdDcmVhdGlvbkRhdGUnLCAnQ29tbWFuZExpbmUnKTsNCiAgICByZXR1cm4gbWFwKGV4ZWMkMSgnc2VsZWN0ICogZnJvbSBXaW4zMl9Qcm9jZXNzJyksIGZ1bmN0aW9uKCBpdCApIHsNCiAgICAgIHJldHVybiByZWR1Y2UocHJvcHMsIGZ1bmN0aW9uIChyb3csIG5hbWUpIHtyZXR1cm4gICgocm93W25hbWVdID0gaXRbbmFtZV0pLCByb3cpfSwge30pOw0KICAgIH0pOw0KICB9DQoNCiAgZnVuY3Rpb24ga2lsbChhcmcpIHsNCiAgICB2YXIgd3FsID0gJ3NlbGVjdCAqIGZyb20gV2luMzJfUHJvY2Vzcyc7DQogICAgaWYgKGlzU3RyaW5nKGFyZykpIHdxbCArPSBTdHJpbmcucmF3KHtyYXc6IFsnIHdoZXJlIENhcHRpb249XCcnLCdcJyddfSxhcmcpOw0KICAgIGVsc2UgaWYgKGlzTnVtYmVyKGFyZykpIHdxbCArPSBTdHJpbmcucmF3KHtyYXc6IFsnIHdoZXJlIFByb2Nlc3NJZD0nLCcnXX0sYXJnKTsNCiAgICBlbHNlIHJldHVybiAtMTsNCiAgICByZXR1cm4gZmlyc3RSb3cod3FsKS5UZXJtaW5hdGUoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGVudigpIHsNCiAgICByZXR1cm4gcmVkdWNlKA0KICAgICAgZXhlYyQxKCdzZWxlY3QgKiBmcm9tIFdpbjMyX0Vudmlyb25tZW50JyksIGZ1bmN0aW9uDQogICAgICAocmVzdWx0LCBpdCkge3JldHVybiAgKChyZXN1bHRbaXQuTmFtZV0gPSBpdC5WYXJpYWJsZVZhbHVlKSwgcmVzdWx0KX0sDQogICAgICB7fQ0KICAgICk7DQogIH0KCiAgdmFyIHdtaSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgIGdldDogZ2V0JDEsCiAgICBleGVjOiBleGVjJDEsCiAgICBxdWVyeTogcXVlcnksCiAgICBlYWNoUm93OiBlYWNoUm93LAogICAgZmlyc3RSb3c6IGZpcnN0Um93LAogICAgY3B1OiBjcHUsCiAgICBzeXM6IHN5cywKICAgIG9zOiBvcywKICAgIHNodXRkb3duOiBzaHV0ZG93biwKICAgIGxvZ29mZjogbG9nb2ZmLAogICAgcmVzdGFydDogcmVzdGFydCwKICAgIHBvd2Vyb2ZmOiBwb3dlcm9mZiwKICAgIHBzOiBwcywKICAgIGtpbGw6IGtpbGwsCiAgICBlbnY6IGVudgogIH0pOwoKICB2YXIgQ0hBSU5fQVBJID0gU3RyaW5nLnJhdyh7cmF3OiBbJ1xyXG5Db2xsZWN0aW9uXHJcbiBlYWNoKGZvckVhY2gpXHJcbiBtYXAoc2VsZWN0KVxyXG4gcmVkdWNlXHJcbiBmaWx0ZXIod2hlcmUpXHJcbiB0b0FycmF5XHJcbiBmaW5kXHJcbiBmaW5kSW5kZXhcclxuIGdyb3VwQnlcclxuIGNvdW50QnlcclxuIHNpemUobGVuKVxyXG5BcnJheVxyXG4gdW5pcUJ5KGRpc3RpbmN0QnkpXHJcbiB1bmlxKGRpc3RpbmN0KVxyXG4gY2h1bmtcclxuIGNvbmNhdFxyXG4gc2xpY2VcclxuIGRyb3BcclxuIHRhaWxcclxuIGluaXRpYWxcclxuIHRha2VcclxuIGNvbnRhaW5zKGluY2x1ZGUsaW5jbHVkZXMpXHJcbiBmaXJzdChoZWFkKVxyXG4gbGFzdFxyXG4gbnRoXHJcbiBwdWxsQWxsXHJcbiBwdWxsXHJcbiByZW1vdmVcclxuIGRpZmZlcmVuY2VcclxuIHVuemlwXHJcbiB6aXBcclxuIGZsYXR0ZW5cclxuT2JqZWN0XHJcbiBrZXlzXHJcbiB2YWx1ZXNcclxuIHppcE9iamVjdFxyXG4gZnJvbVBhaXJzXHJcbiBvYmplY3RcclxuIGdldFxyXG4gc2V0XHJcbiB1bnNldFxyXG4gdXBkYXRlXHJcbiBwaWNrXHJcbiBleHRlbmQoYXNzaWduSW4pXHJcbiBkZWZhdWx0c1xyXG4gZW50cmllcyh0b1BhaXJzKVxyXG5NYXRoXHJcbiBzdW1cclxuIGF2ZXJhZ2UoYXZnKVxyXG5TdHJpbmdcclxuIGVhY2hNYXRjaFxyXG4gZmluZEFsbFxyXG4nXX0pOw0KDQogIGZ1bmN0aW9uIGNoYWluX2luaXQob2JqKSB7DQogICAgdGhpcy5fb2JqID0gb2JqOw0KICB9DQoNCiAgZnVuY3Rpb24gQ2hhaW4ob2JqKSB7DQogICAgcmV0dXJuIG5ldyBjaGFpbl9pbml0KG9iaik7DQogIH0NCg0KICB2YXIgQ0hBSU5fUFJPVE8gPSAoY2hhaW5faW5pdC5wcm90b3R5cGUgPSBDaGFpbi5wcm90b3R5cGUpOw0KDQogIGV4dGVuZChDaGFpbiwgdG9vbCk7DQoNCiAgZWFjaE1hdGNoKENIQUlOX0FQSSwgLyArKFx3KykoPzpcKCguKylcKSk/L2csIGZ1bmN0aW9uIChtMCwgbmFtZSwgYWxpYXMpICB7DQogICAgdmFyIGZuID0gdG9vbFtuYW1lXTsNCiAgICBpZiAoIWZuKSB0aHJvdyBuZXcgRXJyb3IoU3RyaW5nLnJhdyh7cmF3OiBbJycsJyBub3QgZXhpdHMgaW4gdG9vbCddfSxuYW1lKSk7DQogICAgdmFyIHdyYXBwZWQgPSBmdW5jdGlvbigpIHsNCiAgICAgIHRoaXMuX29iaiA9IGFwcGx5KGZuLCBudWxsLCBjb25jYXQoW3RoaXMuX29ial0sIGFyZ3VtZW50cykpOw0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfTsNCiAgICBDSEFJTl9QUk9UT1tuYW1lXSA9IHdyYXBwZWQ7DQogICAgaWYgKGFsaWFzKSB7DQogICAgICBhbGlhcy5zcGxpdCgnLCcpLmZvckVhY2goIGZ1bmN0aW9uKF9uYW1lICkgew0KICAgICAgICBDSEFJTl9QUk9UT1tfbmFtZV0gPSB3cmFwcGVkOw0KICAgICAgfSk7DQogICAgfQ0KICB9LmJpbmQod2luZG93KSk7DQoNCiAgZXh0ZW5kKENIQUlOX1BST1RPLCB7DQogICAgdmFsdWU6IGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuIHRoaXMuX29iajsNCiAgICB9LA0KDQogICAgdGFwOiBmdW5jdGlvbihmbikgew0KICAgICAgZm4odGhpcy5fb2JqKTsNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0sDQoNCiAgICB0aHJ1OiBmdW5jdGlvbihmbikgew0KICAgICAgdGhpcy5fb2JqID0gZm4odGhpcy5fb2JqKTsNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0sDQoNCiAgICBsb2c6IGZ1bmN0aW9uKG1zZykgew0KICAgICAgbXNnID8gY29uc29sZS5sb2cobXNnLCB0aGlzLl9vYmopIDogY29uc29sZS5sb2codGhpcy5fb2JqKTsNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0sDQoNCiAgICB0b0ZpbGU6IGZ1bmN0aW9uKHB0aCwgb3B0aW9ucykgew0KICAgICAgdmFyIGRhdGEgPSB0aGlzLl9vYmo7DQogICAgICBpZiAoaXNPYmplY3QoZGF0YSkpIHsNCiAgICAgICAgZGF0YSA9IGluc3BlY3QoZGF0YSwgb3B0aW9ucyk7DQogICAgICB9DQogICAgICBvdXRwdXRGaWxlU3luYyhwdGgsIGRhdGEsIG9wdGlvbnMpOw0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfSwNCg0KICAgIHRvSlNPTjogZnVuY3Rpb24ocHRoLCBvcHRpb25zKSB7DQogICAgICBvdXRwdXRKc29uU3luYyhwdGgsIHRoaXMuX29iaiwgb3B0aW9ucyk7DQogICAgICByZXR1cm4gdGhpczsNCiAgICB9LA0KDQogICAgdG9Kc29uOiBmdW5jdGlvbihwdGgsIG9wdGlvbnMpIHsNCiAgICAgIHJldHVybiB0aGlzLnRvSlNPTihwdGgsIG9wdGlvbnMpOw0KICAgIH0sDQoNCiAgICB0b0NTVjogZnVuY3Rpb24ocHRoLCBvcHRpb25zKSB7DQogICAgICB2YXIgZGF0YSA9IHN0cmluZ2lmeSQxKHRoaXMuX29iaiwgb3B0aW9ucyk7DQogICAgICBvdXRwdXRGaWxlU3luYyhwdGgsIGRhdGEsIG9wdGlvbnMpOw0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfSwNCg0KICAgIHRvQ3N2OiBmdW5jdGlvbihwdGgsIG9wdGlvbnMpIHsNCiAgICAgIHJldHVybiB0aGlzLnRvQ1NWKHB0aCwgb3B0aW9ucyk7DQogICAgfQ0KICB9KTsNCg0KICBDaGFpbi5yYW5nZSA9IGZ1bmN0aW9uKCkgew0KICAgIHZhciBkYXRhID0gYXBwbHkocmFuZ2UsIG51bGwsIGFyZ3VtZW50cyk7DQogICAgcmV0dXJuIENoYWluKGRhdGEpOw0KICB9Ow0KDQogIENoYWluLnRleHQgPSBmdW5jdGlvbihwdGgsIGVuY29kaW5nKSB7DQogICAgaWYgKCFpc2FicyhwdGgpKSBwdGggPSBhYnNwYXRoKHB0aCk7DQogICAgdmFyIGRhdGEgPSByZWFkRmlsZVN5bmMocHRoLCBlbmNvZGluZyB8fCAnVVRGLTgnKTsNCiAgICByZXR1cm4gQ2hhaW4oZGF0YSk7DQogIH07DQoNCiAgQ2hhaW4ubGluZXMgPSBmdW5jdGlvbihwdGgpIHsNCiAgICBpZiAoIWlzYWJzKHB0aCkpIHB0aCA9IGFic3BhdGgocHRoKTsNCiAgICB2YXIgZGF0YSA9IHJlYWRMaW5lc1N5bmMocHRoKTsNCiAgICByZXR1cm4gQ2hhaW4oZGF0YSk7DQogIH07DQoNCiAgQ2hhaW4uanNvbiA9IGZ1bmN0aW9uKHB0aCkgew0KICAgIHZhciBkYXRhID0gcmVhZEpzb25TeW5jKHB0aCk7DQogICAgcmV0dXJuIENoYWluKGRhdGEpOw0KICB9Ow0KDQogIENoYWluLmNzdiA9IGZ1bmN0aW9uKHB0aCwgZW5jb2RpbmcpIHsNCiAgICBpZiAoIWlzYWJzKHB0aCkpIHB0aCA9IGFic3BhdGgocHRoKTsNCiAgICB2YXIgZGF0YSA9IHJlYWRGaWxlU3luYyhwdGgsIGVuY29kaW5nIHx8ICdVVEYtOCcpOw0KICAgIHJldHVybiBDaGFpbihwYXJzZSQyKGRhdGEpKTsNCiAgfTsNCg0KICBDaGFpbi5yZWFkZGlyID0gZnVuY3Rpb24ocHRoKSB7DQogICAgaWYgKCFpc2FicyhwdGgpKSBwdGggPSBhYnNwYXRoKHB0aCk7DQogICAgdmFyIGRhdGEgPSByZWFkZGlyU3luYyhwdGgpOw0KICAgIHJldHVybiBDaGFpbihkYXRhKTsNCiAgfTsNCg0KICBDaGFpbi5zY2FuZGlyID0gZnVuY3Rpb24ocHRoKSB7DQogICAgaWYgKCFpc2FicyhwdGgpKSBwdGggPSBhYnNwYXRoKHB0aCk7DQogICAgdmFyIGRhdGEgPSBzY2FuZGlyKHB0aCk7DQogICAgcmV0dXJuIENoYWluKGRhdGEpOw0KICB9Ow0KDQogIENoYWluLndhbGsgPSBmdW5jdGlvbihwdGgsIHNlbGVjdCkgew0KICAgIHZhciBkYXRhID0gW107DQogICAgaWYgKCFzZWxlY3QpIHNlbGVjdCA9IGZ1bmN0aW9uKCBpdCApe3JldHVybiAgaXQucGF0aH07DQogICAgd2FsayhwdGgsIGZ1bmN0aW9uKCBpdCApIHsNCiAgICAgIGRhdGEucHVzaChzZWxlY3QoaXQpKTsNCiAgICB9KTsNCiAgICByZXR1cm4gQ2hhaW4oZGF0YSk7DQogIH07DQoNCiAgQ2hhaW4ubWF0Y2ggPSBmdW5jdGlvbihzdHIsIHBhdHRlcm4pIHsNCiAgICB2YXIgbWF0Y2hlcyA9IFtdOw0KICAgIGVhY2hNYXRjaChzdHIsIHBhdHRlcm4sIGZ1bmN0aW9uICgpICB7DQogICAgICBtYXRjaGVzLnB1c2goYXJndW1lbnRzKTsNCiAgICB9KTsNCiAgICByZXR1cm4gQ2hhaW4obWF0Y2hlcyk7DQogIH07DQoNCiAgQ2hhaW4uYXBpID0gQ0hBSU5fQVBJOwoKICB2YXIgY2hhaW4gPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICAnZGVmYXVsdCc6IENoYWluCiAgfSk7CgogIHZhciBSRUdFWF9QQVJTRSA9IC9eKFxkezR9KVstL10/KFxkezEsMn0pWy0vXT8oXGR7MSwyfSlbXjAtOV0qKFxkezEsMn0pPzo/KFxkezEsMn0pPzo/KFxkezEsMn0pP1wuPyhcZHsxLDN9KT8kLzsNCiAgdmFyIFJFR0VYX0ZPUk1BVCA9IC9cWyhbXlxdXSspXXxZezIsNH18TXsxLDR9fER7MSwyfXxkezEsNH18SHsxLDJ9fGh7MSwyfXxhfEF8bXsxLDJ9fHN7MSwyfXxaezEsMn18U1NTL2c7DQogIHZhciBNUyA9ICdtaWxsaXNlY29uZCc7DQogIHZhciBTID0gJ3NlY29uZCc7DQogIHZhciBNSU4gPSAnbWludXRlJzsNCiAgdmFyIEggPSAnaG91cic7DQogIHZhciBEID0gJ2RheSc7DQogIHZhciBXID0gJ3dlZWsnOw0KICB2YXIgTSA9ICdtb250aCc7DQogIHZhciBRID0gJ3F1YXJ0ZXInOw0KICB2YXIgWSA9ICd5ZWFyJzsNCiAgdmFyIERBVEUgPSAnZGF0ZSc7DQogIHZhciBGT1JNQVRfREVGQVVMVCA9ICdZWVlZLU1NLUREVEhIOm1tOnNzWic7DQogIHZhciBJTlZBTElEX0RBVEVfU1RSSU5HID0gJ0ludmFsaWQgRGF0ZSc7DQoNCiAgdmFyIExzID0gew0KICAgIGVuOiB7DQogICAgICBuYW1lOiAnZW4nLA0KICAgICAgd2Vla2RheXM6ICdTdW5kYXlfTW9uZGF5X1R1ZXNkYXlfV2VkbmVzZGF5X1RodXJzZGF5X0ZyaWRheV9TYXR1cmRheScuc3BsaXQoDQogICAgICAgICdfJw0KICAgICAgKSwNCiAgICAgIG1vbnRoczogJ0phbnVhcnlfRmVicnVhcnlfTWFyY2hfQXByaWxfTWF5X0p1bmVfSnVseV9BdWd1c3RfU2VwdGVtYmVyX09jdG9iZXJfTm92ZW1iZXJfRGVjZW1iZXInLnNwbGl0KA0KICAgICAgICAnXycNCiAgICAgICkNCiAgICB9DQogIH07DQogIHZhciBMID0gJ2VuJzsNCg0KICBmdW5jdGlvbiBwYXJzZUxvY2FsZShwcmVzZXQsIG9iamVjdCwgaXNMb2NhbCkgew0KICAgIHZhciBsOw0KICAgIGlmICghcHJlc2V0KSByZXR1cm4gbnVsbDsNCiAgICBpZiAoaXNTdHJpbmcocHJlc2V0KSkgew0KICAgICAgaWYgKExzW3ByZXNldF0pIHsNCiAgICAgICAgbCA9IHByZXNldDsNCiAgICAgIH0NCiAgICAgIGlmIChvYmplY3QpIHsNCiAgICAgICAgTHNbcHJlc2V0XSA9IG9iamVjdDsNCiAgICAgICAgbCA9IHByZXNldDsNCiAgICAgIH0NCiAgICB9IGVsc2Ugew0KICAgICAgdmFyIG5hbWUgPSBwcmVzZXQubmFtZTsNCiAgICAgIExzW25hbWVdID0gcHJlc2V0Ow0KICAgICAgbCA9IG5hbWU7DQogICAgfQ0KICAgIGlmICghaXNMb2NhbCkgTCA9IGw7DQogICAgcmV0dXJuIGw7DQogIH0NCg0KICBmdW5jdGlvbiBpc0RheWpzKGRhdGUpIHsNCiAgICByZXR1cm4gZGF0ZSBpbnN0YW5jZW9mIERheWpzOw0KICB9DQoNCiAgZnVuY3Rpb24gZGF5anMoZGF0ZSwgY2ZnKSB7DQogICAgaWYgKGlzRGF5anMoZGF0ZSkpIHJldHVybiBkYXRlLmNsb25lKCk7DQogICAgdmFyIF9jZmcgPSB7IGRhdGU6IGRhdGUgfTsNCiAgICBpZiAoaXNTdHJpbmcoY2ZnKSkgew0KICAgICAgX2NmZy5mb3JtYXQgPSBjZmc7DQogICAgfSBlbHNlIGlmIChpc09iamVjdExpa2UoY2ZnKSkgew0KICAgICAgZXh0ZW5kKF9jZmcsIGNmZyk7DQogICAgfQ0KICAgIHJldHVybiBuZXcgRGF5anMoX2NmZyk7DQogIH0NCg0KICBmdW5jdGlvbiBEYXlqcyhjZmcpIHsNCiAgICB0aGlzLiRMID0gcGFyc2VMb2NhbGUoY2ZnLmxvY2FsZSwgbnVsbCwgdHJ1ZSkgfHwgTDsNCiAgICB0aGlzLnBhcnNlKGNmZyk7DQogIH0NCg0KICB2YXIgX3Byb3RvID0gRGF5anMucHJvdG90eXBlOw0KDQogIF9wcm90by5wYXJzZSA9IGZ1bmN0aW9uKGNmZykgew0KICAgIHRoaXMuJGQgPSBwYXJzZURhdGUoY2ZnKTsNCiAgICB0aGlzLmluaXQoKTsNCiAgfTsNCg0KICBmdW5jdGlvbiBwYXJzZURhdGUoY2ZnKSB7DQogICAgdmFyIGRhdGUgPSBjZmcuZGF0ZSwNCiAgICAgIHV0YyA9IGNmZy51dGM7DQogICAgaWYgKGRhdGUgPT0gbnVsbCkgcmV0dXJuIG5ldyBEYXRlKCk7DQogICAgaWYgKGlzRGF0ZShkYXRlKSkgcmV0dXJuIG5ldyBEYXRlKGRhdGUpOw0KICAgIGlmIChpc1N0cmluZyhkYXRlKSAmJiAhL1okL2kudGVzdChkYXRlKSkgew0KICAgICAgdmFyIG0gPSBkYXRlLm1hdGNoKFJFR0VYX1BBUlNFKTsNCiAgICAgIGlmIChtKSB7DQogICAgICAgIGlmICh1dGMpIHsNCiAgICAgICAgICByZXR1cm4gbmV3IERhdGUoDQogICAgICAgICAgICBEYXRlLlVUQygNCiAgICAgICAgICAgICAgbVsxXSwNCiAgICAgICAgICAgICAgbVsyXSAtIDEsDQogICAgICAgICAgICAgIG1bM10sDQogICAgICAgICAgICAgIG1bNF0gfHwgMCwNCiAgICAgICAgICAgICAgbVs1XSB8fCAwLA0KICAgICAgICAgICAgICBtWzZdIHx8IDAsDQogICAgICAgICAgICAgIG1bN10gfHwgMA0KICAgICAgICAgICAgKQ0KICAgICAgICAgICk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKA0KICAgICAgICAgIG1bMV0sDQogICAgICAgICAgbVsyXSAtIDEsDQogICAgICAgICAgbVszXSwNCiAgICAgICAgICBtWzRdIHx8IDAsDQogICAgICAgICAgbVs1XSB8fCAwLA0KICAgICAgICAgIG1bNl0gfHwgMCwNCiAgICAgICAgICBtWzddIHx8IDANCiAgICAgICAgKTsNCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIG5ldyBEYXRlKGRhdGUpOw0KICB9DQoNCiAgX3Byb3RvLmluaXQgPSBmdW5jdGlvbigpIHsNCiAgICB2YXIgJGQgPSB0aGlzLiRkOw0KICAgIGV4dGVuZCh0aGlzLCB7DQogICAgICAkeTogJGQuZ2V0RnVsbFllYXIoKSwNCiAgICAgICRNOiAkZC5nZXRNb250aCgpLA0KICAgICAgJEQ6ICRkLmdldERhdGUoKSwNCiAgICAgICRXOiAkZC5nZXREYXkoKSwNCiAgICAgICRIOiAkZC5nZXRIb3VycygpLA0KICAgICAgJG06ICRkLmdldE1pbnV0ZXMoKSwNCiAgICAgICRzOiAkZC5nZXRTZWNvbmRzKCksDQogICAgICAkbXM6ICRkLmdldE1pbGxpc2Vjb25kcygpDQogICAgfSk7DQogIH07DQoNCiAgX3Byb3RvLmlzVmFsaWQgPSBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gdGhpcy4kZC50b1N0cmluZygpICE9PSBJTlZBTElEX0RBVEVfU1RSSU5HOw0KICB9Ow0KDQogIF9wcm90by5pc1NhbWUgPSBmdW5jdGlvbih0aGF0LCB1bml0cykgew0KICAgIHZhciBvdGhlciA9IGRheWpzKHRoYXQpOw0KICAgIHJldHVybiB0aGlzLnN0YXJ0T2YodW5pdHMpIDw9IG90aGVyICYmIG90aGVyIDw9IHRoaXMuZW5kT2YodW5pdHMpOw0KICB9Ow0KDQogIF9wcm90by5pc0FmdGVyID0gZnVuY3Rpb24odGhhdCwgdW5pdHMpIHsNCiAgICByZXR1cm4gZGF5anModGhhdCkgPCB0aGlzLnN0YXJ0T2YodW5pdHMpOw0KICB9Ow0KDQogIF9wcm90by5pc0JlZm9yZSA9IGZ1bmN0aW9uKHRoYXQsIHVuaXRzKSB7DQogICAgcmV0dXJuIHRoaXMuZW5kT2YodW5pdHMpIDwgZGF5anModGhhdCk7DQogIH07DQoNCiAgZWFjaCgNCiAgICB7DQogICAgICAkeTogWSwNCiAgICAgICRNOiBNLA0KICAgICAgJFc6IEQsDQogICAgICAkRDogREFURSwNCiAgICAgICRIOiBILA0KICAgICAgJG06IE1JTiwNCiAgICAgICRzOiBTLA0KICAgICAgJG1zOiBNUw0KICAgIH0sIGZ1bmN0aW9uDQogICAgKHVuaXQsIHByb3ApICB7DQogICAgICBfcHJvdG9bdW5pdF0gPSBmdW5jdGlvbihpbnB1dCkgew0KICAgICAgICByZXR1cm4gaW5wdXQgPT0gbnVsbCA/IHRoaXNbcHJvcF0gOiB0aGlzLmNsb25lKCkuJHNldCh1bml0LCBpbnB1dCk7DQogICAgICB9Ow0KICAgIH0uYmluZCh3aW5kb3cpDQogICk7DQoNCiAgX3Byb3RvLnZhbHVlT2YgPSBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gdGhpcy4kZC5nZXRUaW1lKCk7DQogIH07DQoNCiAgZnVuY3Rpb24gcHJldHR5VW5pdCh1KSB7DQogICAgdmFyIHNwZWNpYWwgPSB7DQogICAgICBNOiBNLA0KICAgICAgeTogWSwNCiAgICAgIHc6IFcsDQogICAgICBkOiBELA0KICAgICAgaDogSCwNCiAgICAgIG06IE1JTiwNCiAgICAgIHM6IFMsDQogICAgICBtczogTVMsDQogICAgICBROiBRDQogICAgfTsNCiAgICByZXR1cm4gKA0KICAgICAgc3BlY2lhbFt1XSB8fA0KICAgICAgU3RyaW5nKHUgfHwgJycpDQogICAgICAgIC50b0xvd2VyQ2FzZSgpDQogICAgICAgIC5yZXBsYWNlKC9zJC8sICcnKQ0KICAgICk7DQogIH0NCg0KICBfcHJvdG8uc3RhcnRPZiA9IGZ1bmN0aW9uKHVuaXRzLCBfc3RhcnRPZikgew0KICAgIA0KICAgIHZhciBpc1N0YXJ0T2YgPSBfc3RhcnRPZiA9PSBudWxsID8gdHJ1ZSA6IF9zdGFydE9mOw0KICAgIHZhciB1bml0ID0gcHJldHR5VW5pdCh1bml0cyk7DQogICAgdmFyICRNID0gdGhpcy4kTSwNCiAgICAgICRXID0gdGhpcy4kVywNCiAgICAgICREID0gdGhpcy4kRDsNCiAgICB2YXIgY2xvbmUgPSB0aGlzLmNsb25lKCk7DQoNCiAgICBzd2l0Y2ggKHVuaXQpIHsNCiAgICAgIGNhc2UgWToNCiAgICAgICAgcmV0dXJuIGNsb25lLiQkc2V0KGlzU3RhcnRPZiA/IHsgTTogMCwgZGF0ZTogMSB9IDogeyBNOiAxMSwgZGF0ZTogMzEgfSk7DQogICAgICBjYXNlIE06DQogICAgICAgIHJldHVybiBjbG9uZS4kJHNldCgNCiAgICAgICAgICBpc1N0YXJ0T2YgPyB7IE06ICRNLCBkYXRlOiAxIH0gOiB7IE06ICRNICsgMSwgZGF0ZTogMCB9DQogICAgICAgICk7DQogICAgICBjYXNlIEQ6DQogICAgICBjYXNlIERBVEU6DQogICAgICAgIHJldHVybiBjbG9uZS4kc2V0KEgsIGlzU3RhcnRPZiA/IDAgOiAyMyk7DQogICAgICBjYXNlIEg6DQogICAgICAgIHJldHVybiBjbG9uZS4kc2V0KE1JTiwgaXNTdGFydE9mID8gMCA6IDU5KTsNCiAgICAgIGNhc2UgTUlOOg0KICAgICAgICByZXR1cm4gY2xvbmUuJHNldChTLCBpc1N0YXJ0T2YgPyAwIDogNTkpOw0KICAgICAgY2FzZSBTOg0KICAgICAgICByZXR1cm4gY2xvbmUuJHNldChNUywgaXNTdGFydE9mID8gMCA6IDk5OSk7DQogICAgICBjYXNlIFc6IHsNCiAgICAgICAgdmFyIHdlZWtTdGFydCA9IHRoaXMuJGxvY2FsZSgpLndlZWtTdGFydCB8fCAwOw0KICAgICAgICB2YXIgZ2FwID0gKCRXIDwgd2Vla1N0YXJ0ID8gJFcgKyA3IDogJFcpIC0gd2Vla1N0YXJ0Ow0KICAgICAgICByZXR1cm4gY2xvbmUuJHNldChEQVRFLCBpc1N0YXJ0T2YgPyAkRCAtIGdhcCA6ICREICsgKDYgLSBnYXApKTsNCiAgICAgIH0NCiAgICAgIGRlZmF1bHQ6DQogICAgICAgIHJldHVybiBjbG9uZTsNCiAgICB9DQogIH07DQoNCiAgX3Byb3RvLmVuZE9mID0gZnVuY3Rpb24odW5pdHMpIHsNCiAgICByZXR1cm4gdGhpcy5zdGFydE9mKHVuaXRzLCBmYWxzZSk7DQogIH07DQoNCiAgdmFyIFVOSVRfTUVUSE9EID0gZnJvbVBhaXJzKFsNCiAgICBbRCwgJ0RhdGUnXSwNCiAgICBbREFURSwgJ0RhdGUnXSwNCiAgICBbTSwgJ01vbnRoJ10sDQogICAgW1ksICdGdWxsWWVhciddLA0KICAgIFtILCAnSG91cnMnXSwNCiAgICBbTUlOLCAnTWludXRlcyddLA0KICAgIFtTLCAnU2Vjb25kcyddLA0KICAgIFtNUywgJ01pbGxpc2Vjb25kcyddDQogIF0pOw0KDQogIGZ1bmN0aW9uIF9zZXQoc2VsZiwgdW5pdHMsIF9pbnQpIHsNCiAgICB2YXIgdW5pdCA9IHByZXR0eVVuaXQodW5pdHMpOw0KICAgIHZhciB1dGNQYWQgPSAnc2V0JyArIChzZWxmLiR1ID8gJ1VUQycgOiAnJyk7DQogICAgdmFyIG5hbWUgPSBVTklUX01FVEhPRFt1bml0XTsNCiAgICB2YXIgYXJnID0gdW5pdCA9PSBEID8gc2VsZi4kRCArIChfaW50IC0gc2VsZi4kVykgOiBfaW50Ow0KDQogICAgaWYgKG5hbWUpIHsNCiAgICAgIGlmICh1bml0ID09IE0gfHwgdW5pdCA9PSBZKSB7DQogICAgICAgIHZhciBfZCA9IHNlbGYudG9EYXRlKCk7DQogICAgICAgIF9kLnNldERhdGUoMSk7DQogICAgICAgIF9kW3V0Y1BhZCArIG5hbWVdKGFyZyk7DQogICAgICAgIF9kLnNldE1vbnRoKF9kLmdldE1vbnRoKCkgKyAxKTsNCiAgICAgICAgX2Quc2V0RGF0ZSgwKTsNCiAgICAgICAgdmFyIF9sYXN0RGF0ZSA9IF9kLmdldERhdGUoKTsNCiAgICAgICAgaWYgKHNlbGYuJEQgPCBfbGFzdERhdGUpIHsNCiAgICAgICAgICBfZC5zZXREYXRlKHNlbGYuJEQpOw0KICAgICAgICB9DQogICAgICAgIHNlbGYuJGQgPSBfZDsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHNlbGYuJGRbdXRjUGFkICsgbmFtZV0oYXJnKTsNCiAgICAgIH0NCiAgICB9DQogIH0NCg0KICBfcHJvdG8uJHNldCA9IGZ1bmN0aW9uKHVuaXRzLCBfaW50KSB7DQogICAgX3NldCh0aGlzLCB1bml0cywgX2ludCk7DQogICAgdGhpcy5pbml0KCk7DQogICAgcmV0dXJuIHRoaXM7DQogIH07DQoNCiAgX3Byb3RvLiQkc2V0ID0gZnVuY3Rpb24ob3B0aW9ucykgew0KICAgIHZhciBzZWxmID0gdGhpczsNCiAgICBlYWNoKG9wdGlvbnMsIGZ1bmN0aW9uIChfaW50LCB1bml0cykgIHsNCiAgICAgIF9zZXQoc2VsZiwgdW5pdHMsIF9pbnQpOw0KICAgIH0pOw0KICAgIHRoaXMuaW5pdCgpOw0KICAgIHJldHVybiB0aGlzOw0KICB9Ow0KDQogIF9wcm90by5zZXQgPSBmdW5jdGlvbih1bml0LCBfaW50KSB7DQogICAgdmFyIGNsb25lID0gdGhpcy5jbG9uZSgpOw0KICAgIGlmIChpc1N0cmluZyh1bml0KSkgew0KICAgICAgcmV0dXJuIGNsb25lLiRzZXQodW5pdCwgX2ludCk7DQogICAgfSBlbHNlIGlmIChpc09iamVjdExpa2UodW5pdCkpIHsNCiAgICAgIHJldHVybiBjbG9uZS4kJHNldCh1bml0KTsNCiAgICB9DQogICAgcmV0dXJuIGNsb25lOw0KICB9Ow0KDQogIF9wcm90by5nZXQgPSBmdW5jdGlvbih1bml0KSB7DQogICAgcmV0dXJuIHRoaXNbcHJldHR5VW5pdCh1bml0KV0oKTsNCiAgfTsNCg0KICBfcHJvdG8uYWRkID0gZnVuY3Rpb24obiwgdW5pdHMpIHsNCiAgICB2YXIgbmFtZSA9IHByZXR0eVVuaXQodW5pdHMpOw0KICAgIHZhciBjbG9uZSA9IHRoaXMuY2xvbmUoKTsNCiAgICBuID0gTnVtYmVyKG4pOw0KICAgIGlmIChuYW1lID09IFcpIHJldHVybiBjbG9uZS4kc2V0KERBVEUsIHRoaXMuJEQgKyBNYXRoLnJvdW5kKG4gKiA3KSk7DQogICAgZWxzZSByZXR1cm4gY2xvbmUuJHNldChuYW1lLCB0aGlzW25hbWVdKCkgKyBuKTsNCiAgfTsNCg0KICBfcHJvdG8uc3VidHJhY3QgPSBmdW5jdGlvbihuLCB1bml0KSB7DQogICAgcmV0dXJuIHRoaXMuYWRkKG4gKiAtMSwgdW5pdCk7DQogIH07DQoNCiAgX3Byb3RvLmZvcm1hdCA9IGZ1bmN0aW9uKGZtdCkgew0KICAgIGlmICghdGhpcy5pc1ZhbGlkKCkpIHJldHVybiBJTlZBTElEX0RBVEVfU1RSSU5HOw0KICAgIGZtdCB8fCAoZm10ID0gRk9STUFUX0RFRkFVTFQpOw0KICAgIHZhciAkeSA9IHRoaXMuJHksDQogICAgICAkTSA9IHRoaXMuJE0sDQogICAgICAkRCA9IHRoaXMuJEQsDQogICAgICAkVyA9IHRoaXMuJFcsDQogICAgICAkSCA9IHRoaXMuJEgsDQogICAgICAkbSA9IHRoaXMuJG0sDQogICAgICAkcyA9IHRoaXMuJHMsDQogICAgICAkTVMgPSB0aGlzLiRNUzsNCiAgICB2YXIgbG9jYWxlID0gdGhpcy4kbG9jYWxlKCk7DQogICAgdmFyIHdlZWtkYXlzID0gbG9jYWxlLndlZWtkYXlzLA0KICAgICAgbW9udGhzID0gbG9jYWxlLm1vbnRoczsNCiAgICB2YXIgdHpPZmZzZXQgPSB0aGlzLiRkLmdldFRpbWV6b25lT2Zmc2V0KCk7DQogICAgdmFyIHR6TWludXRlcyA9IE1hdGguYWJzKHR6T2Zmc2V0KTsNCiAgICB2YXIgaG91ck9mZnNldCA9IE1hdGguZmxvb3IodHpNaW51dGVzIC8gNjApOw0KICAgIHZhciBtaW5PZmZzZXQgPSB0ek1pbnV0ZXMgJSA2MDsNCiAgICB2YXIgem9uZVN0ciA9DQogICAgICAodHpPZmZzZXQgPCAwID8gJy0nIDogJysnKSArDQogICAgICBwYWRTdGFydChob3VyT2Zmc2V0LCAyLCAnMCcpICsNCiAgICAgICc6JyArDQogICAgICBwYWRTdGFydChtaW5PZmZzZXQsIDIsICcwJyk7DQogICAgdmFyIHNlbGYgPSB0aGlzOw0KICAgIHZhciBnZXRTaG9ydCA9IGZ1bmN0aW9uKGFyciwgaW5kZXgsIGZ1bGwsIGxlbmd0aCkgew0KICAgICAgcmV0dXJuICgNCiAgICAgICAgKGFyciAmJiAoYXJyW2luZGV4XSB8fCBhcnIoc2VsZiwgZm10KSkpIHx8IGZ1bGxbaW5kZXhdLnN1YnN0cigwLCBsZW5ndGgpDQogICAgICApOw0KICAgIH07DQoNCiAgICB2YXIgbWF0Y2hlcyA9IHsNCiAgICAgIFlZOiBTdHJpbmcoJHkpLnNsaWNlKC0yKSwNCiAgICAgIFlZWVk6ICR5LA0KICAgICAgTTogJE0gKyAxLA0KICAgICAgTU06IHBhZFN0YXJ0KCRNICsgMSwgMiwgJzAnKSwNCiAgICAgIE1NTTogZ2V0U2hvcnQobG9jYWxlLm1vbnRoc1Nob3J0LCAkTSwgbW9udGhzLCAzKSwNCiAgICAgIE1NTU06IG1vbnRoc1skTV0gfHwgKGlzRnVuY3Rpb24obW9udGhzKSAmJiBtb250aHModGhpcywgZm10KSksDQogICAgICBEOiAkRCwNCiAgICAgIEREOiBwYWRTdGFydCgkRCwgMiwgJzAnKSwNCiAgICAgIGQ6ICRXLA0KICAgICAgZGQ6IGdldFNob3J0KGxvY2FsZS53ZWVrZGF5c01pbiwgJFcsIHdlZWtkYXlzLCAyKSwNCiAgICAgIGRkZDogZ2V0U2hvcnQobG9jYWxlLndlZWtkYXlzU2hvcnQsICRXLCB3ZWVrZGF5cywgMyksDQogICAgICBkZGRkOiB3ZWVrZGF5c1skV10sDQogICAgICBIOiAkSCwNCiAgICAgIEhIOiBwYWRTdGFydCgkSCwgMiwgJzAnKSwNCiAgICAgIGg6ICRIICUgMTIgfHwgMTIsDQogICAgICBoaDogcGFkU3RhcnQoJEggJSAxMiB8fCAxMiwgMiwgJzAnKSwNCiAgICAgIGE6ICRIIDwgMTIgPyAnYW0nIDogJ3BtJywNCiAgICAgIEE6ICRIIDwgMTIgPyAnQU0nIDogJ1BNJywNCiAgICAgIG06ICRtLA0KICAgICAgbW06IHBhZFN0YXJ0KCRtLCAyLCAnMCcpLA0KICAgICAgczogJHMsDQogICAgICBzczogcGFkU3RhcnQoJHMsIDIsICcwJyksDQogICAgICBTU1M6IHBhZFN0YXJ0KCRNUywgMywgJzAnKSwNCiAgICAgIFo6IHpvbmVTdHINCiAgICB9Ow0KICAgIHJldHVybiBmbXQucmVwbGFjZShSRUdFWF9GT1JNQVQsIGZ1bmN0aW9uKG0wLCBtMSkgew0KICAgICAgcmV0dXJuIG0xIHx8IG1hdGNoZXNbbTBdIHx8IHpvbmVTdHIucmVwbGFjZSgnOicsICcnKTsNCiAgICB9KTsNCiAgfTsNCg0KICBfcHJvdG8udXRjT2Zmc2V0ID0gZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuIC10aGlzLiRkLmdldFRpbWV6b25lT2Zmc2V0KCk7DQogIH07DQoNCiAgZnVuY3Rpb24gbW9udGhEaWZmKGEsIGIpIHsNCiAgICB2YXIgZGlmZiA9IChhLnllYXIoKSAtIGIueWVhcigpKSAqIDEyICsgYS5tb250aCgpIC0gYi5tb250aCgpOw0KICAgIHZhciBhbmNob3IgPSBiLmNsb25lKCkuYWRkKGRpZmYsIE0pOw0KICAgIHZhciBjID0gYSAtIGFuY2hvciA+IDA7DQogICAgdmFyIGFuY2hvcjIgPSBiLmNsb25lKCkuYWRkKGRpZmYgKyAoYyA/IDEgOiAtMSksIE0pOw0KICAgIHJldHVybiBkaWZmICsgKGEgLSBhbmNob3IpIC8gKGMgPyBhbmNob3IyIC0gYW5jaG9yIDogYW5jaG9yIC0gYW5jaG9yMik7DQogIH0NCg0KICBmdW5jdGlvbiBtaWxsaVNlY29uZERpZmYoYSwgYikgew0KICAgIHJldHVybiBhIC0gYiArIChhLnV0Y09mZnNldCgpIC0gYi51dGNPZmZzZXQoKSkgKiA2MDAwMDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGFic0Zsb29yKG4pIHsNCiAgICByZXR1cm4gbiA8IDAgPyBNYXRoLmNlaWwobikgOiBNYXRoLmZsb29yKG4pOw0KICB9DQoNCiAgX3Byb3RvLmRpZmYgPSBmdW5jdGlvbihpbnB1dCwgdW5pdHMsIF9mbG9hdCkgew0KICAgIHZhciB1bml0ID0gcHJldHR5VW5pdCh1bml0cyk7DQogICAgdmFyIHRoYXQgPSBkYXlqcyhpbnB1dCk7DQogICAgdmFyIHJlc3VsdDsNCg0KICAgIHN3aXRjaCAodW5pdCkgew0KICAgICAgY2FzZSBZOg0KICAgICAgICByZXN1bHQgPSBtb250aERpZmYodGhpcywgdGhhdCkgLyAxMjsNCiAgICAgICAgYnJlYWs7DQogICAgICBjYXNlIE06DQogICAgICAgIHJlc3VsdCA9IG1vbnRoRGlmZih0aGlzLCB0aGF0KTsNCiAgICAgICAgYnJlYWs7DQogICAgICBjYXNlIFE6DQogICAgICAgIHJlc3VsdCA9IG1vbnRoRGlmZih0aGlzLCB0aGF0KSAvIDM7DQogICAgICAgIGJyZWFrOw0KICAgICAgY2FzZSBXOg0KICAgICAgICByZXN1bHQgPSBtaWxsaVNlY29uZERpZmYodGhpcywgdGhhdCkgLyA2MDQ4MDAwMDA7DQogICAgICAgIGJyZWFrOw0KICAgICAgY2FzZSBEOg0KICAgICAgICByZXN1bHQgPSBtaWxsaVNlY29uZERpZmYodGhpcywgdGhhdCkgLyA4NjQwMDAwMDsNCiAgICAgICAgYnJlYWs7DQogICAgICBjYXNlIEg6DQogICAgICAgIHJlc3VsdCA9IG1pbGxpU2Vjb25kRGlmZih0aGlzLCB0aGF0KSAvIDM2MDAwMDA7DQogICAgICAgIGJyZWFrOw0KICAgICAgY2FzZSBNSU46DQogICAgICAgIHJlc3VsdCA9IG1pbGxpU2Vjb25kRGlmZih0aGlzLCB0aGF0KSAvIDYwMDAwOw0KICAgICAgICBicmVhazsNCiAgICAgIGNhc2UgUzoNCiAgICAgICAgcmVzdWx0ID0gbWlsbGlTZWNvbmREaWZmKHRoaXMsIHRoYXQpIC8gMTAwMDsNCiAgICAgICAgYnJlYWs7DQogICAgICBkZWZhdWx0Og0KICAgICAgICByZXN1bHQgPSBtaWxsaVNlY29uZERpZmYodGhpcywgdGhhdCk7DQogICAgICAgIGJyZWFrOw0KICAgIH0NCiAgICByZXR1cm4gX2Zsb2F0ID8gcmVzdWx0IDogYWJzRmxvb3IocmVzdWx0KTsNCiAgfTsNCg0KICBfcHJvdG8uZGF5c0luTW9udGggPSBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gdGhpcy5lbmRPZihNKS4kRDsNCiAgfTsNCg0KICBfcHJvdG8uJGxvY2FsZSA9IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiBMc1t0aGlzLiRMXTsNCiAgfTsNCg0KICBfcHJvdG8ubG9jYWxlID0gZnVuY3Rpb24ocHJlc2V0LCBvYmplY3QpIHsNCiAgICBpZiAoIXByZXNldCkgcmV0dXJuIHRoaXMuJEw7DQogICAgdmFyIHRoYXQgPSB0aGlzLmNsb25lKCk7DQogICAgdGhhdC4kTCA9IHBhcnNlTG9jYWxlKHByZXNldCwgb2JqZWN0LCB0cnVlKTsNCiAgICByZXR1cm4gdGhhdDsNCiAgfTsNCg0KICBfcHJvdG8uY2xvbmUgPSBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gZGF5anModGhpcy50b0RhdGUoKSwgew0KICAgICAgbG9jYWxlOiB0aGlzLiRMLA0KICAgICAgdXRjOiB0aGlzLiR1DQogICAgfSk7DQogIH07DQoNCiAgX3Byb3RvLnRvRGF0ZSA9IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiBuZXcgRGF0ZSh0aGlzLiRkKTsNCiAgfTsNCg0KICBfcHJvdG8udG9KU09OID0gZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuIHRoaXMudG9JU09TdHJpbmcoKTsNCiAgfTsNCg0KICBfcHJvdG8udG9JU09TdHJpbmcgPSBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gdGhpcy4kZC50b0lTT1N0cmluZygpOw0KICB9Ow0KDQogIF9wcm90by50b1N0cmluZyA9IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiB0aGlzLiRkLnRvVVRDU3RyaW5nKCk7DQogIH07DQoNCiAgZGF5anMucHJvdG90eXBlID0gRGF5anMucHJvdG90eXBlOw0KICBkYXlqcy5pc0RheWpzID0gaXNEYXlqczsNCiAgZGF5anMubG9jYWxlID0gcGFyc2VMb2NhbGU7DQogIGRheWpzLkxzID0gTHM7DQoNCiAgZGF5anMuZXh0ZW5kID0gZnVuY3Rpb24ocGx1Z2luLCBvcHRpb24pIHsNCiAgICBwbHVnaW4ob3B0aW9uLCBEYXlqcywgZGF5anMpOw0KICAgIHJldHVybiBkYXlqczsNCiAgfTsKCiAgdmFyIGRheWpzJDEgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICAnZGVmYXVsdCc6IGRheWpzCiAgfSk7CgogIHZhciBKU19UT0tFTlMgPSAvKChbJyJdKSg/Oig/IVwyfFxcKS58XFwoPzpcclxufFtcc1xTXSkpKihcMik/fGAoPzpbXmBcXCRdfFxcW1xzXFNdfFwkKD8hXHspfFwkXHsoPzpbXnt9XXxce1tefV0qXH0/KSpcfT8pKihgKT8pfChcL1wvLiopfChcL1wqKD86W14qXXxcKig/IVwvKSkqKFwqXC8pPyl8KFwvKD8hXCopKD86XFsoPzooPyFbXF1cXF0pLnxcXC4pKlxdfCg/IVsvXF1cXF0pLnxcXC4pK1wvKD86KD8hXHMqKD86XGJ8W1x1MDA4MC1cdUZGRkYkXFwnIn4oe118WytcLSFdKD8hPSl8XC4/XGQpKXxbZ21peXVzXXsxLDZ9XGIoPyFbXHUwMDgwLVx1RkZGRiRcXF18XHMqKD86WytcLSolJnxePD4hPT8oe118XC8oPyFbLypdKSkpKSl8KDBbeFhdW1xkYS1mQS1GXSt8MFtvT11bMC03XSt8MFtiQl1bMDFdK3woPzpcZCpcLlxkK3xcZCtcLj8pKD86W2VFXVsrLV0/XGQrKT8pfCgoPyFcZCkoPzooPyFccylbJFx3XHUwMDgwLVx1RkZGRl18XFx1W1xkYS1mQS1GXXs0fXxcXHVce1tcZGEtZkEtRl0rXH0pKyl8KC0tfFwrXCt8JiZ8XHxcfHw9PnxcLnszfXwoPzpbK1wtLyUmfF5dfFwqezEsMn18PHsxLDJ9fD57MSwzfXwhPT98PXsxLDJ9KT0/fFs/fi4sOjtbXF0oKXt9XSl8KFxzKyl8KF4kfFtcc1xTXSkvZzsNCg0KICBmdW5jdGlvbiBtYXRjaFRvVG9rZW4obWF0Y2gpIHsNCiAgICB2YXIgdG9rZW4gPSB7IHR5cGU6ICdpbnZhbGlkJywgdmFsdWU6IG1hdGNoWzBdLCBjbG9zZWQ6IHVuZGVmaW5lZCB9Ow0KICAgIGlmIChtYXRjaFsxXSkNCiAgICAgICh0b2tlbi50eXBlID0gJ3N0cmluZycpLCAodG9rZW4uY2xvc2VkID0gISEobWF0Y2hbM10gfHwgbWF0Y2hbNF0pKTsNCiAgICBlbHNlIGlmIChtYXRjaFs1XSkgdG9rZW4udHlwZSA9ICdjb21tZW50JzsNCiAgICBlbHNlIGlmIChtYXRjaFs2XSkgKHRva2VuLnR5cGUgPSAnY29tbWVudCcpLCAodG9rZW4uY2xvc2VkID0gISFtYXRjaFs3XSk7DQogICAgZWxzZSBpZiAobWF0Y2hbOF0pIHRva2VuLnR5cGUgPSAncmVnZXgnOw0KICAgIGVsc2UgaWYgKG1hdGNoWzldKSB0b2tlbi50eXBlID0gJ251bWJlcic7DQogICAgZWxzZSBpZiAobWF0Y2hbMTBdKSB0b2tlbi50eXBlID0gJ25hbWUnOw0KICAgIGVsc2UgaWYgKG1hdGNoWzExXSkgdG9rZW4udHlwZSA9ICdwdW5jdHVhdG9yJzsNCiAgICBlbHNlIGlmIChtYXRjaFsxMl0pIHRva2VuLnR5cGUgPSAnd2hpdGVzcGFjZSc7DQogICAgcmV0dXJuIHRva2VuOw0KICB9DQoNCiAgZnVuY3Rpb24gZ2V0VG9rZW5zKHNyYykgew0KICAgIHZhciB0b2tlbnMgPSBbXSwNCiAgICAgIG1hdGNoLA0KICAgICAgdG9rZW47DQogICAgZm9yICg7Oykgew0KICAgICAgbWF0Y2ggPSBKU19UT0tFTlMuZXhlYyhzcmMpOw0KICAgICAgaWYgKCFtYXRjaCkgYnJlYWs7DQogICAgICB0b2tlbiA9IG1hdGNoVG9Ub2tlbihtYXRjaCk7DQogICAgICB0b2tlbnMucHVzaCh0b2tlbik7DQogICAgfQ0KICAgIHJldHVybiB0b2tlbnM7DQogIH0NCg0KICB2YXIgRVNDQVBTRV9NQVAkMSA9IHsNCiAgICAiJyI6ICInIiwNCiAgICAnIic6ICciJywNCiAgICAnXHInOiAncicsDQogICAgJ1xuJzogJ24nLA0KICAgICdcdCc6ICd0JywNCiAgICAnXHUyMDI4JzogJ3UyMDI4JywNCiAgICAnXHUyMDI5JzogJ3UyMDI5Jw0KICB9Ow0KDQogIHZhciBFU0NBUFNFX1JFRyQxID0gLyd8InxccnxcbnxcdHxcdTIwMjh8XHUyMDI5XS9nOw0KDQogIGZ1bmN0aW9uIGVzY2FwZUNoYXIkMShjKSB7DQogICAgcmV0dXJuICdcXCcgKyBFU0NBUFNFX01BUCQxW2NdOw0KICB9DQoNCiAgdmFyIFNVQl9SRUcgPSAvXCRceygoPzpbXnt9XXxce1tefV0qXH0/KSopXH0/L2c7DQogIHZhciBTVUJfU0VQID0gJyRUTVAkJzsNCiAgdmFyIFNVQl9TRVBfUkVHID0gL1wkVE1QXCQvZzsNCg0KICBmdW5jdGlvbiByZXBsVG1wU3RyKHRva2VuLCB0b2tlbnMsIGluZGV4KSB7DQogICAgdmFyIHN0ciA9IHRva2VuLnZhbHVlOw0KICAgIGlmICh0b2tlbi50eXBlICE9ICdzdHJpbmcnIHx8IHN0clswXSAhPSAnYCcpIHJldHVybiBmYWxzZTsNCiAgICB2YXIgcmF3X2FyZ3MgPSBbbnVsbF07DQogICAgc3RyID0gc3RyLnNsaWNlKDEsIHN0ci5sZW5ndGggLSAxKTsNCiAgICBzdHIgPSBzdHIucmVwbGFjZShTVUJfUkVHLCBmdW5jdGlvbihnMCwgZzEpIHsNCiAgICAgIHJhd19hcmdzLnB1c2goZzEpOw0KICAgICAgcmV0dXJuIFNVQl9TRVA7DQogICAgfSk7DQogICAgdmFyIHN0clJhdyA9IGluZGV4ID4gMiAmJiB0b2tlbnNbaW5kZXggLSAxXS52YWx1ZTsNCiAgICBpZiAoc3RyUmF3ID09ICdyYXcnKSB7DQogICAgICByYXdfYXJnc1swXSA9IEpTT04uc3RyaW5naWZ5KHsgcmF3OiBzdHIuc3BsaXQoU1VCX1NFUCkgfSk7DQogICAgICB0b2tlbi52YWx1ZSA9ICcoJyArIHJhd19hcmdzLmpvaW4oKSArICcpJzsNCiAgICB9IGVsc2Ugew0KICAgICAgc3RyID0gc3RyLnJlcGxhY2UoRVNDQVBTRV9SRUckMSwgZXNjYXBlQ2hhciQxKTsNCiAgICAgIHJhd19hcmdzWzBdID0gIntyYXc6IFsnIiArIHN0ci5yZXBsYWNlKFNVQl9TRVBfUkVHLCAiJywnIikgKyAiJ119IjsNCiAgICAgIHRva2VuLnZhbHVlID0gJ1N0cmluZy5yYXcoJyArIHJhd19hcmdzLmpvaW4oKSArICcpJzsNCiAgICB9DQogICAgcmV0dXJuIHRydWU7DQogIH0NCg0KICBmdW5jdGlvbiByZXBsQXJyb3codG9rZW4sIHRva2VucywgaW5kZXgpIHsNCiAgICBpZiAodG9rZW4udHlwZSAhPSAncHVuY3R1YXRvcicgfHwgdG9rZW4udmFsdWUgIT0gJz0+JykgcmV0dXJuIGZhbHNlOw0KICAgIHZhciBpID0gaW5kZXgsDQogICAgICBsZW4gPSB0b2tlbnMubGVuZ3RoLA0KICAgICAgZGVwdGggPSAwLA0KICAgICAgaGFzQnJhY2tldCA9IGZhbHNlLA0KICAgICAgaGFzVGhpcyA9IGZhbHNlLA0KICAgICAgdG9rZW5JdDsNCiAgICB3aGlsZSAoLS1pKSB7DQogICAgICB0b2tlbkl0ID0gdG9rZW5zW2ldOw0KICAgICAgaWYgKHRva2VuSXQudHlwZSA9PSAncHVuY3R1YXRvcicpIHsNCiAgICAgICAgc3dpdGNoICh0b2tlbkl0LnZhbHVlKSB7DQogICAgICAgICAgY2FzZSAnKSc6DQogICAgICAgICAgICBoYXNCcmFja2V0ID0gdHJ1ZTsNCiAgICAgICAgICAgIGRlcHRoKys7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgICBjYXNlICcoJzoNCiAgICAgICAgICAgIGRlcHRoLS07DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgaWYgKGRlcHRoID09IDApIGRlcHRoLS07DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSBpZiAodG9rZW5JdC50eXBlID09ICduYW1lJyAmJiB0b2tlbkl0LnZhbHVlID09ICdyZXR1cm4nKSB7DQogICAgICAgIGRlcHRoLS07DQogICAgICB9DQogICAgICBpZiAoZGVwdGggPCAwKSB7DQogICAgICAgIGlmIChoYXNCcmFja2V0KSB7DQogICAgICAgICAgdG9rZW5JdC52YWx1ZSArPSAnIGZ1bmN0aW9uJzsNCiAgICAgICAgICB0b2tlbi52YWx1ZSA9ICcnOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHRva2VuSXQudmFsdWUgKz0gJyBmdW5jdGlvbignOw0KICAgICAgICAgIHRva2VuLnZhbHVlID0gJyknOw0KICAgICAgICB9DQogICAgICAgIGJyZWFrOw0KICAgICAgfQ0KICAgIH0NCiAgICBpID0gaW5kZXg7DQogICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgdG9rZW5JdCA9IHRva2Vuc1tpXTsNCiAgICAgIGlmICh0b2tlbkl0LnR5cGUgIT0gJ3doaXRlc3BhY2UnKSBicmVhazsNCiAgICB9DQogICAgaGFzQnJhY2tldCA9IGZhbHNlOw0KICAgIGlmICh0b2tlbkl0LnZhbHVlID09ICd7JykgaGFzQnJhY2tldCA9IHRydWU7DQogICAgaS0tOw0KICAgIGRlcHRoID0gMDsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICB0b2tlbkl0ID0gdG9rZW5zW2ldOw0KICAgICAgaWYgKHRva2VuSXQudHlwZSA9PSAncHVuY3R1YXRvcicpIHsNCiAgICAgICAgc3dpdGNoICh0b2tlbkl0LnZhbHVlKSB7DQogICAgICAgICAgY2FzZSAneyc6DQogICAgICAgICAgY2FzZSAnKCc6DQogICAgICAgICAgY2FzZSAnWyc6DQogICAgICAgICAgICBkZXB0aCsrOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgY2FzZSAnfSc6DQogICAgICAgICAgY2FzZSAnKSc6DQogICAgICAgICAgY2FzZSAnXSc6DQogICAgICAgICAgICBkZXB0aC0tOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgY2FzZSAnLCc6DQogICAgICAgICAgY2FzZSAnOyc6DQogICAgICAgICAgICBpZiAoZGVwdGggPT0gMCkgZGVwdGgtLTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgICB9IGVsc2UgaWYgKHRva2VuSXQudHlwZSA9PSAnd2hpdGVzcGFjZScpIHsNCiAgICAgICAgaWYgKGRlcHRoID09IDAgJiYgdG9rZW5JdC52YWx1ZS5pbmNsdWRlcygnXHJcbicpKSB7DQogICAgICAgICAgZGVwdGgtLTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIGlmICh0b2tlbkl0LnR5cGUgPT0gJ25hbWUnKSB7DQogICAgICAgIGlmICh0b2tlbkl0LnZhbHVlID09ICd0aGlzJykgaGFzVGhpcyA9IHRydWU7DQogICAgICB9DQogICAgICBpZiAoZGVwdGggPCAwKSB7DQogICAgICAgIGlmIChoYXNCcmFja2V0KSB7DQogICAgICAgICAgaWYgKGhhc1RoaXMpIHRva2VuSXQudmFsdWUgPSAnLmJpbmQodGhpcyknICsgdG9rZW5JdC52YWx1ZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICB0b2tlbi52YWx1ZSArPSAne3JldHVybiAnOw0KICAgICAgICAgIGlmIChoYXNUaGlzKSB0b2tlbkl0LnZhbHVlID0gJ30uYmluZCh0aGlzKScgKyB0b2tlbkl0LnZhbHVlOw0KICAgICAgICAgIGVsc2UgdG9rZW5JdC52YWx1ZSA9ICd9JyArIHRva2VuSXQudmFsdWU7DQogICAgICAgIH0NCiAgICAgICAgYnJlYWs7DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgZnVuY3Rpb24gcm1Db21tZW50KHRva2VuKSB7DQogICAgaWYgKHRva2VuLnR5cGUgPT0gJ2NvbW1lbnQnKSB7DQogICAgICB0b2tlbi52YWx1ZSA9ICcnOw0KICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIHJldHVybiBmYWxzZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlcGxJbXBvcnQodG9rZW4sIHRva2VucywgaW5kZXgpIHsNCiAgICB2YXIgaW1wb3J0TWFwID0ge30sDQogICAgICBidWYgPSBbXSwNCiAgICAgIGluc2lkZSwNCiAgICAgIGJBbGlhcywNCiAgICAgIHR5cGUsDQogICAgICB2YWx1ZSwNCiAgICAgIGksDQogICAgICBsZW4sDQogICAgICB0b2tlbkl0LA0KICAgICAgbmFtZSwNCiAgICAgIG1vZHVsZU5hbWUsDQogICAgICBtb2R1bGVBbGlhczsNCiAgICBpZiAodG9rZW4udHlwZSAhPSAnbmFtZScgfHwgdG9rZW4udmFsdWUgIT0gJ2ltcG9ydCcpIHJldHVybiBmYWxzZTsNCiAgICB0b2tlbi52YWx1ZSA9ICcnOw0KICAgIGkgPSBpbmRleDsNCiAgICBsZW4gPSB0b2tlbnMubGVuZ3RoOw0KICAgIHRva2VuSXQgPSB0b2tlbjsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICB0b2tlbkl0LnZhbHVlID0gJyc7DQogICAgICB0b2tlbkl0ID0gdG9rZW5zW2ldOw0KICAgICAgdHlwZSA9IHRva2VuSXQudHlwZTsNCiAgICAgIHZhbHVlID0gdG9rZW5JdC52YWx1ZTsNCiAgICAgIGlmICh0eXBlID09ICduYW1lJykgew0KICAgICAgICBpZiAodmFsdWUgPT0gJ2Zyb20nKSB7DQogICAgICAgICAgY29udGludWU7DQogICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT0gJ2FzJykgew0KICAgICAgICAgIGJBbGlhcyA9IHRydWU7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgaWYgKGJBbGlhcykgew0KICAgICAgICAgICAgaW1wb3J0TWFwW25hbWVdID0gdmFsdWU7DQogICAgICAgICAgICBiQWxpYXMgPSBmYWxzZTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgbmFtZSA9IHZhbHVlOw0KICAgICAgICAgICAgaWYgKGluc2lkZSkgew0KICAgICAgICAgICAgICBpbXBvcnRNYXBbbmFtZV0gPSBuYW1lOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgaW1wb3J0TWFwWydkZWZhdWx0J10gPSBuYW1lOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIGlmICh0eXBlID09ICdwdW5jdHVhdG9yJykgew0KICAgICAgICBpZiAodmFsdWUgPT0gJyonKSB7DQogICAgICAgICAgbmFtZSA9ICcqJzsNCiAgICAgICAgICBpbXBvcnRNYXBbJyonXSA9IDA7DQogICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT0gJ3snKSB7DQogICAgICAgICAgaW5zaWRlID0gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PSAnfScpIHsNCiAgICAgICAgICBpbnNpZGUgPSBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIGlmICh0eXBlID09ICdzdHJpbmcnKSB7DQogICAgICAgIG1vZHVsZU5hbWUgPSB2YWx1ZS5zbGljZSgxLCB2YWx1ZS5sZW5ndGggLSAxKTsNCiAgICAgICAgYnJlYWs7DQogICAgICB9DQogICAgfQ0KDQogICAgbW9kdWxlQWxpYXMgPSBtb2R1bGVOYW1lLnJlcGxhY2UoL1tcXC8uLUBdL2csICdfJyk7DQogICAgbW9kdWxlQWxpYXMgKz0NCiAgICAgICdfJyArDQogICAgICBNYXRoLnJhbmRvbSgpDQogICAgICAgIC50b1N0cmluZygxNikNCiAgICAgICAgLnNsaWNlKDIpOw0KICAgIGJ1Zi5wdXNoKG1vZHVsZUFsaWFzICsgIj1yZXF1aXJlKCciICsgbW9kdWxlTmFtZSArICInKSIpOw0KICAgIGlmIChpbXBvcnRNYXBbJyonXSkgew0KICAgICAgYnVmLnB1c2goaW1wb3J0TWFwWycqJ10gKyAnPScgKyBtb2R1bGVBbGlhcyk7DQogICAgICBkZWxldGUgaW1wb3J0TWFwWycqJ107DQogICAgfQ0KICAgIGlmIChpbXBvcnRNYXBbJ2RlZmF1bHQnXSkgew0KICAgICAgYnVmLnB1c2goaW1wb3J0TWFwWydkZWZhdWx0J10gKyAnPScgKyBtb2R1bGVBbGlhcyArICJbJ2RlZmF1bHQnXSIpOw0KICAgICAgZGVsZXRlIGltcG9ydE1hcFsnZGVmYXVsdCddOw0KICAgIH0NCiAgICBmb3IgKG5hbWUgaW4gaW1wb3J0TWFwKSB7DQogICAgICBidWYucHVzaChpbXBvcnRNYXBbbmFtZV0gKyAnPScgKyBtb2R1bGVBbGlhcyArICcuJyArIG5hbWUpOw0KICAgIH0NCiAgICB0b2tlbkl0LnZhbHVlID0gJ2xldCAnICsgYnVmLmpvaW4oKTsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHRyYW5zcGlsZShjb2RlKSB7DQogICAgdmFyIHRva2VucyA9IGdldFRva2Vucyhjb2RlKSwNCiAgICAgIHRva2VuLA0KICAgICAgc291cmNlOw0KICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0b2tlbnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCiAgICAgIHRva2VuID0gdG9rZW5zW2ldOw0KICAgICAgaWYgKHJlcGxUbXBTdHIodG9rZW4sIHRva2VucywgaSkpIGNvbnRpbnVlOw0KICAgICAgaWYgKHJlcGxBcnJvdyh0b2tlbiwgdG9rZW5zLCBpKSkgY29udGludWU7DQogICAgICBpZiAocmVwbEltcG9ydCh0b2tlbiwgdG9rZW5zLCBpKSkgY29udGludWU7DQogICAgICBybUNvbW1lbnQodG9rZW4pOw0KICAgIH0NCiAgICBzb3VyY2UgPSB0b2tlbnMubWFwKCBmdW5jdGlvbihpdCApe3JldHVybiAgaXQudmFsdWV9KS5qb2luKCcnKTsNCg0KICAgIHJldHVybiBzb3VyY2U7DQogIH0KCiAgdmFyIEludGVybmFsTW9kdWxlcyA9IHsNCiAgICBhY2NkYjogYWNjZGIkMSwNCiAgICBhZG9kYjogYWRvZGIsDQogICAgY2hpbGRfcHJvY2VzczogY2hpbGRfcHJvY2VzcywNCiAgICBjcnlwdG86IGNyeXB0byQxLA0KICAgIGNzdjogY3N2LA0KICAgIGNzdmRiOiBjc3ZkYiQxLA0KICAgIGRheWpzOiBkYXlqcyQxLA0KICAgIGV4Y2VsOiBleGNlbCwNCiAgICBleGNlbGRiOiBleGNlbGRiJDEsDQogICAgZnM6IGZzLA0KICAgIGh0dHA6IGh0dHAkMSwNCiAgICBpZTogaWUsDQogICAgb3JhY2xlZGI6IG9yYWNsZWRiJDEsDQogICAgb3V0bG9vazogb3V0bG9vaywNCiAgICBwYXRoOiBQYXRoLA0KICAgIHF1ZXJ5c3RyaW5nOiBxdWVyeXN0cmluZywNCiAgICB0b29sOiB0b29sLA0KICAgIGNoYWluOiBjaGFpbiwNCiAgICB1dGlsOiB1dGlsLA0KICAgIHdtaTogd21pDQogIH07DQoNCiAgd2luZG93LnJlcXVpcmUgPSBmdW5jdGlvbihuYW1lKSB7DQogICAgcmV0dXJuIEludGVybmFsTW9kdWxlc1tuYW1lXTsNCiAgfTsNCg0KICBpZiAocHJvY2Vzcy5hcmd2Lmxlbmd0aCA9PT0gMykgew0KICAgIHZhciBwdGggPSBwcm9jZXNzLmFyZ3ZbMl07DQogICAgaWYgKCFpc0Fic29sdXRlKHB0aCkpIHsNCiAgICAgIHB0aCA9IHJlc29sdmUocHRoKTsNCiAgICB9DQogICAgaWYgKCFleHRuYW1lKHB0aCkpIHsNCiAgICAgIHB0aCArPSAnLmpzJzsNCiAgICB9DQogICAgaWYgKCFpc2ZpbGUocHRoKSkgew0KICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgbG9hZCBmaWxlICciICsgcHRoICsgIiciKTsNCiAgICB9DQogICAgdmFyIHNyYyA9IHJlYWRGaWxlU3luYyhwdGgsICdVVEYtOCcpOw0KICAgIHdpbmRvdy5fX2ZpbGVuYW1lID0gcHRoOw0KICAgIHdpbmRvdy5fX2Rpcm5hbWUgPSBkaXJuYW1lKHB0aCk7DQogICAgc3JjID0gdHJhbnNwaWxlKHNyYyk7DQogICAgdmFyIHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOw0KICAgIHNjcmlwdC50ZXh0ID0gc3JjOw0KICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTsNCiAgfQoKfSgpKTsK';
src = window.decodeURIComponent(window.escape(window.atob(src)));

var script = document.createElement('script');
script.text = src;
window.addEventListener('error', function(e) {
  if (e.error) {
    WScript.Echo(e.error.stack);
  } else {
    if (e.message) WScript.Echo(' Error:' + e.message);
    WScript.Echo('  line:', e.lineno);
    WScript.Echo('column:', e.colno);
  }
});
document.head.appendChild(script);
/*
:LBL_END
pause
exit
::*/
