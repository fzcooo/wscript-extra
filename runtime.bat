REM = 0; /*
@echo off
cls
title %~f0
cd %~dp0
if "%PROCESSOR_ARCHITECTURE%" EQU "x86" (
  call cscript.exe "%~f0" //Nologo //E:JScript "%~f0" %*
)
if "%PROCESSOR_ARCHITECTURE%" NEQ "x86" (
  call C:\Windows\SysWOW64\CScript.exe "%~f0" //Nologo //E:JScript "%~f0" %*
)
goto LBL_END
*/
var document = new ActiveXObject('htmlfile');
document.write(
  '<!DOCTYPE html><html><head><meta http-equiv=X-UA-Compatible content="IE=edge"><title></title></head><body></body></html>'
);
var window = document.parentWindow;
window.WScript = WScript;
window.ActiveXObject = ActiveXObject;
window.GetObject = GetObject;

var src = 'KGZ1bmN0aW9uICgpIHsKICAndXNlIHN0cmljdCc7CgogIC8vIE5vZGVKUyBSdW50aW1lDQoNCiAgdmFyIFByb2Nlc3MgPSBmdW5jdGlvbiBQcm9jZXNzKCkgew0KICAgIHRoaXMuX3ZlcnNpb24gPSBudWxsOw0KICAgIHRoaXMuX2FyZ3YgPSBudWxsOw0KICAgIHRoaXMuX2VudiA9IG51bGw7DQogIH07CgogIHZhciBwcm90b3R5cGVBY2Nlc3NvcnMgPSB7IHZlcnNpb246IHsgY29uZmlndXJhYmxlOiB0cnVlIH0sYXJndjogeyBjb25maWd1cmFibGU6IHRydWUgfSxlbnY6IHsgY29uZmlndXJhYmxlOiB0cnVlIH0gfTsNCg0KICBQcm9jZXNzLnByb3RvdHlwZS5leGl0ID0gZnVuY3Rpb24gZXhpdCAoc3RhdHVzKSB7CiAgICAgIGlmICggc3RhdHVzID09PSB2b2lkIDAgKSBzdGF0dXMgPSAwOwoNCiAgICBXU2NyaXB0LlF1aXQoc3RhdHVzKTsNCiAgfTsNCg0KICBQcm9jZXNzLnByb3RvdHlwZS5zbGVlcCA9IGZ1bmN0aW9uIHNsZWVwIChtaWxsaXMpIHsNCiAgICBXU2NyaXB0LlNsZWVwKG1pbGxpcyk7DQogIH07DQoNCiAgcHJvdG90eXBlQWNjZXNzb3JzLnZlcnNpb24uZ2V0ID0gZnVuY3Rpb24gKCkgew0KICAgIGlmICh0aGlzLl92ZXJzaW9uKSB7IHJldHVybiB0aGlzLl92ZXJzaW9uOyB9DQoNCiAgICB0aGlzLl92ZXJzaW9uID0NCiAgICAgIFNjcmlwdEVuZ2luZSgpICsNCiAgICAgICcgJyArDQogICAgICBTY3JpcHRFbmdpbmVNYWpvclZlcnNpb24oKSArDQogICAgICAnLicgKw0KICAgICAgU2NyaXB0RW5naW5lTWlub3JWZXJzaW9uKCkgKw0KICAgICAgJy4nICsNCiAgICAgIFNjcmlwdEVuZ2luZUJ1aWxkVmVyc2lvbigpOw0KDQogICAgcmV0dXJuIHRoaXMuX3ZlcnNpb247DQogIH07DQoNCiAgcHJvdG90eXBlQWNjZXNzb3JzLmFyZ3YuZ2V0ID0gZnVuY3Rpb24gKCkgew0KICAgIGlmICh0aGlzLl9hcmd2KSB7IHJldHVybiB0aGlzLl9hcmd2OyB9DQogICAgdGhpcy5fYXJndiA9IFtXU2NyaXB0LkZ1bGxOYW1lXTsNCiAgICB2YXIgZW4gPSBuZXcgRW51bWVyYXRvcihXU2NyaXB0LkFyZ3VtZW50cyk7DQogICAgZm9yICg7ICFlbi5hdEVuZCgpOyBlbi5tb3ZlTmV4dCgpKSB7IHRoaXMuX2FyZ3YucHVzaChlbi5pdGVtKCkpOyB9DQogICAgcmV0dXJuIHRoaXMuX2FyZ3Y7DQogIH07DQoNCiAgcHJvdG90eXBlQWNjZXNzb3JzLmVudi5nZXQgPSBmdW5jdGlvbiAoKSB7DQogICAgaWYgKHRoaXMuX2VudikgeyByZXR1cm4gdGhpcy5fZW52OyB9DQogICAgdmFyIGl0LCBpOw0KICAgIHZhciBlbiA9IG5ldyBFbnVtZXJhdG9yKF9fV1NoZWxsLkVudmlyb25tZW50KCdQUk9DRVNTJykpOw0KICAgIHRoaXMuX2VudiA9IHt9Ow0KICAgIGZvciAoOyAhZW4uYXRFbmQoKTsgZW4ubW92ZU5leHQoKSkgew0KICAgICAgaXQgPSBlbi5pdGVtKCk7DQogICAgICBpID0gaXQuaW5kZXhPZignPScpOw0KICAgICAgaWYgKGkgPiAwKSB7DQogICAgICAgIHRoaXMuX2VudltpdC5zbGljZSgwLCBpKV0gPSBpdC5zbGljZShpICsgMSk7DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiB0aGlzLl9lbnY7DQogIH07CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCBQcm9jZXNzLnByb3RvdHlwZSwgcHJvdG90eXBlQWNjZXNzb3JzICk7DQoNCiAgdmFyIHByb2Nlc3MgPSBuZXcgUHJvY2VzcygpOwoKICB2YXIgX2RvYzsNCg0KICBmdW5jdGlvbiBnZXRYbWxEb2MoKSB7DQogICAgcmV0dXJuIF9kb2MgfHwgKF9kb2MgPSBuZXcgQWN0aXZlWE9iamVjdCgnTVNYTUwyLkRPTURvY3VtZW50LjYuMCcpKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHRleHQydmFsdWUodHlwZSwgdGV4dCkgew0KICAgIHZhciBlbCA9IGdldFhtbERvYygpLmNyZWF0ZUVsZW1lbnQoJ3RtcCcpOw0KICAgIGVsLmRhdGFUeXBlID0gdHlwZTsNCiAgICBlbC50ZXh0ID0gdGV4dDsNCiAgICByZXR1cm4gZWwubm9kZVR5cGVkVmFsdWU7DQogIH0NCg0KICBmdW5jdGlvbiB2YWx1ZTJ0ZXh0KHR5cGUsIHZhbHVlKSB7DQogICAgdmFyIGVsID0gZ2V0WG1sRG9jKCkuY3JlYXRlRWxlbWVudCgndG1wJyk7DQogICAgZWwuZGF0YVR5cGUgPSB0eXBlOw0KICAgIGVsLm5vZGVUeXBlZFZhbHVlID0gdmFsdWU7DQogICAgcmV0dXJuIGVsLnRleHQ7DQogIH0NCg0KICBmdW5jdGlvbiBiaW4yaGV4KGJ5dGVzKSB7DQogICAgcmV0dXJuIHZhbHVlMnRleHQoJ2Jpbi5oZXgnLCBieXRlcyk7DQogIH0NCg0KICBmdW5jdGlvbiBoZXgyYmluKGhleCkgew0KICAgIHJldHVybiB0ZXh0MnZhbHVlKCdiaW4uaGV4JywgaGV4KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGJpbjJiYXNlNjQoYnl0ZXMpIHsNCiAgICByZXR1cm4gdmFsdWUydGV4dCgnYmluLmJhc2U2NCcsIGJ5dGVzKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGJhc2U2NDJiaW4oYmFzZTY0KSB7DQogICAgcmV0dXJuIHRleHQydmFsdWUoJ2Jpbi5iYXNlNjQnLCBiYXNlNjQpOw0KICB9DQoNCiAgZnVuY3Rpb24gYmluMnN0cihieXRlcywgZW5jb2RpbmcpIHsNCiAgICB2YXIgc3QgPSBuZXcgQWN0aXZlWE9iamVjdCgnQURPREIuU3RyZWFtJyksDQogICAgICBzdHI7DQogICAgZW5jb2RpbmcgfHwgKGVuY29kaW5nID0gJ1VURi04Jyk7DQogICAgdHJ5IHsNCiAgICAgIHN0Lk9wZW4oKTsNCiAgICAgIHN0LlR5cGUgPSAxOw0KICAgICAgc3QuV3JpdGUoYnl0ZXMpOw0KICAgICAgc3QuUG9zaXRpb24gPSAwOw0KICAgICAgc3QuVHlwZSA9IDI7DQogICAgICBzdC5DaGFyc2V0ID0gZW5jb2Rpbmc7DQogICAgICBzdHIgPSBzdC5SZWFkVGV4dCgpOw0KICAgIH0gZmluYWxseSB7DQogICAgICBzdC5DbG9zZSgpOw0KICAgIH0NCiAgICByZXR1cm4gc3RyOw0KICB9DQoNCiAgZnVuY3Rpb24gc3RyMmJpbihzdHIsIGVuY29kaW5nKSB7DQogICAgdmFyIHN0ID0gbmV3IEFjdGl2ZVhPYmplY3QoJ0FET0RCLlN0cmVhbScpLA0KICAgICAgYmluOw0KICAgIGVuY29kaW5nIHx8IChlbmNvZGluZyA9ICdVVEYtOCcpOw0KICAgIHRyeSB7DQogICAgICBzdC5PcGVuKCk7DQogICAgICBzdC5UeXBlID0gMjsNCiAgICAgIHN0LkNoYXJzZXQgPSBlbmNvZGluZzsNCiAgICAgIHN0LldyaXRlVGV4dChzdHIpOw0KICAgICAgc3QuUG9zaXRpb24gPSAwOw0KICAgICAgc3QuVHlwZSA9IDE7DQogICAgICBlbmNvZGluZyA9IGVuY29kaW5nLnJlcGxhY2UoJy0nLCAnJykudG9Mb3dlckNhc2UoKTsNCiAgICAgIGlmIChlbmNvZGluZyA9PSAndXRmOCcgfHwgZW5jb2RpbmcgPT0gJ3VuaWNvZGUnKSB7IHN0LlBvc2l0aW9uID0gMzsgfQ0KICAgICAgZWxzZSBpZiAoZW5jb2RpbmcgPT0gJ3VmdDE2JykgeyBzdC5Qb3NpdGlvbiA9IDI7IH0NCiAgICAgIGJpbiA9IHN0LlJlYWQoKTsNCiAgICB9IGZpbmFsbHkgew0KICAgICAgc3QuQ2xvc2UoKTsNCiAgICB9DQogICAgcmV0dXJuIGJpbjsNCiAgfQ0KDQogIGZ1bmN0aW9uIGVuY29kZShzdHIsIGVuY29kaW5nKSB7DQogICAgc3dpdGNoIChlbmNvZGluZykgew0KICAgICAgY2FzZSAnaGV4JzoNCiAgICAgICAgcmV0dXJuIGhleDJiaW4oc3RyKTsNCiAgICAgIGNhc2UgJ2Jhc2U2NCc6DQogICAgICAgIHJldHVybiBiYXNlNjQyYmluKHN0cik7DQogICAgICBkZWZhdWx0Og0KICAgICAgICByZXR1cm4gc3RyMmJpbihzdHIsIGVuY29kaW5nKTsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBkZWNvZGUoYnl0ZXMsIGVuY29kaW5nKSB7DQogICAgc3dpdGNoIChlbmNvZGluZykgew0KICAgICAgY2FzZSAnaGV4JzoNCiAgICAgICAgcmV0dXJuIGJpbjJoZXgoYnl0ZXMpOw0KICAgICAgY2FzZSAnYmFzZTY0JzoNCiAgICAgICAgcmV0dXJuIGJpbjJiYXNlNjQoYnl0ZXMpOw0KICAgICAgY2FzZSAnYmluYXJ5JzoNCiAgICAgICAgcmV0dXJuIGJ5dGVzOw0KICAgICAgZGVmYXVsdDoNCiAgICAgICAgcmV0dXJuIGJpbjJzdHIoYnl0ZXMsIGVuY29kaW5nKTsNCiAgICB9DQogIH0NCg0KICB2YXIgQnVmZmVyID0gZnVuY3Rpb24gQnVmZmVyKG9iaiwgZW5jb2RpbmcpIHsNCiAgICB0aGlzLmJ1ZmZlciA9IG51bGw7DQogICAgaWYgKG9iaiA9PSBudWxsIHx8IG9iaiA9PSAnJyB8fCBvYmoubGVuZ3RoID09IDApIHsNCiAgICAgIHRoaXMuYnVmZmVyID0gbmV3IEFjdGl2ZVhPYmplY3QoJ1NjcmlwdGluZy5EaWN0aW9uYXJ5JykuSXRlbXMoKTsNCiAgICB9IGVsc2UgaWYgKEJ1ZmZlci5pc0J1ZmZlcihvYmopKSB7DQogICAgICB0aGlzLmJ1ZmZlciA9IG9iai5idWZmZXI7DQogICAgfSBlbHNlIGlmICh0eXBlb2Ygb2JqID09ICdzdHJpbmcnKSB7DQogICAgICB0aGlzLmJ1ZmZlciA9IGVuY29kZShvYmosIGVuY29kaW5nKTsNCiAgICB9IGVsc2UgaWYgKG9iaiAhPSBudWxsICYmIG9iai5jb25zdHJ1Y3RvciAmJiBvYmouY29uc3RydWN0b3IgPT09IFZCQXJyYXkpIHsNCiAgICAgIHRoaXMuYnVmZmVyID0gb2JqOw0KICAgIH0gZWxzZSB7DQogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdGYWlsZWQgdG8gY3JlYXRlIGJ1ZmZlci4nKTsNCiAgICB9DQogIH07CgogIHZhciBwcm90b3R5cGVBY2Nlc3NvcnMkMSA9IHsgbGVuZ3RoOiB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH07DQoNCiAgQnVmZmVyLmlzQnVmZmVyID0gZnVuY3Rpb24gaXNCdWZmZXIgKG9iaikgew0KICAgIHJldHVybiBvYmogJiYgb2JqIGluc3RhbmNlb2YgQnVmZmVyOw0KICB9Ow0KDQogIEJ1ZmZlci5mcm9tID0gZnVuY3Rpb24gZnJvbSAob2JqLCBlbmNvZGluZykgew0KICAgIHJldHVybiBuZXcgQnVmZmVyKG9iaiwgZW5jb2RpbmcpOw0KICB9OwoKICBCdWZmZXIucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gdG9TdHJpbmcgKGVuY29kaW5nKSB7DQogICAgcmV0dXJuIHRoaXMuYnVmZmVyLnVib3VuZCgpID09IC0xID8gJycgOiBkZWNvZGUodGhpcy5idWZmZXIsIGVuY29kaW5nKTsNCiAgfTsNCg0KICBwcm90b3R5cGVBY2Nlc3NvcnMkMS5sZW5ndGguZ2V0ID0gZnVuY3Rpb24gKCkgew0KICAgIHJldHVybiB0aGlzLmJ1ZmZlci51Ym91bmQoKSArIDE7DQogIH07CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCBCdWZmZXIucHJvdG90eXBlLCBwcm90b3R5cGVBY2Nlc3NvcnMkMSApOwoKICB2YXIgVE9fU1RSID0ge30udG9TdHJpbmc7DQogIHZhciBIQVNfT1dOID0ge30uaGFzT3duUHJvcGVydHk7DQoNCiAgLy8gI3JlZ2lvbiBVdGlsDQoNCiAgZnVuY3Rpb24gY2hyKG4pIHsNCiAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShuKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIG9yZChjKSB7DQogICAgcmV0dXJuIGMuY2hhckNvZGVBdCgwKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGhleCh4KSB7DQogICAgcmV0dXJuIE51bWJlcih4KS50b1N0cmluZygxNik7DQogIH0NCg0KICBmdW5jdGlvbiBiaW4oeCkgew0KICAgIHJldHVybiBOdW1iZXIoeCkudG9TdHJpbmcoMik7DQogIH0NCg0KICBmdW5jdGlvbiBvY3QoeCkgew0KICAgIHJldHVybiBOdW1iZXIoeCkudG9TdHJpbmcoOCk7DQogIH0NCg0KICBmdW5jdGlvbiBpbnQoeCwgYmFzZSkgew0KICAgIHJldHVybiBwYXJzZUludCh4LCBiYXNlKTsNCiAgfQ0KDQogIHZhciBGVU5DX05BTUVfUkVHID0gL2Z1bmN0aW9uICsoXHcrKS87DQoNCiAgZnVuY3Rpb24gZ2V0RnVuY05hbWUoZm4pIHsNCiAgICBpZiAoZm4ubmFtZSkgeyByZXR1cm4gZm4ubmFtZTsgfQ0KICAgIHZhciBtID0gZm4udG9TdHJpbmcoKS5tYXRjaChGVU5DX05BTUVfUkVHKTsNCiAgICByZXR1cm4gbSA/IG1bMV0gOiAnJzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGdldFRhZyh2YWx1ZSkgew0KICAgIHJldHVybiBUT19TVFIuY2FsbCh2YWx1ZSk7DQogIH0NCg0KICB2YXIgVFlQRV9SRUcgPSAvXFtvYmplY3QgKFteXF1dKylcXS87DQoNCiAgZnVuY3Rpb24gdHlwZU9mKG9iaikgew0KICAgIHZhciB0cCA9IG9iaiA9PT0gbnVsbCA/ICdudWxsJyA6IHR5cGVvZiBvYmo7DQogICAgaWYgKHRwID09ICdvYmplY3QnKQ0KICAgICAgeyB0cCA9IFRPX1NUUi5jYWxsKG9iaikNCiAgICAgICAgLm1hdGNoKFRZUEVfUkVHKVsxXQ0KICAgICAgICAudG9Mb3dlckNhc2UoKTsgfQ0KICAgIGlmICh0cCA9PSAnb2JqZWN0JyAmJiBvYmouY29uc3RydWN0b3IgJiYgdHlwZW9mIG9iai5jb25zdHJ1Y3RvciA9PSAnZnVuY3Rpb24nKQ0KICAgICAgeyB0cCA9IGdldEZ1bmNOYW1lKG9iai5jb25zdHJ1Y3RvcikudG9Mb3dlckNhc2UoKSB8fCB0cDsgfQ0KICAgIHJldHVybiB0cDsNCiAgfQ0KDQogIHZhciB0eXBlID0gdHlwZU9mOw0KDQogIGZ1bmN0aW9uIGhhcyQxKG9iaiwga2V5KSB7DQogICAgcmV0dXJuIG9iaiAhPSBudWxsICYmIEhBU19PV04uY2FsbChvYmosIGtleSk7DQogIH0NCg0KICBmdW5jdGlvbiBpc0FycmF5KG9iaikgew0KICAgIHJldHVybiBBcnJheS5pc0FycmF5KG9iaik7DQogIH0NCg0KICBmdW5jdGlvbiBpc09iamVjdChvYmopIHsNCiAgICB2YXIgdHlwZSA9IHR5cGVvZiBvYmo7DQogICAgcmV0dXJuIG9iaiAhPSBudWxsICYmICh0eXBlID09ICdvYmplY3QnIHx8IHR5cGUgPT0gJ2Z1bmN0aW9uJyk7DQogIH0NCg0KICBmdW5jdGlvbiBpc0Z1bmN0aW9uKG9iaikgew0KICAgIHJldHVybiB0eXBlb2Ygb2JqID09ICdmdW5jdGlvbic7DQogIH0NCg0KICBmdW5jdGlvbiBpc1N0cmluZyhvYmopIHsNCiAgICByZXR1cm4gdHlwZW9mIG9iaiA9PSAnc3RyaW5nJzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzTnVtYmVyKG9iaikgew0KICAgIHJldHVybiB0eXBlb2Ygb2JqID09ICdudW1iZXInOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNCb29sZWFuKG9iaikgew0KICAgIHJldHVybiBvYmogPT09IHRydWUgfHwgb2JqID09PSBmYWxzZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzRGF0ZShvYmopIHsNCiAgICByZXR1cm4gVE9fU1RSLmNhbGwob2JqKSA9PSAnW29iamVjdCBEYXRlXSc7DQogIH0NCg0KICBmdW5jdGlvbiBpc1JlZ0V4cChvYmopIHsNCiAgICByZXR1cm4gVE9fU1RSLmNhbGwob2JqKSA9PSAnW29iamVjdCBSZWdFeHBdJzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzRXJyb3Iob2JqKSB7DQogICAgcmV0dXJuIFRPX1NUUi5jYWxsKG9iaikgPT0gJ1tvYmplY3QgRXJyb3JdJzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzTWFwKG9iaikgew0KICAgIHJldHVybiBvYmogaW5zdGFuY2VvZiBNYXA7DQogIH0NCg0KICBmdW5jdGlvbiBpc1NldChvYmopIHsNCiAgICByZXR1cm4gb2JqIGluc3RhbmNlb2YgU2V0Ow0KICB9DQoNCiAgZnVuY3Rpb24gaXNXZWFrTWFwKG9iaikgew0KICAgIHJldHVybiBvYmogaW5zdGFuY2VvZiBXZWFrTWFwOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNJbnRlZ2VyKHZhbHVlKSB7DQogICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJyAmJiB2YWx1ZSAlIDEgPT0gMDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzQXJndW1lbnRzKG9iaikgew0KICAgIHJldHVybiBUT19TVFIuY2FsbChvYmopID09ICdbb2JqZWN0IEFyZ3VtZW50c10nOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNPYmplY3RMaWtlKHZhbHVlKSB7DQogICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PSAnb2JqZWN0JyAmJiB2YWx1ZSAhPSBudWxsOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNMZW5ndGgodmFsdWUpIHsNCiAgICByZXR1cm4gaXNJbnRlZ2VyKHZhbHVlKSAmJiB2YWx1ZSA+IC0xICYmIHZhbHVlIDwgOTAwNzE5OTI1NDc0MDk5MjsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzQXJyYXlMaWtlKG9iaikgew0KICAgIHJldHVybiBvYmogIT0gbnVsbCAmJiB0eXBlb2Ygb2JqICE9ICdmdW5jdGlvbicgJiYgaXNMZW5ndGgob2JqLmxlbmd0aCk7DQogIH0NCg0KICBmdW5jdGlvbiBpc0VtcHR5KG9iaikgew0KICAgIGlmIChvYmogPT0gbnVsbCkgeyByZXR1cm4gdHJ1ZTsgfQ0KICAgIGlmIChpc0FycmF5TGlrZShvYmopKSB7IHJldHVybiAhb2JqLmxlbmd0aDsgfQ0KICAgIGlmIChpc01hcChvYmopIHx8IGlzU2V0KG9iaikpIHsgcmV0dXJuICFvYmouc2l6ZTsgfQ0KICAgIGZvciAodmFyIGtleSBpbiBvYmopIHsNCiAgICAgIGlmIChIQVNfT1dOLmNhbGwob2JqLCBrZXkpKSB7IHJldHVybiBmYWxzZTsgfQ0KICAgIH0NCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzQnVmZmVyKG9iaikgew0KICAgIHJldHVybiBCdWZmZXIuaXNCdWZmZXIob2JqKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGFwcGx5KGZuLCB0aGlzQXJnLCBhcmdzKSB7DQogICAgdmFyIGFyZ0NudCA9IChhcmdzICYmIGFyZ3MubGVuZ3RoKSB8fCAwLA0KICAgICAgaGFzVGhpcyA9IHRoaXNBcmcgPT0gbnVsbDsNCiAgICBzd2l0Y2ggKGFyZ0NudCkgew0KICAgICAgY2FzZSAwOg0KICAgICAgICByZXR1cm4gaGFzVGhpcyA/IGZuKCkgOiBmbi5jYWxsKHRoaXNBcmcpOw0KICAgICAgY2FzZSAxOg0KICAgICAgICByZXR1cm4gaGFzVGhpcyA/IGZuKGFyZ3NbMF0pIDogZm4uY2FsbCh0aGlzQXJnLCBhcmdzWzBdKTsNCiAgICAgIGNhc2UgMjoNCiAgICAgICAgcmV0dXJuIGhhc1RoaXMNCiAgICAgICAgICA/IGZuKGFyZ3NbMF0sIGFyZ3NbMV0pDQogICAgICAgICAgOiBmbi5jYWxsKHRoaXNBcmcsIGFyZ3NbMF0sIGFyZ3NbMV0pOw0KICAgICAgY2FzZSAzOg0KICAgICAgICByZXR1cm4gaGFzVGhpcw0KICAgICAgICAgID8gZm4oYXJnc1swXSwgYXJnc1sxXSwgYXJnc1syXSkNCiAgICAgICAgICA6IGZuLmNhbGwodGhpc0FyZywgYXJnc1swXSwgYXJnc1sxXSwgYXJnc1syXSk7DQogICAgICBkZWZhdWx0Og0KICAgICAgICByZXR1cm4gZm4uYXBwbHkodGhpc0FyZywgYXJncyk7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gcmFuZ2Uoc3RhcnQsIGVuZCwgc3RlcCkgew0KICAgIHZhciBpID0gLTEsDQogICAgICBsZW4sDQogICAgICByZXN1bHQgPSBbXTsNCiAgICBpZiAoc3RhcnQgPT0gbnVsbCkgeyByZXR1cm4gcmVzdWx0OyB9DQogICAgaWYgKGVuZCA9PSBudWxsKSB7IChlbmQgPSBzdGFydCksIChzdGFydCA9IDApOyB9DQogICAgaWYgKHN0ZXAgPT0gbnVsbCkgeyBzdGVwID0gMTsgfQ0KICAgIHN0ZXAgPSBNYXRoLmFicyhzdGVwKTsNCiAgICBpZiAoc3RhcnQgPiBlbmQpIHsgc3RlcCA9IC1zdGVwOyB9DQogICAgbGVuID0gTWF0aC5tYXgoTWF0aC5jZWlsKChlbmQgLSBzdGFydCkgLyBzdGVwKSwgMCk7DQogICAgcmVzdWx0ID0gbmV3IEFycmF5KGxlbik7DQogICAgd2hpbGUgKCsraSA8IGxlbikgeyAocmVzdWx0W2ldID0gc3RhcnQpLCAoc3RhcnQgKz0gc3RlcCk7IH0NCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9DQoNCiAgZnVuY3Rpb24gdG9QYXRoKHB0aCkgew0KICAgIGlmIChpc1N0cmluZyhwdGgpKSB7IHB0aCA9IHB0aC5zcGxpdCgvWy5bXF1dLykuZmlsdGVyKGlkZW50aXR5KTsgfQ0KICAgIGVsc2UgaWYgKGlzTnVtYmVyKHB0aCkpIHsgcHRoID0gW3B0aF07IH0NCiAgICByZXR1cm4gaXNBcnJheShwdGgpID8gcHRoIDogW107DQogIH0NCg0KICBmdW5jdGlvbiBpZGVudGl0eSh2YWx1ZSkgew0KICAgIHJldHVybiB2YWx1ZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGl0ZXJhdGVlKHZhbHVlKSB7DQogICAgc3dpdGNoICh0eXBlT2YodmFsdWUpKSB7DQogICAgICBjYXNlICdmdW5jdGlvbic6DQogICAgICAgIHJldHVybiB2YWx1ZTsNCiAgICAgIGNhc2UgJ3N0cmluZyc6DQogICAgICBjYXNlICdudW1iZXInOg0KICAgICAgICByZXR1cm4gcHJvcGVydHkodmFsdWUpOw0KICAgICAgY2FzZSAnYXJyYXknOg0KICAgICAgICByZXR1cm4gcHJvcGVydGllcyh2YWx1ZSk7DQogICAgICBjYXNlICdvYmplY3QnOg0KICAgICAgICByZXR1cm4gbWF0Y2hlcyh2YWx1ZSk7DQogICAgICBkZWZhdWx0Og0KICAgICAgICByZXR1cm4gaWRlbnRpdHk7DQogICAgfQ0KICB9DQoNCiAgLy8gI2VuZHJlZ2lvbg0KDQogIC8vICNyZWdpb24gQ29sbGVjdGlvbg0KDQogIGZ1bmN0aW9uIGVhY2gob2JqLCBmbikgew0KICAgIHZhciBlbiwgaSwga2V5LCBsZW47DQogICAgaWYgKGlzQXJyYXlMaWtlKG9iaikpIHsNCiAgICAgIGZvciAoaSA9IDAsIGxlbiA9IG9iai5sZW5ndGg7IGkgPCBsZW47IGkrKykgew0KICAgICAgICBpZiAoZm4ob2JqW2ldLCBpLCBvYmopID09PSBmYWxzZSkgeyBicmVhazsgfQ0KICAgICAgfQ0KICAgIH0gZWxzZSBpZiAob2JqICYmICFvYmouY29uc3RydWN0b3IgJiYgJ0l0ZW0nIGluIG9iaikgew0KICAgICAgZW4gPSBuZXcgRW51bWVyYXRvcihvYmopOw0KICAgICAgZm9yIChpID0gMDsgIWVuLmF0RW5kKCk7IGVuLm1vdmVOZXh0KCksIGkrKykgew0KICAgICAgICBpZiAoZm4oZW4uaXRlbSgpLCBpLCBvYmopID09PSBmYWxzZSkgeyBicmVhazsgfQ0KICAgICAgfQ0KICAgIH0gZWxzZSBpZiAoaXNMZW5ndGgob2JqKSkgew0KICAgICAgZm9yIChpID0gMDsgaSA8IG9iajsgaSsrKSB7DQogICAgICAgIGlmIChmbihpLCBpLCBvYmopID09PSBmYWxzZSkgeyBicmVhazsgfQ0KICAgICAgfQ0KICAgIH0gZWxzZSBpZiAoaXNPYmplY3Qob2JqKSkgew0KICAgICAgZm9yIChrZXkgaW4gb2JqKSB7DQogICAgICAgIGlmIChoYXMkMShvYmosIGtleSkpIHsNCiAgICAgICAgICBpZiAoZm4ob2JqW2tleV0sIGtleSwgb2JqKSA9PT0gZmFsc2UpIHsgYnJlYWs7IH0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gb2JqOw0KICB9DQoNCiAgdmFyIGZvckVhY2ggPSBlYWNoOw0KDQogIGZ1bmN0aW9uIG1hcChvYmosIGZuKSB7DQogICAgdmFyIHJlc3VsdCA9IFtdLA0KICAgICAgaXRlID0gaXRlcmF0ZWUoZm4pOw0KICAgIGVhY2gob2JqLCBmdW5jdGlvbiAodiwgaywgbykgew0KICAgICAgcmVzdWx0LnB1c2goaXRlKHYsIGssIG8pKTsNCiAgICB9KTsNCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9DQoNCiAgdmFyIHNlbGVjdCA9IG1hcDsNCg0KICBmdW5jdGlvbiByZWR1Y2Uob2JqLCBmbiwgbWVtbykgew0KICAgIGVhY2gob2JqLCBmdW5jdGlvbih2LCBrLCBvKSB7DQogICAgICBtZW1vID0gZm4obWVtbywgdiwgaywgbyk7DQogICAgfSk7DQogICAgcmV0dXJuIG1lbW87DQogIH0NCg0KICBmdW5jdGlvbiBmaWx0ZXIob2JqLCBmbikgew0KICAgIHZhciByZXN1bHQgPSBbXSwNCiAgICAgIGl0ZSA9IGl0ZXJhdGVlKGZuKTsNCiAgICBlYWNoKG9iaiwgZnVuY3Rpb24gKHYsIGssIG8pIHsNCiAgICAgIGlmIChpdGUodiwgaywgbykpIHsgcmVzdWx0LnB1c2godik7IH0NCiAgICB9KTsNCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9DQoNCiAgdmFyIHdoZXJlID0gZmlsdGVyOw0KDQogIGZ1bmN0aW9uIHRvQXJyYXkob2JqKSB7DQogICAgdmFyIGksIGxlbiwgYXJyOw0KICAgIGlmIChpc0FycmF5KG9iaikpIHsgcmV0dXJuIG9iajsgfQ0KICAgIGlmIChpc0FycmF5TGlrZShvYmopKSB7DQogICAgICBpID0gLTE7DQogICAgICBsZW4gPSBvYmoubGVuZ3RoOw0KICAgICAgYXJyID0gQXJyYXkobGVuKTsNCiAgICAgIHdoaWxlICgrK2kgPCBsZW4pIHsgYXJyW2ldID0gb2JqW2ldOyB9DQogICAgICByZXR1cm4gYXJyOw0KICAgIH0NCiAgICBpZiAoaXNPYmplY3Qob2JqKSkgeyByZXR1cm4gbWFwKG9iaik7IH0NCiAgICByZXR1cm4gW107DQogIH0NCg0KICBmdW5jdGlvbiBiYXNlRmluZChhcnIsIGZuLCBfdGhpcykgew0KICAgIHZhciBpID0gLTEsDQogICAgICBsZW4gPSBhcnIubGVuZ3RoLA0KICAgICAgaXQ7DQogICAgaWYgKF90aGlzKSB7DQogICAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICAgIGl0ID0gYXJyW2ldOw0KICAgICAgICBpZiAoZm4uY2FsbChfdGhpcywgaXQsIGksIGFycikpIHsNCiAgICAgICAgICByZXR1cm4gW2l0LCBpXTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICAgIGl0ID0gYXJyW2ldOw0KICAgICAgICBpZiAoZm4oaXQsIGksIGFycikpIHsNCiAgICAgICAgICByZXR1cm4gW2l0LCBpXTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gW251bGwsIC0xXTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGZpbmQoYXJyLCBmbikgew0KICAgIHJldHVybiBiYXNlRmluZChhcnIsIGZuKVswXTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGZpbmRJbmRleChhcnIsIGZuKSB7DQogICAgcmV0dXJuIGJhc2VGaW5kKGFyciwgZm4pWzFdOw0KICB9DQoNCiAgZnVuY3Rpb24gZmlsbChhcnIsIHZhbCwgc3RhcnQsIGVuZCkgew0KICAgIHZhciBsZW4gPSBhcnIubGVuZ3RoOw0KICAgIGlmIChzdGFydCA9PSBudWxsKSB7IHN0YXJ0ID0gMDsgfQ0KICAgIGlmIChlbmQgPT0gbnVsbCkgeyBlbmQgPSBsZW47IH0NCiAgICBpZiAoZW5kIDwgMCkgeyBlbmQgPSBNYXRoLm1heChlbmQgKyBsZW4sIGxlbik7IH0NCiAgICB3aGlsZSAoc3RhcnQgPCBlbmQpIHsNCiAgICAgIGFycltzdGFydF0gPSB2YWw7DQogICAgICBzdGFydCsrOw0KICAgIH0NCiAgICByZXR1cm4gYXJyOw0KICB9DQoNCiAgZnVuY3Rpb24gZ3JvdXBCeShvYmosIGZuKSB7DQogICAgdmFyIHJlc3VsdCA9IHt9LA0KICAgICAgaXRlID0gaXRlcmF0ZWUoZm4pOw0KICAgIGVhY2gob2JqLCBmdW5jdGlvbih2LCBrLCBvKSB7DQogICAgICB2YXIga2V5ID0gaXRlKHYsIGssIG8pOw0KICAgICAgaGFzJDEocmVzdWx0LCBrZXkpID8gcmVzdWx0W2tleV0ucHVzaCh2KSA6IChyZXN1bHRba2V5XSA9IFt2XSk7DQogICAgfSk7DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNvdW50Qnkob2JqLCBmbikgew0KICAgIHZhciBpdGUgPSBpdGVyYXRlZShmbik7DQogICAgcmV0dXJuIHJlZHVjZSgNCiAgICAgIG9iaiwNCiAgICAgIGZ1bmN0aW9uIChyZXN1bHQsIHZhbHVlLCBrZXkpIHsNCiAgICAgICAga2V5ID0gaXRlKHZhbHVlKTsNCiAgICAgICAgaGFzJDEocmVzdWx0LCBrZXkpID8gcmVzdWx0W2tleV0rKyA6IChyZXN1bHRba2V5XSA9IDEpOw0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgfSwNCiAgICAgIHt9DQogICAgKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNpemUob2JqKSB7DQogICAgcmV0dXJuIGlzQXJyYXlMaWtlKG9iaikgPyBvYmoubGVuZ3RoIDogT2JqZWN0LmtleXMob2JqKS5sZW5ndGg7DQogIH0NCg0KICB2YXIgbGVuID0gc2l6ZTsNCg0KICAvLyAjZW5kcmVnaW9uDQoNCiAgLy8gI3JlZ2lvbiBBcnJheQ0KDQogIGZ1bmN0aW9uIHVuaXFCeShhcnIsIGZuKSB7DQogICAgdmFyIGl0ZSA9IGl0ZXJhdGVlKGZuKSwNCiAgICAgIHJlc3VsdCA9IFtdLA0KICAgICAgbWVtbyA9IG5ldyBTZXQoKSwNCiAgICAgIGkgPSAtMSwNCiAgICAgIGxlbiA9IGFyci5sZW5ndGgsDQogICAgICBpdGVtLA0KICAgICAgY29tcHV0ZWQ7DQogICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgaXRlbSA9IGFycltpXTsNCiAgICAgIGNvbXB1dGVkID0gaXRlKGl0ZW0pOw0KICAgICAgaWYgKCFtZW1vLmhhcyhjb21wdXRlZCkpIHsNCiAgICAgICAgcmVzdWx0LnB1c2goaXRlbSk7DQogICAgICAgIG1lbW8uYWRkKGNvbXB1dGVkKTsNCiAgICAgIH0NCiAgICB9DQogICAgbWVtby5jbGVhcigpOw0KICAgIHJldHVybiByZXN1bHQ7DQogIH0NCg0KICBmdW5jdGlvbiB1bmlxKGFycikgew0KICAgIHJldHVybiB1bmlxQnkoYXJyLCBpZGVudGl0eSk7DQogIH0NCg0KICB2YXIgZGlzdGluY3QgPSB1bmlxOw0KDQogIHZhciBkaXN0aW5jdEJ5ID0gdW5pcUJ5Ow0KDQogIGZ1bmN0aW9uIGNodW5rKGFyciwgbikgew0KICAgIGlmIChuID09IG51bGwgfHwgbiA8IDEpIHsgcmV0dXJuIFtdOyB9DQogICAgdmFyIHJlc3VsdCA9IFtdLA0KICAgICAgdG1wID0gQXJyYXkobiksDQogICAgICBpID0gLTEsDQogICAgICBsZW4gPSBhcnIubGVuZ3RoLA0KICAgICAgb2ZmID0gMDsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICB0bXBbb2ZmKytdID0gYXJyW2ldOw0KICAgICAgaWYgKG9mZiA9PSAxKSB7DQogICAgICAgIHJlc3VsdC5wdXNoKHRtcCk7DQogICAgICB9IGVsc2UgaWYgKG9mZiA9PSBuKSB7DQogICAgICAgIG9mZiA9IDA7DQogICAgICAgIHRtcCA9IEFycmF5KG4pOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9DQoNCiAgZnVuY3Rpb24gY29uY2F0KCkgewogICAgdmFyIGFyZ3VtZW50cyQxID0gYXJndW1lbnRzOwoNCiAgICB2YXIgaSA9IC0xLA0KICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aCwNCiAgICAgIHJlc3VsdCA9IFtdLA0KICAgICAgYXJyLA0KICAgICAgaWksDQogICAgICBsZW4yOw0KICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgIGFyciA9IGFyZ3VtZW50cyQxW2ldOw0KICAgICAgaWkgPSAtMTsNCiAgICAgIGxlbjIgPSBhcnIgJiYgYXJyLmxlbmd0aDsNCiAgICAgIGlmIChsZW4yID09IG51bGwpIHsNCiAgICAgICAgcmVzdWx0LnB1c2goYXJyKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHdoaWxlICgrK2lpIDwgbGVuMikgeyByZXN1bHQucHVzaChhcnJbaWldKTsgfQ0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9DQoNCiAgZnVuY3Rpb24gc2xpY2UoYXJyLCBzdGFydCwgZW5kKSB7DQogICAgdmFyIGkgPSAtMSwNCiAgICAgIGxlbiA9IChhcnIgJiYgYXJyLmxlbmd0aCkgfHwgMCwNCiAgICAgIHJlc3VsdDsNCiAgICBpZiAoIWxlbikgeyByZXR1cm4gW107IH0NCiAgICBpZiAoc3RhcnQgPT0gbnVsbCkgeyBzdGFydCA9IDA7IH0NCiAgICBpZiAoZW5kID09IG51bGwpIHsgZW5kID0gbGVuOyB9DQogICAgaWYgKHN0YXJ0IDwgMCkgeyBzdGFydCA9IC1zdGFydCA+IGxlbiA/IDAgOiBsZW4gKyBzdGFydDsgfQ0KICAgIGlmIChlbmQgPCAwKSB7IGVuZCArPSBsZW47IH0NCiAgICBlbHNlIGlmIChlbmQgPiBsZW4pIHsgZW5kID0gbGVuOyB9DQogICAgbGVuID0gc3RhcnQgPiBlbmQgPyAwIDogZW5kIC0gc3RhcnQ7DQogICAgcmVzdWx0ID0gbmV3IEFycmF5KGxlbik7DQogICAgd2hpbGUgKCsraSA8IGxlbikgeyByZXN1bHRbaV0gPSBhcnJbaSArIHN0YXJ0XTsgfQ0KICAgIHJldHVybiByZXN1bHQ7DQogIH0NCg0KICAvLyBkcm9wKFsxLCAyLCAzLCA0LCA1XSwgMikgPT4gWzMsIDQsIDVdDQogIGZ1bmN0aW9uIGRyb3AoYXJyLCBuKSB7DQogICAgcmV0dXJuIHNsaWNlKGFyciwgbiB8fCAxKTsNCiAgfQ0KDQogIC8vIHRhaWwoWzEsIDIsIDMsIDRdKSA9PiBbMiwgMywgNF0NCiAgZnVuY3Rpb24gdGFpbChhcnIpIHsNCiAgICByZXR1cm4gZHJvcChhcnIsIDEpOw0KICB9DQoNCiAgLy8gaW5pdGFpbChbMSwgMiwgMywgNF0pID0+IFsxLCAyLCAzXQ0KICBmdW5jdGlvbiBpbml0aWFsKGFycikgew0KICAgIHJldHVybiBzbGljZShhcnIsIDAsIE1hdGgubWF4KDAsIGFyci5sZW5ndGggLSAxKSk7DQogIH0NCg0KICAvLyB0YWtlKFsxLCAyLCAzLCA0LCA1XSwgMikgPT4gWzEsIDJdDQogIGZ1bmN0aW9uIHRha2UoYXJyLCBuKSB7DQogICAgcmV0dXJuIHNsaWNlKGFyciwgMCwgbik7DQogIH0NCg0KICBmdW5jdGlvbiB0YWtlUmlnaHQoYXJyLCBuKSB7DQogICAgcmV0dXJuIHNsaWNlKGFyciwgLW4pOw0KICB9DQoNCiAgZnVuY3Rpb24gY29udGFpbnMob2JqLCB2YWwsIHBvcykgew0KICAgIHJldHVybiBvYmouaW5kZXhPZih2YWwsIHBvcyB8fCAwKSAhPSAtMTsNCiAgfQ0KDQogIHZhciBpbmNsdWRlID0gY29udGFpbnM7DQoNCiAgdmFyIGluY2x1ZGVzID0gY29udGFpbnM7DQoNCiAgZnVuY3Rpb24gZmlyc3QoYXJyKSB7DQogICAgcmV0dXJuIGFyciAmJiBhcnJbMF07DQogIH0NCg0KICB2YXIgaGVhZCA9IGZpcnN0Ow0KDQogIGZ1bmN0aW9uIGxhc3QoYXJyKSB7DQogICAgcmV0dXJuIChhcnIgJiYgYXJyLmxlbmd0aCA+IDAgJiYgYXJyW2Fyci5sZW5ndGggLSAxXSkgfHwgdm9pZCAwOw0KICB9DQoNCiAgZnVuY3Rpb24gbnRoKGFyciwgbikgew0KICAgIHJldHVybiBhcnIgJiYgKG4gPCAwID8gYXJyW2Fyci5sZW5ndGggKyBuXSA6IGFycltuXSk7DQogIH0NCg0KICBmdW5jdGlvbiBwdWxsQWxsKGFyciwgdmFsdWVzKSB7DQogICAgaWYgKCFpc0FycmF5KHZhbHVlcykpIHsgcmV0dXJuIGFycjsgfQ0KICAgIHZhciBpID0gYXJyLmxlbmd0aDsNCiAgICB3aGlsZSAoaS0tKSB7DQogICAgICBpZiAodmFsdWVzLmluY2x1ZGVzKGFycltpXSkpIHsgYXJyLnNwbGljZShpLCAxKTsgfQ0KICAgIH0NCiAgICByZXR1cm4gYXJyOw0KICB9DQoNCiAgZnVuY3Rpb24gcHVsbChhcnIpIHsNCiAgICByZXR1cm4gcHVsbEFsbChhcnIsIHRhaWwoYXJndW1lbnRzKSk7DQogIH0NCg0KICBmdW5jdGlvbiByZW1vdmUoYXJyLCBmbikgew0KICAgIHZhciBpID0gYXJyLmxlbmd0aCwNCiAgICAgIGl0ZSA9IGl0ZXJhdGVlKGZuKTsNCiAgICB3aGlsZSAoaS0tKSB7DQogICAgICBpZiAoaXRlKGFycltpXSwgaSwgYXJyKSkgeyBhcnIuc3BsaWNlKGksIDEpOyB9DQogICAgfQ0KICAgIHJldHVybiBhcnI7DQogIH0NCg0KICBmdW5jdGlvbiBkaWZmZXJlbmNlKGFyciwgdmFsdWVzKSB7DQogICAgcmV0dXJuIGZpbHRlcihhcnIsIGZ1bmN0aW9uIChpdCkgeyByZXR1cm4gIWluY2x1ZGVzKHZhbHVlcywgaXQpOyB9KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHVuemlwKGFycikgew0KICAgIGlmIChhcnIgPT0gbnVsbCB8fCAhYXJyLmxlbmd0aCkgew0KICAgICAgcmV0dXJuIFtdOw0KICAgIH0NCiAgICB2YXIgbGVuID0gMDsNCiAgICBhcnIgPSBmaWx0ZXIoYXJyLCBmdW5jdGlvbiAoaXQpIHsNCiAgICAgIGlmIChoYXMkMShpdCwgJ2xlbmd0aCcpKSB7DQogICAgICAgIGxlbiA9IE1hdGgubWF4KGl0Lmxlbmd0aCwgbGVuKTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9DQogICAgfSk7DQogICAgdmFyIGkgPSAtMSwNCiAgICAgIHJlc3VsdCA9IEFycmF5KGxlbik7DQogICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgcmVzdWx0W2ldID0gbWFwKGFyciwgaSk7DQogICAgfQ0KICAgIHJldHVybiByZXN1bHQ7DQogIH0NCg0KICBmdW5jdGlvbiB6aXAoKSB7DQogICAgcmV0dXJuIHVuemlwKGFyZ3VtZW50cyk7DQogIH0NCg0KICBmdW5jdGlvbiBmbGF0dGVuKGFycikgew0KICAgIHJldHVybiByZWR1Y2UoDQogICAgICBhcnIsDQogICAgICBmdW5jdGlvbiAocnN0LCBpdCkgew0KICAgICAgICBpZiAoaXNBcnJheShpdCkpIHsgcnN0ID0gcnN0LmNvbmNhdChpdCk7IH0NCiAgICAgICAgZWxzZSB7IHJzdC5wdXNoKGl0KTsgfQ0KICAgICAgICByZXR1cm4gcnN0Ow0KICAgICAgfSwNCiAgICAgIFtdDQogICAgKTsNCiAgfQ0KDQogIC8vICNlbmRyZWdpb24NCg0KICAvLyAjcmVnaW9uIE9iamVjdA0KDQogIGZ1bmN0aW9uIGtleXMob2JqKSB7DQogICAgcmV0dXJuIG9iaiA/IE9iamVjdC5rZXlzKG9iaikgOiBbXTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHZhbHVlcyhvYmopIHsNCiAgICByZXR1cm4gb2JqID8ga2V5cyhvYmopLm1hcChwcm9wZXJ0eU9mKG9iaikpIDogW107DQogIH0NCg0KICBmdW5jdGlvbiBrZXlzSW4ob2JqKSB7DQogICAgdmFyIGFyciA9IFtdOw0KICAgIGlmIChvYmopIHsNCiAgICAgIGZvciAodmFyIGsgaW4gb2JqKSB7DQogICAgICAgIGFyci5wdXNoKGspOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gYXJyOw0KICB9DQoNCiAgZnVuY3Rpb24gdmFsdWVzSW4ob2JqKSB7DQogICAgcmV0dXJuIG9iaiA/IGtleXNJbihvYmopLm1hcChwcm9wZXJ0eU9mKG9iaikpIDogW107DQogIH0NCg0KICAvLyB6aXBPYmplY3QoWydhJywgJ2InLCAnYyddLCBbMSwgMiwgM10pDQogIC8vID0+IHsgYTogMSwgYjogMiwgYzogM30NCiAgZnVuY3Rpb24gemlwT2JqZWN0KHByb3BzLCB2YWx1ZXMpIHsNCiAgICB2YXIgaSA9IC0xLA0KICAgICAgbGVuID0gcHJvcHMubGVuZ3RoLA0KICAgICAgdkxlbiA9IHZhbHVlcy5sZW5ndGgsDQogICAgICByZXN1bHQgPSB7fTsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICByZXN1bHRbcHJvcHNbaV1dID0gaSA8IHZMZW4gPyB2YWx1ZXNbaV0gOiB2b2lkIDA7DQogICAgfQ0KICAgIHJldHVybiByZXN1bHQ7DQogIH0NCg0KICAvLyBvYmplY3QoWyBbJ2EnLCAxXSwgWydiJywgMl0sIFsnYycsIDNdIF0pDQogIC8vID0+IHsgYTogMSwgYjogMiwgYzogM30NCiAgZnVuY3Rpb24gZnJvbVBhaXJzKHBhaXJzKSB7DQogICAgdmFyIHJlc3VsdCA9IHt9LA0KICAgICAgaSA9IC0xLA0KICAgICAgbGVuID0gcGFpcnMubGVuZ3RoOw0KICAgIHdoaWxlICgrK2kgPCBsZW4pIHsgcmVzdWx0W3BhaXJzW2ldWzBdXSA9IHBhaXJzW2ldWzFdOyB9DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfQ0KDQogIGZ1bmN0aW9uIG9iamVjdChhcnIxLCBhcnIyKSB7DQogICAgcmV0dXJuIGFycjIgPyB6aXBPYmplY3QoYXJyMSwgYXJyMikgOiBmcm9tUGFpcnMoYXJyMSk7DQogIH0NCg0KICBmdW5jdGlvbiBnZXQob2JqLCBwdGgsIGRlZlZhbCkgew0KICAgIHZhciBpID0gLTEsDQogICAgICBfcHRoID0gdG9QYXRoKHB0aCksDQogICAgICBsZW4gPSBfcHRoLmxlbmd0aDsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICBpZiAob2JqID09IG51bGwpIHsgcmV0dXJuIGRlZlZhbDsgfQ0KICAgICAgb2JqID0gb2JqW19wdGhbaV1dOw0KICAgIH0NCiAgICByZXR1cm4gb2JqOw0KICB9DQoNCiAgZnVuY3Rpb24gYXQob2JqLCBwdGhzKSB7DQogICAgcmV0dXJuIHB0aHMubWFwKGZ1bmN0aW9uIChwdGgpIHsgcmV0dXJuIGdldChvYmosIHB0aCk7IH0pOw0KICB9DQoNCiAgZnVuY3Rpb24gcHJvcGVydHlPZihvYmopIHsNCiAgICByZXR1cm4gZnVuY3Rpb24gKHB0aCkgeyByZXR1cm4gZ2V0KG9iaiwgcHRoKTsgfTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHByb3BlcnR5KHB0aCkgew0KICAgIHJldHVybiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBnZXQob2JqLCBwdGgpOyB9Ow0KICB9DQoNCiAgZnVuY3Rpb24gcHJvcGVydGllcyhwdGhzKSB7DQogICAgcmV0dXJuIGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIGF0KG9iaiwgcHRocyk7IH07DQogIH0NCg0KICBmdW5jdGlvbiBzZXQob2JqLCBwdGgsIHZhbHVlKSB7DQogICAgdmFyIF9wdGggPSB0b1BhdGgocHRoKSwNCiAgICAgIGtleSA9IGxhc3QoX3B0aCksDQogICAgICBfb2JqID0gZ2V0KG9iaiwgaW5pdGlhbChfcHRoKSk7DQogICAgaWYgKF9vYmogIT0gbnVsbCkgew0KICAgICAgX29ialtrZXldID0gdmFsdWU7DQogICAgfQ0KICAgIHJldHVybiBvYmo7DQogIH0NCg0KICBmdW5jdGlvbiB1bnNldChvYmosIHB0aCkgew0KICAgIHZhciBfcHRoID0gdG9QYXRoKHB0aCksDQogICAgICBrZXkgPSBsYXN0KF9wdGgpLA0KICAgICAgX29iaiA9IGdldChvYmosIGluaXRpYWwoX3B0aCkpOw0KICAgIGlmIChfb2JqICE9IG51bGwgJiYgaGFzJDEoX29iaiwga2V5KSkgew0KICAgICAgZGVsZXRlIF9vYmpba2V5XTsNCiAgICB9DQogICAgcmV0dXJuIG9iajsNCiAgfQ0KDQogIGZ1bmN0aW9uIHVwZGF0ZShvYmosIHB0aCwgZm4pIHsNCiAgICB2YXIgX3B0aCA9IHRvUGF0aChwdGgpLA0KICAgICAga2V5ID0gbGFzdChfcHRoKSwNCiAgICAgIF9vYmogPSBnZXQob2JqLCBpbml0aWFsKF9wdGgpKTsNCiAgICBpZiAoX29iaiAhPSBudWxsKSB7DQogICAgICBfb2JqW2tleV0gPSBmbihfb2JqW2tleV0pOw0KICAgIH0NCiAgICByZXR1cm4gb2JqOw0KICB9DQoNCiAgZnVuY3Rpb24gcGljayhvYmosIHB0aHMpIHsNCiAgICB2YXIgX3B0aHMgPSBwdGhzLm1hcChmdW5jdGlvbiAoaXQpIHsgcmV0dXJuIHRvUGF0aChpdCk7IH0pOw0KICAgIHJldHVybiBfcHRocy5yZWR1Y2UoZnVuY3Rpb24gKHJlc3VsdCwgcHRoKSB7DQogICAgICB2YXIgdmFsdWUgPSBnZXQob2JqLCBwdGgpOw0KICAgICAgaWYgKHZhbHVlKSB7IHJlc3VsdFtsYXN0KHB0aCldID0gdmFsdWU7IH0NCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfSwge30pOw0KICB9DQoNCiAgLy8gaXNNYXRjaCh7YTogMSwgYjogMn0sIHsgYjogMiB9KSA9PiB0cnVlDQogIC8vIGlzTWF0Y2goe2E6IDEsIGI6IDJ9LCB7IGI6IDEgfSkgPT4gZmFsc2UNCiAgZnVuY3Rpb24gaXNNYXRjaChvYmosIGF0dHJzKSB7DQogICAgaWYgKG9iaiA9PSBudWxsIHx8IGF0dHJzID09IG51bGwpIHsgcmV0dXJuIGZhbHNlOyB9DQogICAgZm9yICh2YXIga2V5IGluIGF0dHJzKSB7DQogICAgICBpZiAoIWhhcyQxKGF0dHJzLCBrZXkpKSB7IGNvbnRpbnVlOyB9DQogICAgICBpZiAoIWhhcyQxKG9iaiwga2V5KSB8fCBhdHRyc1trZXldICE9PSBvYmpba2V5XSkgeyByZXR1cm4gZmFsc2U7IH0NCiAgICB9DQogICAgcmV0dXJuIHRydWU7DQogIH0NCg0KICAvLyBtYXRjaGVzKHtiOiAyfSkoeyBhOiAxLCBiOiAyfSkgPT4gdHJ1ZQ0KICBmdW5jdGlvbiBtYXRjaGVzKGF0dHJzKSB7DQogICAgcmV0dXJuIGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIGlzTWF0Y2gob2JqLCBhdHRycyk7IH07DQogIH0NCg0KICB2YXIgbWF0Y2hlciA9IG1hdGNoZXM7DQoNCiAgZnVuY3Rpb24gYXNzaWduKG9iaikgew0KICAgIHZhciBrZXksDQogICAgICBzcmMsDQogICAgICBpID0gMCwNCiAgICAgIGFyZ3MgPSBhcmd1bWVudHMsDQogICAgICBsZW4gPSBhcmdzLmxlbmd0aDsNCiAgICBvYmogfHwgKG9iaiA9IHt9KTsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICBzcmMgPSBhcmdzW2ldOw0KICAgICAgZm9yIChrZXkgaW4gc3JjKSB7DQogICAgICAgIGlmIChoYXMkMShzcmMsIGtleSkpIHsNCiAgICAgICAgICBvYmpba2V5XSA9IHNyY1trZXldOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiBvYmo7DQogIH0NCg0KICBmdW5jdGlvbiBhc3NpZ25JbihvYmopIHsNCiAgICB2YXIga2V5LA0KICAgICAgc3JjLA0KICAgICAgaSA9IDAsDQogICAgICBhcmdzID0gYXJndW1lbnRzLA0KICAgICAgbGVuID0gYXJncy5sZW5ndGg7DQogICAgb2JqIHx8IChvYmogPSB7fSk7DQogICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgc3JjID0gYXJnc1tpXTsNCiAgICAgIGZvciAoa2V5IGluIHNyYykgew0KICAgICAgICBpZiAoaGFzJDEoc3JjLCBrZXkpKSB7DQogICAgICAgICAgb2JqW2tleV0gPSBzcmNba2V5XTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gb2JqOw0KICB9DQoNCiAgdmFyIGV4dGVuZCA9IGFzc2lnbkluOw0KDQogIGZ1bmN0aW9uIGRlZmF1bHRzKG9iaikgew0KICAgIHZhciBrZXksDQogICAgICBzcmMsDQogICAgICBpID0gMCwNCiAgICAgIGFyZ3MgPSBhcmd1bWVudHMsDQogICAgICBsZW4gPSBhcmdzLmxlbmd0aDsNCiAgICBvYmogfHwgKG9iaiA9IHt9KTsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICBzcmMgPSBhcmdzW2ldOw0KICAgICAgZm9yIChrZXkgaW4gc3JjKSB7DQogICAgICAgIGlmICghaGFzJDEob2JqLCBrZXkpKSB7DQogICAgICAgICAgb2JqW2tleV0gPSBzcmNba2V5XTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gb2JqOw0KICB9DQoNCiAgZnVuY3Rpb24gZW50cmllcyhvYmopIHsNCiAgICByZXR1cm4gb2JqID8gbWFwKG9iaiwgZnVuY3Rpb24gKHYsIGspIHsgcmV0dXJuIFtrLCB2XTsgfSkgOiBbXTsNCiAgfQ0KDQogIHZhciB0b1BhaXJzID0gZW50cmllczsNCg0KICAvLyAjZW5kcmVnaW9uDQoNCiAgLy8gI3JlZ2lvbiBGdW5jdGlvbg0KDQogIGZ1bmN0aW9uIG1lbW9pemUoZm4sIHJlc29sdmVyKSB7DQogICAgdmFyIG1lbW9pemVkID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07Cg0KICAgICAgdmFyIGNhY2hlID0gbWVtb2l6ZWQuY2FjaGUsDQogICAgICAgIGFkZHIgPSByZXNvbHZlciA/IGFwcGx5KHJlc29sdmVyLCB0aGlzLCBhcmdzKSA6IGFyZ3NbMF07DQogICAgICBpZiAoIWNhY2hlLmhhcyhhZGRyKSkgew0KICAgICAgICBjYWNoZS5zZXQoYWRkciwgYXBwbHkoZm4sIHRoaXMsIGFyZ3MpKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBjYWNoZS5nZXQoYWRkcik7DQogICAgfTsNCiAgICBtZW1vaXplZC5jYWNoZSA9IG5ldyBNYXAoKTsNCiAgICByZXR1cm4gbWVtb2l6ZWQ7DQogIH0NCg0KICBmdW5jdGlvbiBwYXJ0aWFsKGZuKSB7CiAgICB2YXIgYm91bmRBcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGggLSAxOwogICAgd2hpbGUgKCBsZW4tLSA+IDAgKSBib3VuZEFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gKyAxIF07Cg0KICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgdmFyIF9hcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgIHdoaWxlICggbGVuLS0gKSBfYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdOwoNCiAgICAgIHZhciBpID0gMDsNCiAgICAgIHZhciBhcmdzID0gYm91bmRBcmdzLm1hcChmdW5jdGlvbiAoYXJnKSB7IHJldHVybiAoYXJnID09PSBwYXJ0aWFsLl8gPyBfYXJnc1tpKytdIDogYXJnKTsgfSk7DQogICAgICBhcmdzID0gYXJncy5jb25jYXQoX2FyZ3Muc2xpY2UoaSkpOw0KICAgICAgcmV0dXJuIGFwcGx5KGZuLCB0aGlzLCBhcmdzKTsNCiAgICB9Ow0KICB9DQogIHBhcnRpYWwuXyA9IHt9Ow0KDQogIGZ1bmN0aW9uIGN1cnJ5KGZuKSB7DQogICAgdmFyIGFyZ3NMZW4gPSBmbi5sZW5ndGgsDQogICAgICBhcmdzID0gW107DQogICAgdmFyIGN1cnJpZWQgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIF9hcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgIHdoaWxlICggbGVuLS0gKSBfYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdOwoNCiAgICAgIGFyZ3MgPSBbYXJncyBdLmNvbmNhdCggX2FyZ3MpOw0KICAgICAgaWYgKGFyZ3NMZW4gPT09IGFyZ3MubGVuZ3RoKSB7IHJldHVybiBhcHBseShmbiwgdGhpcywgYXJncyk7IH0NCiAgICAgIGVsc2UgeyByZXR1cm4gY3VycmllZDsgfQ0KICAgIH07DQogICAgcmV0dXJuIGFyZ3NMZW4gPCAyID8gZm4gOiBjdXJyaWVkOw0KICB9DQoNCiAgZnVuY3Rpb24gYXJ5KGZuLCBuKSB7DQogICAgcmV0dXJuIG4gPT0gbnVsbA0KICAgICAgPyBmbg0KICAgICAgOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgICAgICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdOwoNCiAgICAgICAgICByZXR1cm4gYXBwbHkoZm4sIHRoaXMsIGFyZ3Muc2xpY2UoMCwgbikpOw0KICAgICAgICB9Ow0KICB9DQoNCiAgZnVuY3Rpb24gd3JhcChmbiwgd3JhcHBlcikgew0KICAgIHdyYXBwZXIgfHwgKHdyYXBwZXIgPSBpZGVudGl0eSk7DQogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdOwoNCiAgICAgIHJldHVybiBhcHBseSh3cmFwcGVyLCB0aGlzLCBbZm4gXS5jb25jYXQoIGFyZ3MpKTsNCiAgICB9Ow0KICB9DQoNCiAgLy8gI2VuZHJlZ2lvbg0KDQogIC8vICNyZWdpb24gTWF0aA0KDQogIGZ1bmN0aW9uIHJhbmRvbShsb3dlciwgdXBwZXIpIHsNCiAgICBpZiAobG93ZXIgPT0gbnVsbCkgeyByZXR1cm4gTWF0aC5yYW5kb20oKTsgfQ0KICAgIGlmICh1cHBlciA9PSBudWxsKSB7DQogICAgICB1cHBlciA9IGxvd2VyOw0KICAgICAgbG93ZXIgPSAwOw0KICAgIH0NCiAgICBpZiAobG93ZXIgPiB1cHBlcikgew0KICAgICAgdmFyIHRlbXAgPSBsb3dlcjsNCiAgICAgIGxvd2VyID0gdXBwZXI7DQogICAgICB1cHBlciA9IHRlbXA7DQogICAgfQ0KICAgIHJldHVybiBsb3dlciArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICh1cHBlciAtIGxvd2VyICsgMSkpOw0KICB9DQoNCiAgZnVuY3Rpb24gc3VtKCkgew0KICAgIHZhciBhcnIgPSBhcmd1bWVudHMubGVuZ3RoID09PSAxID8gYXJndW1lbnRzWzBdIDogYXJndW1lbnRzOw0KICAgIHJldHVybiByZWR1Y2UoYXJyLCBmdW5jdGlvbiAocmVzdWx0LCBpdCkgeyByZXR1cm4gKHJlc3VsdCArPSBpdCk7IH0sIDApOw0KICB9DQoNCiAgZnVuY3Rpb24gYXZlcmFnZSgpIHsNCiAgICB2YXIgYXJyID0gYXJndW1lbnRzLmxlbmd0aCA9PT0gMSA/IGFyZ3VtZW50c1swXSA6IGFyZ3VtZW50czsNCiAgICB2YXIgbGVuID0gYXJyLmxlbmd0aDsNCiAgICByZXR1cm4gbGVuID09PSAwID8gMCA6IHN1bShhcnIpIC8gbGVuOw0KICB9DQoNCiAgdmFyIGF2ZyA9IGF2ZXJhZ2U7DQoNCiAgZnVuY3Rpb24gZGVjaW1hbEFkanVzdChtZXRob2ROYW1lLCBudW1iZXIsIHByZWNpc2lvbikgew0KICAgIGlmIChwcmVjaXNpb24pIHsNCiAgICAgIHZhciB2YWx1ZSA9IE1hdGhbbWV0aG9kTmFtZV0obnVtYmVyICsgJ2UnICsgcHJlY2lzaW9uKTsNCiAgICAgIHJldHVybiArKHZhbHVlICsgJ2UnICsgLXByZWNpc2lvbik7DQogICAgfQ0KICAgIHJldHVybiBNYXRoW21ldGhvZE5hbWVdKG51bWJlcik7DQogIH0NCg0KICBmdW5jdGlvbiByb3VuZChudW0sIHByZWNpc2lvbikgew0KICAgIHJldHVybiBkZWNpbWFsQWRqdXN0KCdyb3VuZCcsIG51bSwgcHJlY2lzaW9uKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGZsb29yKG51bSwgcHJlY2lzaW9uKSB7DQogICAgcmV0dXJuIGRlY2ltYWxBZGp1c3QoJ2Zsb29yJywgbnVtLCBwcmVjaXNpb24pOw0KICB9DQoNCiAgZnVuY3Rpb24gY2VpbChudW0sIHByZWNpc2lvbikgew0KICAgIHJldHVybiBkZWNpbWFsQWRqdXN0KCdjZWlsJywgbnVtLCBwcmVjaXNpb24pOw0KICB9DQoNCiAgZnVuY3Rpb24gcmFkaWFucyh4KSB7DQogICAgcmV0dXJuIChNYXRoLlBJIC8gMTgwKSAqIHg7DQogIH0NCg0KICAvLyAjZW5kcmVnaW9uDQoNCiAgLy8gI3JlZ2lvbiBTdHJpbmcNCg0KICBmdW5jdGlvbiB0b1VwcGVyKHgpIHsNCiAgICByZXR1cm4geC50b1VwcGVyQ2FzZSgpOw0KICB9DQoNCiAgZnVuY3Rpb24gdG9Mb3dlcih4KSB7DQogICAgcmV0dXJuIHgudG9Mb3dlckNhc2UoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHRyaW0oeCkgew0KICAgIHJldHVybiB4LnRyaW0oKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlcGVhdChzdHIsIG4pIHsNCiAgICB2YXIgcnN0ID0gJyc7DQogICAgaWYgKCFpc1N0cmluZyhzdHIpKSB7IHN0ciA9IFN0cmluZyhzdHIpOyB9DQogICAgaWYgKG4gPCAxIHx8ICFpc0Zpbml0ZShuKSkgeyByZXR1cm4gcnN0OyB9DQogICAgZG8gew0KICAgICAgaWYgKG4gJSAyKSB7IHJzdCArPSBzdHI7IH0NCiAgICAgIG4gPSBNYXRoLmZsb29yKG4gLyAyKTsNCiAgICAgIGlmIChuKSB7IHN0ciArPSBzdHI7IH0NCiAgICB9IHdoaWxlIChuKTsNCiAgICByZXR1cm4gcnN0Ow0KICB9DQoNCiAgZnVuY3Rpb24gY3JlYXRlUGFkZGluZyhsZW4sIGNocnMpIHsNCiAgICBjaHJzIHx8IChjaHJzID0gJyAnKTsNCiAgICB2YXIgcGFkID0gY2hycy5yZXBlYXQoTWF0aC5jZWlsKGxlbiAvIGNocnMubGVuZ3RoKSk7DQogICAgcmV0dXJuIHBhZC5sZW5ndGggPiBsZW4gPyBwYWQuc2xpY2UoMCwgbGVuKSA6IHBhZDsNCiAgfQ0KDQogIGZ1bmN0aW9uIHBhZFN0YXJ0KHN0ciwgbGVuLCBjaHJzKSB7DQogICAgaWYgKCFpc1N0cmluZyhzdHIpKSB7IHN0ciA9IFN0cmluZyhzdHIpOyB9DQogICAgdmFyIHN0ckxlbiA9IHN0ci5sZW5ndGg7DQogICAgaWYgKGxlbiA9PSBudWxsIHx8IGxlbiA8PSBzdHJMZW4pIHsgcmV0dXJuIHN0cjsgfQ0KICAgIHJldHVybiBjcmVhdGVQYWRkaW5nKGxlbiAtIHN0ckxlbiwgY2hycykgKyBzdHI7DQogIH0NCg0KICBmdW5jdGlvbiBwYWRFbmQoc3RyLCBsZW4sIGNocnMpIHsNCiAgICBpZiAoIWlzU3RyaW5nKHN0cikpIHsgc3RyID0gU3RyaW5nKHN0cik7IH0NCiAgICB2YXIgc3RyTGVuID0gc3RyLmxlbmd0aDsNCiAgICBpZiAobGVuID09IG51bGwgfHwgbGVuIDw9IHN0ckxlbikgeyByZXR1cm4gc3RyOyB9DQogICAgcmV0dXJuIHN0ciArIGNyZWF0ZVBhZGRpbmcobGVuIC0gc3RyTGVuLCBjaHJzKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHN0YXJ0c1dpdGgoc3RyLCB0YXJnZXQsIHBvcykgew0KICAgIHJldHVybiBzdHIuc3Vic3RyKCFwb3MgfHwgcG9zIDwgMCA/IDAgOiArcG9zLCB0YXJnZXQubGVuZ3RoKSA9PSB0YXJnZXQ7DQogIH0NCg0KICBmdW5jdGlvbiBlbmRzV2l0aChzdHIsIHRhcmdldCwgdGhpc19sZW4pIHsNCiAgICBpZiAodGhpc19sZW4gPT0gbnVsbCB8fCB0aGlzX2xlbiA+IHN0ci5sZW5ndGgpIHsgdGhpc19sZW4gPSBzdHIubGVuZ3RoOyB9DQogICAgcmV0dXJuIHN0ci5zdWJzdHJpbmcodGhpc19sZW4gLSB0YXJnZXQubGVuZ3RoLCB0aGlzX2xlbikgPT0gdGFyZ2V0Ow0KICB9DQoNCiAgZnVuY3Rpb24gZWFjaE1hdGNoKHN0ciwgcGF0dGVybiwgZm4pIHsNCiAgICBpZiAoIWlzU3RyaW5nKHN0cikgfHwgIWlzUmVnRXhwKHBhdHRlcm4pKSB7DQogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdpbnZhbGlkIGFyZ3VtZW50cycpOw0KICAgIH0NCiAgICBpZiAoIXBhdHRlcm4uZ2xvYmFsKSB7DQogICAgICBwYXR0ZXJuID0gUmVnRXhwKHBhdHRlcm4uc291cmNlLCAnZycpOw0KICAgIH0NCiAgICB2YXIgbWF0Y2g7DQogICAgZm9yICg7Oykgew0KICAgICAgbWF0Y2ggPSBwYXR0ZXJuLmV4ZWMoc3RyKTsNCiAgICAgIGlmICghbWF0Y2gpIHsgYnJlYWs7IH0NCiAgICAgIGlmIChhcHBseShmbiwgbnVsbCwgbWF0Y2gpID09PSBmYWxzZSkgeyBicmVhazsgfQ0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIGZpbmRBbGwoc3RyLCBwYXR0ZXJuKSB7CiAgICB2YXIgYXJndW1lbnRzJDEgPSBhcmd1bWVudHM7Cg0KICAgIHZhciByc3QgPSBbXTsNCiAgICBlYWNoTWF0Y2goc3RyLCBwYXR0ZXJuLCBmdW5jdGlvbiAoKSB7DQogICAgICByc3QucHVzaChhcmd1bWVudHMkMS5sZW5ndGggPT0gMSA/IGFyZ3VtZW50cyQxWzBdIDogYXJndW1lbnRzJDEpOw0KICAgIH0pOw0KICAgIHJldHVybiByc3Q7DQogIH0NCg0KICB2YXIgcmVSZWdFeHBDaGFyID0gL1tcXF4kLiorPygpW1xde318XS9nOw0KICB2YXIgcmVIYXNSZWdFeHBDaGFyID0gUmVnRXhwKHJlUmVnRXhwQ2hhci5zb3VyY2UpOw0KDQogIGZ1bmN0aW9uIGVzY2FwZVJlZ0V4cChzdHIpIHsNCiAgICBzdHIgKz0gJyc7DQogICAgcmV0dXJuIHN0ciAmJiByZUhhc1JlZ0V4cENoYXIudGVzdChzdHIpID8gc3RyLnJlcGxhY2Uoc3RyLCAnXFwkJicpIDogc3RyOw0KICB9DQogIC8vICNlbmRyZWdpb24KCiAgdmFyIHRvb2wgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICBjaHI6IGNociwKICAgIG9yZDogb3JkLAogICAgaGV4OiBoZXgsCiAgICBiaW46IGJpbiwKICAgIG9jdDogb2N0LAogICAgaW50OiBpbnQsCiAgICBnZXRGdW5jTmFtZTogZ2V0RnVuY05hbWUsCiAgICBnZXRUYWc6IGdldFRhZywKICAgIHR5cGVPZjogdHlwZU9mLAogICAgdHlwZTogdHlwZSwKICAgIGhhczogaGFzJDEsCiAgICBpc0FycmF5OiBpc0FycmF5LAogICAgaXNPYmplY3Q6IGlzT2JqZWN0LAogICAgaXNGdW5jdGlvbjogaXNGdW5jdGlvbiwKICAgIGlzU3RyaW5nOiBpc1N0cmluZywKICAgIGlzTnVtYmVyOiBpc051bWJlciwKICAgIGlzQm9vbGVhbjogaXNCb29sZWFuLAogICAgaXNEYXRlOiBpc0RhdGUsCiAgICBpc1JlZ0V4cDogaXNSZWdFeHAsCiAgICBpc0Vycm9yOiBpc0Vycm9yLAogICAgaXNNYXA6IGlzTWFwLAogICAgaXNTZXQ6IGlzU2V0LAogICAgaXNXZWFrTWFwOiBpc1dlYWtNYXAsCiAgICBpc0ludGVnZXI6IGlzSW50ZWdlciwKICAgIGlzQXJndW1lbnRzOiBpc0FyZ3VtZW50cywKICAgIGlzT2JqZWN0TGlrZTogaXNPYmplY3RMaWtlLAogICAgaXNMZW5ndGg6IGlzTGVuZ3RoLAogICAgaXNBcnJheUxpa2U6IGlzQXJyYXlMaWtlLAogICAgaXNFbXB0eTogaXNFbXB0eSwKICAgIGlzQnVmZmVyOiBpc0J1ZmZlciwKICAgIGFwcGx5OiBhcHBseSwKICAgIHJhbmdlOiByYW5nZSwKICAgIHRvUGF0aDogdG9QYXRoLAogICAgaWRlbnRpdHk6IGlkZW50aXR5LAogICAgaXRlcmF0ZWU6IGl0ZXJhdGVlLAogICAgZWFjaDogZWFjaCwKICAgIGZvckVhY2g6IGZvckVhY2gsCiAgICBtYXA6IG1hcCwKICAgIHNlbGVjdDogc2VsZWN0LAogICAgcmVkdWNlOiByZWR1Y2UsCiAgICBmaWx0ZXI6IGZpbHRlciwKICAgIHdoZXJlOiB3aGVyZSwKICAgIHRvQXJyYXk6IHRvQXJyYXksCiAgICBmaW5kOiBmaW5kLAogICAgZmluZEluZGV4OiBmaW5kSW5kZXgsCiAgICBmaWxsOiBmaWxsLAogICAgZ3JvdXBCeTogZ3JvdXBCeSwKICAgIGNvdW50Qnk6IGNvdW50QnksCiAgICBzaXplOiBzaXplLAogICAgbGVuOiBsZW4sCiAgICB1bmlxQnk6IHVuaXFCeSwKICAgIHVuaXE6IHVuaXEsCiAgICBkaXN0aW5jdDogZGlzdGluY3QsCiAgICBkaXN0aW5jdEJ5OiBkaXN0aW5jdEJ5LAogICAgY2h1bms6IGNodW5rLAogICAgY29uY2F0OiBjb25jYXQsCiAgICBzbGljZTogc2xpY2UsCiAgICBkcm9wOiBkcm9wLAogICAgdGFpbDogdGFpbCwKICAgIGluaXRpYWw6IGluaXRpYWwsCiAgICB0YWtlOiB0YWtlLAogICAgdGFrZVJpZ2h0OiB0YWtlUmlnaHQsCiAgICBjb250YWluczogY29udGFpbnMsCiAgICBpbmNsdWRlOiBpbmNsdWRlLAogICAgaW5jbHVkZXM6IGluY2x1ZGVzLAogICAgZmlyc3Q6IGZpcnN0LAogICAgaGVhZDogaGVhZCwKICAgIGxhc3Q6IGxhc3QsCiAgICBudGg6IG50aCwKICAgIHB1bGxBbGw6IHB1bGxBbGwsCiAgICBwdWxsOiBwdWxsLAogICAgcmVtb3ZlOiByZW1vdmUsCiAgICBkaWZmZXJlbmNlOiBkaWZmZXJlbmNlLAogICAgdW56aXA6IHVuemlwLAogICAgemlwOiB6aXAsCiAgICBmbGF0dGVuOiBmbGF0dGVuLAogICAga2V5czoga2V5cywKICAgIHZhbHVlczogdmFsdWVzLAogICAga2V5c0luOiBrZXlzSW4sCiAgICB2YWx1ZXNJbjogdmFsdWVzSW4sCiAgICB6aXBPYmplY3Q6IHppcE9iamVjdCwKICAgIGZyb21QYWlyczogZnJvbVBhaXJzLAogICAgb2JqZWN0OiBvYmplY3QsCiAgICBnZXQ6IGdldCwKICAgIGF0OiBhdCwKICAgIHByb3BlcnR5T2Y6IHByb3BlcnR5T2YsCiAgICBwcm9wZXJ0eTogcHJvcGVydHksCiAgICBwcm9wZXJ0aWVzOiBwcm9wZXJ0aWVzLAogICAgc2V0OiBzZXQsCiAgICB1bnNldDogdW5zZXQsCiAgICB1cGRhdGU6IHVwZGF0ZSwKICAgIHBpY2s6IHBpY2ssCiAgICBpc01hdGNoOiBpc01hdGNoLAogICAgbWF0Y2hlczogbWF0Y2hlcywKICAgIG1hdGNoZXI6IG1hdGNoZXIsCiAgICBhc3NpZ246IGFzc2lnbiwKICAgIGFzc2lnbkluOiBhc3NpZ25JbiwKICAgIGV4dGVuZDogZXh0ZW5kLAogICAgZGVmYXVsdHM6IGRlZmF1bHRzLAogICAgZW50cmllczogZW50cmllcywKICAgIHRvUGFpcnM6IHRvUGFpcnMsCiAgICBtZW1vaXplOiBtZW1vaXplLAogICAgcGFydGlhbDogcGFydGlhbCwKICAgIGN1cnJ5OiBjdXJyeSwKICAgIGFyeTogYXJ5LAogICAgd3JhcDogd3JhcCwKICAgIHJhbmRvbTogcmFuZG9tLAogICAgc3VtOiBzdW0sCiAgICBhdmVyYWdlOiBhdmVyYWdlLAogICAgYXZnOiBhdmcsCiAgICByb3VuZDogcm91bmQsCiAgICBmbG9vcjogZmxvb3IsCiAgICBjZWlsOiBjZWlsLAogICAgcmFkaWFuczogcmFkaWFucywKICAgIHRvVXBwZXI6IHRvVXBwZXIsCiAgICB0b0xvd2VyOiB0b0xvd2VyLAogICAgdHJpbTogdHJpbSwKICAgIHJlcGVhdDogcmVwZWF0LAogICAgcGFkU3RhcnQ6IHBhZFN0YXJ0LAogICAgcGFkRW5kOiBwYWRFbmQsCiAgICBzdGFydHNXaXRoOiBzdGFydHNXaXRoLAogICAgZW5kc1dpdGg6IGVuZHNXaXRoLAogICAgZWFjaE1hdGNoOiBlYWNoTWF0Y2gsCiAgICBmaW5kQWxsOiBmaW5kQWxsLAogICAgZXNjYXBlUmVnRXhwOiBlc2NhcGVSZWdFeHAKICB9KTsKCiAgZnVuY3Rpb24gbG9nKG1zZykgewogICAgaWYgKCBtc2cgPT09IHZvaWQgMCApIG1zZyA9ICcnOwoNCiAgICBXU2NyaXB0LkVjaG8obXNnKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGluaGVyaXRzKGN0b3IsIHN1cGVyQ3Rvcikgew0KICAgIGN0b3Iuc3VwZXJfID0gc3VwZXJDdG9yOw0KICAgIGN0b3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckN0b3IucHJvdG90eXBlLCB7DQogICAgICBjb25zdHJ1Y3RvcjogY3Rvcg0KICAgIH0pOw0KICB9DQoNCiAgdmFyIEZNVF9SRUcgPSAvJVtzZGlmam9PJV0vZzsNCg0KICBmdW5jdGlvbiBmb3JtYXQoZikgew0KICAgIGlmICghaXNTdHJpbmcoZikpIHsNCiAgICAgIHJldHVybiBtYXAoYXJndW1lbnRzLCBmdW5jdGlvbiAoYXJnKSB7IHJldHVybiBpbnNwZWN0KGFyZyk7IH0pLmpvaW4oJyAnKTsNCiAgICB9DQoNCiAgICB2YXIgaSA9IDEsDQogICAgICBhcmdzID0gYXJndW1lbnRzLA0KICAgICAgbGVuID0gYXJncy5sZW5ndGgsDQogICAgICBzdHIgPSBmLnJlcGxhY2UoRk1UX1JFRywgZnVuY3Rpb24gKHgpIHsNCiAgICAgICAgaWYgKHggPT09ICclJScpIHsgcmV0dXJuICclJzsgfQ0KICAgICAgICBpZiAoaSA+PSBsZW4pIHsgcmV0dXJuIHg7IH0NCiAgICAgICAgc3dpdGNoICh4KSB7DQogICAgICAgICAgY2FzZSAnJXMnOg0KICAgICAgICAgIGNhc2UgJyVkJzoNCiAgICAgICAgICBjYXNlICclaSc6DQogICAgICAgICAgY2FzZSAnJWYnOg0KICAgICAgICAgICAgcmV0dXJuIGFyZ3NbaSsrXTsNCiAgICAgICAgICBjYXNlICclaic6DQogICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoYXJnc1tpKytdKTsNCiAgICAgICAgICBjYXNlICclbyc6DQogICAgICAgICAgY2FzZSAnJU8nOg0KICAgICAgICAgICAgcmV0dXJuIGluc3BlY3QoYXJnc1tpKytdKTsNCiAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgcmV0dXJuIHg7DQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgIGZvciAodmFyIHggPSBhcmdzW2ldOyBpIDwgbGVuOyB4ID0gYXJnc1srK2ldKSB7DQogICAgICBpZiAoaXNQcmltaXRpdmUoeCkpIHsgc3RyICs9ICcgJyArIHg7IH0NCiAgICAgIGVsc2UgeyBzdHIgKz0gJyAnICsgaW5zcGVjdCh4KTsgfQ0KICAgIH0NCiAgICByZXR1cm4gc3RyOw0KICB9DQoNCiAgLy8gTWFyayB0aGF0IGEgbWV0aG9kIHNob3VsZCBub3QgYmUgdXNlZC4NCiAgLy8gUmV0dXJucyBhIG1vZGlmaWVkIGZ1bmN0aW9uIHdoaWNoIHdhcm5zIG9uY2UgYnkgZGVmYXVsdC4NCiAgLy8gSWYgLS1uby1kZXByZWNhdGlvbiBpcyBzZXQsIHRoZW4gaXQgaXMgYSBuby1vcC4NCiAgZnVuY3Rpb24gZGVwcmVjYXRlKGZuLCBtc2cpIHsKICAgIHZhciBhcmd1bWVudHMkMSA9IGFyZ3VtZW50czsKDQogICAgLy8gQWxsb3cgZm9yIGRlcHJlY2F0aW5nIHRoaW5ncyBpbiB0aGUgcHJvY2VzcyBvZiBzdGFydGluZyB1cC4NCiAgICBpZiAoZ2xvYmFsLnByb2Nlc3MgPT09IHZvaWQgMCkgew0KICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsgcmV0dXJuIGFwcGx5KGRlcHJlY2F0ZShmbiwgbXNnKSwgbnVsbCwgYXJndW1lbnRzJDEpOyB9Ow0KICAgIH0NCg0KICAgIGlmIChwcm9jZXNzLm5vRGVwcmVjYXRpb24gPT09IHRydWUpIHsgcmV0dXJuIGZuOyB9DQoNCiAgICB2YXIgd2FybmVkID0gZmFsc2U7DQoNCiAgICBmdW5jdGlvbiBkZXByZWNhdGVkKCkgew0KICAgICAgaWYgKCF3YXJuZWQpIHsNCiAgICAgICAgaWYgKHByb2Nlc3MudGhyb3dEZXByZWNhdGlvbikgeyB0aHJvdyBuZXcgRXJyb3IobXNnKTsgfQ0KICAgICAgICBlbHNlIGlmIChwcm9jZXNzLnRyYWNlRGVwcmVjYXRpb24pIHsgbG9nKG1zZyk7IH0NCiAgICAgICAgZWxzZSB7IGxvZyhtc2cpOyB9DQogICAgICAgIHdhcm5lZCA9IHRydWU7DQogICAgICB9DQogICAgICByZXR1cm4gYXBwbHkoZm4sIG51bGwsIGFyZ3VtZW50cyk7DQogICAgfQ0KDQogICAgcmV0dXJuIGRlcHJlY2F0ZWQ7DQogIH0NCg0KICB2YXIgZGVidWdzID0ge307DQogIHZhciBkZWJ1Z0Vudmlyb247DQoNCiAgZnVuY3Rpb24gZGVidWdsb2coc2V0KSB7CiAgICB2YXIgYXJndW1lbnRzJDEgPSBhcmd1bWVudHM7Cg0KICAgIGlmIChkZWJ1Z0Vudmlyb24gPT0gbnVsbCkgeyBkZWJ1Z0Vudmlyb24gPSBwcm9jZXNzLmVudi5OT0RFX0RFQlVHIHx8ICcnOyB9DQogICAgc2V0ID0gc2V0LnRvVXBwZXJDYXNlKCk7DQogICAgaWYgKCFkZWJ1Z3Nbc2V0XSkgew0KICAgICAgaWYgKG5ldyBSZWdFeHAoJ1xcYicgKyBzZXQgKyAnXFxiJywgJ2knKS50ZXN0KGRlYnVnRW52aXJvbikpIHsNCiAgICAgICAgdmFyIHBpZCA9IHByb2Nlc3MucGlkOw0KICAgICAgICBkZWJ1Z3Nbc2V0XSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICB2YXIgbXNnID0gYXBwbHkoZm9ybWF0LCBudWxsLCBhcmd1bWVudHMkMSk7DQogICAgICAgICAgbG9nKChzZXQgKyAiICIgKyBwaWQgKyAiOiAiICsgbXNnKSk7DQogICAgICAgIH07DQogICAgICB9IGVsc2Ugew0KICAgICAgICBkZWJ1Z3Nbc2V0XSA9IGZ1bmN0aW9uKCkge307DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiBkZWJ1Z3Nbc2V0XTsNCiAgfQ0KDQogIC8qIG9iaiwgWyBzaG93SGlkZGVuL29wdGlvbnMsIGRlcHRoLCBjb2xvcnMgXSAqLw0KICBmdW5jdGlvbiBpbnNwZWN0KG9iaiwgc2hvd0hpZGRlbiwgZGVwdGgsIGNvbG9ycykgew0KICAgIC8vIGRlZmF1bHQgb3B0aW9ucw0KICAgIHZhciBjdHggPSB7DQogICAgICBzZWVuOiBbXSwNCiAgICAgIC8vIHN0eWxpemU6IHN0eWxpemVOb0NvbG9yLA0KICAgICAgc2hvd0hpZGRlbjogZmFsc2UsDQogICAgICBkZXB0aDogMiwNCiAgICAgIGNvbG9yczogZmFsc2UsDQogICAgICBjdXN0b21JbnNwZWN0OiBmYWxzZSwNCiAgICAgIG1heEFycmF5TGVuZ3RoOiAxMDAsDQogICAgICBicmVha0xlbmd0aDogNjANCiAgICB9Ow0KICAgIGlmIChpc0Jvb2xlYW4oc2hvd0hpZGRlbikpIHsgY3R4LnNob3dIaWRkZW4gPSBzaG93SGlkZGVuOyB9DQogICAgaWYgKGlzTnVtYmVyKGRlcHRoKSkgeyBjdHguZGVwdGggPSBkZXB0aDsgfQ0KICAgIGlmIChpc0Jvb2xlYW4oY29sb3JzKSkgeyBjdHguY29sb3JzID0gY29sb3JzOyB9DQogICAgaWYgKGlzT2JqZWN0KHNob3dIaWRkZW4pKSB7DQogICAgICAvLyBnb3QgYW4gIm9wdGlvbnMiIG9iamVjdA0KICAgICAgT2JqZWN0LmFzc2lnbihjdHgsIHNob3dIaWRkZW4pOw0KICAgIH0NCiAgICByZXR1cm4gZm9ybWF0VmFsdWUoY3R4LCBvYmosIDApOw0KICB9DQoNCiAgZnVuY3Rpb24gZm9ybWF0VmFsdWUoY3R4LCB2YWx1ZSwgcmVjdXJzZVRpbWVzKSB7DQogICAgdmFyIHJlc3VsdDsNCiAgICAvLyBQcm92aWRlIGEgaG9vayBmb3IgdXNlci1zcGVjaWZpZWQgaW5zcGVjdCBmdW5jdGlvbnMuDQogICAgLy8gQ2hlY2sgdGhhdCB2YWx1ZSBpcyBhbiBvYmplY3Qgd2l0aCBhbiBpbnNwZWN0IGZ1bmN0aW9uIG9uIGl0DQogICAgaWYgKA0KICAgICAgY3R4LmN1c3RvbUluc3BlY3QgJiYNCiAgICAgIHZhbHVlICYmDQogICAgICBpc0Z1bmN0aW9uKHZhbHVlLmluc3BlY3QpICYmDQogICAgICAvLyBGaWx0ZXIgb3V0IHRoZSB1dGlsIG1vZHVsZSwgaXQncyBpbnNwZWN0IGZ1bmN0aW9uIGlzIHNwZWNpYWwNCiAgICAgIHZhbHVlLmluc3BlY3QgIT09IGluc3BlY3QgJiYNCiAgICAgIC8vIEFsc28gZmlsdGVyIG91dCBhbnkgcHJvdG90eXBlIG9iamVjdHMgdXNpbmcgdGhlIGNpcmN1bGFyIGNoZWNrLg0KICAgICAgISh2YWx1ZS5jb25zdHJ1Y3RvciAmJiB2YWx1ZS5jb25zdHJ1Y3Rvci5wcm90b3R5cGUgPT09IHZhbHVlKQ0KICAgICkgew0KICAgICAgcmVzdWx0ID0gdmFsdWUuaW5zcGVjdChyZWN1cnNlVGltZXMsIGN0eCk7DQogICAgICBpZiAoIWlzU3RyaW5nKHJlc3VsdCkpIHsNCiAgICAgICAgcmVzdWx0ID0gZm9ybWF0VmFsdWUoY3R4LCByZXN1bHQsIHJlY3Vyc2VUaW1lcyk7DQogICAgICB9DQogICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIC8vIFByaW1pdGl2ZSB0eXBlcyBjYW5ub3QgaGF2ZSBwcm9wZXJ0aWVzDQogICAgcmVzdWx0ID0gZm9ybWF0VmFsdWVfc2ltcGxlKHZhbHVlKTsNCiAgICBpZiAocmVzdWx0ICE9PSBmYWxzZSkgeyByZXR1cm4gcmVzdWx0OyB9DQoNCiAgICAvLyBMb29rIHVwIHRoZSBrZXlzIG9mIHRoZSBvYmplY3QuDQogICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyh2YWx1ZSk7DQogICAgdmFyIHZpc2libGVLZXlzID0ga2V5cy5yZWR1Y2UoZnVuY3Rpb24gKG1lbW8sIGtleSkgeyByZXR1cm4gKChtZW1vW2tleV0gPSB0cnVlKSwgbWVtbyk7IH0sIHt9KTsNCg0KICAgIGlmIChjdHguc2hvd0hpZGRlbikgew0KICAgICAga2V5cyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHZhbHVlKTsNCiAgICB9DQoNCiAgICBpZiAocmVjdXJzZVRpbWVzID4gY3R4LmRlcHRoKSB7IHJldHVybiBnZXRUYWcodmFsdWUpOyB9DQoNCiAgICBjdHguc2Vlbi5wdXNoKHZhbHVlKTsNCg0KICAgIHZhciBvdXRwdXQsDQogICAgICB2VHlwZSA9IHR5cGVPZih2YWx1ZSk7DQogICAgb3V0cHV0ID0gZm9ybWF0T2JqZWN0KGN0eCwgdmFsdWUsIHJlY3Vyc2VUaW1lcywgdmlzaWJsZUtleXMsIGtleXMsIHZUeXBlKTsNCiAgICBjdHguc2Vlbi5wb3AoKTsNCg0KICAgIHJldHVybiByZWR1Y2VUb1NpbmdsZVN0cmluZyhjdHgsIG91dHB1dCwgcmVjdXJzZVRpbWVzLCB2VHlwZSk7DQogIH0NCg0KICB2YXIgRVNDQVBTRV9NQVAgPSB7DQogICAgIiciOiAiJyIsDQogICAgJ1xcJzogJ1xcJywNCiAgICAnXHInOiAncicsDQogICAgJ1xuJzogJ24nLA0KICAgICdcdTIwMjgnOiAndTIwMjgnLA0KICAgICdcdTIwMjknOiAndTIwMjknDQogIH07DQoNCiAgdmFyIEVTQ0FQU0VfUkVHID0gLyd8XFx8XHJ8XG58XHUyMDI4fFx1MjAyOV0vZzsNCg0KICBmdW5jdGlvbiBlc2NhcGVDaGFyKGMpIHsNCiAgICByZXR1cm4gJ1xcJyArIEVTQ0FQU0VfTUFQW2NdOw0KICB9DQoNCiAgZnVuY3Rpb24gZm9ybWF0VmFsdWVfc2ltcGxlKHZhbHVlKSB7DQogICAgaWYgKHZhbHVlID09PSB2b2lkIDApIHsgcmV0dXJuICd1bmRlZmluZWQnOyB9DQogICAgaWYgKHZhbHVlID09PSBudWxsKSB7IHJldHVybiAnbnVsbCc7IH0NCiAgICBzd2l0Y2ggKHR5cGVPZih2YWx1ZSkpIHsNCiAgICAgIGNhc2UgJ3N0cmluZyc6DQogICAgICAgIHJldHVybiAiJyIgKyB2YWx1ZS5yZXBsYWNlKEVTQ0FQU0VfUkVHLCBlc2NhcGVDaGFyKSArICInIjsNCiAgICAgIGNhc2UgJ251bWJlcic6DQogICAgICBjYXNlICdib29sZWFuJzoNCiAgICAgIGNhc2UgJ3JlZ2V4cCc6DQogICAgICAgIHJldHVybiBTdHJpbmcodmFsdWUpOw0KICAgICAgY2FzZSAnZGF0ZSc6DQogICAgICAgIHJldHVybiB2YWx1ZS50b0pTT04oKTsNCiAgICAgIGNhc2UgJ2Z1bmN0aW9uJzogew0KICAgICAgICB2YXIgbmFtZSA9IGdldEZ1bmNOYW1lKHZhbHVlKTsNCiAgICAgICAgcmV0dXJuIG5hbWUgPyAnW0Z1bmN0aW9uOiAnICsgbmFtZSArICddJyA6ICdbRnVuY3Rpb25dJzsNCiAgICAgIH0NCiAgICAgIGNhc2UgJ2Vycm9yJzoNCiAgICAgICAgcmV0dXJuICdbJyArIHZhbHVlICsgJ10nOw0KICAgICAgY2FzZSAnYnVmZmVyJzogew0KICAgICAgICB2YXIgYnl0ZXMgPSB2YWx1ZS5idWZmZXIsDQogICAgICAgICAgbGVuID0gdmFsdWUubGVuZ3RoLA0KICAgICAgICAgIGkgPSAtMSwNCiAgICAgICAgICBvdmVyZmxvdywNCiAgICAgICAgICBhcnI7DQogICAgICAgIGlmIChsZW4gPiA1MCkgew0KICAgICAgICAgIG92ZXJmbG93ID0gdHJ1ZTsNCiAgICAgICAgICBsZW4gPSA1MDsNCiAgICAgICAgICBhcnIgPSBBcnJheSg1MSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgYXJyID0gQXJyYXkobGVuKTsNCiAgICAgICAgfQ0KICAgICAgICB3aGlsZSAoKytpIDwgbGVuKSB7IGFycltpXSA9IGhleChieXRlcy5nZXRJdGVtKGkpKTsgfQ0KICAgICAgICBpZiAob3ZlcmZsb3cpIHsgYXJyWzUwXSA9ICcuLi4nOyB9DQogICAgICAgIHJldHVybiAnPEJ1ZmZlciAnICsgYXJyLmpvaW4oJyAnKSArICc+JzsNCiAgICAgIH0NCiAgICAgIGRlZmF1bHQ6DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBmb3JtYXRPYmplY3QoY3R4LCBvYmosIHJlY3Vyc2VUaW1lcywgdmlzaWJsZUtleXMsIGtleXMsIHZUeXBlKSB7DQogICAgdmFyIG91dHB1dCA9IFtdLA0KICAgICAgaSA9IDAsDQogICAgICBsZW4sDQogICAgICBrZXk7DQogICAgaWYgKHZUeXBlID09ICdhcnJheScpIHsNCiAgICAgIGxlbiA9IG9iai5sZW5ndGg7DQogICAgICBmb3IgKDsgaSA8IGxlbjsgaSsrKSB7DQogICAgICAgIGlmIChpID49IGN0eC5tYXhBcnJheUxlbmd0aCkgew0KICAgICAgICAgIG91dHB1dC5wdXNoKCcuLi4gJyArIChsZW4gLSBjdHgubWF4QXJyYXlMZW5ndGgpICsgJyBtb3JlIGl0ZW1zJyk7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgICAgb3V0cHV0LnB1c2goZm9ybWF0UHJvcGVydHkoY3R4LCBvYmpbaV0sIHJlY3Vyc2VUaW1lcywgbnVsbCwgdHJ1ZSwgbnVsbCkpOw0KICAgICAgfQ0KICAgICAgaSA9IGxlbjsNCiAgICB9IGVsc2UgaWYgKHZUeXBlID09ICdtYXAnKSB7DQogICAgICBvYmouZm9yRWFjaChmdW5jdGlvbiAodmFsdWUsIGtleSkgew0KICAgICAgICBvdXRwdXQucHVzaChmb3JtYXRQcm9wZXJ0eShjdHgsIHZhbHVlLCByZWN1cnNlVGltZXMsIGtleSwgdHJ1ZSwgJyA9PiAnKSk7DQogICAgICB9KTsNCiAgICB9IGVsc2UgaWYgKHZUeXBlID09ICdzZXQnKSB7DQogICAgICBvYmouZm9yRWFjaChmdW5jdGlvbiAodmFsdWUpIHsNCiAgICAgICAgb3V0cHV0LnB1c2goZm9ybWF0UHJvcGVydHkoY3R4LCB2YWx1ZSwgcmVjdXJzZVRpbWVzLCBudWxsLCB0cnVlLCBudWxsKSk7DQogICAgICB9KTsNCiAgICB9DQoNCiAgICBmb3IgKGxlbiA9IGtleXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCiAgICAgIGtleSA9IGtleXNbaV07DQogICAgICBvdXRwdXQucHVzaCgNCiAgICAgICAgZm9ybWF0UHJvcGVydHkoY3R4LCBvYmpba2V5XSwgcmVjdXJzZVRpbWVzLCBrZXksIHZpc2libGVLZXlzW2tleV0sICc6ICcpDQogICAgICApOw0KICAgIH0NCiAgICByZXR1cm4gb3V0cHV0Ow0KICB9DQoNCiAgZnVuY3Rpb24gZm9ybWF0UHJvcGVydHkoY3R4LCB2YWx1ZSwgcmVjdXJzZVRpbWVzLCBrZXksIGVudW1lcmFibGUsIHNlcCkgew0KICAgIHZhciBuYW1lLCBzdHI7DQoNCiAgICBpZiAoY3R4LnNlZW4uaW5kZXhPZih2YWx1ZSkgPT09IC0xKSB7DQogICAgICBzdHIgPSBmb3JtYXRWYWx1ZShjdHgsIHZhbHVlLCByZWN1cnNlVGltZXMgKyAxKTsNCiAgICB9IGVsc2Ugew0KICAgICAgc3RyID0gJ1tDaXJjdWxhcl0nOw0KICAgIH0NCg0KICAgIGlmIChrZXkgPT0gbnVsbCkgeyByZXR1cm4gc3RyOyB9DQoNCiAgICBuYW1lID0gZW51bWVyYWJsZSA/IFN0cmluZyhrZXkpIDogJ1snICsga2V5ICsgJ10nOw0KDQogICAgaWYgKCEvXlx3KyQvLnRlc3QobmFtZSkpIHsNCiAgICAgIG5hbWUgPSAiJyIgKyBuYW1lLnJlcGxhY2UoLycvZywgIlxcJyIpICsgIiciOw0KICAgIH0NCg0KICAgIHJldHVybiBuYW1lICsgc2VwICsgc3RyOw0KICB9DQoNCiAgZnVuY3Rpb24gcmVkdWNlVG9TaW5nbGVTdHJpbmcoY3R4LCBvdXRwdXQsIHJlY3Vyc2VUaW1lcywgdlR5cGUpIHsNCiAgICB2YXIgYnJhY2VzLA0KICAgICAgaW5kZW50LA0KICAgICAgYnJlYWtMaW5lID0gZmFsc2UsDQogICAgICBsZW4gPSBvdXRwdXQubGVuZ3RoLA0KICAgICAgaSA9IC0xLA0KICAgICAgY291bnQgPSAwOw0KICAgIGlmICh2VHlwZSA9PSAnYXJyYXknKSB7IGJyYWNlcyA9IFsnWycsICddJ107IH0NCiAgICBlbHNlIGlmICh2VHlwZSA9PSAnbWFwJykgeyBicmFjZXMgPSBbJ01hcCB7JywgJ30nXTsgfQ0KICAgIGVsc2UgaWYgKHZUeXBlID09ICdzZXQnKSB7IGJyYWNlcyA9IFsnU2V0IHsnLCAnfSddOyB9DQogICAgZWxzZSBpZiAodlR5cGUgPT0gJ2FyZ3VtZW50cycpIHsgYnJhY2VzID0gWydbQXJndW1lbnRzXSB7JywgJ30nXTsgfQ0KICAgIGVsc2UgeyBicmFjZXMgPSBbJ3snLCAnfSddOyB9DQoNCiAgICBpZiAobGVuID09IDApIHsgcmV0dXJuIGJyYWNlc1swXSArIGJyYWNlc1sxXTsgfQ0KDQogICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgY291bnQgKz0gb3V0cHV0W2ldLmxlbmd0aCArIDE7DQogICAgICBpZiAoY291bnQgPiBjdHguYnJlYWtMZW5ndGgpIHsNCiAgICAgICAgYnJlYWtMaW5lID0gdHJ1ZTsNCiAgICAgICAgYnJlYWs7DQogICAgICB9DQogICAgfQ0KDQogICAgbGVuID0gb3V0cHV0LnJlZHVjZShmdW5jdGlvbiAobWVtbywgY3VyKSB7IHJldHVybiBtZW1vICsgY3VyLmxlbmd0aCArIDE7IH0sIDApOw0KICAgIGluZGVudCA9IHJlcGVhdCgnICAnLCByZWN1cnNlVGltZXMpOw0KICAgIGlmIChicmVha0xpbmUpIHsNCiAgICAgIHJldHVybiB2VHlwZSA9PSAnYXJyYXknDQogICAgICAgID8gYnJhY2VzWzBdICsgJyAnICsgb3V0cHV0LmpvaW4oJyxcclxuICAnICsgaW5kZW50KSArICcgJyArIGJyYWNlc1sxXQ0KICAgICAgICA6IGJyYWNlc1swXSArDQogICAgICAgICAgICAnIFxyXG4gICcgKw0KICAgICAgICAgICAgaW5kZW50ICsNCiAgICAgICAgICAgIG91dHB1dC5qb2luKCcsXHJcbiAgJyArIGluZGVudCkgKw0KICAgICAgICAgICAgJyAnICsNCiAgICAgICAgICAgIGJyYWNlc1sxXTsNCiAgICB9DQogICAgcmV0dXJuIGJyYWNlc1swXSArICcgJyArIG91dHB1dC5qb2luKCcsICcpICsgJyAnICsgYnJhY2VzWzFdOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNQcmltaXRpdmUodmFsdWUpIHsNCiAgICByZXR1cm4gIWlzT2JqZWN0KHZhbHVlKTsNCiAgfQoKICB2YXIgdXRpbCA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgIGluaGVyaXRzOiBpbmhlcml0cywKICAgIGZvcm1hdDogZm9ybWF0LAogICAgZGVwcmVjYXRlOiBkZXByZWNhdGUsCiAgICBkZWJ1Z2xvZzogZGVidWdsb2csCiAgICBpbnNwZWN0OiBpbnNwZWN0LAogICAgaXNQcmltaXRpdmU6IGlzUHJpbWl0aXZlCiAgfSk7CgogIHZhciBDb25zb2xlID0gZnVuY3Rpb24gQ29uc29sZShzdGRvdXQsIHN0ZGVycikgew0KICAgIGlmICghc3Rkb3V0IHx8ICEoJ1dyaXRlJyBpbiBzdGRvdXQpKSB7DQogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvbnNvbGUgZXhwZWN0cyBhIHdyaXRhYmxlIHN0cmVhbSBpbnN0YW5jZScpOw0KICAgIH0NCiAgICBpZiAoIXN0ZGVycikgeyBzdGRlcnIgPSBzdGRvdXQ7IH0NCiAgICB0aGlzLl9zdGRvdXQgPSBzdGRvdXQ7DQogICAgdGhpcy5fc3RkZXJyID0gc3RkZXJyOw0KICAgIHRoaXMuX3RpbWVzID0ge307DQoNCiAgICBmb3IgKHZhciBrZXkgaW4gQ29uc29sZS5wcm90b3R5cGUpIHsNCiAgICAgIHRoaXNba2V5XSA9IHRoaXNba2V5XS5iaW5kKHRoaXMpOw0KICAgIH0NCiAgfTsNCg0KICBDb25zb2xlLnByb3RvdHlwZS5sb2cgPSBmdW5jdGlvbiBsb2cgKCkgewogICAgICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdOwoNCiAgICB0aGlzLl9zdGRvdXQuV3JpdGVMaW5lKGZvcm1hdC5hcHBseSh2b2lkIDAsIGFyZ3MpKTsNCiAgfTsNCg0KICBDb25zb2xlLnByb3RvdHlwZS5pbmZvID0gZnVuY3Rpb24gaW5mbyAoKSB7CiAgICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07Cg0KICAgIHRoaXMuX3N0ZG91dC5Xcml0ZUxpbmUoZm9ybWF0LmFwcGx5KHZvaWQgMCwgYXJncykpOw0KICB9Ow0KDQogIENvbnNvbGUucHJvdG90eXBlLndhcm4gPSBmdW5jdGlvbiB3YXJuICgpIHsKICAgICAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDsKICAgICAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTsKDQogICAgdGhpcy5fc3RkZXJyLldyaXRlTGluZShmb3JtYXQuYXBwbHkodm9pZCAwLCBhcmdzKSk7DQogIH07DQoNCiAgQ29uc29sZS5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiBlcnJvciAoKSB7CiAgICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07Cg0KICAgIHRoaXMuX3N0ZGVyci5Xcml0ZUxpbmUoZm9ybWF0LmFwcGx5KHZvaWQgMCwgYXJncykpOw0KICB9Ow0KDQogIENvbnNvbGUucHJvdG90eXBlLmRpciA9IGZ1bmN0aW9uIGRpciAob2JqZWN0KSB7DQogICAgdGhpcy5fc3Rkb3V0LldyaXRlTGluZSgNCiAgICAgIGluc3BlY3Qob2JqZWN0LCB7DQogICAgICAgIGN1c3RvbUluc3BlY3Q6IGZhbHNlDQogICAgICB9KQ0KICAgICk7DQogIH07DQoNCiAgQ29uc29sZS5wcm90b3R5cGUudGltZSA9IGZ1bmN0aW9uIHRpbWUgKGxhYmVsKSB7DQogICAgdGhpcy5fdGltZXNbbGFiZWxdID0gRGF0ZS5ub3coKTsNCiAgfTsNCg0KICBDb25zb2xlLnByb3RvdHlwZS50aW1lRW5kID0gZnVuY3Rpb24gdGltZUVuZCAobGFiZWwpIHsNCiAgICB2YXIgdGltZSA9IHRoaXMuX3RpbWVzW2xhYmVsXTsNCiAgICBpZiAoIXRpbWUpIHsNCiAgICAgIHRocm93IG5ldyBFcnJvcignTm8gc3VjaCBsYWJlbDogJyArIGxhYmVsKTsNCiAgICB9DQogICAgdmFyIGR1cmF0aW9uID0gRGF0ZS5ub3coKSAtIHRpbWU7DQogICAgdGhpcy5sb2coJyVzOiAlZG1zJywgbGFiZWwsIGR1cmF0aW9uKTsNCiAgfTsNCg0KICBDb25zb2xlLnByb3RvdHlwZS5hc3NlcnQgPSBmdW5jdGlvbiBhc3NlcnQgKHYpIHsKICAgICAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aCAtIDE7CiAgICAgIHdoaWxlICggbGVuLS0gPiAwICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiArIDEgXTsKDQogICAgaWYgKCF2KSB7IHRocm93IG5ldyBFcnJvcihmb3JtYXQuYXBwbHkodm9pZCAwLCBhcmdzKSk7IH0NCiAgfTsNCg0KICB2YXIgY29uc29sZSA9IG5ldyBDb25zb2xlKFdTY3JpcHQuU3RkT3V0LCBXU2NyaXB0LlN0ZEVycik7CgogIHZhciBST09UX1JFR0VYUCA9IC9eKFtBLXpdOnwpWy9cXF0vOw0KICB2YXIgU0VQX1JFR0VYUCA9IC9bL1xcXSsvOw0KICB2YXIgU0VQX1JFR0VYUF9FTkQgPSAvWy9cXF0kLzsNCiAgdmFyIExOS19SRUdFWFAgPSAvKFwubG5rfFwudXJsKSQvOw0KDQogIHZhciBTRVAgPSAnXFwnOw0KICB2YXIgc2VwID0gU0VQOw0KDQogIGZ1bmN0aW9uIGlzYWJzKHB0aCkgew0KICAgIHJldHVybiBwdGggJiYgUk9PVF9SRUdFWFAudGVzdChwdGgpOw0KICB9DQoNCiAgdmFyIGlzQWJzb2x1dGUgPSBpc2FiczsNCg0KICBmdW5jdGlvbiBkaXJuYW1lKHB0aCkgew0KICAgIHJldHVybiBfX0ZTTy5HZXRQYXJlbnRGb2xkZXJOYW1lKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiBiYXNlbmFtZShwdGgsIGV4dCkgew0KICAgIHJldHVybiBleHQgPyBfX0ZTTy5HZXRCYXNlTmFtZShwdGgpIDogX19GU08uR2V0RmlsZU5hbWUocHRoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGV4dG5hbWUocHRoKSB7DQogICAgcmV0dXJuIF9fRlNPLkdldEV4dGVuc2lvbk5hbWUocHRoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGFic3BhdGgocHRoKSB7DQogICAgaWYgKCFpc2FicyhwdGgpKSB7IHB0aCA9IF9fZGlybmFtZSArIFNFUCArIHB0aDsgfQ0KICAgIHJldHVybiBfX0ZTTy5HZXRBYnNvbHV0ZVBhdGhOYW1lKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiBub3JtcGF0aChwdGgpIHsNCiAgICB2YXIgcGFydHMgPSBwdGguc3BsaXQoU0VQX1JFR0VYUCksDQogICAgICBub3JtUGFydHMgPSBbXSwNCiAgICAgIGxlbiA9IHBhcnRzLmxlbmd0aCwNCiAgICAgIHBhcnQ7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgew0KICAgICAgcGFydCA9IHBhcnRzW2ldOw0KICAgICAgaWYgKHBhcnQgPT09ICcuLicpIHsgbm9ybVBhcnRzLnBvcCgpOyB9DQogICAgICBlbHNlIGlmIChwYXJ0ID09PSAnLicpIHsgY29udGludWU7IH0NCiAgICAgIGVsc2UgeyBub3JtUGFydHMucHVzaChwYXJ0KTsgfQ0KICAgIH0NCiAgICByZXR1cm4gbm9ybVBhcnRzLmpvaW4oU0VQKTsNCiAgfQ0KDQogIHZhciBub3JtYWxpemUgPSBub3JtcGF0aDsNCg0KICBmdW5jdGlvbiBqb2luKCkgewogICAgdmFyIGFyZ3VtZW50cyQxID0gYXJndW1lbnRzOwoNCiAgICB2YXIgcCwNCiAgICAgIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGgsDQogICAgICBwYXJ0cyA9IFtdOw0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsNCiAgICAgIHAgPSBhcmd1bWVudHMkMVtpXTsNCiAgICAgIGlmICh0eXBlb2YgcCA9PT0gJ3N0cmluZycpIHsgcGFydHMucHVzaChwKTsgfQ0KICAgIH0NCiAgICByZXR1cm4gbm9ybXBhdGgocGFydHMuam9pbihTRVApKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlc29sdmUoKSB7CiAgICB2YXIgYXJndW1lbnRzJDEgPSBhcmd1bWVudHM7Cg0KICAgIHZhciBwLA0KICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aCwNCiAgICAgIHBhcnRzID0gW107DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgew0KICAgICAgcCA9IGFyZ3VtZW50cyQxW2ldOw0KICAgICAgaWYgKHR5cGVvZiBwID09PSAnc3RyaW5nJykgew0KICAgICAgICBpZiAoUk9PVF9SRUdFWFAudGVzdChwKSkgew0KICAgICAgICAgIHBhcnRzLmxlbmd0aCA9IDA7DQogICAgICAgICAgcGFydHNbMF0gPSBwOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHBhcnRzLnB1c2gocCk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIGFic3BhdGgocGFydHMuam9pbihTRVApKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlbGF0aXZlKGZyb20sIHRvKSB7DQogICAgdmFyIGZyb21fID0gYWJzcGF0aChmcm9tKS50b0xvd2VyQ2FzZSgpLA0KICAgICAgdG9fID0gYWJzcGF0aCh0bykudG9Mb3dlckNhc2UoKSwNCiAgICAgIGZyb21QYXJ0cyA9IGZyb21fLnNwbGl0KFNFUF9SRUdFWFApLA0KICAgICAgdG9QYXJ0cyA9IHRvXy5zcGxpdChTRVBfUkVHRVhQKSwNCiAgICAgIGxlbiA9IE1hdGgubWluKGZyb21QYXJ0cy5sZW5ndGgsIHRvUGFydHMubGVuZ3RoKSwNCiAgICAgIHNhbWVQYXJ0c0xlbiA9IGxlbiwNCiAgICAgIGkgPSAtMTsNCg0KICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgIGlmIChmcm9tUGFydHNbaV0gIT09IHRvUGFydHNbaV0pIHsNCiAgICAgICAgc2FtZVBhcnRzTGVuID0gaTsNCiAgICAgICAgYnJlYWs7DQogICAgICB9DQogICAgfQ0KDQogICAgaWYgKHNhbWVQYXJ0c0xlbiA9PSAwKSB7IHJldHVybiB0bzsgfQ0KDQogICAgdmFyIG91dHB1dFBhcnRzID0gW107DQogICAgZm9yIChpID0gc2FtZVBhcnRzTGVuOyBpIDwgZnJvbVBhcnRzLmxlbmd0aDsgaSsrKSB7DQogICAgICBvdXRwdXRQYXJ0cy5wdXNoKCcuLicpOw0KICAgIH0NCg0KICAgIG91dHB1dFBhcnRzID0gb3V0cHV0UGFydHMuY29uY2F0KHRvUGFydHMuc2xpY2Uoc2FtZVBhcnRzTGVuKSk7DQoNCiAgICByZXR1cm4gb3V0cHV0UGFydHMuam9pbihTRVApOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNmaWxlKHB0aCkgew0KICAgIHJldHVybiBfX0ZTTy5GaWxlRXhpc3RzKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiBpc2RpcihwdGgpIHsNCiAgICByZXR1cm4gX19GU08uRm9sZGVyRXhpc3RzKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiBleGlzdHMocHRoKSB7DQogICAgcmV0dXJuIGlzZmlsZShwdGgpIHx8IGlzZGlyKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiBjcmVhdGVTaG9ydGN1dChwdGgsIG9wdGlvbnMpIHsNCiAgICB2YXIgc2hvcnRjdXQgPSBfX1dTaGVsbC5DcmVhdGVTaG9ydGN1dChwdGgpOw0KICAgIGlmIChvcHRpb25zLnRhcmdldCkgeyBzaG9ydGN1dC5UYXJnZXRQYXRoID0gb3B0aW9ucy50YXJnZXQ7IH0NCiAgICBpZiAob3B0aW9ucy5ydW5TdHlsZSkgeyBzaG9ydGN1dC5XaW5kb3dTdHlsZSA9IG9wdGlvbnMucnVuU3R5bGU7IH0gLy9OT1JNQUwoMSksTUFYKDMpLE1JTig3KQ0KICAgIGlmIChvcHRpb25zLmRlc2MpIHsgc2hvcnRjdXQuRGVzY3JpcHRpb24gPSBvcHRpb25zLmRlc2M7IH0NCiAgICBzaG9ydGN1dC5TYXZlKCk7DQogIH0NCg0KICBmdW5jdGlvbiBnZXRTaG9ydGN1dFRhcmdldChwdGgpIHsNCiAgICB2YXIgc2hvcnRjdXQgPSBfX1dTaGVsbC5DcmVhdGVTaG9ydGN1dChwdGgpOw0KICAgIHJldHVybiBzaG9ydGN1dC5UYXJnZXRQYXRoOw0KICB9DQoNCiAgdmFyIEZJTEVfUFJPVE8gPSB7DQogICAgaXNmaWxlOiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiAodGhpcy5fZmlsZS5BdHRyaWJ1dGVzICYgMTYpID09IDA7DQogICAgfSwNCiAgICBpc0ZpbGU6IGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuICh0aGlzLl9maWxlLkF0dHJpYnV0ZXMgJiAxNikgPT0gMDsNCiAgICB9LA0KICAgIGlzZGlyOiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiAodGhpcy5fZmlsZS5BdHRyaWJ1dGVzICYgMTYpID09IDE2Ow0KICAgIH0sDQogICAgaXNEaXJlY3Rvcnk6IGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuICh0aGlzLl9maWxlLkF0dHJpYnV0ZXMgJiAxNikgPT0gMTY7DQogICAgfSwNCiAgICBpc1Nob3J0Y3V0OiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiB0aGlzLmlzRmlsZSgpICYmIExOS19SRUdFWFAudGVzdCh0aGlzLnBhdGgpOw0KICAgIH0sDQogICAgY3JlYXRlU2hvcnRjdXQ6IGZ1bmN0aW9uKHB0aCwgb3B0aW9ucykgew0KICAgICAgb3B0aW9ucy50YXJnZXQgPSB0aGlzLnBhdGg7DQogICAgICBjcmVhdGVTaG9ydGN1dChwdGgsIG9wdGlvbnMpOw0KICAgIH0sDQogICAgY29weTogZnVuY3Rpb24oZHN0LCBvdykgew0KICAgICAgaWYgKCFpc2Ficyhkc3QpKSB7IGRzdCA9IGFic3BhdGgoZHN0KTsgfQ0KICAgICAgaWYgKCFTRVBfUkVHRVhQX0VORC50ZXN0KGRzdCkpIHsgZHN0ICs9IFNFUDsgfQ0KICAgICAgaWYgKCFpc2Rpcihkc3QpKSB7IG1rZGlycyhkc3QpOyB9DQogICAgICByZXR1cm4gdGhpcy5fZmlsZS5Db3B5KGRzdCwgb3cgPT0gbnVsbCA/IHRydWUgOiAhIW93KTsNCiAgICB9LA0KICAgIGRlbGV0ZTogZnVuY3Rpb24oZm9yY2UpIHsNCiAgICAgIHJldHVybiB0aGlzLl9maWxlLkRlbGV0ZSghIWZvcmNlKTsNCiAgICB9LA0KICAgIG1vdmU6IGZ1bmN0aW9uKGRzdCkgew0KICAgICAgaWYgKCFpc2Ficyhkc3QpKSB7IGRzdCA9IGFic3BhdGgoZHN0KTsgfQ0KICAgICAgaWYgKCFTRVBfUkVHRVhQX0VORC50ZXN0KGRzdCkpIHsgZHN0ICs9IFNFUDsgfQ0KICAgICAgaWYgKCFpc2Rpcihkc3QpKSB7IG1rZGlycyhkc3QpOyB9DQogICAgICByZXR1cm4gdGhpcy5fZmlsZS5Nb3ZlKGRzdCk7DQogICAgfSwNCiAgICBnZXRDaGlsZHJlbjogZnVuY3Rpb24oKSB7DQogICAgICB2YXIgc2VsZiA9IHRoaXMuaXNTaG9ydGN1dCgpID8gZ2V0U3RhdHModGhpcy50YXJnZXQpIDogdGhpczsNCiAgICAgIGlmIChzZWxmLmlzRmlsZSgpKSB7IHJldHVybiBudWxsOyB9DQogICAgICB2YXIgX2VudW0gPSBuZXcgRW51bWVyYXRvcihzZWxmLl9maWxlLkZpbGVzKTsNCiAgICAgIHZhciByc3QgPSBbXTsNCiAgICAgIGZvciAoOyAhX2VudW0uYXRFbmQoKTsgX2VudW0ubW92ZU5leHQoKSkgew0KICAgICAgICByc3QucHVzaChnZXRTdGF0cyhfZW51bS5pdGVtKCkpKTsNCiAgICAgIH0NCiAgICAgIF9lbnVtID0gbmV3IEVudW1lcmF0b3Ioc2VsZi5fZmlsZS5TdWJGb2xkZXJzKTsNCiAgICAgIGZvciAoOyAhX2VudW0uYXRFbmQoKTsgX2VudW0ubW92ZU5leHQoKSkgew0KICAgICAgICByc3QucHVzaChnZXRTdGF0cyhfZW51bS5pdGVtKCkpKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiByc3Q7DQogICAgfQ0KICB9Ow0KDQogIHZhciBGSUxFX1BST1BTID0gew0KICAgIF9maWxlOiB7DQogICAgICB2YWx1ZTogbnVsbCwNCiAgICAgIHdyaXRhYmxlOiB0cnVlDQogICAgfSwNCiAgICBuYW1lOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuX2ZpbGUuTmFtZTsNCiAgICAgIH0sDQogICAgICBzZXQ6IGZ1bmN0aW9uKHYpIHsNCiAgICAgICAgdGhpcy5fZmlsZS5OYW1lID0gdjsNCiAgICAgIH0NCiAgICB9LA0KICAgIHBhdGg6IHsNCiAgICAgIGVudW1lcmFibGU6IHRydWUsDQogICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5fZmlsZS5QYXRoOw0KICAgICAgfQ0KICAgIH0sDQogICAgZGlybmFtZTogew0KICAgICAgZW51bWVyYWJsZTogdHJ1ZSwNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB0aGlzLl9maWxlLlBhcmVudEZvbGRlci5QYXRoOw0KICAgICAgfQ0KICAgIH0sDQogICAgc2l6ZTogew0KICAgICAgZW51bWVyYWJsZTogdHJ1ZSwNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB0aGlzLl9maWxlLlNpemU7DQogICAgICB9DQogICAgfSwNCiAgICB0eXBlOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuX2ZpbGUuVHlwZTsNCiAgICAgIH0NCiAgICB9LA0KICAgIHRhcmdldDogew0KICAgICAgZW51bWVyYWJsZTogdHJ1ZSwNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB0aGlzLmlzU2hvcnRjdXQoKSA/IGdldFNob3J0Y3V0VGFyZ2V0KHRoaXMucGF0aCkgOiBudWxsOw0KICAgICAgfQ0KICAgIH0sDQogICAgYXRpbWU6IHsNCiAgICAgIGVudW1lcmFibGU6IHRydWUsDQogICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gbmV3IERhdGUodGhpcy5fZmlsZS5EYXRlTGFzdEFjY2Vzc2VkKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIG10aW1lOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKHRoaXMuX2ZpbGUuRGF0ZUxhc3RNb2RpZmllZCk7DQogICAgICB9DQogICAgfSwNCiAgICBjdGltZTogew0KICAgICAgZW51bWVyYWJsZTogdHJ1ZSwNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiBuZXcgRGF0ZSh0aGlzLl9maWxlLkRhdGVDcmVhdGVkKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIGF0aW1lTXM6IHsNCiAgICAgIGVudW1lcmFibGU6IHRydWUsDQogICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5hdGltZS5nZXRUaW1lKCk7DQogICAgICB9DQogICAgfSwNCiAgICBtdGltZU1zOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMubXRpbWUuZ2V0VGltZSgpOw0KICAgICAgfQ0KICAgIH0sDQogICAgY3RpbWVNczogew0KICAgICAgZW51bWVyYWJsZTogdHJ1ZSwNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB0aGlzLmN0aW1lLmdldFRpbWUoKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIHJlYWRvbmx5OiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuICEhKHRoaXMuX2ZpbGUuQXR0cmlidXRlcyAmIDEpOw0KICAgICAgfQ0KICAgIH0sDQogICAgaGlkZGVuOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuICEhKHRoaXMuX2ZpbGUuQXR0cmlidXRlcyAmIDIpOw0KICAgICAgfQ0KICAgIH0sDQogICAgc3lzdGVtOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuICEhKHRoaXMuX2ZpbGUuQXR0cmlidXRlcyAmIDQpOw0KICAgICAgfQ0KICAgIH0NCiAgfTsNCg0KICBmdW5jdGlvbiBnZXRTdGF0cyhwdGgpIHsNCiAgICB2YXIgZiwNCiAgICAgIGluc3RhbmNlID0gT2JqZWN0LmNyZWF0ZShGSUxFX1BST1RPLCBGSUxFX1BST1BTKTsNCiAgICBpZiAodHlwZW9mIHB0aCA9PSAnb2JqZWN0Jykgew0KICAgICAgZiA9IHB0aDsNCiAgICB9IGVsc2UgaWYgKHR5cGVvZiBwdGggPT0gJ3N0cmluZycpIHsNCiAgICAgIGlmICghaXNhYnMocHRoKSkgeyBwdGggPSBhYnNwYXRoKHB0aCk7IH0NCiAgICAgIGlmIChpc2ZpbGUocHRoKSkgew0KICAgICAgICBmID0gX19GU08uR2V0RmlsZShwdGgpOw0KICAgICAgfSBlbHNlIGlmIChpc2RpcihwdGgpKSB7DQogICAgICAgIGYgPSBfX0ZTTy5HZXRGb2xkZXIocHRoKTsNCiAgICAgIH0NCiAgICB9DQogICAgaWYgKCFmKSB7IHRocm93IG5ldyBFcnJvcigoIkVOT0VOVCwgbm8gc3VjaCBmaWxlIG9yIGRpcmVjdG9yeSAoIiArIHB0aCArICIpIikpOyB9DQogICAgaW5zdGFuY2UuX2ZpbGUgPSBmOw0KICAgIHJldHVybiBpbnN0YW5jZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNjYW5kaXIocHRoKSB7DQogICAgcmV0dXJuIGdldFN0YXRzKHB0aCkuZ2V0Q2hpbGRyZW4oKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1rZGlyKHB0aCkgew0KICAgIHJldHVybiBfX0ZTTy5DcmVhdGVGb2xkZXIocHRoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1rZGlycyhwdGgpIHsNCiAgICB2YXIgZGlyID0gcHRoLA0KICAgICAgZGlycyA9IFtdOw0KICAgIHdoaWxlIChkaXIpIHsNCiAgICAgIGlmIChpc2RpcihkaXIpKSB7IGJyZWFrOyB9DQogICAgICBkaXJzLnB1c2goZGlyKTsNCiAgICAgIGRpciA9IGRpcm5hbWUoZGlyKTsNCiAgICB9DQogICAgdmFyIGkgPSBkaXJzLmxlbmd0aDsNCiAgICB3aGlsZSAoaS0tKSB7IG1rZGlyKGRpcnNbaV0pOyB9DQogIH0NCg0KICBmdW5jdGlvbiBybWRpcihwdGgpIHsNCiAgICByZXR1cm4gaXNkaXIocHRoKSAmJiBfX0ZTTy5EZWxldGVGb2xkZXIocHRoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlbW92ZSQxKHB0aCkgew0KICAgIHJldHVybiBpc2ZpbGUocHRoKSAmJiBfX0ZTTy5EZWxldGVGaWxlKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiBjb3B5ZmlsZShwdGgsIGRzdCwgb3cpIHsNCiAgICBpZiAoIWlzYWJzKGRzdCkpIHsgZHN0ID0gYWJzcGF0aChkaXJuYW1lKHB0aCkgKyBTRVAgKyBkc3QpOyB9DQogICAgaWYgKCFTRVBfUkVHRVhQX0VORC50ZXN0KGRzdCkpIHsgZHN0ICs9IFNFUDsgfQ0KICAgIGlmICghaXNkaXIoZHN0KSkgeyBta2RpcnMoZHN0KTsgfQ0KICAgIF9fRlNPLkNvcHlGaWxlKHB0aCwgZHN0LCBvdyB8fCBmYWxzZSk7DQogIH0NCg0KICBmdW5jdGlvbiByZXBsKHB0aCwgZHN0KSB7DQogICAgaWYgKCFpc2Ficyhkc3QpKSB7IGRzdCA9IGFic3BhdGgoZGlybmFtZShwdGgpICsgU0VQICsgZHN0KTsgfQ0KICAgIHZhciBkaXIgPSBkaXJuYW1lKGRzdCk7DQogICAgdmFyIG5hbWUgPSBiYXNlbmFtZShkc3QpOw0KICAgIGlmIChpc2ZpbGUoZHN0KSkgeyB0aHJvdyBuZXcgRXJyb3IoZHN0ICsgJyBpcyBleGlzdHMuIHJlcGwgZmFpZC4nKTsgfQ0KICAgIGlmICghaXNkaXIoZGlyKSkgeyBta2RpcnMoZGlyKTsgfQ0KICAgIGVsc2UgaWYgKGlzZGlyKGRzdCkpIHsgcm1kaXIoZHN0KTsgfQ0KICAgIHZhciBmID0gZ2V0U3RhdHMocHRoKTsNCiAgICBpZiAoZi5uYW1lICE9IG5hbWUpIHsgZi5uYW1lID0gbmFtZTsgfQ0KICAgIGlmIChmLmRpcm5hbWUgIT0gZGlyKSB7IGYubW92ZShkaXIpOyB9DQogIH0KCiAgZnVuY3Rpb24gc3RhdFN5bmMocHRoKSB7DQogICAgcmV0dXJuIGdldFN0YXRzKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiByZWFkZGlyU3luYyhwdGgpIHsNCiAgICByZXR1cm4gc2NhbmRpcihwdGgpLm1hcChmdW5jdGlvbiAoaXQpIHsgcmV0dXJuIGl0Lm5hbWU7IH0pOw0KICB9DQoNCiAgZnVuY3Rpb24gd2l0aFN0cmVhbShvcHRpb25zLCBmbikgew0KICAgIHZhciBzdCA9IG5ldyBBY3RpdmVYT2JqZWN0KCdBRE9EQi5TdHJlYW0nKSwNCiAgICAgIGZpbGUgPSBvcHRpb25zLmZpbGUsDQogICAgICBlbmNvZGluZyA9IG9wdGlvbnMuZW5jb2RpbmcsDQogICAgICBmbGFnID0gb3B0aW9ucy5mbGFnLA0KICAgICAgcnN0Ow0KICAgIHRyeSB7DQogICAgICBpZiAoZW5jb2RpbmcgPT0gJ2JpbmFyeScpIHsgc3QuVHlwZSA9IDE7IH0NCiAgICAgIGVsc2UgeyBzdC5DaGFyc2V0ID0gZW5jb2Rpbmc7IH0NCiAgICAgIHN0Lk9wZW4oKTsNCiAgICAgIGlmIChmbGFnID09ICdyJyB8fCBmbGFnID09ICdhJykgew0KICAgICAgICBpZiAoIWlzZmlsZShmaWxlKSkNCiAgICAgICAgICB7IHRocm93IG5ldyBFcnJvcigoIndpdGhTdHJlYW06IGZpbGUgbm90IGV4aXN0cy4gKCIgKyBmaWxlICsgIikiKSk7IH0NCiAgICAgICAgc3QuTG9hZEZyb21GaWxlKGZpbGUpOw0KICAgICAgfQ0KICAgICAgaWYgKGZsYWcgPT0gJ2EnKSB7IHN0LlBvc2l0aW9uID0gc3QuU2l6ZTsgfQ0KICAgICAgcnN0ID0gZm4oc3QpOw0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgIHRocm93IGU7DQogICAgfSBmaW5hbGx5IHsNCiAgICAgIHN0ICYmIHN0LlN0YXRlID09IDEgJiYgc3QuY2xvc2UoKTsNCiAgICB9DQogICAgcmV0dXJuIHJzdDsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNhdmVTdHJlYW0oc3QsIG9wdGlvbnMpIHsNCiAgICB2YXIgc2tpcExlbiA9IDAsDQogICAgICBmaWxlID0gb3B0aW9ucy5maWxlLA0KICAgICAgZW5jb2RpbmcgPSBvcHRpb25zLmVuY29kaW5nLnJlcGxhY2UoJy0nLCAnJykudG9Mb3dlckNhc2UoKTsNCiAgICBpZiAoZW5jb2RpbmcgPT0gJ3V0ZjgnIHx8IGVuY29kaW5nID09ICd1bmljb2RlJykgeyBza2lwTGVuID0gMzsgfQ0KICAgIGVsc2UgaWYgKGVuY29kaW5nID09ICd1ZnQxNicpIHsgc2tpcExlbiA9IDI7IH0NCiAgICBzdC5TZXRFT1MoKTsNCiAgICBpZiAoc2tpcExlbikgew0KICAgICAgc3QuUG9zaXRpb24gPSAwOw0KICAgICAgc3QuVHlwZSA9IDE7DQogICAgICBzdC5Qb3NpdGlvbiA9IHNraXBMZW47DQogICAgICB2YXIgYmluRGF0YSA9IHN0LlJlYWQoLTEpOw0KICAgICAgc3QuUG9zaXRpb24gPSAwOw0KICAgICAgc3QuV3JpdGUoYmluRGF0YSk7DQogICAgICBzdC5TZXRFT1MoKTsNCiAgICB9DQogICAgc3QuU2F2ZVRvRmlsZShmaWxlLCAyKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGluaXRBcmdzKGZpbGUsIG9wdGlvbnMpIHsNCiAgICB2YXIgdHAsIGVuY29kaW5nLCBmbGFnOw0KICAgIGlmICghaXNhYnMoZmlsZSkpIHsgdGhyb3cgbmV3IEVycm9yKCdmczogcmVsYXRpdmUgcGF0aCBpcyBub3Qgc3VwcG9ydGVkJyk7IH0NCiAgICB0cCA9IHR5cGVvZiBvcHRpb25zOw0KICAgIGlmICh0cCA9PSAnc3RyaW5nJykgew0KICAgICAgZW5jb2RpbmcgPSBvcHRpb25zOw0KICAgIH0gZWxzZSBpZiAodHAgPT0gJ29iamVjdCcpIHsNCiAgICAgIGlmIChvcHRpb25zLmVuY29kaW5nKSB7IGVuY29kaW5nID0gb3B0aW9ucy5lbmNvZGluZzsgfQ0KICAgICAgaWYgKG9wdGlvbnMuZmxhZykgeyBmbGFnID0gb3B0aW9ucy5mbGFnOyB9DQogICAgICBlbHNlIGlmIChvcHRpb25zLmZsYWdzKSB7IGZsYWcgPSBvcHRpb25zLmZsYWdzOyB9DQogICAgfQ0KICAgIGlmIChmbGFnICYmIGZsYWcubGVuZ3RoID4gMSkgeyBmbGFnID0gZmxhZy5jaGFyQXQoMCk7IH0NCiAgICByZXR1cm4geyBmaWxlOiBmaWxlLCBlbmNvZGluZzogZW5jb2RpbmcsIGZsYWc6IGZsYWcgfTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlYWRGaWxlU3luYyhmaWxlLCBvcHRpb25zKSB7DQogICAgdmFyIG9wdHMgPSBpbml0QXJncyhmaWxlLCBvcHRpb25zKTsNCiAgICBvcHRzLmZsYWcgPSAncic7DQogICAgaWYgKCFvcHRzLmVuY29kaW5nKSB7IG9wdHMuZW5jb2RpbmcgPSAnYmluYXJ5JzsgfQ0KICAgIHJldHVybiB3aXRoU3RyZWFtKG9wdHMsIGZ1bmN0aW9uKHN0KSB7DQogICAgICByZXR1cm4gb3B0cy5lbmNvZGluZyA9PSAnYmluYXJ5Jw0KICAgICAgICA/IEJ1ZmZlci5mcm9tKHN0LlJlYWQoLTEpKQ0KICAgICAgICA6IHN0LlJlYWRUZXh0KC0xKTsNCiAgICB9KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHdyaXRlRmlsZVN5bmMoZmlsZSwgZGF0YSwgb3B0aW9ucykgew0KICAgIHZhciBvcHRzID0gaW5pdEFyZ3MoZmlsZSwgb3B0aW9ucyksDQogICAgICBpc0J1ZmZlciA9IEJ1ZmZlci5pc0J1ZmZlcihkYXRhKTsNCiAgICBvcHRzLmZsYWcgPSAndyc7DQogICAgaWYgKGlzQnVmZmVyKSB7IG9wdHMuZW5jb2RpbmcgPSAnYmluYXJ5JzsgfQ0KICAgIGVsc2UgaWYgKCFvcHRzLmVuY29kaW5nKSB7IG9wdHMuZW5jb2RpbmcgPSAnVVRGLTgnOyB9DQogICAgd2l0aFN0cmVhbShvcHRzLCBmdW5jdGlvbiAoc3QpIHsNCiAgICAgIGlzQnVmZmVyID8gc3QuV3JpdGUoZGF0YS5idWZmZXIpIDogc3QuV3JpdGVUZXh0KGRhdGEpOw0KICAgICAgc2F2ZVN0cmVhbShzdCwgb3B0cyk7DQogICAgfSk7DQogIH0NCg0KICBmdW5jdGlvbiBhcHBlbmRGaWxlU3luYyhmaWxlLCBkYXRhLCBvcHRpb25zKSB7DQogICAgdmFyIG9wdHMgPSBpbml0QXJncyhmaWxlLCBvcHRpb25zKSwNCiAgICAgIGlzQnVmZmVyID0gQnVmZmVyLmlzQnVmZmVyKGRhdGEpOw0KICAgIG9wdHMuZmxhZyA9ICdhJzsNCiAgICBpZiAoaXNCdWZmZXIpIHsgb3B0cy5lbmNvZGluZyA9ICdiaW5hcnknOyB9DQogICAgZWxzZSBpZiAoIW9wdHMuZW5jb2RpbmcpIHsgb3B0cy5lbmNvZGluZyA9ICdVVEYtOCc7IH0NCiAgICB3aXRoU3RyZWFtKG9wdHMsIGZ1bmN0aW9uIChzdCkgew0KICAgICAgaXNCdWZmZXIgPyBzdC5Xcml0ZShkYXRhLmJ1ZmZlcikgOiBzdC5Xcml0ZVRleHQoZGF0YSk7DQogICAgICBzYXZlU3RyZWFtKHN0LCBvcHRzKTsNCiAgICB9KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1rZGlyU3luYyhwdGgsIG9wdGlvbnMpIHsNCiAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnJlY3Vyc2l2ZSkgeyBta2RpcnMocHRoKTsgfQ0KICAgIG1rZGlyKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiBjb3B5RmlsZVN5bmMoc3JjLCBkZXN0KSB7DQogICAgY29weWZpbGUoc3JjLCBkZXN0LCB0cnVlKTsNCiAgfQ0KDQogIC8vIGZzLWV4dHJhDQoNCiAgZnVuY3Rpb24gbWtkaXJzU3luYyhwdGgpIHsNCiAgICBta2RpcnMocHRoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGVuc3VyZURpclN5bmMocHRoKSB7DQogICAgaWYgKCFpc2RpcihwdGgpKSB7IG1rZGlycyhwdGgpOyB9DQogIH0NCg0KICBmdW5jdGlvbiBlbnN1cmVGaWxlU3luYyhmaWxlKSB7DQogICAgaWYgKCFpc2FicyhmaWxlKSkgeyBmaWxlID0gYWJzcGF0aChmaWxlKTsgfQ0KICAgIHZhciBkaXIgPSBkaXJuYW1lKGZpbGUpOw0KICAgIGlmICghaXNkaXIoZGlyKSkgeyBta2RpcnMoZGlyKTsgfQ0KICB9DQoNCiAgZnVuY3Rpb24gb3V0cHV0RmlsZVN5bmMoZmlsZSwgZGF0YSwgb3B0aW9ucykgew0KICAgIGlmICghaXNhYnMoZmlsZSkpIHsgZmlsZSA9IGFic3BhdGgoZmlsZSk7IH0NCiAgICBlbnN1cmVGaWxlU3luYyhmaWxlKTsNCiAgICB3cml0ZUZpbGVTeW5jKGZpbGUsIGRhdGEsIG9wdGlvbnMpOw0KICB9DQoNCiAgZnVuY3Rpb24gb3V0cHV0SnNvblN5bmMoZmlsZSwgb2JqLCBvcHRpb25zKSB7DQogICAgaWYgKCFpc2FicyhmaWxlKSkgeyBmaWxlID0gYWJzcGF0aChmaWxlKTsgfQ0KICAgIGVuc3VyZUZpbGVTeW5jKGZpbGUpOw0KICAgIHdyaXRlRmlsZVN5bmMoZmlsZSwgSlNPTi5zdHJpbmdpZnkob2JqKSwgb3B0aW9ucyk7DQogIH0NCg0KICB2YXIgb3V0cHV0SlNPTlN5bmMgPSBvdXRwdXRKc29uU3luYzsNCg0KICBmdW5jdGlvbiByZWFkSnNvblN5bmMoZmlsZSwgb3B0aW9ucykgew0KICAgIGlmICghaXNhYnMoZmlsZSkpIHsgZmlsZSA9IGFic3BhdGgoZmlsZSk7IH0NCiAgICBpZiAoIW9wdGlvbnMgfHwgKHR5cGVvZiBvcHRpb25zID09ICdvYmplY3QnICYmICFvcHRpb25zLmVuY29kaW5nKSkNCiAgICAgIHsgb3B0aW9ucyA9ICdVVEYtOCc7IH0NCiAgICB2YXIgZGF0YSA9IHJlYWRGaWxlU3luYyhmaWxlLCBvcHRpb25zKTsNCiAgICByZXR1cm4gSlNPTi5wYXJzZShkYXRhKTsNCiAgfQ0KDQogIHZhciByZWFkSlNPTlN5bmMgPSByZWFkSnNvblN5bmM7DQoNCiAgZnVuY3Rpb24gZW1wdHlEaXJTeW5jKGRpcikgew0KICAgIHNjYW5kaXIoZGlyKS5mb3JFYWNoKGZ1bmN0aW9uIChpdCkgeyByZXR1cm4gaXQuZGVsZXRlKHRydWUpOyB9KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlYWRMaW5lc1N5bmMoZmlsZSwgb3B0aW9ucykgew0KICAgIGlmICghaXNhYnMoZmlsZSkpIHsgZmlsZSA9IGFic3BhdGgoZmlsZSk7IH0NCiAgICB2YXIgb3B0cyA9IGluaXRBcmdzKGZpbGUsIG9wdGlvbnMpOw0KICAgIG9wdHMuZmxhZyA9ICdyJzsNCiAgICBpZiAoIW9wdHMuZW5jb2RpbmcpIHsgb3B0cy5lbmNvZGluZyA9ICdVVEYtOCc7IH0NCiAgICByZXR1cm4gd2l0aFN0cmVhbShvcHRzLCBmdW5jdGlvbihzdCkgew0KICAgICAgdmFyIGxpbmVzID0gW107DQogICAgICB3aGlsZSAoIXN0LkVPUykgeyBsaW5lcy5wdXNoKHN0LlJlYWRUZXh0KC0yKSk7IH0NCiAgICAgIHJldHVybiBsaW5lczsNCiAgICB9KTsNCiAgfQoKICB2YXIgZnMgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICBzdGF0U3luYzogc3RhdFN5bmMsCiAgICByZWFkZGlyU3luYzogcmVhZGRpclN5bmMsCiAgICByZWFkRmlsZVN5bmM6IHJlYWRGaWxlU3luYywKICAgIHdyaXRlRmlsZVN5bmM6IHdyaXRlRmlsZVN5bmMsCiAgICBhcHBlbmRGaWxlU3luYzogYXBwZW5kRmlsZVN5bmMsCiAgICBta2RpclN5bmM6IG1rZGlyU3luYywKICAgIGNvcHlGaWxlU3luYzogY29weUZpbGVTeW5jLAogICAgbWtkaXJzU3luYzogbWtkaXJzU3luYywKICAgIGVuc3VyZURpclN5bmM6IGVuc3VyZURpclN5bmMsCiAgICBlbnN1cmVGaWxlU3luYzogZW5zdXJlRmlsZVN5bmMsCiAgICBvdXRwdXRGaWxlU3luYzogb3V0cHV0RmlsZVN5bmMsCiAgICBvdXRwdXRKc29uU3luYzogb3V0cHV0SnNvblN5bmMsCiAgICBvdXRwdXRKU09OU3luYzogb3V0cHV0SlNPTlN5bmMsCiAgICByZWFkSnNvblN5bmM6IHJlYWRKc29uU3luYywKICAgIHJlYWRKU09OU3luYzogcmVhZEpTT05TeW5jLAogICAgZW1wdHlEaXJTeW5jOiBlbXB0eURpclN5bmMsCiAgICByZWFkTGluZXNTeW5jOiByZWFkTGluZXNTeW5jLAogICAgZXhpc3RzU3luYzogZXhpc3RzLAogICAgcmVuYW1lU3luYzogcmVwbCwKICAgIHJtZGlyU3luYzogcm1kaXIsCiAgICB1bmxpbmtTeW5jOiByZW1vdmUkMQogIH0pOwoKICB2YXIgUEFSU0VfUkVHID0gL14oW0EtWmEtel06Wy9cXF18Wy9cXF18KSg/OihbXj8jXSopWy9cXF18KShbXi9cXD8jXSo/KShbLl1bXi4/I10rfCkkLzsNCiAgdmFyIENBUFRVUkUgPSBbJ3BhdGgnLCAncm9vdCcsICdkaXInLCAnbmFtZScsICdleHQnXTsNCg0KICBmdW5jdGlvbiBwYXJzZShwdGgpIHsNCiAgICBwdGggfHwgKHB0aCA9ICcnKTsNCiAgICB2YXIgbWF0Y2ggPSBwdGgubWF0Y2goUEFSU0VfUkVHKTsNCiAgICB2YXIgcmVzdWx0ID0gQ0FQVFVSRS5yZWR1Y2UoZnVuY3Rpb24obWVtbywgbmFtZSwgaW5kZXgpIHsNCiAgICAgIG1lbW9bbmFtZV0gPSBtYXRjaFtpbmRleF07DQogICAgICByZXR1cm4gbWVtbzsNCiAgICB9LCB7fSk7DQogICAgcmVzdWx0LmJhc2UgPSByZXN1bHQubmFtZSArIHJlc3VsdC5leHQ7DQogICAgcmVzdWx0LmRpcm5hbWUgPSByZXN1bHQucm9vdCArIHJlc3VsdC5kaXI7DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfQ0KDQogIHZhciBkZWxpbWl0ZXIgPSAnOyc7CgogIHZhciBQYXRoID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgcGFyc2U6IHBhcnNlLAogICAgZGVsaW1pdGVyOiBkZWxpbWl0ZXIsCiAgICBzZXA6IHNlcCwKICAgIGRpcm5hbWU6IGRpcm5hbWUsCiAgICBiYXNlbmFtZTogYmFzZW5hbWUsCiAgICBleHRuYW1lOiBleHRuYW1lLAogICAgaXNBYnNvbHV0ZTogaXNBYnNvbHV0ZSwKICAgIG5vcm1hbGl6ZTogbm9ybWFsaXplLAogICAgam9pbjogam9pbiwKICAgIHJlc29sdmU6IHJlc29sdmUsCiAgICByZWxhdGl2ZTogcmVsYXRpdmUKICB9KTsKCiAgaWYgKCFPYmplY3QuYXNzaWduKSB7DQogICAgT2JqZWN0LmFzc2lnbiA9IGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuIGFwcGx5KGFzc2lnbiwgbnVsbCwgYXJndW1lbnRzKTsNCiAgICB9Ow0KICB9DQoNCiAgaWYgKCFPYmplY3QudmFsdWVzKSB7DQogICAgT2JqZWN0LnZhbHVlcyA9IHZhbHVlczsNCiAgfQ0KDQogIGZ1bmN0aW9uIGRlZmluZU1ldGhvZHModGFyZ2V0LCBmdW5jRGljdCkgew0KICAgIHZhciBwcm9wcyA9IHt9Ow0KICAgIGZvciAodmFyIGtleSBpbiBmdW5jRGljdCkgew0KICAgICAgaWYgKCF0YXJnZXRba2V5XSkgew0KICAgICAgICBwcm9wc1trZXldID0gew0KICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlLA0KICAgICAgICAgIHZhbHVlOiBmdW5jRGljdFtrZXldDQogICAgICAgIH07DQogICAgICB9DQogICAgfQ0KICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpOw0KICB9DQoNCiAgZGVmaW5lTWV0aG9kcyhBcnJheS5wcm90b3R5cGUsIHsNCiAgICBpbmNsdWRlczogZnVuY3Rpb24odmFsLCBzdGFydCkgew0KICAgICAgcmV0dXJuIGluY2x1ZGVzKHRoaXMsIHZhbCwgc3RhcnQpOw0KICAgIH0sDQogICAgZmluZDogZnVuY3Rpb24oZm4sIF90aGlzKSB7DQogICAgICByZXR1cm4gZmluZCh0aGlzLCBmbiwgX3RoaXMpWzBdOw0KICAgIH0sDQogICAgZmluZEluZGV4OiBmdW5jdGlvbihmbiwgX3RoaXMpIHsNCiAgICAgIHJldHVybiBmaW5kSW5kZXgodGhpcywgZm4sIF90aGlzKVsxXTsNCiAgICB9LA0KICAgIGZpbGw6IGZ1bmN0aW9uKHZhbCwgc3RhcnQsIGVuZCkgew0KICAgICAgcmV0dXJuIGZpbGwodGhpcywgdmFsLCBzdGFydCwgZW5kKTsNCiAgICB9DQogIH0pOw0KDQogIGRlZmluZU1ldGhvZHMoU3RyaW5nLnByb3RvdHlwZSwgew0KICAgIHJlcGVhdDogZnVuY3Rpb24obikgew0KICAgICAgcmV0dXJuIHJlcGVhdCh0aGlzLCBuKTsNCiAgICB9LA0KICAgIHN0YXJ0c1dpdGg6IGZ1bmN0aW9uKHRhcmdldCwgcG9zKSB7DQogICAgICByZXR1cm4gc3RhcnRzV2l0aCh0aGlzLCB0YXJnZXQsIHBvcyk7DQogICAgfSwNCiAgICBlbmRzV2l0aDogZnVuY3Rpb24odGFyZ2V0LCB0aGlzX2xlbikgew0KICAgICAgcmV0dXJuIGVuZHNXaXRoKHRoaXMsIHRhcmdldCwgdGhpc19sZW4pOw0KICAgIH0sDQogICAgaW5jbHVkZXM6IGZ1bmN0aW9uKHRhcmdldCwgcG9zKSB7DQogICAgICByZXR1cm4gaW5jbHVkZXModGhpcywgdGFyZ2V0LCBwb3MpOw0KICAgIH0sDQogICAgcGFkU3RhcnQ6IGZ1bmN0aW9uKGxlbiwgY2hycykgew0KICAgICAgcmV0dXJuIHBhZFN0YXJ0KHRoaXMsIGxlbiwgY2hycyk7DQogICAgfSwNCiAgICBwYWRFbmQ6IGZ1bmN0aW9uKGxlbiwgY2hycykgew0KICAgICAgcmV0dXJuIHBhZEVuZCh0aGlzLCBsZW4sIGNocnMpOw0KICAgIH0NCiAgfSk7DQoNCiAgaWYgKCFTdHJpbmcucmF3KSB7DQogICAgU3RyaW5nLnJhdyA9IGZ1bmN0aW9uKGNhbGxTaXRlKSB7CiAgICAgIHZhciBhcmd1bWVudHMkMSA9IGFyZ3VtZW50czsKDQogICAgICB2YXIgaSA9IDAsDQogICAgICAgIGJ1ZiA9IFtdLA0KICAgICAgICBzdHJzID0gY2FsbFNpdGUucmF3LA0KICAgICAgICBsZW4gPSBzdHJzLmxlbmd0aCwNCiAgICAgICAgYXJnc0NudCA9IGFyZ3VtZW50cy5sZW5ndGg7DQogICAgICB3aGlsZSAoaSA8IGxlbikgew0KICAgICAgICBidWYucHVzaChzdHJzW2krK10pOw0KICAgICAgICBpZiAoaSA8IGFyZ3NDbnQgJiYgaSA8IGxlbikgew0KICAgICAgICAgIGJ1Zi5wdXNoKGFyZ3VtZW50cyQxW2ldKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIGJ1Zi5qb2luKCcnKTsNCiAgICB9Ow0KICB9DQoNCiAgd2luZG93Ll9fZmlsZW5hbWUgPSBXU2NyaXB0LlNjcmlwdEZ1bGxOYW1lOw0KICB3aW5kb3cuX19kaXJuYW1lID0gX19maWxlbmFtZS5tYXRjaCgvKC4qKVtcXC9dLylbMV07DQoNCiAgZnVuY3Rpb24gZGVmaW5lR2V0dGVyKHRhcmdldCwgZnVuY0RpY3QpIHsNCiAgICB2YXIgcHJvcHMgPSB7fTsNCiAgICBmb3IgKHZhciBrZXkgaW4gZnVuY0RpY3QpIHsNCiAgICAgIGlmICghdGFyZ2V0W2tleV0pIHsNCiAgICAgICAgcHJvcHNba2V5XSA9IHsNCiAgICAgICAgICBnZXQ6IGZ1bmNEaWN0W2tleV0NCiAgICAgICAgfTsNCiAgICAgIH0NCiAgICB9DQogICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcyk7DQogIH0NCg0KICB2YXIgX3ZicywgX3NoZWxsLCBfZnNvLCBfc2hlbGxfYXBwOw0KDQogIGRlZmluZUdldHRlcih3aW5kb3csIHsNCiAgICBfX1ZCUzogZnVuY3Rpb24oKSB7DQogICAgICBpZiAoIV92YnMpIHsNCiAgICAgICAgX3ZicyA9IG5ldyBBY3RpdmVYT2JqZWN0KCdTY3JpcHRDb250cm9sJyk7DQogICAgICAgIF92YnMuTGFuZ3VhZ2UgPSAnVkJTY3JpcHQnOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIF92YnM7DQogICAgfSwNCiAgICBfX1dTaGVsbDogZnVuY3Rpb24oKSB7DQogICAgICByZXR1cm4gX3NoZWxsIHx8IChfc2hlbGwgPSBuZXcgQWN0aXZlWE9iamVjdCgnV1NjcmlwdC5TaGVsbCcpKTsNCiAgICB9LA0KICAgIF9fRlNPOiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiBfZnNvIHx8IChfZnNvID0gbmV3IEFjdGl2ZVhPYmplY3QoJ1NjcmlwdGluZy5GaWxlU3lzdGVtT2JqZWN0JykpOw0KICAgIH0sDQogICAgX19TaGVsbEFwcDogZnVuY3Rpb24oKSB7DQogICAgICByZXR1cm4gX3NoZWxsX2FwcCB8fCAoX3NoZWxsX2FwcCA9IG5ldyBBY3RpdmVYT2JqZWN0KCdTaGVsbC5BcHBsaWNhdGlvbicpKTsNCiAgICB9DQogIH0pOw0KDQogIGZ1bmN0aW9uIGxvZyQxKG1zZykgewogICAgaWYgKCBtc2cgPT09IHZvaWQgMCApIG1zZyA9ICcnOwoNCiAgICBXU2NyaXB0LkVjaG8obXNnKTsNCiAgfQ0KDQogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGZ1bmN0aW9uKCkgew0KICAgIHZhciBzY3JpcHRzID0gZG9jdW1lbnQuc2NyaXB0czsNCiAgICB2YXIgaSA9IC0xLA0KICAgICAgbGVuID0gc2NyaXB0cy5sZW5ndGg7DQogICAgdmFyIG5hbWUgPSBiYXNlbmFtZShfX2ZpbGVuYW1lKS5yZXBsYWNlKC9cLlteLl0rJC8sICcnKTsNCiAgICB2YXIgZmlsZSwgZm9sZGVyOw0KICAgIGZvbGRlciA9IGpvaW4oX19kaXJuYW1lLCBuYW1lICsgJ19zcmMnKTsNCiAgICBpZiAoIWlzZGlyKGZvbGRlcikpIHsgbWtkaXJzU3luYyhmb2xkZXIpOyB9DQogICAgbG9nJDEoKTsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICBmaWxlID0gam9pbihmb2xkZXIsIGkgKyAnLmpzJyk7DQogICAgICBvdXRwdXRGaWxlU3luYyhmaWxlLCBzY3JpcHRzW2ldLnRleHQpOw0KICAgICAgbG9nJDEoKCJzb3VyY2UgIiArIGkgKyAiOiAiICsgZmlsZSkpOw0KICAgIH0NCiAgfSk7CgogIGZ1bmN0aW9uIGV4ZWNTeW5jKGNtZCkgew0KICAgIHZhciBwcm9jID0gX19XU2hlbGwuRXhlYyhjbWQpOw0KICAgIGZvciAoOzspIHsNCiAgICAgIGlmIChwcm9jLlN0YXRlcyAhPT0gMCkgeyBicmVhazsgfQ0KICAgIH0NCiAgICBpZiAoIXByb2MuU3RkT3V0LkF0RW5kT2ZTdHJlYW0pIHsNCiAgICAgIHJldHVybiBwcm9jLlN0ZE91dC5SZWFkQWxsKCk7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gZXhlYyhjbWQsIGZ1bmMpIHsNCiAgICB2YXIgcHJvYywgc3Rkb3V0LCBzdGRlcnI7DQogICAgdHJ5IHsNCiAgICAgIHByb2MgPSBfX1dTaGVsbC5FeGVjKGNtZCk7DQogICAgICBmb3IgKDs7KSB7DQogICAgICAgIGlmIChwcm9jLlN0YXRlcyAhPT0gMCkgeyBicmVhazsgfQ0KICAgICAgfQ0KICAgICAgaWYgKGlzRnVuY3Rpb24oZnVuYykpIHsNCiAgICAgICAgaWYgKCFwcm9jLlN0ZE91dC5BdEVuZE9mU3RyZWFtKSB7DQogICAgICAgICAgc3Rkb3V0ID0gcHJvYy5TdGRPdXQuUmVhZEFsbCgpOw0KICAgICAgICB9DQogICAgICAgIGlmICghcHJvYy5TdGRFcnIuQXRFbmRPZlN0cmVhbSkgew0KICAgICAgICAgIHN0ZGVyciA9IHByb2MuU3RkRXJyLlJlYWRBbGwoKTsNCiAgICAgICAgfQ0KICAgICAgICBmdW5jKG51bGwsIHN0ZG91dCwgc3RkZXJyKTsNCiAgICAgIH0NCiAgICB9IGNhdGNoIChlKSB7DQogICAgICBpZiAoaXNGdW5jdGlvbihmdW5jKSkgew0KICAgICAgICBmdW5jKGUsIG51bGwsIG51bGwpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhyb3cgZTsNCiAgICAgIH0NCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBydW4oY21kLCBvcHRpb25zKSB7DQogICAgdmFyIGludFdpbmRvd1N0eWxlID0gMSwNCiAgICAgIGJXYWl0T25SZXR1cm4gPSB0cnVlOw0KICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7DQogICAgaWYgKG9wdGlvbnMuaGlkZSA9PT0gZmFsc2UgfHwgb3B0aW9ucy5oaWRkZW4gPT09IGZhbHNlKSB7IGludFdpbmRvd1N0eWxlID0gMDsgfQ0KICAgIGlmIChvcHRpb25zLndhaXQgPT09IGZhbHNlKSB7IGJXYWl0T25SZXR1cm4gPSBmYWxzZTsgfQ0KICAgIHJldHVybiBfX1dTaGVsbC5SdW4oY21kLCBpbnRXaW5kb3dTdHlsZSwgYldhaXRPblJldHVybik7DQogIH0KCiAgdmFyIGNoaWxkX3Byb2Nlc3MgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICBleGVjU3luYzogZXhlY1N5bmMsCiAgICBleGVjOiBleGVjLAogICAgcnVuOiBydW4KICB9KTsKCiAgdmFyIGVzY2FwZSA9IGVuY29kZVVSSUNvbXBvbmVudDsNCg0KICB2YXIgdW5lc2NhcGUgPSBkZWNvZGVVUklDb21wb25lbnQ7DQoNCiAgZnVuY3Rpb24gZm9ybWF0VmFsdWUkMSh2YWx1ZSkgew0KICAgIHN3aXRjaCAodHlwZW9mIHZhbHVlKSB7DQogICAgICBjYXNlICdzdHJpbmcnOg0KICAgICAgICByZXR1cm4gZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKTsNCiAgICAgIGNhc2UgJ251bWJlcic6DQogICAgICBjYXNlICdib29sZWFuJzoNCiAgICAgICAgcmV0dXJuIFN0cmluZyh2YWx1ZSk7DQogICAgICBkZWZhdWx0Og0KICAgICAgICByZXR1cm4gJyc7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gc3RyaW5naWZ5KG9iaiwgc2VwLCBlcSkgew0KICAgIGlmICghb2JqKSB7IHJldHVybiAnJzsgfQ0KICAgIHNlcCB8fCAoc2VwID0gJyYnKTsNCiAgICBlcSB8fCAoZXEgPSAnPScpOw0KICAgIHZhciBidWYgPSBbXSwNCiAgICAgIHZhbHVlLA0KICAgICAgaSwNCiAgICAgIGxlbjsNCiAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7DQogICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KGtleSkpIHsNCiAgICAgICAgdmFsdWUgPSBvYmpba2V5XTsNCiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7DQogICAgICAgICAgKGkgPSAtMSksIChsZW4gPSB2YWx1ZS5sZW5ndGgpOw0KICAgICAgICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgICAgICAgIGJ1Zi5wdXNoKGtleSArIGVxICsgZm9ybWF0VmFsdWUkMSh2YWx1ZVtpXSkpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBidWYucHVzaChrZXkgKyBlcSArIGZvcm1hdFZhbHVlJDEodmFsdWUpKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gYnVmLmpvaW4oc2VwKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHBhcnNlJDEoc3RyLCBzZXAsIGVxKSB7DQogICAgc2VwIHx8IChzZXAgPSAnJicpOw0KICAgIGVxIHx8IChlcSA9ICc9Jyk7DQogICAgdmFyIGJ1ZiA9IHN0ci5zcGxpdChzZXApOw0KICAgIHZhciBpID0gLTEsDQogICAgICBsZW4gPSBidWYubGVuZ3RoLA0KICAgICAgcmVzdWx0ID0ge30sDQogICAgICBrZXlEaWN0ID0ge30sDQogICAgICBwYWlyLA0KICAgICAga2V5LA0KICAgICAgdmFsdWU7DQogICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgcGFpciA9IGJ1ZltpXS5zcGxpdChlcSk7DQogICAgICBrZXkgPSBwYWlyWzBdOw0KICAgICAgdmFsdWUgPSBwYWlyWzFdOw0KICAgICAgaWYgKGtleURpY3Rba2V5XSkgew0KICAgICAgICBpZiAoa2V5RGljdFtrZXldID09PSAxKSB7DQogICAgICAgICAga2V5RGljdFtrZXldID0gMjsNCiAgICAgICAgICByZXN1bHRba2V5XSA9IFtyZXN1bHRba2V5XSwgdmFsdWVdOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJlc3VsdFtrZXldLnB1c2godmFsdWUpOw0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICBrZXlEaWN0W2tleV0gPSAxOw0KICAgICAgICByZXN1bHRba2V5XSA9IHZhbHVlOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9CgogIHZhciBxdWVyeXN0cmluZyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgIGVzY2FwZTogZXNjYXBlLAogICAgdW5lc2NhcGU6IHVuZXNjYXBlLAogICAgc3RyaW5naWZ5OiBzdHJpbmdpZnksCiAgICBwYXJzZTogcGFyc2UkMQogIH0pOwoKICB2YXIgQklOX1RZUEVTID0gWydhcnJheWJ1ZmZlcicsICdibG9iJ107DQoNCiAgZnVuY3Rpb24gcmVxdWVzdChvcHRpb25zKSB7DQogICAgdmFyIGh0dHAsIHVyaSwgbWV0aG9kLCB0aW1lb3V0Ow0KICAgIGh0dHAgPSBuZXcgQWN0aXZlWE9iamVjdCgnV2luSHR0cC5XaW5IdHRwUmVxdWVzdC41LjEnKTsNCiAgICB1cmkgPSBvcHRpb25zLnVyaSB8fCBvcHRpb25zLnVybCB8fCBvcHRpb25zLnBhdGg7DQogICAgbWV0aG9kID0gKG9wdGlvbnMubWV0aG9kIHx8ICdHRVQnKS50b1VwcGVyQ2FzZSgpOw0KICAgIHRpbWVvdXQgPSBvcHRpb25zLnRpbWVvdXQgfHwgMzAwMDsNCiAgICBodHRwLnNldFRpbWVvdXRzKHRpbWVvdXQsIHRpbWVvdXQsIHRpbWVvdXQsIHRpbWVvdXQpOw0KDQogICAgdHJ5IHsNCiAgICAgIHZhciBkYXRhID0gb3B0aW9ucy5mb3JtIHx8IG9wdGlvbnMuZGF0YSB8fCBudWxsOw0KICAgICAgaWYgKGRhdGEgJiYgdHlwZW9mIGRhdGEgIT09ICdzdHJpbmcnKSB7IGRhdGEgPSBzdHJpbmdpZnkoZGF0YSk7IH0NCiAgICAgIGlmIChkYXRhKSB7DQogICAgICAgIGlmIChtZXRob2QgPT09ICdHRVQnKSB7DQogICAgICAgICAgaHR0cC5vcGVuKG1ldGhvZCwgdXJpICsgJz8nICsgZGF0YSwgZmFsc2UpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGh0dHAub3BlbihtZXRob2QsIHVyaSwgZmFsc2UpOw0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICBodHRwLm9wZW4obWV0aG9kLCB1cmksIGZhbHNlKTsNCiAgICAgIH0NCiAgICAgIGFwcGx5T3B0aW9ucyhodHRwLCBvcHRpb25zKTsNCiAgICAgIGh0dHAuc2VuZChkYXRhKTsNCg0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgc3RhdHVzQ29kZTogaHR0cC5zdGF0dXMsDQogICAgICAgIGhlYWRlcnM6IHBhcnNlSGVhZGVycyhodHRwLmdldEFsbFJlc3BvbnNlSGVhZGVycygpKSwNCiAgICAgICAgYm9keTogQklOX1RZUEVTLmluY2x1ZGVzKG9wdGlvbnMucmVzcG9uc2VUeXBlKQ0KICAgICAgICAgID8gQnVmZmVyLmZyb20oaHR0cC5SZXNwb25zZUJvZHkpDQogICAgICAgICAgOiBodHRwLlJlc3BvbnNlVGV4dA0KICAgICAgfTsNCiAgICB9IGNhdGNoIChlKSB7DQogICAgICB0aHJvdyBlOw0KICAgIH0NCiAgfQ0KICAvKg0KICBXaW5IdHRwUmVxdWVzdE9wdGlvbg0KICAgIFVzZXJBZ2VudFN0cmluZyA9IDANCiAgICBVUkwgPSAxDQogICAgVVJMQ29kZVBhZ2UgPSAyDQogICAgRXNjYXBlUGVyY2VudEluVVJMID0gMw0KICAgIFNzbEVycm9ySWdub3JlRmxhZ3MgPSA0DQogICAgU2VsZWN0Q2VydGlmaWNhdGUgPSA1DQogICAgRW5hYmxlUmVkaXJlY3RzID0gNg0KICAgIFVybEVzY2FwZURpc2FibGUgPSA3DQogICAgVXJsRXNjYXBlRGlzYWJsZVF1ZXJ5ID0gOA0KICAgIFNlY3VyZVByb3RvY29scyA9IDkNCiAgICBFbmFibGVUcmFjaW5nID0gMTANCiAgICBSZXZlcnRJbXBlcnNvbmF0aW9uT3ZlclNzbCA9IDExDQogICAgRW5hYmxlSHR0cHNUb0h0dHBSZWRpcmVjdHMgPSAxMg0KICAgIEVuYWJsZVBhc3Nwb3J0QXV0aGVudGljYXRpb24gPSAxMw0KICAgIE1heEF1dG9tYXRpY1JlZGlyZWN0cyA9IDE0DQogICAgTWF4UmVzcG9uc2VIZWFkZXJTaXplID0gMTUNCiAgICBNYXhSZXNwb25zZURyYWluU2l6ZSA9IDE2DQogICAgRW5hYmxlSHR0cDFfMSA9IDE3DQogICAgRW5hYmxlQ2VydGlmaWNhdGVSZXZvY2F0aW9uQ2hlY2sgPSAxOA0KICAqLw0KICB2YXIgc2V0UmVxT3B0cyA9IEZ1bmN0aW9uKA0KICAgICdodHRwJywNCiAgICAiXG5odHRwLk9wdGlvbigwKSA9ICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjE7IFRyaWRlbnQvNy4wOyBydjoxMS4wKSBsaWtlIEdlY2tvJztcbmh0dHAuT3B0aW9uKDQpID0gMTMwNTY7XG5odHRwLk9wdGlvbig2KSA9IGZhbHNlOyINCiAgKTsNCg0KICBmdW5jdGlvbiBhcHBseU9wdGlvbnMoaHR0cCwgb3B0aW9ucykgew0KICAgIGlmIChvcHRpb25zLnByb3h5KSB7DQogICAgICBzZXRSZXFPcHRzKGh0dHApOw0KICAgICAgaHR0cC5zZXRQcm94eSgnMicsIG9wdGlvbnMucHJveHkpOw0KICAgICAgLy8gaHR0cC5TZXRDbGllbnRDZXJ0aWZpY2F0ZSgiTE9DQUxfTUFDSElORVxQZXJzb25hbFxNeSBDZXJ0aWZpY2F0ZSIpDQogICAgICAvLyBodHRwLlNldENyZWRlbnRpYWxzKCd1c2VyJywgJ3Bhc3MnLCAxKTsNCiAgICB9DQoNCiAgICBpZiAob3B0aW9ucy5tZXRob2QgIT09ICdHRVQnKSB7DQogICAgICBodHRwLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnKTsNCiAgICB9DQoNCiAgICB2YXIgaGVhZGVycyA9IG9wdGlvbnMuaGVhZGVyczsNCiAgICBpZiAoaGVhZGVycykgew0KICAgICAgZm9yICh2YXIga2V5IGluIGhlYWRlcnMpIHsNCiAgICAgICAgaWYgKGtleS50b0xvd2VyQ2FzZSgpID09ICdjb29raWUnKSB7DQogICAgICAgICAgaHR0cC5zZXRSZXF1ZXN0SGVhZGVyKCdDb29raWUnLCAnc3RyaW5nJyk7DQogICAgICAgICAgaHR0cC5zZXRSZXF1ZXN0SGVhZGVyKCdDb29raWUnLCBoZWFkZXJzW2tleV0pOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGh0dHAuc2V0UmVxdWVzdEhlYWRlcihrZXksIGhlYWRlcnNba2V5XSk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBwYXJzZUhlYWRlcnMoc3RyX2hlYWRlcnMpIHsNCiAgICB2YXIgcmVzdWx0ID0ge30sDQogICAgICBoZWFkZXJzLA0KICAgICAgaSwNCiAgICAgIGssDQogICAgICB2Ow0KICAgIGhlYWRlcnMgPSBzdHJfaGVhZGVycy50cmltKCkuc3BsaXQoL1xyP1xuLyk7DQogICAgaGVhZGVycy5mb3JFYWNoKGZ1bmN0aW9uIChoZWFkZXIpIHsNCiAgICAgIGkgPSBoZWFkZXIuaW5kZXhPZignOicpOw0KICAgICAgayA9IGhlYWRlci5zbGljZSgwLCBpKS50cmltKCk7DQogICAgICB2ID0gaGVhZGVyLnNsaWNlKGkgKyAxKS50cmltKCk7DQogICAgICBpZiAoay50b0xvd2VyQ2FzZSgpID09ICdzZXQtY29va2llJykgew0KICAgICAgICBpZiAocmVzdWx0W2tdKSB7IHJlc3VsdFtrXS5wdXNoKHYpOyB9DQogICAgICAgIGVsc2UgeyByZXN1bHRba10gPSBbdl07IH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJlc3VsdFtrXSA9IHY7DQogICAgICB9DQogICAgfSk7DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGdldE9wdGlvbihhcmdzKSB7DQogICAgdmFyIG9wdGlvbnM7DQogICAgaWYgKHR5cGVvZiBhcmdzWzBdID09PSAnc3RyaW5nJykgew0KICAgICAgb3B0aW9ucyA9IGFyZ3NbMV0gfHwge307DQogICAgICBvcHRpb25zLnVyaSA9IGFyZ3NbMF07DQogICAgfSBlbHNlIHsNCiAgICAgIG9wdGlvbnMgPSBhcmdzWzBdIHx8IHt9Ow0KICAgIH0NCiAgICByZXR1cm4gb3B0aW9uczsNCiAgfQ0KDQogIHZhciBodHRwID0gew0KICAgIHJlcXVlc3Q6IGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuIHJlcXVlc3QoZ2V0T3B0aW9uKGFyZ3VtZW50cykpOw0KICAgIH0sDQogICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgIHZhciBvcHRpb25zID0gZ2V0T3B0aW9uKGFyZ3VtZW50cyk7DQogICAgICBvcHRpb25zLm1ldGhvZCA9ICdHRVQnOw0KICAgICAgcmV0dXJuIHJlcXVlc3Qob3B0aW9ucyk7DQogICAgfSwNCiAgICBwb3N0OiBmdW5jdGlvbigpIHsNCiAgICAgIHZhciBvcHRpb25zID0gZ2V0T3B0aW9uKGFyZ3VtZW50cyk7DQogICAgICBvcHRpb25zLm1ldGhvZCA9ICdQT1NUJzsNCiAgICAgIHJldHVybiByZXF1ZXN0KG9wdGlvbnMpOw0KICAgIH0NCiAgfTsKCiAgdmFyIGh0dHAkMSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgICdkZWZhdWx0JzogaHR0cAogIH0pOwoKICBmdW5jdGlvbiBfY2lwaGVyKGVuYywgYnVmX3Bhc3N3b3JkLCBidWZfZGF0YSkgew0KICAgIHZhciBjcnlwdCA9IG5ldyBBY3RpdmVYT2JqZWN0KCdTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5LlJpam5kYWVsTWFuYWdlZCcpOw0KICAgIHZhciBrZXlIYXNoID0gbmV3IEFjdGl2ZVhPYmplY3QoJ1N5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHkuU0hBMjU2TWFuYWdlZCcpOw0KICAgIGtleUhhc2guQ29tcHV0ZUhhc2hfMihidWZfcGFzc3dvcmQuYnVmZmVyKTsNCiAgICBjcnlwdC5LZXkgPSBrZXlIYXNoLkhhc2g7DQogICAga2V5SGFzaC5DbGVhcigpOw0KDQogICAgdmFyIGl2SGFzaCA9IG5ldyBBY3RpdmVYT2JqZWN0KA0KICAgICAgJ1N5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHkuTUQ1Q3J5cHRvU2VydmljZVByb3ZpZGVyJw0KICAgICk7DQogICAgaXZIYXNoLkNvbXB1dGVIYXNoXzIoYnVmX3Bhc3N3b3JkLmJ1ZmZlcik7DQogICAgY3J5cHQuSVYgPSBpdkhhc2guSGFzaDsNCiAgICBpdkhhc2guQ2xlYXIoKTsNCg0KICAgIHZhciBkc3QgPSBudWxsOw0KICAgIHZhciB0cyA9IGVuYyA/IGNyeXB0LkNyZWF0ZUVuY3J5cHRvcigpIDogY3J5cHQuQ3JlYXRlRGVjcnlwdG9yKCk7DQogICAgdHJ5IHsNCiAgICAgIGRzdCA9IHRzLlRyYW5zZm9ybUZpbmFsQmxvY2soYnVmX2RhdGEuYnVmZmVyLCAwLCBidWZfZGF0YS5sZW5ndGgpOw0KICAgIH0gZmluYWxseSB7DQogICAgICBjcnlwdC5DbGVhcigpOw0KICAgIH0NCiAgICByZXR1cm4gZHN0Ow0KICB9DQoNCiAgdmFyIENpcGhlciA9IGZ1bmN0aW9uIENpcGhlcihhbGdvcml0aG0sIHBhc3N3b3JkLCBpc0VuY29kZSkgew0KICAgIHRoaXMuYWxnb3JpdGhtID0gYWxnb3JpdGhtOw0KICAgIHRoaXMucGFzc3dvcmQgPSBwYXNzd29yZDsNCiAgICB0aGlzLmlzRW5jb2RlID0gaXNFbmNvZGU7DQogICAgdGhpcy5kYXRhID0gbnVsbDsNCiAgICB0aGlzLmlucHV0RW5jb2RpbmcgPSBudWxsOw0KICAgIHRoaXMub3V0cHV0RW5jb2RpbmcgPSBudWxsOw0KICB9Ow0KDQogIENpcGhlci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gdXBkYXRlIChkYXRhLCBpbnB1dEVuY29kaW5nLCBvdXRwdXRFbmNvZGluZykgew0KICAgIHRoaXMuZGF0YSA9IGRhdGE7DQogICAgaWYgKGlucHV0RW5jb2RpbmcpIHsgdGhpcy5pbnB1dEVuY29kaW5nID0gaW5wdXRFbmNvZGluZzsgfQ0KICAgIGlmIChvdXRwdXRFbmNvZGluZykgeyB0aGlzLm91dHB1dEVuY29kaW5nID0gb3V0cHV0RW5jb2Rpbmc7IH0NCiAgICByZXR1cm4gdGhpczsNCiAgfTsNCg0KICBDaXBoZXIucHJvdG90eXBlLmZpbmFsID0gZnVuY3Rpb24gZmluYWwgKG91dHB1dEVuY29kaW5nKSB7DQogICAgaWYgKG91dHB1dEVuY29kaW5nKSB7IHRoaXMub3V0cHV0RW5jb2RpbmcgPSBvdXRwdXRFbmNvZGluZzsgfQ0KICAgIHZhciBieXRlcyA9IF9jaXBoZXIoDQogICAgICB0aGlzLmlzRW5jb2RlLA0KICAgICAgQnVmZmVyLmZyb20odGhpcy5wYXNzd29yZCksDQogICAgICBCdWZmZXIuZnJvbSh0aGlzLmRhdGEsIHRoaXMuaW5wdXRFbmNvZGluZykNCiAgICApOw0KICAgIGlmICh0aGlzLm91dHB1dEVuY29kaW5nID09IG51bGwgfHwgdGhpcy5vdXRwdXRFbmNvZGluZyA9PSAnYmluYXJ5Jykgew0KICAgICAgcmV0dXJuIEJ1ZmZlci5mcm9tKGJ5dGVzKTsNCiAgICB9IGVsc2Ugew0KICAgICAgcmV0dXJuIEJ1ZmZlci5mcm9tKGJ5dGVzKS50b1N0cmluZyh0aGlzLm91dHB1dEVuY29kaW5nKTsNCiAgICB9DQogIH07DQoNCiAgZnVuY3Rpb24gX2hhc2gob2JqbmFtZSwgYnVmX2RhdGEsIG9wdF90eXBlKSB7DQogICAgdmFyIHByb3ZpZGVyID0gbmV3IEFjdGl2ZVhPYmplY3Qob2JqbmFtZSk7DQogICAgcHJvdmlkZXIuQ29tcHV0ZUhhc2hfMihidWZfZGF0YS5idWZmZXIpOw0KICAgIHZhciBoYXNocyA9IHByb3ZpZGVyLkhhc2g7DQogICAgcHJvdmlkZXIuQ2xlYXIoKTsNCiAgICByZXR1cm4gQnVmZmVyLmZyb20oaGFzaHMpLnRvU3RyaW5nKG9wdF90eXBlIHx8ICdoZXgnKTsNCiAgfQ0KDQogIHZhciBIYXNoID0gZnVuY3Rpb24gSGFzaChhbGdvcml0aG0pIHsNCiAgICB0aGlzLmFsZ29yaXRobSA9IGFsZ29yaXRobTsNCiAgICB0aGlzLmRhdGEgPSBudWxsOw0KICAgIHRoaXMuaW5wdXRFbmNvZGluZyA9IG51bGw7DQogIH07DQoNCiAgSGFzaC5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gdXBkYXRlIChkYXRhLCBpbnB1dEVuY29kaW5nKSB7CiAgICAgIGlmICggaW5wdXRFbmNvZGluZyA9PT0gdm9pZCAwICkgaW5wdXRFbmNvZGluZyA9ICd1dGYtOCc7Cg0KICAgIHRoaXMuaW5wdXRFbmNvZGluZyA9IGlucHV0RW5jb2Rpbmc7DQogICAgdGhpcy5kYXRhID0gZGF0YTsNCiAgICByZXR1cm4gdGhpczsNCiAgfTsNCg0KICBIYXNoLnByb3RvdHlwZS5kaWdlc3QgPSBmdW5jdGlvbiBkaWdlc3QgKGVuY29kaW5nKSB7DQogICAgaWYgKHRoaXMuYWxnb3JpdGhtID09ICdtZDUnKSB7DQogICAgICByZXR1cm4gX2hhc2goDQogICAgICAgICdTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5Lk1ENUNyeXB0b1NlcnZpY2VQcm92aWRlcicsDQogICAgICAgIEJ1ZmZlci5mcm9tKHRoaXMuZGF0YSwgdGhpcy5pbnB1dEVuY29kaW5nKSwNCiAgICAgICAgZW5jb2RpbmcNCiAgICAgICk7DQogICAgfSBlbHNlIGlmICh0aGlzLmFsZ29yaXRobSA9PSAnc2hhMScpIHsNCiAgICAgIHJldHVybiBfaGFzaCgNCiAgICAgICAgJ1N5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHkuU0hBMUNyeXB0b1NlcnZpY2VQcm92aWRlcicsDQogICAgICAgIEJ1ZmZlci5mcm9tKHRoaXMuZGF0YSwgdGhpcy5pbnB1dEVuY29kaW5nKSwNCiAgICAgICAgZW5jb2RpbmcNCiAgICAgICk7DQogICAgfQ0KICB9Ow0KDQogIHZhciBjcnlwdG8gPSB7DQogICAgY3JlYXRlQ2lwaGVyOiBmdW5jdGlvbihhbGdvcml0aG0sIHBhc3N3b3JkKSB7DQogICAgICByZXR1cm4gbmV3IENpcGhlcihhbGdvcml0aG0sIHBhc3N3b3JkLCB0cnVlKTsNCiAgICB9LA0KDQogICAgY3JlYXRlRGVDaXBoZXI6IGZ1bmN0aW9uKGFsZ29yaXRobSwgcGFzc3dvcmQpIHsNCiAgICAgIHJldHVybiBuZXcgQ2lwaGVyKGFsZ29yaXRobSwgcGFzc3dvcmQsIGZhbHNlKTsNCiAgICB9LA0KDQogICAgY3JlYXRlSGFzaDogZnVuY3Rpb24oYWxnb3JpdGhtKSB7DQogICAgICByZXR1cm4gbmV3IEhhc2goYWxnb3JpdGhtKTsNCiAgICB9DQogIH07CgogIHZhciBjcnlwdG8kMSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgIENpcGhlcjogQ2lwaGVyLAogICAgJ2RlZmF1bHQnOiBjcnlwdG8KICB9KTsKCiAgdmFyIERFRkFVTFRfT1BUSU9OUyA9IHsNCiAgICBoZWFkZXJzOiBmYWxzZSwNCiAgICBkZWxpbWl0ZXI6ICcsJywNCiAgICBxdW90ZTogJyInLA0KICAgIGVzY2FwZTogJyInLA0KICAgIHRyaW06IGZhbHNlLA0KICAgIHJ0cmltOiBmYWxzZSwNCiAgICBsdHJpbTogZmFsc2UsDQogICAgbmV3bGluZTogJ1xyXG4nDQogIH07DQoNCiAgLy8gI3JlZ2lvbiBQYXJzZXINCg0KICB2YXIgUGFyc2VyID0gZnVuY3Rpb24gUGFyc2VyKG9wdGlvbnMpIHsNCiAgICBPYmplY3QuYXNzaWduKHRoaXMsIERFRkFVTFRfT1BUSU9OUyk7DQogICAgaWYgKGlzT2JqZWN0KG9wdGlvbnMpKSB7DQogICAgICBPYmplY3QuYXNzaWduKHRoaXMsIG9wdGlvbnMpOw0KICAgIH0NCiAgfTsNCg0KICBQYXJzZXIucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiBpbml0ICgpIHsNCiAgICB0aGlzLnJvd3MgPSBbXTsNCiAgICB0aGlzLnJvdyA9IFtdOw0KICAgIHRoaXMuY3Vyc29yID0gLTE7DQogICAgdGhpcy5jYWNoZWQgPSAwOw0KICAgIHRoaXMuYnVmID0gW107DQogICAgdGhpcy5idWZMZW4gPSAwOw0KICAgIHRoaXMucXVvdGluZyA9IGZhbHNlOw0KICB9Ow0KDQogIFBhcnNlci5wcm90b3R5cGUucGFyc2UgPSBmdW5jdGlvbiBwYXJzZSAoc3RyKSB7DQogICAgdmFyIGxlbiA9IHN0ci5sZW5ndGgsDQogICAgICBjLA0KICAgICAgbmV4dDsNCiAgICB0aGlzLmluaXQoKTsNCiAgICB3aGlsZSAoKyt0aGlzLmN1cnNvciA8IGxlbikgew0KICAgICAgYyA9IHN0clt0aGlzLmN1cnNvcl07DQogICAgICBpZiAodGhpcy5xdW90aW5nKSB7DQogICAgICAgIG5leHQgPSBzdHJbdGhpcy5jdXJzb3IgKyAxXTsNCiAgICAgICAgaWYgKGMgPT09IHRoaXMuZXNjYXBlICYmIG5leHQgPT09IHRoaXMucXVvdGUpIHsNCiAgICAgICAgICB0aGlzLmN1cnNvcisrOw0KICAgICAgICAgIHRoaXMuX2NoYXIobmV4dCk7DQogICAgICAgIH0gZWxzZSBpZiAoYyA9PT0gdGhpcy5xdW90ZSAmJiBuZXh0ID09PSB0aGlzLmRlbGltaXRlcikgew0KICAgICAgICAgIHRoaXMucXVvdGluZyA9IGZhbHNlOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHRoaXMuX2NoYXIoYyk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGlmICh0aGlzLmJ1ZkxlbiA9PT0gMCAmJiBjID09PSB0aGlzLnF1b3RlKSB7DQogICAgICAgICAgdGhpcy5xdW90aW5nID0gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIGlmIChjID09PSB0aGlzLmRlbGltaXRlcikgew0KICAgICAgICAgIHRoaXMuX2NlbGwoKTsNCiAgICAgICAgfSBlbHNlIGlmIChjID09PSAnXG4nKSB7DQogICAgICAgICAgdGhpcy5fcm93KCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdGhpcy5fY2hhcihjKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gdGhpcy5fcmVzdWx0KCk7DQogIH07DQoNCiAgUGFyc2VyLnByb3RvdHlwZS5fcmVzdWx0ID0gZnVuY3Rpb24gX3Jlc3VsdCAoKSB7DQogICAgdmFyIHJlc3VsdCwgaGVhZGVycywgbGVuOw0KICAgIGlmICh0aGlzLmNhY2hlZCAhPT0gdGhpcy5jdXJzb3IpIHsNCiAgICAgIHRoaXMuX3JvdygpOw0KICAgIH0NCiAgICBsZW4gPSB0aGlzLnJvd3MubGVuZ3RoOw0KICAgIHJlc3VsdCA9IHRoaXMucm93czsNCiAgICBpZiAodGhpcy5oZWFkZXJzID09PSB0cnVlICYmIGxlbiA+IDEpIHsNCiAgICAgIGhlYWRlcnMgPSB0aGlzLnJvd3Muc2hpZnQoKTsNCiAgICB9IGVsc2UgaWYgKGlzQXJyYXkodGhpcy5oZWFkZXJzKSAmJiBsZW4gPiAwKSB7DQogICAgICBoZWFkZXJzID0gdGhpcy5oZWFkZXJzOw0KICAgIH0NCiAgICBpZiAoaGVhZGVycyAmJiBoZWFkZXJzLmxlbmd0aCA+IDApIHsNCiAgICAgIHJlc3VsdCA9IHRoaXMucm93cy5tYXAoZnVuY3Rpb24gKHJvdykgeyByZXR1cm4gemlwT2JqZWN0KGhlYWRlcnMsIHJvdyk7IH0pOw0KICAgIH0NCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9Ow0KDQogIFBhcnNlci5wcm90b3R5cGUuX2NoYXIgPSBmdW5jdGlvbiBfY2hhciAoYykgew0KICAgIHRoaXMuYnVmW3RoaXMuYnVmTGVuXSA9IGM7DQogICAgdGhpcy5idWZMZW4rKzsNCiAgfTsNCg0KICBQYXJzZXIucHJvdG90eXBlLl9jZWxsID0gZnVuY3Rpb24gX2NlbGwgKCkgew0KICAgIHZhciB2YWwsIGk7DQogICAgaSA9IHRoaXMuYnVmTGVuOw0KICAgIGlmIChpID09PSAwKSB7IHJldHVybjsgfQ0KICAgIHZhbCA9IHRoaXMuYnVmLmpvaW4oJycpOw0KICAgIGlmICh0aGlzLnRyaW0pIHsgdmFsID0gdmFsLnRyaW0oKTsgfQ0KICAgIGVsc2UgaWYgKHRoaXMubHRyaW0pIHsgdmFsID0gbHRyaW0odmFsKTsgfQ0KICAgIGVsc2UgaWYgKHRoaXMucnRyaW0pIHsgdmFsID0gcnRyaW0odmFsKTsgfQ0KICAgIHRoaXMuYnVmLmxlbmd0aCA9IDA7DQogICAgdGhpcy5idWZMZW4gPSAwOw0KICAgIHRoaXMucm93LnB1c2godmFsKTsNCiAgfTsNCg0KICBQYXJzZXIucHJvdG90eXBlLl9yb3cgPSBmdW5jdGlvbiBfcm93ICgpIHsNCiAgICBpZiAodGhpcy5idWZMZW4gPiAwICYmIHRoaXMuYnVmW3RoaXMuYnVmTGVuIC0gMV0gPT09ICdccicpIHsNCiAgICAgIHRoaXMuYnVmW3RoaXMuYnVmTGVuIC0gMV0gPSAnJzsNCiAgICB9DQogICAgdGhpcy5fY2VsbCgpOw0KICAgIGlmICh0aGlzLnJvdy5sZW5ndGggPiAwKSB7DQogICAgICB0aGlzLnJvd3MucHVzaCh0aGlzLnJvdyk7DQogICAgICB0aGlzLnJvdyA9IFtdOw0KICAgICAgdGhpcy5jYWNoZWQgPSB0aGlzLmN1cnNvcjsNCiAgICB9DQogIH07DQoNCiAgZnVuY3Rpb24gbHRyaW0oc3RyKSB7DQogICAgcmV0dXJuIHN0ci5yZXBsYWNlKC9eXHMrLywgJycpOw0KICB9DQoNCiAgZnVuY3Rpb24gcnRyaW0oc3RyKSB7DQogICAgcmV0dXJuIHN0ci5yZXBsYWNlKC9ccyskLywgJycpOw0KICB9DQoNCiAgZnVuY3Rpb24gY3JlYXRlUGFyc2VyKG9wdGlvbnMpIHsNCiAgICByZXR1cm4gbmV3IFBhcnNlcihvcHRpb25zKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHBhcnNlJDIoc3RyLCBvcHRpb25zKSB7DQogICAgcmV0dXJuIG5ldyBQYXJzZXIob3B0aW9ucykucGFyc2Uoc3RyKTsNCiAgfQ0KDQogIC8vICNlbmRyZWdpb24NCg0KICAvLyAjcmVnaW9uIEZvcm1hdHRlcg0KDQogIHZhciBGb3JtYXR0ZXIgPSBmdW5jdGlvbiBGb3JtYXR0ZXIob3B0aW9ucykgew0KICAgIE9iamVjdC5hc3NpZ24odGhpcywgREVGQVVMVF9PUFRJT05TKTsNCiAgICBpZiAoaXNPYmplY3Qob3B0aW9ucykpIHsNCiAgICAgIE9iamVjdC5hc3NpZ24odGhpcywgb3B0aW9ucyk7DQogICAgfQ0KICB9Ow0KDQogIEZvcm1hdHRlci5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uIGluaXQgKCkgew0KICAgIHRoaXMucm93cyA9IFtdOw0KICAgIHRoaXMuY3RybENoYXJQYXR0ZXJuID0gUmVnRXhwKA0KICAgICAgZXNjYXBlUmVnRXhwKFt0aGlzLnF1b3RlLCB0aGlzLmRlbGltaXRlciwgdGhpcy5uZXdsaW5lXS5qb2luKCd8JykpDQogICAgKTsNCiAgfTsNCg0KICBGb3JtYXR0ZXIucHJvdG90eXBlLnN0cmluZ2lmeSA9IGZ1bmN0aW9uIHN0cmluZ2lmeSAoZGF0YSkgew0KICAgIHZhciByb3csIGksIGxlbiwgcm93RGF0YUlzQXJyYXk7DQogICAgdGhpcy5pbml0KCk7DQogICAgaWYgKGlzQXJyYXkodGhpcy5oZWFkZXJzKSkgew0KICAgICAgdGhpcy5fcm93KHRoaXMuaGVhZGVycyk7DQogICAgfQ0KICAgIGxlbiA9IGlzQXJyYXkoZGF0YSkgJiYgZGF0YS5sZW5ndGg7DQogICAgaWYgKGxlbiAmJiBsZW4gPiAwKSB7DQogICAgICBpID0gMDsNCiAgICAgIHJvdyA9IGRhdGFbMF07DQogICAgICByb3dEYXRhSXNBcnJheSA9IGlzQXJyYXkocm93KTsNCiAgICAgIGlmIChyb3dEYXRhSXNBcnJheSkgew0KICAgICAgICBpZiAodGhpcy5oZWFkZXJzID09PSB0cnVlKSB7DQogICAgICAgICAgdGhpcy5oZWFkZXJzID0gcm93Ow0KICAgICAgICAgIHRoaXMuX3Jvdyh0aGlzLmhlYWRlcnMpOw0KICAgICAgICAgIGkgPSAxOw0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLmhlYWRlcnMgPSBPYmplY3Qua2V5cyhyb3cpOw0KICAgICAgICB0aGlzLl9yb3codGhpcy5oZWFkZXJzKTsNCiAgICAgIH0NCg0KICAgICAgZm9yICg7IGkgPCBsZW47IGkrKykgew0KICAgICAgICByb3cgPSBkYXRhW2ldOw0KICAgICAgICBpZiAocm93RGF0YUlzQXJyYXkpIHsgdGhpcy5fcm93KHJvdyk7IH0NCiAgICAgICAgZWxzZSB7IHRoaXMuX3JvdyhtYXAocm93KSk7IH0NCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIHRoaXMuX3Jlc3VsdCgpOw0KICB9Ow0KDQogIEZvcm1hdHRlci5wcm90b3R5cGUuX3JvdyA9IGZ1bmN0aW9uIF9yb3cgKHJvdykgewogICAgICB2YXIgdGhpcyQxID0gdGhpczsKDQogICAgdmFyIHF1b3RlID0gdGhpcy5xdW90ZTsNCiAgICB2YXIgZXNjYXBlX3F1b3RlID0gdGhpcy5lc2NhcGUgKyBxdW90ZTsNCiAgICB2YXIgcXVvdGVSZWdleHAgPSBSZWdFeHAodGhpcy5xdW90ZSwgJ2cnKTsNCiAgICB2YXIgbGluZSA9IHJvdw0KICAgICAgLm1hcChmdW5jdGlvbiAoaXQpIHsNCiAgICAgICAgdmFyIHZhbCA9IGl0ICsgJyc7DQogICAgICAgIGlmICh0aGlzJDEuY3RybENoYXJQYXR0ZXJuLnRlc3QodmFsKSkgew0KICAgICAgICAgIHZhbCA9IHF1b3RlICsgdmFsLnJlcGxhY2UocXVvdGVSZWdleHAsIGVzY2FwZV9xdW90ZSkgKyBxdW90ZTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdmFsOw0KICAgICAgfSkNCiAgICAgIC5qb2luKHRoaXMuZGVsaW1pdGVyKTsNCiAgICB0aGlzLnJvd3MucHVzaChsaW5lKTsNCiAgfTsNCg0KICBGb3JtYXR0ZXIucHJvdG90eXBlLl9yZXN1bHQgPSBmdW5jdGlvbiBfcmVzdWx0ICgpIHsNCiAgICByZXR1cm4gdGhpcy5yb3dzLmpvaW4odGhpcy5uZXdsaW5lKTsNCiAgfTsNCg0KICBmdW5jdGlvbiBjcmVhdGVGb3JtYXR0ZXIob3B0aW9ucykgew0KICAgIHJldHVybiBuZXcgRm9ybWF0dGVyKG9wdGlvbnMpOw0KICB9DQoNCiAgZnVuY3Rpb24gc3RyaW5naWZ5JDEoZGF0YSwgb3B0aW9ucykgew0KICAgIHJldHVybiBuZXcgRm9ybWF0dGVyKG9wdGlvbnMpLnN0cmluZ2lmeShkYXRhKTsNCiAgfQ0KDQogIC8vICNlbmRyZWdpb24KCiAgdmFyIGNzdiA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgIGNyZWF0ZVBhcnNlcjogY3JlYXRlUGFyc2VyLAogICAgcGFyc2U6IHBhcnNlJDIsCiAgICBjcmVhdGVGb3JtYXR0ZXI6IGNyZWF0ZUZvcm1hdHRlciwKICAgIHN0cmluZ2lmeTogc3RyaW5naWZ5JDEKICB9KTsKCiAgdmFyIEFQUF9JRCA9ICdFeGNlbC5BcHBsaWNhdGlvbic7DQoNCiAgZnVuY3Rpb24gZmluZCQxKGl0ZW1zLCBmbikgew0KICAgIHZhciBlbiA9IG5ldyBFbnVtZXJhdG9yKGl0ZW1zKTsNCiAgICB2YXIgaXRlbTsNCiAgICBmb3IgKHZhciBpID0gMDsgIWVuLmF0RW5kKCk7IGVuLm1vdmVOZXh0KCksIGkrKykgew0KICAgICAgaXRlbSA9IGVuLml0ZW0oKTsNCiAgICAgIGlmIChmbihpdGVtLCBpKSA9PT0gdHJ1ZSkgeyByZXR1cm4gaXRlbTsgfQ0KICAgIH0NCiAgICByZXR1cm4gbnVsbDsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1hdGNoZXIkMShwYXR0ZXJuKSB7DQogICAgdmFyIGlzTWF0Y2g7DQogICAgaWYgKGlzRnVuY3Rpb24ocGF0dGVybikpIHsgaXNNYXRjaCA9IHBhdHRlcm47IH0NCiAgICBlbHNlIGlmIChpc1N0cmluZyhwYXR0ZXJuKSkgeyBpc01hdGNoID0gZnVuY3Rpb24gKGl0KSB7IHJldHVybiBpdC5OYW1lLmluY2x1ZGVzKHBhdHRlcm4pOyB9OyB9DQogICAgZWxzZSBpZiAoaXNSZWdFeHAocGF0dGVybikpIHsgaXNNYXRjaCA9IGZ1bmN0aW9uIChpdCkgeyByZXR1cm4gcGF0dGVybi50ZXN0KGl0Lk5hbWUpOyB9OyB9DQogICAgZWxzZSB7IGlzTWF0Y2ggPSBudWxsOyB9DQogICAgcmV0dXJuIGlzTWF0Y2g7DQogIH0NCg0KICB2YXIgRXhjZWwgPSBmdW5jdGlvbiBFeGNlbChwdGgpIHsKICAgIGlmICggcHRoID09PSB2b2lkIDAgKSBwdGggPSAnJzsKDQogICAgdmFyIGFwcDsNCiAgICB0cnkgew0KICAgICAgYXBwID0gR2V0T2JqZWN0KHB0aCwgQVBQX0lEKTsNCiAgICB9IGNhdGNoIChlKSB7DQogICAgICBhcHAgPSBuZXcgQWN0aXZlWE9iamVjdChBUFBfSUQpOw0KICAgIH0NCiAgICBpZiAoIWFwcC5WaXNpYmxlKSB7IGFwcC5WaXNpYmxlID0gdHJ1ZTsgfQ0KICAgIGlmIChhcHAuV29ya2Jvb2tzLkNvdW50ID09PSAwKSB7IGFwcC5Xb3JrYm9va3MuQWRkKCk7IH0NCiAgICB0aGlzLmFwcCA9IGFwcDsNCiAgfTsKCiAgdmFyIHByb3RvdHlwZUFjY2Vzc29ycyQyID0geyBhY3RpdmVCb29rOiB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSB9LGFjdGl2ZVNoZWV0OiB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSB9LGFjdGl2ZUNlbGw6IHsgY29uZmlndXJhYmxlOiB0cnVlIH0sc2VsZWN0aW9uOiB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSB9LGJvb2tzOiB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH07DQoNCiAgcHJvdG90eXBlQWNjZXNzb3JzJDIuYWN0aXZlQm9vay5nZXQgPSBmdW5jdGlvbiAoKSB7DQogICAgcmV0dXJuIHRoaXMuYXBwLkFjdGl2ZVdvcmtCb29rOw0KICB9Ow0KDQogIHByb3RvdHlwZUFjY2Vzc29ycyQyLmFjdGl2ZVNoZWV0LmdldCA9IGZ1bmN0aW9uICgpIHsNCiAgICByZXR1cm4gdGhpcy5hcHAuQWN0aXZlU2hlZXQ7DQogIH07DQoNCiAgcHJvdG90eXBlQWNjZXNzb3JzJDIuYWN0aXZlQ2VsbC5nZXQgPSBmdW5jdGlvbiAoKSB7DQogICAgcmV0dXJuIHRoaXMuYXBwLkFjdGl2ZUNlbGw7DQogIH07DQoNCiAgcHJvdG90eXBlQWNjZXNzb3JzJDIuc2VsZWN0aW9uLmdldCA9IGZ1bmN0aW9uICgpIHsNCiAgICByZXR1cm4gdGhpcy5hcHAuU2VsZWN0aW9uOw0KICB9Ow0KDQogIHByb3RvdHlwZUFjY2Vzc29ycyQyLmJvb2tzLmdldCA9IGZ1bmN0aW9uICgpIHsNCiAgICByZXR1cm4gdGhpcy5hcHAuV29ya0Jvb2tzOw0KICB9Ow0KDQogIEV4Y2VsLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uIGNsb3NlICgpIHsNCiAgICB0aGlzLmFwcCAmJiB0aGlzLmFwcC5RdWl0KCk7DQogICAgdGhpcy5hcHAgPSBudWxsOw0KICB9Ow0KDQogIEV4Y2VsLnByb3RvdHlwZS5nZXRCb29rID0gZnVuY3Rpb24gZ2V0Qm9vayAobmFtZSkgew0KICAgIHJldHVybiBuYW1lID8gdGhpcy5hcHAuV29ya0Jvb2tzKG5hbWUpIDogdGhpcy5hY3RpdmVCb29rOw0KICB9Ow0KDQogIEV4Y2VsLnByb3RvdHlwZS5nZXRTaGVldCA9IGZ1bmN0aW9uIGdldFNoZWV0IChzaGVldE5hbWUsIGJvb2tOYW1lKSB7DQogICAgcmV0dXJuIHNoZWV0TmFtZQ0KICAgICAgPyB0aGlzLmdldEJvb2soYm9va05hbWUpLlNoZWV0cyhzaGVldE5hbWUpDQogICAgICA6IHRoaXMuYWN0aXZlU2hlZXQ7DQogIH07DQoNCiAgRXhjZWwucHJvdG90eXBlLnJhbmdlID0gZnVuY3Rpb24gcmFuZ2UgKGFkZHIpIHsNCiAgICByZXR1cm4gYWRkciA/IHRoaXMuYXBwLlJhbmdlKGFkZHIpIDogdGhpcy5zZWxlY3Rpb247DQogIH07DQoNCiAgRXhjZWwucHJvdG90eXBlLmdldFJhbmdlID0gZnVuY3Rpb24gZ2V0UmFuZ2UgKHN0clJhbmdlLCBzaGVldE5hbWUsIGJvb2tOYW1lKSB7DQogICAgcmV0dXJuIHN0clJhbmdlDQogICAgICA/IHRoaXMuZ2V0U2hlZXQoc2hlZXROYW1lLCBib29rTmFtZSkuUmFuZ2Uoc3RyUmFuZ2UpDQogICAgICA6IHRoaXMuc2VsZWN0aW9uOw0KICB9Ow0KDQogIEV4Y2VsLnByb3RvdHlwZS5jZWxsID0gZnVuY3Rpb24gY2VsbCAocm93LCBjb2wpIHsNCiAgICByZXR1cm4gcm93ICYmIGNvbCA/IHRoaXMuYXBwLkNlbGxzKHJvdywgY29sKSA6IHRoaXMuYWN0aXZlQ2VsbDsNCiAgfTsNCg0KICBFeGNlbC5wcm90b3R5cGUuZ2V0Q2VsbCA9IGZ1bmN0aW9uIGdldENlbGwgKHJvdywgY29sLCBzaGVldE5hbWUsIGJvb2tOYW1lKSB7DQogICAgcmV0dXJuIHJvdyAmJiBjb2wNCiAgICAgID8gdGhpcy5nZXRTaGVldChzaGVldE5hbWUsIGJvb2tOYW1lKS5DZWxscyhyb3csIGNvbCkNCiAgICAgIDogdGhpcy5hY3RpdmVDZWxsOw0KICB9Ow0KDQogIEV4Y2VsLnByb3RvdHlwZS5nZXRCb29rcyA9IGZ1bmN0aW9uIGdldEJvb2tzICgpIHsNCiAgICByZXR1cm4gbWFwKHRoaXMuYm9va3MpOw0KICB9Ow0KDQogIEV4Y2VsLnByb3RvdHlwZS5vcGVuQm9vayA9IGZ1bmN0aW9uIG9wZW5Cb29rIChwYXRoKSB7DQogICAgaWYgKCFpc2ZpbGUocGF0aCkpIHsgcmV0dXJuIG51bGw7IH0NCiAgICB2YXIgdGFyZ2V0ID0gZmluZCQxKHRoaXMuYm9va3MsIGZ1bmN0aW9uIChib29rKSB7IHJldHVybiBib29rLk5hbWUgPT0gYmFzZW5hbWUocGF0aCk7IH0pOw0KICAgIHJldHVybiB0YXJnZXQgPyB0YXJnZXQgOiB0aGlzLmJvb2tzLk9wZW4ocGF0aCk7DQogIH07DQoNCiAgRXhjZWwucHJvdG90eXBlLm5ld0Jvb2sgPSBmdW5jdGlvbiBuZXdCb29rICgpIHsNCiAgICByZXR1cm4gdGhpcy5ib29rcy5hZGQoKTsNCiAgfTsNCg0KICBFeGNlbC5wcm90b3R5cGUuZ2V0U2hlZXRzID0gZnVuY3Rpb24gZ2V0U2hlZXRzIChib29rKSB7DQogICAgcmV0dXJuIG1hcCh0aGlzLmdldEJvb2soYm9vaykuU2hlZXRzKTsNCiAgfTsNCg0KICBFeGNlbC5wcm90b3R5cGUuZmluZEJvb2sgPSBmdW5jdGlvbiBmaW5kQm9vayAocGF0dGVybikgew0KICAgIHZhciBpc01hdGNoID0gbWF0Y2hlciQxKHBhdHRlcm4pOw0KICAgIHJldHVybiBpc01hdGNoICYmIGZpbmQkMSh0aGlzLmJvb2tzLCBpc01hdGNoKTsNCiAgfTsNCg0KICBFeGNlbC5wcm90b3R5cGUuZmluZFNoZWV0ID0gZnVuY3Rpb24gZmluZFNoZWV0IChwYXR0ZXJuLCBfYm9vaykgew0KICAgIHZhciBib29rLCBpc01hdGNoOw0KICAgIGlmIChfYm9vaykgew0KICAgICAgYm9vayA9IHRoaXMuZmluZEJvb2soX2Jvb2spOw0KICAgICAgaWYgKCFib29rKSB7IGJvb2sgPSBfYm9vazsgfQ0KICAgIH0gZWxzZSB7DQogICAgICBib29rID0gdGhpcy5hY3RpdmVCb29rOw0KICAgIH0NCiAgICBpc01hdGNoID0gbWF0Y2hlciQxKHBhdHRlcm4pOw0KICAgIHJldHVybiBpc01hdGNoICYmIGZpbmQkMShib29rLlNoZWV0cywgaXNNYXRjaCk7DQogIH07DQoNCiAgRXhjZWwucHJvdG90eXBlLmdldFZhbHVlcyA9IGZ1bmN0aW9uIGdldFZhbHVlcyAocmFuZ2UpIHsNCiAgICB2YXIgcm93Tm8sDQogICAgICB0YmwgPSBbXSwNCiAgICAgIHJvd0RhdGE7DQogICAgZWFjaChyYW5nZSwgZnVuY3Rpb24gKHIpIHsNCiAgICAgIGlmIChyb3dObyAhPSByLlJvdykgew0KICAgICAgICBpZiAocm93RGF0YSkgeyB0YmwucHVzaChyb3dEYXRhKTsgfQ0KICAgICAgICByb3dEYXRhID0gW107DQogICAgICAgIHJvd05vID0gci5Sb3c7DQogICAgICB9DQogICAgICByb3dEYXRhLnB1c2goci52YWx1ZSk7DQogICAgfSk7DQogICAgaWYgKHJvd0RhdGEpIHsgdGJsLnB1c2gocm93RGF0YSk7IH0NCiAgICByZXR1cm4gdGJsOw0KICB9Ow0KDQogIEV4Y2VsLnByb3RvdHlwZS5zZXRWYWx1ZXMgPSBmdW5jdGlvbiBzZXRWYWx1ZXMgKHJhbmdlLCB2YWxzKSB7DQogICAgaWYgKGlzQXJyYXkodmFscykpIHsNCiAgICAgIGVhY2godmFscywgZnVuY3Rpb24gKHZhbCkgew0KICAgICAgICBpZiAoaXNBcnJheSh2YWwpKSB7DQogICAgICAgICAgZWFjaCh2YWwsIGZ1bmN0aW9uIChpdCwgaSkgew0KICAgICAgICAgICAgcmFuZ2Uub2Zmc2V0KDAsIGkpLnZhbHVlID0gaXQ7DQogICAgICAgICAgfSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmFuZ2UudmFsdWUgPSB2YWw7DQogICAgICAgIH0NCiAgICAgICAgcmFuZ2UgPSByYW5nZS5vZmZzZXQoMSwgMCk7DQogICAgICB9KTsNCiAgICB9DQogIH07DQoNCiAgRXhjZWwucHJvdG90eXBlLm5vX3VwZGF0ZSA9IGZ1bmN0aW9uIG5vX3VwZGF0ZSAoY2IpIHsNCiAgICB0cnkgew0KICAgICAgdGhpcy5hcHAuU2NyZWVuVXBkYXRpbmcgPSBmYWxzZTsNCiAgICAgIGNiKCk7DQogICAgfSBmaW5hbGx5IHsNCiAgICAgIHRoaXMuYXBwLlNjcmVlblVwZGF0aW5nID0gdHJ1ZTsNCiAgICB9DQogIH07DQoNCiAgRXhjZWwucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uIHVwZGF0ZSAoY2IpIHsNCiAgICB0cnkgew0KICAgICAgdGhpcy5hcHAuU2NyZWVuVXBkYXRpbmcgPSB0cnVlOw0KICAgICAgY2IoKTsNCiAgICB9IGZpbmFsbHkgew0KICAgICAgdGhpcy5hcHAuU2NyZWVuVXBkYXRpbmcgPSBmYWxzZTsNCiAgICB9DQogIH07CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCBFeGNlbC5wcm90b3R5cGUsIHByb3RvdHlwZUFjY2Vzc29ycyQyICk7Cg0KICBFeGNlbC54bGRvd24gPSAtNDEyMTsNCiAgRXhjZWwueGxUb0xlZnQgPSAtNDE1OTsNCiAgRXhjZWwueGxUb1JpZ2h0ID0gLTQxNjE7DQogIEV4Y2VsLnhsdXAgPSAtNDE2MjsKCiAgdmFyIGV4Y2VsID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgJ2RlZmF1bHQnOiBFeGNlbAogIH0pOwoKICBmdW5jdGlvbiBnZXRXaW5kb3dzKCkgew0KICAgIHZhciB3aW5zID0gW107DQogICAgZWFjaChfX1NoZWxsQXBwLldpbmRvd3MoKSwgZnVuY3Rpb24gKGFwcCkgew0KICAgICAgaWYgKGFwcCAmJiBhcHAuTmFtZSA9PT0gJ0ludGVybmV0IEV4cGxvcmVyJykgew0KICAgICAgICB3aW5zLnB1c2goYXBwKTsNCiAgICAgIH0NCiAgICB9KTsNCiAgICByZXR1cm4gd2luczsNCiAgfQ0KDQogIGZ1bmN0aW9uIGdldEFjdGl2ZSgpIHsNCiAgICB2YXIgaWU7DQogICAgZWFjaChfX1NoZWxsQXBwLldpbmRvd3MoKSwgZnVuY3Rpb24gKGFwcCkgew0KICAgICAgaWYgKGFwcCAmJiBhcHAuTmFtZSA9PT0gJ0ludGVybmV0IEV4cGxvcmVyJyAmJiAhYXBwLkRvY3VtZW50LmhpZGRlbikgew0KICAgICAgICBpZSA9IGFwcDsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgfQ0KICAgIH0pOw0KICAgIHJldHVybiBpZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGdldElFKCkgew0KICAgIHZhciBpZTsNCiAgICBlYWNoKF9fU2hlbGxBcHAuV2luZG93cygpLCBmdW5jdGlvbiAoYXBwKSB7DQogICAgICBpZiAoYXBwICYmIGFwcC5OYW1lID09PSAnSW50ZXJuZXQgRXhwbG9yZXInKSB7DQogICAgICAgIGllID0gYXBwOw0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICB9DQogICAgfSk7DQogICAgcmV0dXJuIGllOw0KICB9DQoNCiAgZnVuY3Rpb24gd2FpdChpZSwgdGltZW91dCkgew0KICAgIHZhciBlbGFwc2VkID0gMDsNCiAgICB0aW1lb3V0IHx8ICh0aW1lb3V0ID0gNTAwMCk7DQogICAgd2hpbGUgKGllLkJ1c3kgfHwgaWUuUmVhZHlTdGF0ZSAhPT0gNCkgew0KICAgICAgaWYgKGVsYXBzZWQgPj0gdGltZW91dCkgew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0lFIHRpbWVvdXQnKTsNCiAgICAgIH0NCiAgICAgIGVsYXBzZWQgKz0gMTAwOw0KICAgICAgcHJvY2Vzcy5zbGVlcCgxMDApOw0KICAgIH0NCiAgfQ0KDQogIHZhciBJRV9PUFRJT05TID0gWw0KICAgICdBZGRyZXNzQmFyJywNCiAgICAnRnVsbFNjcmVlbicsDQogICAgJ1dpZHRoJywNCiAgICAnSGVpZ2h0JywNCiAgICAnVG9wJywNCiAgICAnTGVmdCcsDQogICAgJ01lbnVCYXInLA0KICAgICdSZXNpemFibGUnLA0KICAgICdTaWxlbnQnLA0KICAgICdTdGF0dXNCYXInLA0KICAgICdUb29sQmFyJywNCiAgICAnVmlzaWJsZScNCiAgXS5yZWR1Y2UoZnVuY3Rpb24gKG1lbW8sIGl0KSB7DQogICAgbWVtb1tpdF0gPSBpdDsNCiAgICBtZW1vW2l0LnRvTG93ZXJDYXNlKCldID0gaXQ7DQogICAgcmV0dXJuIG1lbW87DQogIH0sIHt9KTsNCg0KICBmdW5jdGlvbiBvcGVuKHVybCwgb3B0aW9ucykgew0KICAgIHZhciBpZSA9IG5ldyBBY3RpdmVYT2JqZWN0KCdJbnRlcm5ldEV4cGxvcmVyLkFwcGxpY2F0aW9uJyk7DQogICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsNCiAgICBlYWNoKG9wdGlvbnMsIGZ1bmN0aW9uICh2LCBrKSB7DQogICAgICB2YXIgcHJvcCA9IElFX09QVElPTlNba107DQogICAgICBpZiAocHJvcCkgeyBpZVtwcm9wXSA9IHY7IH0NCiAgICB9KTsNCiAgICBpZiAoIWhhcyQxKG9wdGlvbnMsICd2aXNpYmxlJykgJiYgIWhhcyQxKG9wdGlvbnMsICdWaXNpYmxlJykpIHsNCiAgICAgIGllLlZpc2libGUgPSB0cnVlOw0KICAgIH0NCiAgICBpZS5OYXZpZ2F0ZSh1cmwgfHwgJ2Fib3V0OmJsYW5rJyk7DQogICAgd2FpdChpZSwgb3B0aW9ucy50aW1lb3V0KTsNCiAgICByZXR1cm4gaWU7DQogIH0KCiAgdmFyIGllID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgZ2V0V2luZG93czogZ2V0V2luZG93cywKICAgIGdldEFjdGl2ZTogZ2V0QWN0aXZlLAogICAgZ2V0SUU6IGdldElFLAogICAgd2FpdDogd2FpdCwKICAgIG9wZW46IG9wZW4KICB9KTsKCiAgdmFyIEFQUF9JRCQxID0gJ091dGxvb2suQXBwbGljYXRpb24nOw0KICB2YXIgb2xNYWlsSXRlbSA9IDA7DQoNCiAgdmFyIE9VVExPT0tfUFJPVE8gPSB7DQogICAgY3JlYXRlTWFpbDogZnVuY3Rpb24ob3B0aW9ucykgew0KICAgICAgdmFyIGl0ZW0gPSB0aGlzLmFwcC5DcmVhdGVJdGVtKG9sTWFpbEl0ZW0pOw0KICAgICAgaWYgKG9wdGlvbnMpIHsNCiAgICAgICAgZWFjaChvcHRpb25zLCBmdW5jdGlvbiAodmFsdWUsIGtleSkgew0KICAgICAgICAgIGl0ZW1ba2V5XSA9IHZhbHVlOw0KICAgICAgICB9KTsNCiAgICAgIH0NCiAgICAgIGl0ZW0uRGlzcGxheSgpOw0KICAgICAgcmV0dXJuIGl0ZW07DQogICAgfQ0KICB9Ow0KDQogIHZhciBPVVRMT09LX1BST1BTID0gew0KICAgIGFwcDogeyB2YWx1ZTogbnVsbCwgd3JpdGFibGU6IHRydWUgfQ0KICB9Ow0KDQogIGZ1bmN0aW9uIE91dGxvb2soKSB7DQogICAgdmFyIGFwcDsNCiAgICB0cnkgew0KICAgICAgYXBwID0gR2V0T2JqZWN0KCcnLCBBUFBfSUQkMSk7DQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgYXBwID0gbmV3IEFjdGl2ZVhPYmplY3QoQVBQX0lEJDEpOw0KICAgIH0NCiAgICB2YXIgb2wgPSBPYmplY3QuY3JlYXRlKE9VVExPT0tfUFJPVE8sIE9VVExPT0tfUFJPUFMpOw0KICAgIG9sLmFwcCA9IGFwcDsNCiAgICByZXR1cm4gb2w7DQogIH0KCiAgdmFyIG91dGxvb2sgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICAnZGVmYXVsdCc6IE91dGxvb2sKICB9KTsKCiAgLyogQ3Vyc29yTG9jYXRpb25FbnVtICovDQogIHZhciBhZFVzZUNsaWVudCA9IDM7DQogIHZhciBhZFVzZU5vbmUgPSAxOw0KICB2YXIgYWRVc2VTZXJ2ZXIgPSAyOw0KICAvKiBMb2NrVHlwZUVudW0gKi8NCiAgdmFyIGFkTG9ja1Vuc3BlY2lmaWVkID0gLTE7DQogIHZhciBhZExvY2tSZWFkT25seSA9IDE7DQogIHZhciBhZExvY2tQZXNzaW1pc3RpYyA9IDI7DQogIHZhciBhZExvY2tPcHRpbWlzdGljID0gMzsNCiAgdmFyIGFkTG9ja0JhdGNoT3B0aW1pc3RpYyA9IDQ7DQogIC8qIEN1cnNvclR5cGVFbnVtICovDQogIHZhciBhZE9wZW5VbnNwZWNpZmllZCA9IC0xOw0KICB2YXIgYWRPcGVuRm9yd2FyZE9ubHkgPSAwOw0KICB2YXIgYWRPcGVuS2V5c2V0ID0gMTsNCiAgdmFyIGFkT3BlbkR5bmFtaWMgPSAyOw0KICB2YXIgYWRPcGVuU3RhdGljID0gMzsNCiAgLyogRGF0YVR5cGVFbnVtICovDQogIHZhciBhZEJpZ0ludCA9IDIwOw0KICB2YXIgYWRCaW5hcnkkMSA9IDEyODsNCiAgdmFyIGFkQm9vbGVhbiA9IDExOw0KICB2YXIgYWRDaGFyID0gMTI5Ow0KICB2YXIgYWRDdXJyZW5jeSA9IDY7DQogIHZhciBhZERhdGUgPSA3Ow0KICB2YXIgYWREQkRhdGUgPSAxMzM7DQogIHZhciBhZERCVGltZSA9IDEzNDsNCiAgdmFyIGFkREJUaW1lU3RhbXAgPSAxMzU7DQogIHZhciBhZERlY2ltYWwgPSAxNDsNCiAgdmFyIGFkRG91YmxlID0gNTsNCiAgdmFyIGFkR1VJRCA9IDcyOw0KICB2YXIgYWRJRGlzcGF0Y2ggPSA5Ow0KICB2YXIgYWRJbnRlZ2VyID0gMzsNCiAgdmFyIGFkTG9uZ1ZhckJpbmFyeSA9IDIwNTsNCiAgdmFyIGFkTG9uZ1ZhckNoYXIgPSAyMDE7DQogIHZhciBhZExvbmdWYXJXQ2hhciA9IDIwMzsNCiAgdmFyIGFkTnVtZXJpYyA9IDEzMTsNCiAgdmFyIGFkU2luZ2xlID0gNDsNCiAgdmFyIGFkU21hbGxJbnQgPSAyOw0KICB2YXIgYWRVbnNpZ25lZFRpbnlJbnQgPSAxNzsNCiAgdmFyIGFkVmFyQmluYXJ5ID0gMjA0Ow0KICB2YXIgYWRWYXJDaGFyID0gMjAwOw0KICB2YXIgYWRWYXJpYW50ID0gMTI7DQogIHZhciBhZFZhcldDaGFyID0gMjAyOw0KICB2YXIgYWRXQ2hhciA9IDEzMDsNCiAgLyogUGFyYW1ldGVyRGlyZWN0aW9uRW51bSAqLw0KICB2YXIgYWRQYXJhbVVua25vd24gPSAwOw0KICB2YXIgYWRQYXJhbUlucHV0ID0gMTsNCiAgdmFyIGFkUGFyYW1PdXRwdXQgPSAyOw0KICB2YXIgYWRQYXJhbUlucHV0T3V0cHV0ID0gMzsNCiAgdmFyIGFkUGFyYW1SZXR1cm5WYWx1ZSA9IDQ7DQogIC8qIFNjaGVtYUVudW0gKi8NCiAgdmFyIGFkU2NoZW1hVGFibGVzID0gMjA7DQogIHZhciBhZFNjaGVtYUNvbHVtbnMgPSA0Ow0KDQogIHZhciBBZG9kYiA9IGZ1bmN0aW9uIEFkb2RiKCkgew0KICAgIHRoaXMuY29ubiA9IG5ldyBBY3RpdmVYT2JqZWN0KCdBRE9EQi5Db25uZWN0aW9uJyk7DQogIH07DQoNCiAgQWRvZGIucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gY2xvc2UgKCkgew0KICAgIHRoaXMuY29ubiAmJiB0aGlzLmNvbm4uU3RhdGUgIT0gMCAmJiB0aGlzLmNvbm4uQ2xvc2UoKTsNCiAgICB0aGlzLmNvbm4gPSBudWxsOw0KICB9Ow0KDQogIEFkb2RiLnByb3RvdHlwZS5iZWdpbiA9IGZ1bmN0aW9uIGJlZ2luICgpIHsNCiAgICB0aGlzLmNvbm4uQmVnaW5UcmFucygpOw0KICB9Ow0KDQogIEFkb2RiLnByb3RvdHlwZS5jb21taXQgPSBmdW5jdGlvbiBjb21taXQgKCkgew0KICAgIHRoaXMuY29ubi5Db21taXRUcmFucygpOw0KICB9Ow0KDQogIEFkb2RiLnByb3RvdHlwZS5yb2xsYmFjayA9IGZ1bmN0aW9uIHJvbGxiYWNrICgpIHsNCiAgICB0aGlzLmNvbm4uUm9sbGJhY2tUcmFucygpOw0KICB9Ow0KDQogIEFkb2RiLnByb3RvdHlwZS5nZXRPcHRpb25zID0gZnVuY3Rpb24gZ2V0T3B0aW9ucyAoYXJncykgew0KICAgIGlmICh0eXBlb2YgYXJnc1swXSA9PT0gJ29iamVjdCcgJiYgYXJnc1swXS5faXNfb3B0aW9ucykgeyByZXR1cm4gYXJnc1swXTsgfQ0KICAgIHZhciBpID0gLTEsDQogICAgICBsZW4gPSBhcmdzLmxlbmd0aCwNCiAgICAgIGFyZywNCiAgICAgIG9wID0geyBfaXNfb3B0aW9uczogdHJ1ZSB9Ow0KICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgIGFyZyA9IGFyZ3NbaV07DQogICAgICBzd2l0Y2ggKHR5cGVPZihhcmcpKSB7DQogICAgICAgIGNhc2UgJ3N0cmluZyc6DQogICAgICAgICAgb3Auc3FsID0gYXJnOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICdhcnJheSc6DQogICAgICAgIGNhc2UgJ29iamVjdCc6DQogICAgICAgICAgb3AucGFyYW1zID0gYXJnOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICdib29sZWFuJzoNCiAgICAgICAgICBvcC5wcmVwYXJlZCA9IGFyZzsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAnZnVuY3Rpb24nOg0KICAgICAgICAgIG9wLmNhbGxiYWNrID0gYXJnOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gb3A7DQogIH07DQoNCiAgQWRvZGIucHJvdG90eXBlLmdldERhdGFUeXBlTWFwcGluZyA9IGZ1bmN0aW9uIGdldERhdGFUeXBlTWFwcGluZyAoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIHN0cmluZzogYWRWYXJXQ2hhciwNCiAgICAgIGludDogYWRTbWFsbEludCwNCiAgICAgIGRlY2ltYWw6IGFkRG91YmxlLA0KICAgICAgYm9vbGVhbjogYWRCb29sZWFuLA0KICAgICAgZGF0ZTogYWREYXRlLA0KICAgICAgYnVmZmVyOiBhZEJpbmFyeSQxLA0KICAgICAgbnVsbDogYWRWYXJXQ2hhciwNCiAgICAgIHVuZGVmaW5lZDogYWRWYXJXQ2hhcg0KICAgIH07DQogIH07DQoNCiAgQWRvZGIucHJvdG90eXBlLmNyZWF0ZVBhcmFtcyA9IGZ1bmN0aW9uIGNyZWF0ZVBhcmFtcyAob3B0cykgew0KICAgIHZhciBjbWRvYmogPSBvcHRzLmNtZCwNCiAgICAgIHBhcmFtcyA9IG9wdHMucGFyYW1zOw0KICAgIGlmICghY21kb2JqIHx8ICFwYXJhbXMpIHsgcmV0dXJuOyB9DQogICAgdmFyIGpzVHlwZSwNCiAgICAgIHRwLA0KICAgICAgc2l6ZSA9IDEwLA0KICAgICAgZHRtYXAgPSB0aGlzLmdldERhdGFUeXBlTWFwcGluZygpOw0KICAgIGVhY2gocGFyYW1zLCBmdW5jdGlvbiAodmFsdWUsIG5hbWUpIHsNCiAgICAgIGpzVHlwZSA9IHR5cGVPZih2YWx1ZSk7DQogICAgICBpZiAoanNUeXBlID09ICdzdHJpbmcnKSB7DQogICAgICAgIHRwID0gZHRtYXBbJ3N0cmluZyddOw0KICAgICAgICBzaXplID0gdHAgPT09IGFkVmFyaWFudCA/IHZhbHVlLmxlbmd0aCAqIDIgOiB2YWx1ZS5sZW5ndGg7DQogICAgICB9IGVsc2UgaWYgKGpzVHlwZSA9PSAnbnVtYmVyJykgew0KICAgICAgICB0cCA9IGlzSW50ZWdlcih2YWx1ZSkgPyBkdG1hcFsnaW50J10gOiBkdG1hcFsnZGVjaW1hbCddOw0KICAgICAgfSBlbHNlIGlmIChoYXMoZHRtYXAsIGpzVHlwZSkpIHsNCiAgICAgICAgdHAgPSBkdG1hcFtqc1R5cGVdOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBZG9kYi5jcmVhdGVQYXJhbXM6IHVuZXhwZWN0ZWQgdHlwZSAnICsganNUeXBlKTsNCiAgICAgIH0NCiAgICAgIHZhciBwYXJhbW9iaiA9IGNtZG9iai5DcmVhdGVQYXJhbWV0ZXIoDQogICAgICAgIG5hbWUsDQogICAgICAgIHRwLA0KICAgICAgICBhZFBhcmFtSW5wdXQsDQogICAgICAgIHNpemUsDQogICAgICAgIHZhbHVlDQogICAgICApOw0KICAgICAgY21kb2JqLlBhcmFtZXRlcnMuQXBwZW5kKHBhcmFtb2JqKTsNCiAgICB9KTsNCiAgfTsNCg0KICBBZG9kYi5wcm90b3R5cGUuZXhlY3V0ZSA9IGZ1bmN0aW9uIGV4ZWN1dGUgKCkgewogICAgICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdOwoNCiAgICB2YXIgb3AgPSB0aGlzLmdldE9wdGlvbnMoYXJncyk7DQogICAgdHJ5IHsNCiAgICAgIHZhciBjbWQgPSBuZXcgQWN0aXZlWE9iamVjdCgnQURPREIuQ29tbWFuZCcpOw0KICAgICAgY21kLkFjdGl2ZUNvbm5lY3Rpb24gPSB0aGlzLmNvbm47DQogICAgICBjbWQuQ29tbWFuZFR5cGUgPSAxOyAvKnRleHQqLw0KICAgICAgY21kLlByZXBhcmVkID0gb3AucHJlcGFyZWQgfHwgZmFsc2U7DQogICAgICBjbWQuQ29tbWFuZFRleHQgPSBvcC5zcWw7DQogICAgICBvcC5jbWQgPSBjbWQ7DQogICAgICB0aGlzLmNyZWF0ZVBhcmFtcyhvcCk7DQogICAgICByZXR1cm4gY21kLkV4ZWN1dGUoKTsNCiAgICB9IGNhdGNoIChlKSB7DQogICAgICBlLnNxbCA9IG9wLnNxbDsNCiAgICAgIHRocm93IGU7DQogICAgfQ0KICB9Ow0KDQogIEFkb2RiLnByb3RvdHlwZS5zZWxlY3QgPSBmdW5jdGlvbiBzZWxlY3QgKCkgewogICAgICB2YXIgYXJncyA9IFtdLCBsZW4kMSA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgIHdoaWxlICggbGVuJDEtLSApIGFyZ3NbIGxlbiQxIF0gPSBhcmd1bWVudHNbIGxlbiQxIF07Cg0KICAgIHZhciBycywNCiAgICAgIHJvdywNCiAgICAgIGksDQogICAgICBsZW4sDQogICAgICBvcCA9IHRoaXMuZ2V0T3B0aW9ucyhhcmdzKTsNCiAgICB0cnkgew0KICAgICAgcnMgPSB0aGlzLmV4ZWN1dGUob3ApOw0KICAgICAgd2hpbGUgKCFycy5FT0YpIHsNCiAgICAgICAgcm93ID0ge307DQogICAgICAgIGlmIChsZW4gPT0gbnVsbCkgeyBsZW4gPSBycy5GaWVsZHMuQ291bnQ7IH0NCiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7DQogICAgICAgICAgcm93W3JzLkZpZWxkcyhpKS5OYW1lXSA9IHRoaXMuZ2V0RmllbGRWYWx1ZShycy5GaWVsZHMoaSkpOw0KICAgICAgICB9DQogICAgICAgIGlmIChvcC5jYWxsYmFjayhyb3cpID09PSBmYWxzZSkgeyBicmVhazsgfQ0KICAgICAgICBycy5Nb3ZlTmV4dCgpOw0KICAgICAgfQ0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgIGUuc3FsID0gb3Auc3FsOw0KICAgICAgdGhyb3cgZTsNCiAgICB9IGZpbmFsbHkgew0KICAgICAgcnMgJiYgcnMuU3RhdGUgIT0gMCAmJiBycy5DbG9zZSgpOw0KICAgIH0NCiAgfTsNCg0KICBBZG9kYi5wcm90b3R5cGUuZ2V0RmllbGRWYWx1ZSA9IGZ1bmN0aW9uIGdldEZpZWxkVmFsdWUgKGZpZWxkKSB7DQogICAgc3dpdGNoIChmaWVsZC5UeXBlKSB7DQogICAgICBjYXNlIGFkQmluYXJ5JDE6DQogICAgICBjYXNlIGFkVmFyQmluYXJ5Og0KICAgICAgICByZXR1cm4gJ1tMT0JdJzsNCiAgICAgIGNhc2UgYWREYXRlOg0KICAgICAgY2FzZSBhZERCRGF0ZToNCiAgICAgIGNhc2UgYWREQlRpbWU6DQogICAgICBjYXNlIGFkREJUaW1lU3RhbXA6DQogICAgICAgIHJldHVybiBuZXcgRGF0ZShmaWVsZC52YWx1ZSk7DQogICAgICBkZWZhdWx0Og0KICAgICAgICByZXR1cm4gZmllbGQudmFsdWU7DQogICAgfQ0KICB9Ow0KDQogIEFkb2RiLnByb3RvdHlwZS5lYWNoUm93ID0gZnVuY3Rpb24gZWFjaFJvdyAoKSB7CiAgICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07Cg0KICAgIHZhciBvcCA9IHRoaXMuZ2V0T3B0aW9ucyhhcmdzKTsNCiAgICB0aGlzLnNlbGVjdChvcCk7DQogIH07DQoNCiAgQWRvZGIucHJvdG90eXBlLmZpcnN0Um93ID0gZnVuY3Rpb24gZmlyc3RSb3cgKCkgewogICAgICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdOwoNCiAgICB2YXIgb3AgPSB0aGlzLmdldE9wdGlvbnMoYXJncyksDQogICAgICBfcm93Ow0KICAgIG9wLmNhbGxiYWNrID0gZnVuY3Rpb24gKHJvdykgeyByZXR1cm4gKChfcm93ID0gcm93KSwgZmFsc2UpOyB9Ow0KICAgIHRoaXMuc2VsZWN0KG9wKTsNCiAgICByZXR1cm4gX3JvdzsNCiAgfTsNCg0KICBBZG9kYi5wcm90b3R5cGUucm93cyA9IGZ1bmN0aW9uIHJvd3MgKCkgewogICAgICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdOwoNCiAgICB2YXIgb3AgPSB0aGlzLmdldE9wdGlvbnMoYXJncyksDQogICAgICByb3dzID0gW107DQogICAgb3AuY2FsbGJhY2sgPSBmdW5jdGlvbiAocm93KSB7DQogICAgICByb3dzLnB1c2gocm93KTsNCiAgICB9Ow0KICAgIHRoaXMuc2VsZWN0KG9wKTsNCiAgICByZXR1cm4gcm93czsNCiAgfTsNCg0KICBBZG9kYi5wcm90b3R5cGUuYmF0Y2ggPSBmdW5jdGlvbiBiYXRjaCAoY21kLCBmbikgew0KICAgIHZhciBjb25uLCByczsNCiAgICB0cnkgew0KICAgICAgY29ubiA9IHRoaXMuY29ubjsNCiAgICAgIHJzID0gbmV3IEFjdGl2ZVhPYmplY3QoJ0FET0RCLlJlY29yZHNldCcpOw0KICAgICAgcnMuQ3Vyc29yTG9jYXRpb24gPSBhZFVzZUNsaWVudDsNCiAgICAgIHJzLkxvY2tUeXBlID0gYWRMb2NrQmF0Y2hPcHRpbWlzdGljOw0KICAgICAgcnMuQ3Vyc29yVHlwZSA9IGFkT3BlbkR5bmFtaWM7DQogICAgICBycy5PcGVuKGNtZCwgY29ubik7DQogICAgICBmbihycyk7DQogICAgfSBmaW5hbGx5IHsNCiAgICAgIHJzICYmIHJzLlN0YXRlICE9IDAgJiYgcnMuQ2xvc2UoKTsNCiAgICB9DQogIH07DQoNCiAgQWRvZGIucHJvdG90eXBlLnNldEZpZWxkVmFsdWUgPSBmdW5jdGlvbiBzZXRGaWVsZFZhbHVlIChmaWVsZCwgdmFsdWUpIHsNCiAgICBzd2l0Y2ggKHR5cGVPZih2YWx1ZSkpIHsNCiAgICAgIGNhc2UgJ2RhdGUnOg0KICAgICAgICBmaWVsZC5WYWx1ZSA9IGZvcm1hdERhdGUodmFsdWUpOw0KICAgICAgICBicmVhazsNCiAgICAgIGNhc2UgJ3N0cmluZyc6DQogICAgICBjYXNlICdudW1iZXInOg0KICAgICAgICBmaWVsZC5WYWx1ZSA9IHZhbHVlOw0KICAgICAgICBicmVhazsNCiAgICAgIGRlZmF1bHQ6DQogICAgICAgIGZpZWxkLlZhbHVlID0gU3RyaW5nKHZhbHVlKTsNCiAgICAgICAgYnJlYWs7DQogICAgfQ0KICB9Ow0KDQogIEFkb2RiLnByb3RvdHlwZS5iYXRjaF9pbnNlcnQgPSBmdW5jdGlvbiBiYXRjaF9pbnNlcnQgKGNtZCwgcm93cykgew0KICAgIHZhciBzZWxmID0gdGhpczsNCiAgICB0aGlzLmJhdGNoKGNtZCwgZnVuY3Rpb24gKHJzKSB7DQogICAgICBlYWNoKHJvd3MsIGZ1bmN0aW9uIChyb3cpIHsNCiAgICAgICAgcnMuQWRkTmV3KCk7DQogICAgICAgIGVhY2gocm93LCBmdW5jdGlvbiAodiwgaykgew0KICAgICAgICAgIHNlbGYuc2V0RmllbGRWYWx1ZShycy5GaWVsZHMoayksIHYpOw0KICAgICAgICB9KTsNCiAgICAgIH0pOw0KICAgICAgcnMuVXBkYXRlQmF0Y2goKTsNCiAgICB9KTsNCiAgfTsNCg0KICBBZG9kYi5wcm90b3R5cGUudGFibGVFeGlzdHMgPSBmdW5jdGlvbiB0YWJsZUV4aXN0cyAodGFibGVOYW1lKSB7DQogICAgdmFyIGNvbm4sDQogICAgICBycywNCiAgICAgIHJlc3VsdCA9IGZhbHNlLA0KICAgICAgcGFyYW1zID0gW251bGwsIG51bGwsIHRhYmxlTmFtZSwgJ1RBQkxFJ107DQogICAgdHJ5IHsNCiAgICAgIGNvbm4gPSB0aGlzLmNvbm47DQogICAgICBycyA9IGNvbm4uT3BlblNjaGVtYShhZFNjaGVtYVRhYmxlcywgcGFyYW1zKTsNCiAgICAgIGlmICghcnMuRU9GKSB7IHJlc3VsdCA9IHRydWU7IH0NCiAgICB9IGNhdGNoIChlKSB7DQogICAgICB0aHJvdyBlOw0KICAgIH0gZmluYWxseSB7DQogICAgICBycyAmJiBycy5TdGF0ZSAhPSAwICYmIHJzLkNsb3NlKCk7DQogICAgfQ0KICAgIHJldHVybiByZXN1bHQ7DQogIH07DQoNCiAgQWRvZGIucHJvdG90eXBlLmdldFRhYmxlcyA9IGZ1bmN0aW9uIGdldFRhYmxlcyAoKSB7DQogICAgdmFyIGNvbm4sDQogICAgICBycywNCiAgICAgIHJlc3VsdCA9IFtdLA0KICAgICAgY291bnQgPSAwOw0KICAgIHRyeSB7DQogICAgICBjb25uID0gdGhpcy5jb25uOw0KICAgICAgcnMgPSBjb25uLk9wZW5TY2hlbWEoYWRTY2hlbWFUYWJsZXMpOw0KICAgICAgd2hpbGUgKCFycy5FT0YpIHsNCiAgICAgICAgaWYgKHJzLkZpZWxkcygnVEFCTEVfVFlQRScpLlZhbHVlID09PSAnVEFCTEUnKSB7DQogICAgICAgICAgcmVzdWx0W2NvdW50KytdID0gcnMuRmllbGRzKCdUQUJMRV9OQU1FJykuVmFsdWU7DQogICAgICAgIH0NCiAgICAgICAgcnMuTW92ZU5leHQoKTsNCiAgICAgIH0NCiAgICB9IGNhdGNoIChlKSB7DQogICAgICB0aHJvdyBlOw0KICAgIH0gZmluYWxseSB7DQogICAgICBycyAmJiBycy5TdGF0ZSAhPSAwICYmIHJzLkNsb3NlKCk7DQogICAgfQ0KICAgIHJldHVybiByZXN1bHQ7DQogIH07DQoNCiAgZnVuY3Rpb24gZm9ybWF0RGF0ZShkKSB7DQogICAgcmV0dXJuICgNCiAgICAgIGQuZ2V0RnVsbFllYXIoKSArDQogICAgICAnLycgKw0KICAgICAgKGQuZ2V0TW9udGgoKSArIDEpICsNCiAgICAgICcvJyArDQogICAgICBkLmdldERhdGUoKSArDQogICAgICAnICcgKw0KICAgICAgZC5nZXRIb3VycygpICsNCiAgICAgICc6JyArDQogICAgICBkLmdldE1pbnV0ZXMoKSArDQogICAgICAnOicgKw0KICAgICAgZC5nZXRTZWNvbmRzKCkNCiAgICApOw0KICB9CgogIHZhciBhZG9kYiA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgIGFkVXNlQ2xpZW50OiBhZFVzZUNsaWVudCwKICAgIGFkVXNlTm9uZTogYWRVc2VOb25lLAogICAgYWRVc2VTZXJ2ZXI6IGFkVXNlU2VydmVyLAogICAgYWRMb2NrVW5zcGVjaWZpZWQ6IGFkTG9ja1Vuc3BlY2lmaWVkLAogICAgYWRMb2NrUmVhZE9ubHk6IGFkTG9ja1JlYWRPbmx5LAogICAgYWRMb2NrUGVzc2ltaXN0aWM6IGFkTG9ja1Blc3NpbWlzdGljLAogICAgYWRMb2NrT3B0aW1pc3RpYzogYWRMb2NrT3B0aW1pc3RpYywKICAgIGFkTG9ja0JhdGNoT3B0aW1pc3RpYzogYWRMb2NrQmF0Y2hPcHRpbWlzdGljLAogICAgYWRPcGVuVW5zcGVjaWZpZWQ6IGFkT3BlblVuc3BlY2lmaWVkLAogICAgYWRPcGVuRm9yd2FyZE9ubHk6IGFkT3BlbkZvcndhcmRPbmx5LAogICAgYWRPcGVuS2V5c2V0OiBhZE9wZW5LZXlzZXQsCiAgICBhZE9wZW5EeW5hbWljOiBhZE9wZW5EeW5hbWljLAogICAgYWRPcGVuU3RhdGljOiBhZE9wZW5TdGF0aWMsCiAgICBhZEJpZ0ludDogYWRCaWdJbnQsCiAgICBhZEJpbmFyeTogYWRCaW5hcnkkMSwKICAgIGFkQm9vbGVhbjogYWRCb29sZWFuLAogICAgYWRDaGFyOiBhZENoYXIsCiAgICBhZEN1cnJlbmN5OiBhZEN1cnJlbmN5LAogICAgYWREYXRlOiBhZERhdGUsCiAgICBhZERCRGF0ZTogYWREQkRhdGUsCiAgICBhZERCVGltZTogYWREQlRpbWUsCiAgICBhZERCVGltZVN0YW1wOiBhZERCVGltZVN0YW1wLAogICAgYWREZWNpbWFsOiBhZERlY2ltYWwsCiAgICBhZERvdWJsZTogYWREb3VibGUsCiAgICBhZEdVSUQ6IGFkR1VJRCwKICAgIGFkSURpc3BhdGNoOiBhZElEaXNwYXRjaCwKICAgIGFkSW50ZWdlcjogYWRJbnRlZ2VyLAogICAgYWRMb25nVmFyQmluYXJ5OiBhZExvbmdWYXJCaW5hcnksCiAgICBhZExvbmdWYXJDaGFyOiBhZExvbmdWYXJDaGFyLAogICAgYWRMb25nVmFyV0NoYXI6IGFkTG9uZ1ZhcldDaGFyLAogICAgYWROdW1lcmljOiBhZE51bWVyaWMsCiAgICBhZFNpbmdsZTogYWRTaW5nbGUsCiAgICBhZFNtYWxsSW50OiBhZFNtYWxsSW50LAogICAgYWRVbnNpZ25lZFRpbnlJbnQ6IGFkVW5zaWduZWRUaW55SW50LAogICAgYWRWYXJCaW5hcnk6IGFkVmFyQmluYXJ5LAogICAgYWRWYXJDaGFyOiBhZFZhckNoYXIsCiAgICBhZFZhcmlhbnQ6IGFkVmFyaWFudCwKICAgIGFkVmFyV0NoYXI6IGFkVmFyV0NoYXIsCiAgICBhZFdDaGFyOiBhZFdDaGFyLAogICAgYWRQYXJhbVVua25vd246IGFkUGFyYW1Vbmtub3duLAogICAgYWRQYXJhbUlucHV0OiBhZFBhcmFtSW5wdXQsCiAgICBhZFBhcmFtT3V0cHV0OiBhZFBhcmFtT3V0cHV0LAogICAgYWRQYXJhbUlucHV0T3V0cHV0OiBhZFBhcmFtSW5wdXRPdXRwdXQsCiAgICBhZFBhcmFtUmV0dXJuVmFsdWU6IGFkUGFyYW1SZXR1cm5WYWx1ZSwKICAgIGFkU2NoZW1hVGFibGVzOiBhZFNjaGVtYVRhYmxlcywKICAgIGFkU2NoZW1hQ29sdW1uczogYWRTY2hlbWFDb2x1bW5zLAogICAgQWRvZGI6IEFkb2RiCiAgfSk7CgogIHZhciBBY2NEQiA9IC8qQF9fUFVSRV9fKi8oZnVuY3Rpb24gKEFkb2RiKSB7CiAgICBmdW5jdGlvbiBBY2NEQihwYXRoKSB7DQogICAgICBpZiAoIWlzQWJzb2x1dGUocGF0aCkpIHsNCiAgICAgICAgcGF0aCA9IG5vcm1hbGl6ZShwYXRoKTsNCiAgICAgIH0NCiAgICAgIGlmICghaXNmaWxlKHBhdGgpKSB7DQogICAgICAgIHZhciBhcHAgPSBuZXcgQWN0aXZlWE9iamVjdCgnQWNjZXNzLkFwcGxpY2F0aW9uJyk7DQogICAgICAgIGFwcC5OZXdDdXJyZW50RGF0YWJhc2UocGF0aCk7DQogICAgICB9DQogICAgICBBZG9kYi5jYWxsKHRoaXMpOw0KICAgICAgdGhpcy5jb25uLkNvbm5lY3Rpb25TdHJpbmcgPSAiUHJvdmlkZXI9TWljcm9zb2Z0LkFjZS5PTEVEQi4xMi4wO0RhdGEgU291cmNlPSIgKyBwYXRoOw0KICAgICAgdGhpcy5jb25uLk9wZW4oKTsNCiAgICB9CgogICAgaWYgKCBBZG9kYiApIEFjY0RCLl9fcHJvdG9fXyA9IEFkb2RiOwogICAgQWNjREIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggQWRvZGIgJiYgQWRvZGIucHJvdG90eXBlICk7CiAgICBBY2NEQi5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBBY2NEQjsKCiAgICByZXR1cm4gQWNjREI7CiAgfShBZG9kYikpOw0KDQogIGZ1bmN0aW9uIGFjY2RiKHB0aCkgew0KICAgIHJldHVybiBuZXcgQWNjREIocHRoKTsNCiAgfQoKICB2YXIgYWNjZGIkMSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgIEFjY0RCOiBBY2NEQiwKICAgICdkZWZhdWx0JzogYWNjZGIKICB9KTsKCiAgdmFyIENzdkRCID0gLypAX19QVVJFX18qLyhmdW5jdGlvbiAoQWRvZGIpIHsKICAgIGZ1bmN0aW9uIENzdkRCKHBhdGgsIGhhc0hlYWRlcikgew0KICAgICAgaWYgKCFpc0Fic29sdXRlKHBhdGgpKSB7DQogICAgICAgIHBhdGggPSBub3JtYWxpemUocGF0aCk7DQogICAgICB9DQogICAgICBpZiAoaXNmaWxlKHBhdGgpKSB7IHBhdGggPSBkaXJuYW1lKHBhdGgpOyB9DQogICAgICB2YXIgaGRyID0NCiAgICAgICAgaGFzSGVhZGVyID09IG51bGwgfHwgaGFzSGVhZGVyID09IHRydWUgfHwgaGFzSGVhZGVyID09ICdZRVMnDQogICAgICAgICAgPyAnWUVTJw0KICAgICAgICAgIDogJ05PJzsNCiAgICAgIEFkb2RiLmNhbGwodGhpcyk7DQogICAgICB0aGlzLmNvbm4uQ29ubmVjdGlvblN0cmluZyA9ICJQcm92aWRlcj1NaWNyb3NvZnQuQWNlLk9MRURCLjEyLjA7RGF0YSBTb3VyY2U9IiArIHBhdGggKyAiO0V4dGVuZGVkIFByb3BlcnRpZXM9XCJUZXh0O0hEUj0iICsgaGRyICsgIjtGTVQ9RGVsaW1pdGVkXCIiOw0KICAgICAgdGhpcy5jb25uLk9wZW4oKTsNCiAgICB9CgogICAgaWYgKCBBZG9kYiApIENzdkRCLl9fcHJvdG9fXyA9IEFkb2RiOwogICAgQ3N2REIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggQWRvZGIgJiYgQWRvZGIucHJvdG90eXBlICk7CiAgICBDc3ZEQi5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBDc3ZEQjsKCiAgICByZXR1cm4gQ3N2REI7CiAgfShBZG9kYikpOw0KDQogIGZ1bmN0aW9uIGNzdmRiKHBhdGgsIGhhc0hlYWRlcikgew0KICAgIHJldHVybiBuZXcgQ3N2REIocGF0aCwgaGFzSGVhZGVyKTsNCiAgfQoKICB2YXIgY3N2ZGIkMSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgIENzdkRCOiBDc3ZEQiwKICAgICdkZWZhdWx0JzogY3N2ZGIKICB9KTsKCiAgdmFyIEVYQ0VMX1RZUEUgPSB7DQogICAgeGxzOiAnRXhjZWwgOC4wJywNCiAgICB4bHN4OiAnRXhjZWwgMTIuMCBYbWwnLA0KICAgIHhsc2I6ICdFeGNlbCAxMi4wJywNCiAgICB4bHNtOiAnRXhjZWwgMTIuMCBNYWNybycNCiAgfTsNCg0KICB2YXIgRXhjZWxEQiA9IC8qQF9fUFVSRV9fKi8oZnVuY3Rpb24gKEFkb2RiKSB7CiAgICBmdW5jdGlvbiBFeGNlbERCKHBhdGgsIGhhc0hlYWRlcikgew0KICAgICAgaWYgKCFpc0Fic29sdXRlKHBhdGgpKSB7DQogICAgICAgIHBhdGggPSBub3JtYWxpemUocGF0aCk7DQogICAgICB9DQogICAgICB2YXIgZXh0ID0gZXh0bmFtZShwYXRoKS50b0xvd2VyQ2FzZSgpOw0KICAgICAgdmFyIGhkciA9DQogICAgICAgIGhhc0hlYWRlciA9PSBudWxsIHx8IGhhc0hlYWRlciA9PSB0cnVlIHx8IGhhc0hlYWRlciA9PSAnWUVTJw0KICAgICAgICAgID8gJ1lFUycNCiAgICAgICAgICA6ICdOTyc7DQogICAgICBpZiAoIUVYQ0VMX1RZUEVbZXh0XSkgeyB0aHJvdyBuZXcgRXJyb3IoZXh0ICsgJyBmaWxlIGlzIG5vdCBzdXBwb3J0ZWQnKTsgfQ0KICAgICAgQWRvZGIuY2FsbCh0aGlzKTsNCiAgICAgIHRoaXMuY29ubi5Db25uZWN0aW9uU3RyaW5nID0gIlByb3ZpZGVyPU1pY3Jvc29mdC5BY2UuT0xFREIuMTIuMDtEYXRhIFNvdXJjZT0iICsgcGF0aCArICI7RXh0ZW5kZWQgUHJvcGVydGllcz1cIiIgKyAoRVhDRUxfVFlQRVtleHRdKSArICI7SERSPSIgKyBoZHIgKyAiXCIiOw0KICAgICAgdGhpcy5jb25uLk9wZW4oKTsNCiAgICB9CgogICAgaWYgKCBBZG9kYiApIEV4Y2VsREIuX19wcm90b19fID0gQWRvZGI7CiAgICBFeGNlbERCLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEFkb2RiICYmIEFkb2RiLnByb3RvdHlwZSApOwogICAgRXhjZWxEQi5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBFeGNlbERCOwoKICAgIHJldHVybiBFeGNlbERCOwogIH0oQWRvZGIpKTsNCg0KICBmdW5jdGlvbiBleGNlbGRiKHBhdGgsIGhhc0hlYWRlcikgew0KICAgIHJldHVybiBuZXcgRXhjZWxEQihwYXRoLCBoYXNIZWFkZXIpOw0KICB9CgogIHZhciBleGNlbGRiJDEgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICBFeGNlbERCOiBFeGNlbERCLAogICAgJ2RlZmF1bHQnOiBleGNlbGRiCiAgfSk7CgogIHZhciBPcmFjbGVEQiA9IC8qQF9fUFVSRV9fKi8oZnVuY3Rpb24gKEFkb2RiKSB7CiAgICBmdW5jdGlvbiBPcmFjbGVEQihkcywgdXNyLCBwYXNzKSB7DQogICAgICB0cnkgew0KICAgICAgICBBZG9kYi5jYWxsKHRoaXMpOw0KICAgICAgICB0aGlzLmNvbm4uQ29ubmVjdGlvblN0cmluZyA9DQogICAgICAgICAgLy8gPSBgUHJvdmlkZXI9T3JhT0xFREIuT3JhY2xlO0RhdGEgU291cmNlPSR7ZHN9O1VzZXIgSUQ9JHt1c3J9O1Bhc3N3b3JkPSR7cGFzc31gOw0KICAgICAgICAgICJQcm92aWRlcj1NU0RBT1JBO0RhdGEgU291cmNlPSIgKyBkcyArICI7VXNlciBJRD0iICsgdXNyICsgIjtQYXNzd29yZD0iICsgcGFzczsNCiAgICAgICAgdGhpcy5jb25uLk9wZW4oKTsNCiAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgY29uc29sZS5sb2coJ0RhdGFiYXNlIGNvbm5lY3QgZmFpbGVkLicpOw0KICAgICAgICBjb25zb2xlLmxvZygNCiAgICAgICAgICAnZGF0YXNvdXJjZTogJXNcbiAgICB1c2VyaWQ6ICVzXG4gIHBhc3N3b3JkOiAlcycsDQogICAgICAgICAgZHMsDQogICAgICAgICAgdXNyLA0KICAgICAgICAgIHBhc3MNCiAgICAgICAgKTsNCiAgICAgICAgdGhyb3cgZTsNCiAgICAgIH0NCiAgICB9CgogICAgaWYgKCBBZG9kYiApIE9yYWNsZURCLl9fcHJvdG9fXyA9IEFkb2RiOwogICAgT3JhY2xlREIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggQWRvZGIgJiYgQWRvZGIucHJvdG90eXBlICk7CiAgICBPcmFjbGVEQi5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBPcmFjbGVEQjsNCg0KICAgIE9yYWNsZURCLnByb3RvdHlwZS5nZXREYXRhVHlwZU1hcHBpbmcgPSBmdW5jdGlvbiBnZXREYXRhVHlwZU1hcHBpbmcgKCkgew0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgc3RyaW5nOiBhZFZhcmlhbnQsDQogICAgICAgIGludDogYWRJbnRlZ2VyLA0KICAgICAgICBkZWNpbWFsOiBhZE51bWVyaWMsDQogICAgICAgIGJvb2xlYW46IGFkQm9vbGVhbiwNCiAgICAgICAgZGF0ZTogYWREQlRpbWVTdGFtcCwNCiAgICAgICAgYnVmZmVyOiBhZEJpbmFyeSwNCiAgICAgICAgbnVsbDogYWRWYXJpYW50LA0KICAgICAgICB1bmRlZmluZWQ6IGFkVmFyaWFudA0KICAgICAgfTsNCiAgICB9Ow0KDQogICAgT3JhY2xlREIucHJvdG90eXBlLnRhYmxlRXhpc3RzID0gZnVuY3Rpb24gdGFibGVFeGlzdHMgKHRhYmxlTmFtZSkgew0KICAgICAgdmFyIHJvdyA9IHRoaXMuZmlyc3RSb3coJ3NlbGVjdCAxIGZyb20gdXNlcl90YWJsZXMgd2hlcmUgdGFibGVfbmFtZSA9ID8nLCBbDQogICAgICAgIHRhYmxlTmFtZQ0KICAgICAgXSk7DQogICAgICByZXR1cm4gcm93ICE9IG51bGw7DQogICAgfTsNCg0KICAgIE9yYWNsZURCLnByb3RvdHlwZS5nZXRUYWJsZXMgPSBmdW5jdGlvbiBnZXRUYWJsZXMgKCkgew0KICAgICAgdmFyIHJvd3MgPSB0aGlzLnJvd3MoJ3NlbGVjdCB0YWJsZV9uYW1lIGZyb20gdXNlcl90YWJsZXMnKTsNCiAgICAgIHJldHVybiByb3dzLm1hcChmdW5jdGlvbiAoaXQpIHsgcmV0dXJuIGl0LlRBQkxFX05BTUU7IH0pOw0KICAgIH07CgogICAgcmV0dXJuIE9yYWNsZURCOwogIH0oQWRvZGIpKTsNCg0KICBmdW5jdGlvbiBvcmFjbGVkYihkcywgdXNyLCBwYXNzKSB7DQogICAgcmV0dXJuIG5ldyBPcmFjbGVEQihkcywgdXNyLCBwYXNzKTsNCiAgfQ0KDQogIC8vIE9yYU9MRURCDQoNCiAgdmFyIF92YnMkMSwgX3Nlc3Npb247DQoNCiAgdmFyIE9vNG8gPSAvKkBfX1BVUkVfXyovKGZ1bmN0aW9uIChBZG9kYikgewogICAgZnVuY3Rpb24gT280byhkcywgdXNlciwgcGFzcykgew0KICAgICAgQWRvZGIuY2FsbCh0aGlzKTsNCiAgICAgIHRoaXMuZGF0YUJhc2UgPSB0aGlzLnNlc3Npb24uT3BlbkRhdGFiYXNlKGRzLCB1c2VyICsgJy8nICsgcGFzcywgMCk7DQogICAgfQoKICAgIGlmICggQWRvZGIgKSBPbzRvLl9fcHJvdG9fXyA9IEFkb2RiOwogICAgT280by5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBBZG9kYiAmJiBBZG9kYi5wcm90b3R5cGUgKTsKICAgIE9vNG8ucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gT280bzsKCiAgICB2YXIgcHJvdG90eXBlQWNjZXNzb3JzID0geyB2YnM6IHsgY29uZmlndXJhYmxlOiB0cnVlIH0sc2Vzc2lvbjogeyBjb25maWd1cmFibGU6IHRydWUgfSB9Ow0KDQogICAgcHJvdG90eXBlQWNjZXNzb3JzLnZicy5nZXQgPSBmdW5jdGlvbiAoKSB7DQogICAgICBpZiAoIV92YnMkMSkgew0KICAgICAgICBfdmJzJDEgPSBfX1ZCUzsNCiAgICAgICAgX3ZicyQxLkFkZENvZGUoIlxuRnVuY3Rpb24gUmVhZEJsb2IoZmllbGQpXG4gIERpbSBidWYoKVxuICBmaWVsZC5HZXRDaHVua0J5dGVFeCBidWYsIDAsIGZpZWxkLkZpZWxkU2l6ZSgpXG4gIFJlYWRCbG9iID0gYnVmXG5FbmQgRnVuY3Rpb25cblxuRnVuY3Rpb24gUmVhZENsb2IoZmllbGQpXG4gIERpbSBidWZcbiAgZmllbGQuVmFsdWUuUmVhZCBidWZcbiAgUmVhZENsb2IgPSBidWZcbkVuZCBGdW5jdGlvblxuICAgICAgIik7DQogICAgICB9DQogICAgICByZXR1cm4gX3ZicyQxLkNvZGVPYmplY3Q7DQogICAgfTsNCg0KICAgIHByb3RvdHlwZUFjY2Vzc29ycy5zZXNzaW9uLmdldCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgIGlmICghX3Nlc3Npb24pIHsNCiAgICAgICAgX3Nlc3Npb24gPSBuZXcgQWN0aXZlWE9iamVjdCgnT3JhY2xlSW5Qcm9jU2VydmVyLlhPcmFTZXNzaW9uJyk7DQogICAgICB9DQogICAgICByZXR1cm4gX3Nlc3Npb247DQogICAgfTsKCiAgICBPbzRvLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uIGNsb3NlICgpIHsNCiAgICAgIHRoaXMuZGF0YUJhc2UuQ2xvc2UoKTsNCiAgICAgIHRoaXMuZGF0YUJhc2UgPSBudWxsOw0KICAgICAgX3Nlc3Npb24gPSBudWxsOw0KICAgIH07DQoNCiAgICBPbzRvLnByb3RvdHlwZS5iZWdpbiA9IGZ1bmN0aW9uIGJlZ2luICgpIHsNCiAgICAgIHRoaXMuc2Vzc2lvbi5CZWdpblRyYW5zKCk7DQogICAgfTsNCg0KICAgIE9vNG8ucHJvdG90eXBlLmNvbW1pdCA9IGZ1bmN0aW9uIGNvbW1pdCAoKSB7DQogICAgICB0aGlzLnNlc3Npb24uQ29tbWl0VHJhbnMoKTsNCiAgICB9Ow0KDQogICAgT280by5wcm90b3R5cGUucm9sbGJhY2sgPSBmdW5jdGlvbiByb2xsYmFjayAoKSB7DQogICAgICB0aGlzLnNlc3Npb24uUm9sbGJhY2soKTsNCiAgICB9Ow0KDQogICAgT280by5wcm90b3R5cGUuZ2V0RGF0YVR5cGVNYXBwaW5nID0gZnVuY3Rpb24gZ2V0RGF0YVR5cGVNYXBwaW5nICgpIHsNCiAgICAgIHJldHVybiB7DQogICAgICAgIHN0cmluZzogMSwNCiAgICAgICAgaW50OiAyLA0KICAgICAgICBkZWNpbWFsOiAyLA0KICAgICAgICBudW1iZXI6IDIsDQogICAgICAgIGJvb2xlYW46IDEsDQogICAgICAgIGRhdGU6IDEyLA0KICAgICAgICBidWZmZXI6IDExMywNCiAgICAgICAgbnVsbDogMSwNCiAgICAgICAgdW5kZWZpbmVkOiAxDQogICAgICB9Ow0KICAgIH07DQoNCiAgICBPbzRvLnByb3RvdHlwZS5jcmVhdGVQYXJhbXMgPSBmdW5jdGlvbiBjcmVhdGVQYXJhbXMgKG9wdHMpIHsNCiAgICAgIHZhciBwYXJhbXMgPSBvcHRzLnBhcmFtcywNCiAgICAgICAgc2VsZiA9IHRoaXM7DQogICAgICBpZiAoIXBhcmFtcykgeyByZXR1cm47IH0NCiAgICAgIHZhciBkdG1hcCA9IHRoaXMuZ2V0RGF0YVR5cGVNYXBwaW5nKCk7DQogICAgICBlYWNoKHBhcmFtcywgZnVuY3Rpb24gKHYsIGspIHsNCiAgICAgICAgdmFyIHR5cGUgPSBkdG1hcFt0eXBlT2YodildIHx8IDE7DQogICAgICAgIHNlbGYuZGF0YUJhc2UuUGFyYW1ldGVycy5BZGQoU3RyaW5nKGspLCB2LCAxLCB0eXBlKTsNCg0KICAgICAgICBpZiAoaXNBcnJheShwYXJhbXMpICYmIG9wdHMuc3FsLmluY2x1ZGVzKCc/JykpIHsNCiAgICAgICAgICB2YXIgaW5kZXggPSAwOw0KICAgICAgICAgIG9wdHMuc3FsID0gb3B0cy5zcWwucmVwbGFjZSgvXD8vZywgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgcmV0dXJuICc6JyArIGluZGV4Kys7DQogICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgIH07DQoNCiAgICBPbzRvLnByb3RvdHlwZS5yZW1vdmVQYXJhbXMgPSBmdW5jdGlvbiByZW1vdmVQYXJhbXMgKG9wdHMpIHsNCiAgICAgIHZhciBwYXJhbXMgPSBvcHRzLnBhcmFtcywNCiAgICAgICAgc2VsZiA9IHRoaXM7DQogICAgICBpZiAoIXBhcmFtcykgeyByZXR1cm47IH0NCiAgICAgIGVhY2gocGFyYW1zLCBmdW5jdGlvbiAodiwgaykgew0KICAgICAgICBzZWxmLmRhdGFCYXNlLlBhcmFtZXRlcnMuUmVtb3ZlKFN0cmluZyhrKSk7DQogICAgICB9KTsNCiAgICB9Ow0KDQogICAgT280by5wcm90b3R5cGUuZXhlY3V0ZSA9IGZ1bmN0aW9uIGV4ZWN1dGUgKCkgewogICAgICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdOwoNCiAgICAgIHZhciBvcHRzID0gdGhpcy5nZXRPcHRpb25zKGFyZ3MpOw0KICAgICAgdHJ5IHsNCiAgICAgICAgdGhpcy5jcmVhdGVQYXJhbXMob3B0cyk7DQogICAgICAgIHJldHVybiB0aGlzLmRhdGFCYXNlLkV4ZWN1dGVTUUwob3B0cy5zcWwpOw0KICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICBlLnNxbCA9IG9wdHMuc3FsOw0KICAgICAgICB0aHJvdyBlOw0KICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgdGhpcy5yZW1vdmVQYXJhbXMob3B0cyk7DQogICAgICB9DQogICAgfTsNCg0KICAgIE9vNG8ucHJvdG90eXBlLnNlbGVjdCA9IGZ1bmN0aW9uIHNlbGVjdCAoKSB7CiAgICAgIHZhciBhcmdzID0gW10sIGxlbiQxID0gYXJndW1lbnRzLmxlbmd0aDsKICAgICAgd2hpbGUgKCBsZW4kMS0tICkgYXJnc1sgbGVuJDEgXSA9IGFyZ3VtZW50c1sgbGVuJDEgXTsKDQogICAgICB2YXIgcnMsDQogICAgICAgIHJvdywNCiAgICAgICAgaSwNCiAgICAgICAgbGVuLA0KICAgICAgICBvcHRzID0gdGhpcy5nZXRPcHRpb25zKGFyZ3MpOw0KICAgICAgdHJ5IHsNCiAgICAgICAgdGhpcy5jcmVhdGVQYXJhbXMob3B0cyk7DQogICAgICAgIHJzID0gdGhpcy5kYXRhQmFzZS5DcmVhdGVEeW5hc2V0KG9wdHMuc3FsLCAwKTsNCiAgICAgICAgd2hpbGUgKCFycy5FT0YpIHsNCiAgICAgICAgICByb3cgPSB7fTsNCiAgICAgICAgICBpZiAobGVuID09IG51bGwpIHsgbGVuID0gcnMuRmllbGRzLkNvdW50OyB9DQogICAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7DQogICAgICAgICAgICByb3dbcnMuRmllbGRzKGkpLk5hbWVdID0gdGhpcy5nZXRGaWVsZFZhbHVlKHJzLkZpZWxkcyhpKSk7DQogICAgICAgICAgfQ0KICAgICAgICAgIGlmIChvcHRzLmNhbGxiYWNrKHJvdykgPT09IGZhbHNlKSB7IGJyZWFrOyB9DQogICAgICAgICAgcnMuTW92ZU5leHQoKTsNCiAgICAgICAgfQ0KICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICBlLnNxbCA9IG9wdHMuc3FsOw0KICAgICAgICB0aHJvdyBlOw0KICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgdGhpcy5yZW1vdmVQYXJhbXMob3B0cyk7DQogICAgICAgIHJzICYmIHJzLkNsb3NlKCk7DQogICAgICB9DQogICAgfTsNCg0KICAgIE9vNG8ucHJvdG90eXBlLmdldEZpZWxkVmFsdWUgPSBmdW5jdGlvbiBnZXRGaWVsZFZhbHVlIChmaWVsZCkgew0KICAgICAgc3dpdGNoIChmaWVsZC5PcmFJRGF0YVR5cGUpIHsNCiAgICAgICAgY2FzZSAyOg0KICAgICAgICBjYXNlIDg6DQogICAgICAgICAgcmV0dXJuIE51bWJlcihmaWVsZC52YWx1ZSk7DQogICAgICAgIGNhc2UgMTEyOg0KICAgICAgICAgIHJldHVybiB0aGlzLnZicy5SZWFkQ2xvYihmaWVsZCk7DQogICAgICAgIGNhc2UgMTEzOg0KICAgICAgICAgIHJldHVybiBCdWZmZXIuZnJvbSh0aGlzLnZicy5SZWFkQmxvYihmaWVsZCkpOw0KICAgICAgICBjYXNlIDEyOg0KICAgICAgICBjYXNlIDE4NzoNCiAgICAgICAgY2FzZSAxODg6DQogICAgICAgIGNhc2UgMjMyOg0KICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShmaWVsZC52YWx1ZSk7DQogICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgcmV0dXJuIGZpZWxkLnZhbHVlOw0KICAgICAgfQ0KICAgIH07DQoNCiAgICBPbzRvLnByb3RvdHlwZS5iYXRjaCA9IGZ1bmN0aW9uIGJhdGNoICgpIHt9Ow0KDQogICAgT280by5wcm90b3R5cGUuYmF0Y2hfaW5zZXJ0ID0gZnVuY3Rpb24gYmF0Y2hfaW5zZXJ0IChjbWQsIHJvd3MpIHsNCiAgICAgIHZhciBzZWxmID0gdGhpczsNCiAgICAgIHZhciBycyA9IHRoaXMuZGF0YUJhc2UuQ3JlYXRlRHluYXNldChjbWQsIDApOw0KICAgICAgdHJ5IHsNCiAgICAgICAgdGhpcy5iZWdpbigpOw0KICAgICAgICBlYWNoKHJvd3MsIGZ1bmN0aW9uIChyb3cpIHsNCiAgICAgICAgICBycy5BZGROZXcoKTsNCiAgICAgICAgICBlYWNoKHJvdywgZnVuY3Rpb24gKHYsIGspIHsNCiAgICAgICAgICAgIHNlbGYuc2V0RmllbGRWYWx1ZShycy5GaWVsZHMoayksIHYpOw0KICAgICAgICAgIH0pOw0KICAgICAgICAgIHJzLlVwZGF0ZSgpOw0KICAgICAgICB9KTsNCiAgICAgICAgdGhpcy5jb21taXQoKTsNCiAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgdGhpcy5yb2xsYmFjaygpOw0KICAgICAgICB0aHJvdyBlOw0KICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgcnMgJiYgcnMuQ2xvc2UoKTsNCiAgICAgIH0NCiAgICB9OwoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCBPbzRvLnByb3RvdHlwZSwgcHJvdG90eXBlQWNjZXNzb3JzICk7CgogICAgcmV0dXJuIE9vNG87CiAgfShBZG9kYikpOw0KDQogIGZ1bmN0aW9uIG9vNG8oZHMsIHVzZXIsIHBhc3MpIHsNCiAgICByZXR1cm4gbmV3IE9vNG8oZHMsIHVzZXIsIHBhc3MpOw0KICB9CgogIHZhciBvcmFjbGVkYiQxID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgT3JhY2xlREI6IE9yYWNsZURCLAogICAgJ2RlZmF1bHQnOiBvcmFjbGVkYiwKICAgIE9vNG86IE9vNG8sCiAgICBvbzRvOiBvbzRvCiAgfSk7CgogIHZhciBfc2VydmljZTsNCg0KICBmdW5jdGlvbiBnZXRTZXJ2aWNlKCkgew0KICAgIGlmICghX3NlcnZpY2UpIHsNCiAgICAgIHZhciBsb2NhdG9yID0gbmV3IEFjdGl2ZVhPYmplY3QoJ1diZW1TY3JpcHRpbmcuU1diZW1Mb2NhdG9yJyk7DQogICAgICBfc2VydmljZSA9IGxvY2F0b3IuQ29ubmVjdFNlcnZlcignLicsICdyb290XFxDSU1WMicpOw0KICAgIH0NCiAgICByZXR1cm4gX3NlcnZpY2U7DQogIH0NCg0KICBmdW5jdGlvbiBnZXQkMShjbWQpIHsNCiAgICByZXR1cm4gZ2V0U2VydmljZSgpLkdldChjbWQpOw0KICB9DQoNCiAgZnVuY3Rpb24gZXhlYyQxKHdxbCkgew0KICAgIHJldHVybiBnZXRTZXJ2aWNlKCkuRXhlY1F1ZXJ5KHdxbCk7DQogIH0NCg0KICBmdW5jdGlvbiBxdWVyeSh3cWwpIHsNCiAgICB2YXIgcnMgPSBleGVjJDEod3FsKTsNCiAgICB2YXIgcm93cyA9IG1hcChycywgZnVuY3Rpb24gKHJlY29yZCkgew0KICAgICAgcmV0dXJuIHJlZHVjZSgNCiAgICAgICAgcmVjb3JkLlByb3BlcnRpZXNfLA0KICAgICAgICBmdW5jdGlvbiAocm93RGF0YSwgcHJvcCkgew0KICAgICAgICAgIGlmIChwcm9wLlZhbHVlICE9IG51bGwpIHsNCiAgICAgICAgICAgIHJvd0RhdGFbcHJvcC5uYW1lXSA9IHByb3AuSXNBcnJheQ0KICAgICAgICAgICAgICA/IG5ldyBWQkFycmF5KHByb3AuVmFsdWUpLnRvQXJyYXkoKQ0KICAgICAgICAgICAgICA6IHByb3AuVmFsdWU7DQogICAgICAgICAgfQ0KICAgICAgICAgIHJldHVybiByb3dEYXRhOw0KICAgICAgICB9LA0KICAgICAgICB7fQ0KICAgICAgKTsNCiAgICB9KTsNCiAgICBycyA9IG51bGw7DQogICAgcmV0dXJuIHJvd3M7DQogIH0NCg0KICBmdW5jdGlvbiBlYWNoUm93KHdxbCwgY2IpIHsNCiAgICB2YXIgcnMgPSBleGVjJDEod3FsKTsNCiAgICBlYWNoKHJzLCBmdW5jdGlvbiAoaXQpIHsgcmV0dXJuIGNiKGl0KTsgfSk7DQogICAgcnMgPSBudWxsOw0KICB9DQoNCiAgZnVuY3Rpb24gZmlyc3RSb3cod3FsKSB7DQogICAgdmFyIG9iajsNCiAgICB2YXIgcnMgPSBleGVjJDEod3FsKTsNCiAgICBlYWNoKHJzLCBmdW5jdGlvbiAoaXQpIHsNCiAgICAgIG9iaiA9IGl0Ow0KICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0pOw0KICAgIHJzID0gbnVsbDsNCiAgICByZXR1cm4gb2JqOw0KICB9DQoNCiAgZnVuY3Rpb24gY3B1KCkgew0KICAgIHJldHVybiBxdWVyeSgnc2VsZWN0ICogZnJvbSBXaW4zMl9Qcm9jZXNzb3InKVswXTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHN5cygpIHsNCiAgICByZXR1cm4gcXVlcnkoJ3NlbGVjdCAqIGZyb20gV2luMzJfQ29tcHV0ZXJTeXN0ZW0nKVswXTsNCiAgfQ0KDQogIGZ1bmN0aW9uIG9zKCkgew0KICAgIHJldHVybiBxdWVyeSgnc2VsZWN0ICogZnJvbSBXaW4zMl9PcGVyYXRpbmdTeXN0ZW0nKVswXTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNodXRkb3duKGZvcmNlZCkgew0KICAgIHJldHVybiBmaXJzdFJvdygnc2VsZWN0ICogZnJvbSBXaW4zMl9PcGVyYXRpbmdTeXN0ZW0nKS5XaW4zMlNodXRkb3duKA0KICAgICAgMSArIChmb3JjZWQgPyA0IDogMCkNCiAgICApOw0KICB9DQoNCiAgZnVuY3Rpb24gbG9nb2ZmKGZvcmNlZCkgew0KICAgIHJldHVybiBmaXJzdFJvdygnc2VsZWN0ICogZnJvbSBXaW4zMl9PcGVyYXRpbmdTeXN0ZW0nKS5XaW4zMlNodXRkb3duKA0KICAgICAgMCArIChmb3JjZWQgPyA0IDogMCkNCiAgICApOw0KICB9DQoNCiAgZnVuY3Rpb24gcmVzdGFydChmb3JjZWQpIHsNCiAgICByZXR1cm4gZmlyc3RSb3coJ3NlbGVjdCAqIGZyb20gV2luMzJfT3BlcmF0aW5nU3lzdGVtJykuV2luMzJTaHV0ZG93bigNCiAgICAgIDIgKyAoZm9yY2VkID8gNCA6IDApDQogICAgKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHBvd2Vyb2ZmKGZvcmNlZCkgew0KICAgIHJldHVybiBmaXJzdFJvdygnc2VsZWN0ICogZnJvbSBXaW4zMl9PcGVyYXRpbmdTeXN0ZW0nKS5XaW4zMlNodXRkb3duKA0KICAgICAgOCArIChmb3JjZWQgPyA0IDogMCkNCiAgICApOw0KICB9DQoNCiAgZnVuY3Rpb24gcHMobCkgew0KICAgIHZhciBwcm9wcyA9IFsnUHJvY2Vzc0lkJywgJ0NhcHRpb24nXTsNCiAgICBpZiAobCkgeyBwcm9wcy5wdXNoKCdQYXJlbnRQcm9jZXNzSWQnLCAnQ3JlYXRpb25EYXRlJywgJ0NvbW1hbmRMaW5lJyk7IH0NCiAgICByZXR1cm4gbWFwKGV4ZWMkMSgnc2VsZWN0ICogZnJvbSBXaW4zMl9Qcm9jZXNzJyksIGZ1bmN0aW9uIChpdCkgew0KICAgICAgcmV0dXJuIHJlZHVjZShwcm9wcywgZnVuY3Rpb24gKHJvdywgbmFtZSkgeyByZXR1cm4gKChyb3dbbmFtZV0gPSBpdFtuYW1lXSksIHJvdyk7IH0sIHt9KTsNCiAgICB9KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGtpbGwoYXJnKSB7DQogICAgdmFyIHdxbCA9ICdzZWxlY3QgKiBmcm9tIFdpbjMyX1Byb2Nlc3MnOw0KICAgIGlmIChpc1N0cmluZyhhcmcpKSB7IHdxbCArPSAiIHdoZXJlIENhcHRpb249JyIgKyBhcmcgKyAiJyI7IH0NCiAgICBlbHNlIGlmIChpc051bWJlcihhcmcpKSB7IHdxbCArPSAiIHdoZXJlIFByb2Nlc3NJZD0iICsgYXJnOyB9DQogICAgZWxzZSB7IHJldHVybiAtMTsgfQ0KICAgIHJldHVybiBmaXJzdFJvdyh3cWwpLlRlcm1pbmF0ZSgpOw0KICB9DQoNCiAgZnVuY3Rpb24gZW52KCkgew0KICAgIHJldHVybiByZWR1Y2UoDQogICAgICBleGVjJDEoJ3NlbGVjdCAqIGZyb20gV2luMzJfRW52aXJvbm1lbnQnKSwNCiAgICAgIGZ1bmN0aW9uIChyZXN1bHQsIGl0KSB7IHJldHVybiAoKHJlc3VsdFtpdC5OYW1lXSA9IGl0LlZhcmlhYmxlVmFsdWUpLCByZXN1bHQpOyB9LA0KICAgICAge30NCiAgICApOw0KICB9CgogIHZhciB3bWkgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICBnZXQ6IGdldCQxLAogICAgZXhlYzogZXhlYyQxLAogICAgcXVlcnk6IHF1ZXJ5LAogICAgZWFjaFJvdzogZWFjaFJvdywKICAgIGZpcnN0Um93OiBmaXJzdFJvdywKICAgIGNwdTogY3B1LAogICAgc3lzOiBzeXMsCiAgICBvczogb3MsCiAgICBzaHV0ZG93bjogc2h1dGRvd24sCiAgICBsb2dvZmY6IGxvZ29mZiwKICAgIHJlc3RhcnQ6IHJlc3RhcnQsCiAgICBwb3dlcm9mZjogcG93ZXJvZmYsCiAgICBwczogcHMsCiAgICBraWxsOiBraWxsLAogICAgZW52OiBlbnYKICB9KTsKCiAgdmFyIFJFR0VYX1BBUlNFID0gL14oXGR7NH0pWy0vXT8oXGR7MSwyfSlbLS9dPyhcZHsxLDJ9KVteMC05XSooXGR7MSwyfSk/Oj8oXGR7MSwyfSk/Oj8oXGR7MSwyfSk/XC4/KFxkezEsM30pPyQvOw0KICB2YXIgUkVHRVhfRk9STUFUID0gL1xbKFteXF1dKyldfFl7Miw0fXxNezEsNH18RHsxLDJ9fGR7MSw0fXxIezEsMn18aHsxLDJ9fGF8QXxtezEsMn18c3sxLDJ9fFp7MSwyfXxTU1MvZzsNCiAgdmFyIE1TID0gJ21pbGxpc2Vjb25kJzsNCiAgdmFyIFMgPSAnc2Vjb25kJzsNCiAgdmFyIE1JTiA9ICdtaW51dGUnOw0KICB2YXIgSCA9ICdob3VyJzsNCiAgdmFyIEQgPSAnZGF5JzsNCiAgdmFyIFcgPSAnd2Vlayc7DQogIHZhciBNID0gJ21vbnRoJzsNCiAgdmFyIFEgPSAncXVhcnRlcic7DQogIHZhciBZID0gJ3llYXInOw0KICB2YXIgREFURSA9ICdkYXRlJzsNCiAgdmFyIEZPUk1BVF9ERUZBVUxUID0gJ1lZWVktTU0tRERUSEg6bW06c3NaJzsNCiAgdmFyIElOVkFMSURfREFURV9TVFJJTkcgPSAnSW52YWxpZCBEYXRlJzsNCg0KICB2YXIgTHMgPSB7DQogICAgZW46IHsNCiAgICAgIG5hbWU6ICdlbicsDQogICAgICB3ZWVrZGF5czogJ1N1bmRheV9Nb25kYXlfVHVlc2RheV9XZWRuZXNkYXlfVGh1cnNkYXlfRnJpZGF5X1NhdHVyZGF5Jy5zcGxpdCgNCiAgICAgICAgJ18nDQogICAgICApLA0KICAgICAgbW9udGhzOiAnSmFudWFyeV9GZWJydWFyeV9NYXJjaF9BcHJpbF9NYXlfSnVuZV9KdWx5X0F1Z3VzdF9TZXB0ZW1iZXJfT2N0b2Jlcl9Ob3ZlbWJlcl9EZWNlbWJlcicuc3BsaXQoDQogICAgICAgICdfJw0KICAgICAgKQ0KICAgIH0NCiAgfTsNCiAgdmFyIEwgPSAnZW4nOw0KDQogIGZ1bmN0aW9uIHBhcnNlTG9jYWxlKHByZXNldCwgb2JqZWN0LCBpc0xvY2FsKSB7DQogICAgdmFyIGw7DQogICAgaWYgKCFwcmVzZXQpIHsgcmV0dXJuIG51bGw7IH0NCiAgICBpZiAoaXNTdHJpbmcocHJlc2V0KSkgew0KICAgICAgaWYgKExzW3ByZXNldF0pIHsNCiAgICAgICAgbCA9IHByZXNldDsNCiAgICAgIH0NCiAgICAgIGlmIChvYmplY3QpIHsNCiAgICAgICAgTHNbcHJlc2V0XSA9IG9iamVjdDsNCiAgICAgICAgbCA9IHByZXNldDsNCiAgICAgIH0NCiAgICB9IGVsc2Ugew0KICAgICAgdmFyIG5hbWUgPSBwcmVzZXQubmFtZTsNCiAgICAgIExzW25hbWVdID0gcHJlc2V0Ow0KICAgICAgbCA9IG5hbWU7DQogICAgfQ0KICAgIGlmICghaXNMb2NhbCkgeyBMID0gbDsgfQ0KICAgIHJldHVybiBsOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNEYXlqcyhkYXRlKSB7DQogICAgcmV0dXJuIGRhdGUgaW5zdGFuY2VvZiBEYXlqczsNCiAgfQ0KDQogIGZ1bmN0aW9uIGRheWpzKGRhdGUsIGNmZykgew0KICAgIGlmIChpc0RheWpzKGRhdGUpKSB7IHJldHVybiBkYXRlLmNsb25lKCk7IH0NCiAgICB2YXIgX2NmZyA9IHsgZGF0ZTogZGF0ZSB9Ow0KICAgIGlmIChpc1N0cmluZyhjZmcpKSB7DQogICAgICBfY2ZnLmZvcm1hdCA9IGNmZzsNCiAgICB9IGVsc2UgaWYgKGlzT2JqZWN0TGlrZShjZmcpKSB7DQogICAgICBleHRlbmQoX2NmZywgY2ZnKTsNCiAgICB9DQogICAgcmV0dXJuIG5ldyBEYXlqcyhfY2ZnKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIERheWpzKGNmZykgew0KICAgIHRoaXMuJEwgPSBwYXJzZUxvY2FsZShjZmcubG9jYWxlLCBudWxsLCB0cnVlKSB8fCBMOw0KICAgIHRoaXMucGFyc2UoY2ZnKTsNCiAgfQ0KDQogIHZhciBfcHJvdG8gPSBEYXlqcy5wcm90b3R5cGU7DQoNCiAgX3Byb3RvLnBhcnNlID0gZnVuY3Rpb24oY2ZnKSB7DQogICAgdGhpcy4kZCA9IHBhcnNlRGF0ZShjZmcpOw0KICAgIHRoaXMuaW5pdCgpOw0KICB9Ow0KDQogIGZ1bmN0aW9uIHBhcnNlRGF0ZShjZmcpIHsNCiAgICB2YXIgZGF0ZSA9IGNmZy5kYXRlLA0KICAgICAgdXRjID0gY2ZnLnV0YzsNCiAgICBpZiAoZGF0ZSA9PSBudWxsKSB7IHJldHVybiBuZXcgRGF0ZSgpOyB9DQogICAgaWYgKGlzRGF0ZShkYXRlKSkgeyByZXR1cm4gbmV3IERhdGUoZGF0ZSk7IH0NCiAgICBpZiAoaXNTdHJpbmcoZGF0ZSkgJiYgIS9aJC9pLnRlc3QoZGF0ZSkpIHsNCiAgICAgIHZhciBtID0gZGF0ZS5tYXRjaChSRUdFWF9QQVJTRSk7DQogICAgICBpZiAobSkgew0KICAgICAgICBpZiAodXRjKSB7DQogICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKA0KICAgICAgICAgICAgRGF0ZS5VVEMoDQogICAgICAgICAgICAgIG1bMV0sDQogICAgICAgICAgICAgIG1bMl0gLSAxLA0KICAgICAgICAgICAgICBtWzNdLA0KICAgICAgICAgICAgICBtWzRdIHx8IDAsDQogICAgICAgICAgICAgIG1bNV0gfHwgMCwNCiAgICAgICAgICAgICAgbVs2XSB8fCAwLA0KICAgICAgICAgICAgICBtWzddIHx8IDANCiAgICAgICAgICAgICkNCiAgICAgICAgICApOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBuZXcgRGF0ZSgNCiAgICAgICAgICBtWzFdLA0KICAgICAgICAgIG1bMl0gLSAxLA0KICAgICAgICAgIG1bM10sDQogICAgICAgICAgbVs0XSB8fCAwLA0KICAgICAgICAgIG1bNV0gfHwgMCwNCiAgICAgICAgICBtWzZdIHx8IDAsDQogICAgICAgICAgbVs3XSB8fCAwDQogICAgICAgICk7DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiBuZXcgRGF0ZShkYXRlKTsNCiAgfQ0KDQogIF9wcm90by5pbml0ID0gZnVuY3Rpb24oKSB7DQogICAgdmFyICRkID0gdGhpcy4kZDsNCiAgICBleHRlbmQodGhpcywgew0KICAgICAgJHk6ICRkLmdldEZ1bGxZZWFyKCksDQogICAgICAkTTogJGQuZ2V0TW9udGgoKSwNCiAgICAgICREOiAkZC5nZXREYXRlKCksDQogICAgICAkVzogJGQuZ2V0RGF5KCksDQogICAgICAkSDogJGQuZ2V0SG91cnMoKSwNCiAgICAgICRtOiAkZC5nZXRNaW51dGVzKCksDQogICAgICAkczogJGQuZ2V0U2Vjb25kcygpLA0KICAgICAgJG1zOiAkZC5nZXRNaWxsaXNlY29uZHMoKQ0KICAgIH0pOw0KICB9Ow0KDQogIF9wcm90by5pc1ZhbGlkID0gZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuIHRoaXMuJGQudG9TdHJpbmcoKSAhPT0gSU5WQUxJRF9EQVRFX1NUUklORzsNCiAgfTsNCg0KICBfcHJvdG8uaXNTYW1lID0gZnVuY3Rpb24odGhhdCwgdW5pdHMpIHsNCiAgICB2YXIgb3RoZXIgPSBkYXlqcyh0aGF0KTsNCiAgICByZXR1cm4gdGhpcy5zdGFydE9mKHVuaXRzKSA8PSBvdGhlciAmJiBvdGhlciA8PSB0aGlzLmVuZE9mKHVuaXRzKTsNCiAgfTsNCg0KICBfcHJvdG8uaXNBZnRlciA9IGZ1bmN0aW9uKHRoYXQsIHVuaXRzKSB7DQogICAgcmV0dXJuIGRheWpzKHRoYXQpIDwgdGhpcy5zdGFydE9mKHVuaXRzKTsNCiAgfTsNCg0KICBfcHJvdG8uaXNCZWZvcmUgPSBmdW5jdGlvbih0aGF0LCB1bml0cykgew0KICAgIHJldHVybiB0aGlzLmVuZE9mKHVuaXRzKSA8IGRheWpzKHRoYXQpOw0KICB9Ow0KDQogIGVhY2goDQogICAgew0KICAgICAgJHk6IFksDQogICAgICAkTTogTSwNCiAgICAgICRXOiBELA0KICAgICAgJEQ6IERBVEUsDQogICAgICAkSDogSCwNCiAgICAgICRtOiBNSU4sDQogICAgICAkczogUywNCiAgICAgICRtczogTVMNCiAgICB9LA0KICAgIGZ1bmN0aW9uICh1bml0LCBwcm9wKSB7DQogICAgICBfcHJvdG9bdW5pdF0gPSBmdW5jdGlvbihpbnB1dCkgew0KICAgICAgICByZXR1cm4gaW5wdXQgPT0gbnVsbCA/IHRoaXNbcHJvcF0gOiB0aGlzLmNsb25lKCkuJHNldCh1bml0LCBpbnB1dCk7DQogICAgICB9Ow0KICAgIH0NCiAgKTsNCg0KICBfcHJvdG8udmFsdWVPZiA9IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiB0aGlzLiRkLmdldFRpbWUoKTsNCiAgfTsNCg0KICBmdW5jdGlvbiBwcmV0dHlVbml0KHUpIHsNCiAgICB2YXIgc3BlY2lhbCA9IHsNCiAgICAgIE06IE0sDQogICAgICB5OiBZLA0KICAgICAgdzogVywNCiAgICAgIGQ6IEQsDQogICAgICBoOiBILA0KICAgICAgbTogTUlOLA0KICAgICAgczogUywNCiAgICAgIG1zOiBNUywNCiAgICAgIFE6IFENCiAgICB9Ow0KICAgIHJldHVybiAoDQogICAgICBzcGVjaWFsW3VdIHx8DQogICAgICBTdHJpbmcodSB8fCAnJykNCiAgICAgICAgLnRvTG93ZXJDYXNlKCkNCiAgICAgICAgLnJlcGxhY2UoL3MkLywgJycpDQogICAgKTsNCiAgfQ0KDQogIF9wcm90by5zdGFydE9mID0gZnVuY3Rpb24odW5pdHMsIF9zdGFydE9mKSB7DQogICAgLy8gc3RhcnRPZiAtPiBlbmRPZg0KICAgIHZhciBpc1N0YXJ0T2YgPSBfc3RhcnRPZiA9PSBudWxsID8gdHJ1ZSA6IF9zdGFydE9mOw0KICAgIHZhciB1bml0ID0gcHJldHR5VW5pdCh1bml0cyk7DQogICAgdmFyICRNID0gdGhpcy4kTSwNCiAgICAgICRXID0gdGhpcy4kVywNCiAgICAgICREID0gdGhpcy4kRDsNCiAgICB2YXIgY2xvbmUgPSB0aGlzLmNsb25lKCk7DQoNCiAgICBzd2l0Y2ggKHVuaXQpIHsNCiAgICAgIGNhc2UgWToNCiAgICAgICAgcmV0dXJuIGNsb25lLiQkc2V0KGlzU3RhcnRPZiA/IHsgTTogMCwgZGF0ZTogMSB9IDogeyBNOiAxMSwgZGF0ZTogMzEgfSk7DQogICAgICBjYXNlIE06DQogICAgICAgIHJldHVybiBjbG9uZS4kJHNldCgNCiAgICAgICAgICBpc1N0YXJ0T2YgPyB7IE06ICRNLCBkYXRlOiAxIH0gOiB7IE06ICRNICsgMSwgZGF0ZTogMCB9DQogICAgICAgICk7DQogICAgICBjYXNlIEQ6DQogICAgICBjYXNlIERBVEU6DQogICAgICAgIHJldHVybiBjbG9uZS4kc2V0KEgsIGlzU3RhcnRPZiA/IDAgOiAyMyk7DQogICAgICBjYXNlIEg6DQogICAgICAgIHJldHVybiBjbG9uZS4kc2V0KE1JTiwgaXNTdGFydE9mID8gMCA6IDU5KTsNCiAgICAgIGNhc2UgTUlOOg0KICAgICAgICByZXR1cm4gY2xvbmUuJHNldChTLCBpc1N0YXJ0T2YgPyAwIDogNTkpOw0KICAgICAgY2FzZSBTOg0KICAgICAgICByZXR1cm4gY2xvbmUuJHNldChNUywgaXNTdGFydE9mID8gMCA6IDk5OSk7DQogICAgICBjYXNlIFc6IHsNCiAgICAgICAgdmFyIHdlZWtTdGFydCA9IHRoaXMuJGxvY2FsZSgpLndlZWtTdGFydCB8fCAwOw0KICAgICAgICB2YXIgZ2FwID0gKCRXIDwgd2Vla1N0YXJ0ID8gJFcgKyA3IDogJFcpIC0gd2Vla1N0YXJ0Ow0KICAgICAgICByZXR1cm4gY2xvbmUuJHNldChEQVRFLCBpc1N0YXJ0T2YgPyAkRCAtIGdhcCA6ICREICsgKDYgLSBnYXApKTsNCiAgICAgIH0NCiAgICAgIGRlZmF1bHQ6DQogICAgICAgIHJldHVybiBjbG9uZTsNCiAgICB9DQogIH07DQoNCiAgX3Byb3RvLmVuZE9mID0gZnVuY3Rpb24odW5pdHMpIHsNCiAgICByZXR1cm4gdGhpcy5zdGFydE9mKHVuaXRzLCBmYWxzZSk7DQogIH07DQoNCiAgdmFyIFVOSVRfTUVUSE9EID0gZnJvbVBhaXJzKFsNCiAgICBbRCwgJ0RhdGUnXSwNCiAgICBbREFURSwgJ0RhdGUnXSwNCiAgICBbTSwgJ01vbnRoJ10sDQogICAgW1ksICdGdWxsWWVhciddLA0KICAgIFtILCAnSG91cnMnXSwNCiAgICBbTUlOLCAnTWludXRlcyddLA0KICAgIFtTLCAnU2Vjb25kcyddLA0KICAgIFtNUywgJ01pbGxpc2Vjb25kcyddDQogIF0pOw0KDQogIGZ1bmN0aW9uIF9zZXQoc2VsZiwgdW5pdHMsIF9pbnQpIHsNCiAgICB2YXIgdW5pdCA9IHByZXR0eVVuaXQodW5pdHMpOw0KICAgIHZhciB1dGNQYWQgPSAnc2V0JyArIChzZWxmLiR1ID8gJ1VUQycgOiAnJyk7DQogICAgdmFyIG5hbWUgPSBVTklUX01FVEhPRFt1bml0XTsNCiAgICB2YXIgYXJnID0gdW5pdCA9PSBEID8gc2VsZi4kRCArIChfaW50IC0gc2VsZi4kVykgOiBfaW50Ow0KDQogICAgaWYgKG5hbWUpIHsNCiAgICAgIGlmICh1bml0ID09IE0gfHwgdW5pdCA9PSBZKSB7DQogICAgICAgIHZhciBfZCA9IHNlbGYudG9EYXRlKCk7DQogICAgICAgIF9kLnNldERhdGUoMSk7DQogICAgICAgIF9kW3V0Y1BhZCArIG5hbWVdKGFyZyk7DQogICAgICAgIF9kLnNldE1vbnRoKF9kLmdldE1vbnRoKCkgKyAxKTsNCiAgICAgICAgX2Quc2V0RGF0ZSgwKTsNCiAgICAgICAgdmFyIF9sYXN0RGF0ZSA9IF9kLmdldERhdGUoKTsNCiAgICAgICAgaWYgKHNlbGYuJEQgPCBfbGFzdERhdGUpIHsNCiAgICAgICAgICBfZC5zZXREYXRlKHNlbGYuJEQpOw0KICAgICAgICB9DQogICAgICAgIHNlbGYuJGQgPSBfZDsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHNlbGYuJGRbdXRjUGFkICsgbmFtZV0oYXJnKTsNCiAgICAgIH0NCiAgICB9DQogIH0NCg0KICBfcHJvdG8uJHNldCA9IGZ1bmN0aW9uKHVuaXRzLCBfaW50KSB7DQogICAgX3NldCh0aGlzLCB1bml0cywgX2ludCk7DQogICAgdGhpcy5pbml0KCk7DQogICAgcmV0dXJuIHRoaXM7DQogIH07DQoNCiAgX3Byb3RvLiQkc2V0ID0gZnVuY3Rpb24ob3B0aW9ucykgew0KICAgIHZhciBzZWxmID0gdGhpczsNCiAgICBlYWNoKG9wdGlvbnMsIGZ1bmN0aW9uIChfaW50LCB1bml0cykgew0KICAgICAgX3NldChzZWxmLCB1bml0cywgX2ludCk7DQogICAgfSk7DQogICAgdGhpcy5pbml0KCk7DQogICAgcmV0dXJuIHRoaXM7DQogIH07DQoNCiAgX3Byb3RvLnNldCA9IGZ1bmN0aW9uKHVuaXQsIF9pbnQpIHsNCiAgICB2YXIgY2xvbmUgPSB0aGlzLmNsb25lKCk7DQogICAgaWYgKGlzU3RyaW5nKHVuaXQpKSB7DQogICAgICByZXR1cm4gY2xvbmUuJHNldCh1bml0LCBfaW50KTsNCiAgICB9IGVsc2UgaWYgKGlzT2JqZWN0TGlrZSh1bml0KSkgew0KICAgICAgcmV0dXJuIGNsb25lLiQkc2V0KHVuaXQpOw0KICAgIH0NCiAgICByZXR1cm4gY2xvbmU7DQogIH07DQoNCiAgX3Byb3RvLmdldCA9IGZ1bmN0aW9uKHVuaXQpIHsNCiAgICByZXR1cm4gdGhpc1twcmV0dHlVbml0KHVuaXQpXSgpOw0KICB9Ow0KDQogIF9wcm90by5hZGQgPSBmdW5jdGlvbihuLCB1bml0cykgew0KICAgIHZhciBuYW1lID0gcHJldHR5VW5pdCh1bml0cyk7DQogICAgdmFyIGNsb25lID0gdGhpcy5jbG9uZSgpOw0KICAgIG4gPSBOdW1iZXIobik7DQogICAgaWYgKG5hbWUgPT0gVykgeyByZXR1cm4gY2xvbmUuJHNldChEQVRFLCB0aGlzLiREICsgTWF0aC5yb3VuZChuICogNykpOyB9DQogICAgZWxzZSB7IHJldHVybiBjbG9uZS4kc2V0KG5hbWUsIHRoaXNbbmFtZV0oKSArIG4pOyB9DQogIH07DQoNCiAgX3Byb3RvLnN1YnRyYWN0ID0gZnVuY3Rpb24obiwgdW5pdCkgew0KICAgIHJldHVybiB0aGlzLmFkZChuICogLTEsIHVuaXQpOw0KICB9Ow0KDQogIF9wcm90by5mb3JtYXQgPSBmdW5jdGlvbihmbXQpIHsNCiAgICBpZiAoIXRoaXMuaXNWYWxpZCgpKSB7IHJldHVybiBJTlZBTElEX0RBVEVfU1RSSU5HOyB9DQogICAgZm10IHx8IChmbXQgPSBGT1JNQVRfREVGQVVMVCk7DQogICAgdmFyICR5ID0gdGhpcy4keSwNCiAgICAgICRNID0gdGhpcy4kTSwNCiAgICAgICREID0gdGhpcy4kRCwNCiAgICAgICRXID0gdGhpcy4kVywNCiAgICAgICRIID0gdGhpcy4kSCwNCiAgICAgICRtID0gdGhpcy4kbSwNCiAgICAgICRzID0gdGhpcy4kcywNCiAgICAgICRNUyA9IHRoaXMuJE1TOw0KICAgIHZhciBsb2NhbGUgPSB0aGlzLiRsb2NhbGUoKTsNCiAgICB2YXIgd2Vla2RheXMgPSBsb2NhbGUud2Vla2RheXMsDQogICAgICBtb250aHMgPSBsb2NhbGUubW9udGhzOw0KICAgIHZhciB0ek9mZnNldCA9IHRoaXMuJGQuZ2V0VGltZXpvbmVPZmZzZXQoKTsNCiAgICB2YXIgdHpNaW51dGVzID0gTWF0aC5hYnModHpPZmZzZXQpOw0KICAgIHZhciBob3VyT2Zmc2V0ID0gTWF0aC5mbG9vcih0ek1pbnV0ZXMgLyA2MCk7DQogICAgdmFyIG1pbk9mZnNldCA9IHR6TWludXRlcyAlIDYwOw0KICAgIHZhciB6b25lU3RyID0NCiAgICAgICh0ek9mZnNldCA8IDAgPyAnLScgOiAnKycpICsNCiAgICAgIHBhZFN0YXJ0KGhvdXJPZmZzZXQsIDIsICcwJykgKw0KICAgICAgJzonICsNCiAgICAgIHBhZFN0YXJ0KG1pbk9mZnNldCwgMiwgJzAnKTsNCiAgICB2YXIgc2VsZiA9IHRoaXM7DQogICAgdmFyIGdldFNob3J0ID0gZnVuY3Rpb24oYXJyLCBpbmRleCwgZnVsbCwgbGVuZ3RoKSB7DQogICAgICByZXR1cm4gKA0KICAgICAgICAoYXJyICYmIChhcnJbaW5kZXhdIHx8IGFycihzZWxmLCBmbXQpKSkgfHwgZnVsbFtpbmRleF0uc3Vic3RyKDAsIGxlbmd0aCkNCiAgICAgICk7DQogICAgfTsNCg0KICAgIHZhciBtYXRjaGVzID0gew0KICAgICAgWVk6IFN0cmluZygkeSkuc2xpY2UoLTIpLA0KICAgICAgWVlZWTogJHksDQogICAgICBNOiAkTSArIDEsDQogICAgICBNTTogcGFkU3RhcnQoJE0gKyAxLCAyLCAnMCcpLA0KICAgICAgTU1NOiBnZXRTaG9ydChsb2NhbGUubW9udGhzU2hvcnQsICRNLCBtb250aHMsIDMpLA0KICAgICAgTU1NTTogbW9udGhzWyRNXSB8fCAoaXNGdW5jdGlvbihtb250aHMpICYmIG1vbnRocyh0aGlzLCBmbXQpKSwNCiAgICAgIEQ6ICRELA0KICAgICAgREQ6IHBhZFN0YXJ0KCRELCAyLCAnMCcpLA0KICAgICAgZDogJFcsDQogICAgICBkZDogZ2V0U2hvcnQobG9jYWxlLndlZWtkYXlzTWluLCAkVywgd2Vla2RheXMsIDIpLA0KICAgICAgZGRkOiBnZXRTaG9ydChsb2NhbGUud2Vla2RheXNTaG9ydCwgJFcsIHdlZWtkYXlzLCAzKSwNCiAgICAgIGRkZGQ6IHdlZWtkYXlzWyRXXSwNCiAgICAgIEg6ICRILA0KICAgICAgSEg6IHBhZFN0YXJ0KCRILCAyLCAnMCcpLA0KICAgICAgaDogJEggJSAxMiB8fCAxMiwNCiAgICAgIGhoOiBwYWRTdGFydCgkSCAlIDEyIHx8IDEyLCAyLCAnMCcpLA0KICAgICAgYTogJEggPCAxMiA/ICdhbScgOiAncG0nLA0KICAgICAgQTogJEggPCAxMiA/ICdBTScgOiAnUE0nLA0KICAgICAgbTogJG0sDQogICAgICBtbTogcGFkU3RhcnQoJG0sIDIsICcwJyksDQogICAgICBzOiAkcywNCiAgICAgIHNzOiBwYWRTdGFydCgkcywgMiwgJzAnKSwNCiAgICAgIFNTUzogcGFkU3RhcnQoJE1TLCAzLCAnMCcpLA0KICAgICAgWjogem9uZVN0cg0KICAgIH07DQogICAgcmV0dXJuIGZtdC5yZXBsYWNlKFJFR0VYX0ZPUk1BVCwgZnVuY3Rpb24obTAsIG0xKSB7DQogICAgICByZXR1cm4gbTEgfHwgbWF0Y2hlc1ttMF0gfHwgem9uZVN0ci5yZXBsYWNlKCc6JywgJycpOw0KICAgIH0pOw0KICB9Ow0KDQogIF9wcm90by51dGNPZmZzZXQgPSBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gLXRoaXMuJGQuZ2V0VGltZXpvbmVPZmZzZXQoKTsNCiAgfTsNCg0KICBmdW5jdGlvbiBtb250aERpZmYoYSwgYikgew0KICAgIHZhciBkaWZmID0gKGEueWVhcigpIC0gYi55ZWFyKCkpICogMTIgKyBhLm1vbnRoKCkgLSBiLm1vbnRoKCk7DQogICAgdmFyIGFuY2hvciA9IGIuY2xvbmUoKS5hZGQoZGlmZiwgTSk7DQogICAgdmFyIGMgPSBhIC0gYW5jaG9yID4gMDsNCiAgICB2YXIgYW5jaG9yMiA9IGIuY2xvbmUoKS5hZGQoZGlmZiArIChjID8gMSA6IC0xKSwgTSk7DQogICAgcmV0dXJuIGRpZmYgKyAoYSAtIGFuY2hvcikgLyAoYyA/IGFuY2hvcjIgLSBhbmNob3IgOiBhbmNob3IgLSBhbmNob3IyKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1pbGxpU2Vjb25kRGlmZihhLCBiKSB7DQogICAgcmV0dXJuIGEgLSBiICsgKGEudXRjT2Zmc2V0KCkgLSBiLnV0Y09mZnNldCgpKSAqIDYwMDAwOw0KICB9DQoNCiAgZnVuY3Rpb24gYWJzRmxvb3Iobikgew0KICAgIHJldHVybiBuIDwgMCA/IE1hdGguY2VpbChuKSA6IE1hdGguZmxvb3Iobik7DQogIH0NCg0KICBfcHJvdG8uZGlmZiA9IGZ1bmN0aW9uKGlucHV0LCB1bml0cywgX2Zsb2F0KSB7DQogICAgdmFyIHVuaXQgPSBwcmV0dHlVbml0KHVuaXRzKTsNCiAgICB2YXIgdGhhdCA9IGRheWpzKGlucHV0KTsNCiAgICB2YXIgcmVzdWx0Ow0KDQogICAgc3dpdGNoICh1bml0KSB7DQogICAgICBjYXNlIFk6DQogICAgICAgIHJlc3VsdCA9IG1vbnRoRGlmZih0aGlzLCB0aGF0KSAvIDEyOw0KICAgICAgICBicmVhazsNCiAgICAgIGNhc2UgTToNCiAgICAgICAgcmVzdWx0ID0gbW9udGhEaWZmKHRoaXMsIHRoYXQpOw0KICAgICAgICBicmVhazsNCiAgICAgIGNhc2UgUToNCiAgICAgICAgcmVzdWx0ID0gbW9udGhEaWZmKHRoaXMsIHRoYXQpIC8gMzsNCiAgICAgICAgYnJlYWs7DQogICAgICBjYXNlIFc6DQogICAgICAgIHJlc3VsdCA9IG1pbGxpU2Vjb25kRGlmZih0aGlzLCB0aGF0KSAvIDYwNDgwMDAwMDsNCiAgICAgICAgYnJlYWs7DQogICAgICBjYXNlIEQ6DQogICAgICAgIHJlc3VsdCA9IG1pbGxpU2Vjb25kRGlmZih0aGlzLCB0aGF0KSAvIDg2NDAwMDAwOw0KICAgICAgICBicmVhazsNCiAgICAgIGNhc2UgSDoNCiAgICAgICAgcmVzdWx0ID0gbWlsbGlTZWNvbmREaWZmKHRoaXMsIHRoYXQpIC8gMzYwMDAwMDsNCiAgICAgICAgYnJlYWs7DQogICAgICBjYXNlIE1JTjoNCiAgICAgICAgcmVzdWx0ID0gbWlsbGlTZWNvbmREaWZmKHRoaXMsIHRoYXQpIC8gNjAwMDA7DQogICAgICAgIGJyZWFrOw0KICAgICAgY2FzZSBTOg0KICAgICAgICByZXN1bHQgPSBtaWxsaVNlY29uZERpZmYodGhpcywgdGhhdCkgLyAxMDAwOw0KICAgICAgICBicmVhazsNCiAgICAgIGRlZmF1bHQ6DQogICAgICAgIHJlc3VsdCA9IG1pbGxpU2Vjb25kRGlmZih0aGlzLCB0aGF0KTsNCiAgICAgICAgYnJlYWs7DQogICAgfQ0KICAgIHJldHVybiBfZmxvYXQgPyByZXN1bHQgOiBhYnNGbG9vcihyZXN1bHQpOw0KICB9Ow0KDQogIF9wcm90by5kYXlzSW5Nb250aCA9IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiB0aGlzLmVuZE9mKE0pLiREOw0KICB9Ow0KDQogIF9wcm90by4kbG9jYWxlID0gZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuIExzW3RoaXMuJExdOw0KICB9Ow0KDQogIF9wcm90by5sb2NhbGUgPSBmdW5jdGlvbihwcmVzZXQsIG9iamVjdCkgew0KICAgIGlmICghcHJlc2V0KSB7IHJldHVybiB0aGlzLiRMOyB9DQogICAgdmFyIHRoYXQgPSB0aGlzLmNsb25lKCk7DQogICAgdGhhdC4kTCA9IHBhcnNlTG9jYWxlKHByZXNldCwgb2JqZWN0LCB0cnVlKTsNCiAgICByZXR1cm4gdGhhdDsNCiAgfTsNCg0KICBfcHJvdG8uY2xvbmUgPSBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gZGF5anModGhpcy50b0RhdGUoKSwgew0KICAgICAgbG9jYWxlOiB0aGlzLiRMLA0KICAgICAgdXRjOiB0aGlzLiR1DQogICAgfSk7DQogIH07DQoNCiAgX3Byb3RvLnRvRGF0ZSA9IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiBuZXcgRGF0ZSh0aGlzLiRkKTsNCiAgfTsNCg0KICBfcHJvdG8udG9KU09OID0gZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuIHRoaXMudG9JU09TdHJpbmcoKTsNCiAgfTsNCg0KICBfcHJvdG8udG9JU09TdHJpbmcgPSBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gdGhpcy4kZC50b0lTT1N0cmluZygpOw0KICB9Ow0KDQogIF9wcm90by50b1N0cmluZyA9IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiB0aGlzLiRkLnRvVVRDU3RyaW5nKCk7DQogIH07DQoNCiAgZGF5anMucHJvdG90eXBlID0gRGF5anMucHJvdG90eXBlOw0KICBkYXlqcy5pc0RheWpzID0gaXNEYXlqczsNCiAgZGF5anMubG9jYWxlID0gcGFyc2VMb2NhbGU7DQogIGRheWpzLkxzID0gTHM7DQoNCiAgZGF5anMuZXh0ZW5kID0gZnVuY3Rpb24ocGx1Z2luLCBvcHRpb24pIHsNCiAgICBwbHVnaW4ob3B0aW9uLCBEYXlqcywgZGF5anMpOw0KICAgIHJldHVybiBkYXlqczsNCiAgfTsKCiAgdmFyIGRheWpzJDEgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICAnZGVmYXVsdCc6IGRheWpzCiAgfSk7CgogIHZhciBQaXBlID0gZnVuY3Rpb24gUGlwZSh0YXJnZXQpIHsNCiAgICBpZiAodGhpcyBpbnN0YW5jZW9mIFBpcGUpIHsNCiAgICAgIHRoaXMuX3RhcmdldCA9IHRhcmdldDsNCiAgICAgIHRoaXMuXyA9IHRoaXMucGlwZTsNCiAgICB9IGVsc2Ugew0KICAgICAgcmV0dXJuIG5ldyBQaXBlKHRhcmdldCk7DQogICAgfQ0KICB9Ow0KDQogIFBpcGUucHJvdG90eXBlLnBpcGUgPSBmdW5jdGlvbiBwaXBlIChmdW5jKSB7CiAgICAgIHZhciB0aGlzJDEgPSB0aGlzOwogICAgICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoIC0gMTsKICAgICAgd2hpbGUgKCBsZW4tLSA+IDAgKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuICsgMSBdOwoNCiAgICBpZiAoaXNGdW5jdGlvbihmdW5jKSkgew0KICAgICAgaWYgKGFyZ3MubGVuZ3RoID09IDApIHsNCiAgICAgICAgdGhpcy5fdGFyZ2V0ID0gZnVuYyh0aGlzLl90YXJnZXQpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdmFyIF9hcmdzID0gYXJncy5tYXAoZnVuY3Rpb24gKGl0KSB7IHJldHVybiAoaXQgPT09IFBpcGUgPyB0aGlzJDEuX3RhcmdldCA6IGl0KTsgfSk7DQogICAgICAgIHRoaXMuX3RhcmdldCA9IGZ1bmMuYXBwbHkodm9pZCAwLCBfYXJncyk7DQogICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgIHRoaXMuX3RhcmdldCA9IGZ1bmM7DQogICAgfQ0KICAgIHJldHVybiB0aGlzOw0KICB9Ow0KDQogIFBpcGUucHJvdG90eXBlLnZhbHVlID0gZnVuY3Rpb24gdmFsdWUgKCkgew0KICAgIHJldHVybiB0aGlzLl90YXJnZXQ7DQogIH07DQoNCiAgUGlwZS5wcm90b3R5cGUubG9nID0gZnVuY3Rpb24gbG9nIChtc2cpIHsNCiAgICBtc2cgPyBjb25zb2xlLmxvZyhtc2csIHRoaXMuX3RhcmdldCkgOiBjb25zb2xlLmxvZyh0aGlzLl90YXJnZXQpOw0KICAgIHJldHVybiB0aGlzOw0KICB9OwoNCiAgUGlwZS5jcmVhdGUgPSBQaXBlLl9fID0gZnVuY3Rpb24odGFyZ2V0KSB7DQogICAgcmV0dXJuIG5ldyBQaXBlKHRhcmdldCk7DQogIH07CgogIHZhciBwaXBlID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgJ2RlZmF1bHQnOiBQaXBlCiAgfSk7CgogIHZhciBKU19UT0tFTlMgPSAvKChbJyJdKSg/Oig/IVwyfFxcKS58XFwoPzpcclxufFtcc1xTXSkpKihcMik/fGAoPzpbXmBcXCRdfFxcW1xzXFNdfFwkKD8hXHspfFwkXHsoPzpbXnt9XXxce1tefV0qXH0/KSpcfT8pKihgKT8pfChcL1wvLiopfChcL1wqKD86W14qXXxcKig/IVwvKSkqKFwqXC8pPyl8KFwvKD8hXCopKD86XFsoPzooPyFbXF1cXF0pLnxcXC4pKlxdfCg/IVsvXF1cXF0pLnxcXC4pK1wvKD86KD8hXHMqKD86XGJ8W1x1MDA4MC1cdUZGRkYkXFwnIn4oe118WytcLSFdKD8hPSl8XC4/XGQpKXxbZ21peXVzXXsxLDZ9XGIoPyFbXHUwMDgwLVx1RkZGRiRcXF18XHMqKD86WytcLSolJnxePD4hPT8oe118XC8oPyFbLypdKSkpKSl8KDBbeFhdW1xkYS1mQS1GXSt8MFtvT11bMC03XSt8MFtiQl1bMDFdK3woPzpcZCpcLlxkK3xcZCtcLj8pKD86W2VFXVsrLV0/XGQrKT8pfCgoPyFcZCkoPzooPyFccylbJFx3XHUwMDgwLVx1RkZGRl18XFx1W1xkYS1mQS1GXXs0fXxcXHVce1tcZGEtZkEtRl0rXH0pKyl8KC0tfFwrXCt8JiZ8XHxcfHw9PnxcLnszfXwoPzpbK1wtLyUmfF5dfFwqezEsMn18PHsxLDJ9fD57MSwzfXwhPT98PXsxLDJ9KT0/fFs/fi4sOjtbXF0oKXt9XSl8KFxzKyl8KF4kfFtcc1xTXSkvZzsNCg0KICBmdW5jdGlvbiBtYXRjaFRvVG9rZW4obWF0Y2gpIHsNCiAgICB2YXIgdG9rZW4gPSB7IHR5cGU6ICdpbnZhbGlkJywgdmFsdWU6IG1hdGNoWzBdLCBjbG9zZWQ6IHVuZGVmaW5lZCB9Ow0KICAgIGlmIChtYXRjaFsxXSkNCiAgICAgIHsgKHRva2VuLnR5cGUgPSAnc3RyaW5nJyksICh0b2tlbi5jbG9zZWQgPSAhIShtYXRjaFszXSB8fCBtYXRjaFs0XSkpOyB9DQogICAgZWxzZSBpZiAobWF0Y2hbNV0pIHsgdG9rZW4udHlwZSA9ICdjb21tZW50JzsgfQ0KICAgIGVsc2UgaWYgKG1hdGNoWzZdKSB7ICh0b2tlbi50eXBlID0gJ2NvbW1lbnQnKSwgKHRva2VuLmNsb3NlZCA9ICEhbWF0Y2hbN10pOyB9DQogICAgZWxzZSBpZiAobWF0Y2hbOF0pIHsgdG9rZW4udHlwZSA9ICdyZWdleCc7IH0NCiAgICBlbHNlIGlmIChtYXRjaFs5XSkgeyB0b2tlbi50eXBlID0gJ251bWJlcic7IH0NCiAgICBlbHNlIGlmIChtYXRjaFsxMF0pIHsgdG9rZW4udHlwZSA9ICduYW1lJzsgfQ0KICAgIGVsc2UgaWYgKG1hdGNoWzExXSkgeyB0b2tlbi50eXBlID0gJ3B1bmN0dWF0b3InOyB9DQogICAgZWxzZSBpZiAobWF0Y2hbMTJdKSB7IHRva2VuLnR5cGUgPSAnd2hpdGVzcGFjZSc7IH0NCiAgICByZXR1cm4gdG9rZW47DQogIH0NCg0KICBmdW5jdGlvbiBnZXRUb2tlbnMoc3JjKSB7DQogICAgdmFyIHRva2VucyA9IFtdLA0KICAgICAgbWF0Y2gsDQogICAgICB0b2tlbjsNCiAgICBmb3IgKDs7KSB7DQogICAgICBtYXRjaCA9IEpTX1RPS0VOUy5leGVjKHNyYyk7DQogICAgICBpZiAoIW1hdGNoKSB7IGJyZWFrOyB9DQogICAgICB0b2tlbiA9IG1hdGNoVG9Ub2tlbihtYXRjaCk7DQogICAgICB0b2tlbnMucHVzaCh0b2tlbik7DQogICAgfQ0KICAgIHJldHVybiB0b2tlbnM7DQogIH0NCg0KICB2YXIgRVNDQVBTRV9NQVAkMSA9IHsNCiAgICAiJyI6ICInIiwNCiAgICAnIic6ICciJywNCiAgICAnXHInOiAncicsDQogICAgJ1xuJzogJ24nLA0KICAgICdcdCc6ICd0JywNCiAgICAnXHUyMDI4JzogJ3UyMDI4JywNCiAgICAnXHUyMDI5JzogJ3UyMDI5Jw0KICB9Ow0KDQogIHZhciBFU0NBUFNFX1JFRyQxID0gLyd8InxccnxcbnxcdHxcdTIwMjh8XHUyMDI5XS9nOw0KDQogIGZ1bmN0aW9uIGVzY2FwZUNoYXIkMShjKSB7DQogICAgcmV0dXJuICdcXCcgKyBFU0NBUFNFX01BUCQxW2NdOw0KICB9DQoNCiAgdmFyIFNVQl9SRUcgPSAvXCRceygoPzpbXnt9XXxce1tefV0qXH0/KSopXH0/L2c7DQogIHZhciBTVUJfU0VQID0gJyRUTVAkJzsNCiAgdmFyIFNVQl9TRVBfUkVHID0gL1wkVE1QXCQvZzsNCg0KICBmdW5jdGlvbiByZXBsVG1wU3RyKHRva2VuLCB0b2tlbnMsIGluZGV4KSB7DQogICAgdmFyIHN0ciA9IHRva2VuLnZhbHVlOw0KICAgIGlmICh0b2tlbi50eXBlICE9ICdzdHJpbmcnIHx8IHN0clswXSAhPSAnYCcpIHsgcmV0dXJuIGZhbHNlOyB9DQogICAgdmFyIHJhd19hcmdzID0gW251bGxdOw0KICAgIHN0ciA9IHN0ci5zbGljZSgxLCBzdHIubGVuZ3RoIC0gMSk7DQogICAgc3RyID0gc3RyLnJlcGxhY2UoU1VCX1JFRywgZnVuY3Rpb24oZzAsIGcxKSB7DQogICAgICByYXdfYXJncy5wdXNoKGcxKTsNCiAgICAgIHJldHVybiBTVUJfU0VQOw0KICAgIH0pOw0KICAgIHZhciBzdHJSYXcgPSBpbmRleCA+IDIgJiYgdG9rZW5zW2luZGV4IC0gMV0udmFsdWU7DQogICAgaWYgKHN0clJhdyA9PSAncmF3Jykgew0KICAgICAgcmF3X2FyZ3NbMF0gPSBKU09OLnN0cmluZ2lmeSh7IHJhdzogc3RyLnNwbGl0KFNVQl9TRVApIH0pOw0KICAgICAgdG9rZW4udmFsdWUgPSAnKCcgKyByYXdfYXJncy5qb2luKCkgKyAnKSc7DQogICAgfSBlbHNlIHsNCiAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKEVTQ0FQU0VfUkVHJDEsIGVzY2FwZUNoYXIkMSk7DQogICAgICByYXdfYXJnc1swXSA9ICJ7cmF3OiBbJyIgKyBzdHIucmVwbGFjZShTVUJfU0VQX1JFRywgIicsJyIpICsgIiddfSI7DQogICAgICB0b2tlbi52YWx1ZSA9ICdTdHJpbmcucmF3KCcgKyByYXdfYXJncy5qb2luKCkgKyAnKSc7DQogICAgfQ0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgZnVuY3Rpb24gcmVwbEFycm93KHRva2VuLCB0b2tlbnMsIGluZGV4KSB7DQogICAgaWYgKHRva2VuLnR5cGUgIT0gJ3B1bmN0dWF0b3InIHx8IHRva2VuLnZhbHVlICE9ICc9PicpIHsgcmV0dXJuIGZhbHNlOyB9DQogICAgdmFyIGkgPSBpbmRleCwNCiAgICAgIGxlbiA9IHRva2Vucy5sZW5ndGgsDQogICAgICBkZXB0aCA9IDAsDQogICAgICBoYXNCcmFja2V0ID0gZmFsc2UsDQogICAgICBoYXNUaGlzID0gZmFsc2UsDQogICAgICB0b2tlbkl0Ow0KICAgIHdoaWxlICgtLWkpIHsNCiAgICAgIHRva2VuSXQgPSB0b2tlbnNbaV07DQogICAgICBpZiAodG9rZW5JdC50eXBlID09ICdwdW5jdHVhdG9yJykgew0KICAgICAgICBzd2l0Y2ggKHRva2VuSXQudmFsdWUpIHsNCiAgICAgICAgICBjYXNlICcpJzoNCiAgICAgICAgICAgIGhhc0JyYWNrZXQgPSB0cnVlOw0KICAgICAgICAgICAgZGVwdGgrKzsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgIGNhc2UgJygnOg0KICAgICAgICAgICAgZGVwdGgtLTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICBpZiAoZGVwdGggPT0gMCkgeyBkZXB0aC0tOyB9DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSBpZiAodG9rZW5JdC50eXBlID09ICduYW1lJyAmJiB0b2tlbkl0LnZhbHVlID09ICdyZXR1cm4nKSB7DQogICAgICAgIGRlcHRoLS07DQogICAgICB9DQogICAgICBpZiAoZGVwdGggPCAwKSB7DQogICAgICAgIGlmIChoYXNCcmFja2V0KSB7DQogICAgICAgICAgdG9rZW5JdC52YWx1ZSArPSAnIGZ1bmN0aW9uJzsNCiAgICAgICAgICB0b2tlbi52YWx1ZSA9ICcnOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHRva2VuSXQudmFsdWUgKz0gJyBmdW5jdGlvbignOw0KICAgICAgICAgIHRva2VuLnZhbHVlID0gJyknOw0KICAgICAgICB9DQogICAgICAgIGJyZWFrOw0KICAgICAgfQ0KICAgIH0NCiAgICBpID0gaW5kZXg7DQogICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgdG9rZW5JdCA9IHRva2Vuc1tpXTsNCiAgICAgIGlmICh0b2tlbkl0LnR5cGUgIT0gJ3doaXRlc3BhY2UnKSB7IGJyZWFrOyB9DQogICAgfQ0KICAgIGhhc0JyYWNrZXQgPSBmYWxzZTsNCiAgICBpZiAodG9rZW5JdC52YWx1ZSA9PSAneycpIHsgaGFzQnJhY2tldCA9IHRydWU7IH0NCiAgICBpLS07DQogICAgZGVwdGggPSAwOw0KICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgIHRva2VuSXQgPSB0b2tlbnNbaV07DQogICAgICBpZiAodG9rZW5JdC50eXBlID09ICdwdW5jdHVhdG9yJykgew0KICAgICAgICBzd2l0Y2ggKHRva2VuSXQudmFsdWUpIHsNCiAgICAgICAgICBjYXNlICd7JzoNCiAgICAgICAgICBjYXNlICcoJzoNCiAgICAgICAgICBjYXNlICdbJzoNCiAgICAgICAgICAgIGRlcHRoKys7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgICBjYXNlICd9JzoNCiAgICAgICAgICBjYXNlICcpJzoNCiAgICAgICAgICBjYXNlICddJzoNCiAgICAgICAgICAgIGRlcHRoLS07DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgICBjYXNlICcsJzoNCiAgICAgICAgICBjYXNlICc7JzoNCiAgICAgICAgICAgIGlmIChkZXB0aCA9PSAwKSB7IGRlcHRoLS07IH0NCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgICB9IGVsc2UgaWYgKHRva2VuSXQudHlwZSA9PSAnd2hpdGVzcGFjZScpIHsNCiAgICAgICAgaWYgKGRlcHRoID09IDAgJiYgdG9rZW5JdC52YWx1ZS5pbmNsdWRlcygnXHJcbicpKSB7DQogICAgICAgICAgZGVwdGgtLTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIGlmICh0b2tlbkl0LnR5cGUgPT0gJ25hbWUnKSB7DQogICAgICAgIGlmICh0b2tlbkl0LnZhbHVlID09ICd0aGlzJykgeyBoYXNUaGlzID0gdHJ1ZTsgfQ0KICAgICAgfQ0KICAgICAgaWYgKGRlcHRoIDwgMCkgew0KICAgICAgICBpZiAoaGFzQnJhY2tldCkgew0KICAgICAgICAgIGlmIChoYXNUaGlzKSB7IHRva2VuSXQudmFsdWUgPSAnLmJpbmQodGhpcyknICsgdG9rZW5JdC52YWx1ZTsgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHRva2VuLnZhbHVlICs9ICd7cmV0dXJuICc7DQogICAgICAgICAgaWYgKGhhc1RoaXMpIHsgdG9rZW5JdC52YWx1ZSA9ICd9LmJpbmQodGhpcyknICsgdG9rZW5JdC52YWx1ZTsgfQ0KICAgICAgICAgIGVsc2UgeyB0b2tlbkl0LnZhbHVlID0gJ30nICsgdG9rZW5JdC52YWx1ZTsgfQ0KICAgICAgICB9DQogICAgICAgIGJyZWFrOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJtQ29tbWVudCh0b2tlbikgew0KICAgIGlmICh0b2tlbi50eXBlID09ICdjb21tZW50Jykgew0KICAgICAgdG9rZW4udmFsdWUgPSAnJzsNCiAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICByZXR1cm4gZmFsc2U7DQogIH0NCg0KICBmdW5jdGlvbiByZXBsSW1wb3J0KHRva2VuLCB0b2tlbnMsIGluZGV4KSB7DQogICAgdmFyIGltcG9ydE1hcCA9IHt9LA0KICAgICAgYnVmID0gW10sDQogICAgICBpbnNpZGUsDQogICAgICBiQWxpYXMsDQogICAgICB0eXBlLA0KICAgICAgdmFsdWUsDQogICAgICBpLA0KICAgICAgbGVuLA0KICAgICAgdG9rZW5JdCwNCiAgICAgIG5hbWUsDQogICAgICBtb2R1bGVOYW1lLA0KICAgICAgbW9kdWxlQWxpYXM7DQogICAgaWYgKHRva2VuLnR5cGUgIT0gJ25hbWUnIHx8IHRva2VuLnZhbHVlICE9ICdpbXBvcnQnKSB7IHJldHVybiBmYWxzZTsgfQ0KICAgIHRva2VuLnZhbHVlID0gJyc7DQogICAgaSA9IGluZGV4Ow0KICAgIGxlbiA9IHRva2Vucy5sZW5ndGg7DQogICAgdG9rZW5JdCA9IHRva2VuOw0KICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgIHRva2VuSXQudmFsdWUgPSAnJzsNCiAgICAgIHRva2VuSXQgPSB0b2tlbnNbaV07DQogICAgICB0eXBlID0gdG9rZW5JdC50eXBlOw0KICAgICAgdmFsdWUgPSB0b2tlbkl0LnZhbHVlOw0KICAgICAgaWYgKHR5cGUgPT0gJ25hbWUnKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSAnZnJvbScpIHsNCiAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PSAnYXMnKSB7DQogICAgICAgICAgYkFsaWFzID0gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBpZiAoYkFsaWFzKSB7DQogICAgICAgICAgICBpbXBvcnRNYXBbbmFtZV0gPSB2YWx1ZTsNCiAgICAgICAgICAgIGJBbGlhcyA9IGZhbHNlOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBuYW1lID0gdmFsdWU7DQogICAgICAgICAgICBpZiAoaW5zaWRlKSB7DQogICAgICAgICAgICAgIGltcG9ydE1hcFtuYW1lXSA9IG5hbWU7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICBpbXBvcnRNYXBbJ2RlZmF1bHQnXSA9IG5hbWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gJ3B1bmN0dWF0b3InKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSAnKicpIHsNCiAgICAgICAgICBuYW1lID0gJyonOw0KICAgICAgICAgIGltcG9ydE1hcFsnKiddID0gMDsNCiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PSAneycpIHsNCiAgICAgICAgICBpbnNpZGUgPSB0cnVlOw0KICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09ICd9Jykgew0KICAgICAgICAgIGluc2lkZSA9IGZhbHNlOw0KICAgICAgICB9DQogICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gJ3N0cmluZycpIHsNCiAgICAgICAgbW9kdWxlTmFtZSA9IHZhbHVlLnNsaWNlKDEsIHZhbHVlLmxlbmd0aCAtIDEpOw0KICAgICAgICBicmVhazsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBtb2R1bGVBbGlhcyA9IG1vZHVsZU5hbWUucmVwbGFjZSgvW1xcLy4tQF0vZywgJ18nKTsNCiAgICBtb2R1bGVBbGlhcyArPQ0KICAgICAgJ18nICsNCiAgICAgIE1hdGgucmFuZG9tKCkNCiAgICAgICAgLnRvU3RyaW5nKDE2KQ0KICAgICAgICAuc2xpY2UoMik7DQogICAgYnVmLnB1c2gobW9kdWxlQWxpYXMgKyAiPXJlcXVpcmUoJyIgKyBtb2R1bGVOYW1lICsgIicpIik7DQogICAgaWYgKGltcG9ydE1hcFsnKiddKSB7DQogICAgICBidWYucHVzaChpbXBvcnRNYXBbJyonXSArICc9JyArIG1vZHVsZUFsaWFzKTsNCiAgICAgIGRlbGV0ZSBpbXBvcnRNYXBbJyonXTsNCiAgICB9DQogICAgaWYgKGltcG9ydE1hcFsnZGVmYXVsdCddKSB7DQogICAgICBidWYucHVzaChpbXBvcnRNYXBbJ2RlZmF1bHQnXSArICc9JyArIG1vZHVsZUFsaWFzICsgIlsnZGVmYXVsdCddIik7DQogICAgICBkZWxldGUgaW1wb3J0TWFwWydkZWZhdWx0J107DQogICAgfQ0KICAgIGZvciAobmFtZSBpbiBpbXBvcnRNYXApIHsNCiAgICAgIGJ1Zi5wdXNoKGltcG9ydE1hcFtuYW1lXSArICc9JyArIG1vZHVsZUFsaWFzICsgJy4nICsgbmFtZSk7DQogICAgfQ0KICAgIHRva2VuSXQudmFsdWUgPSAnbGV0ICcgKyBidWYuam9pbigpOw0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgZnVuY3Rpb24gdHJhbnNwaWxlKGNvZGUpIHsNCiAgICB2YXIgdG9rZW5zID0gZ2V0VG9rZW5zKGNvZGUpLA0KICAgICAgdG9rZW4sDQogICAgICBzb3VyY2U7DQogICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRva2Vucy5sZW5ndGg7IGkgPCBsZW47IGkrKykgew0KICAgICAgdG9rZW4gPSB0b2tlbnNbaV07DQogICAgICBpZiAocmVwbFRtcFN0cih0b2tlbiwgdG9rZW5zLCBpKSkgeyBjb250aW51ZTsgfQ0KICAgICAgaWYgKHJlcGxBcnJvdyh0b2tlbiwgdG9rZW5zLCBpKSkgeyBjb250aW51ZTsgfQ0KICAgICAgaWYgKHJlcGxJbXBvcnQodG9rZW4sIHRva2VucywgaSkpIHsgY29udGludWU7IH0NCiAgICAgIHJtQ29tbWVudCh0b2tlbik7DQogICAgfQ0KICAgIHNvdXJjZSA9IHRva2Vucy5tYXAoZnVuY3Rpb24gKGl0KSB7IHJldHVybiBpdC52YWx1ZTsgfSkuam9pbignJyk7DQoNCiAgICByZXR1cm4gc291cmNlOw0KICB9CgogIHZhciBJbnRlcm5hbE1vZHVsZXMgPSB7DQogICAgYWNjZGI6IGFjY2RiJDEsDQogICAgYWRvZGI6IGFkb2RiLA0KICAgIGNoaWxkX3Byb2Nlc3M6IGNoaWxkX3Byb2Nlc3MsDQogICAgY3J5cHRvOiBjcnlwdG8kMSwNCiAgICBjc3Y6IGNzdiwNCiAgICBjc3ZkYjogY3N2ZGIkMSwNCiAgICBkYXlqczogZGF5anMkMSwNCiAgICBleGNlbDogZXhjZWwsDQogICAgZXhjZWxkYjogZXhjZWxkYiQxLA0KICAgIGZzOiBmcywNCiAgICBodHRwOiBodHRwJDEsDQogICAgaWU6IGllLA0KICAgIG9yYWNsZWRiOiBvcmFjbGVkYiQxLA0KICAgIG91dGxvb2s6IG91dGxvb2ssDQogICAgcGF0aDogUGF0aCwNCiAgICBxdWVyeXN0cmluZzogcXVlcnlzdHJpbmcsDQogICAgdG9vbDogdG9vbCwNCiAgICB1dGlsOiB1dGlsLA0KICAgIHdtaTogd21pLA0KICAgIHBpcGU6IHBpcGUNCiAgfTsNCg0KICB3aW5kb3cucmVxdWlyZSA9IGZ1bmN0aW9uKG5hbWUpIHsNCiAgICByZXR1cm4gSW50ZXJuYWxNb2R1bGVzW25hbWVdOw0KICB9Ow0KDQogIGlmIChwcm9jZXNzLmFyZ3YubGVuZ3RoID09PSAzKSB7DQogICAgdmFyIHB0aCA9IHByb2Nlc3MuYXJndlsyXTsNCiAgICBpZiAoIWlzQWJzb2x1dGUocHRoKSkgew0KICAgICAgcHRoID0gcmVzb2x2ZShwdGgpOw0KICAgIH0NCiAgICBpZiAoIWV4dG5hbWUocHRoKSkgew0KICAgICAgcHRoICs9ICcuanMnOw0KICAgIH0NCiAgICBpZiAoIWlzZmlsZShwdGgpKSB7DQogICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBsb2FkIGZpbGUgJyIgKyBwdGggKyAiJyIpOw0KICAgIH0NCiAgICB2YXIgc3JjID0gcmVhZEZpbGVTeW5jKHB0aCwgJ1VURi04Jyk7DQoNCiAgICBPYmplY3QuYXNzaWduKHdpbmRvdywgew0KICAgICAgX19maWxlbmFtZTogcHRoLA0KICAgICAgX19kaXJuYW1lOiBkaXJuYW1lKHB0aCksDQogICAgICBwcm9jZXNzOiBwcm9jZXNzLA0KICAgICAgQnVmZmVyOiBCdWZmZXIsDQogICAgICBjb25zb2xlOiBjb25zb2xlDQogICAgfSk7DQoNCiAgICBzcmMgPSB0cmFuc3BpbGUoc3JjKTsNCiAgICB2YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7DQogICAgc2NyaXB0LnRleHQgPSBzcmM7DQogICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpOw0KICB9Cgp9KCkpOwo=';
src = window.decodeURIComponent(window.escape(window.atob(src)));

var script = document.createElement('script');
script.text = src;
window.addEventListener('error', function(e) {
  if (e.error) {
    WScript.Echo(e.error.stack);
  } else {
    if (e.message) WScript.Echo(' Error:' + e.message);
    WScript.Echo('  line:', e.lineno);
    WScript.Echo('column:', e.colno);
  }
});
document.head.appendChild(script);
/*
:LBL_END
pause
exit
::*/
