REM = 0; /*
@echo off
cls
title %~f0
cd %~dp0
call cscript.exe "%~f0" //Nologo //E:JScript "%~f0" %*
goto LBL_END
*/
var document = new ActiveXObject('htmlfile');
document.write(
  '<!DOCTYPE html><html><head><meta http-equiv=X-UA-Compatible content="IE=edge"><title></title></head><body></body></html>'
);
var window = document.parentWindow;
window.WScript = WScript;
window.ActiveXObject = ActiveXObject;
window.GetObject = GetObject;

var src = 'KGZ1bmN0aW9uICgpIHsKICAndXNlIHN0cmljdCc7CgogIGZ1bmN0aW9uIGV4aXQoc3RhdHVzKSB7DQogICAgV1NjcmlwdC5RdWl0KHN0YXR1cyB8fCAwKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNsZWVwKG1pbGxpcykgew0KICAgIFdTY3JpcHQuU2xlZXAobWlsbGlzKTsNCiAgfQ0KDQogIHZhciBfdmVyc2lvbjsNCg0KICBmdW5jdGlvbiB2ZXJzaW9uX2dldCgpIHsNCiAgICByZXR1cm4gKA0KICAgICAgX3ZlcnNpb24gfHwNCiAgICAgIChfdmVyc2lvbiA9DQogICAgICAgIA0KICAgICAgICBTY3JpcHRFbmdpbmUoKSArDQogICAgICAgICcgJyArDQogICAgICAgIA0KICAgICAgICBTY3JpcHRFbmdpbmVNYWpvclZlcnNpb24oKSArDQogICAgICAgICcuJyArDQogICAgICAgIA0KICAgICAgICBTY3JpcHRFbmdpbmVNaW5vclZlcnNpb24oKSArDQogICAgICAgICcuJyArDQogICAgICAgIA0KICAgICAgICBTY3JpcHRFbmdpbmVCdWlsZFZlcnNpb24oKSkNCiAgICApOw0KICB9DQoNCiAgdmFyIF9hcmd2Ow0KDQogIGZ1bmN0aW9uIGFyZ3ZfZ2V0KCkgew0KICAgIGlmIChfYXJndikgcmV0dXJuIF9hcmd2Ow0KICAgIF9hcmd2ID0gW1dTY3JpcHQuRnVsbE5hbWVdOw0KICAgIHZhciBlbiA9IG5ldyBFbnVtZXJhdG9yKFdTY3JpcHQuQXJndW1lbnRzKTsNCiAgICBmb3IgKDsgIWVuLmF0RW5kKCk7IGVuLm1vdmVOZXh0KCkpIF9hcmd2LnB1c2goZW4uaXRlbSgpKTsNCiAgICByZXR1cm4gX2FyZ3Y7DQogIH0NCg0KICB2YXIgX2VudjsNCg0KICBmdW5jdGlvbiBlbnZfZ2V0KCkgew0KICAgIGlmIChfZW52KSByZXR1cm4gX2VudjsNCiAgICB2YXIgaXQsIGk7DQogICAgdmFyIGVuID0gbmV3IEVudW1lcmF0b3IoR2V0U2hlbGwoKS5FbnZpcm9ubWVudCgnUFJPQ0VTUycpKTsNCiAgICBfZW52ID0ge307DQogICAgZm9yICg7ICFlbi5hdEVuZCgpOyBlbi5tb3ZlTmV4dCgpKSB7DQogICAgICBpdCA9IGVuLml0ZW0oKTsNCiAgICAgIGkgPSBpdC5pbmRleE9mKCc9Jyk7DQogICAgICBpZiAoaSA+IDApIHsNCiAgICAgICAgX2VudltpdC5zbGljZSgwLCBpKV0gPSBpdC5zbGljZShpICsgMSk7DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiBfZW52Ow0KICB9DQoNCiAgZnVuY3Rpb24gY3JlYXRlR2V0dGVycyhwcm9wcykgew0KICAgIHZhciBfcHJvcHMgPSB7fTsNCiAgICBmb3IgKHZhciBrZXkgaW4gcHJvcHMpIHsNCiAgICAgIF9wcm9wc1trZXldID0gew0KICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgICBnZXQ6IHByb3BzW2tleV0NCiAgICAgIH07DQogICAgfQ0KICAgIHJldHVybiBfcHJvcHM7DQogIH0NCg0KICB3aW5kb3cucHJvY2VzcyA9IE9iamVjdC5jcmVhdGUoDQogICAgew0KICAgICAgY3dkOiBmdW5jdGlvbiAoKSB7cmV0dXJuICBfX2Rpcm5hbWV9LA0KICAgICAgZXhpdDogZXhpdCwNCiAgICAgIHN0ZGluOiBXU2NyaXB0LlN0ZEluLA0KICAgICAgc3Rkb3V0OiBXU2NyaXB0LlN0ZE91dCwNCiAgICAgIHN0ZGVycjogV1NjcmlwdC5TdGRFcnIsDQogICAgICBzbGVlcDogc2xlZXAsDQogICAgICBtb2R1bGVMb2FkTGlzdDogW10NCiAgICB9LA0KICAgIGNyZWF0ZUdldHRlcnMoew0KICAgICAgdmVyc2lvbjogdmVyc2lvbl9nZXQsDQogICAgICBhcmd2OiBhcmd2X2dldCwNCiAgICAgIGVudjogZW52X2dldA0KICAgIH0pDQogICk7CgogIHZhciBfZG9jOw0KDQogIGZ1bmN0aW9uIGdldFhtbERvYygpIHsNCiAgICByZXR1cm4gX2RvYyB8fCAoX2RvYyA9IG5ldyBBY3RpdmVYT2JqZWN0KCdNU1hNTDIuRE9NRG9jdW1lbnQuNi4wJykpOw0KICB9DQoNCiAgZnVuY3Rpb24gdGV4dDJ2YWx1ZSh0eXBlLCB0ZXh0KSB7DQogICAgdmFyIGVsID0gZ2V0WG1sRG9jKCkuY3JlYXRlRWxlbWVudCgndG1wJyk7DQogICAgZWwuZGF0YVR5cGUgPSB0eXBlOw0KICAgIGVsLnRleHQgPSB0ZXh0Ow0KICAgIHJldHVybiBlbC5ub2RlVHlwZWRWYWx1ZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHZhbHVlMnRleHQodHlwZSwgdmFsdWUpIHsNCiAgICB2YXIgZWwgPSBnZXRYbWxEb2MoKS5jcmVhdGVFbGVtZW50KCd0bXAnKTsNCiAgICBlbC5kYXRhVHlwZSA9IHR5cGU7DQogICAgZWwubm9kZVR5cGVkVmFsdWUgPSB2YWx1ZTsNCiAgICByZXR1cm4gZWwudGV4dDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGJpbjJoZXgoYnl0ZXMpIHsNCiAgICByZXR1cm4gdmFsdWUydGV4dCgnYmluLmhleCcsIGJ5dGVzKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGhleDJiaW4oaGV4KSB7DQogICAgcmV0dXJuIHRleHQydmFsdWUoJ2Jpbi5oZXgnLCBoZXgpOw0KICB9DQoNCiAgZnVuY3Rpb24gYmluMmJhc2U2NChieXRlcykgew0KICAgIHJldHVybiB2YWx1ZTJ0ZXh0KCdiaW4uYmFzZTY0JywgYnl0ZXMpOw0KICB9DQoNCiAgZnVuY3Rpb24gYmFzZTY0MmJpbihiYXNlNjQpIHsNCiAgICByZXR1cm4gdGV4dDJ2YWx1ZSgnYmluLmJhc2U2NCcsIGJhc2U2NCk7DQogIH0NCg0KICBmdW5jdGlvbiBiaW4yc3RyKGJ5dGVzLCBlbmNvZGluZykgew0KICAgIHZhciBzdCA9IG5ldyBBY3RpdmVYT2JqZWN0KCdBRE9EQi5TdHJlYW0nKSwNCiAgICAgIHN0cjsNCiAgICBlbmNvZGluZyB8fCAoZW5jb2RpbmcgPSAnVVRGLTgnKTsNCiAgICB0cnkgew0KICAgICAgc3QuT3BlbigpOw0KICAgICAgc3QuVHlwZSA9IDE7DQogICAgICBzdC5Xcml0ZShieXRlcyk7DQogICAgICBzdC5Qb3NpdGlvbiA9IDA7DQogICAgICBzdC5UeXBlID0gMjsNCiAgICAgIHN0LkNoYXJzZXQgPSBlbmNvZGluZzsNCiAgICAgIHN0ciA9IHN0LlJlYWRUZXh0KCk7DQogICAgfSBmaW5hbGx5IHsNCiAgICAgIHN0LkNsb3NlKCk7DQogICAgfQ0KICAgIHJldHVybiBzdHI7DQogIH0NCg0KICBmdW5jdGlvbiBzdHIyYmluKHN0ciwgZW5jb2RpbmcpIHsNCiAgICB2YXIgc3QgPSBuZXcgQWN0aXZlWE9iamVjdCgnQURPREIuU3RyZWFtJyksDQogICAgICBiaW47DQogICAgZW5jb2RpbmcgfHwgKGVuY29kaW5nID0gJ1VURi04Jyk7DQogICAgdHJ5IHsNCiAgICAgIHN0Lk9wZW4oKTsNCiAgICAgIHN0LlR5cGUgPSAyOw0KICAgICAgc3QuQ2hhcnNldCA9IGVuY29kaW5nOw0KICAgICAgc3QuV3JpdGVUZXh0KHN0cik7DQogICAgICBzdC5Qb3NpdGlvbiA9IDA7DQogICAgICBzdC5UeXBlID0gMTsNCiAgICAgIGVuY29kaW5nID0gZW5jb2RpbmcucmVwbGFjZSgnLScsICcnKS50b0xvd2VyQ2FzZSgpOw0KICAgICAgaWYgKGVuY29kaW5nID09ICd1dGY4JyB8fCBlbmNvZGluZyA9PSAndW5pY29kZScpIHN0LlBvc2l0aW9uID0gMzsNCiAgICAgIGVsc2UgaWYgKGVuY29kaW5nID09ICd1ZnQxNicpIHN0LlBvc2l0aW9uID0gMjsNCiAgICAgIGJpbiA9IHN0LlJlYWQoKTsNCiAgICB9IGZpbmFsbHkgew0KICAgICAgc3QuQ2xvc2UoKTsNCiAgICB9DQogICAgcmV0dXJuIGJpbjsNCiAgfQ0KDQogIGZ1bmN0aW9uIGVuY29kZShzdHIsIGVuY29kaW5nKSB7DQogICAgc3dpdGNoIChlbmNvZGluZykgew0KICAgICAgY2FzZSAnaGV4JzoNCiAgICAgICAgcmV0dXJuIGhleDJiaW4oc3RyKTsNCiAgICAgIGNhc2UgJ2Jhc2U2NCc6DQogICAgICAgIHJldHVybiBiYXNlNjQyYmluKHN0cik7DQogICAgICBkZWZhdWx0Og0KICAgICAgICByZXR1cm4gc3RyMmJpbihzdHIsIGVuY29kaW5nKTsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBkZWNvZGUoYnl0ZXMsIGVuY29kaW5nKSB7DQogICAgc3dpdGNoIChlbmNvZGluZykgew0KICAgICAgY2FzZSAnaGV4JzoNCiAgICAgICAgcmV0dXJuIGJpbjJoZXgoYnl0ZXMpOw0KICAgICAgY2FzZSAnYmFzZTY0JzoNCiAgICAgICAgcmV0dXJuIGJpbjJiYXNlNjQoYnl0ZXMpOw0KICAgICAgY2FzZSAnYmluYXJ5JzoNCiAgICAgICAgcmV0dXJuIGJ5dGVzOw0KICAgICAgZGVmYXVsdDoNCiAgICAgICAgcmV0dXJuIGJpbjJzdHIoYnl0ZXMsIGVuY29kaW5nKTsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBidWZfaW5pdChvYmosIGVuY29kaW5nKSB7DQogICAgaWYgKG9iaiA9PSBudWxsIHx8IG9iaiA9PSAnJyB8fCBvYmoubGVuZ3RoID09IDApIHsNCiAgICAgIHRoaXMuYnVmZmVyID0gbmV3IEFjdGl2ZVhPYmplY3QoJ1NjcmlwdGluZy5EaWN0aW9uYXJ5JykuSXRlbXMoKTsNCiAgICB9IGVsc2UgaWYgKEJ1ZmZlciQxLmlzQnVmZmVyKG9iaikpIHsNCiAgICAgIHRoaXMuYnVmZmVyID0gb2JqLmJ1ZmZlcjsNCiAgICB9IGVsc2UgaWYgKHR5cGVvZiBvYmogPT0gJ3N0cmluZycpIHsNCiAgICAgIHRoaXMuYnVmZmVyID0gZW5jb2RlKG9iaiwgZW5jb2RpbmcpOw0KICAgIH0gZWxzZSBpZiAob2JqICYmIG9iai5jb25zdHJ1Y3RvciAmJiBvYmouY29uc3RydWN0b3IgPT09IFZCQXJyYXkpIHsNCiAgICAgIHRoaXMuYnVmZmVyID0gb2JqOw0KICAgIH0gZWxzZSB7DQogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdGYWlsZWQgdG8gY3JlYXRlIGJ1ZmZlci4nKTsNCiAgICB9DQogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICdsZW5ndGgnLCB7IGdldDogdGhpcy5fZ2V0TGVuZ3RoIH0pOw0KICB9DQoNCiAgZnVuY3Rpb24gQnVmZmVyJDEob2JqLCBlbmNvZGluZykgew0KICAgIHJldHVybiBuZXcgYnVmX2luaXQob2JqLCBlbmNvZGluZyk7DQogIH0NCg0KICB2YXIgYnVmX3Byb3RvID0gKGJ1Zl9pbml0LnByb3RvdHlwZSA9IEJ1ZmZlciQxLnByb3RvdHlwZSk7DQoNCiAgYnVmX3Byb3RvLnRvU3RyaW5nID0gZnVuY3Rpb24oZW5jb2RpbmcpIHsNCiAgICByZXR1cm4gdGhpcy5idWZmZXIudWJvdW5kKCkgPT0gLTEgPyAnJyA6IGRlY29kZSh0aGlzLmJ1ZmZlciwgZW5jb2RpbmcpOw0KICB9Ow0KDQogIGJ1Zl9wcm90by5fZ2V0TGVuZ3RoID0gZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuIHRoaXMuYnVmZmVyLnVib3VuZCgpICsgMTsNCiAgfTsNCg0KICBCdWZmZXIkMS5mcm9tID0gZnVuY3Rpb24ob2JqLCBlbmNvZGluZykgew0KICAgIHJldHVybiBCdWZmZXIkMShvYmosIGVuY29kaW5nKTsNCiAgfTsNCg0KICBCdWZmZXIkMS5pc0J1ZmZlciA9IGZ1bmN0aW9uKG9iaikgew0KICAgIHJldHVybiBvYmogJiYgb2JqIGluc3RhbmNlb2YgQnVmZmVyJDE7DQogIH07DQoNCiAgd2luZG93LkJ1ZmZlciA9IEJ1ZmZlciQxOwoKICB2YXIgVE9fU1RSID0ge30udG9TdHJpbmc7DQogIHZhciBIQVNfT1dOID0ge30uaGFzT3duUHJvcGVydHk7DQoNCg0KDQogIGZ1bmN0aW9uIGNocihuKSB7DQogICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUobik7DQogIH0NCg0KICBmdW5jdGlvbiBvcmQoYykgew0KICAgIHJldHVybiBjLmNoYXJDb2RlQXQoMCk7DQogIH0NCg0KICBmdW5jdGlvbiBoZXgoeCkgew0KICAgIHJldHVybiBOdW1iZXIoeCkudG9TdHJpbmcoMTYpOw0KICB9DQoNCiAgZnVuY3Rpb24gYmluKHgpIHsNCiAgICByZXR1cm4gTnVtYmVyKHgpLnRvU3RyaW5nKDIpOw0KICB9DQoNCiAgZnVuY3Rpb24gb2N0KHgpIHsNCiAgICByZXR1cm4gTnVtYmVyKHgpLnRvU3RyaW5nKDgpOw0KICB9DQoNCiAgZnVuY3Rpb24gaW50KHgsIGJhc2UpIHsNCiAgICByZXR1cm4gcGFyc2VJbnQoeCwgYmFzZSk7DQogIH0NCg0KICB2YXIgRlVOQ19OQU1FX1JFRyA9IC9mdW5jdGlvbiArKFx3KykvOw0KDQogIGZ1bmN0aW9uIGdldEZ1bmNOYW1lKGZuKSB7DQogICAgaWYgKGZuLm5hbWUpIHJldHVybiBmbi5uYW1lOw0KICAgIHZhciBtID0gZm4udG9TdHJpbmcoKS5tYXRjaChGVU5DX05BTUVfUkVHKTsNCiAgICByZXR1cm4gbSA/IG1bMV0gOiAnJzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGdldFRhZyh2YWx1ZSkgew0KICAgIHJldHVybiBUT19TVFIuY2FsbCh2YWx1ZSk7DQogIH0NCg0KICB2YXIgVFlQRV9SRUcgPSAvXFtvYmplY3QgKFteXF1dKylcXS87DQoNCiAgZnVuY3Rpb24gdHlwZU9mKG9iaikgew0KICAgIHZhciB0cCA9IG9iaiA9PT0gbnVsbCA/ICdudWxsJyA6IHR5cGVvZiBvYmo7DQogICAgaWYgKHRwID09ICdvYmplY3QnKQ0KICAgICAgdHAgPSBUT19TVFIuY2FsbChvYmopDQogICAgICAgIC5tYXRjaChUWVBFX1JFRylbMV0NCiAgICAgICAgLnRvTG93ZXJDYXNlKCk7DQogICAgaWYgKHRwID09ICdvYmplY3QnICYmIG9iai5jb25zdHJ1Y3RvciAmJiB0eXBlb2Ygb2JqLmNvbnN0cnVjdG9yID09ICdmdW5jdGlvbicpDQogICAgICB0cCA9IGdldEZ1bmNOYW1lKG9iai5jb25zdHJ1Y3RvcikudG9Mb3dlckNhc2UoKSB8fCB0cDsNCiAgICByZXR1cm4gdHA7DQogIH0NCg0KICB2YXIgdHlwZSA9IHR5cGVPZjsNCg0KICBmdW5jdGlvbiBoYXMob2JqLCBrZXkpIHsNCiAgICByZXR1cm4gb2JqICE9IG51bGwgJiYgSEFTX09XTi5jYWxsKG9iaiwga2V5KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzQXJyYXkob2JqKSB7DQogICAgcmV0dXJuIEFycmF5LmlzQXJyYXkob2JqKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzT2JqZWN0KG9iaikgew0KICAgIHZhciB0eXBlID0gdHlwZW9mIG9iajsNCiAgICByZXR1cm4gb2JqICE9IG51bGwgJiYgKHR5cGUgPT0gJ29iamVjdCcgfHwgdHlwZSA9PSAnZnVuY3Rpb24nKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzRnVuY3Rpb24ob2JqKSB7DQogICAgcmV0dXJuIHR5cGVvZiBvYmogPT0gJ2Z1bmN0aW9uJzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzU3RyaW5nKG9iaikgew0KICAgIHJldHVybiB0eXBlb2Ygb2JqID09ICdzdHJpbmcnOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNOdW1iZXIob2JqKSB7DQogICAgcmV0dXJuIHR5cGVvZiBvYmogPT0gJ251bWJlcic7DQogIH0NCg0KICBmdW5jdGlvbiBpc0Jvb2xlYW4ob2JqKSB7DQogICAgcmV0dXJuIG9iaiA9PT0gdHJ1ZSB8fCBvYmogPT09IGZhbHNlOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNEYXRlKG9iaikgew0KICAgIHJldHVybiBUT19TVFIuY2FsbChvYmopID09ICdbb2JqZWN0IERhdGVdJzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzUmVnRXhwKG9iaikgew0KICAgIHJldHVybiBUT19TVFIuY2FsbChvYmopID09ICdbb2JqZWN0IFJlZ0V4cF0nOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNFcnJvcihvYmopIHsNCiAgICByZXR1cm4gVE9fU1RSLmNhbGwob2JqKSA9PSAnW29iamVjdCBFcnJvcl0nOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNNYXAob2JqKSB7DQogICAgcmV0dXJuIG9iaiBpbnN0YW5jZW9mIE1hcDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzU2V0KG9iaikgew0KICAgIHJldHVybiBvYmogaW5zdGFuY2VvZiBTZXQ7DQogIH0NCg0KICBmdW5jdGlvbiBpc1dlYWtNYXAob2JqKSB7DQogICAgcmV0dXJuIG9iaiBpbnN0YW5jZW9mIFdlYWtNYXA7DQogIH0NCg0KICBmdW5jdGlvbiBpc0ludGVnZXIodmFsdWUpIHsNCiAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09ICdudW1iZXInICYmIHZhbHVlICUgMSA9PSAwOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNBcmd1bWVudHMob2JqKSB7DQogICAgcmV0dXJuIFRPX1NUUi5jYWxsKG9iaikgPT0gJ1tvYmplY3QgQXJndW1lbnRzXSc7DQogIH0NCg0KICBmdW5jdGlvbiBpc09iamVjdExpa2UodmFsdWUpIHsNCiAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09ICdvYmplY3QnICYmIHZhbHVlICE9IG51bGw7DQogIH0NCg0KICBmdW5jdGlvbiBpc0xlbmd0aCh2YWx1ZSkgew0KICAgIHJldHVybiBpc0ludGVnZXIodmFsdWUpICYmIHZhbHVlID4gLTEgJiYgdmFsdWUgPCA5MDA3MTk5MjU0NzQwOTkyOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNBcnJheUxpa2Uob2JqKSB7DQogICAgcmV0dXJuIG9iaiAhPSBudWxsICYmIHR5cGVvZiBvYmogIT0gJ2Z1bmN0aW9uJyAmJiBpc0xlbmd0aChvYmoubGVuZ3RoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzRW1wdHkob2JqKSB7DQogICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gdHJ1ZTsNCiAgICBpZiAoaXNBcnJheUxpa2Uob2JqKSkgcmV0dXJuICFvYmoubGVuZ3RoOw0KICAgIGlmIChpc01hcChvYmopIHx8IGlzU2V0KG9iaikpIHJldHVybiAhb2JqLnNpemU7DQogICAgZm9yICh2YXIga2V5IGluIG9iaikgew0KICAgICAgaWYgKEhBU19PV04uY2FsbChvYmosIGtleSkpIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgcmV0dXJuIHRydWU7DQogIH0NCg0KICBmdW5jdGlvbiBpc0J1ZmZlcihvYmopIHsNCiAgICByZXR1cm4gQnVmZmVyLmlzQnVmZmVyKG9iaik7DQogIH0NCg0KICBmdW5jdGlvbiBhcHBseShmbiwgdGhpc0FyZywgYXJncykgew0KICAgIHZhciBhcmdDbnQgPSAoYXJncyAmJiBhcmdzLmxlbmd0aCkgfHwgMCwNCiAgICAgIGhhc1RoaXMgPSB0aGlzQXJnID09IG51bGw7DQogICAgc3dpdGNoIChhcmdDbnQpIHsNCiAgICAgIGNhc2UgMDoNCiAgICAgICAgcmV0dXJuIGhhc1RoaXMgPyBmbigpIDogZm4uY2FsbCh0aGlzQXJnKTsNCiAgICAgIGNhc2UgMToNCiAgICAgICAgcmV0dXJuIGhhc1RoaXMgPyBmbihhcmdzWzBdKSA6IGZuLmNhbGwodGhpc0FyZywgYXJnc1swXSk7DQogICAgICBjYXNlIDI6DQogICAgICAgIHJldHVybiBoYXNUaGlzDQogICAgICAgICAgPyBmbihhcmdzWzBdLCBhcmdzWzFdKQ0KICAgICAgICAgIDogZm4uY2FsbCh0aGlzQXJnLCBhcmdzWzBdLCBhcmdzWzFdKTsNCiAgICAgIGNhc2UgMzoNCiAgICAgICAgcmV0dXJuIGhhc1RoaXMNCiAgICAgICAgICA/IGZuKGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0pDQogICAgICAgICAgOiBmbi5jYWxsKHRoaXNBcmcsIGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0pOw0KICAgICAgZGVmYXVsdDoNCiAgICAgICAgcmV0dXJuIGZuLmFwcGx5KHRoaXNBcmcsIGFyZ3MpOw0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIHJhbmdlKHN0YXJ0LCBlbmQsIHN0ZXApIHsNCiAgICB2YXIgaSA9IC0xLA0KICAgICAgbGVuLA0KICAgICAgcmVzdWx0ID0gW107DQogICAgaWYgKHN0YXJ0ID09IG51bGwpIHJldHVybiByZXN1bHQ7DQogICAgaWYgKGVuZCA9PSBudWxsKSAoZW5kID0gc3RhcnQpLCAoc3RhcnQgPSAwKTsNCiAgICBpZiAoc3RlcCA9PSBudWxsKSBzdGVwID0gMTsNCiAgICBzdGVwID0gTWF0aC5hYnMoc3RlcCk7DQogICAgaWYgKHN0YXJ0ID4gZW5kKSBzdGVwID0gLXN0ZXA7DQogICAgbGVuID0gTWF0aC5tYXgoTWF0aC5jZWlsKChlbmQgLSBzdGFydCkgLyBzdGVwKSwgMCk7DQogICAgcmVzdWx0ID0gbmV3IEFycmF5KGxlbik7DQogICAgd2hpbGUgKCsraSA8IGxlbikgKHJlc3VsdFtpXSA9IHN0YXJ0KSwgKHN0YXJ0ICs9IHN0ZXApOw0KICAgIHJldHVybiByZXN1bHQ7DQogIH0NCg0KICBmdW5jdGlvbiB0b1BhdGgocHRoKSB7DQogICAgaWYgKGlzU3RyaW5nKHB0aCkpIHB0aCA9IHB0aC5zcGxpdCgvWy5bXF1dLykuZmlsdGVyKGlkZW50aXR5KTsNCiAgICBlbHNlIGlmIChpc051bWJlcihwdGgpKSBwdGggPSBbcHRoXTsNCiAgICByZXR1cm4gaXNBcnJheShwdGgpID8gcHRoIDogW107DQogIH0NCg0KICBmdW5jdGlvbiBpZGVudGl0eSh2YWx1ZSkgew0KICAgIHJldHVybiB2YWx1ZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGl0ZXJhdGVlKHZhbHVlKSB7DQogICAgc3dpdGNoICh0eXBlT2YodmFsdWUpKSB7DQogICAgICBjYXNlICdmdW5jdGlvbic6DQogICAgICAgIHJldHVybiB2YWx1ZTsNCiAgICAgIGNhc2UgJ3N0cmluZyc6DQogICAgICBjYXNlICdudW1iZXInOg0KICAgICAgICByZXR1cm4gcHJvcGVydHkodmFsdWUpOw0KICAgICAgY2FzZSAnYXJyYXknOg0KICAgICAgICByZXR1cm4gcHJvcGVydGllcyh2YWx1ZSk7DQogICAgICBjYXNlICdvYmplY3QnOg0KICAgICAgICByZXR1cm4gbWF0Y2hlcyh2YWx1ZSk7DQogICAgICBkZWZhdWx0Og0KICAgICAgICByZXR1cm4gaWRlbnRpdHk7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gdGltZWl0KGZuLCBsYWJlbCkgew0KICAgIGxhYmVsIHx8IChsYWJlbCA9ICd0aW1lJyk7DQogICAgY29uc29sZS50aW1lKGxhYmVsKTsNCiAgICBmbigpOw0KICAgIGNvbnNvbGUudGltZUVuZChsYWJlbCk7DQogIH0NCg0KDQoNCg0KDQogIGZ1bmN0aW9uIGVhY2gob2JqLCBmbikgew0KICAgIHZhciBlbiwgaSwga2V5LCBsZW47DQogICAgaWYgKGlzQXJyYXlMaWtlKG9iaikpIHsNCiAgICAgIGZvciAoaSA9IDAsIGxlbiA9IG9iai5sZW5ndGg7IGkgPCBsZW47IGkrKykgew0KICAgICAgICBpZiAoZm4ob2JqW2ldLCBpLCBvYmopID09PSBmYWxzZSkgYnJlYWs7DQogICAgICB9DQogICAgfSBlbHNlIGlmIChvYmogJiYgIW9iai5jb25zdHJ1Y3RvciAmJiAnSXRlbScgaW4gb2JqKSB7DQogICAgICBlbiA9IG5ldyBFbnVtZXJhdG9yKG9iaik7DQogICAgICBmb3IgKGkgPSAwOyAhZW4uYXRFbmQoKTsgZW4ubW92ZU5leHQoKSwgaSsrKSB7DQogICAgICAgIGlmIChmbihlbi5pdGVtKCksIGksIG9iaikgPT09IGZhbHNlKSBicmVhazsNCiAgICAgIH0NCiAgICB9IGVsc2UgaWYgKGlzTGVuZ3RoKG9iaikpIHsNCiAgICAgIGZvciAoaSA9IDA7IGkgPCBvYmo7IGkrKykgew0KICAgICAgICBpZiAoZm4oaSwgaSwgb2JqKSA9PT0gZmFsc2UpIGJyZWFrOw0KICAgICAgfQ0KICAgIH0gZWxzZSBpZiAoaXNPYmplY3Qob2JqKSkgew0KICAgICAgZm9yIChrZXkgaW4gb2JqKSB7DQogICAgICAgIGlmIChoYXMob2JqLCBrZXkpKSB7DQogICAgICAgICAgaWYgKGZuKG9ialtrZXldLCBrZXksIG9iaikgPT09IGZhbHNlKSBicmVhazsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gb2JqOw0KICB9DQoNCiAgdmFyIGZvckVhY2ggPSBlYWNoOw0KDQogIGZ1bmN0aW9uIG1hcChvYmosIGZuKSB7DQogICAgdmFyIHJlc3VsdCA9IFtdLA0KICAgICAgaXRlID0gaXRlcmF0ZWUoZm4pOw0KICAgIGVhY2gob2JqLCBmdW5jdGlvbiAodiwgaywgbykgIHsNCiAgICAgIHJlc3VsdC5wdXNoKGl0ZSh2LCBrLCBvKSk7DQogICAgfSk7DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfQ0KDQogIHZhciBzZWxlY3QgPSBtYXA7DQoNCiAgZnVuY3Rpb24gcmVkdWNlKG9iaiwgZm4sIG1lbW8pIHsNCiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odiwgaywgbykgew0KICAgICAgbWVtbyA9IGZuKG1lbW8sIHYsIGssIG8pOw0KICAgIH0pOw0KICAgIHJldHVybiBtZW1vOw0KICB9DQoNCiAgZnVuY3Rpb24gZmlsdGVyKG9iaiwgZm4pIHsNCiAgICB2YXIgcmVzdWx0ID0gW10sDQogICAgICBpdGUgPSBpdGVyYXRlZShmbik7DQogICAgZWFjaChvYmosIGZ1bmN0aW9uICh2LCBrLCBvKSAgew0KICAgICAgaWYgKGl0ZSh2LCBrLCBvKSkgcmVzdWx0LnB1c2godik7DQogICAgfSk7DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfQ0KDQogIHZhciB3aGVyZSA9IGZpbHRlcjsNCg0KICBmdW5jdGlvbiB0b0FycmF5KG9iaikgew0KICAgIHZhciBpLCBsZW4sIGFycjsNCiAgICBpZiAoaXNBcnJheShvYmopKSByZXR1cm4gb2JqOw0KICAgIGlmIChpc0FycmF5TGlrZShvYmopKSB7DQogICAgICBpID0gLTE7DQogICAgICBsZW4gPSBvYmoubGVuZ3RoOw0KICAgICAgYXJyID0gQXJyYXkobGVuKTsNCiAgICAgIHdoaWxlICgrK2kgPCBsZW4pIGFycltpXSA9IG9ialtpXTsNCiAgICAgIHJldHVybiBhcnI7DQogICAgfQ0KICAgIGlmIChpc09iamVjdChvYmopKSByZXR1cm4gbWFwKG9iaik7DQogICAgcmV0dXJuIFtdOw0KICB9DQoNCiAgZnVuY3Rpb24gYmFzZUZpbmQoYXJyLCBmbiwgX3RoaXMpIHsNCiAgICB2YXIgaSA9IC0xLA0KICAgICAgbGVuID0gYXJyLmxlbmd0aCwNCiAgICAgIGl0Ow0KICAgIGlmIChfdGhpcykgew0KICAgICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgICBpdCA9IGFycltpXTsNCiAgICAgICAgaWYgKGZuLmNhbGwoX3RoaXMsIGl0LCBpLCBhcnIpKSB7DQogICAgICAgICAgcmV0dXJuIFtpdCwgaV07DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9IGVsc2Ugew0KICAgICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgICBpdCA9IGFycltpXTsNCiAgICAgICAgaWYgKGZuKGl0LCBpLCBhcnIpKSB7DQogICAgICAgICAgcmV0dXJuIFtpdCwgaV07DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIFtudWxsLCAtMV07DQogIH0NCg0KICBmdW5jdGlvbiBmaW5kKGFyciwgZm4pIHsNCiAgICByZXR1cm4gYmFzZUZpbmQoYXJyLCBmbilbMF07DQogIH0NCg0KICBmdW5jdGlvbiBmaW5kSW5kZXgoYXJyLCBmbikgew0KICAgIHJldHVybiBiYXNlRmluZChhcnIsIGZuKVsxXTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGZpbGwoYXJyLCB2YWwsIHN0YXJ0LCBlbmQpIHsNCiAgICB2YXIgbGVuID0gYXJyLmxlbmd0aDsNCiAgICBpZiAoc3RhcnQgPT0gbnVsbCkgc3RhcnQgPSAwOw0KICAgIGlmIChlbmQgPT0gbnVsbCkgZW5kID0gbGVuOw0KICAgIGlmIChlbmQgPCAwKSBlbmQgPSBNYXRoLm1heChlbmQgKyBsZW4sIGxlbik7DQogICAgd2hpbGUgKHN0YXJ0IDwgZW5kKSB7DQogICAgICBhcnJbc3RhcnRdID0gdmFsOw0KICAgICAgc3RhcnQrKzsNCiAgICB9DQogICAgcmV0dXJuIGFycjsNCiAgfQ0KDQogIGZ1bmN0aW9uIGdyb3VwQnkob2JqLCBmbikgew0KICAgIHZhciByZXN1bHQgPSB7fSwNCiAgICAgIGl0ZSA9IGl0ZXJhdGVlKGZuKTsNCiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odiwgaywgbykgew0KICAgICAgdmFyIGtleSA9IGl0ZSh2LCBrLCBvKTsNCiAgICAgIGhhcyhyZXN1bHQsIGtleSkgPyByZXN1bHRba2V5XS5wdXNoKHYpIDogKHJlc3VsdFtrZXldID0gW3ZdKTsNCiAgICB9KTsNCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9DQoNCiAgZnVuY3Rpb24gY291bnRCeShvYmosIGZuKSB7DQogICAgdmFyIGl0ZSA9IGl0ZXJhdGVlKGZuKTsNCiAgICByZXR1cm4gcmVkdWNlKA0KICAgICAgb2JqLCBmdW5jdGlvbg0KICAgICAgKHJlc3VsdCwgdmFsdWUsIGtleSkgIHsNCiAgICAgICAga2V5ID0gaXRlKHZhbHVlKTsNCiAgICAgICAgaGFzKHJlc3VsdCwga2V5KSA/IHJlc3VsdFtrZXldKysgOiAocmVzdWx0W2tleV0gPSAxKTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgIH0sDQogICAgICB7fQ0KICAgICk7DQogIH0NCg0KICBmdW5jdGlvbiBzaXplKG9iaikgew0KICAgIHJldHVybiBpc0FycmF5TGlrZShvYmopID8gb2JqLmxlbmd0aCA6IE9iamVjdC5rZXlzKG9iaikubGVuZ3RoOw0KICB9DQoNCiAgdmFyIGxlbiA9IHNpemU7DQoNCg0KDQoNCg0KICBmdW5jdGlvbiB1bmlxQnkoYXJyLCBmbikgew0KICAgIHZhciBpdGUgPSBpdGVyYXRlZShmbiksDQogICAgICByZXN1bHQgPSBbXSwNCiAgICAgIG1lbW8gPSBuZXcgU2V0KCksDQogICAgICBpID0gLTEsDQogICAgICBsZW4gPSBhcnIubGVuZ3RoLA0KICAgICAgaXRlbSwNCiAgICAgIGNvbXB1dGVkOw0KICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgIGl0ZW0gPSBhcnJbaV07DQogICAgICBjb21wdXRlZCA9IGl0ZShpdGVtKTsNCiAgICAgIGlmICghbWVtby5oYXMoY29tcHV0ZWQpKSB7DQogICAgICAgIHJlc3VsdC5wdXNoKGl0ZW0pOw0KICAgICAgICBtZW1vLmFkZChjb21wdXRlZCk7DQogICAgICB9DQogICAgfQ0KICAgIG1lbW8uY2xlYXIoKTsNCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9DQoNCiAgZnVuY3Rpb24gdW5pcShhcnIpIHsNCiAgICByZXR1cm4gdW5pcUJ5KGFyciwgaWRlbnRpdHkpOw0KICB9DQoNCiAgdmFyIGRpc3RpbmN0ID0gdW5pcTsNCg0KICB2YXIgZGlzdGluY3RCeSA9IHVuaXFCeTsNCg0KICBmdW5jdGlvbiBjaHVuayhhcnIsIG4pIHsNCiAgICBpZiAobiA9PSBudWxsIHx8IG4gPCAxKSByZXR1cm4gW107DQogICAgdmFyIHJlc3VsdCA9IFtdLA0KICAgICAgdG1wID0gQXJyYXkobiksDQogICAgICBpID0gLTEsDQogICAgICBsZW4gPSBhcnIubGVuZ3RoLA0KICAgICAgb2ZmID0gMDsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICB0bXBbb2ZmKytdID0gYXJyW2ldOw0KICAgICAgaWYgKG9mZiA9PSAxKSB7DQogICAgICAgIHJlc3VsdC5wdXNoKHRtcCk7DQogICAgICB9IGVsc2UgaWYgKG9mZiA9PSBuKSB7DQogICAgICAgIG9mZiA9IDA7DQogICAgICAgIHRtcCA9IEFycmF5KG4pOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9DQoNCiAgZnVuY3Rpb24gY29uY2F0KCkgew0KICAgIHZhciBpID0gLTEsDQogICAgICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoLA0KICAgICAgcmVzdWx0ID0gW10sDQogICAgICBhcnIsDQogICAgICBpaSwNCiAgICAgIGxlbjI7DQogICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgYXJyID0gYXJndW1lbnRzW2ldOw0KICAgICAgaWkgPSAtMTsNCiAgICAgIGxlbjIgPSBhcnIgJiYgYXJyLmxlbmd0aDsNCiAgICAgIGlmIChsZW4yID09IG51bGwpIHsNCiAgICAgICAgcmVzdWx0LnB1c2goYXJyKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHdoaWxlICgrK2lpIDwgbGVuMikgcmVzdWx0LnB1c2goYXJyW2lpXSk7DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiByZXN1bHQ7DQogIH0NCg0KICBmdW5jdGlvbiBzbGljZShhcnIsIHN0YXJ0LCBlbmQpIHsNCiAgICB2YXIgaSA9IC0xLA0KICAgICAgbGVuID0gKGFyciAmJiBhcnIubGVuZ3RoKSB8fCAwLA0KICAgICAgcmVzdWx0Ow0KICAgIGlmICghbGVuKSByZXR1cm4gW107DQogICAgaWYgKHN0YXJ0ID09IG51bGwpIHN0YXJ0ID0gMDsNCiAgICBpZiAoZW5kID09IG51bGwpIGVuZCA9IGxlbjsNCiAgICBpZiAoc3RhcnQgPCAwKSBzdGFydCA9IC1zdGFydCA+IGxlbiA/IDAgOiBsZW4gKyBzdGFydDsNCiAgICBpZiAoZW5kIDwgMCkgZW5kICs9IGxlbjsNCiAgICBlbHNlIGlmIChlbmQgPiBsZW4pIGVuZCA9IGxlbjsNCiAgICBsZW4gPSBzdGFydCA+IGVuZCA/IDAgOiBlbmQgLSBzdGFydDsNCiAgICByZXN1bHQgPSBuZXcgQXJyYXkobGVuKTsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSByZXN1bHRbaV0gPSBhcnJbaSArIHN0YXJ0XTsNCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9DQoNCg0KICBmdW5jdGlvbiBkcm9wKGFyciwgbikgew0KICAgIHJldHVybiBzbGljZShhcnIsIG4gfHwgMSk7DQogIH0NCg0KDQogIGZ1bmN0aW9uIHRhaWwoYXJyKSB7DQogICAgcmV0dXJuIGRyb3AoYXJyLCAxKTsNCiAgfQ0KDQoNCiAgZnVuY3Rpb24gaW5pdGlhbChhcnIpIHsNCiAgICByZXR1cm4gc2xpY2UoYXJyLCAwLCBNYXRoLm1heCgwLCBhcnIubGVuZ3RoIC0gMSkpOw0KICB9DQoNCg0KICBmdW5jdGlvbiB0YWtlKGFyciwgbikgew0KICAgIHJldHVybiBzbGljZShhcnIsIDAsIG4pOw0KICB9DQoNCiAgZnVuY3Rpb24gdGFrZVJpZ2h0KGFyciwgbikgew0KICAgIHJldHVybiBzbGljZShhcnIsIC1uKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNvbnRhaW5zKG9iaiwgdmFsLCBwb3MpIHsNCiAgICByZXR1cm4gb2JqLmluZGV4T2YodmFsLCBwb3MgfHwgMCkgIT0gLTE7DQogIH0NCg0KICB2YXIgaW5jbHVkZSA9IGNvbnRhaW5zOw0KDQogIHZhciBpbmNsdWRlcyA9IGNvbnRhaW5zOw0KDQogIGZ1bmN0aW9uIGZpcnN0KGFycikgew0KICAgIHJldHVybiBhcnIgJiYgYXJyWzBdOw0KICB9DQoNCiAgdmFyIGhlYWQgPSBmaXJzdDsNCg0KICBmdW5jdGlvbiBsYXN0KGFycikgew0KICAgIHJldHVybiAoYXJyICYmIGFyci5sZW5ndGggPiAwICYmIGFyclthcnIubGVuZ3RoIC0gMV0pIHx8IHZvaWQgMDsNCiAgfQ0KDQogIGZ1bmN0aW9uIG50aChhcnIsIG4pIHsNCiAgICByZXR1cm4gYXJyICYmIChuIDwgMCA/IGFyclthcnIubGVuZ3RoICsgbl0gOiBhcnJbbl0pOw0KICB9DQoNCiAgZnVuY3Rpb24gcHVsbEFsbChhcnIsIHZhbHVlcykgew0KICAgIGlmICghaXNBcnJheSh2YWx1ZXMpKSByZXR1cm4gYXJyOw0KICAgIHZhciBpID0gYXJyLmxlbmd0aDsNCiAgICB3aGlsZSAoaS0tKSB7DQogICAgICBpZiAodmFsdWVzLmluY2x1ZGVzKGFycltpXSkpIGFyci5zcGxpY2UoaSwgMSk7DQogICAgfQ0KICAgIHJldHVybiBhcnI7DQogIH0NCg0KICBmdW5jdGlvbiBwdWxsKGFycikgew0KICAgIHJldHVybiBwdWxsQWxsKGFyciwgdGFpbChhcmd1bWVudHMpKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlbW92ZShhcnIsIGZuKSB7DQogICAgdmFyIGkgPSBhcnIubGVuZ3RoLA0KICAgICAgaXRlID0gaXRlcmF0ZWUoZm4pOw0KICAgIHdoaWxlIChpLS0pIHsNCiAgICAgIGlmIChpdGUoYXJyW2ldLCBpLCBhcnIpKSBhcnIuc3BsaWNlKGksIDEpOw0KICAgIH0NCiAgICByZXR1cm4gYXJyOw0KICB9DQoNCiAgZnVuY3Rpb24gZGlmZmVyZW5jZShhcnIsIHZhbHVlcykgew0KICAgIHJldHVybiBmaWx0ZXIoYXJyLCBmdW5jdGlvbiggaXQgKXtyZXR1cm4gICFpbmNsdWRlcyh2YWx1ZXMsIGl0KX0pOw0KICB9DQoNCiAgZnVuY3Rpb24gdW56aXAoYXJyKSB7DQogICAgaWYgKGFyciA9PSBudWxsIHx8ICFhcnIubGVuZ3RoKSB7DQogICAgICByZXR1cm4gW107DQogICAgfQ0KICAgIHZhciBsZW4gPSAwOw0KICAgIGFyciA9IGZpbHRlcihhcnIsIGZ1bmN0aW9uKCBpdCApIHsNCiAgICAgIGlmIChoYXMoaXQsICdsZW5ndGgnKSkgew0KICAgICAgICBsZW4gPSBNYXRoLm1heChpdC5sZW5ndGgsIGxlbik7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgfQ0KICAgIH0pOw0KICAgIHZhciBpID0gLTEsDQogICAgICByZXN1bHQgPSBBcnJheShsZW4pOw0KICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgIHJlc3VsdFtpXSA9IG1hcChhcnIsIGkpOw0KICAgIH0NCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9DQoNCiAgZnVuY3Rpb24gemlwKCkgew0KICAgIHJldHVybiB1bnppcChhcmd1bWVudHMpOw0KICB9DQoNCiAgZnVuY3Rpb24gZmxhdHRlbihhcnIpIHsNCiAgICByZXR1cm4gcmVkdWNlKA0KICAgICAgYXJyLCBmdW5jdGlvbg0KICAgICAgKHJzdCwgaXQpICB7DQogICAgICAgIGlmIChpc0FycmF5KGl0KSkgcnN0ID0gcnN0LmNvbmNhdChpdCk7DQogICAgICAgIGVsc2UgcnN0LnB1c2goaXQpOw0KICAgICAgICByZXR1cm4gcnN0Ow0KICAgICAgfSwNCiAgICAgIFtdDQogICAgKTsNCiAgfQ0KDQoNCg0KDQoNCiAgZnVuY3Rpb24ga2V5cyhvYmopIHsNCiAgICByZXR1cm4gb2JqID8gT2JqZWN0LmtleXMob2JqKSA6IFtdOw0KICB9DQoNCiAgZnVuY3Rpb24gdmFsdWVzKG9iaikgew0KICAgIHJldHVybiBvYmogPyBrZXlzKG9iaikubWFwKHByb3BlcnR5T2Yob2JqKSkgOiBbXTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGtleXNJbihvYmopIHsNCiAgICB2YXIgYXJyID0gW107DQogICAgaWYgKG9iaikgew0KICAgICAgZm9yICh2YXIgayBpbiBvYmopIHsNCiAgICAgICAgYXJyLnB1c2goayk7DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiBhcnI7DQogIH0NCg0KICBmdW5jdGlvbiB2YWx1ZXNJbihvYmopIHsNCiAgICByZXR1cm4gb2JqID8ga2V5c0luKG9iaikubWFwKHByb3BlcnR5T2Yob2JqKSkgOiBbXTsNCiAgfQ0KDQoNCg0KICBmdW5jdGlvbiB6aXBPYmplY3QocHJvcHMsIHZhbHVlcykgew0KICAgIHZhciBpID0gLTEsDQogICAgICBsZW4gPSBwcm9wcy5sZW5ndGgsDQogICAgICB2TGVuID0gdmFsdWVzLmxlbmd0aCwNCiAgICAgIHJlc3VsdCA9IHt9Ow0KICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgIHJlc3VsdFtwcm9wc1tpXV0gPSBpIDwgdkxlbiA/IHZhbHVlc1tpXSA6IHZvaWQgMDsNCiAgICB9DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfQ0KDQoNCg0KICBmdW5jdGlvbiBmcm9tUGFpcnMocGFpcnMpIHsNCiAgICB2YXIgcmVzdWx0ID0ge30sDQogICAgICBpID0gLTEsDQogICAgICBsZW4gPSBwYWlycy5sZW5ndGg7DQogICAgd2hpbGUgKCsraSA8IGxlbikgcmVzdWx0W3BhaXJzW2ldWzBdXSA9IHBhaXJzW2ldWzFdOw0KICAgIHJldHVybiByZXN1bHQ7DQogIH0NCg0KICBmdW5jdGlvbiBvYmplY3QoYXJyMSwgYXJyMikgew0KICAgIHJldHVybiBhcnIyID8gemlwT2JqZWN0KGFycjEsIGFycjIpIDogZnJvbVBhaXJzKGFycjEpOw0KICB9DQoNCiAgZnVuY3Rpb24gZ2V0KG9iaiwgcHRoLCBkZWZWYWwpIHsNCiAgICB2YXIgaSA9IC0xLA0KICAgICAgX3B0aCA9IHRvUGF0aChwdGgpLA0KICAgICAgbGVuID0gX3B0aC5sZW5ndGg7DQogICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gZGVmVmFsOw0KICAgICAgb2JqID0gb2JqW19wdGhbaV1dOw0KICAgIH0NCiAgICByZXR1cm4gb2JqOw0KICB9DQoNCiAgZnVuY3Rpb24gYXQob2JqLCBwdGhzKSB7DQogICAgcmV0dXJuIHB0aHMubWFwKCBmdW5jdGlvbihwdGggKXtyZXR1cm4gIGdldChvYmosIHB0aCl9KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHByb3BlcnR5T2Yob2JqKSB7DQogICAgcmV0dXJuIGZ1bmN0aW9uKCBwdGggKXtyZXR1cm4gIGdldChvYmosIHB0aCl9Ow0KICB9DQoNCiAgZnVuY3Rpb24gcHJvcGVydHkocHRoKSB7DQogICAgcmV0dXJuIGZ1bmN0aW9uKCBvYmogKXtyZXR1cm4gIGdldChvYmosIHB0aCl9Ow0KICB9DQoNCiAgZnVuY3Rpb24gcHJvcGVydGllcyhwdGhzKSB7DQogICAgcmV0dXJuIGZ1bmN0aW9uKCBvYmogKXtyZXR1cm4gIGF0KG9iaiwgcHRocyl9Ow0KICB9DQoNCiAgZnVuY3Rpb24gc2V0KG9iaiwgcHRoLCB2YWx1ZSkgew0KICAgIHZhciBfcHRoID0gdG9QYXRoKHB0aCksDQogICAgICBrZXkgPSBsYXN0KF9wdGgpLA0KICAgICAgX29iaiA9IGdldChvYmosIGluaXRpYWwoX3B0aCkpOw0KICAgIGlmIChfb2JqICE9IG51bGwpIHsNCiAgICAgIF9vYmpba2V5XSA9IHZhbHVlOw0KICAgIH0NCiAgICByZXR1cm4gb2JqOw0KICB9DQoNCiAgZnVuY3Rpb24gdW5zZXQob2JqLCBwdGgpIHsNCiAgICB2YXIgX3B0aCA9IHRvUGF0aChwdGgpLA0KICAgICAga2V5ID0gbGFzdChfcHRoKSwNCiAgICAgIF9vYmogPSBnZXQob2JqLCBpbml0aWFsKF9wdGgpKTsNCiAgICBpZiAoX29iaiAhPSBudWxsICYmIGhhcyhfb2JqLCBrZXkpKSB7DQogICAgICBkZWxldGUgX29ialtrZXldOw0KICAgIH0NCiAgICByZXR1cm4gb2JqOw0KICB9DQoNCiAgZnVuY3Rpb24gdXBkYXRlKG9iaiwgcHRoLCBmbikgew0KICAgIHZhciBfcHRoID0gdG9QYXRoKHB0aCksDQogICAgICBrZXkgPSBsYXN0KF9wdGgpLA0KICAgICAgX29iaiA9IGdldChvYmosIGluaXRpYWwoX3B0aCkpOw0KICAgIGlmIChfb2JqICE9IG51bGwpIHsNCiAgICAgIF9vYmpba2V5XSA9IGZuKF9vYmpba2V5XSk7DQogICAgfQ0KICAgIHJldHVybiBvYmo7DQogIH0NCg0KICBmdW5jdGlvbiBwaWNrKG9iaiwgcHRocykgew0KICAgIHZhciBfcHRocyA9IHB0aHMubWFwKCBmdW5jdGlvbihpdCApe3JldHVybiAgdG9QYXRoKGl0KX0pOw0KICAgIHJldHVybiBfcHRocy5yZWR1Y2UoIGZ1bmN0aW9uKHJlc3VsdCwgcHRoKSAgew0KICAgICAgdmFyIHZhbHVlID0gZ2V0KG9iaiwgcHRoKTsNCiAgICAgIGlmICh2YWx1ZSkgcmVzdWx0W2xhc3QocHRoKV0gPSB2YWx1ZTsNCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfSwge30pOw0KICB9DQoNCg0KDQogIGZ1bmN0aW9uIGlzTWF0Y2gob2JqLCBhdHRycykgew0KICAgIGlmIChvYmogPT0gbnVsbCB8fCBhdHRycyA9PSBudWxsKSByZXR1cm4gZmFsc2U7DQogICAgZm9yICh2YXIga2V5IGluIGF0dHJzKSB7DQogICAgICBpZiAoIWhhcyhhdHRycywga2V5KSkgY29udGludWU7DQogICAgICBpZiAoIWhhcyhvYmosIGtleSkgfHwgYXR0cnNba2V5XSAhPT0gb2JqW2tleV0pIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgcmV0dXJuIHRydWU7DQogIH0NCg0KDQogIGZ1bmN0aW9uIG1hdGNoZXMoYXR0cnMpIHsNCiAgICByZXR1cm4gZnVuY3Rpb24oIG9iaiApe3JldHVybiAgaXNNYXRjaChvYmosIGF0dHJzKX07DQogIH0NCg0KICB2YXIgbWF0Y2hlciA9IG1hdGNoZXM7DQoNCiAgZnVuY3Rpb24gZXh0ZW5kKG9iaikgew0KICAgIHZhciBpID0gMCwNCiAgICAgIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGgsDQogICAgICBzb3VyY2UsDQogICAgICBrZXk7DQogICAgb2JqIHx8IChvYmogPSB7fSk7DQogICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgc291cmNlID0gYXJndW1lbnRzW2ldOw0KICAgICAgZm9yIChrZXkgaW4gc291cmNlKSBvYmpba2V5XSA9IHNvdXJjZVtrZXldOw0KICAgIH0NCiAgICByZXR1cm4gb2JqOw0KICB9DQoNCiAgdmFyIGFzc2lnbkluID0gZXh0ZW5kOw0KDQogIGZ1bmN0aW9uIGRlZmF1bHRzKG9iaikgew0KICAgIHZhciBpID0gMCwNCiAgICAgIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGgsDQogICAgICBzb3VyY2UsDQogICAgICBrZXk7DQogICAgb2JqIHx8IChvYmogPSB7fSk7DQogICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgc291cmNlID0gYXJndW1lbnRzW2ldOw0KICAgICAgZm9yIChrZXkgaW4gc291cmNlKSB7DQogICAgICAgIGlmICghaGFzKG9iaiwga2V5KSkgb2JqW2tleV0gPSBzb3VyY2Vba2V5XTsNCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIG9iajsNCiAgfQ0KDQogIGZ1bmN0aW9uIGVudHJpZXMob2JqKSB7DQogICAgcmV0dXJuIG9iaiA/IG1hcChvYmosIGZ1bmN0aW9uICh2LCBrKSB7cmV0dXJuICBbaywgdl19KSA6IFtdOw0KICB9DQoNCiAgdmFyIHRvUGFpcnMgPSBlbnRyaWVzOw0KDQoNCg0KDQoNCiAgZnVuY3Rpb24gbWVtb2l6ZShmbiwgcmVzb2x2ZXIpIHsNCiAgICB2YXIgbWVtb2l6ZWQgPSBmdW5jdGlvbihrZXkpIHsNCiAgICAgIHZhciBjYWNoZSA9IG1lbW9pemVkLmNhY2hlLA0KICAgICAgICBhcmdzID0gYXJndW1lbnRzLA0KICAgICAgICBhZGRyID0gcmVzb2x2ZXIgPyBhcHBseShyZXNvbHZlciwgdGhpcywgYXJncykgOiBrZXk7DQogICAgICBpZiAoIWNhY2hlLmhhcyhhZGRyKSkgew0KICAgICAgICBjYWNoZS5zZXQoYWRkciwgYXBwbHkoZm4sIHRoaXMsIGFyZ3MpKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBjYWNoZS5nZXQoYWRkcik7DQogICAgfTsNCiAgICBtZW1vaXplZC5jYWNoZSA9IG5ldyBNYXAoKTsNCiAgICByZXR1cm4gbWVtb2l6ZWQ7DQogIH0NCg0KICBmdW5jdGlvbiBwYXJ0aWFsKGZuLCBib3VuZEFyZ3MpIHsNCiAgICBib3VuZEFyZ3MgPSB0b0FycmF5KGFyZ3VtZW50cykuc2xpY2UoMSk7DQoNCiAgICByZXR1cm4gZnVuY3Rpb24oKSB7DQogICAgICB2YXIgX2FyZ3MgPSB0b0FycmF5KGFyZ3VtZW50cyksDQogICAgICAgIGkgPSAwOw0KICAgICAgdmFyIGFyZ3MgPSBib3VuZEFyZ3MubWFwKCBmdW5jdGlvbihhcmcgKXtyZXR1cm4gIChhcmcgPT09IHBhcnRpYWwuXyA/IF9hcmdzW2krK10gOiBhcmcpfSk7DQogICAgICBhcmdzID0gYXJncy5jb25jYXQoX2FyZ3Muc2xpY2UoaSkpOw0KICAgICAgcmV0dXJuIGFwcGx5KGZuLCB0aGlzLCBhcmdzKTsNCiAgICB9Ow0KICB9DQogIHBhcnRpYWwuXyA9IHt9Ow0KDQogIGZ1bmN0aW9uIGN1cnJ5KGZuKSB7DQogICAgdmFyIGFyZ3NMZW4gPSBmbi5sZW5ndGgsDQogICAgICBhcmdzID0gW107DQogICAgdmFyIGN1cnJpZWQgPSBmdW5jdGlvbigpIHsNCiAgICAgIGFyZ3MgPSBjb25jYXQoYXJncywgYXJndW1lbnRzKTsNCiAgICAgIGlmIChhcmdzTGVuID09PSBhcmdzLmxlbmd0aCkgcmV0dXJuIGFwcGx5KGZuLCB0aGlzLCBhcmdzKTsNCiAgICAgIGVsc2UgcmV0dXJuIGN1cnJpZWQ7DQogICAgfTsNCiAgICByZXR1cm4gYXJnc0xlbiA8IDIgPyBmbiA6IGN1cnJpZWQ7DQogIH0NCg0KICBmdW5jdGlvbiBhcnkoZm4sIG4pIHsNCiAgICByZXR1cm4gbiA9PSBudWxsDQogICAgICA/IGZuDQogICAgICA6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgIHZhciBhcmdzID0gc2xpY2UoYXJndW1lbnRzLCAwLCBuKTsNCiAgICAgICAgICByZXR1cm4gYXBwbHkoZm4sIHRoaXMsIGFyZ3MpOw0KICAgICAgICB9Ow0KICB9DQoNCiAgZnVuY3Rpb24gd3JhcChmbiwgd3JhcHBlcikgew0KICAgIHdyYXBwZXIgfHwgKHdyYXBwZXIgPSBpZGVudGl0eSk7DQogICAgcmV0dXJuIGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuIGFwcGx5KHdyYXBwZXIsIHRoaXMsIGNvbmNhdChbZm5dLCBhcmd1bWVudHMpKTsNCiAgICB9Ow0KICB9DQoNCg0KDQoNCg0KICBmdW5jdGlvbiByYW5kb20obG93ZXIsIHVwcGVyKSB7DQogICAgaWYgKGxvd2VyID09IG51bGwpIHJldHVybiBNYXRoLnJhbmRvbSgpOw0KICAgIGlmICh1cHBlciA9PSBudWxsKSB7DQogICAgICB1cHBlciA9IGxvd2VyOw0KICAgICAgbG93ZXIgPSAwOw0KICAgIH0NCiAgICBpZiAobG93ZXIgPiB1cHBlcikgew0KICAgICAgdmFyIHRlbXAgPSBsb3dlcjsNCiAgICAgIGxvd2VyID0gdXBwZXI7DQogICAgICB1cHBlciA9IHRlbXA7DQogICAgfQ0KICAgIHJldHVybiBsb3dlciArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICh1cHBlciAtIGxvd2VyICsgMSkpOw0KICB9DQoNCiAgZnVuY3Rpb24gc3VtKCkgew0KICAgIHZhciBhcnIgPSBhcmd1bWVudHMubGVuZ3RoID09PSAxID8gYXJndW1lbnRzWzBdIDogYXJndW1lbnRzOw0KICAgIHJldHVybiByZWR1Y2UoYXJyLCBmdW5jdGlvbiAocmVzdWx0LCBpdCkge3JldHVybiAgKHJlc3VsdCArPSBpdCl9LCAwKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGF2ZXJhZ2UoKSB7DQogICAgdmFyIGFyciA9IGFyZ3VtZW50cy5sZW5ndGggPT09IDEgPyBhcmd1bWVudHNbMF0gOiBhcmd1bWVudHM7DQogICAgdmFyIGxlbiA9IGFyci5sZW5ndGg7DQogICAgcmV0dXJuIGxlbiA9PT0gMCA/IDAgOiBzdW0oYXJyKSAvIGxlbjsNCiAgfQ0KDQogIHZhciBhdmcgPSBhdmVyYWdlOw0KDQogIGZ1bmN0aW9uIGRlY2ltYWxBZGp1c3QobWV0aG9kTmFtZSwgbnVtYmVyLCBwcmVjaXNpb24pIHsNCiAgICBpZiAocHJlY2lzaW9uKSB7DQogICAgICB2YXIgdmFsdWUgPSBNYXRoW21ldGhvZE5hbWVdKG51bWJlciArICdlJyArIHByZWNpc2lvbik7DQogICAgICByZXR1cm4gKyh2YWx1ZSArICdlJyArIC1wcmVjaXNpb24pOw0KICAgIH0NCiAgICByZXR1cm4gTWF0aFttZXRob2ROYW1lXShudW1iZXIpOw0KICB9DQoNCiAgZnVuY3Rpb24gcm91bmQobnVtLCBwcmVjaXNpb24pIHsNCiAgICByZXR1cm4gZGVjaW1hbEFkanVzdCgncm91bmQnLCBudW0sIHByZWNpc2lvbik7DQogIH0NCg0KICBmdW5jdGlvbiBmbG9vcihudW0sIHByZWNpc2lvbikgew0KICAgIHJldHVybiBkZWNpbWFsQWRqdXN0KCdmbG9vcicsIG51bSwgcHJlY2lzaW9uKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNlaWwobnVtLCBwcmVjaXNpb24pIHsNCiAgICByZXR1cm4gZGVjaW1hbEFkanVzdCgnY2VpbCcsIG51bSwgcHJlY2lzaW9uKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJhZGlhbnMoeCkgew0KICAgIHJldHVybiAoTWF0aC5QSSAvIDE4MCkgKiB4Ow0KICB9DQoNCg0KDQoNCg0KICBmdW5jdGlvbiB0b1VwcGVyKHgpIHsNCiAgICByZXR1cm4geC50b1VwcGVyQ2FzZSgpOw0KICB9DQoNCiAgZnVuY3Rpb24gdG9Mb3dlcih4KSB7DQogICAgcmV0dXJuIHgudG9Mb3dlckNhc2UoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHRyaW0oeCkgew0KICAgIHJldHVybiB4LnRyaW0oKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlcGVhdChzdHIsIG4pIHsNCiAgICB2YXIgcnN0ID0gJyc7DQogICAgaWYgKCFpc1N0cmluZyhzdHIpKSBzdHIgPSBTdHJpbmcoc3RyKTsNCiAgICBpZiAobiA8IDEgfHwgIWlzRmluaXRlKG4pKSByZXR1cm4gcnN0Ow0KICAgIGRvIHsNCiAgICAgIGlmIChuICUgMikgcnN0ICs9IHN0cjsNCiAgICAgIG4gPSBNYXRoLmZsb29yKG4gLyAyKTsNCiAgICAgIGlmIChuKSBzdHIgKz0gc3RyOw0KICAgIH0gd2hpbGUgKG4pOw0KICAgIHJldHVybiByc3Q7DQogIH0NCg0KICBmdW5jdGlvbiBjcmVhdGVQYWRkaW5nKGxlbiwgY2hycykgew0KICAgIGNocnMgfHwgKGNocnMgPSAnICcpOw0KICAgIHZhciBwYWQgPSBjaHJzLnJlcGVhdChNYXRoLmNlaWwobGVuIC8gY2hycy5sZW5ndGgpKTsNCiAgICByZXR1cm4gcGFkLmxlbmd0aCA+IGxlbiA/IHBhZC5zbGljZSgwLCBsZW4pIDogcGFkOw0KICB9DQoNCiAgZnVuY3Rpb24gcGFkU3RhcnQoc3RyLCBsZW4sIGNocnMpIHsNCiAgICBpZiAoIWlzU3RyaW5nKHN0cikpIHN0ciA9IFN0cmluZyhzdHIpOw0KICAgIHZhciBzdHJMZW4gPSBzdHIubGVuZ3RoOw0KICAgIGlmIChsZW4gPT0gbnVsbCB8fCBsZW4gPD0gc3RyTGVuKSByZXR1cm4gc3RyOw0KICAgIHJldHVybiBjcmVhdGVQYWRkaW5nKGxlbiAtIHN0ckxlbiwgY2hycykgKyBzdHI7DQogIH0NCg0KICBmdW5jdGlvbiBwYWRFbmQoc3RyLCBsZW4sIGNocnMpIHsNCiAgICBpZiAoIWlzU3RyaW5nKHN0cikpIHN0ciA9IFN0cmluZyhzdHIpOw0KICAgIHZhciBzdHJMZW4gPSBzdHIubGVuZ3RoOw0KICAgIGlmIChsZW4gPT0gbnVsbCB8fCBsZW4gPD0gc3RyTGVuKSByZXR1cm4gc3RyOw0KICAgIHJldHVybiBzdHIgKyBjcmVhdGVQYWRkaW5nKGxlbiAtIHN0ckxlbiwgY2hycyk7DQogIH0NCg0KICBmdW5jdGlvbiBzdGFydHNXaXRoKHN0ciwgdGFyZ2V0LCBwb3MpIHsNCiAgICByZXR1cm4gc3RyLnN1YnN0cighcG9zIHx8IHBvcyA8IDAgPyAwIDogK3BvcywgdGFyZ2V0Lmxlbmd0aCkgPT0gdGFyZ2V0Ow0KICB9DQoNCiAgZnVuY3Rpb24gZW5kc1dpdGgoc3RyLCB0YXJnZXQsIHRoaXNfbGVuKSB7DQogICAgaWYgKHRoaXNfbGVuID09IG51bGwgfHwgdGhpc19sZW4gPiBzdHIubGVuZ3RoKSB0aGlzX2xlbiA9IHN0ci5sZW5ndGg7DQogICAgcmV0dXJuIHN0ci5zdWJzdHJpbmcodGhpc19sZW4gLSB0YXJnZXQubGVuZ3RoLCB0aGlzX2xlbikgPT0gdGFyZ2V0Ow0KICB9DQoNCiAgZnVuY3Rpb24gZWFjaE1hdGNoKHN0ciwgcGF0dGVybiwgZm4pIHsNCiAgICBpZiAoIWlzU3RyaW5nKHN0cikgfHwgIWlzUmVnRXhwKHBhdHRlcm4pKSB7DQogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdpbnZhbGlkIGFyZ3VtZW50cycpOw0KICAgIH0NCiAgICBpZiAoIXBhdHRlcm4uZ2xvYmFsKSB7DQogICAgICBwYXR0ZXJuID0gUmVnRXhwKHBhdHRlcm4uc291cmNlLCAnZycpOw0KICAgIH0NCiAgICB2YXIgbWF0Y2g7DQogICAgZm9yICg7Oykgew0KICAgICAgbWF0Y2ggPSBwYXR0ZXJuLmV4ZWMoc3RyKTsNCiAgICAgIGlmICghbWF0Y2gpIGJyZWFrOw0KICAgICAgaWYgKGFwcGx5KGZuLCBudWxsLCBtYXRjaCkgPT09IGZhbHNlKSBicmVhazsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBmaW5kQWxsKHN0ciwgcGF0dGVybikgew0KICAgIHZhciByc3QgPSBbXTsNCiAgICBlYWNoTWF0Y2goc3RyLCBwYXR0ZXJuLCBmdW5jdGlvbiAoKSAgew0KICAgICAgcnN0LnB1c2goYXJndW1lbnRzLmxlbmd0aCA9PSAxID8gYXJndW1lbnRzWzBdIDogYXJndW1lbnRzKTsNCiAgICB9KTsNCiAgICByZXR1cm4gcnN0Ow0KICB9CgogIHZhciB0b29sID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgY2hyOiBjaHIsCiAgICBvcmQ6IG9yZCwKICAgIGhleDogaGV4LAogICAgYmluOiBiaW4sCiAgICBvY3Q6IG9jdCwKICAgIGludDogaW50LAogICAgZ2V0RnVuY05hbWU6IGdldEZ1bmNOYW1lLAogICAgZ2V0VGFnOiBnZXRUYWcsCiAgICB0eXBlT2Y6IHR5cGVPZiwKICAgIHR5cGU6IHR5cGUsCiAgICBoYXM6IGhhcywKICAgIGlzQXJyYXk6IGlzQXJyYXksCiAgICBpc09iamVjdDogaXNPYmplY3QsCiAgICBpc0Z1bmN0aW9uOiBpc0Z1bmN0aW9uLAogICAgaXNTdHJpbmc6IGlzU3RyaW5nLAogICAgaXNOdW1iZXI6IGlzTnVtYmVyLAogICAgaXNCb29sZWFuOiBpc0Jvb2xlYW4sCiAgICBpc0RhdGU6IGlzRGF0ZSwKICAgIGlzUmVnRXhwOiBpc1JlZ0V4cCwKICAgIGlzRXJyb3I6IGlzRXJyb3IsCiAgICBpc01hcDogaXNNYXAsCiAgICBpc1NldDogaXNTZXQsCiAgICBpc1dlYWtNYXA6IGlzV2Vha01hcCwKICAgIGlzSW50ZWdlcjogaXNJbnRlZ2VyLAogICAgaXNBcmd1bWVudHM6IGlzQXJndW1lbnRzLAogICAgaXNPYmplY3RMaWtlOiBpc09iamVjdExpa2UsCiAgICBpc0xlbmd0aDogaXNMZW5ndGgsCiAgICBpc0FycmF5TGlrZTogaXNBcnJheUxpa2UsCiAgICBpc0VtcHR5OiBpc0VtcHR5LAogICAgaXNCdWZmZXI6IGlzQnVmZmVyLAogICAgYXBwbHk6IGFwcGx5LAogICAgcmFuZ2U6IHJhbmdlLAogICAgdG9QYXRoOiB0b1BhdGgsCiAgICBpZGVudGl0eTogaWRlbnRpdHksCiAgICBpdGVyYXRlZTogaXRlcmF0ZWUsCiAgICB0aW1laXQ6IHRpbWVpdCwKICAgIGVhY2g6IGVhY2gsCiAgICBmb3JFYWNoOiBmb3JFYWNoLAogICAgbWFwOiBtYXAsCiAgICBzZWxlY3Q6IHNlbGVjdCwKICAgIHJlZHVjZTogcmVkdWNlLAogICAgZmlsdGVyOiBmaWx0ZXIsCiAgICB3aGVyZTogd2hlcmUsCiAgICB0b0FycmF5OiB0b0FycmF5LAogICAgZmluZDogZmluZCwKICAgIGZpbmRJbmRleDogZmluZEluZGV4LAogICAgZmlsbDogZmlsbCwKICAgIGdyb3VwQnk6IGdyb3VwQnksCiAgICBjb3VudEJ5OiBjb3VudEJ5LAogICAgc2l6ZTogc2l6ZSwKICAgIGxlbjogbGVuLAogICAgdW5pcUJ5OiB1bmlxQnksCiAgICB1bmlxOiB1bmlxLAogICAgZGlzdGluY3Q6IGRpc3RpbmN0LAogICAgZGlzdGluY3RCeTogZGlzdGluY3RCeSwKICAgIGNodW5rOiBjaHVuaywKICAgIGNvbmNhdDogY29uY2F0LAogICAgc2xpY2U6IHNsaWNlLAogICAgZHJvcDogZHJvcCwKICAgIHRhaWw6IHRhaWwsCiAgICBpbml0aWFsOiBpbml0aWFsLAogICAgdGFrZTogdGFrZSwKICAgIHRha2VSaWdodDogdGFrZVJpZ2h0LAogICAgY29udGFpbnM6IGNvbnRhaW5zLAogICAgaW5jbHVkZTogaW5jbHVkZSwKICAgIGluY2x1ZGVzOiBpbmNsdWRlcywKICAgIGZpcnN0OiBmaXJzdCwKICAgIGhlYWQ6IGhlYWQsCiAgICBsYXN0OiBsYXN0LAogICAgbnRoOiBudGgsCiAgICBwdWxsQWxsOiBwdWxsQWxsLAogICAgcHVsbDogcHVsbCwKICAgIHJlbW92ZTogcmVtb3ZlLAogICAgZGlmZmVyZW5jZTogZGlmZmVyZW5jZSwKICAgIHVuemlwOiB1bnppcCwKICAgIHppcDogemlwLAogICAgZmxhdHRlbjogZmxhdHRlbiwKICAgIGtleXM6IGtleXMsCiAgICB2YWx1ZXM6IHZhbHVlcywKICAgIGtleXNJbjoga2V5c0luLAogICAgdmFsdWVzSW46IHZhbHVlc0luLAogICAgemlwT2JqZWN0OiB6aXBPYmplY3QsCiAgICBmcm9tUGFpcnM6IGZyb21QYWlycywKICAgIG9iamVjdDogb2JqZWN0LAogICAgZ2V0OiBnZXQsCiAgICBhdDogYXQsCiAgICBwcm9wZXJ0eU9mOiBwcm9wZXJ0eU9mLAogICAgcHJvcGVydHk6IHByb3BlcnR5LAogICAgcHJvcGVydGllczogcHJvcGVydGllcywKICAgIHNldDogc2V0LAogICAgdW5zZXQ6IHVuc2V0LAogICAgdXBkYXRlOiB1cGRhdGUsCiAgICBwaWNrOiBwaWNrLAogICAgaXNNYXRjaDogaXNNYXRjaCwKICAgIG1hdGNoZXM6IG1hdGNoZXMsCiAgICBtYXRjaGVyOiBtYXRjaGVyLAogICAgZXh0ZW5kOiBleHRlbmQsCiAgICBhc3NpZ25JbjogYXNzaWduSW4sCiAgICBkZWZhdWx0czogZGVmYXVsdHMsCiAgICBlbnRyaWVzOiBlbnRyaWVzLAogICAgdG9QYWlyczogdG9QYWlycywKICAgIG1lbW9pemU6IG1lbW9pemUsCiAgICBwYXJ0aWFsOiBwYXJ0aWFsLAogICAgY3Vycnk6IGN1cnJ5LAogICAgYXJ5OiBhcnksCiAgICB3cmFwOiB3cmFwLAogICAgcmFuZG9tOiByYW5kb20sCiAgICBzdW06IHN1bSwKICAgIGF2ZXJhZ2U6IGF2ZXJhZ2UsCiAgICBhdmc6IGF2ZywKICAgIHJvdW5kOiByb3VuZCwKICAgIGZsb29yOiBmbG9vciwKICAgIGNlaWw6IGNlaWwsCiAgICByYWRpYW5zOiByYWRpYW5zLAogICAgdG9VcHBlcjogdG9VcHBlciwKICAgIHRvTG93ZXI6IHRvTG93ZXIsCiAgICB0cmltOiB0cmltLAogICAgcmVwZWF0OiByZXBlYXQsCiAgICBwYWRTdGFydDogcGFkU3RhcnQsCiAgICBwYWRFbmQ6IHBhZEVuZCwKICAgIHN0YXJ0c1dpdGg6IHN0YXJ0c1dpdGgsCiAgICBlbmRzV2l0aDogZW5kc1dpdGgsCiAgICBlYWNoTWF0Y2g6IGVhY2hNYXRjaCwKICAgIGZpbmRBbGw6IGZpbmRBbGwKICB9KTsKCiAgZnVuY3Rpb24gaW5oZXJpdHMoY3Rvciwgc3VwZXJDdG9yKSB7DQogICAgY3Rvci5zdXBlcl8gPSBzdXBlckN0b3I7DQogICAgY3Rvci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ3Rvci5wcm90b3R5cGUsIHsNCiAgICAgIGNvbnN0cnVjdG9yOiBjdG9yDQogICAgfSk7DQogIH0NCg0KICB2YXIgRk1UX1JFRyA9IC8lW3NkaWZqb08lXS9nOw0KDQogIGZ1bmN0aW9uIGZvcm1hdChmKSB7DQogICAgaWYgKCFpc1N0cmluZyhmKSkgew0KICAgICAgcmV0dXJuIG1hcChhcmd1bWVudHMsIGZ1bmN0aW9uKCBhcmcgKXtyZXR1cm4gIGluc3BlY3QoYXJnKX0pLmpvaW4oJyAnKTsNCiAgICB9DQoNCiAgICB2YXIgaSA9IDEsDQogICAgICBhcmdzID0gYXJndW1lbnRzLA0KICAgICAgbGVuID0gYXJncy5sZW5ndGgsDQogICAgICBzdHIgPSBmLnJlcGxhY2UoRk1UX1JFRywgZnVuY3Rpb24oIHggKSB7DQogICAgICAgIGlmICh4ID09PSAnJSUnKSByZXR1cm4gJyUnOw0KICAgICAgICBpZiAoaSA+PSBsZW4pIHJldHVybiB4Ow0KICAgICAgICBzd2l0Y2ggKHgpIHsNCiAgICAgICAgICBjYXNlICclcyc6DQogICAgICAgICAgY2FzZSAnJWQnOg0KICAgICAgICAgIGNhc2UgJyVpJzoNCiAgICAgICAgICBjYXNlICclZic6DQogICAgICAgICAgICByZXR1cm4gYXJnc1tpKytdOw0KICAgICAgICAgIGNhc2UgJyVqJzoNCiAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShhcmdzW2krK10pOw0KICAgICAgICAgIGNhc2UgJyVvJzoNCiAgICAgICAgICBjYXNlICclTyc6DQogICAgICAgICAgICByZXR1cm4gaW5zcGVjdChhcmdzW2krK10pOw0KICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICByZXR1cm4geDsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgZm9yICh2YXIgeCA9IGFyZ3NbaV07IGkgPCBsZW47IHggPSBhcmdzWysraV0pIHsNCiAgICAgIGlmIChpc1ByaW1pdGl2ZSh4KSkgc3RyICs9ICcgJyArIHg7DQogICAgICBlbHNlIHN0ciArPSAnICcgKyBpbnNwZWN0KHgpOw0KICAgIH0NCiAgICByZXR1cm4gc3RyOw0KICB9DQoNCg0KDQoNCiAgZnVuY3Rpb24gZGVwcmVjYXRlKGZuLCBtc2cpIHsNCiAgICANCiAgICBpZiAoZ2xvYmFsLnByb2Nlc3MgPT09IHZvaWQgMCkgew0KICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtyZXR1cm4gIGFwcGx5KGRlcHJlY2F0ZShmbiwgbXNnKSwgbnVsbCwgYXJndW1lbnRzKX07DQogICAgfQ0KDQogICAgaWYgKHByb2Nlc3Mubm9EZXByZWNhdGlvbiA9PT0gdHJ1ZSkgcmV0dXJuIGZuOw0KDQogICAgdmFyIHdhcm5lZCA9IGZhbHNlOw0KDQogICAgZnVuY3Rpb24gZGVwcmVjYXRlZCgpIHsNCiAgICAgIGlmICghd2FybmVkKSB7DQogICAgICAgIGlmIChwcm9jZXNzLnRocm93RGVwcmVjYXRpb24pIHRocm93IG5ldyBFcnJvcihtc2cpOw0KICAgICAgICBlbHNlIGlmIChwcm9jZXNzLnRyYWNlRGVwcmVjYXRpb24pIGNvbnNvbGUubG9nKG1zZyk7DQogICAgICAgIGVsc2UgY29uc29sZS5sb2cobXNnKTsNCiAgICAgICAgd2FybmVkID0gdHJ1ZTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBhcHBseShmbiwgbnVsbCwgYXJndW1lbnRzKTsNCiAgICB9DQoNCiAgICByZXR1cm4gZGVwcmVjYXRlZDsNCiAgfQ0KDQogIHZhciBkZWJ1Z3MgPSB7fTsNCiAgdmFyIGRlYnVnRW52aXJvbjsNCg0KICBmdW5jdGlvbiBkZWJ1Z2xvZyhzZXQpIHsNCiAgICBpZiAoZGVidWdFbnZpcm9uID09IG51bGwpIGRlYnVnRW52aXJvbiA9IHByb2Nlc3MuZW52Lk5PREVfREVCVUcgfHwgJyc7DQogICAgc2V0ID0gc2V0LnRvVXBwZXJDYXNlKCk7DQogICAgaWYgKCFkZWJ1Z3Nbc2V0XSkgew0KICAgICAgaWYgKG5ldyBSZWdFeHAoJ1xcYicgKyBzZXQgKyAnXFxiJywgJ2knKS50ZXN0KGRlYnVnRW52aXJvbikpIHsNCiAgICAgICAgdmFyIHBpZCA9IHByb2Nlc3MucGlkOw0KICAgICAgICBkZWJ1Z3Nbc2V0XSA9IGZ1bmN0aW9uICgpICB7DQogICAgICAgICAgdmFyIG1zZyA9IGFwcGx5KGZvcm1hdCwgbnVsbCwgYXJndW1lbnRzKTsNCiAgICAgICAgICBjb25zb2xlLmxvZygnJXMgJWQ6ICVzJywgc2V0LCBwaWQsIG1zZyk7DQogICAgICAgIH07DQogICAgICB9IGVsc2Ugew0KICAgICAgICBkZWJ1Z3Nbc2V0XSA9IGZ1bmN0aW9uKCkge307DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiBkZWJ1Z3Nbc2V0XTsNCiAgfQ0KDQoNCiAgZnVuY3Rpb24gaW5zcGVjdChvYmosIHNob3dIaWRkZW4sIGRlcHRoLCBjb2xvcnMpIHsNCiAgICANCiAgICB2YXIgY3R4ID0gew0KICAgICAgc2VlbjogW10sDQogICAgICANCiAgICAgIHNob3dIaWRkZW46IGZhbHNlLA0KICAgICAgZGVwdGg6IDIsDQogICAgICBjb2xvcnM6IGZhbHNlLA0KICAgICAgY3VzdG9tSW5zcGVjdDogZmFsc2UsDQogICAgICBtYXhBcnJheUxlbmd0aDogMTAwLA0KICAgICAgYnJlYWtMZW5ndGg6IDYwDQogICAgfTsNCiAgICBpZiAoaXNCb29sZWFuKHNob3dIaWRkZW4pKSBjdHguc2hvd0hpZGRlbiA9IHNob3dIaWRkZW47DQogICAgaWYgKGlzTnVtYmVyKGRlcHRoKSkgY3R4LmRlcHRoID0gZGVwdGg7DQogICAgaWYgKGlzQm9vbGVhbihjb2xvcnMpKSBjdHguY29sb3JzID0gY29sb3JzOw0KICAgIGlmIChpc09iamVjdChzaG93SGlkZGVuKSkgew0KICAgICAgDQogICAgICBPYmplY3QuYXNzaWduKGN0eCwgc2hvd0hpZGRlbik7DQogICAgfQ0KICAgIHJldHVybiBmb3JtYXRWYWx1ZShjdHgsIG9iaiwgMCk7DQogIH0NCg0KICBmdW5jdGlvbiBmb3JtYXRWYWx1ZShjdHgsIHZhbHVlLCByZWN1cnNlVGltZXMpIHsNCiAgICB2YXIgcmVzdWx0Ow0KICAgIA0KICAgIA0KICAgIGlmICgNCiAgICAgIGN0eC5jdXN0b21JbnNwZWN0ICYmDQogICAgICB2YWx1ZSAmJg0KICAgICAgaXNGdW5jdGlvbih2YWx1ZS5pbnNwZWN0KSAmJg0KICAgICAgDQogICAgICB2YWx1ZS5pbnNwZWN0ICE9PSBpbnNwZWN0ICYmDQogICAgICANCiAgICAgICEodmFsdWUuY29uc3RydWN0b3IgJiYgdmFsdWUuY29uc3RydWN0b3IucHJvdG90eXBlID09PSB2YWx1ZSkNCiAgICApIHsNCiAgICAgIHJlc3VsdCA9IHZhbHVlLmluc3BlY3QocmVjdXJzZVRpbWVzLCBjdHgpOw0KICAgICAgaWYgKCFpc1N0cmluZyhyZXN1bHQpKSB7DQogICAgICAgIHJlc3VsdCA9IGZvcm1hdFZhbHVlKGN0eCwgcmVzdWx0LCByZWN1cnNlVGltZXMpOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICANCiAgICByZXN1bHQgPSBmb3JtYXRWYWx1ZV9zaW1wbGUodmFsdWUpOw0KICAgIGlmIChyZXN1bHQgIT09IGZhbHNlKSByZXR1cm4gcmVzdWx0Ow0KDQogICAgDQogICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyh2YWx1ZSk7DQogICAgdmFyIHZpc2libGVLZXlzID0ga2V5cy5yZWR1Y2UoIGZ1bmN0aW9uKG1lbW8sIGtleSkge3JldHVybiAgKChtZW1vW2tleV0gPSB0cnVlKSwgbWVtbyl9LCB7fSk7DQoNCiAgICBpZiAoY3R4LnNob3dIaWRkZW4pIHsNCiAgICAgIGtleXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh2YWx1ZSk7DQogICAgfQ0KDQogICAgaWYgKHJlY3Vyc2VUaW1lcyA+IGN0eC5kZXB0aCkgcmV0dXJuIGdldFRhZyh2YWx1ZSk7DQoNCiAgICBjdHguc2Vlbi5wdXNoKHZhbHVlKTsNCg0KICAgIHZhciBvdXRwdXQsDQogICAgICB2VHlwZSA9IHR5cGVPZih2YWx1ZSk7DQogICAgb3V0cHV0ID0gZm9ybWF0T2JqZWN0KGN0eCwgdmFsdWUsIHJlY3Vyc2VUaW1lcywgdmlzaWJsZUtleXMsIGtleXMsIHZUeXBlKTsNCiAgICBjdHguc2Vlbi5wb3AoKTsNCg0KICAgIHJldHVybiByZWR1Y2VUb1NpbmdsZVN0cmluZyhjdHgsIG91dHB1dCwgcmVjdXJzZVRpbWVzLCB2VHlwZSk7DQogIH0NCg0KICB2YXIgRVNDQVBTRV9NQVAgPSB7DQogICAgIiciOiAiJyIsDQogICAgJ1xcJzogJ1xcJywNCiAgICAnXHInOiAncicsDQogICAgJ1xuJzogJ24nLA0KICAgICdcdTIwMjgnOiAndTIwMjgnLA0KICAgICdcdTIwMjknOiAndTIwMjknDQogIH07DQoNCiAgdmFyIEVTQ0FQU0VfUkVHID0gLyd8XFx8XHJ8XG58XHUyMDI4fFx1MjAyOV0vZzsNCg0KICBmdW5jdGlvbiBlc2NhcGVDaGFyKGMpIHsNCiAgICByZXR1cm4gJ1xcJyArIEVTQ0FQU0VfTUFQW2NdOw0KICB9DQoNCiAgZnVuY3Rpb24gZm9ybWF0VmFsdWVfc2ltcGxlKHZhbHVlKSB7DQogICAgaWYgKHZhbHVlID09PSB2b2lkIDApIHJldHVybiAndW5kZWZpbmVkJzsNCiAgICBpZiAodmFsdWUgPT09IG51bGwpIHJldHVybiAnbnVsbCc7DQogICAgc3dpdGNoICh0eXBlT2YodmFsdWUpKSB7DQogICAgICBjYXNlICdzdHJpbmcnOg0KICAgICAgICByZXR1cm4gIiciICsgdmFsdWUucmVwbGFjZShFU0NBUFNFX1JFRywgZXNjYXBlQ2hhcikgKyAiJyI7DQogICAgICBjYXNlICdudW1iZXInOg0KICAgICAgY2FzZSAnYm9vbGVhbic6DQogICAgICBjYXNlICdyZWdleHAnOg0KICAgICAgICByZXR1cm4gU3RyaW5nKHZhbHVlKTsNCiAgICAgIGNhc2UgJ2RhdGUnOg0KICAgICAgICByZXR1cm4gdmFsdWUudG9KU09OKCk7DQogICAgICBjYXNlICdmdW5jdGlvbic6IHsNCiAgICAgICAgdmFyIG5hbWUgPSBnZXRGdW5jTmFtZSh2YWx1ZSk7DQogICAgICAgIHJldHVybiBuYW1lID8gJ1tGdW5jdGlvbjogJyArIG5hbWUgKyAnXScgOiAnW0Z1bmN0aW9uXSc7DQogICAgICB9DQogICAgICBjYXNlICdlcnJvcic6DQogICAgICAgIHJldHVybiAnWycgKyB2YWx1ZSArICddJzsNCiAgICAgIGNhc2UgJ2J1ZmZlcic6IHsNCiAgICAgICAgdmFyIGJ5dGVzID0gdmFsdWUuYnVmZmVyLA0KICAgICAgICAgIGxlbiA9IHZhbHVlLmxlbmd0aCwNCiAgICAgICAgICBpID0gLTEsDQogICAgICAgICAgb3ZlcmZsb3csDQogICAgICAgICAgYXJyOw0KICAgICAgICBpZiAobGVuID4gNTApIHsNCiAgICAgICAgICBvdmVyZmxvdyA9IHRydWU7DQogICAgICAgICAgbGVuID0gNTA7DQogICAgICAgICAgYXJyID0gQXJyYXkoNTEpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGFyciA9IEFycmF5KGxlbik7DQogICAgICAgIH0NCiAgICAgICAgd2hpbGUgKCsraSA8IGxlbikgYXJyW2ldID0gaGV4KGJ5dGVzLmdldEl0ZW0oaSkpOw0KICAgICAgICBpZiAob3ZlcmZsb3cpIGFycls1MF0gPSAnLi4uJzsNCiAgICAgICAgcmV0dXJuICc8QnVmZmVyICcgKyBhcnIuam9pbignICcpICsgJz4nOw0KICAgICAgfQ0KICAgICAgZGVmYXVsdDoNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIGZvcm1hdE9iamVjdChjdHgsIG9iaiwgcmVjdXJzZVRpbWVzLCB2aXNpYmxlS2V5cywga2V5cywgdlR5cGUpIHsNCiAgICB2YXIgb3V0cHV0ID0gW10sDQogICAgICBpID0gMCwNCiAgICAgIGxlbiwNCiAgICAgIGtleTsNCiAgICBpZiAodlR5cGUgPT0gJ2FycmF5Jykgew0KICAgICAgbGVuID0gb2JqLmxlbmd0aDsNCiAgICAgIGZvciAoOyBpIDwgbGVuOyBpKyspIHsNCiAgICAgICAgaWYgKGkgPj0gY3R4Lm1heEFycmF5TGVuZ3RoKSB7DQogICAgICAgICAgb3V0cHV0LnB1c2goJy4uLiAnICsgKGxlbiAtIGN0eC5tYXhBcnJheUxlbmd0aCkgKyAnIG1vcmUgaXRlbXMnKTsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KICAgICAgICBvdXRwdXQucHVzaChmb3JtYXRQcm9wZXJ0eShjdHgsIG9ialtpXSwgcmVjdXJzZVRpbWVzLCBudWxsLCB0cnVlLCBudWxsKSk7DQogICAgICB9DQogICAgICBpID0gbGVuOw0KICAgIH0gZWxzZSBpZiAodlR5cGUgPT0gJ21hcCcpIHsNCiAgICAgIG9iai5mb3JFYWNoKCBmdW5jdGlvbih2YWx1ZSwga2V5KSAgew0KICAgICAgICBvdXRwdXQucHVzaChmb3JtYXRQcm9wZXJ0eShjdHgsIHZhbHVlLCByZWN1cnNlVGltZXMsIGtleSwgdHJ1ZSwgJyA9PiAnKSk7DQogICAgICB9KTsNCiAgICB9IGVsc2UgaWYgKHZUeXBlID09ICdzZXQnKSB7DQogICAgICBvYmouZm9yRWFjaCggZnVuY3Rpb24odmFsdWUgKSB7DQogICAgICAgIG91dHB1dC5wdXNoKGZvcm1hdFByb3BlcnR5KGN0eCwgdmFsdWUsIHJlY3Vyc2VUaW1lcywgbnVsbCwgdHJ1ZSwgbnVsbCkpOw0KICAgICAgfSk7DQogICAgfQ0KDQogICAgZm9yIChsZW4gPSBrZXlzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7DQogICAgICBrZXkgPSBrZXlzW2ldOw0KICAgICAgb3V0cHV0LnB1c2goDQogICAgICAgIGZvcm1hdFByb3BlcnR5KGN0eCwgb2JqW2tleV0sIHJlY3Vyc2VUaW1lcywga2V5LCB2aXNpYmxlS2V5c1trZXldLCAnOiAnKQ0KICAgICAgKTsNCiAgICB9DQogICAgcmV0dXJuIG91dHB1dDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGZvcm1hdFByb3BlcnR5KGN0eCwgdmFsdWUsIHJlY3Vyc2VUaW1lcywga2V5LCBlbnVtZXJhYmxlLCBzZXApIHsNCiAgICB2YXIgbmFtZSwgc3RyOw0KDQogICAgaWYgKGN0eC5zZWVuLmluZGV4T2YodmFsdWUpID09PSAtMSkgew0KICAgICAgc3RyID0gZm9ybWF0VmFsdWUoY3R4LCB2YWx1ZSwgcmVjdXJzZVRpbWVzICsgMSk7DQogICAgfSBlbHNlIHsNCiAgICAgIHN0ciA9ICdbQ2lyY3VsYXJdJzsNCiAgICB9DQoNCiAgICBpZiAoa2V5ID09IG51bGwpIHJldHVybiBzdHI7DQoNCiAgICBuYW1lID0gZW51bWVyYWJsZSA/IFN0cmluZyhrZXkpIDogJ1snICsga2V5ICsgJ10nOw0KDQogICAgaWYgKCEvXlx3KyQvLnRlc3QobmFtZSkpIHsNCiAgICAgIG5hbWUgPSAiJyIgKyBuYW1lLnJlcGxhY2UoLycvZywgIlxcJyIpICsgIiciOw0KICAgIH0NCg0KICAgIHJldHVybiBuYW1lICsgc2VwICsgc3RyOw0KICB9DQoNCiAgZnVuY3Rpb24gcmVkdWNlVG9TaW5nbGVTdHJpbmcoY3R4LCBvdXRwdXQsIHJlY3Vyc2VUaW1lcywgdlR5cGUpIHsNCiAgICB2YXIgYnJhY2VzLA0KICAgICAgaW5kZW50LA0KICAgICAgYnJlYWtMaW5lID0gZmFsc2UsDQogICAgICBsZW4gPSBvdXRwdXQubGVuZ3RoLA0KICAgICAgaSA9IC0xLA0KICAgICAgY291bnQgPSAwOw0KICAgIGlmICh2VHlwZSA9PSAnYXJyYXknKSBicmFjZXMgPSBbJ1snLCAnXSddOw0KICAgIGVsc2UgaWYgKHZUeXBlID09ICdtYXAnKSBicmFjZXMgPSBbJ01hcCB7JywgJ30nXTsNCiAgICBlbHNlIGlmICh2VHlwZSA9PSAnc2V0JykgYnJhY2VzID0gWydTZXQgeycsICd9J107DQogICAgZWxzZSBpZiAodlR5cGUgPT0gJ2FyZ3VtZW50cycpIGJyYWNlcyA9IFsnW0FyZ3VtZW50c10geycsICd9J107DQogICAgZWxzZSBicmFjZXMgPSBbJ3snLCAnfSddOw0KDQogICAgaWYgKGxlbiA9PSAwKSByZXR1cm4gYnJhY2VzWzBdICsgYnJhY2VzWzFdOw0KDQogICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgY291bnQgKz0gb3V0cHV0W2ldLmxlbmd0aCArIDE7DQogICAgICBpZiAoY291bnQgPiBjdHguYnJlYWtMZW5ndGgpIHsNCiAgICAgICAgYnJlYWtMaW5lID0gdHJ1ZTsNCiAgICAgICAgYnJlYWs7DQogICAgICB9DQogICAgfQ0KDQogICAgbGVuID0gb3V0cHV0LnJlZHVjZSggZnVuY3Rpb24obWVtbywgY3VyKSB7cmV0dXJuICBtZW1vICsgY3VyLmxlbmd0aCArIDF9LCAwKTsNCiAgICBpbmRlbnQgPSByZXBlYXQoJyAgJywgcmVjdXJzZVRpbWVzKTsNCiAgICBpZiAoYnJlYWtMaW5lKSB7DQogICAgICByZXR1cm4gdlR5cGUgPT0gJ2FycmF5Jw0KICAgICAgICA/IGJyYWNlc1swXSArICcgJyArIG91dHB1dC5qb2luKCcsXHJcbiAgJyArIGluZGVudCkgKyAnICcgKyBicmFjZXNbMV0NCiAgICAgICAgOiBicmFjZXNbMF0gKw0KICAgICAgICAgICAgJyBcclxuICAnICsNCiAgICAgICAgICAgIGluZGVudCArDQogICAgICAgICAgICBvdXRwdXQuam9pbignLFxyXG4gICcgKyBpbmRlbnQpICsNCiAgICAgICAgICAgICcgJyArDQogICAgICAgICAgICBicmFjZXNbMV07DQogICAgfQ0KICAgIHJldHVybiBicmFjZXNbMF0gKyAnICcgKyBvdXRwdXQuam9pbignLCAnKSArICcgJyArIGJyYWNlc1sxXTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzUHJpbWl0aXZlKHZhbHVlKSB7DQogICAgcmV0dXJuICFpc09iamVjdCh2YWx1ZSk7DQogIH0KCiAgdmFyIHV0aWwgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICBpbmhlcml0czogaW5oZXJpdHMsCiAgICBmb3JtYXQ6IGZvcm1hdCwKICAgIGRlcHJlY2F0ZTogZGVwcmVjYXRlLAogICAgZGVidWdsb2c6IGRlYnVnbG9nLAogICAgaW5zcGVjdDogaW5zcGVjdCwKICAgIGlzUHJpbWl0aXZlOiBpc1ByaW1pdGl2ZQogIH0pOwoKICBmdW5jdGlvbiBDb25zb2xlKHN0ZG91dCwgc3RkZXJyKSB7DQogICAgaWYgKHRoaXMuY29uc3RydWN0b3IgIT09IENvbnNvbGUpIHsNCiAgICAgIHJldHVybiBuZXcgQ29uc29sZShzdGRvdXQsIHN0ZGVycik7DQogICAgfQ0KICAgIGlmICghc3Rkb3V0IHx8ICEoJ3dyaXRlJyBpbiBzdGRvdXQpKSB7DQogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvbnNvbGUgZXhwZWN0cyBhIHdyaXRhYmxlIHN0cmVhbSBpbnN0YW5jZScpOw0KICAgIH0NCiAgICBpZiAoIXN0ZGVycikgew0KICAgICAgc3RkZXJyID0gc3Rkb3V0Ow0KICAgIH0NCg0KICAgIHRoaXMuX3N0ZG91dCA9IHN0ZG91dDsNCiAgICB0aGlzLl9zdGRlcnIgPSBzdGRlcnI7DQogICAgdGhpcy5fdGltZXMgPSB7fTsNCg0KICAgIA0KICAgIGZvciAodmFyIGtleSBpbiBDb25zb2xlLnByb3RvdHlwZSkgew0KICAgICAgaWYgKGhhcyhDb25zb2xlLnByb3RvdHlwZSwga2V5KSkgew0KICAgICAgICB0aGlzW2tleV0gPSB0aGlzW2tleV0uYmluZCh0aGlzKTsNCiAgICAgIH0NCiAgICB9DQogIH0NCg0KICBDb25zb2xlLnByb3RvdHlwZS5sb2cgPSBmdW5jdGlvbigpIHsNCiAgICB0aGlzLl9zdGRvdXQud3JpdGVMaW5lKGFwcGx5KGZvcm1hdCwgbnVsbCwgYXJndW1lbnRzKSk7DQogIH07DQoNCiAgQ29uc29sZS5wcm90b3R5cGUuaW5mbyA9IENvbnNvbGUucHJvdG90eXBlLmxvZzsNCg0KICBDb25zb2xlLnByb3RvdHlwZS53YXJuID0gZnVuY3Rpb24oKSB7DQogICAgdGhpcy5fc3RkZXJyLndyaXRlTGluZShhcHBseShmb3JtYXQsIG51bGwsIGFyZ3VtZW50cykpOw0KICB9Ow0KDQogIENvbnNvbGUucHJvdG90eXBlLmVycm9yID0gQ29uc29sZS5wcm90b3R5cGUud2FybjsNCg0KICBDb25zb2xlLnByb3RvdHlwZS5kaXIgPSBmdW5jdGlvbihvYmplY3QpIHsNCiAgICB0aGlzLl9zdGRvdXQud3JpdGVMaW5lKA0KICAgICAgaW5zcGVjdChvYmplY3QsIHsNCiAgICAgICAgY3VzdG9tSW5zcGVjdDogZmFsc2UNCiAgICAgIH0pDQogICAgKTsNCiAgfTsNCg0KICBDb25zb2xlLnByb3RvdHlwZS50aW1lID0gZnVuY3Rpb24obGFiZWwpIHsNCiAgICB0aGlzLl90aW1lc1tsYWJlbF0gPSBEYXRlLm5vdygpOw0KICB9Ow0KDQogIENvbnNvbGUucHJvdG90eXBlLnRpbWVFbmQgPSBmdW5jdGlvbihsYWJlbCkgew0KICAgIHZhciB0aW1lID0gdGhpcy5fdGltZXNbbGFiZWxdOw0KICAgIGlmICghdGltZSkgew0KICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBzdWNoIGxhYmVsOiAnICsgbGFiZWwpOw0KICAgIH0NCiAgICB2YXIgZHVyYXRpb24gPSBEYXRlLm5vdygpIC0gdGltZTsNCiAgICB0aGlzLmxvZygnJXM6ICVkbXMnLCBsYWJlbCwgZHVyYXRpb24pOw0KICB9Ow0KDQogIENvbnNvbGUucHJvdG90eXBlLmFzc2VydCA9IGZ1bmN0aW9uKHYgKSB7DQogICAgaWYgKCF2KSB0aHJvdyBuZXcgRXJyb3IoYXBwbHkoZm9ybWF0LCBudWxsLCB0YWlsKGFyZ3VtZW50cykpKTsNCiAgfTsNCg0KICB3aW5kb3cuY29uc29sZSA9IG5ldyBDb25zb2xlKHByb2Nlc3Muc3Rkb3V0LCBwcm9jZXNzLnN0ZGVycik7CgogIHZhciBST09UX1JFR0VYUCA9IC9eKFtBLXpdOnwpWy9cXF0vOw0KICB2YXIgU0VQX1JFR0VYUCA9IC9bL1xcXSsvOw0KICB2YXIgU0VQX1JFR0VYUF9FTkQgPSAvWy9cXF0kLzsNCiAgdmFyIExOS19SRUdFWFAgPSAvKFwubG5rfFwudXJsKSQvOw0KDQogIHZhciBTRVAgPSAnXFwnOw0KICB2YXIgc2VwID0gU0VQOw0KDQogIGZ1bmN0aW9uIGlzYWJzKHB0aCkgew0KICAgIHJldHVybiBwdGggJiYgUk9PVF9SRUdFWFAudGVzdChwdGgpOw0KICB9DQoNCiAgdmFyIGlzQWJzb2x1dGUgPSBpc2FiczsNCg0KICBmdW5jdGlvbiBkaXJuYW1lKHB0aCkgew0KICAgIHJldHVybiBHZXRGU08oKS5HZXRQYXJlbnRGb2xkZXJOYW1lKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiBiYXNlbmFtZShwdGgsIGV4dCkgew0KICAgIHJldHVybiBleHQgPyBHZXRGU08oKS5HZXRCYXNlTmFtZShwdGgpIDogR2V0RlNPKCkuR2V0RmlsZU5hbWUocHRoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGV4dG5hbWUocHRoKSB7DQogICAgcmV0dXJuIEdldEZTTygpLkdldEV4dGVuc2lvbk5hbWUocHRoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGFic3BhdGgocHRoKSB7DQogICAgaWYgKCFpc2FicyhwdGgpKSBwdGggPSBfX2Rpcm5hbWUgKyBTRVAgKyBwdGg7DQogICAgcmV0dXJuIEdldEZTTygpLkdldEFic29sdXRlUGF0aE5hbWUocHRoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIG5vcm1wYXRoKHB0aCkgew0KICAgIHZhciBwYXJ0cyA9IHB0aC5zcGxpdChTRVBfUkVHRVhQKSwNCiAgICAgIG5vcm1QYXJ0cyA9IFtdLA0KICAgICAgbGVuID0gcGFydHMubGVuZ3RoLA0KICAgICAgcGFydDsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7DQogICAgICBwYXJ0ID0gcGFydHNbaV07DQogICAgICBpZiAocGFydCA9PT0gJy4uJykgbm9ybVBhcnRzLnBvcCgpOw0KICAgICAgZWxzZSBpZiAocGFydCA9PT0gJy4nKSBjb250aW51ZTsNCiAgICAgIGVsc2Ugbm9ybVBhcnRzLnB1c2gocGFydCk7DQogICAgfQ0KICAgIHJldHVybiBub3JtUGFydHMuam9pbihTRVApOw0KICB9DQoNCiAgdmFyIG5vcm1hbGl6ZSA9IG5vcm1wYXRoOw0KDQogIGZ1bmN0aW9uIGpvaW4oKSB7DQogICAgdmFyIHAsDQogICAgICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoLA0KICAgICAgcGFydHMgPSBbXTsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7DQogICAgICBwID0gYXJndW1lbnRzW2ldOw0KICAgICAgaWYgKHR5cGVvZiBwID09PSAnc3RyaW5nJykgcGFydHMucHVzaChwKTsNCiAgICB9DQogICAgcmV0dXJuIG5vcm1wYXRoKHBhcnRzLmpvaW4oU0VQKSk7DQogIH0NCg0KICBmdW5jdGlvbiByZXNvbHZlKCkgew0KICAgIHZhciBwLA0KICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aCwNCiAgICAgIHBhcnRzID0gW107DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgew0KICAgICAgcCA9IGFyZ3VtZW50c1tpXTsNCiAgICAgIGlmICh0eXBlb2YgcCA9PT0gJ3N0cmluZycpIHsNCiAgICAgICAgaWYgKFJPT1RfUkVHRVhQLnRlc3QocCkpIHsNCiAgICAgICAgICBwYXJ0cy5sZW5ndGggPSAwOw0KICAgICAgICAgIHBhcnRzWzBdID0gcDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBwYXJ0cy5wdXNoKHApOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiBhYnNwYXRoKHBhcnRzLmpvaW4oU0VQKSk7DQogIH0NCg0KICBmdW5jdGlvbiByZWxhdGl2ZShmcm9tLCB0bykgew0KICAgIHZhciBmcm9tXyA9IGFic3BhdGgoZnJvbSkudG9Mb3dlckNhc2UoKSwNCiAgICAgIHRvXyA9IGFic3BhdGgodG8pLnRvTG93ZXJDYXNlKCksDQogICAgICBmcm9tUGFydHMgPSBmcm9tXy5zcGxpdChTRVBfUkVHRVhQKSwNCiAgICAgIHRvUGFydHMgPSB0b18uc3BsaXQoU0VQX1JFR0VYUCksDQogICAgICBsZW4gPSBNYXRoLm1pbihmcm9tUGFydHMubGVuZ3RoLCB0b1BhcnRzLmxlbmd0aCksDQogICAgICBzYW1lUGFydHNMZW4gPSBsZW4sDQogICAgICBpID0gLTE7DQoNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICBpZiAoZnJvbVBhcnRzW2ldICE9PSB0b1BhcnRzW2ldKSB7DQogICAgICAgIHNhbWVQYXJ0c0xlbiA9IGk7DQogICAgICAgIGJyZWFrOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIGlmIChzYW1lUGFydHNMZW4gPT0gMCkgcmV0dXJuIHRvOw0KDQogICAgdmFyIG91dHB1dFBhcnRzID0gW107DQogICAgZm9yIChpID0gc2FtZVBhcnRzTGVuOyBpIDwgZnJvbVBhcnRzLmxlbmd0aDsgaSsrKSB7DQogICAgICBvdXRwdXRQYXJ0cy5wdXNoKCcuLicpOw0KICAgIH0NCg0KICAgIG91dHB1dFBhcnRzID0gb3V0cHV0UGFydHMuY29uY2F0KHRvUGFydHMuc2xpY2Uoc2FtZVBhcnRzTGVuKSk7DQoNCiAgICByZXR1cm4gb3V0cHV0UGFydHMuam9pbihTRVApOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNmaWxlKHB0aCkgew0KICAgIHJldHVybiBHZXRGU08oKS5GaWxlRXhpc3RzKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiBpc2RpcihwdGgpIHsNCiAgICByZXR1cm4gR2V0RlNPKCkuRm9sZGVyRXhpc3RzKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiBleGlzdHMocHRoKSB7DQogICAgcmV0dXJuIGlzZmlsZShwdGgpIHx8IGlzZGlyKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiBjcmVhdGVTaG9ydGN1dChwdGgsIG9wdGlvbnMpIHsNCiAgICB2YXIgc2hvcnRjdXQgPSBHZXRTaGVsbCgpLkNyZWF0ZVNob3J0Y3V0KHB0aCk7DQogICAgaWYgKG9wdGlvbnMudGFyZ2V0KSBzaG9ydGN1dC5UYXJnZXRQYXRoID0gb3B0aW9ucy50YXJnZXQ7DQogICAgaWYgKG9wdGlvbnMucnVuU3R5bGUpIHNob3J0Y3V0LldpbmRvd1N0eWxlID0gb3B0aW9ucy5ydW5TdHlsZTsgDQogICAgaWYgKG9wdGlvbnMuZGVzYykgc2hvcnRjdXQuRGVzY3JpcHRpb24gPSBvcHRpb25zLmRlc2M7DQogICAgc2hvcnRjdXQuU2F2ZSgpOw0KICB9DQoNCiAgZnVuY3Rpb24gZ2V0U2hvcnRjdXRUYXJnZXQocHRoKSB7DQogICAgdmFyIHNob3J0Y3V0ID0gR2V0U2hlbGwoKS5DcmVhdGVTaG9ydGN1dChwdGgpOw0KICAgIHJldHVybiBzaG9ydGN1dC5UYXJnZXRQYXRoOw0KICB9DQoNCiAgdmFyIEZJTEVfUFJPVE8gPSB7DQogICAgaXNmaWxlOiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiAodGhpcy5fZmlsZS5BdHRyaWJ1dGVzICYgMTYpID09IDA7DQogICAgfSwNCiAgICBpc0ZpbGU6IGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuICh0aGlzLl9maWxlLkF0dHJpYnV0ZXMgJiAxNikgPT0gMDsNCiAgICB9LA0KICAgIGlzZGlyOiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiAodGhpcy5fZmlsZS5BdHRyaWJ1dGVzICYgMTYpID09IDE2Ow0KICAgIH0sDQogICAgaXNEaXJlY3Rvcnk6IGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuICh0aGlzLl9maWxlLkF0dHJpYnV0ZXMgJiAxNikgPT0gMTY7DQogICAgfSwNCiAgICBpc1Nob3J0Y3V0OiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiB0aGlzLmlzRmlsZSgpICYmIExOS19SRUdFWFAudGVzdCh0aGlzLnBhdGgpOw0KICAgIH0sDQogICAgY3JlYXRlU2hvcnRjdXQ6IGZ1bmN0aW9uKHB0aCwgb3B0aW9ucykgew0KICAgICAgb3B0aW9ucy50YXJnZXQgPSB0aGlzLnBhdGg7DQogICAgICBjcmVhdGVTaG9ydGN1dChwdGgsIG9wdGlvbnMpOw0KICAgIH0sDQogICAgY29weTogZnVuY3Rpb24oZHN0LCBvdykgew0KICAgICAgaWYgKCFpc2Ficyhkc3QpKSBkc3QgPSBhYnNwYXRoKGRzdCk7DQogICAgICBpZiAoIVNFUF9SRUdFWFBfRU5ELnRlc3QoZHN0KSkgZHN0ICs9IFNFUDsNCiAgICAgIGlmICghaXNkaXIoZHN0KSkgbWtkaXJzKGRzdCk7DQogICAgICByZXR1cm4gdGhpcy5fZmlsZS5Db3B5KGRzdCwgb3cgPT0gbnVsbCA/IHRydWUgOiAhIW93KTsNCiAgICB9LA0KICAgIGRlbGV0ZTogZnVuY3Rpb24oZm9yY2UpIHsNCiAgICAgIHJldHVybiB0aGlzLl9maWxlLkRlbGV0ZSghIWZvcmNlKTsNCiAgICB9LA0KICAgIG1vdmU6IGZ1bmN0aW9uKGRzdCkgew0KICAgICAgaWYgKCFpc2Ficyhkc3QpKSBkc3QgPSBhYnNwYXRoKGRzdCk7DQogICAgICBpZiAoIVNFUF9SRUdFWFBfRU5ELnRlc3QoZHN0KSkgZHN0ICs9IFNFUDsNCiAgICAgIGlmICghaXNkaXIoZHN0KSkgbWtkaXJzKGRzdCk7DQogICAgICByZXR1cm4gdGhpcy5fZmlsZS5Nb3ZlKGRzdCk7DQogICAgfQ0KICB9Ow0KDQogIHZhciBGSUxFX1BST1BTID0gew0KICAgIF9maWxlOiB7DQogICAgICB2YWx1ZTogbnVsbCwNCiAgICAgIHdyaXRhYmxlOiB0cnVlDQogICAgfSwNCiAgICBuYW1lOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuX2ZpbGUuTmFtZTsNCiAgICAgIH0sDQogICAgICBzZXQ6IGZ1bmN0aW9uKHYpIHsNCiAgICAgICAgdGhpcy5fZmlsZS5OYW1lID0gdjsNCiAgICAgIH0NCiAgICB9LA0KICAgIHBhdGg6IHsNCiAgICAgIGVudW1lcmFibGU6IHRydWUsDQogICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5fZmlsZS5QYXRoOw0KICAgICAgfQ0KICAgIH0sDQogICAgZGlybmFtZTogew0KICAgICAgZW51bWVyYWJsZTogdHJ1ZSwNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB0aGlzLl9maWxlLlBhcmVudEZvbGRlci5QYXRoOw0KICAgICAgfQ0KICAgIH0sDQogICAgc2l6ZTogew0KICAgICAgZW51bWVyYWJsZTogdHJ1ZSwNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB0aGlzLl9maWxlLlNpemU7DQogICAgICB9DQogICAgfSwNCiAgICB0eXBlOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuX2ZpbGUuVHlwZTsNCiAgICAgIH0NCiAgICB9LA0KICAgIHRhcmdldDogew0KICAgICAgZW51bWVyYWJsZTogdHJ1ZSwNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB0aGlzLmlzU2hvcnRjdXQoKSA/IGdldFNob3J0Y3V0VGFyZ2V0KHRoaXMucGF0aCkgOiBudWxsOw0KICAgICAgfQ0KICAgIH0sDQogICAgYXRpbWU6IHsNCiAgICAgIGVudW1lcmFibGU6IHRydWUsDQogICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gbmV3IERhdGUodGhpcy5fZmlsZS5EYXRlTGFzdEFjY2Vzc2VkKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIG10aW1lOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKHRoaXMuX2ZpbGUuRGF0ZUxhc3RNb2RpZmllZCk7DQogICAgICB9DQogICAgfSwNCiAgICBjdGltZTogew0KICAgICAgZW51bWVyYWJsZTogdHJ1ZSwNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiBuZXcgRGF0ZSh0aGlzLl9maWxlLkRhdGVDcmVhdGVkKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIGF0aW1lTXM6IHsNCiAgICAgIGVudW1lcmFibGU6IHRydWUsDQogICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5hdGltZS5nZXRUaW1lKCk7DQogICAgICB9DQogICAgfSwNCiAgICBtdGltZU1zOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMubXRpbWUuZ2V0VGltZSgpOw0KICAgICAgfQ0KICAgIH0sDQogICAgY3RpbWVNczogew0KICAgICAgZW51bWVyYWJsZTogdHJ1ZSwNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB0aGlzLmN0aW1lLmdldFRpbWUoKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIHJlYWRvbmx5OiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuICEhKHRoaXMuX2ZpbGUuQXR0cmlidXRlcyAmIDEpOw0KICAgICAgfQ0KICAgIH0sDQogICAgaGlkZGVuOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuICEhKHRoaXMuX2ZpbGUuQXR0cmlidXRlcyAmIDIpOw0KICAgICAgfQ0KICAgIH0sDQogICAgc3lzdGVtOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuICEhKHRoaXMuX2ZpbGUuQXR0cmlidXRlcyAmIDQpOw0KICAgICAgfQ0KICAgIH0sDQogICAgY2hpbGRyZW46IHsNCiAgICAgIGVudW1lcmFibGU6IGZhbHNlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgdmFyIHNlbGYgPSB0aGlzLmlzU2hvcnRjdXQoKSA/IEZpbGVTdGF0cyh0aGlzLnRhcmdldCkgOiB0aGlzOw0KICAgICAgICBpZiAoc2VsZi5pc0ZpbGUoKSkgcmV0dXJuIG51bGw7DQogICAgICAgIHZhciBfZW51bSA9IG5ldyBFbnVtZXJhdG9yKHNlbGYuX2ZpbGUuRmlsZXMpOw0KICAgICAgICB2YXIgcnN0ID0gW107DQogICAgICAgIGZvciAoOyAhX2VudW0uYXRFbmQoKTsgX2VudW0ubW92ZU5leHQoKSkgew0KICAgICAgICAgIHJzdC5wdXNoKEZpbGVTdGF0cyhfZW51bS5pdGVtKCkpKTsNCiAgICAgICAgfQ0KICAgICAgICBfZW51bSA9IG5ldyBFbnVtZXJhdG9yKHNlbGYuX2ZpbGUuU3ViRm9sZGVycyk7DQogICAgICAgIGZvciAoOyAhX2VudW0uYXRFbmQoKTsgX2VudW0ubW92ZU5leHQoKSkgew0KICAgICAgICAgIHJzdC5wdXNoKEZpbGVTdGF0cyhfZW51bS5pdGVtKCkpKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcnN0Ow0KICAgICAgfQ0KICAgIH0NCiAgfTsNCg0KICBmdW5jdGlvbiBGaWxlU3RhdHMocHRoKSB7DQogICAgdmFyIGYsDQogICAgICBpbnN0YW5jZSA9IE9iamVjdC5jcmVhdGUoRklMRV9QUk9UTywgRklMRV9QUk9QUyk7DQogICAgaWYgKHR5cGVvZiBwdGggPT0gJ29iamVjdCcpIHsNCiAgICAgIGYgPSBwdGg7DQogICAgfSBlbHNlIGlmICh0eXBlb2YgcHRoID09ICdzdHJpbmcnKSB7DQogICAgICBpZiAoIWlzYWJzKHB0aCkpIHB0aCA9IGFic3BhdGgocHRoKTsNCiAgICAgIGlmIChpc2ZpbGUocHRoKSkgew0KICAgICAgICBmID0gR2V0RlNPKCkuR2V0RmlsZShwdGgpOw0KICAgICAgfSBlbHNlIGlmIChpc2RpcihwdGgpKSB7DQogICAgICAgIGYgPSBHZXRGU08oKS5HZXRGb2xkZXIocHRoKTsNCiAgICAgIH0NCiAgICB9DQogICAgaWYgKCFmKSB0aHJvdyBuZXcgRXJyb3IoU3RyaW5nLnJhdyh7cmF3OiBbJ0VOT0VOVCwgbm8gc3VjaCBmaWxlIG9yIGRpcmVjdG9yeSAoJywnKSddfSxwdGgpKTsNCiAgICBpbnN0YW5jZS5fZmlsZSA9IGY7DQogICAgcmV0dXJuIGluc3RhbmNlOw0KICB9DQoNCiAgZnVuY3Rpb24gc2NhbmRpcihwdGgpIHsNCiAgICByZXR1cm4gRmlsZVN0YXRzKHB0aCkuY2hpbGRyZW47DQogIH0NCg0KICBmdW5jdGlvbiB3YWxrKHB0aCwgZm4pIHsNCiAgICBpZiAoIWlzZGlyKHB0aCkpIHJldHVybjsNCiAgICB2YXIgZGlyLA0KICAgICAgaXRlbXMsDQogICAgICBpdGVtLA0KICAgICAgaSwNCiAgICAgIGxlbiwNCiAgICAgIGJ1ZiA9IFtGaWxlU3RhdHMocHRoKV07DQogICAgd2hpbGUgKGJ1Zi5sZW5ndGggPiAwKSB7DQogICAgICBkaXIgPSBidWYuc2hpZnQoKTsNCiAgICAgIGl0ZW1zID0gZGlyLmNoaWxkcmVuOw0KICAgICAgaSA9IC0xOw0KICAgICAgbGVuID0gaXRlbXMubGVuZ3RoOw0KICAgICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgICBpdGVtID0gaXRlbXNbaV07DQogICAgICAgIGlmIChpdGVtLmlzRGlyZWN0b3J5KCkpIGJ1Zi5wdXNoKGl0ZW0pOw0KICAgICAgICBpZiAoZm4oaXRlbSkgPT09IGZhbHNlKSByZXR1cm47DQogICAgICB9DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gbWtkaXIocHRoKSB7DQogICAgcmV0dXJuIEdldEZTTygpLkNyZWF0ZUZvbGRlcihwdGgpOw0KICB9DQoNCiAgZnVuY3Rpb24gbWtkaXJzKHB0aCkgew0KICAgIHZhciBkaXIgPSBwdGgsDQogICAgICBkaXJzID0gW107DQogICAgd2hpbGUgKGRpcikgew0KICAgICAgaWYgKGlzZGlyKGRpcikpIGJyZWFrOw0KICAgICAgZGlycy5wdXNoKGRpcik7DQogICAgICBkaXIgPSBkaXJuYW1lKGRpcik7DQogICAgfQ0KICAgIHZhciBpID0gZGlycy5sZW5ndGg7DQogICAgd2hpbGUgKGktLSkgbWtkaXIoZGlyc1tpXSk7DQogIH0NCg0KICBmdW5jdGlvbiBybWRpcihwdGgpIHsNCiAgICByZXR1cm4gaXNkaXIocHRoKSAmJiBHZXRGU08oKS5EZWxldGVGb2xkZXIocHRoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlbW92ZSQxKHB0aCkgew0KICAgIHJldHVybiBpc2ZpbGUocHRoKSAmJiBHZXRGU08oKS5EZWxldGVGaWxlKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiByZXBsKHB0aCwgZHN0KSB7DQogICAgaWYgKCFpc2Ficyhkc3QpKSBkc3QgPSBhYnNwYXRoKGRpcm5hbWUocHRoKSArIFNFUCArIGRzdCk7DQogICAgdmFyIGRpciA9IGRpcm5hbWUoZHN0KTsNCiAgICB2YXIgbmFtZSA9IGJhc2VuYW1lKGRzdCk7DQogICAgaWYgKGlzZmlsZShkc3QpKSB0aHJvdyBuZXcgRXJyb3IoZHN0ICsgJyBpcyBleGlzdHMuIHJlcGwgZmFpZC4nKTsNCiAgICBpZiAoIWlzZGlyKGRpcikpIG1rZGlycyhkaXIpOw0KICAgIGVsc2UgaWYgKGlzZGlyKGRzdCkpIHJtZGlyKGRzdCk7DQogICAgdmFyIGYgPSBGaWxlU3RhdHMocHRoKTsNCiAgICBpZiAoZi5uYW1lICE9IG5hbWUpIGYubmFtZSA9IG5hbWU7DQogICAgaWYgKGYuZGlybmFtZSAhPSBkaXIpIGYubW92ZShkaXIpOw0KICB9CgogIGZ1bmN0aW9uIHN0YXRTeW5jKHB0aCkgew0KICAgIHJldHVybiBGaWxlU3RhdHMocHRoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlYWRkaXJTeW5jKHB0aCkgew0KICAgIHJldHVybiBzY2FuZGlyKHB0aCkubWFwKCBmdW5jdGlvbihpdCApe3JldHVybiAgaXQubmFtZX0pOw0KICB9DQoNCiAgZnVuY3Rpb24gd2l0aFN0cmVhbShvcHRpb25zLCBmbikgew0KICAgIHZhciBzdCA9IG5ldyBBY3RpdmVYT2JqZWN0KCdBRE9EQi5TdHJlYW0nKSwNCiAgICAgIGZpbGUgPSBvcHRpb25zLmZpbGUsDQogICAgICBlbmNvZGluZyA9IG9wdGlvbnMuZW5jb2RpbmcsDQogICAgICBmbGFnID0gb3B0aW9ucy5mbGFnLA0KICAgICAgcnN0Ow0KICAgIHRyeSB7DQogICAgICBpZiAoZW5jb2RpbmcgPT0gJ2JpbmFyeScpIHN0LlR5cGUgPSAxOw0KICAgICAgZWxzZSBzdC5DaGFyc2V0ID0gZW5jb2Rpbmc7DQogICAgICBzdC5PcGVuKCk7DQogICAgICBpZiAoZmxhZyA9PSAncicgfHwgZmxhZyA9PSAnYScpIHsNCiAgICAgICAgaWYgKCFpc2ZpbGUoZmlsZSkpDQogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFN0cmluZy5yYXcoe3JhdzogWyd3aXRoU3RyZWFtOiBmaWxlIG5vdCBleGlzdHMuICgnLCcpJ119LGZpbGUpKTsNCiAgICAgICAgc3QuTG9hZEZyb21GaWxlKGZpbGUpOw0KICAgICAgfQ0KICAgICAgaWYgKGZsYWcgPT0gJ2EnKSBzdC5Qb3NpdGlvbiA9IHN0LlNpemU7DQogICAgICByc3QgPSBmbihzdCk7DQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgdGhyb3cgZTsNCiAgICB9IGZpbmFsbHkgew0KICAgICAgc3QgJiYgc3QuU3RhdGUgPT0gMSAmJiBzdC5jbG9zZSgpOw0KICAgIH0NCiAgICByZXR1cm4gcnN0Ow0KICB9DQoNCiAgZnVuY3Rpb24gc2F2ZVN0cmVhbShzdCwgb3B0aW9ucykgew0KICAgIHZhciBza2lwTGVuID0gMCwNCiAgICAgIGZpbGUgPSBvcHRpb25zLmZpbGUsDQogICAgICBlbmNvZGluZyA9IG9wdGlvbnMuZW5jb2RpbmcucmVwbGFjZSgnLScsICcnKS50b0xvd2VyQ2FzZSgpOw0KICAgIGlmIChlbmNvZGluZyA9PSAndXRmOCcgfHwgZW5jb2RpbmcgPT0gJ3VuaWNvZGUnKSBza2lwTGVuID0gMzsNCiAgICBlbHNlIGlmIChlbmNvZGluZyA9PSAndWZ0MTYnKSBza2lwTGVuID0gMjsNCiAgICBzdC5TZXRFT1MoKTsNCiAgICBpZiAoc2tpcExlbikgew0KICAgICAgc3QuUG9zaXRpb24gPSAwOw0KICAgICAgc3QuVHlwZSA9IDE7DQogICAgICBzdC5Qb3NpdGlvbiA9IHNraXBMZW47DQogICAgICB2YXIgYmluRGF0YSA9IHN0LlJlYWQoLTEpOw0KICAgICAgc3QuUG9zaXRpb24gPSAwOw0KICAgICAgc3QuV3JpdGUoYmluRGF0YSk7DQogICAgICBzdC5TZXRFT1MoKTsNCiAgICB9DQogICAgc3QuU2F2ZVRvRmlsZShmaWxlLCAyKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGluaXRBcmdzKGZpbGUsIG9wdGlvbnMpIHsNCiAgICB2YXIgdHAsIGVuY29kaW5nLCBmbGFnOw0KICAgIGlmICghaXNhYnMoZmlsZSkpIHRocm93IG5ldyBFcnJvcignZnM6IHJlbGF0aXZlIHBhdGggaXMgbm90IHN1cHBvcnRlZCcpOw0KICAgIHRwID0gdHlwZW9mIG9wdGlvbnM7DQogICAgaWYgKHRwID09ICdzdHJpbmcnKSB7DQogICAgICBlbmNvZGluZyA9IG9wdGlvbnM7DQogICAgfSBlbHNlIGlmICh0cCA9PSAnb2JqZWN0Jykgew0KICAgICAgaWYgKG9wdGlvbnMuZW5jb2RpbmcpIGVuY29kaW5nID0gb3B0aW9ucy5lbmNvZGluZzsNCiAgICAgIGlmIChvcHRpb25zLmZsYWcpIGZsYWcgPSBvcHRpb25zLmZsYWc7DQogICAgICBlbHNlIGlmIChvcHRpb25zLmZsYWdzKSBmbGFnID0gb3B0aW9ucy5mbGFnczsNCiAgICB9DQogICAgaWYgKGZsYWcgJiYgZmxhZy5sZW5ndGggPiAxKSBmbGFnID0gZmxhZy5jaGFyQXQoMCk7DQogICAgcmV0dXJuIHsgZmlsZTogZmlsZSwgZW5jb2Rpbmc6IGVuY29kaW5nLCBmbGFnOiBmbGFnIH07DQogIH0NCg0KICBmdW5jdGlvbiByZWFkRmlsZVN5bmMoZmlsZSwgb3B0aW9ucykgew0KICAgIHZhciBvcHRzID0gaW5pdEFyZ3MoZmlsZSwgb3B0aW9ucyk7DQogICAgb3B0cy5mbGFnID0gJ3InOw0KICAgIGlmICghb3B0cy5lbmNvZGluZykgb3B0cy5lbmNvZGluZyA9ICdiaW5hcnknOw0KICAgIHJldHVybiB3aXRoU3RyZWFtKG9wdHMsIGZ1bmN0aW9uKHN0KSB7DQogICAgICByZXR1cm4gb3B0cy5lbmNvZGluZyA9PSAnYmluYXJ5Jw0KICAgICAgICA/IEJ1ZmZlci5mcm9tKHN0LlJlYWQoLTEpKQ0KICAgICAgICA6IHN0LlJlYWRUZXh0KC0xKTsNCiAgICB9KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHdyaXRlRmlsZVN5bmMoZmlsZSwgZGF0YSwgb3B0aW9ucykgew0KICAgIHZhciBvcHRzID0gaW5pdEFyZ3MoZmlsZSwgb3B0aW9ucyksDQogICAgICBpc0J1ZmZlciA9IEJ1ZmZlci5pc0J1ZmZlcihkYXRhKTsNCiAgICBvcHRzLmZsYWcgPSAndyc7DQogICAgaWYgKGlzQnVmZmVyKSBvcHRzLmVuY29kaW5nID0gJ2JpbmFyeSc7DQogICAgZWxzZSBpZiAoIW9wdHMuZW5jb2RpbmcpIG9wdHMuZW5jb2RpbmcgPSAnVVRGLTgnOw0KICAgIHdpdGhTdHJlYW0ob3B0cywgZnVuY3Rpb24oIHN0ICkgew0KICAgICAgaXNCdWZmZXIgPyBzdC5Xcml0ZShkYXRhLmJ1ZmZlcikgOiBzdC5Xcml0ZVRleHQoZGF0YSk7DQogICAgICBzYXZlU3RyZWFtKHN0LCBvcHRzKTsNCiAgICB9KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGFwcGVuZEZpbGVTeW5jKGZpbGUsIGRhdGEsIG9wdGlvbnMpIHsNCiAgICB2YXIgb3B0cyA9IGluaXRBcmdzKGZpbGUsIG9wdGlvbnMpLA0KICAgICAgaXNCdWZmZXIgPSBCdWZmZXIuaXNCdWZmZXIoZGF0YSk7DQogICAgb3B0cy5mbGFnID0gJ2EnOw0KICAgIGlmIChpc0J1ZmZlcikgb3B0cy5lbmNvZGluZyA9ICdiaW5hcnknOw0KICAgIGVsc2UgaWYgKCFvcHRzLmVuY29kaW5nKSBvcHRzLmVuY29kaW5nID0gJ1VURi04JzsNCiAgICB3aXRoU3RyZWFtKG9wdHMsIGZ1bmN0aW9uKCBzdCApIHsNCiAgICAgIGlzQnVmZmVyID8gc3QuV3JpdGUoZGF0YS5idWZmZXIpIDogc3QuV3JpdGVUZXh0KGRhdGEpOw0KICAgICAgc2F2ZVN0cmVhbShzdCwgb3B0cyk7DQogICAgfSk7DQogIH0NCg0KICBmdW5jdGlvbiBta2RpclN5bmMocHRoLCBvcHRpb25zKSB7DQogICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5yZWN1cnNpdmUpIG1rZGlycyhwdGgpOw0KICAgIG1rZGlyKHB0aCk7DQogIH0NCg0KDQoNCiAgZnVuY3Rpb24gbWtkaXJzU3luYyhwdGgpIHsNCiAgICBta2RpcnMocHRoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGVuc3VyZURpclN5bmMocHRoKSB7DQogICAgaWYgKCFpc2RpcihwdGgpKSBta2RpcnMocHRoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGVuc3VyZUZpbGVTeW5jKGZpbGUpIHsNCiAgICBpZiAoIWlzYWJzKGZpbGUpKSBmaWxlID0gYWJzcGF0aChmaWxlKTsNCiAgICB2YXIgZGlyID0gZGlybmFtZShmaWxlKTsNCiAgICBpZiAoIWlzZGlyKGRpcikpIG1rZGlycyhkaXIpOw0KICB9DQoNCiAgZnVuY3Rpb24gb3V0cHV0RmlsZVN5bmMoZmlsZSwgZGF0YSwgb3B0aW9ucykgew0KICAgIGlmICghaXNhYnMoZmlsZSkpIGZpbGUgPSBhYnNwYXRoKGZpbGUpOw0KICAgIGVuc3VyZUZpbGVTeW5jKGZpbGUpOw0KICAgIHdyaXRlRmlsZVN5bmMoZmlsZSwgZGF0YSwgb3B0aW9ucyk7DQogIH0NCg0KICBmdW5jdGlvbiBvdXRwdXRKc29uU3luYyhmaWxlLCBvYmosIG9wdGlvbnMpIHsNCiAgICBpZiAoIWlzYWJzKGZpbGUpKSBmaWxlID0gYWJzcGF0aChmaWxlKTsNCiAgICBlbnN1cmVGaWxlU3luYyhmaWxlKTsNCiAgICB3cml0ZUZpbGVTeW5jKGZpbGUsIEpTT04uc3RyaW5naWZ5KG9iaiksIG9wdGlvbnMpOw0KICB9DQoNCiAgdmFyIG91dHB1dEpTT05TeW5jID0gb3V0cHV0SnNvblN5bmM7DQoNCiAgZnVuY3Rpb24gcmVhZEpzb25TeW5jKGZpbGUsIG9wdGlvbnMpIHsNCiAgICBpZiAoIWlzYWJzKGZpbGUpKSBmaWxlID0gYWJzcGF0aChmaWxlKTsNCiAgICBpZiAoIW9wdGlvbnMgfHwgKHR5cGVvZiBvcHRpb25zID09ICdvYmplY3QnICYmICFvcHRpb25zLmVuY29kaW5nKSkNCiAgICAgIG9wdGlvbnMgPSAnVVRGLTgnOw0KICAgIHZhciBkYXRhID0gcmVhZEZpbGVTeW5jKGZpbGUsIG9wdGlvbnMpOw0KICAgIHJldHVybiBKU09OLnBhcnNlKGRhdGEpOw0KICB9DQoNCiAgdmFyIHJlYWRKU09OU3luYyA9IHJlYWRKc29uU3luYzsNCg0KICBmdW5jdGlvbiBlbXB0eURpclN5bmMoZGlyKSB7DQogICAgc2NhbmRpcihkaXIpLmZvckVhY2goIGZ1bmN0aW9uKGl0ICl7cmV0dXJuICBpdC5kZWxldGUodHJ1ZSl9KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlYWRMaW5lc1N5bmMoZmlsZSwgb3B0aW9ucykgew0KICAgIGlmICghaXNhYnMoZmlsZSkpIGZpbGUgPSBhYnNwYXRoKGZpbGUpOw0KICAgIHZhciBvcHRzID0gaW5pdEFyZ3MoZmlsZSwgb3B0aW9ucyk7DQogICAgb3B0cy5mbGFnID0gJ3InOw0KICAgIGlmICghb3B0cy5lbmNvZGluZykgb3B0cy5lbmNvZGluZyA9ICdVVEYtOCc7DQogICAgcmV0dXJuIHdpdGhTdHJlYW0ob3B0cywgZnVuY3Rpb24oc3QpIHsNCiAgICAgIHZhciBsaW5lcyA9IFtdOw0KICAgICAgd2hpbGUgKCFzdC5FT1MpIGxpbmVzLnB1c2goc3QuUmVhZFRleHQoLTIpKTsNCiAgICAgIHJldHVybiBsaW5lczsNCiAgICB9KTsNCiAgfQoKICB2YXIgZnMgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICBzdGF0U3luYzogc3RhdFN5bmMsCiAgICByZWFkZGlyU3luYzogcmVhZGRpclN5bmMsCiAgICByZWFkRmlsZVN5bmM6IHJlYWRGaWxlU3luYywKICAgIHdyaXRlRmlsZVN5bmM6IHdyaXRlRmlsZVN5bmMsCiAgICBhcHBlbmRGaWxlU3luYzogYXBwZW5kRmlsZVN5bmMsCiAgICBta2RpclN5bmM6IG1rZGlyU3luYywKICAgIG1rZGlyc1N5bmM6IG1rZGlyc1N5bmMsCiAgICBlbnN1cmVEaXJTeW5jOiBlbnN1cmVEaXJTeW5jLAogICAgZW5zdXJlRmlsZVN5bmM6IGVuc3VyZUZpbGVTeW5jLAogICAgb3V0cHV0RmlsZVN5bmM6IG91dHB1dEZpbGVTeW5jLAogICAgb3V0cHV0SnNvblN5bmM6IG91dHB1dEpzb25TeW5jLAogICAgb3V0cHV0SlNPTlN5bmM6IG91dHB1dEpTT05TeW5jLAogICAgcmVhZEpzb25TeW5jOiByZWFkSnNvblN5bmMsCiAgICByZWFkSlNPTlN5bmM6IHJlYWRKU09OU3luYywKICAgIGVtcHR5RGlyU3luYzogZW1wdHlEaXJTeW5jLAogICAgcmVhZExpbmVzU3luYzogcmVhZExpbmVzU3luYywKICAgIGV4aXN0c1N5bmM6IGV4aXN0cywKICAgIHJlbmFtZVN5bmM6IHJlcGwsCiAgICBybWRpclN5bmM6IHJtZGlyLAogICAgdW5saW5rU3luYzogcmVtb3ZlJDEKICB9KTsKCiAgdmFyIFBBUlNFX1JFRyA9IC9eKFtBLVphLXpdOlsvXFxdfFsvXFxdfCkoPzooW14/I10qKVsvXFxdfCkoW14vXFw/I10qPykoWy5dW14uPyNdK3wpJC87DQogIHZhciBDQVBUVVJFID0gWydwYXRoJywgJ3Jvb3QnLCAnZGlyJywgJ25hbWUnLCAnZXh0J107DQoNCiAgZnVuY3Rpb24gcGFyc2UocHRoKSB7DQogICAgcHRoIHx8IChwdGggPSAnJyk7DQogICAgdmFyIG1hdGNoID0gcHRoLm1hdGNoKFBBUlNFX1JFRyk7DQogICAgdmFyIHJlc3VsdCA9IENBUFRVUkUucmVkdWNlKGZ1bmN0aW9uKG1lbW8sIG5hbWUsIGluZGV4KSB7DQogICAgICBtZW1vW25hbWVdID0gbWF0Y2hbaW5kZXhdOw0KICAgICAgcmV0dXJuIG1lbW87DQogICAgfSwge30pOw0KICAgIHJlc3VsdC5iYXNlID0gcmVzdWx0Lm5hbWUgKyByZXN1bHQuZXh0Ow0KICAgIHJlc3VsdC5kaXJuYW1lID0gcmVzdWx0LnJvb3QgKyByZXN1bHQuZGlyOw0KICAgIHJldHVybiByZXN1bHQ7DQogIH0NCg0KICB2YXIgZGVsaW1pdGVyID0gJzsnOwoKICB2YXIgUGF0aCA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgIHBhcnNlOiBwYXJzZSwKICAgIGRlbGltaXRlcjogZGVsaW1pdGVyLAogICAgc2VwOiBzZXAsCiAgICBkaXJuYW1lOiBkaXJuYW1lLAogICAgYmFzZW5hbWU6IGJhc2VuYW1lLAogICAgZXh0bmFtZTogZXh0bmFtZSwKICAgIGlzQWJzb2x1dGU6IGlzQWJzb2x1dGUsCiAgICBub3JtYWxpemU6IG5vcm1hbGl6ZSwKICAgIGpvaW46IGpvaW4sCiAgICByZXNvbHZlOiByZXNvbHZlLAogICAgcmVsYXRpdmU6IHJlbGF0aXZlCiAgfSk7CgogIGlmICghT2JqZWN0LmFzc2lnbikgew0KICAgIE9iamVjdC5hc3NpZ24gPSBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiBhcHBseShhc3NpZ25JbiwgbnVsbCwgYXJndW1lbnRzKTsNCiAgICB9Ow0KICB9DQoNCiAgaWYgKCFPYmplY3QudmFsdWVzKSB7DQogICAgT2JqZWN0LnZhbHVlcyA9IHZhbHVlczsNCiAgfQ0KDQogIGZ1bmN0aW9uIGRlZmluZVByb3BzKG9iaiwgcHJvcHMpIHsNCiAgICB2YXIgX3Byb3BzID0ge30sDQogICAgICBpc0VtcHR5ID0gdHJ1ZTsNCiAgICBmb3IgKHZhciBrZXkgaW4gcHJvcHMpIHsNCiAgICAgIGlmICghb2JqW2tleV0pIHsNCiAgICAgICAgX3Byb3BzW2tleV0gPSB7DQogICAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsDQogICAgICAgICAgdmFsdWU6IHByb3BzW2tleV0NCiAgICAgICAgfTsNCiAgICAgICAgaXNFbXB0eSA9IGZhbHNlOw0KICAgICAgfQ0KICAgIH0NCiAgICBpZiAoIWlzRW1wdHkpIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG9iaiwgX3Byb3BzKTsNCiAgfQ0KDQogIGRlZmluZVByb3BzKEFycmF5LnByb3RvdHlwZSwgew0KICAgIGluY2x1ZGVzOiBmdW5jdGlvbih2YWwsIHN0YXJ0KSB7DQogICAgICByZXR1cm4gaW5jbHVkZXModGhpcywgdmFsLCBzdGFydCk7DQogICAgfSwNCiAgICBmaW5kOiBmdW5jdGlvbihmbiwgX3RoaXMpIHsNCiAgICAgIHJldHVybiBmaW5kKHRoaXMsIGZuLCBfdGhpcylbMF07DQogICAgfSwNCiAgICBmaW5kSW5kZXg6IGZ1bmN0aW9uKGZuLCBfdGhpcykgew0KICAgICAgcmV0dXJuIGZpbmRJbmRleCh0aGlzLCBmbiwgX3RoaXMpWzFdOw0KICAgIH0sDQogICAgZmlsbDogZnVuY3Rpb24odmFsLCBzdGFydCwgZW5kKSB7DQogICAgICByZXR1cm4gZmlsbCh0aGlzLCB2YWwsIHN0YXJ0LCBlbmQpOw0KICAgIH0NCiAgfSk7DQoNCiAgZGVmaW5lUHJvcHMoU3RyaW5nLnByb3RvdHlwZSwgew0KICAgIHJlcGVhdDogZnVuY3Rpb24obikgew0KICAgICAgcmV0dXJuIHJlcGVhdCh0aGlzLCBuKTsNCiAgICB9LA0KICAgIHN0YXJ0c1dpdGg6IGZ1bmN0aW9uKHRhcmdldCwgcG9zKSB7DQogICAgICByZXR1cm4gc3RhcnRzV2l0aCh0aGlzLCB0YXJnZXQsIHBvcyk7DQogICAgfSwNCiAgICBlbmRzV2l0aDogZnVuY3Rpb24odGFyZ2V0LCB0aGlzX2xlbikgew0KICAgICAgcmV0dXJuIGVuZHNXaXRoKHRoaXMsIHRhcmdldCwgdGhpc19sZW4pOw0KICAgIH0sDQogICAgaW5jbHVkZXM6IGZ1bmN0aW9uKHRhcmdldCwgcG9zKSB7DQogICAgICByZXR1cm4gaW5jbHVkZXModGhpcywgdGFyZ2V0LCBwb3MpOw0KICAgIH0sDQogICAgcGFkU3RhcnQ6IGZ1bmN0aW9uKGxlbiwgY2hycykgew0KICAgICAgcmV0dXJuIHBhZFN0YXJ0KHRoaXMsIGxlbiwgY2hycyk7DQogICAgfSwNCiAgICBwYWRFbmQ6IGZ1bmN0aW9uKGxlbiwgY2hycykgew0KICAgICAgcmV0dXJuIHBhZEVuZCh0aGlzLCBsZW4sIGNocnMpOw0KICAgIH0NCiAgfSk7DQoNCiAgaWYgKCFTdHJpbmcucmF3KSB7DQogICAgU3RyaW5nLnJhdyA9IGZ1bmN0aW9uKGNhbGxTaXRlKSB7DQogICAgICB2YXIgaSA9IDAsDQogICAgICAgIGJ1ZiA9IFtdLA0KICAgICAgICBzdHJzID0gY2FsbFNpdGUucmF3LA0KICAgICAgICBsZW4gPSBzdHJzLmxlbmd0aCwNCiAgICAgICAgYXJnc0NudCA9IGFyZ3VtZW50cy5sZW5ndGg7DQogICAgICB3aGlsZSAoaSA8IGxlbikgew0KICAgICAgICBidWYucHVzaChzdHJzW2krK10pOw0KICAgICAgICBpZiAoaSA8IGFyZ3NDbnQgJiYgaSA8IGxlbikgew0KICAgICAgICAgIGJ1Zi5wdXNoKGFyZ3VtZW50c1tpXSk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHJldHVybiBidWYuam9pbignJyk7DQogICAgfTsNCiAgfQ0KDQogIHdpbmRvdy5fX2ZpbGVuYW1lID0gV1NjcmlwdC5TY3JpcHRGdWxsTmFtZTsNCiAgd2luZG93Ll9fZGlybmFtZSA9IF9fZmlsZW5hbWUuc2xpY2UoMCwgX19maWxlbmFtZS5sYXN0SW5kZXhPZignXFwnKSk7DQoNCiAgdmFyIF92YnMsIF9zaGVsbCwgX2ZzbywgX3NoZWxsX2FwcDsNCg0KICB3aW5kb3cuR2V0VkJTY3JpcHQgPSBmdW5jdGlvbigpIHsNCiAgICBpZiAoIV92YnMpIHsNCiAgICAgIF92YnMgPSBuZXcgQWN0aXZlWE9iamVjdCgnU2NyaXB0Q29udHJvbCcpOw0KICAgICAgX3Zicy5MYW5ndWFnZSA9ICdWQlNjcmlwdCc7DQogICAgfQ0KICAgIHJldHVybiBfdmJzOw0KICB9Ow0KDQogIHdpbmRvdy5HZXRTaGVsbCA9IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiBfc2hlbGwgfHwgKF9zaGVsbCA9IG5ldyBBY3RpdmVYT2JqZWN0KCdXU2NyaXB0LlNoZWxsJykpOw0KICB9Ow0KDQogIHdpbmRvdy5HZXRGU08gPSBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gX2ZzbyB8fCAoX2ZzbyA9IG5ldyBBY3RpdmVYT2JqZWN0KCdTY3JpcHRpbmcuRmlsZVN5c3RlbU9iamVjdCcpKTsNCiAgfTsNCg0KICB3aW5kb3cuR2V0U2hlbGxBcHAgPSBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gX3NoZWxsX2FwcCB8fCAoX3NoZWxsX2FwcCA9IG5ldyBBY3RpdmVYT2JqZWN0KCdTaGVsbC5BcHBsaWNhdGlvbicpKTsNCiAgfTsNCg0KICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCBmdW5jdGlvbigpIHsNCiAgICB2YXIgc2NyaXB0cyA9IGRvY3VtZW50LnNjcmlwdHM7DQogICAgdmFyIGkgPSAtMSwNCiAgICAgIGxlbiA9IHNjcmlwdHMubGVuZ3RoOw0KICAgIHZhciBuYW1lID0gYmFzZW5hbWUoX19maWxlbmFtZSkucmVwbGFjZSgvXC5bXi5dKyQvLCAnJyk7DQogICAgdmFyIGZpbGUsIGZvbGRlcjsNCiAgICBmb2xkZXIgPSBqb2luKF9fZGlybmFtZSwgbmFtZSArICdfc3JjJyk7DQogICAgaWYgKCFpc2Rpcihmb2xkZXIpKSBta2RpcnNTeW5jKGZvbGRlcik7DQogICAgY29uc29sZS5sb2coJycpOw0KICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgIGZpbGUgPSBqb2luKGZvbGRlciwgaSArICcuanMnKTsNCiAgICAgIG91dHB1dEZpbGVTeW5jKGZpbGUsIHNjcmlwdHNbaV0udGV4dCk7DQogICAgICBjb25zb2xlLmxvZygnc291cmNlICVkOiAlcycsIGksIGZpbGUpOw0KICAgIH0NCiAgfSk7CgogIGZ1bmN0aW9uIGV4ZWNTeW5jKGNtZCkgew0KICAgIHZhciBwcm9jID0gR2V0U2hlbGwoKS5FeGVjKGNtZCk7DQogICAgZm9yICg7Oykgew0KICAgICAgaWYgKHByb2MuU3RhdGVzICE9PSAwKSBicmVhazsNCiAgICB9DQogICAgaWYgKCFwcm9jLlN0ZE91dC5BdEVuZE9mU3RyZWFtKSB7DQogICAgICByZXR1cm4gcHJvYy5TdGRPdXQuUmVhZEFsbCgpOw0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIGV4ZWMoY21kLCBmdW5jKSB7DQogICAgdmFyIHByb2MsIHN0ZG91dCwgc3RkZXJyOw0KICAgIHRyeSB7DQogICAgICBwcm9jID0gR2V0U2hlbGwoKS5FeGVjKGNtZCk7DQogICAgICBmb3IgKDs7KSB7DQogICAgICAgIGlmIChwcm9jLlN0YXRlcyAhPT0gMCkgYnJlYWs7DQogICAgICB9DQogICAgICBpZiAoZnVuYyAmJiB0eXBlb2YgZnVuYyA9PT0gJ2Z1bmN0aW9uJykgew0KICAgICAgICBpZiAoIXByb2MuU3RkT3V0LkF0RW5kT2ZTdHJlYW0pIHsNCiAgICAgICAgICBzdGRvdXQgPSBwcm9jLlN0ZE91dC5SZWFkQWxsKCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFwcm9jLlN0ZEVyci5BdEVuZE9mU3RyZWFtKSB7DQogICAgICAgICAgc3RkZXJyID0gcHJvYy5TdGRFcnIuUmVhZEFsbCgpOw0KICAgICAgICB9DQogICAgICAgIGZ1bmMobnVsbCwgc3Rkb3V0LCBzdGRlcnIpOw0KICAgICAgfQ0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgIGlmIChmdW5jICYmIHR5cGVvZiBmdW5jID09PSAnZnVuY3Rpb24nKSB7DQogICAgICAgIGZ1bmMoZSwgbnVsbCwgbnVsbCk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aHJvdyBlOw0KICAgICAgfQ0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIHJ1bihjbWQsIG9wdGlvbnMpIHsNCiAgICB2YXIgaW50V2luZG93U3R5bGUgPSAxLA0KICAgICAgYldhaXRPblJldHVybiA9IHRydWU7DQogICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsNCiAgICBpZiAob3B0aW9ucy5oaWRlID09PSBmYWxzZSB8fCBvcHRpb25zLmhpZGRlbiA9PT0gZmFsc2UpIGludFdpbmRvd1N0eWxlID0gMDsNCiAgICBpZiAob3B0aW9ucy53YWl0ID09PSBmYWxzZSkgYldhaXRPblJldHVybiA9IGZhbHNlOw0KICAgIHJldHVybiBHZXRTaGVsbCgpLlJ1bihjbWQsIGludFdpbmRvd1N0eWxlLCBiV2FpdE9uUmV0dXJuKTsNCiAgfQoKICB2YXIgY2hpbGRfcHJvY2VzcyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgIGV4ZWNTeW5jOiBleGVjU3luYywKICAgIGV4ZWM6IGV4ZWMsCiAgICBydW46IHJ1bgogIH0pOwoKICB2YXIgZXNjYXBlID0gZW5jb2RlVVJJQ29tcG9uZW50Ow0KDQogIHZhciB1bmVzY2FwZSA9IGRlY29kZVVSSUNvbXBvbmVudDsNCg0KICBmdW5jdGlvbiBmb3JtYXRWYWx1ZSQxKHZhbHVlKSB7DQogICAgc3dpdGNoICh0eXBlb2YgdmFsdWUpIHsNCiAgICAgIGNhc2UgJ3N0cmluZyc6DQogICAgICAgIHJldHVybiBlbmNvZGVVUklDb21wb25lbnQodmFsdWUpOw0KICAgICAgY2FzZSAnbnVtYmVyJzoNCiAgICAgIGNhc2UgJ2Jvb2xlYW4nOg0KICAgICAgICByZXR1cm4gU3RyaW5nKHZhbHVlKTsNCiAgICAgIGRlZmF1bHQ6DQogICAgICAgIHJldHVybiAnJzsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBzdHJpbmdpZnkob2JqLCBzZXAsIGVxKSB7DQogICAgaWYgKCFvYmopIHJldHVybiAnJzsNCiAgICBzZXAgfHwgKHNlcCA9ICcmJyk7DQogICAgZXEgfHwgKGVxID0gJz0nKTsNCiAgICB2YXIgYnVmID0gW10sDQogICAgICB2YWx1ZSwNCiAgICAgIGksDQogICAgICBsZW47DQogICAgZm9yICh2YXIga2V5IGluIG9iaikgew0KICAgICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7DQogICAgICAgIHZhbHVlID0gb2JqW2tleV07DQogICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkgew0KICAgICAgICAgIChpID0gLTEpLCAobGVuID0gdmFsdWUubGVuZ3RoKTsNCiAgICAgICAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICAgICAgICBidWYucHVzaChrZXkgKyBlcSArIGZvcm1hdFZhbHVlJDEodmFsdWVbaV0pKTsNCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgYnVmLnB1c2goa2V5ICsgZXEgKyBmb3JtYXRWYWx1ZSQxKHZhbHVlKSk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIGJ1Zi5qb2luKHNlcCk7DQogIH0NCg0KICBmdW5jdGlvbiBwYXJzZSQxKHN0ciwgc2VwLCBlcSkgew0KICAgIHNlcCB8fCAoc2VwID0gJyYnKTsNCiAgICBlcSB8fCAoZXEgPSAnPScpOw0KICAgIHZhciBidWYgPSBzdHIuc3BsaXQoc2VwKTsNCiAgICB2YXIgaSA9IC0xLA0KICAgICAgbGVuID0gYnVmLmxlbmd0aCwNCiAgICAgIHJlc3VsdCA9IHt9LA0KICAgICAga2V5RGljdCA9IHt9LA0KICAgICAgcGFpciwNCiAgICAgIGtleSwNCiAgICAgIHZhbHVlOw0KICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgIHBhaXIgPSBidWZbaV0uc3BsaXQoZXEpOw0KICAgICAga2V5ID0gcGFpclswXTsNCiAgICAgIHZhbHVlID0gcGFpclsxXTsNCiAgICAgIGlmIChrZXlEaWN0W2tleV0pIHsNCiAgICAgICAgaWYgKGtleURpY3Rba2V5XSA9PT0gMSkgew0KICAgICAgICAgIGtleURpY3Rba2V5XSA9IDI7DQogICAgICAgICAgcmVzdWx0W2tleV0gPSBbcmVzdWx0W2tleV0sIHZhbHVlXTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXN1bHRba2V5XS5wdXNoKHZhbHVlKTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAga2V5RGljdFtrZXldID0gMTsNCiAgICAgICAgcmVzdWx0W2tleV0gPSB2YWx1ZTsNCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfQoKICB2YXIgcXVlcnlzdHJpbmcgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICBlc2NhcGU6IGVzY2FwZSwKICAgIHVuZXNjYXBlOiB1bmVzY2FwZSwKICAgIHN0cmluZ2lmeTogc3RyaW5naWZ5LAogICAgcGFyc2U6IHBhcnNlJDEKICB9KTsKCiAgdmFyIEJJTl9UWVBFUyA9IFsnYXJyYXlidWZmZXInLCAnYmxvYiddOw0KDQogIGZ1bmN0aW9uIHJlcXVlc3Qob3B0aW9ucykgew0KICAgIHZhciBodHRwLCB1cmksIG1ldGhvZCwgdGltZW91dDsNCiAgICBodHRwID0gbmV3IEFjdGl2ZVhPYmplY3QoJ1dpbkh0dHAuV2luSHR0cFJlcXVlc3QuNS4xJyk7DQogICAgdXJpID0gb3B0aW9ucy51cmkgfHwgb3B0aW9ucy51cmwgfHwgb3B0aW9ucy5wYXRoOw0KICAgIG1ldGhvZCA9IChvcHRpb25zLm1ldGhvZCB8fCAnR0VUJykudG9VcHBlckNhc2UoKTsNCiAgICB0aW1lb3V0ID0gb3B0aW9ucy50aW1lb3V0IHx8IDMwMDA7DQogICAgaHR0cC5zZXRUaW1lb3V0cyh0aW1lb3V0LCB0aW1lb3V0LCB0aW1lb3V0LCB0aW1lb3V0KTsNCg0KICAgIHRyeSB7DQogICAgICB2YXIgZGF0YSA9IG9wdGlvbnMuZm9ybSB8fCBvcHRpb25zLmRhdGEgfHwgbnVsbDsNCiAgICAgIGlmIChkYXRhICYmIHR5cGVvZiBkYXRhICE9PSAnc3RyaW5nJykgZGF0YSA9IHN0cmluZ2lmeShkYXRhKTsNCiAgICAgIGlmIChkYXRhKSB7DQogICAgICAgIGlmIChtZXRob2QgPT09ICdHRVQnKSB7DQogICAgICAgICAgaHR0cC5vcGVuKG1ldGhvZCwgdXJpICsgJz8nICsgZGF0YSwgZmFsc2UpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGh0dHAub3BlbihtZXRob2QsIHVyaSwgZmFsc2UpOw0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICBodHRwLm9wZW4obWV0aG9kLCB1cmksIGZhbHNlKTsNCiAgICAgIH0NCiAgICAgIGFwcGx5T3B0aW9ucyhodHRwLCBvcHRpb25zKTsNCiAgICAgIGh0dHAuc2VuZChkYXRhKTsNCg0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgc3RhdHVzQ29kZTogaHR0cC5zdGF0dXMsDQogICAgICAgIGhlYWRlcnM6IHBhcnNlSGVhZGVycyhodHRwLmdldEFsbFJlc3BvbnNlSGVhZGVycygpKSwNCiAgICAgICAgYm9keTogQklOX1RZUEVTLmluY2x1ZGVzKG9wdGlvbnMucmVzcG9uc2VUeXBlKQ0KICAgICAgICAgID8gQnVmZmVyLmZyb20oaHR0cC5SZXNwb25zZUJvZHkpDQogICAgICAgICAgOiBodHRwLlJlc3BvbnNlVGV4dA0KICAgICAgfTsNCiAgICB9IGNhdGNoIChlKSB7DQogICAgICB0aHJvdyBlOw0KICAgIH0NCiAgfQ0KDQogIHZhciBzZXRSZXFPcHRzID0gRnVuY3Rpb24oDQogICAgJ2h0dHAnLA0KICAgIFN0cmluZy5yYXcoe3JhdzogWydcclxuaHR0cC5PcHRpb24oMCkgPSBcJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgVHJpZGVudC83LjA7IHJ2OjExLjApIGxpa2UgR2Vja29cJztcclxuaHR0cC5PcHRpb24oNCkgPSAxMzA1NjtcclxuaHR0cC5PcHRpb24oNikgPSBmYWxzZTsnXX0pDQogICk7DQoNCiAgZnVuY3Rpb24gYXBwbHlPcHRpb25zKGh0dHAsIG9wdGlvbnMpIHsNCiAgICBpZiAob3B0aW9ucy5wcm94eSkgew0KICAgICAgc2V0UmVxT3B0cyhodHRwKTsNCiAgICAgIGh0dHAuc2V0UHJveHkoJzInLCBvcHRpb25zLnByb3h5KTsNCiAgICAgIA0KICAgICAgDQogICAgfQ0KDQogICAgaWYgKG9wdGlvbnMubWV0aG9kICE9PSAnR0VUJykgew0KICAgICAgaHR0cC5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyk7DQogICAgfQ0KDQogICAgdmFyIGhlYWRlcnMgPSBvcHRpb25zLmhlYWRlcnM7DQogICAgaWYgKGhlYWRlcnMpIHsNCiAgICAgIGZvciAodmFyIGtleSBpbiBoZWFkZXJzKSB7DQogICAgICAgIGlmIChrZXkudG9Mb3dlckNhc2UoKSA9PSAnY29va2llJykgew0KICAgICAgICAgIGh0dHAuc2V0UmVxdWVzdEhlYWRlcignQ29va2llJywgJ3N0cmluZycpOw0KICAgICAgICAgIGh0dHAuc2V0UmVxdWVzdEhlYWRlcignQ29va2llJywgaGVhZGVyc1trZXldKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBodHRwLnNldFJlcXVlc3RIZWFkZXIoa2V5LCBoZWFkZXJzW2tleV0pOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gcGFyc2VIZWFkZXJzKHN0cl9oZWFkZXJzKSB7DQogICAgdmFyIHJlc3VsdCA9IHt9LA0KICAgICAgaGVhZGVycywNCiAgICAgIGksDQogICAgICBrLA0KICAgICAgdjsNCiAgICBoZWFkZXJzID0gc3RyX2hlYWRlcnMudHJpbSgpLnNwbGl0KC9ccj9cbi8pOw0KICAgIGhlYWRlcnMuZm9yRWFjaCggZnVuY3Rpb24oaGVhZGVyICkgew0KICAgICAgaSA9IGhlYWRlci5pbmRleE9mKCc6Jyk7DQogICAgICBrID0gaGVhZGVyLnNsaWNlKDAsIGkpLnRyaW0oKTsNCiAgICAgIHYgPSBoZWFkZXIuc2xpY2UoaSArIDEpLnRyaW0oKTsNCiAgICAgIGlmIChrLnRvTG93ZXJDYXNlKCkgPT0gJ3NldC1jb29raWUnKSB7DQogICAgICAgIGlmIChyZXN1bHRba10pIHJlc3VsdFtrXS5wdXNoKHYpOw0KICAgICAgICBlbHNlIHJlc3VsdFtrXSA9IFt2XTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJlc3VsdFtrXSA9IHY7DQogICAgICB9DQogICAgfSk7DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGdldE9wdGlvbihhcmdzKSB7DQogICAgdmFyIG9wdGlvbnM7DQogICAgaWYgKHR5cGVvZiBhcmdzWzBdID09PSAnc3RyaW5nJykgew0KICAgICAgb3B0aW9ucyA9IGFyZ3NbMV0gfHwge307DQogICAgICBvcHRpb25zLnVyaSA9IGFyZ3NbMF07DQogICAgfSBlbHNlIHsNCiAgICAgIG9wdGlvbnMgPSBhcmdzWzBdIHx8IHt9Ow0KICAgIH0NCiAgICByZXR1cm4gb3B0aW9uczsNCiAgfQ0KDQogIHZhciBodHRwID0gew0KICAgIHJlcXVlc3Q6IGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuIHJlcXVlc3QoZ2V0T3B0aW9uKGFyZ3VtZW50cykpOw0KICAgIH0sDQogICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgIHZhciBvcHRpb25zID0gZ2V0T3B0aW9uKGFyZ3VtZW50cyk7DQogICAgICBvcHRpb25zLm1ldGhvZCA9ICdHRVQnOw0KICAgICAgcmV0dXJuIHJlcXVlc3Qob3B0aW9ucyk7DQogICAgfSwNCiAgICBwb3N0OiBmdW5jdGlvbigpIHsNCiAgICAgIHZhciBvcHRpb25zID0gZ2V0T3B0aW9uKGFyZ3VtZW50cyk7DQogICAgICBvcHRpb25zLm1ldGhvZCA9ICdQT1NUJzsNCiAgICAgIHJldHVybiByZXF1ZXN0KG9wdGlvbnMpOw0KICAgIH0NCiAgfTsKCiAgdmFyIGh0dHAkMSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgICdkZWZhdWx0JzogaHR0cAogIH0pOwoKICBmdW5jdGlvbiBfY2lwaGVyKGVuYywgYnVmX3Bhc3N3b3JkLCBidWZfZGF0YSkgew0KICAgIHZhciBjcnlwdCA9IG5ldyBBY3RpdmVYT2JqZWN0KCdTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5LlJpam5kYWVsTWFuYWdlZCcpOw0KICAgIHZhciBrZXlIYXNoID0gbmV3IEFjdGl2ZVhPYmplY3QoJ1N5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHkuU0hBMjU2TWFuYWdlZCcpOw0KICAgIGtleUhhc2guQ29tcHV0ZUhhc2hfMihidWZfcGFzc3dvcmQuYnVmZmVyKTsNCiAgICBjcnlwdC5LZXkgPSBrZXlIYXNoLkhhc2g7DQogICAga2V5SGFzaC5DbGVhcigpOw0KDQogICAgdmFyIGl2SGFzaCA9IG5ldyBBY3RpdmVYT2JqZWN0KA0KICAgICAgJ1N5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHkuTUQ1Q3J5cHRvU2VydmljZVByb3ZpZGVyJw0KICAgICk7DQogICAgaXZIYXNoLkNvbXB1dGVIYXNoXzIoYnVmX3Bhc3N3b3JkLmJ1ZmZlcik7DQogICAgY3J5cHQuSVYgPSBpdkhhc2guSGFzaDsNCiAgICBpdkhhc2guQ2xlYXIoKTsNCg0KICAgIHZhciBkc3QgPSBudWxsOw0KICAgIHZhciB0cyA9IGVuYyA/IGNyeXB0LkNyZWF0ZUVuY3J5cHRvcigpIDogY3J5cHQuQ3JlYXRlRGVjcnlwdG9yKCk7DQogICAgdHJ5IHsNCiAgICAgIGRzdCA9IHRzLlRyYW5zZm9ybUZpbmFsQmxvY2soYnVmX2RhdGEuYnVmZmVyLCAwLCBidWZfZGF0YS5sZW5ndGgpOw0KICAgIH0gZmluYWxseSB7DQogICAgICBjcnlwdC5DbGVhcigpOw0KICAgIH0NCiAgICByZXR1cm4gZHN0Ow0KICB9DQoNCiAgZnVuY3Rpb24gQ2lwaGVyKGFsZ29yaXRobSwgcGFzc3dvcmQsIGlzRW5jb2RlKSB7DQogICAgdGhpcy5hbGdvcml0aG0gPSBhbGdvcml0aG07DQogICAgdGhpcy5wYXNzd29yZCA9IHBhc3N3b3JkOw0KICAgIHRoaXMuaXNFbmNvZGUgPSBpc0VuY29kZTsNCiAgfQ0KDQogIENpcGhlci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24oZGF0YSwgaW5wdXRFbmNvZGluZywgb3V0cHV0RW5jb2RpbmcpIHsNCiAgICB0aGlzLmRhdGEgPSBkYXRhOw0KICAgIGlmIChpbnB1dEVuY29kaW5nKSB0aGlzLmlucHV0RW5jb2RpbmcgPSBpbnB1dEVuY29kaW5nOw0KICAgIGlmIChvdXRwdXRFbmNvZGluZykgdGhpcy5vdXRwdXRFbmNvZGluZyA9IG91dHB1dEVuY29kaW5nOw0KICAgIHJldHVybiB0aGlzOw0KICB9Ow0KDQogIENpcGhlci5wcm90b3R5cGUuZmluYWwgPSBmdW5jdGlvbihvdXRwdXRFbmNvZGluZykgew0KICAgIGlmIChvdXRwdXRFbmNvZGluZykgdGhpcy5vdXRwdXRFbmNvZGluZyA9IG91dHB1dEVuY29kaW5nOw0KICAgIHZhciBieXRlcyA9IF9jaXBoZXIoDQogICAgICB0aGlzLmlzRW5jb2RlLA0KICAgICAgQnVmZmVyLmZyb20odGhpcy5wYXNzd29yZCksDQogICAgICBCdWZmZXIuZnJvbSh0aGlzLmRhdGEsIHRoaXMuaW5wdXRFbmNvZGluZykNCiAgICApOw0KICAgIGlmICh0aGlzLm91dHB1dEVuY29kaW5nID09IG51bGwgfHwgdGhpcy5vdXRwdXRFbmNvZGluZyA9PSAnYmluYXJ5Jykgew0KICAgICAgcmV0dXJuIEJ1ZmZlci5mcm9tKGJ5dGVzKTsNCiAgICB9IGVsc2Ugew0KICAgICAgcmV0dXJuIEJ1ZmZlci5mcm9tKGJ5dGVzKS50b1N0cmluZyhvdXRwdXRFbmNvZGluZyk7DQogICAgfQ0KICB9Ow0KDQogIGZ1bmN0aW9uIF9oYXNoKG9iam5hbWUsIGJ1Zl9kYXRhLCBvcHRfdHlwZSkgew0KICAgIHZhciBwcm92aWRlciA9IG5ldyBBY3RpdmVYT2JqZWN0KG9iam5hbWUpOw0KICAgIHByb3ZpZGVyLkNvbXB1dGVIYXNoXzIoYnVmX2RhdGEuYnVmZmVyKTsNCiAgICB2YXIgaGFzaHMgPSBwcm92aWRlci5IYXNoOw0KICAgIHByb3ZpZGVyLkNsZWFyKCk7DQogICAgcmV0dXJuIEJ1ZmZlci5mcm9tKGhhc2hzKS50b1N0cmluZyhvcHRfdHlwZSB8fCAnaGV4Jyk7DQogIH0NCg0KICBmdW5jdGlvbiBIYXNoKGFsZ29yaXRobSkgew0KICAgIHRoaXMuYWxnb3JpdGhtID0gYWxnb3JpdGhtOw0KICB9DQoNCiAgSGFzaC5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24oZGF0YSwgaW5wdXRFbmNvZGluZykgew0KICAgIHRoaXMuZGF0YSA9IGRhdGE7DQogICAgdGhpcy5pbnB1dEVuY29kaW5nID0gaW5wdXRFbmNvZGluZyB8fCAndXRmLTgnOw0KICAgIHJldHVybiB0aGlzOw0KICB9Ow0KDQogIEhhc2gucHJvdG90eXBlLmRpZ2VzdCA9IGZ1bmN0aW9uKGVuY29kaW5nKSB7DQogICAgaWYgKHRoaXMuYWxnb3JpdGhtID09ICdtZDUnKSB7DQogICAgICByZXR1cm4gX2hhc2goDQogICAgICAgICdTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5Lk1ENUNyeXB0b1NlcnZpY2VQcm92aWRlcicsDQogICAgICAgIEJ1ZmZlci5mcm9tKHRoaXMuZGF0YSwgdGhpcy5pbnB1dEVuY29kaW5nKSwNCiAgICAgICAgZW5jb2RpbmcNCiAgICAgICk7DQogICAgfSBlbHNlIGlmICh0aGlzLmFsZ29yaXRobSA9PSAnc2hhMScpIHsNCiAgICAgIHJldHVybiBfaGFzaCgNCiAgICAgICAgJ1N5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHkuU0hBMUNyeXB0b1NlcnZpY2VQcm92aWRlcicsDQogICAgICAgIEJ1ZmZlci5mcm9tKHRoaXMuZGF0YSwgdGhpcy5pbnB1dEVuY29kaW5nKSwNCiAgICAgICAgZW5jb2RpbmcNCiAgICAgICk7DQogICAgfQ0KICB9Ow0KDQogIHZhciBjcnlwdG8gPSB7DQogICAgY3JlYXRlQ2lwaGVyOiBmdW5jdGlvbihhbGdvcml0aG0sIHBhc3N3b3JkKSB7DQogICAgICByZXR1cm4gbmV3IENpcGhlcihhbGdvcml0aG0sIHBhc3N3b3JkLCB0cnVlKTsNCiAgICB9LA0KDQogICAgY3JlYXRlRGVDaXBoZXI6IGZ1bmN0aW9uKGFsZ29yaXRobSwgcGFzc3dvcmQpIHsNCiAgICAgIHJldHVybiBuZXcgQ2lwaGVyKGFsZ29yaXRobSwgcGFzc3dvcmQsIGZhbHNlKTsNCiAgICB9LA0KDQogICAgY3JlYXRlSGFzaDogZnVuY3Rpb24oYWxnb3JpdGhtKSB7DQogICAgICByZXR1cm4gbmV3IEhhc2goYWxnb3JpdGhtKTsNCiAgICB9DQogIH07CgogIHZhciBjcnlwdG8kMSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgICdkZWZhdWx0JzogY3J5cHRvCiAgfSk7CgogIHZhciBERUZBVUxUX09QVElPTlMgPSB7DQogICAgaGVhZGVyczogZmFsc2UsDQogICAgZGVsaW1pdGVyOiAnLCcsDQogICAgcXVvdGU6ICciJywNCiAgICBlc2NhcGU6ICciJywNCiAgICB0cmltOiBmYWxzZSwNCiAgICBydHJpbTogZmFsc2UsDQogICAgbHRyaW06IGZhbHNlLA0KICAgIG5ld2xpbmU6ICdcclxuJw0KICB9Ow0KDQogIHZhciBFTVBUWV9DSEFSX1JFR0VYUCA9IC9ccy87DQoNCiAgZnVuY3Rpb24gUGFyc2VyKG9wdGlvbnMpIHsNCiAgICBPYmplY3QuYXNzaWduKHRoaXMsIERFRkFVTFRfT1BUSU9OUyk7DQogICAgaWYgKG9wdGlvbnMgIT0gbnVsbCAmJiB0eXBlb2Ygb3B0aW9ucyA9PSAnb2JqZWN0Jykgew0KICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLCBvcHRpb25zKTsNCiAgICB9DQogIH0NCg0KICB2YXIgUFAgPSBQYXJzZXIucHJvdG90eXBlOw0KDQogIFBQLmluaXQgPSBmdW5jdGlvbigpIHsNCiAgICB0aGlzLnJvd3MgPSBbXTsNCiAgICB0aGlzLnJvdyA9IFtdOw0KICAgIHRoaXMuY3Vyc29yID0gMDsNCiAgICB0aGlzLnBvcyA9IDA7DQogICAgdGhpcy5idWYgPSBbXTsNCiAgICB0aGlzLmJ1ZkxlbiA9IDA7DQogICAgdGhpcy5lc2NhcGluZyA9IGZhbHNlOw0KICB9Ow0KDQogIFBQLnBhcnNlID0gZnVuY3Rpb24gZnJvbVN0cmluZyhzdHIpIHsNCiAgICB2YXIgaSA9IDAsDQogICAgICBsZW4gPSBzdHIubGVuZ3RoOw0KICAgIHRoaXMuaW5pdCgpOw0KICAgIGZvciAoOyBpIDwgbGVuOyBpKyspIHsNCiAgICAgIHRoaXMuX2NoYXIoc3RyLmNoYXJBdChpKSk7DQogICAgfQ0KICAgIHJldHVybiB0aGlzLl9nZXRSZXN1bHQoKTsNCiAgfTsNCg0KICBQUC5fZ2V0UmVzdWx0ID0gZnVuY3Rpb24oKSB7DQogICAgdmFyIHJlc3VsdCwgaGVhZGVycywgbGVuOw0KICAgIGlmICh0aGlzLnBvcyAhPT0gdGhpcy5jdXJzb3IpIHsNCiAgICAgIHRoaXMuX3JvdygpOw0KICAgIH0NCiAgICBsZW4gPSB0aGlzLnJvd3MubGVuZ3RoOw0KICAgIHJlc3VsdCA9IHRoaXMucm93czsNCiAgICBpZiAodGhpcy5oZWFkZXJzID09PSB0cnVlICYmIGxlbiA+IDEpIHsNCiAgICAgIGhlYWRlcnMgPSB0aGlzLnJvd3NbMF07DQogICAgICB0aGlzLnJvd3Muc2hpZnQoKTsNCiAgICB9IGVsc2UgaWYgKGlzQXJyYXkodGhpcy5oZWFkZXJzKSAmJiBsZW4gPiAwKSB7DQogICAgICBoZWFkZXJzID0gdGhpcy5oZWFkZXJzOw0KICAgIH0NCiAgICBpZiAoaGVhZGVycyAmJiBoZWFkZXJzLmxlbmd0aCA+IDApIHsNCiAgICAgIHJlc3VsdCA9IHRoaXMucm93cy5tYXAoIGZ1bmN0aW9uKHJvdyApe3JldHVybiAgemlwT2JqZWN0KGhlYWRlcnMsIHJvdyl9KTsNCiAgICB9DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfTsNCg0KICBQUC5fY2hhciA9IGZ1bmN0aW9uKGMpIHsNCiAgICBpZiAoYyA9PT0gdGhpcy5kZWxpbWl0ZXIgJiYgIXRoaXMuZXNjYXBpbmcpIHsNCiAgICAgIHRoaXMuX2NlbGwoKTsNCiAgICB9IGVsc2UgaWYgKGMgPT09IHRoaXMucXVvdGUpIHsNCiAgICAgIHRoaXMuX3B1c2goYyk7DQogICAgICB0aGlzLl9xdW90ZSgpOw0KICAgIH0gZWxzZSBpZiAoYyA9PT0gdGhpcy5lc2NhcGUpIHsNCiAgICAgIHRoaXMuX3B1c2goYyk7DQogICAgICB0aGlzLl9lc2NhcGUoKTsNCiAgICB9IGVsc2UgaWYgKGMgPT09ICdcbicgJiYgIXRoaXMuZXNjYXBpbmcpIHsNCiAgICAgIHRoaXMuX3JvdygpOw0KICAgIH0gZWxzZSB7DQogICAgICB0aGlzLl9wdXNoKGMpOw0KICAgIH0NCg0KICAgIHRoaXMuY3Vyc29yKys7DQogIH07DQoNCiAgUFAuX3B1c2ggPSBmdW5jdGlvbihjKSB7DQogICAgaWYgKHRoaXMuYnVmTGVuID09PSAwKSB7DQogICAgICBpZiAoKHRoaXMudHJpbSB8fCB0aGlzLmx0cmltKSAmJiBFTVBUWV9DSEFSX1JFR0VYUC50ZXN0KGMpKSByZXR1cm47DQogICAgICBpZiAoYyA9PT0gdGhpcy5xdW90ZSkgcmV0dXJuOw0KICAgIH0NCiAgICB0aGlzLmJ1Zlt0aGlzLmJ1Zkxlbl0gPSBjOw0KICAgIHRoaXMuYnVmTGVuKys7DQogIH07DQoNCiAgUFAuX2NlbGwgPSBmdW5jdGlvbigpIHsNCiAgICB2YXIgaXRlbSA9IHRoaXMuX2dldFZhbHVlKCk7DQogICAgdGhpcy5yb3cucHVzaChpdGVtKTsNCiAgfTsNCg0KICBQUC5fZ2V0VmFsdWUgPSBmdW5jdGlvbigpIHsNCiAgICB2YXIgcmVzdWx0LCBjLCBpOw0KICAgIGkgPSB0aGlzLmJ1ZkxlbjsNCiAgICB3aGlsZSAoaS0tKSB7DQogICAgICBjID0gdGhpcy5idWZbaV07DQogICAgICBpZiAoRU1QVFlfQ0hBUl9SRUdFWFAudGVzdChjKSkgew0KICAgICAgICBpZiAodGhpcy50cmltIHx8IHRoaXMucnRyaW0pIHsNCiAgICAgICAgICB0aGlzLmJ1ZltpXSA9ICcnOw0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICBpZiAoYyA9PT0gdGhpcy5xdW90ZSkgew0KICAgICAgICAgIHRoaXMuYnVmW2ldID0gJyc7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogICAgcmVzdWx0ID0gdGhpcy5idWYuam9pbignJyk7DQogICAgdGhpcy5idWYubGVuZ3RoID0gMDsNCiAgICB0aGlzLmJ1ZkxlbiA9IDA7DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfTsNCg0KICBQUC5fcm93ID0gZnVuY3Rpb24oKSB7DQogICAgaWYgKHRoaXMuYnVmTGVuID4gMCAmJiB0aGlzLmJ1Zlt0aGlzLmJ1ZkxlbiAtIDFdID09PSAnXHInKSB7DQogICAgICB0aGlzLmJ1Zlt0aGlzLmJ1ZkxlbiAtIDFdID0gJyc7DQogICAgfQ0KICAgIHRoaXMuX2NlbGwoKTsNCiAgICB0aGlzLnJvd3MucHVzaCh0aGlzLnJvdyk7DQogICAgdGhpcy5yb3cgPSBbXTsNCiAgICB0aGlzLnBvcyA9IHRoaXMuY3Vyc29yOw0KICB9Ow0KDQogIFBQLl9xdW90ZSA9IGZ1bmN0aW9uKCkgew0KICAgIHRoaXMuZXNjYXBpbmcgPSAhdGhpcy5lc2NhcGluZzsNCiAgICBpZiAodGhpcy5idWZMZW4gPiAxICYmIHRoaXMuYnVmW3RoaXMuYnVmTGVuIC0gMl0gPT09IHRoaXMuZXNjYXBlKSB7DQogICAgICB0aGlzLmJ1Zlt0aGlzLmJ1ZkxlbiAtIDJdID0gdGhpcy5idWZbdGhpcy5idWZMZW4gLSAxXTsNCiAgICAgIHRoaXMuYnVmW3RoaXMuYnVmTGVuIC0gMV0gPSAnJzsNCiAgICB9DQogIH07DQoNCiAgUFAuX2VzY2FwZSA9IGZ1bmN0aW9uKCkgew0KICAgIHRoaXMuZXNjYXBpbmcgPSAhdGhpcy5lc2NhcGluZzsNCiAgfTsNCg0KICBmdW5jdGlvbiBjcmVhdGVQYXJzZXIob3B0aW9ucykgew0KICAgIHJldHVybiBuZXcgUGFyc2VyKG9wdGlvbnMpOw0KICB9DQoNCiAgZnVuY3Rpb24gcGFyc2UkMihzdHIsIG9wdGlvbnMpIHsNCiAgICByZXR1cm4gbmV3IFBhcnNlcihvcHRpb25zKS5wYXJzZShzdHIpOw0KICB9DQoNCiAgZnVuY3Rpb24gRm9ybWF0dGVyKG9wdGlvbnMpIHsNCiAgICBPYmplY3QuYXNzaWduKHRoaXMsIERFRkFVTFRfT1BUSU9OUyk7DQogICAgaWYgKG9wdGlvbnMgIT0gbnVsbCAmJiB0eXBlb2Ygb3B0aW9ucyA9PSAnb2JqZWN0JykNCiAgICAgIE9iamVjdC5hc3NpZ24odGhpcywgb3B0aW9ucyk7DQogIH0NCg0KICB2YXIgRlAgPSBGb3JtYXR0ZXIucHJvdG90eXBlOw0KDQogIEZQLmluaXQgPSBmdW5jdGlvbigpIHsNCiAgICB0aGlzLnJvd3MgPSBbXTsNCiAgfTsNCg0KICBGUC5zdHJpbmdpZnkgPSBmdW5jdGlvbihkYXRhKSB7DQogICAgdmFyIHJvdywgaSwgbGVuLCByb3dEYXRhSXNBcnJheTsNCiAgICB0aGlzLmluaXQoKTsNCiAgICBpZiAoaXNBcnJheSh0aGlzLmhlYWRlcnMpKSB7DQogICAgICB0aGlzLl9hcHBlbmRMaW5lKHRoaXMuaGVhZGVycyk7DQogICAgfQ0KICAgIGxlbiA9IGlzQXJyYXkoZGF0YSkgJiYgZGF0YS5sZW5ndGg7DQogICAgaWYgKGxlbiAmJiBsZW4gPiAwKSB7DQogICAgICBpID0gMDsNCiAgICAgIHJvdyA9IGRhdGFbMF07DQogICAgICByb3dEYXRhSXNBcnJheSA9IGlzQXJyYXkocm93KTsNCiAgICAgIGlmIChyb3dEYXRhSXNBcnJheSkgew0KICAgICAgICBpZiAodGhpcy5oZWFkZXJzID09PSB0cnVlKSB7DQogICAgICAgICAgdGhpcy5oZWFkZXJzID0gcm93Ow0KICAgICAgICAgIHRoaXMuX2FwcGVuZExpbmUodGhpcy5oZWFkZXJzKTsNCiAgICAgICAgICBpID0gMTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy5oZWFkZXJzID0gT2JqZWN0LmtleXMocm93KTsNCiAgICAgICAgdGhpcy5fYXBwZW5kTGluZSh0aGlzLmhlYWRlcnMpOw0KICAgICAgfQ0KDQogICAgICBmb3IgKDsgaSA8IGxlbjsgaSsrKSB7DQogICAgICAgIHJvdyA9IGRhdGFbaV07DQogICAgICAgIGlmIChyb3dEYXRhSXNBcnJheSkgdGhpcy5fYXBwZW5kTGluZShyb3cpOw0KICAgICAgICBlbHNlIHRoaXMuX2FwcGVuZExpbmUobWFwKHJvdykpOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gdGhpcy5fZ2V0UmVzdWx0KCk7DQogIH07DQoNCiAgRlAuX2FwcGVuZExpbmUgPSBmdW5jdGlvbihyb3cpIHsNCiAgICB2YXIgcXVvdGUgPSB0aGlzLnF1b3RlOw0KICAgIHZhciBlc2NhcGVfcXVvdGUgPSB0aGlzLmVzY2FwZSArIHF1b3RlOw0KICAgIHZhciBxdW90ZVJlZ2V4cCA9IC8iL2c7DQogICAgdmFyIGxpbmUgPSByb3cNCiAgICAgIC5tYXAoIGZ1bmN0aW9uKGl0ZW0gKSB7DQogICAgICAgIGlmIChpdGVtID09IG51bGwpIHsNCiAgICAgICAgICByZXR1cm4gJyc7DQogICAgICAgIH0gZWxzZSBpZiAoaXNTdHJpbmcoaXRlbSkpIHsNCiAgICAgICAgICBpZiAoaXRlbS5pbmNsdWRlcyhxdW90ZSkpIHsNCiAgICAgICAgICAgIHJldHVybiBxdW90ZSArIGl0ZW0ucmVwbGFjZShxdW90ZVJlZ2V4cCwgZXNjYXBlX3F1b3RlKSArIHF1b3RlOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gaXRlbTsNCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIGl0ZW0gKyAnJzsNCiAgICAgICAgfQ0KICAgICAgfSkNCiAgICAgIC5qb2luKHRoaXMuZGVsaW1pdGVyKTsNCiAgICB0aGlzLnJvd3MucHVzaChsaW5lKTsNCiAgfTsNCg0KICBGUC5fZ2V0UmVzdWx0ID0gZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuIHRoaXMucm93cy5qb2luKHRoaXMubmV3bGluZSk7DQogIH07DQoNCiAgZnVuY3Rpb24gY3JlYXRlRm9ybWF0dGVyKG9wdGlvbnMpIHsNCiAgICByZXR1cm4gbmV3IEZvcm1hdHRlcihvcHRpb25zKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHN0cmluZ2lmeSQxKGRhdGEsIG9wdGlvbnMpIHsNCiAgICByZXR1cm4gbmV3IEZvcm1hdHRlcihvcHRpb25zKS5zdHJpbmdpZnkoZGF0YSk7DQogIH0KCiAgdmFyIGNzdiA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgIGNyZWF0ZVBhcnNlcjogY3JlYXRlUGFyc2VyLAogICAgcGFyc2U6IHBhcnNlJDIsCiAgICBjcmVhdGVGb3JtYXR0ZXI6IGNyZWF0ZUZvcm1hdHRlciwKICAgIHN0cmluZ2lmeTogc3RyaW5naWZ5JDEKICB9KTsKCiAgdmFyIEFQUF9JRCA9ICdFeGNlbC5BcHBsaWNhdGlvbic7DQoNCiAgdmFyIEVYQ0VMX1BST1RPID0gew0KICAgIGNsb3NlOiBmdW5jdGlvbigpIHsNCiAgICAgIHRoaXMuYXBwICYmIHRoaXMuYXBwLlF1aXQoKTsNCiAgICAgIHRoaXMuYXBwID0gbnVsbDsNCiAgICB9LA0KICAgIGdldEJvb2s6IGZ1bmN0aW9uKG5hbWUpIHsNCiAgICAgIHJldHVybiBuYW1lID8gdGhpcy5hcHAuV29ya0Jvb2tzKG5hbWUpIDogdGhpcy5hY3RpdmVCb29rOw0KICAgIH0sDQogICAgZ2V0U2hlZXQ6IGZ1bmN0aW9uKHNoZWV0TmFtZSwgYm9va05hbWUpIHsNCiAgICAgIHJldHVybiBzaGVldE5hbWUNCiAgICAgICAgPyB0aGlzLmdldEJvb2soYm9va05hbWUpLlNoZWV0cyhzaGVldE5hbWUpDQogICAgICAgIDogdGhpcy5hY3RpdmVTaGVldDsNCiAgICB9LA0KICAgIHJhbmdlOiBmdW5jdGlvbihhZGRyKSB7DQogICAgICByZXR1cm4gYWRkciA/IHRoaXMuYXBwLlJhbmdlKGFkZHIpIDogdGhpcy5zZWxlY3Rpb247DQogICAgfSwNCiAgICBnZXRSYW5nZTogZnVuY3Rpb24oc3RyUmFuZ2UsIHNoZWV0TmFtZSwgYm9va05hbWUpIHsNCiAgICAgIHJldHVybiBzdHJSYW5nZQ0KICAgICAgICA/IHRoaXMuZ2V0U2hlZXQoc2hlZXROYW1lLCBib29rTmFtZSkuUmFuZ2Uoc3RyUmFuZ2UpDQogICAgICAgIDogdGhpcy5zZWxlY3Rpb247DQogICAgfSwNCiAgICBjZWxsOiBmdW5jdGlvbihyb3csIGNvbCkgew0KICAgICAgcmV0dXJuIHJvdyAmJiBjb2wgPyB0aGlzLmFwcC5DZWxscyhyb3csIGNvbCkgOiB0aGlzLmFjdGl2ZUNlbGw7DQogICAgfSwNCiAgICBnZXRDZWxsOiBmdW5jdGlvbihyb3csIGNvbCwgc2hlZXROYW1lLCBib29rTmFtZSkgew0KICAgICAgcmV0dXJuIHJvdyAmJiBjb2wNCiAgICAgICAgPyB0aGlzLmdldFNoZWV0KHNoZWV0TmFtZSwgYm9va05hbWUpLkNlbGxzKHJvdywgY29sKQ0KICAgICAgICA6IHRoaXMuYWN0aXZlQ2VsbDsNCiAgICB9LA0KICAgIGdldEJvb2tzOiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiBtYXAodGhpcy5ib29rcyk7DQogICAgfSwNCiAgICBvcGVuQm9vazogZnVuY3Rpb24ocGF0aCkgew0KICAgICAgaWYgKCFpc2ZpbGUocGF0aCkpIHJldHVybiBudWxsOw0KICAgICAgdmFyIHRhcmdldCA9IGZpbmQkMSh0aGlzLmJvb2tzLCBmdW5jdGlvbiggYm9vayApe3JldHVybiAgYm9vay5OYW1lID09IGJhc2VuYW1lKHBhdGgpfSk7DQogICAgICByZXR1cm4gdGFyZ2V0ID8gdGFyZ2V0IDogdGhpcy5ib29rcy5PcGVuKHBhdGgpOw0KICAgIH0sDQogICAgbmV3Qm9vazogZnVuY3Rpb24oKSB7DQogICAgICByZXR1cm4gdGhpcy5ib29rcy5hZGQoKTsNCiAgICB9LA0KICAgIGdldFNoZWV0czogZnVuY3Rpb24oYm9vaykgew0KICAgICAgcmV0dXJuIG1hcCh0aGlzLmdldEJvb2soYm9vaykuU2hlZXRzKTsNCiAgICB9LA0KICAgIGZpbmRCb29rOiBmdW5jdGlvbihwYXR0ZXJuKSB7DQogICAgICB2YXIgaXNNYXRjaCA9IG1hdGNoZXIkMShwYXR0ZXJuKTsNCiAgICAgIHJldHVybiBpc01hdGNoICYmIGZpbmQkMSh0aGlzLmJvb2tzLCBpc01hdGNoKTsNCiAgICB9LA0KICAgIGZpbmRTaGVldDogZnVuY3Rpb24ocGF0dGVybiwgX2Jvb2spIHsNCiAgICAgIHZhciBib29rLCBpc01hdGNoOw0KICAgICAgaWYgKF9ib29rKSB7DQogICAgICAgIGJvb2sgPSB0aGlzLmZpbmRCb29rKF9ib29rKTsNCiAgICAgICAgaWYgKCFib29rKSBib29rID0gX2Jvb2s7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBib29rID0gdGhpcy5hY3RpdmVCb29rOw0KICAgICAgfQ0KICAgICAgaXNNYXRjaCA9IG1hdGNoZXIkMShwYXR0ZXJuKTsNCiAgICAgIHJldHVybiBpc01hdGNoICYmIGZpbmQkMShib29rLlNoZWV0cywgaXNNYXRjaCk7DQogICAgfSwNCiAgICBnZXRWYWx1ZXM6IGZ1bmN0aW9uKHJhbmdlKSB7DQogICAgICB2YXIgcm93Tm8sDQogICAgICAgIHRibCA9IFtdLA0KICAgICAgICByb3dEYXRhOw0KICAgICAgZWFjaChyYW5nZSwgZnVuY3Rpb24oIHIgKSB7DQogICAgICAgIGlmIChyb3dObyAhPSByLlJvdykgew0KICAgICAgICAgIGlmIChyb3dEYXRhKSB0YmwucHVzaChyb3dEYXRhKTsNCiAgICAgICAgICByb3dEYXRhID0gW107DQogICAgICAgICAgcm93Tm8gPSByLlJvdzsNCiAgICAgICAgfQ0KICAgICAgICByb3dEYXRhLnB1c2goci52YWx1ZSk7DQogICAgICB9KTsNCiAgICAgIGlmIChyb3dEYXRhKSB0YmwucHVzaChyb3dEYXRhKTsNCiAgICAgIHJldHVybiB0Ymw7DQogICAgfSwNCiAgICBzZXRWYWx1ZXM6IGZ1bmN0aW9uKHJhbmdlLCB2YWxzKSB7DQogICAgICBpZiAoaXNBcnJheSh2YWxzKSkgew0KICAgICAgICBlYWNoKHZhbHMsIGZ1bmN0aW9uKCB2YWwgKSB7DQogICAgICAgICAgaWYgKGlzQXJyYXkodmFsKSkgew0KICAgICAgICAgICAgZWFjaCh2YWwsIGZ1bmN0aW9uIChpdCwgaSkgIHsNCiAgICAgICAgICAgICAgcmFuZ2Uub2Zmc2V0KDAsIGkpLnZhbHVlID0gaXQ7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmFuZ2UudmFsdWUgPSB2YWw7DQogICAgICAgICAgfQ0KICAgICAgICAgIHJhbmdlID0gcmFuZ2Uub2Zmc2V0KDEsIDApOw0KICAgICAgICB9KTsNCiAgICAgIH0NCiAgICB9LA0KICAgIG5vX3VwZGF0ZTogZnVuY3Rpb24oY2IpIHsNCiAgICAgIHRyeSB7DQogICAgICAgIHRoaXMuYXBwLlNjcmVlblVwZGF0aW5nID0gZmFsc2U7DQogICAgICAgIGNiKCk7DQogICAgICB9IGZpbmFsbHkgew0KICAgICAgICB0aGlzLmFwcC5TY3JlZW5VcGRhdGluZyA9IHRydWU7DQogICAgICB9DQogICAgfSwNCiAgICB1cGRhdGU6IGZ1bmN0aW9uKGNiKSB7DQogICAgICB0cnkgew0KICAgICAgICB0aGlzLmFwcC5TY3JlZW5VcGRhdGluZyA9IHRydWU7DQogICAgICAgIGNiKCk7DQogICAgICB9IGZpbmFsbHkgew0KICAgICAgICB0aGlzLmFwcC5TY3JlZW5VcGRhdGluZyA9IGZhbHNlOw0KICAgICAgfQ0KICAgIH0NCiAgfTsNCg0KICB2YXIgRVhDRUxfUFJPUFMgPSB7DQogICAgYWN0aXZlQm9vazogew0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuYXBwLkFjdGl2ZVdvcmtCb29rOw0KICAgICAgfQ0KICAgIH0sDQogICAgYWN0aXZlU2hlZXQ6IHsNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB0aGlzLmFwcC5BY3RpdmVTaGVldDsNCiAgICAgIH0NCiAgICB9LA0KICAgIGFjdGl2ZUNlbGw6IHsNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB0aGlzLmFwcC5BY3RpdmVDZWxsOw0KICAgICAgfQ0KICAgIH0sDQogICAgc2VsZWN0aW9uOiB7DQogICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5hcHAuU2VsZWN0aW9uOw0KICAgICAgfQ0KICAgIH0sDQogICAgYm9va3M6IHsNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB0aGlzLmFwcC5Xb3JrQm9va3M7DQogICAgICB9DQogICAgfQ0KICB9Ow0KDQogIGZ1bmN0aW9uIEV4Y2VsKHB0aCkgew0KICAgIHZhciBhcHAsIHhsOw0KICAgIHRyeSB7DQogICAgICBhcHAgPSBHZXRPYmplY3QocHRoIHx8ICcnLCBBUFBfSUQpOw0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgIGFwcCA9IG5ldyBBY3RpdmVYT2JqZWN0KEFQUF9JRCk7DQogICAgfQ0KICAgIGlmICghYXBwLlZpc2libGUpIGFwcC5WaXNpYmxlID0gdHJ1ZTsNCiAgICBpZiAoYXBwLldvcmtib29rcy5Db3VudCA9PT0gMCkgYXBwLldvcmtib29rcy5BZGQoKTsNCiAgICB4bCA9IE9iamVjdC5jcmVhdGUoRVhDRUxfUFJPVE8sIEVYQ0VMX1BST1BTKTsNCiAgICB4bC5hcHAgPSBhcHA7DQogICAgcmV0dXJuIHhsOw0KICB9DQoNCiAgZXh0ZW5kKEV4Y2VsLCB7DQogICAgeGxkb3duOiAtNDEyMSwNCiAgICB4bFRvTGVmdDogLTQxNTksDQogICAgeGxUb1JpZ2h0OiAtNDE2MSwNCiAgICB4bHVwOiAtNDE2Mg0KICB9KTsNCg0KICBmdW5jdGlvbiBmaW5kJDEoaXRlbXMsIGZuKSB7DQogICAgdmFyIGVuID0gbmV3IEVudW1lcmF0b3IoaXRlbXMpOw0KICAgIHZhciBpdGVtOw0KICAgIGZvciAodmFyIGkgPSAwOyAhZW4uYXRFbmQoKTsgZW4ubW92ZU5leHQoKSwgaSsrKSB7DQogICAgICBpdGVtID0gZW4uaXRlbSgpOw0KICAgICAgaWYgKGZuKGl0ZW0sIGkpID09PSB0cnVlKSByZXR1cm4gaXRlbTsNCiAgICB9DQogICAgcmV0dXJuIG51bGw7DQogIH0NCg0KICBmdW5jdGlvbiBtYXRjaGVyJDEocGF0dGVybikgew0KICAgIHZhciBpc01hdGNoOw0KICAgIGlmIChpc0Z1bmN0aW9uKHBhdHRlcm4pKSBpc01hdGNoID0gcGF0dGVybjsNCiAgICBlbHNlIGlmIChpc1N0cmluZyhwYXR0ZXJuKSkgaXNNYXRjaCA9IGZ1bmN0aW9uKCBpdCApe3JldHVybiAgaXQuTmFtZS5pbmNsdWRlcyhwYXR0ZXJuKX07DQogICAgZWxzZSBpZiAoaXNSZWdFeHAocGF0dGVybikpIGlzTWF0Y2ggPSBmdW5jdGlvbiggaXQgKXtyZXR1cm4gIHBhdHRlcm4udGVzdChpdC5OYW1lKX07DQogICAgZWxzZSBpc01hdGNoID0gbnVsbDsNCiAgICByZXR1cm4gaXNNYXRjaDsNCiAgfQoKICB2YXIgZXhjZWwgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICAnZGVmYXVsdCc6IEV4Y2VsCiAgfSk7CgogIGZ1bmN0aW9uIGdldFdpbmRvd3MoKSB7DQogICAgdmFyIHdpbnMgPSBbXTsNCiAgICBlYWNoKEdldFNoZWxsQXBwKCkuV2luZG93cygpLCBmdW5jdGlvbiggYXBwICkgew0KICAgICAgaWYgKGFwcCAmJiBhcHAuTmFtZSA9PT0gJ0ludGVybmV0IEV4cGxvcmVyJykgew0KICAgICAgICB3aW5zLnB1c2goYXBwKTsNCiAgICAgIH0NCiAgICB9KTsNCiAgICByZXR1cm4gd2luczsNCiAgfQ0KDQogIGZ1bmN0aW9uIGdldEFjdGl2ZSgpIHsNCiAgICB2YXIgaWU7DQogICAgZWFjaChHZXRTaGVsbEFwcCgpLldpbmRvd3MoKSwgZnVuY3Rpb24oIGFwcCApIHsNCiAgICAgIGlmIChhcHAgJiYgYXBwLk5hbWUgPT09ICdJbnRlcm5ldCBFeHBsb3JlcicgJiYgIWFwcC5Eb2N1bWVudC5oaWRkZW4pIHsNCiAgICAgICAgaWUgPSBhcHA7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0NCiAgICB9KTsNCiAgICByZXR1cm4gaWU7DQogIH0NCg0KICBmdW5jdGlvbiBnZXRJRSgpIHsNCiAgICB2YXIgaWU7DQogICAgZWFjaChHZXRTaGVsbEFwcCgpLldpbmRvd3MoKSwgZnVuY3Rpb24oIGFwcCApIHsNCiAgICAgIGlmIChhcHAgJiYgYXBwLk5hbWUgPT09ICdJbnRlcm5ldCBFeHBsb3JlcicpIHsNCiAgICAgICAgaWUgPSBhcHA7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0NCiAgICB9KTsNCiAgICByZXR1cm4gaWU7DQogIH0NCg0KICBmdW5jdGlvbiB3YWl0KGllLCB0aW1lb3V0KSB7DQogICAgdmFyIGVsYXBzZWQgPSAwOw0KICAgIHRpbWVvdXQgfHwgKHRpbWVvdXQgPSA1MDAwKTsNCiAgICB3aGlsZSAoaWUuQnVzeSB8fCBpZS5SZWFkeVN0YXRlICE9PSA0KSB7DQogICAgICBpZiAoZWxhcHNlZCA+PSB0aW1lb3V0KSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcignSUUgdGltZW91dCcpOw0KICAgICAgfQ0KICAgICAgZWxhcHNlZCArPSAxMDA7DQogICAgICBwcm9jZXNzLnNsZWVwKDEwMCk7DQogICAgfQ0KICB9DQoNCiAgdmFyIElFX09QVElPTlMgPSBbDQogICAgJ0FkZHJlc3NCYXInLA0KICAgICdGdWxsU2NyZWVuJywNCiAgICAnV2lkdGgnLA0KICAgICdIZWlnaHQnLA0KICAgICdUb3AnLA0KICAgICdMZWZ0JywNCiAgICAnTWVudUJhcicsDQogICAgJ1Jlc2l6YWJsZScsDQogICAgJ1NpbGVudCcsDQogICAgJ1N0YXR1c0JhcicsDQogICAgJ1Rvb2xCYXInLA0KICAgICdWaXNpYmxlJw0KICBdLnJlZHVjZSggZnVuY3Rpb24obWVtbywgaXQpICB7DQogICAgbWVtb1tpdF0gPSBpdDsNCiAgICBtZW1vW2l0LnRvTG93ZXJDYXNlKCldID0gaXQ7DQogICAgcmV0dXJuIG1lbW87DQogIH0sIHt9KTsNCg0KICBmdW5jdGlvbiBvcGVuKHVybCwgb3B0aW9ucykgew0KICAgIHZhciBpZSA9IG5ldyBBY3RpdmVYT2JqZWN0KCdJbnRlcm5ldEV4cGxvcmVyLkFwcGxpY2F0aW9uJyk7DQogICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsNCiAgICBlYWNoKG9wdGlvbnMsIGZ1bmN0aW9uICh2LCBrKSAgew0KICAgICAgdmFyIHByb3AgPSBJRV9PUFRJT05TW2tdOw0KICAgICAgaWYgKHByb3ApIGllW3Byb3BdID0gdjsNCiAgICB9KTsNCiAgICBpZiAoIWhhcyhvcHRpb25zLCAndmlzaWJsZScpICYmICFoYXMob3B0aW9ucywgJ1Zpc2libGUnKSkgew0KICAgICAgaWUuVmlzaWJsZSA9IHRydWU7DQogICAgfQ0KICAgIGllLk5hdmlnYXRlKHVybCB8fCAnYWJvdXQ6YmxhbmsnKTsNCiAgICB3YWl0KGllLCBvcHRpb25zLnRpbWVvdXQpOw0KICAgIHJldHVybiBpZTsNCiAgfQoKICB2YXIgaWUgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICBnZXRXaW5kb3dzOiBnZXRXaW5kb3dzLAogICAgZ2V0QWN0aXZlOiBnZXRBY3RpdmUsCiAgICBnZXRJRTogZ2V0SUUsCiAgICB3YWl0OiB3YWl0LAogICAgb3Blbjogb3BlbgogIH0pOwoKICB2YXIgQVBQX0lEJDEgPSAnT3V0bG9vay5BcHBsaWNhdGlvbic7DQogIHZhciBvbE1haWxJdGVtID0gMDsNCg0KICB2YXIgT1VUTE9PS19QUk9UTyA9IHsNCiAgICBjcmVhdGVNYWlsOiBmdW5jdGlvbihvcHRpb25zKSB7DQogICAgICB2YXIgaXRlbSA9IHRoaXMuYXBwLkNyZWF0ZUl0ZW0ob2xNYWlsSXRlbSk7DQogICAgICBpZiAob3B0aW9ucykgew0KICAgICAgICBlYWNoKG9wdGlvbnMsIGZ1bmN0aW9uICh2YWx1ZSwga2V5KSAgew0KICAgICAgICAgIGl0ZW1ba2V5XSA9IHZhbHVlOw0KICAgICAgICB9KTsNCiAgICAgIH0NCiAgICAgIGl0ZW0uRGlzcGxheSgpOw0KICAgICAgcmV0dXJuIGl0ZW07DQogICAgfQ0KICB9Ow0KDQogIHZhciBPVVRMT09LX1BST1BTID0gew0KICAgIGFwcDogeyB2YWx1ZTogbnVsbCwgd3JpdGFibGU6IHRydWUgfQ0KICB9Ow0KDQogIGZ1bmN0aW9uIE91dGxvb2soKSB7DQogICAgdmFyIGFwcDsNCiAgICB0cnkgew0KICAgICAgYXBwID0gR2V0T2JqZWN0KCcnLCBBUFBfSUQkMSk7DQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgYXBwID0gbmV3IEFjdGl2ZVhPYmplY3QoQVBQX0lEJDEpOw0KICAgIH0NCiAgICB2YXIgb2wgPSBPYmplY3QuY3JlYXRlKE9VVExPT0tfUFJPVE8sIE9VVExPT0tfUFJPUFMpOw0KICAgIG9sLmFwcCA9IGFwcDsNCiAgICByZXR1cm4gb2w7DQogIH0KCiAgdmFyIG91dGxvb2sgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICAnZGVmYXVsdCc6IE91dGxvb2sKICB9KTsKCiAgdmFyIGFkVXNlQ2xpZW50ID0gMzsNCiAgdmFyIGFkVXNlTm9uZSA9IDE7DQogIHZhciBhZFVzZVNlcnZlciA9IDI7DQoNCiAgdmFyIGFkTG9ja1Vuc3BlY2lmaWVkID0gLTE7DQogIHZhciBhZExvY2tSZWFkT25seSA9IDE7DQogIHZhciBhZExvY2tQZXNzaW1pc3RpYyA9IDI7DQogIHZhciBhZExvY2tPcHRpbWlzdGljID0gMzsNCiAgdmFyIGFkTG9ja0JhdGNoT3B0aW1pc3RpYyA9IDQ7DQoNCiAgdmFyIGFkT3BlblVuc3BlY2lmaWVkID0gLTE7DQogIHZhciBhZE9wZW5Gb3J3YXJkT25seSA9IDA7DQogIHZhciBhZE9wZW5LZXlzZXQgPSAxOw0KICB2YXIgYWRPcGVuRHluYW1pYyA9IDI7DQogIHZhciBhZE9wZW5TdGF0aWMgPSAzOw0KDQogIHZhciBhZEJpZ0ludCA9IDIwOw0KICB2YXIgYWRCaW5hcnkgPSAxMjg7DQogIHZhciBhZEJvb2xlYW4gPSAxMTsNCiAgdmFyIGFkQ2hhciA9IDEyOTsNCiAgdmFyIGFkQ3VycmVuY3kgPSA2Ow0KICB2YXIgYWREYXRlID0gNzsNCiAgdmFyIGFkREJEYXRlID0gMTMzOw0KICB2YXIgYWREQlRpbWUgPSAxMzQ7DQogIHZhciBhZERCVGltZVN0YW1wID0gMTM1Ow0KICB2YXIgYWREZWNpbWFsID0gMTQ7DQogIHZhciBhZERvdWJsZSA9IDU7DQogIHZhciBhZEdVSUQgPSA3MjsNCiAgdmFyIGFkSURpc3BhdGNoID0gOTsNCiAgdmFyIGFkSW50ZWdlciA9IDM7DQogIHZhciBhZExvbmdWYXJCaW5hcnkgPSAyMDU7DQogIHZhciBhZExvbmdWYXJDaGFyID0gMjAxOw0KICB2YXIgYWRMb25nVmFyV0NoYXIgPSAyMDM7DQogIHZhciBhZE51bWVyaWMgPSAxMzE7DQogIHZhciBhZFNpbmdsZSA9IDQ7DQogIHZhciBhZFNtYWxsSW50ID0gMjsNCiAgdmFyIGFkVW5zaWduZWRUaW55SW50ID0gMTc7DQogIHZhciBhZFZhckJpbmFyeSA9IDIwNDsNCiAgdmFyIGFkVmFyQ2hhciA9IDIwMDsNCiAgdmFyIGFkVmFyaWFudCA9IDEyOw0KICB2YXIgYWRWYXJXQ2hhciA9IDIwMjsNCiAgdmFyIGFkV0NoYXIgPSAxMzA7DQoNCiAgdmFyIGFkUGFyYW1Vbmtub3duID0gMDsNCiAgdmFyIGFkUGFyYW1JbnB1dCA9IDE7DQogIHZhciBhZFBhcmFtT3V0cHV0ID0gMjsNCiAgdmFyIGFkUGFyYW1JbnB1dE91dHB1dCA9IDM7DQogIHZhciBhZFBhcmFtUmV0dXJuVmFsdWUgPSA0Ow0KDQogIHZhciBhZFNjaGVtYVRhYmxlcyA9IDIwOw0KICB2YXIgYWRTY2hlbWFDb2x1bW5zID0gNDsNCg0KICBmdW5jdGlvbiBBZG9kYigpIHsNCiAgICB0aGlzLmNvbm4gPSBuZXcgQWN0aXZlWE9iamVjdCgnQURPREIuQ29ubmVjdGlvbicpOw0KICB9DQoNCiAgQWRvZGIucHJvdG90eXBlID0gew0KICAgIGNsb3NlOiBmdW5jdGlvbigpIHsNCiAgICAgIHRoaXMuY29ubiAmJiB0aGlzLmNvbm4uU3RhdGUgIT0gMCAmJiB0aGlzLmNvbm4uQ2xvc2UoKTsNCiAgICAgIHRoaXMuY29ubiA9IG51bGw7DQogICAgfSwNCg0KICAgIGJlZ2luOiBmdW5jdGlvbigpIHsNCiAgICAgIHRoaXMuY29ubi5CZWdpblRyYW5zKCk7DQogICAgfSwNCg0KICAgIGNvbW1pdDogZnVuY3Rpb24oKSB7DQogICAgICB0aGlzLmNvbm4uQ29tbWl0VHJhbnMoKTsNCiAgICB9LA0KDQogICAgcm9sbGJhY2s6IGZ1bmN0aW9uKCkgew0KICAgICAgdGhpcy5jb25uLlJvbGxiYWNrVHJhbnMoKTsNCiAgICB9LA0KDQogICAgZ2V0T3B0aW9uczogZnVuY3Rpb24oYXJncykgew0KICAgICAgaWYgKHR5cGVvZiBhcmdzWzBdID09PSAnb2JqZWN0JyAmJiBhcmdzWzBdLl9pc19vcHRpb25zKSByZXR1cm4gYXJnc1swXTsNCiAgICAgIHZhciBpID0gLTEsDQogICAgICAgIGxlbiA9IGFyZ3MubGVuZ3RoLA0KICAgICAgICBhcmcsDQogICAgICAgIG9wID0geyBfaXNfb3B0aW9uczogdHJ1ZSB9Ow0KICAgICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgICBhcmcgPSBhcmdzW2ldOw0KICAgICAgICBzd2l0Y2ggKHR5cGVPZihhcmcpKSB7DQogICAgICAgICAgY2FzZSAnc3RyaW5nJzoNCiAgICAgICAgICAgIG9wLnNxbCA9IGFyZzsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgIGNhc2UgJ2FycmF5JzoNCiAgICAgICAgICBjYXNlICdvYmplY3QnOg0KICAgICAgICAgICAgb3AucGFyYW1zID0gYXJnOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgY2FzZSAnYm9vbGVhbic6DQogICAgICAgICAgICBvcC5wcmVwYXJlZCA9IGFyZzsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgIGNhc2UgJ2Z1bmN0aW9uJzoNCiAgICAgICAgICAgIG9wLmNhbGxiYWNrID0gYXJnOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHJldHVybiBvcDsNCiAgICB9LA0KDQogICAgZ2V0RGF0YVR5cGVNYXBwaW5nOiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiB7DQogICAgICAgIHN0cmluZzogYWRWYXJXQ2hhciwNCiAgICAgICAgaW50OiBhZFNtYWxsSW50LA0KICAgICAgICBkZWNpbWFsOiBhZERvdWJsZSwNCiAgICAgICAgYm9vbGVhbjogYWRCb29sZWFuLA0KICAgICAgICBkYXRlOiBhZERhdGUsDQogICAgICAgIG51bGw6IGFkVmFyV0NoYXINCiAgICAgIH07DQogICAgfSwNCg0KICAgIGNyZWF0ZVBhcmFtczogZnVuY3Rpb24ob3B0cykgew0KICAgICAgdmFyIGNtZG9iaiA9IG9wdHMuY21kLA0KICAgICAgICBwYXJhbXMgPSBvcHRzLnBhcmFtczsNCiAgICAgIGlmICghY21kb2JqIHx8ICFwYXJhbXMpIHJldHVybjsNCiAgICAgIHZhciBqc1R5cGUsDQogICAgICAgIHRwLA0KICAgICAgICBzaXplID0gMTAsDQogICAgICAgIGR0bWFwID0gdGhpcy5nZXREYXRhVHlwZU1hcHBpbmcoKTsNCiAgICAgIGVhY2gocGFyYW1zLCBmdW5jdGlvbiAodmFsdWUsIG5hbWUpICB7DQogICAgICAgIGpzVHlwZSA9IHR5cGVPZih2YWx1ZSk7DQogICAgICAgIHN3aXRjaCAoanNUeXBlKSB7DQogICAgICAgICAgY2FzZSAnc3RyaW5nJzoNCiAgICAgICAgICAgIHRwID0gZHRtYXBbJ3N0cmluZyddOw0KICAgICAgICAgICAgc2l6ZSA9IHRwID09PSBhZFZhcmlhbnQgPyB2YWx1ZS5sZW5ndGggKiAyIDogdmFsdWUubGVuZ3RoOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgY2FzZSAnbnVtYmVyJzoNCiAgICAgICAgICAgIHRwID0gaXNJbnRlZ2VyKHZhbHVlKSA/IGR0bWFwWydpbnQnXSA6IGR0bWFwWydkZWNpbWFsJ107DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgICBjYXNlICdib29sZWFuJzoNCiAgICAgICAgICAgIHRwID0gZHRtYXBbJ2Jvb2xlYW4nXTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgIGNhc2UgJ2RhdGUnOg0KICAgICAgICAgICAgdHAgPSBkdG1hcFsnZGF0ZSddOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgY2FzZSAnbnVsbCc6DQogICAgICAgICAgY2FzZSAndW5kZWZpbmVkJzoNCiAgICAgICAgICAgIHRwID0gZHRtYXBbJ251bGwnXTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Fkb2RiLmNyZWF0ZVBhcmFtczogdW5leHBlY3RlZCB0eXBlICcgKyBqc1R5cGUpOw0KICAgICAgICB9DQogICAgICAgIHZhciBwYXJhbW9iaiA9IGNtZG9iai5DcmVhdGVQYXJhbWV0ZXIoDQogICAgICAgICAgbmFtZSwNCiAgICAgICAgICB0cCwNCiAgICAgICAgICBhZFBhcmFtSW5wdXQsDQogICAgICAgICAgc2l6ZSwNCiAgICAgICAgICB2YWx1ZQ0KICAgICAgICApOw0KICAgICAgICBjbWRvYmouUGFyYW1ldGVycy5BcHBlbmQocGFyYW1vYmopOw0KICAgICAgfSk7DQogICAgfSwNCg0KICAgIGV4ZWN1dGU6IGZ1bmN0aW9uKCkgew0KICAgICAgdmFyIG9wID0gdGhpcy5nZXRPcHRpb25zKGFyZ3VtZW50cyk7DQogICAgICB0cnkgew0KICAgICAgICB2YXIgY21kID0gbmV3IEFjdGl2ZVhPYmplY3QoJ0FET0RCLkNvbW1hbmQnKTsNCiAgICAgICAgY21kLkFjdGl2ZUNvbm5lY3Rpb24gPSB0aGlzLmNvbm47DQogICAgICAgIGNtZC5Db21tYW5kVHlwZSA9IDE7IA0KICAgICAgICBjbWQuUHJlcGFyZWQgPSBvcC5wcmVwYXJlZCB8fCBmYWxzZTsNCiAgICAgICAgY21kLkNvbW1hbmRUZXh0ID0gb3Auc3FsOw0KICAgICAgICBvcC5jbWQgPSBjbWQ7DQogICAgICAgIHRoaXMuY3JlYXRlUGFyYW1zKG9wKTsNCiAgICAgICAgcmV0dXJuIGNtZC5FeGVjdXRlKCk7DQogICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIGUuc3FsID0gb3Auc3FsOw0KICAgICAgICB0aHJvdyBlOw0KICAgICAgfQ0KICAgIH0sDQoNCiAgICBzZWxlY3Q6IGZ1bmN0aW9uKCkgew0KICAgICAgdmFyIHJzLA0KICAgICAgICByb3csDQogICAgICAgIGksDQogICAgICAgIGxlbiwNCiAgICAgICAgb3AgPSB0aGlzLmdldE9wdGlvbnMoYXJndW1lbnRzKTsNCiAgICAgIHRyeSB7DQogICAgICAgIHJzID0gdGhpcy5leGVjdXRlKG9wKTsNCiAgICAgICAgd2hpbGUgKCFycy5FT0YpIHsNCiAgICAgICAgICByb3cgPSB7fTsNCiAgICAgICAgICBpZiAobGVuID09IG51bGwpIGxlbiA9IHJzLkZpZWxkcy5Db3VudDsNCiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspIHsNCiAgICAgICAgICAgIHJvd1tycy5GaWVsZHMoaSkuTmFtZV0gPSB0aGlzLmdldEZpZWxkVmFsdWUocnMuRmllbGRzKGkpKTsNCiAgICAgICAgICB9DQogICAgICAgICAgaWYgKG9wLmNhbGxiYWNrKHJvdykgPT09IGZhbHNlKSBicmVhazsNCiAgICAgICAgICBycy5Nb3ZlTmV4dCgpOw0KICAgICAgICB9DQogICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIGUuc3FsID0gb3Auc3FsOw0KICAgICAgICB0aHJvdyBlOw0KICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgcnMgJiYgcnMuU3RhdGUgIT0gMCAmJiBycy5DbG9zZSgpOw0KICAgICAgfQ0KICAgIH0sDQoNCiAgICBnZXRGaWVsZFZhbHVlOiBmdW5jdGlvbihmaWVsZCkgew0KICAgICAgc3dpdGNoIChmaWVsZC5UeXBlKSB7DQogICAgICAgIGNhc2UgYWRCaW5hcnk6DQogICAgICAgIGNhc2UgYWRWYXJCaW5hcnk6DQogICAgICAgICAgcmV0dXJuICdbTE9CXSc7DQogICAgICAgIGNhc2UgYWREYXRlOg0KICAgICAgICBjYXNlIGFkREJEYXRlOg0KICAgICAgICBjYXNlIGFkREJUaW1lOg0KICAgICAgICBjYXNlIGFkREJUaW1lU3RhbXA6DQogICAgICAgICAgcmV0dXJuIERhdGUoZmllbGQudmFsdWUpOw0KICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgIHJldHVybiBmaWVsZC52YWx1ZTsNCiAgICAgIH0NCiAgICB9LA0KDQogICAgZWFjaFJvdzogZnVuY3Rpb24oKSB7DQogICAgICB2YXIgb3AgPSB0aGlzLmdldE9wdGlvbnMoYXJndW1lbnRzKTsNCiAgICAgIHRoaXMuc2VsZWN0KG9wKTsNCiAgICB9LA0KDQogICAgZmlyc3RSb3c6IGZ1bmN0aW9uKCkgew0KICAgICAgdmFyIG9wID0gdGhpcy5nZXRPcHRpb25zKGFyZ3VtZW50cyksDQogICAgICAgIF9yb3c7DQogICAgICBvcC5jYWxsYmFjayA9IGZ1bmN0aW9uKCByb3cgKXtyZXR1cm4gICgoX3JvdyA9IHJvdyksIGZhbHNlKX07DQogICAgICB0aGlzLnNlbGVjdChvcCk7DQogICAgICByZXR1cm4gX3JvdzsNCiAgICB9LA0KDQogICAgcm93czogZnVuY3Rpb24oKSB7DQogICAgICB2YXIgb3AgPSB0aGlzLmdldE9wdGlvbnMoYXJndW1lbnRzKSwNCiAgICAgICAgcm93cyA9IFtdOw0KICAgICAgb3AuY2FsbGJhY2sgPSBmdW5jdGlvbiggcm93ICkgew0KICAgICAgICByb3dzLnB1c2gocm93KTsNCiAgICAgIH07DQogICAgICB0aGlzLnNlbGVjdChvcCk7DQogICAgICByZXR1cm4gcm93czsNCiAgICB9LA0KDQogICAgYmF0Y2g6IGZ1bmN0aW9uKGNtZCwgZm4pIHsNCiAgICAgIHZhciBjb25uLCByczsNCiAgICAgIHRyeSB7DQogICAgICAgIGNvbm4gPSB0aGlzLmNvbm47DQogICAgICAgIHJzID0gbmV3IEFjdGl2ZVhPYmplY3QoJ0FET0RCLlJlY29yZHNldCcpOw0KICAgICAgICBycy5DdXJzb3JMb2NhdGlvbiA9IGFkVXNlQ2xpZW50Ow0KICAgICAgICBycy5Mb2NrVHlwZSA9IGFkTG9ja0JhdGNoT3B0aW1pc3RpYzsNCiAgICAgICAgcnMuQ3Vyc29yVHlwZSA9IGFkT3BlbkR5bmFtaWM7DQogICAgICAgIHJzLk9wZW4oY21kLCBjb25uKTsNCiAgICAgICAgZm4ocnMpOw0KICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgcnMgJiYgcnMuU3RhdGUgIT0gMCAmJiBycy5DbG9zZSgpOw0KICAgICAgfQ0KICAgIH0sDQoNCiAgICBzZXRGaWVsZFZhbHVlOiBmdW5jdGlvbihmaWVsZCwgdmFsdWUpIHsNCiAgICAgIHN3aXRjaCAodHlwZU9mKHZhbHVlKSkgew0KICAgICAgICBjYXNlICdkYXRlJzoNCiAgICAgICAgICBmaWVsZC5WYWx1ZSA9IGZvcm1hdERhdGUodmFsdWUpOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICdzdHJpbmcnOg0KICAgICAgICBjYXNlICdudW1iZXInOg0KICAgICAgICAgIGZpZWxkLlZhbHVlID0gdmFsdWU7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgZmllbGQuVmFsdWUgPSBTdHJpbmcodmFsdWUpOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgfQ0KICAgIH0sDQoNCiAgICBiYXRjaF9pbnNlcnQ6IGZ1bmN0aW9uKGNtZCwgcm93cykgew0KICAgICAgdmFyIHNlbGYgPSB0aGlzOw0KICAgICAgdGhpcy5iYXRjaChjbWQsIGZ1bmN0aW9uKCBycyApIHsNCiAgICAgICAgZWFjaChyb3dzLCBmdW5jdGlvbiggcm93ICkgew0KICAgICAgICAgIHJzLkFkZE5ldygpOw0KICAgICAgICAgIGVhY2gocm93LCBmdW5jdGlvbiAodiwgaykgIHsNCiAgICAgICAgICAgIHNlbGYuc2V0RmllbGRWYWx1ZShycy5GaWVsZHMoayksIHYpOw0KICAgICAgICAgIH0pOw0KICAgICAgICB9KTsNCiAgICAgICAgcnMuVXBkYXRlQmF0Y2goKTsNCiAgICAgIH0pOw0KICAgIH0sDQoNCiAgICB0YWJsZUV4aXN0czogZnVuY3Rpb24odGFibGVOYW1lKSB7DQogICAgICB2YXIgY29ubiwNCiAgICAgICAgcnMsDQogICAgICAgIHJlc3VsdCA9IGZhbHNlLA0KICAgICAgICBwYXJhbXMgPSBbbnVsbCwgbnVsbCwgdGFibGVOYW1lLCAnVEFCTEUnXTsNCiAgICAgIHRyeSB7DQogICAgICAgIGNvbm4gPSB0aGlzLmNvbm47DQogICAgICAgIHJzID0gY29ubi5PcGVuU2NoZW1hKGFkU2NoZW1hVGFibGVzLCBwYXJhbXMpOw0KICAgICAgICBpZiAoIXJzLkVPRikgcmVzdWx0ID0gdHJ1ZTsNCiAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgdGhyb3cgZTsNCiAgICAgIH0gZmluYWxseSB7DQogICAgICAgIHJzICYmIHJzLlN0YXRlICE9IDAgJiYgcnMuQ2xvc2UoKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfSwNCg0KICAgIGdldFRhYmxlczogZnVuY3Rpb24oKSB7DQogICAgICB2YXIgY29ubiwNCiAgICAgICAgcnMsDQogICAgICAgIHJlc3VsdCA9IFtdLA0KICAgICAgICBjb3VudCA9IDA7DQogICAgICB0cnkgew0KICAgICAgICBjb25uID0gdGhpcy5jb25uOw0KICAgICAgICBycyA9IGNvbm4uT3BlblNjaGVtYShhZFNjaGVtYVRhYmxlcyk7DQogICAgICAgIHdoaWxlICghcnMuRU9GKSB7DQogICAgICAgICAgaWYgKHJzLkZpZWxkcygnVEFCTEVfVFlQRScpLlZhbHVlID09PSAnVEFCTEUnKSB7DQogICAgICAgICAgICByZXN1bHRbY291bnQrK10gPSBycy5GaWVsZHMoJ1RBQkxFX05BTUUnKS5WYWx1ZTsNCiAgICAgICAgICB9DQogICAgICAgICAgcnMuTW92ZU5leHQoKTsNCiAgICAgICAgfQ0KICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICB0aHJvdyBlOw0KICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgcnMgJiYgcnMuU3RhdGUgIT0gMCAmJiBycy5DbG9zZSgpOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQogIH07DQoNCiAgZnVuY3Rpb24gZm9ybWF0RGF0ZShkKSB7DQogICAgcmV0dXJuICgNCiAgICAgIGQuZ2V0RnVsbFllYXIoKSArDQogICAgICAnLycgKw0KICAgICAgKGQuZ2V0TW9udGgoKSArIDEpICsNCiAgICAgICcvJyArDQogICAgICBkLmdldERhdGUoKSArDQogICAgICAnICcgKw0KICAgICAgZC5nZXRIb3VycygpICsNCiAgICAgICc6JyArDQogICAgICBkLmdldE1pbnV0ZXMoKSArDQogICAgICAnOicgKw0KICAgICAgZC5nZXRTZWNvbmRzKCkNCiAgICApOw0KICB9CgogIHZhciBhZG9kYiA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgIGFkVXNlQ2xpZW50OiBhZFVzZUNsaWVudCwKICAgIGFkVXNlTm9uZTogYWRVc2VOb25lLAogICAgYWRVc2VTZXJ2ZXI6IGFkVXNlU2VydmVyLAogICAgYWRMb2NrVW5zcGVjaWZpZWQ6IGFkTG9ja1Vuc3BlY2lmaWVkLAogICAgYWRMb2NrUmVhZE9ubHk6IGFkTG9ja1JlYWRPbmx5LAogICAgYWRMb2NrUGVzc2ltaXN0aWM6IGFkTG9ja1Blc3NpbWlzdGljLAogICAgYWRMb2NrT3B0aW1pc3RpYzogYWRMb2NrT3B0aW1pc3RpYywKICAgIGFkTG9ja0JhdGNoT3B0aW1pc3RpYzogYWRMb2NrQmF0Y2hPcHRpbWlzdGljLAogICAgYWRPcGVuVW5zcGVjaWZpZWQ6IGFkT3BlblVuc3BlY2lmaWVkLAogICAgYWRPcGVuRm9yd2FyZE9ubHk6IGFkT3BlbkZvcndhcmRPbmx5LAogICAgYWRPcGVuS2V5c2V0OiBhZE9wZW5LZXlzZXQsCiAgICBhZE9wZW5EeW5hbWljOiBhZE9wZW5EeW5hbWljLAogICAgYWRPcGVuU3RhdGljOiBhZE9wZW5TdGF0aWMsCiAgICBhZEJpZ0ludDogYWRCaWdJbnQsCiAgICBhZEJpbmFyeTogYWRCaW5hcnksCiAgICBhZEJvb2xlYW46IGFkQm9vbGVhbiwKICAgIGFkQ2hhcjogYWRDaGFyLAogICAgYWRDdXJyZW5jeTogYWRDdXJyZW5jeSwKICAgIGFkRGF0ZTogYWREYXRlLAogICAgYWREQkRhdGU6IGFkREJEYXRlLAogICAgYWREQlRpbWU6IGFkREJUaW1lLAogICAgYWREQlRpbWVTdGFtcDogYWREQlRpbWVTdGFtcCwKICAgIGFkRGVjaW1hbDogYWREZWNpbWFsLAogICAgYWREb3VibGU6IGFkRG91YmxlLAogICAgYWRHVUlEOiBhZEdVSUQsCiAgICBhZElEaXNwYXRjaDogYWRJRGlzcGF0Y2gsCiAgICBhZEludGVnZXI6IGFkSW50ZWdlciwKICAgIGFkTG9uZ1ZhckJpbmFyeTogYWRMb25nVmFyQmluYXJ5LAogICAgYWRMb25nVmFyQ2hhcjogYWRMb25nVmFyQ2hhciwKICAgIGFkTG9uZ1ZhcldDaGFyOiBhZExvbmdWYXJXQ2hhciwKICAgIGFkTnVtZXJpYzogYWROdW1lcmljLAogICAgYWRTaW5nbGU6IGFkU2luZ2xlLAogICAgYWRTbWFsbEludDogYWRTbWFsbEludCwKICAgIGFkVW5zaWduZWRUaW55SW50OiBhZFVuc2lnbmVkVGlueUludCwKICAgIGFkVmFyQmluYXJ5OiBhZFZhckJpbmFyeSwKICAgIGFkVmFyQ2hhcjogYWRWYXJDaGFyLAogICAgYWRWYXJpYW50OiBhZFZhcmlhbnQsCiAgICBhZFZhcldDaGFyOiBhZFZhcldDaGFyLAogICAgYWRXQ2hhcjogYWRXQ2hhciwKICAgIGFkUGFyYW1Vbmtub3duOiBhZFBhcmFtVW5rbm93biwKICAgIGFkUGFyYW1JbnB1dDogYWRQYXJhbUlucHV0LAogICAgYWRQYXJhbU91dHB1dDogYWRQYXJhbU91dHB1dCwKICAgIGFkUGFyYW1JbnB1dE91dHB1dDogYWRQYXJhbUlucHV0T3V0cHV0LAogICAgYWRQYXJhbVJldHVyblZhbHVlOiBhZFBhcmFtUmV0dXJuVmFsdWUsCiAgICBhZFNjaGVtYVRhYmxlczogYWRTY2hlbWFUYWJsZXMsCiAgICBhZFNjaGVtYUNvbHVtbnM6IGFkU2NoZW1hQ29sdW1ucywKICAgIEFkb2RiOiBBZG9kYgogIH0pOwoKICBmdW5jdGlvbiBBY2NEQihwYXRoKSB7DQogICAgaWYgKCFpc0Fic29sdXRlKHBhdGgpKSB7DQogICAgICBwYXRoID0gbm9ybWFsaXplKHBhdGgpOw0KICAgIH0NCiAgICBpZiAoIWlzZmlsZShwYXRoKSkgew0KICAgICAgdmFyIGFwcCA9IG5ldyBBY3RpdmVYT2JqZWN0KCdBY2Nlc3MuQXBwbGljYXRpb24nKTsNCiAgICAgIGFwcC5OZXdDdXJyZW50RGF0YWJhc2UocGF0aCk7DQogICAgfQ0KICAgIEFkb2RiLmNhbGwodGhpcyk7DQogICAgdGhpcy5jb25uLkNvbm5lY3Rpb25TdHJpbmcgPSBTdHJpbmcucmF3KHtyYXc6IFsnUHJvdmlkZXI9TWljcm9zb2Z0LkFjZS5PTEVEQi4xMi4wO0RhdGEgU291cmNlPScsJyddfSxwYXRoKTsNCiAgICB0aGlzLmNvbm4uT3BlbigpOw0KICB9DQoNCiAgaW5oZXJpdHMoQWNjREIsIEFkb2RiKTsNCg0KICBmdW5jdGlvbiBhY2NkYihwdGgpIHsNCiAgICByZXR1cm4gbmV3IEFjY0RCKHB0aCk7DQogIH0KCiAgdmFyIGFjY2RiJDEgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICBBY2NEQjogQWNjREIsCiAgICAnZGVmYXVsdCc6IGFjY2RiCiAgfSk7CgogIGZ1bmN0aW9uIENzdkRCKHBhdGgsIGhhc0hlYWRlcikgew0KICAgIGlmICghaXNBYnNvbHV0ZShwYXRoKSkgew0KICAgICAgcGF0aCA9IG5vcm1hbGl6ZShwYXRoKTsNCiAgICB9DQogICAgaWYgKGlzZmlsZShwYXRoKSkgcGF0aCA9IGRpcm5hbWUocGF0aCk7DQogICAgdmFyIGhkciA9DQogICAgICBoYXNIZWFkZXIgPT0gbnVsbCB8fCBoYXNIZWFkZXIgPT0gdHJ1ZSB8fCBoYXNIZWFkZXIgPT0gJ1lFUycgPyAnWUVTJyA6ICdOTyc7DQogICAgQWRvZGIuY2FsbCh0aGlzKTsNCiAgICB0aGlzLmNvbm4uQ29ubmVjdGlvblN0cmluZyA9IFN0cmluZy5yYXcoe3JhdzogWydQcm92aWRlcj1NaWNyb3NvZnQuQWNlLk9MRURCLjEyLjA7RGF0YSBTb3VyY2U9JywnO0V4dGVuZGVkIFByb3BlcnRpZXM9XCJUZXh0O0hEUj0nLCc7Rk1UPURlbGltaXRlZFwiJ119LHBhdGgsaGRyKTsNCiAgICB0aGlzLmNvbm4uT3BlbigpOw0KICB9DQoNCiAgaW5oZXJpdHMoQ3N2REIsIEFkb2RiKTsNCg0KICBmdW5jdGlvbiBjc3ZkYihwYXRoLCBoYXNIZWFkZXIpIHsNCiAgICByZXR1cm4gbmV3IENzdkRCKHBhdGgsIGhhc0hlYWRlcik7DQogIH0KCiAgdmFyIGNzdmRiJDEgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICBDc3ZEQjogQ3N2REIsCiAgICAnZGVmYXVsdCc6IGNzdmRiCiAgfSk7CgogIHZhciBFWENFTF9UWVBFID0gew0KICAgIHhsczogJ0V4Y2VsIDguMCcsDQogICAgeGxzeDogJ0V4Y2VsIDEyLjAgWG1sJywNCiAgICB4bHNiOiAnRXhjZWwgMTIuMCcsDQogICAgeGxzbTogJ0V4Y2VsIDEyLjAgTWFjcm8nDQogIH07DQoNCiAgZnVuY3Rpb24gRXhjZWxEQihwYXRoLCBoYXNIZWFkZXIpIHsNCiAgICBpZiAoIWlzQWJzb2x1dGUocGF0aCkpIHsNCiAgICAgIHBhdGggPSBub3JtYWxpemUocGF0aCk7DQogICAgfQ0KICAgIHZhciBleHQgPSBleHRuYW1lKHBhdGgpLnRvTG93ZXJDYXNlKCk7DQogICAgdmFyIGhkciA9DQogICAgICBoYXNIZWFkZXIgPT0gbnVsbCB8fCBoYXNIZWFkZXIgPT0gdHJ1ZSB8fCBoYXNIZWFkZXIgPT0gJ1lFUycgPyAnWUVTJyA6ICdOTyc7DQogICAgaWYgKCFFWENFTF9UWVBFW2V4dF0pIHRocm93IG5ldyBFcnJvcihleHQgKyAnIGZpbGUgaXMgbm90IHN1cHBvcnRlZCcpOw0KICAgIEFkb2RiLmNhbGwodGhpcyk7DQogICAgdGhpcy5jb25uLkNvbm5lY3Rpb25TdHJpbmcgPSBTdHJpbmcucmF3KHtyYXc6IFsnUHJvdmlkZXI9TWljcm9zb2Z0LkFjZS5PTEVEQi4xMi4wO0RhdGEgU291cmNlPScsJztFeHRlbmRlZCBQcm9wZXJ0aWVzPVwiJywnO0hEUj0nLCdcIiddfSxwYXRoLEVYQ0VMX1RZUEVbZXh0XSxoZHIpOw0KICAgIHRoaXMuY29ubi5PcGVuKCk7DQogIH0NCg0KICBpbmhlcml0cyhFeGNlbERCLCBBZG9kYik7DQoNCiAgZnVuY3Rpb24gZXhjZWxkYihwYXRoLCBoYXNIZWFkZXIpIHsNCiAgICByZXR1cm4gbmV3IEV4Y2VsREIocGF0aCwgaGFzSGVhZGVyKTsNCiAgfQoKICB2YXIgZXhjZWxkYiQxID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgRXhjZWxEQjogRXhjZWxEQiwKICAgICdkZWZhdWx0JzogZXhjZWxkYgogIH0pOwoKICBmdW5jdGlvbiBPcmFjbGVEQihkcywgdXNyLCBwYXNzKSB7DQogICAgdHJ5IHsNCiAgICAgIEFkb2RiLmNhbGwodGhpcyk7DQogICAgICB0aGlzLmNvbm4uQ29ubmVjdGlvblN0cmluZyA9DQogICAgICAgIA0KICAgICAgICBTdHJpbmcucmF3KHtyYXc6IFsnUHJvdmlkZXI9TVNEQU9SQTtEYXRhIFNvdXJjZT0nLCc7VXNlciBJRD0nLCc7UGFzc3dvcmQ9JywnJ119LGRzLHVzcixwYXNzKTsNCiAgICAgIHRoaXMuY29ubi5PcGVuKCk7DQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgY29uc29sZS5sb2coJ0RhdGFiYXNlIGNvbm5lY3QgZmFpbGVkLicpOw0KICAgICAgY29uc29sZS5sb2coDQogICAgICAgICdkYXRhc291cmNlOiAlc1xuICAgIHVzZXJpZDogJXNcbiAgcGFzc3dvcmQ6ICVzJywNCiAgICAgICAgZHMsDQogICAgICAgIHVzciwNCiAgICAgICAgcGFzcw0KICAgICAgKTsNCiAgICAgIHRocm93IGU7DQogICAgfQ0KICB9DQoNCiAgaW5oZXJpdHMoT3JhY2xlREIsIEFkb2RiKTsNCg0KICBleHRlbmQoT3JhY2xlREIucHJvdG90eXBlLCB7DQogICAgZ2V0RGF0YVR5cGVNYXBwaW5nOiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiB7DQogICAgICAgIHN0cmluZzogYWRWYXJpYW50LA0KICAgICAgICBpbnQ6IGFkSW50ZWdlciwNCiAgICAgICAgZGVjaW1hbDogYWROdW1lcmljLA0KICAgICAgICBib29sZWFuOiBhZEJvb2xlYW4sDQogICAgICAgIGRhdGU6IGFkREJUaW1lU3RhbXAsDQogICAgICAgIG51bGw6IGFkVmFyaWFudA0KICAgICAgfTsNCiAgICB9LA0KDQogICAgdGFibGVFeGlzdHM6IGZ1bmN0aW9uKHRhYmxlTmFtZSkgew0KICAgICAgdmFyIHJvdyA9IHRoaXMuZmlyc3RSb3coJ3NlbGVjdCAxIGZyb20gdXNlcl90YWJsZXMgd2hlcmUgdGFibGVfbmFtZSA9ID8nLCBbDQogICAgICAgIHRhYmxlTmFtZQ0KICAgICAgXSk7DQogICAgICByZXR1cm4gcm93ICE9IG51bGw7DQogICAgfSwNCg0KICAgIGdldFRhYmxlczogZnVuY3Rpb24oKSB7DQogICAgICB2YXIgcm93cyA9IHRoaXMucm93cygnc2VsZWN0IHRhYmxlX25hbWUgZnJvbSB1c2VyX3RhYmxlcycpOw0KICAgICAgcmV0dXJuIHJvd3MubWFwKCBmdW5jdGlvbihpdCApe3JldHVybiAgaXQuVEFCTEVfTkFNRX0pOw0KICAgIH0NCiAgfSk7DQoNCiAgZnVuY3Rpb24gb3JhY2xlZGIoZHMsIHVzciwgcGFzcykgew0KICAgIHJldHVybiBuZXcgT3JhY2xlREIoZHMsIHVzciwgcGFzcyk7DQogIH0NCg0KDQoNCiAgdmFyIF92YnMkMTsNCg0KICBmdW5jdGlvbiBnZXRWQlMoKSB7DQogICAgaWYgKCFfdmJzJDEpIHsNCiAgICAgIF92YnMkMSA9IEdldFZCU2NyaXB0KCk7DQogICAgICBfdmJzJDEuQWRkQ29kZShTdHJpbmcucmF3KHtyYXc6IFsnXHJcbkZ1bmN0aW9uIFJlYWRCbG9iKGZpZWxkKVxyXG4gIERpbSBidWYoKVxyXG4gIGZpZWxkLkdldENodW5rQnl0ZUV4IGJ1ZiwgMCwgZmllbGQuRmllbGRTaXplKClcclxuICBSZWFkQmxvYiA9IGJ1ZlxyXG5FbmQgRnVuY3Rpb25cclxuXHJcbkZ1bmN0aW9uIFJlYWRDbG9iKGZpZWxkKVxyXG4gIERpbSBidWZcclxuICBmaWVsZC5WYWx1ZS5SZWFkIGJ1ZlxyXG4gIFJlYWRDbG9iID0gYnVmXHJcbkVuZCBGdW5jdGlvblxyXG4gICAgJ119KSk7DQogICAgfQ0KICAgIHJldHVybiBfdmJzJDE7DQogIH0NCg0KICB2YXIgX3Nlc3Npb247DQoNCiAgZnVuY3Rpb24gT280byhkcywgdXNlciwgcGFzcykgew0KICAgIHRoaXMuc2Vzc2lvbiA9DQogICAgICBfc2Vzc2lvbiB8fA0KICAgICAgKF9zZXNzaW9uID0gbmV3IEFjdGl2ZVhPYmplY3QoJ09yYWNsZUluUHJvY1NlcnZlci5YT3JhU2Vzc2lvbicpKTsNCiAgICB0aGlzLmRhdGFCYXNlID0gdGhpcy5zZXNzaW9uLk9wZW5EYXRhYmFzZShkcywgdXNlciArICcvJyArIHBhc3MsIDApOw0KICB9DQoNCiAgaW5oZXJpdHMoT280bywgT3JhY2xlREIpOw0KDQogIGV4dGVuZChPbzRvLnByb3RvdHlwZSwgew0KICAgIGNsb3NlOiBmdW5jdGlvbigpIHsNCiAgICAgIHRoaXMuZGF0YUJhc2UuQ2xvc2UoKTsNCiAgICAgIHRoaXMuZGF0YUJhc2UgPSBudWxsOw0KICAgICAgdGhpcy5zZXNzaW9uID0gbnVsbDsNCiAgICB9LA0KDQogICAgYmVnaW46IGZ1bmN0aW9uKCkgew0KICAgICAgdGhpcy5zZXNzaW9uLkJlZ2luVHJhbnMoKTsNCiAgICB9LA0KDQogICAgY29tbWl0OiBmdW5jdGlvbigpIHsNCiAgICAgIHRoaXMuc2Vzc2lvbi5Db21taXRUcmFucygpOw0KICAgIH0sDQoNCiAgICByb2xsYmFjazogZnVuY3Rpb24oKSB7DQogICAgICB0aGlzLnNlc3Npb24uUm9sbGJhY2soKTsNCiAgICB9LA0KDQogICAgZ2V0RGF0YVR5cGVNYXBwaW5nOiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiB7DQogICAgICAgIHN0cmluZzogMSwNCiAgICAgICAgbnVtYmVyOiAyLA0KICAgICAgICBib29sZWFuOiAxLA0KICAgICAgICBkYXRlOiAxMiwNCiAgICAgICAgYnVmZmVyOiAxMTMsDQogICAgICAgIG51bGw6IDEsDQogICAgICAgIHVuZGVmaW5lZDogMQ0KICAgICAgfTsNCiAgICB9LA0KDQogICAgY3JlYXRlUGFyYW1zOiBmdW5jdGlvbihvcHRzKSB7DQogICAgICB2YXIgcGFyYW1zID0gb3B0cy5wYXJhbXMsDQogICAgICAgIHNlbGYgPSB0aGlzOw0KICAgICAgaWYgKCFwYXJhbXMpIHJldHVybjsNCiAgICAgIHZhciBkdG1hcCA9IHRoaXMuZ2V0RGF0YVR5cGVNYXBwaW5nKCk7DQogICAgICBlYWNoKHBhcmFtcywgZnVuY3Rpb24gKHYsIGspICB7DQogICAgICAgIHZhciB0eXBlID0gZHRtYXBbdHlwZU9mKHYpXSB8fCAxOw0KICAgICAgICBzZWxmLmRhdGFCYXNlLlBhcmFtZXRlcnMuQWRkKFN0cmluZyhrKSwgdiwgMSwgdHlwZSk7DQoNCiAgICAgICAgaWYgKGlzQXJyYXkocGFyYW1zKSAmJiBvcHRzLnNxbC5pbmNsdWRlcygnPycpKSB7DQogICAgICAgICAgdmFyIGluZGV4ID0gMDsNCiAgICAgICAgICBvcHRzLnNxbCA9IG9wdHMuc3FsLnJlcGxhY2UoL1w/L2csIGZ1bmN0aW9uICgpICB7DQogICAgICAgICAgICByZXR1cm4gJzonICsgaW5kZXgrKzsNCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfSwNCg0KICAgIHJlbW92ZVBhcmFtczogZnVuY3Rpb24ob3B0cykgew0KICAgICAgdmFyIHBhcmFtcyA9IG9wdHMucGFyYW1zLA0KICAgICAgICBzZWxmID0gdGhpczsNCiAgICAgIGlmICghcGFyYW1zKSByZXR1cm47DQogICAgICBlYWNoKHBhcmFtcywgZnVuY3Rpb24gKHYsIGspICB7DQogICAgICAgIHNlbGYuZGF0YUJhc2UuUGFyYW1ldGVycy5SZW1vdmUoU3RyaW5nKGspKTsNCiAgICAgIH0pOw0KICAgIH0sDQoNCiAgICBleGVjdXRlOiBmdW5jdGlvbigpIHsNCiAgICAgIHZhciBvcHRzID0gdGhpcy5nZXRPcHRpb25zKGFyZ3VtZW50cyk7DQogICAgICB0cnkgew0KICAgICAgICB0aGlzLmNyZWF0ZVBhcmFtcyhvcHRzKTsNCiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YUJhc2UuRXhlY3V0ZVNRTChvcHRzLnNxbCk7DQogICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIGUuc3FsID0gb3B0cy5zcWw7DQogICAgICAgIHRocm93IGU7DQogICAgICB9IGZpbmFsbHkgew0KICAgICAgICB0aGlzLnJlbW92ZVBhcmFtcyhvcHRzKTsNCiAgICAgIH0NCiAgICB9LA0KDQogICAgc2VsZWN0OiBmdW5jdGlvbigpIHsNCiAgICAgIHZhciBycywNCiAgICAgICAgcm93LA0KICAgICAgICBpLA0KICAgICAgICBsZW4sDQogICAgICAgIG9wdHMgPSB0aGlzLmdldE9wdGlvbnMoYXJndW1lbnRzKTsNCiAgICAgIHRyeSB7DQogICAgICAgIHRoaXMuY3JlYXRlUGFyYW1zKG9wdHMpOw0KICAgICAgICBycyA9IHRoaXMuZGF0YUJhc2UuQ3JlYXRlRHluYXNldChvcHRzLnNxbCwgMCk7DQogICAgICAgIHdoaWxlICghcnMuRU9GKSB7DQogICAgICAgICAgcm93ID0ge307DQogICAgICAgICAgaWYgKGxlbiA9PSBudWxsKSBsZW4gPSBycy5GaWVsZHMuQ291bnQ7DQogICAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7DQogICAgICAgICAgICByb3dbcnMuRmllbGRzKGkpLk5hbWVdID0gdGhpcy5nZXRGaWVsZFZhbHVlKHJzLkZpZWxkcyhpKSk7DQogICAgICAgICAgfQ0KICAgICAgICAgIGlmIChvcHRzLmNhbGxiYWNrKHJvdykgPT09IGZhbHNlKSBicmVhazsNCiAgICAgICAgICBycy5Nb3ZlTmV4dCgpOw0KICAgICAgICB9DQogICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIGUuc3FsID0gb3B0cy5zcWw7DQogICAgICAgIHRocm93IGU7DQogICAgICB9IGZpbmFsbHkgew0KICAgICAgICB0aGlzLnJlbW92ZVBhcmFtcyhvcHRzKTsNCiAgICAgICAgcnMgJiYgcnMuQ2xvc2UoKTsNCiAgICAgIH0NCiAgICB9LA0KDQogICAgZ2V0RmllbGRWYWx1ZTogZnVuY3Rpb24oZmllbGQpIHsNCiAgICAgIHN3aXRjaCAoZmllbGQuT3JhSURhdGFUeXBlKSB7DQogICAgICAgIGNhc2UgMjoNCiAgICAgICAgY2FzZSA4Og0KICAgICAgICAgIHJldHVybiBOdW1iZXIoZmllbGQudmFsdWUpOw0KICAgICAgICBjYXNlIDExMjoNCiAgICAgICAgICByZXR1cm4gZ2V0VkJTKCkuUnVuKCdSZWFkQ2xvYicsIGZpZWxkKTsNCiAgICAgICAgY2FzZSAxMTM6DQogICAgICAgICAgcmV0dXJuIEJ1ZmZlci5mcm9tKGdldFZCUygpLlJ1bignUmVhZEJsb2InLCBmaWVsZCkpOw0KICAgICAgICBjYXNlIDEyOg0KICAgICAgICBjYXNlIDE4NzoNCiAgICAgICAgY2FzZSAxODg6DQogICAgICAgIGNhc2UgMjMyOg0KICAgICAgICAgIHJldHVybiBEYXRlKGZpZWxkLnZhbHVlKTsNCiAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICByZXR1cm4gZmllbGQudmFsdWU7DQogICAgICB9DQogICAgfSwNCg0KICAgIGJhdGNoOiBmdW5jdGlvbigpIHt9LA0KDQogICAgYmF0Y2hfaW5zZXJ0OiBmdW5jdGlvbihjbWQsIHJvd3MpIHsNCiAgICAgIHZhciBzZWxmID0gdGhpczsNCiAgICAgIHZhciBycyA9IHRoaXMuZGF0YUJhc2UuQ3JlYXRlRHluYXNldChjbWQsIDApOw0KICAgICAgdHJ5IHsNCiAgICAgICAgdGhpcy5iZWdpbigpOw0KICAgICAgICBlYWNoKHJvd3MsIGZ1bmN0aW9uKCByb3cgKSB7DQogICAgICAgICAgcnMuQWRkTmV3KCk7DQogICAgICAgICAgZWFjaChyb3csIGZ1bmN0aW9uICh2LCBrKSAgew0KICAgICAgICAgICAgc2VsZi5zZXRGaWVsZFZhbHVlKHJzLkZpZWxkcyhrKSwgdik7DQogICAgICAgICAgfSk7DQogICAgICAgICAgcnMuVXBkYXRlKCk7DQogICAgICAgIH0pOw0KICAgICAgICB0aGlzLmNvbW1pdCgpOw0KICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICB0aGlzLnJvbGxiYWNrKCk7DQogICAgICAgIHRocm93IGU7DQogICAgICB9IGZpbmFsbHkgew0KICAgICAgICBycyAmJiBycy5DbG9zZSgpOw0KICAgICAgfQ0KICAgIH0NCiAgfSk7DQoNCiAgZnVuY3Rpb24gb280byhkcywgdXNlciwgcGFzcykgew0KICAgIHJldHVybiBuZXcgT280byhkcywgdXNlciwgcGFzcyk7DQogIH0KCiAgdmFyIG9yYWNsZWRiJDEgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICBPcmFjbGVEQjogT3JhY2xlREIsCiAgICAnZGVmYXVsdCc6IG9yYWNsZWRiLAogICAgT280bzogT280bywKICAgIG9vNG86IG9vNG8KICB9KTsKCiAgdmFyIF9zZXJ2aWNlOw0KDQogIGZ1bmN0aW9uIGdldFNlcnZpY2UoKSB7DQogICAgaWYgKCFfc2VydmljZSkgew0KICAgICAgdmFyIGxvY2F0b3IgPSBuZXcgQWN0aXZlWE9iamVjdCgnV2JlbVNjcmlwdGluZy5TV2JlbUxvY2F0b3InKTsNCiAgICAgIF9zZXJ2aWNlID0gbG9jYXRvci5Db25uZWN0U2VydmVyKCcuJywgJ3Jvb3RcXENJTVYyJyk7DQogICAgfQ0KICAgIHJldHVybiBfc2VydmljZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGdldCQxKGNtZCkgew0KICAgIHJldHVybiBnZXRTZXJ2aWNlKCkuR2V0KGNtZCk7DQogIH0NCg0KICBmdW5jdGlvbiBleGVjJDEod3FsKSB7DQogICAgcmV0dXJuIGdldFNlcnZpY2UoKS5FeGVjUXVlcnkod3FsKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHF1ZXJ5KHdxbCkgew0KICAgIHZhciBycyA9IGV4ZWMkMSh3cWwpOw0KICAgIHZhciByb3dzID0gbWFwKHJzLCBmdW5jdGlvbiggcmVjb3JkICkgew0KICAgICAgcmV0dXJuIHJlZHVjZSgNCiAgICAgICAgcmVjb3JkLlByb3BlcnRpZXNfLCBmdW5jdGlvbg0KICAgICAgICAocm93RGF0YSwgcHJvcCkgIHsNCiAgICAgICAgICBpZiAocHJvcC5WYWx1ZSAhPSBudWxsKSB7DQogICAgICAgICAgICByb3dEYXRhW3Byb3AubmFtZV0gPSBwcm9wLklzQXJyYXkNCiAgICAgICAgICAgICAgPyBuZXcgVkJBcnJheShwcm9wLlZhbHVlKS50b0FycmF5KCkNCiAgICAgICAgICAgICAgOiBwcm9wLlZhbHVlOw0KICAgICAgICAgIH0NCiAgICAgICAgICByZXR1cm4gcm93RGF0YTsNCiAgICAgICAgfSwNCiAgICAgICAge30NCiAgICAgICk7DQogICAgfSk7DQogICAgcnMgPSBudWxsOw0KICAgIHJldHVybiByb3dzOw0KICB9DQoNCiAgZnVuY3Rpb24gZWFjaFJvdyh3cWwsIGNiKSB7DQogICAgdmFyIHJzID0gZXhlYyQxKHdxbCk7DQogICAgZWFjaChycywgZnVuY3Rpb24oIGl0ICl7cmV0dXJuICBjYihpdCl9KTsNCiAgICBycyA9IG51bGw7DQogIH0NCg0KICBmdW5jdGlvbiBmaXJzdFJvdyh3cWwpIHsNCiAgICB2YXIgb2JqOw0KICAgIHZhciBycyA9IGV4ZWMkMSh3cWwpOw0KICAgIGVhY2gocnMsIGZ1bmN0aW9uKCBpdCApIHsNCiAgICAgIG9iaiA9IGl0Ow0KICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0pOw0KICAgIHJzID0gbnVsbDsNCiAgICByZXR1cm4gb2JqOw0KICB9DQoNCiAgZnVuY3Rpb24gY3B1KCkgew0KICAgIHJldHVybiBxdWVyeSgnc2VsZWN0ICogZnJvbSBXaW4zMl9Qcm9jZXNzb3InKVswXTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHN5cygpIHsNCiAgICByZXR1cm4gcXVlcnkoJ3NlbGVjdCAqIGZyb20gV2luMzJfQ29tcHV0ZXJTeXN0ZW0nKVswXTsNCiAgfQ0KDQogIGZ1bmN0aW9uIG9zKCkgew0KICAgIHJldHVybiBxdWVyeSgnc2VsZWN0ICogZnJvbSBXaW4zMl9PcGVyYXRpbmdTeXN0ZW0nKVswXTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNodXRkb3duKGZvcmNlZCkgew0KICAgIHJldHVybiBmaXJzdFJvdygnc2VsZWN0ICogZnJvbSBXaW4zMl9PcGVyYXRpbmdTeXN0ZW0nKS5XaW4zMlNodXRkb3duKA0KICAgICAgMSArIChmb3JjZWQgPyA0IDogMCkNCiAgICApOw0KICB9DQoNCiAgZnVuY3Rpb24gbG9nb2ZmKGZvcmNlZCkgew0KICAgIHJldHVybiBmaXJzdFJvdygnc2VsZWN0ICogZnJvbSBXaW4zMl9PcGVyYXRpbmdTeXN0ZW0nKS5XaW4zMlNodXRkb3duKA0KICAgICAgMCArIChmb3JjZWQgPyA0IDogMCkNCiAgICApOw0KICB9DQoNCiAgZnVuY3Rpb24gcmVzdGFydChmb3JjZWQpIHsNCiAgICByZXR1cm4gZmlyc3RSb3coJ3NlbGVjdCAqIGZyb20gV2luMzJfT3BlcmF0aW5nU3lzdGVtJykuV2luMzJTaHV0ZG93bigNCiAgICAgIDIgKyAoZm9yY2VkID8gNCA6IDApDQogICAgKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHBvd2Vyb2ZmKGZvcmNlZCkgew0KICAgIHJldHVybiBmaXJzdFJvdygnc2VsZWN0ICogZnJvbSBXaW4zMl9PcGVyYXRpbmdTeXN0ZW0nKS5XaW4zMlNodXRkb3duKA0KICAgICAgOCArIChmb3JjZWQgPyA0IDogMCkNCiAgICApOw0KICB9DQoNCiAgZnVuY3Rpb24gcHMobCkgew0KICAgIHZhciBwcm9wcyA9IFsnUHJvY2Vzc0lkJywgJ0NhcHRpb24nXTsNCiAgICBpZiAobCkgcHJvcHMucHVzaCgnUGFyZW50UHJvY2Vzc0lkJywgJ0NyZWF0aW9uRGF0ZScsICdDb21tYW5kTGluZScpOw0KICAgIHJldHVybiBtYXAoZXhlYyQxKCdzZWxlY3QgKiBmcm9tIFdpbjMyX1Byb2Nlc3MnKSwgZnVuY3Rpb24oIGl0ICkgew0KICAgICAgcmV0dXJuIHJlZHVjZShwcm9wcywgZnVuY3Rpb24gKHJvdywgbmFtZSkge3JldHVybiAgKChyb3dbbmFtZV0gPSBpdFtuYW1lXSksIHJvdyl9LCB7fSk7DQogICAgfSk7DQogIH0NCg0KICBmdW5jdGlvbiBraWxsKGFyZykgew0KICAgIHZhciB3cWwgPSAnc2VsZWN0ICogZnJvbSBXaW4zMl9Qcm9jZXNzJzsNCiAgICBpZiAoaXNTdHJpbmcoYXJnKSkgd3FsICs9IFN0cmluZy5yYXcoe3JhdzogWycgd2hlcmUgQ2FwdGlvbj1cJycsJ1wnJ119LGFyZyk7DQogICAgZWxzZSBpZiAoaXNOdW1iZXIoYXJnKSkgd3FsICs9IFN0cmluZy5yYXcoe3JhdzogWycgd2hlcmUgUHJvY2Vzc0lkPScsJyddfSxhcmcpOw0KICAgIGVsc2UgcmV0dXJuIC0xOw0KICAgIHJldHVybiBmaXJzdFJvdyh3cWwpLlRlcm1pbmF0ZSgpOw0KICB9DQoNCiAgZnVuY3Rpb24gZW52KCkgew0KICAgIHJldHVybiByZWR1Y2UoDQogICAgICBleGVjJDEoJ3NlbGVjdCAqIGZyb20gV2luMzJfRW52aXJvbm1lbnQnKSwgZnVuY3Rpb24NCiAgICAgIChyZXN1bHQsIGl0KSB7cmV0dXJuICAoKHJlc3VsdFtpdC5OYW1lXSA9IGl0LlZhcmlhYmxlVmFsdWUpLCByZXN1bHQpfSwNCiAgICAgIHt9DQogICAgKTsNCiAgfQoKICB2YXIgd21pID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgZ2V0OiBnZXQkMSwKICAgIGV4ZWM6IGV4ZWMkMSwKICAgIHF1ZXJ5OiBxdWVyeSwKICAgIGVhY2hSb3c6IGVhY2hSb3csCiAgICBmaXJzdFJvdzogZmlyc3RSb3csCiAgICBjcHU6IGNwdSwKICAgIHN5czogc3lzLAogICAgb3M6IG9zLAogICAgc2h1dGRvd246IHNodXRkb3duLAogICAgbG9nb2ZmOiBsb2dvZmYsCiAgICByZXN0YXJ0OiByZXN0YXJ0LAogICAgcG93ZXJvZmY6IHBvd2Vyb2ZmLAogICAgcHM6IHBzLAogICAga2lsbDoga2lsbCwKICAgIGVudjogZW52CiAgfSk7CgogIHZhciBDSEFJTl9BUEkgPSBTdHJpbmcucmF3KHtyYXc6IFsnXHJcbkNvbGxlY3Rpb25cclxuIGVhY2goZm9yRWFjaClcclxuIG1hcChzZWxlY3QpXHJcbiByZWR1Y2VcclxuIGZpbHRlcih3aGVyZSlcclxuIHRvQXJyYXlcclxuIGZpbmRcclxuIGZpbmRJbmRleFxyXG4gZ3JvdXBCeVxyXG4gY291bnRCeVxyXG4gc2l6ZShsZW4pXHJcbkFycmF5XHJcbiB1bmlxQnkoZGlzdGluY3RCeSlcclxuIHVuaXEoZGlzdGluY3QpXHJcbiBjaHVua1xyXG4gY29uY2F0XHJcbiBzbGljZVxyXG4gZHJvcFxyXG4gdGFpbFxyXG4gaW5pdGlhbFxyXG4gdGFrZVxyXG4gY29udGFpbnMoaW5jbHVkZSxpbmNsdWRlcylcclxuIGZpcnN0KGhlYWQpXHJcbiBsYXN0XHJcbiBudGhcclxuIHB1bGxBbGxcclxuIHB1bGxcclxuIHJlbW92ZVxyXG4gZGlmZmVyZW5jZVxyXG4gdW56aXBcclxuIHppcFxyXG4gZmxhdHRlblxyXG5PYmplY3RcclxuIGtleXNcclxuIHZhbHVlc1xyXG4gemlwT2JqZWN0XHJcbiBmcm9tUGFpcnNcclxuIG9iamVjdFxyXG4gZ2V0XHJcbiBzZXRcclxuIHVuc2V0XHJcbiB1cGRhdGVcclxuIHBpY2tcclxuIGV4dGVuZChhc3NpZ25JbilcclxuIGRlZmF1bHRzXHJcbiBlbnRyaWVzKHRvUGFpcnMpXHJcbk1hdGhcclxuIHN1bVxyXG4gYXZlcmFnZShhdmcpXHJcblN0cmluZ1xyXG4gZWFjaE1hdGNoXHJcbiBmaW5kQWxsXHJcbiddfSk7DQoNCiAgZnVuY3Rpb24gY2hhaW5faW5pdChvYmopIHsNCiAgICB0aGlzLl9vYmogPSBvYmo7DQogIH0NCg0KICBmdW5jdGlvbiBDaGFpbihvYmopIHsNCiAgICByZXR1cm4gbmV3IGNoYWluX2luaXQob2JqKTsNCiAgfQ0KDQogIHZhciBDSEFJTl9QUk9UTyA9IChjaGFpbl9pbml0LnByb3RvdHlwZSA9IENoYWluLnByb3RvdHlwZSk7DQoNCiAgZXh0ZW5kKENoYWluLCB0b29sKTsNCg0KICBlYWNoTWF0Y2goQ0hBSU5fQVBJLCAvICsoXHcrKSg/OlwoKC4rKVwpKT8vZywgZnVuY3Rpb24gKG0wLCBuYW1lLCBhbGlhcykgIHsNCiAgICB2YXIgZm4gPSB0b29sW25hbWVdOw0KICAgIGlmICghZm4pIHRocm93IG5ldyBFcnJvcihTdHJpbmcucmF3KHtyYXc6IFsnJywnIG5vdCBleGl0cyBpbiB0b29sJ119LG5hbWUpKTsNCiAgICB2YXIgd3JhcHBlZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgdGhpcy5fb2JqID0gYXBwbHkoZm4sIG51bGwsIGNvbmNhdChbdGhpcy5fb2JqXSwgYXJndW1lbnRzKSk7DQogICAgICByZXR1cm4gdGhpczsNCiAgICB9Ow0KICAgIENIQUlOX1BST1RPW25hbWVdID0gd3JhcHBlZDsNCiAgICBpZiAoYWxpYXMpIHsNCiAgICAgIGFsaWFzLnNwbGl0KCcsJykuZm9yRWFjaCggZnVuY3Rpb24oX25hbWUgKSB7DQogICAgICAgIENIQUlOX1BST1RPW19uYW1lXSA9IHdyYXBwZWQ7DQogICAgICB9KTsNCiAgICB9DQogIH0uYmluZCh3aW5kb3cpKTsNCg0KICBleHRlbmQoQ0hBSU5fUFJPVE8sIHsNCiAgICB2YWx1ZTogZnVuY3Rpb24oKSB7DQogICAgICByZXR1cm4gdGhpcy5fb2JqOw0KICAgIH0sDQoNCiAgICB0YXA6IGZ1bmN0aW9uKGZuKSB7DQogICAgICBmbih0aGlzLl9vYmopOw0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfSwNCg0KICAgIHRocnU6IGZ1bmN0aW9uKGZuKSB7DQogICAgICB0aGlzLl9vYmogPSBmbih0aGlzLl9vYmopOw0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfSwNCg0KICAgIGxvZzogZnVuY3Rpb24obXNnKSB7DQogICAgICBtc2cgPyBjb25zb2xlLmxvZyhtc2csIHRoaXMuX29iaikgOiBjb25zb2xlLmxvZyh0aGlzLl9vYmopOw0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfSwNCg0KICAgIHRvRmlsZTogZnVuY3Rpb24ocHRoLCBvcHRpb25zKSB7DQogICAgICB2YXIgZGF0YSA9IHRoaXMuX29iajsNCiAgICAgIGlmIChpc09iamVjdChkYXRhKSkgew0KICAgICAgICBkYXRhID0gaW5zcGVjdChkYXRhLCBvcHRpb25zKTsNCiAgICAgIH0NCiAgICAgIG91dHB1dEZpbGVTeW5jKHB0aCwgZGF0YSwgb3B0aW9ucyk7DQogICAgICByZXR1cm4gdGhpczsNCiAgICB9LA0KDQogICAgdG9KU09OOiBmdW5jdGlvbihwdGgsIG9wdGlvbnMpIHsNCiAgICAgIG91dHB1dEpzb25TeW5jKHB0aCwgdGhpcy5fb2JqLCBvcHRpb25zKTsNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0sDQoNCiAgICB0b0pzb246IGZ1bmN0aW9uKHB0aCwgb3B0aW9ucykgew0KICAgICAgcmV0dXJuIHRoaXMudG9KU09OKHB0aCwgb3B0aW9ucyk7DQogICAgfSwNCg0KICAgIHRvQ1NWOiBmdW5jdGlvbihwdGgsIG9wdGlvbnMpIHsNCiAgICAgIHZhciBkYXRhID0gc3RyaW5naWZ5JDEodGhpcy5fb2JqLCBvcHRpb25zKTsNCiAgICAgIG91dHB1dEZpbGVTeW5jKHB0aCwgZGF0YSwgb3B0aW9ucyk7DQogICAgICByZXR1cm4gdGhpczsNCiAgICB9LA0KDQogICAgdG9Dc3Y6IGZ1bmN0aW9uKHB0aCwgb3B0aW9ucykgew0KICAgICAgcmV0dXJuIHRoaXMudG9DU1YocHRoLCBvcHRpb25zKTsNCiAgICB9DQogIH0pOw0KDQogIENoYWluLnJhbmdlID0gZnVuY3Rpb24oKSB7DQogICAgdmFyIGRhdGEgPSBhcHBseShyYW5nZSwgbnVsbCwgYXJndW1lbnRzKTsNCiAgICByZXR1cm4gQ2hhaW4oZGF0YSk7DQogIH07DQoNCiAgQ2hhaW4udGV4dCA9IGZ1bmN0aW9uKHB0aCwgZW5jb2RpbmcpIHsNCiAgICBpZiAoIWlzYWJzKHB0aCkpIHB0aCA9IGFic3BhdGgocHRoKTsNCiAgICB2YXIgZGF0YSA9IHJlYWRGaWxlU3luYyhwdGgsIGVuY29kaW5nIHx8ICdVVEYtOCcpOw0KICAgIHJldHVybiBDaGFpbihkYXRhKTsNCiAgfTsNCg0KICBDaGFpbi5saW5lcyA9IGZ1bmN0aW9uKHB0aCkgew0KICAgIGlmICghaXNhYnMocHRoKSkgcHRoID0gYWJzcGF0aChwdGgpOw0KICAgIHZhciBkYXRhID0gcmVhZExpbmVzU3luYyhwdGgpOw0KICAgIHJldHVybiBDaGFpbihkYXRhKTsNCiAgfTsNCg0KICBDaGFpbi5qc29uID0gZnVuY3Rpb24ocHRoKSB7DQogICAgdmFyIGRhdGEgPSByZWFkSnNvblN5bmMocHRoKTsNCiAgICByZXR1cm4gQ2hhaW4oZGF0YSk7DQogIH07DQoNCiAgQ2hhaW4uY3N2ID0gZnVuY3Rpb24ocHRoLCBlbmNvZGluZykgew0KICAgIGlmICghaXNhYnMocHRoKSkgcHRoID0gYWJzcGF0aChwdGgpOw0KICAgIHZhciBkYXRhID0gcmVhZEZpbGVTeW5jKHB0aCwgZW5jb2RpbmcgfHwgJ1VURi04Jyk7DQogICAgcmV0dXJuIENoYWluKHBhcnNlJDIoZGF0YSkpOw0KICB9Ow0KDQogIENoYWluLnJlYWRkaXIgPSBmdW5jdGlvbihwdGgpIHsNCiAgICBpZiAoIWlzYWJzKHB0aCkpIHB0aCA9IGFic3BhdGgocHRoKTsNCiAgICB2YXIgZGF0YSA9IHJlYWRkaXJTeW5jKHB0aCk7DQogICAgcmV0dXJuIENoYWluKGRhdGEpOw0KICB9Ow0KDQogIENoYWluLnNjYW5kaXIgPSBmdW5jdGlvbihwdGgpIHsNCiAgICBpZiAoIWlzYWJzKHB0aCkpIHB0aCA9IGFic3BhdGgocHRoKTsNCiAgICB2YXIgZGF0YSA9IHNjYW5kaXIocHRoKTsNCiAgICByZXR1cm4gQ2hhaW4oZGF0YSk7DQogIH07DQoNCiAgQ2hhaW4ud2FsayA9IGZ1bmN0aW9uKHB0aCwgc2VsZWN0KSB7DQogICAgdmFyIGRhdGEgPSBbXTsNCiAgICBpZiAoIXNlbGVjdCkgc2VsZWN0ID0gZnVuY3Rpb24oIGl0ICl7cmV0dXJuICBpdC5wYXRofTsNCiAgICB3YWxrKHB0aCwgZnVuY3Rpb24oIGl0ICkgew0KICAgICAgZGF0YS5wdXNoKHNlbGVjdChpdCkpOw0KICAgIH0pOw0KICAgIHJldHVybiBDaGFpbihkYXRhKTsNCiAgfTsNCg0KICBDaGFpbi5tYXRjaCA9IGZ1bmN0aW9uKHN0ciwgcGF0dGVybikgew0KICAgIHZhciBtYXRjaGVzID0gW107DQogICAgZWFjaE1hdGNoKHN0ciwgcGF0dGVybiwgZnVuY3Rpb24gKCkgIHsNCiAgICAgIG1hdGNoZXMucHVzaChhcmd1bWVudHMpOw0KICAgIH0pOw0KICAgIHJldHVybiBDaGFpbihtYXRjaGVzKTsNCiAgfTsNCg0KICBDaGFpbi5hcGkgPSBDSEFJTl9BUEk7CgogIHZhciBjaGFpbiA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgICdkZWZhdWx0JzogQ2hhaW4KICB9KTsKCiAgdmFyIFJFR0VYX1BBUlNFID0gL14oXGR7NH0pWy0vXT8oXGR7MSwyfSlbLS9dPyhcZHsxLDJ9KVteMC05XSooXGR7MSwyfSk/Oj8oXGR7MSwyfSk/Oj8oXGR7MSwyfSk/XC4/KFxkezEsM30pPyQvOw0KICB2YXIgUkVHRVhfRk9STUFUID0gL1xbKFteXF1dKyldfFl7Miw0fXxNezEsNH18RHsxLDJ9fGR7MSw0fXxIezEsMn18aHsxLDJ9fGF8QXxtezEsMn18c3sxLDJ9fFp7MSwyfXxTU1MvZzsNCiAgdmFyIE1TID0gJ21pbGxpc2Vjb25kJzsNCiAgdmFyIFMgPSAnc2Vjb25kJzsNCiAgdmFyIE1JTiA9ICdtaW51dGUnOw0KICB2YXIgSCA9ICdob3VyJzsNCiAgdmFyIEQgPSAnZGF5JzsNCiAgdmFyIFcgPSAnd2Vlayc7DQogIHZhciBNID0gJ21vbnRoJzsNCiAgdmFyIFEgPSAncXVhcnRlcic7DQogIHZhciBZID0gJ3llYXInOw0KICB2YXIgREFURSA9ICdkYXRlJzsNCiAgdmFyIEZPUk1BVF9ERUZBVUxUID0gJ1lZWVktTU0tRERUSEg6bW06c3NaJzsNCiAgdmFyIElOVkFMSURfREFURV9TVFJJTkcgPSAnSW52YWxpZCBEYXRlJzsNCg0KICB2YXIgTHMgPSB7DQogICAgZW46IHsNCiAgICAgIG5hbWU6ICdlbicsDQogICAgICB3ZWVrZGF5czogJ1N1bmRheV9Nb25kYXlfVHVlc2RheV9XZWRuZXNkYXlfVGh1cnNkYXlfRnJpZGF5X1NhdHVyZGF5Jy5zcGxpdCgNCiAgICAgICAgJ18nDQogICAgICApLA0KICAgICAgbW9udGhzOiAnSmFudWFyeV9GZWJydWFyeV9NYXJjaF9BcHJpbF9NYXlfSnVuZV9KdWx5X0F1Z3VzdF9TZXB0ZW1iZXJfT2N0b2Jlcl9Ob3ZlbWJlcl9EZWNlbWJlcicuc3BsaXQoDQogICAgICAgICdfJw0KICAgICAgKQ0KICAgIH0NCiAgfTsNCiAgdmFyIEwgPSAnZW4nOw0KDQogIGZ1bmN0aW9uIHBhcnNlTG9jYWxlKHByZXNldCwgb2JqZWN0LCBpc0xvY2FsKSB7DQogICAgdmFyIGw7DQogICAgaWYgKCFwcmVzZXQpIHJldHVybiBudWxsOw0KICAgIGlmIChpc1N0cmluZyhwcmVzZXQpKSB7DQogICAgICBpZiAoTHNbcHJlc2V0XSkgew0KICAgICAgICBsID0gcHJlc2V0Ow0KICAgICAgfQ0KICAgICAgaWYgKG9iamVjdCkgew0KICAgICAgICBMc1twcmVzZXRdID0gb2JqZWN0Ow0KICAgICAgICBsID0gcHJlc2V0Ow0KICAgICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICB2YXIgbmFtZSA9IHByZXNldC5uYW1lOw0KICAgICAgTHNbbmFtZV0gPSBwcmVzZXQ7DQogICAgICBsID0gbmFtZTsNCiAgICB9DQogICAgaWYgKCFpc0xvY2FsKSBMID0gbDsNCiAgICByZXR1cm4gbDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzRGF5anMoZGF0ZSkgew0KICAgIHJldHVybiBkYXRlIGluc3RhbmNlb2YgRGF5anM7DQogIH0NCg0KICBmdW5jdGlvbiBkYXlqcyhkYXRlLCBjZmcpIHsNCiAgICBpZiAoaXNEYXlqcyhkYXRlKSkgcmV0dXJuIGRhdGUuY2xvbmUoKTsNCiAgICB2YXIgX2NmZyA9IHsgZGF0ZTogZGF0ZSB9Ow0KICAgIGlmIChpc1N0cmluZyhjZmcpKSB7DQogICAgICBfY2ZnLmZvcm1hdCA9IGNmZzsNCiAgICB9IGVsc2UgaWYgKGlzT2JqZWN0TGlrZShjZmcpKSB7DQogICAgICBleHRlbmQoX2NmZywgY2ZnKTsNCiAgICB9DQogICAgcmV0dXJuIG5ldyBEYXlqcyhfY2ZnKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIERheWpzKGNmZykgew0KICAgIHRoaXMuJEwgPSBwYXJzZUxvY2FsZShjZmcubG9jYWxlLCBudWxsLCB0cnVlKSB8fCBMOw0KICAgIHRoaXMucGFyc2UoY2ZnKTsNCiAgfQ0KDQogIHZhciBfcHJvdG8gPSBEYXlqcy5wcm90b3R5cGU7DQoNCiAgX3Byb3RvLnBhcnNlID0gZnVuY3Rpb24oY2ZnKSB7DQogICAgdGhpcy4kZCA9IHBhcnNlRGF0ZShjZmcpOw0KICAgIHRoaXMuaW5pdCgpOw0KICB9Ow0KDQogIGZ1bmN0aW9uIHBhcnNlRGF0ZShjZmcpIHsNCiAgICB2YXIgZGF0ZSA9IGNmZy5kYXRlLA0KICAgICAgdXRjID0gY2ZnLnV0YzsNCiAgICBpZiAoZGF0ZSA9PSBudWxsKSByZXR1cm4gbmV3IERhdGUoKTsNCiAgICBpZiAoaXNEYXRlKGRhdGUpKSByZXR1cm4gbmV3IERhdGUoZGF0ZSk7DQogICAgaWYgKGlzU3RyaW5nKGRhdGUpICYmICEvWiQvaS50ZXN0KGRhdGUpKSB7DQogICAgICB2YXIgbSA9IGRhdGUubWF0Y2goUkVHRVhfUEFSU0UpOw0KICAgICAgaWYgKG0pIHsNCiAgICAgICAgaWYgKHV0Yykgew0KICAgICAgICAgIHJldHVybiBuZXcgRGF0ZSgNCiAgICAgICAgICAgIERhdGUuVVRDKA0KICAgICAgICAgICAgICBtWzFdLA0KICAgICAgICAgICAgICBtWzJdIC0gMSwNCiAgICAgICAgICAgICAgbVszXSwNCiAgICAgICAgICAgICAgbVs0XSB8fCAwLA0KICAgICAgICAgICAgICBtWzVdIHx8IDAsDQogICAgICAgICAgICAgIG1bNl0gfHwgMCwNCiAgICAgICAgICAgICAgbVs3XSB8fCAwDQogICAgICAgICAgICApDQogICAgICAgICAgKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbmV3IERhdGUoDQogICAgICAgICAgbVsxXSwNCiAgICAgICAgICBtWzJdIC0gMSwNCiAgICAgICAgICBtWzNdLA0KICAgICAgICAgIG1bNF0gfHwgMCwNCiAgICAgICAgICBtWzVdIHx8IDAsDQogICAgICAgICAgbVs2XSB8fCAwLA0KICAgICAgICAgIG1bN10gfHwgMA0KICAgICAgICApOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gbmV3IERhdGUoZGF0ZSk7DQogIH0NCg0KICBfcHJvdG8uaW5pdCA9IGZ1bmN0aW9uKCkgew0KICAgIHZhciAkZCA9IHRoaXMuJGQ7DQogICAgZXh0ZW5kKHRoaXMsIHsNCiAgICAgICR5OiAkZC5nZXRGdWxsWWVhcigpLA0KICAgICAgJE06ICRkLmdldE1vbnRoKCksDQogICAgICAkRDogJGQuZ2V0RGF0ZSgpLA0KICAgICAgJFc6ICRkLmdldERheSgpLA0KICAgICAgJEg6ICRkLmdldEhvdXJzKCksDQogICAgICAkbTogJGQuZ2V0TWludXRlcygpLA0KICAgICAgJHM6ICRkLmdldFNlY29uZHMoKSwNCiAgICAgICRtczogJGQuZ2V0TWlsbGlzZWNvbmRzKCkNCiAgICB9KTsNCiAgfTsNCg0KICBfcHJvdG8uaXNWYWxpZCA9IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiB0aGlzLiRkLnRvU3RyaW5nKCkgIT09IElOVkFMSURfREFURV9TVFJJTkc7DQogIH07DQoNCiAgX3Byb3RvLmlzU2FtZSA9IGZ1bmN0aW9uKHRoYXQsIHVuaXRzKSB7DQogICAgdmFyIG90aGVyID0gZGF5anModGhhdCk7DQogICAgcmV0dXJuIHRoaXMuc3RhcnRPZih1bml0cykgPD0gb3RoZXIgJiYgb3RoZXIgPD0gdGhpcy5lbmRPZih1bml0cyk7DQogIH07DQoNCiAgX3Byb3RvLmlzQWZ0ZXIgPSBmdW5jdGlvbih0aGF0LCB1bml0cykgew0KICAgIHJldHVybiBkYXlqcyh0aGF0KSA8IHRoaXMuc3RhcnRPZih1bml0cyk7DQogIH07DQoNCiAgX3Byb3RvLmlzQmVmb3JlID0gZnVuY3Rpb24odGhhdCwgdW5pdHMpIHsNCiAgICByZXR1cm4gdGhpcy5lbmRPZih1bml0cykgPCBkYXlqcyh0aGF0KTsNCiAgfTsNCg0KICBlYWNoKA0KICAgIHsNCiAgICAgICR5OiBZLA0KICAgICAgJE06IE0sDQogICAgICAkVzogRCwNCiAgICAgICREOiBEQVRFLA0KICAgICAgJEg6IEgsDQogICAgICAkbTogTUlOLA0KICAgICAgJHM6IFMsDQogICAgICAkbXM6IE1TDQogICAgfSwgZnVuY3Rpb24NCiAgICAodW5pdCwgcHJvcCkgIHsNCiAgICAgIF9wcm90b1t1bml0XSA9IGZ1bmN0aW9uKGlucHV0KSB7DQogICAgICAgIHJldHVybiBpbnB1dCA9PSBudWxsID8gdGhpc1twcm9wXSA6IHRoaXMuY2xvbmUoKS4kc2V0KHVuaXQsIGlucHV0KTsNCiAgICAgIH07DQogICAgfS5iaW5kKHdpbmRvdykNCiAgKTsNCg0KICBfcHJvdG8udmFsdWVPZiA9IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiB0aGlzLiRkLmdldFRpbWUoKTsNCiAgfTsNCg0KICBmdW5jdGlvbiBwcmV0dHlVbml0KHUpIHsNCiAgICB2YXIgc3BlY2lhbCA9IHsNCiAgICAgIE06IE0sDQogICAgICB5OiBZLA0KICAgICAgdzogVywNCiAgICAgIGQ6IEQsDQogICAgICBoOiBILA0KICAgICAgbTogTUlOLA0KICAgICAgczogUywNCiAgICAgIG1zOiBNUywNCiAgICAgIFE6IFENCiAgICB9Ow0KICAgIHJldHVybiAoDQogICAgICBzcGVjaWFsW3VdIHx8DQogICAgICBTdHJpbmcodSB8fCAnJykNCiAgICAgICAgLnRvTG93ZXJDYXNlKCkNCiAgICAgICAgLnJlcGxhY2UoL3MkLywgJycpDQogICAgKTsNCiAgfQ0KDQogIF9wcm90by5zdGFydE9mID0gZnVuY3Rpb24odW5pdHMsIF9zdGFydE9mKSB7DQogICAgDQogICAgdmFyIGlzU3RhcnRPZiA9IF9zdGFydE9mID09IG51bGwgPyB0cnVlIDogX3N0YXJ0T2Y7DQogICAgdmFyIHVuaXQgPSBwcmV0dHlVbml0KHVuaXRzKTsNCiAgICB2YXIgJE0gPSB0aGlzLiRNLA0KICAgICAgJFcgPSB0aGlzLiRXLA0KICAgICAgJEQgPSB0aGlzLiREOw0KICAgIHZhciBjbG9uZSA9IHRoaXMuY2xvbmUoKTsNCg0KICAgIHN3aXRjaCAodW5pdCkgew0KICAgICAgY2FzZSBZOg0KICAgICAgICByZXR1cm4gY2xvbmUuJCRzZXQoaXNTdGFydE9mID8geyBNOiAwLCBkYXRlOiAxIH0gOiB7IE06IDExLCBkYXRlOiAzMSB9KTsNCiAgICAgIGNhc2UgTToNCiAgICAgICAgcmV0dXJuIGNsb25lLiQkc2V0KA0KICAgICAgICAgIGlzU3RhcnRPZiA/IHsgTTogJE0sIGRhdGU6IDEgfSA6IHsgTTogJE0gKyAxLCBkYXRlOiAwIH0NCiAgICAgICAgKTsNCiAgICAgIGNhc2UgRDoNCiAgICAgIGNhc2UgREFURToNCiAgICAgICAgcmV0dXJuIGNsb25lLiRzZXQoSCwgaXNTdGFydE9mID8gMCA6IDIzKTsNCiAgICAgIGNhc2UgSDoNCiAgICAgICAgcmV0dXJuIGNsb25lLiRzZXQoTUlOLCBpc1N0YXJ0T2YgPyAwIDogNTkpOw0KICAgICAgY2FzZSBNSU46DQogICAgICAgIHJldHVybiBjbG9uZS4kc2V0KFMsIGlzU3RhcnRPZiA/IDAgOiA1OSk7DQogICAgICBjYXNlIFM6DQogICAgICAgIHJldHVybiBjbG9uZS4kc2V0KE1TLCBpc1N0YXJ0T2YgPyAwIDogOTk5KTsNCiAgICAgIGNhc2UgVzogew0KICAgICAgICB2YXIgd2Vla1N0YXJ0ID0gdGhpcy4kbG9jYWxlKCkud2Vla1N0YXJ0IHx8IDA7DQogICAgICAgIHZhciBnYXAgPSAoJFcgPCB3ZWVrU3RhcnQgPyAkVyArIDcgOiAkVykgLSB3ZWVrU3RhcnQ7DQogICAgICAgIHJldHVybiBjbG9uZS4kc2V0KERBVEUsIGlzU3RhcnRPZiA/ICREIC0gZ2FwIDogJEQgKyAoNiAtIGdhcCkpOw0KICAgICAgfQ0KICAgICAgZGVmYXVsdDoNCiAgICAgICAgcmV0dXJuIGNsb25lOw0KICAgIH0NCiAgfTsNCg0KICBfcHJvdG8uZW5kT2YgPSBmdW5jdGlvbih1bml0cykgew0KICAgIHJldHVybiB0aGlzLnN0YXJ0T2YodW5pdHMsIGZhbHNlKTsNCiAgfTsNCg0KICB2YXIgVU5JVF9NRVRIT0QgPSBmcm9tUGFpcnMoWw0KICAgIFtELCAnRGF0ZSddLA0KICAgIFtEQVRFLCAnRGF0ZSddLA0KICAgIFtNLCAnTW9udGgnXSwNCiAgICBbWSwgJ0Z1bGxZZWFyJ10sDQogICAgW0gsICdIb3VycyddLA0KICAgIFtNSU4sICdNaW51dGVzJ10sDQogICAgW1MsICdTZWNvbmRzJ10sDQogICAgW01TLCAnTWlsbGlzZWNvbmRzJ10NCiAgXSk7DQoNCiAgZnVuY3Rpb24gX3NldChzZWxmLCB1bml0cywgX2ludCkgew0KICAgIHZhciB1bml0ID0gcHJldHR5VW5pdCh1bml0cyk7DQogICAgdmFyIHV0Y1BhZCA9ICdzZXQnICsgKHNlbGYuJHUgPyAnVVRDJyA6ICcnKTsNCiAgICB2YXIgbmFtZSA9IFVOSVRfTUVUSE9EW3VuaXRdOw0KICAgIHZhciBhcmcgPSB1bml0ID09IEQgPyBzZWxmLiREICsgKF9pbnQgLSBzZWxmLiRXKSA6IF9pbnQ7DQoNCiAgICBpZiAobmFtZSkgew0KICAgICAgaWYgKHVuaXQgPT0gTSB8fCB1bml0ID09IFkpIHsNCiAgICAgICAgdmFyIF9kID0gc2VsZi50b0RhdGUoKTsNCiAgICAgICAgX2Quc2V0RGF0ZSgxKTsNCiAgICAgICAgX2RbdXRjUGFkICsgbmFtZV0oYXJnKTsNCiAgICAgICAgX2Quc2V0TW9udGgoX2QuZ2V0TW9udGgoKSArIDEpOw0KICAgICAgICBfZC5zZXREYXRlKDApOw0KICAgICAgICB2YXIgX2xhc3REYXRlID0gX2QuZ2V0RGF0ZSgpOw0KICAgICAgICBpZiAoc2VsZi4kRCA8IF9sYXN0RGF0ZSkgew0KICAgICAgICAgIF9kLnNldERhdGUoc2VsZi4kRCk7DQogICAgICAgIH0NCiAgICAgICAgc2VsZi4kZCA9IF9kOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgc2VsZi4kZFt1dGNQYWQgKyBuYW1lXShhcmcpOw0KICAgICAgfQ0KICAgIH0NCiAgfQ0KDQogIF9wcm90by4kc2V0ID0gZnVuY3Rpb24odW5pdHMsIF9pbnQpIHsNCiAgICBfc2V0KHRoaXMsIHVuaXRzLCBfaW50KTsNCiAgICB0aGlzLmluaXQoKTsNCiAgICByZXR1cm4gdGhpczsNCiAgfTsNCg0KICBfcHJvdG8uJCRzZXQgPSBmdW5jdGlvbihvcHRpb25zKSB7DQogICAgdmFyIHNlbGYgPSB0aGlzOw0KICAgIGVhY2gob3B0aW9ucywgZnVuY3Rpb24gKF9pbnQsIHVuaXRzKSAgew0KICAgICAgX3NldChzZWxmLCB1bml0cywgX2ludCk7DQogICAgfSk7DQogICAgdGhpcy5pbml0KCk7DQogICAgcmV0dXJuIHRoaXM7DQogIH07DQoNCiAgX3Byb3RvLnNldCA9IGZ1bmN0aW9uKHVuaXQsIF9pbnQpIHsNCiAgICB2YXIgY2xvbmUgPSB0aGlzLmNsb25lKCk7DQogICAgaWYgKGlzU3RyaW5nKHVuaXQpKSB7DQogICAgICByZXR1cm4gY2xvbmUuJHNldCh1bml0LCBfaW50KTsNCiAgICB9IGVsc2UgaWYgKGlzT2JqZWN0TGlrZSh1bml0KSkgew0KICAgICAgcmV0dXJuIGNsb25lLiQkc2V0KHVuaXQpOw0KICAgIH0NCiAgICByZXR1cm4gY2xvbmU7DQogIH07DQoNCiAgX3Byb3RvLmdldCA9IGZ1bmN0aW9uKHVuaXQpIHsNCiAgICByZXR1cm4gdGhpc1twcmV0dHlVbml0KHVuaXQpXSgpOw0KICB9Ow0KDQogIF9wcm90by5hZGQgPSBmdW5jdGlvbihuLCB1bml0cykgew0KICAgIHZhciBuYW1lID0gcHJldHR5VW5pdCh1bml0cyk7DQogICAgdmFyIGNsb25lID0gdGhpcy5jbG9uZSgpOw0KICAgIG4gPSBOdW1iZXIobik7DQogICAgaWYgKG5hbWUgPT0gVykgcmV0dXJuIGNsb25lLiRzZXQoREFURSwgdGhpcy4kRCArIE1hdGgucm91bmQobiAqIDcpKTsNCiAgICBlbHNlIHJldHVybiBjbG9uZS4kc2V0KG5hbWUsIHRoaXNbbmFtZV0oKSArIG4pOw0KICB9Ow0KDQogIF9wcm90by5zdWJ0cmFjdCA9IGZ1bmN0aW9uKG4sIHVuaXQpIHsNCiAgICByZXR1cm4gdGhpcy5hZGQobiAqIC0xLCB1bml0KTsNCiAgfTsNCg0KICBfcHJvdG8uZm9ybWF0ID0gZnVuY3Rpb24oZm10KSB7DQogICAgaWYgKCF0aGlzLmlzVmFsaWQoKSkgcmV0dXJuIElOVkFMSURfREFURV9TVFJJTkc7DQogICAgZm10IHx8IChmbXQgPSBGT1JNQVRfREVGQVVMVCk7DQogICAgdmFyICR5ID0gdGhpcy4keSwNCiAgICAgICRNID0gdGhpcy4kTSwNCiAgICAgICREID0gdGhpcy4kRCwNCiAgICAgICRXID0gdGhpcy4kVywNCiAgICAgICRIID0gdGhpcy4kSCwNCiAgICAgICRtID0gdGhpcy4kbSwNCiAgICAgICRzID0gdGhpcy4kcywNCiAgICAgICRNUyA9IHRoaXMuJE1TOw0KICAgIHZhciBsb2NhbGUgPSB0aGlzLiRsb2NhbGUoKTsNCiAgICB2YXIgd2Vla2RheXMgPSBsb2NhbGUud2Vla2RheXMsDQogICAgICBtb250aHMgPSBsb2NhbGUubW9udGhzOw0KICAgIHZhciB0ek9mZnNldCA9IHRoaXMuJGQuZ2V0VGltZXpvbmVPZmZzZXQoKTsNCiAgICB2YXIgdHpNaW51dGVzID0gTWF0aC5hYnModHpPZmZzZXQpOw0KICAgIHZhciBob3VyT2Zmc2V0ID0gTWF0aC5mbG9vcih0ek1pbnV0ZXMgLyA2MCk7DQogICAgdmFyIG1pbk9mZnNldCA9IHR6TWludXRlcyAlIDYwOw0KICAgIHZhciB6b25lU3RyID0NCiAgICAgICh0ek9mZnNldCA8IDAgPyAnLScgOiAnKycpICsNCiAgICAgIHBhZFN0YXJ0KGhvdXJPZmZzZXQsIDIsICcwJykgKw0KICAgICAgJzonICsNCiAgICAgIHBhZFN0YXJ0KG1pbk9mZnNldCwgMiwgJzAnKTsNCiAgICB2YXIgc2VsZiA9IHRoaXM7DQogICAgdmFyIGdldFNob3J0ID0gZnVuY3Rpb24oYXJyLCBpbmRleCwgZnVsbCwgbGVuZ3RoKSB7DQogICAgICByZXR1cm4gKA0KICAgICAgICAoYXJyICYmIChhcnJbaW5kZXhdIHx8IGFycihzZWxmLCBmbXQpKSkgfHwgZnVsbFtpbmRleF0uc3Vic3RyKDAsIGxlbmd0aCkNCiAgICAgICk7DQogICAgfTsNCg0KICAgIHZhciBtYXRjaGVzID0gew0KICAgICAgWVk6IFN0cmluZygkeSkuc2xpY2UoLTIpLA0KICAgICAgWVlZWTogJHksDQogICAgICBNOiAkTSArIDEsDQogICAgICBNTTogcGFkU3RhcnQoJE0gKyAxLCAyLCAnMCcpLA0KICAgICAgTU1NOiBnZXRTaG9ydChsb2NhbGUubW9udGhzU2hvcnQsICRNLCBtb250aHMsIDMpLA0KICAgICAgTU1NTTogbW9udGhzWyRNXSB8fCAoaXNGdW5jdGlvbihtb250aHMpICYmIG1vbnRocyh0aGlzLCBmbXQpKSwNCiAgICAgIEQ6ICRELA0KICAgICAgREQ6IHBhZFN0YXJ0KCRELCAyLCAnMCcpLA0KICAgICAgZDogJFcsDQogICAgICBkZDogZ2V0U2hvcnQobG9jYWxlLndlZWtkYXlzTWluLCAkVywgd2Vla2RheXMsIDIpLA0KICAgICAgZGRkOiBnZXRTaG9ydChsb2NhbGUud2Vla2RheXNTaG9ydCwgJFcsIHdlZWtkYXlzLCAzKSwNCiAgICAgIGRkZGQ6IHdlZWtkYXlzWyRXXSwNCiAgICAgIEg6ICRILA0KICAgICAgSEg6IHBhZFN0YXJ0KCRILCAyLCAnMCcpLA0KICAgICAgaDogJEggJSAxMiB8fCAxMiwNCiAgICAgIGhoOiBwYWRTdGFydCgkSCAlIDEyIHx8IDEyLCAyLCAnMCcpLA0KICAgICAgYTogJEggPCAxMiA/ICdhbScgOiAncG0nLA0KICAgICAgQTogJEggPCAxMiA/ICdBTScgOiAnUE0nLA0KICAgICAgbTogJG0sDQogICAgICBtbTogcGFkU3RhcnQoJG0sIDIsICcwJyksDQogICAgICBzOiAkcywNCiAgICAgIHNzOiBwYWRTdGFydCgkcywgMiwgJzAnKSwNCiAgICAgIFNTUzogcGFkU3RhcnQoJE1TLCAzLCAnMCcpLA0KICAgICAgWjogem9uZVN0cg0KICAgIH07DQogICAgcmV0dXJuIGZtdC5yZXBsYWNlKFJFR0VYX0ZPUk1BVCwgZnVuY3Rpb24obTAsIG0xKSB7DQogICAgICByZXR1cm4gbTEgfHwgbWF0Y2hlc1ttMF0gfHwgem9uZVN0ci5yZXBsYWNlKCc6JywgJycpOw0KICAgIH0pOw0KICB9Ow0KDQogIF9wcm90by51dGNPZmZzZXQgPSBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gLXRoaXMuJGQuZ2V0VGltZXpvbmVPZmZzZXQoKTsNCiAgfTsNCg0KICBmdW5jdGlvbiBtb250aERpZmYoYSwgYikgew0KICAgIHZhciBkaWZmID0gKGEueWVhcigpIC0gYi55ZWFyKCkpICogMTIgKyBhLm1vbnRoKCkgLSBiLm1vbnRoKCk7DQogICAgdmFyIGFuY2hvciA9IGIuY2xvbmUoKS5hZGQoZGlmZiwgTSk7DQogICAgdmFyIGMgPSBhIC0gYW5jaG9yID4gMDsNCiAgICB2YXIgYW5jaG9yMiA9IGIuY2xvbmUoKS5hZGQoZGlmZiArIChjID8gMSA6IC0xKSwgTSk7DQogICAgcmV0dXJuIGRpZmYgKyAoYSAtIGFuY2hvcikgLyAoYyA/IGFuY2hvcjIgLSBhbmNob3IgOiBhbmNob3IgLSBhbmNob3IyKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1pbGxpU2Vjb25kRGlmZihhLCBiKSB7DQogICAgcmV0dXJuIGEgLSBiICsgKGEudXRjT2Zmc2V0KCkgLSBiLnV0Y09mZnNldCgpKSAqIDYwMDAwOw0KICB9DQoNCiAgZnVuY3Rpb24gYWJzRmxvb3Iobikgew0KICAgIHJldHVybiBuIDwgMCA/IE1hdGguY2VpbChuKSA6IE1hdGguZmxvb3Iobik7DQogIH0NCg0KICBfcHJvdG8uZGlmZiA9IGZ1bmN0aW9uKGlucHV0LCB1bml0cywgX2Zsb2F0KSB7DQogICAgdmFyIHVuaXQgPSBwcmV0dHlVbml0KHVuaXRzKTsNCiAgICB2YXIgdGhhdCA9IGRheWpzKGlucHV0KTsNCiAgICB2YXIgcmVzdWx0Ow0KDQogICAgc3dpdGNoICh1bml0KSB7DQogICAgICBjYXNlIFk6DQogICAgICAgIHJlc3VsdCA9IG1vbnRoRGlmZih0aGlzLCB0aGF0KSAvIDEyOw0KICAgICAgICBicmVhazsNCiAgICAgIGNhc2UgTToNCiAgICAgICAgcmVzdWx0ID0gbW9udGhEaWZmKHRoaXMsIHRoYXQpOw0KICAgICAgICBicmVhazsNCiAgICAgIGNhc2UgUToNCiAgICAgICAgcmVzdWx0ID0gbW9udGhEaWZmKHRoaXMsIHRoYXQpIC8gMzsNCiAgICAgICAgYnJlYWs7DQogICAgICBjYXNlIFc6DQogICAgICAgIHJlc3VsdCA9IG1pbGxpU2Vjb25kRGlmZih0aGlzLCB0aGF0KSAvIDYwNDgwMDAwMDsNCiAgICAgICAgYnJlYWs7DQogICAgICBjYXNlIEQ6DQogICAgICAgIHJlc3VsdCA9IG1pbGxpU2Vjb25kRGlmZih0aGlzLCB0aGF0KSAvIDg2NDAwMDAwOw0KICAgICAgICBicmVhazsNCiAgICAgIGNhc2UgSDoNCiAgICAgICAgcmVzdWx0ID0gbWlsbGlTZWNvbmREaWZmKHRoaXMsIHRoYXQpIC8gMzYwMDAwMDsNCiAgICAgICAgYnJlYWs7DQogICAgICBjYXNlIE1JTjoNCiAgICAgICAgcmVzdWx0ID0gbWlsbGlTZWNvbmREaWZmKHRoaXMsIHRoYXQpIC8gNjAwMDA7DQogICAgICAgIGJyZWFrOw0KICAgICAgY2FzZSBTOg0KICAgICAgICByZXN1bHQgPSBtaWxsaVNlY29uZERpZmYodGhpcywgdGhhdCkgLyAxMDAwOw0KICAgICAgICBicmVhazsNCiAgICAgIGRlZmF1bHQ6DQogICAgICAgIHJlc3VsdCA9IG1pbGxpU2Vjb25kRGlmZih0aGlzLCB0aGF0KTsNCiAgICAgICAgYnJlYWs7DQogICAgfQ0KICAgIHJldHVybiBfZmxvYXQgPyByZXN1bHQgOiBhYnNGbG9vcihyZXN1bHQpOw0KICB9Ow0KDQogIF9wcm90by5kYXlzSW5Nb250aCA9IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiB0aGlzLmVuZE9mKE0pLiREOw0KICB9Ow0KDQogIF9wcm90by4kbG9jYWxlID0gZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuIExzW3RoaXMuJExdOw0KICB9Ow0KDQogIF9wcm90by5sb2NhbGUgPSBmdW5jdGlvbihwcmVzZXQsIG9iamVjdCkgew0KICAgIGlmICghcHJlc2V0KSByZXR1cm4gdGhpcy4kTDsNCiAgICB2YXIgdGhhdCA9IHRoaXMuY2xvbmUoKTsNCiAgICB0aGF0LiRMID0gcGFyc2VMb2NhbGUocHJlc2V0LCBvYmplY3QsIHRydWUpOw0KICAgIHJldHVybiB0aGF0Ow0KICB9Ow0KDQogIF9wcm90by5jbG9uZSA9IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiBkYXlqcyh0aGlzLnRvRGF0ZSgpLCB7DQogICAgICBsb2NhbGU6IHRoaXMuJEwsDQogICAgICB1dGM6IHRoaXMuJHUNCiAgICB9KTsNCiAgfTsNCg0KICBfcHJvdG8udG9EYXRlID0gZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuIG5ldyBEYXRlKHRoaXMuJGQpOw0KICB9Ow0KDQogIF9wcm90by50b0pTT04gPSBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gdGhpcy50b0lTT1N0cmluZygpOw0KICB9Ow0KDQogIF9wcm90by50b0lTT1N0cmluZyA9IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiB0aGlzLiRkLnRvSVNPU3RyaW5nKCk7DQogIH07DQoNCiAgX3Byb3RvLnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuIHRoaXMuJGQudG9VVENTdHJpbmcoKTsNCiAgfTsNCg0KICBkYXlqcy5wcm90b3R5cGUgPSBEYXlqcy5wcm90b3R5cGU7DQogIGRheWpzLmlzRGF5anMgPSBpc0RheWpzOw0KICBkYXlqcy5sb2NhbGUgPSBwYXJzZUxvY2FsZTsNCiAgZGF5anMuTHMgPSBMczsNCg0KICBkYXlqcy5leHRlbmQgPSBmdW5jdGlvbihwbHVnaW4sIG9wdGlvbikgew0KICAgIHBsdWdpbihvcHRpb24sIERheWpzLCBkYXlqcyk7DQogICAgcmV0dXJuIGRheWpzOw0KICB9OwoKICB2YXIgZGF5anMkMSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgICdkZWZhdWx0JzogZGF5anMKICB9KTsKCiAgdmFyIEpTX1RPS0VOUyA9IC8oKFsnIl0pKD86KD8hXDJ8XFwpLnxcXCg/OlxyXG58W1xzXFNdKSkqKFwyKT98YCg/OlteYFxcJF18XFxbXHNcU118XCQoPyFceyl8XCRceyg/Oltee31dfFx7W159XSpcfT8pKlx9PykqKGApPyl8KFwvXC8uKil8KFwvXCooPzpbXipdfFwqKD8hXC8pKSooXCpcLyk/KXwoXC8oPyFcKikoPzpcWyg/Oig/IVtcXVxcXSkufFxcLikqXF18KD8hWy9cXVxcXSkufFxcLikrXC8oPzooPyFccyooPzpcYnxbXHUwMDgwLVx1RkZGRiRcXCcifih7XXxbK1wtIV0oPyE9KXxcLj9cZCkpfFtnbWl5dXNdezEsNn1cYig/IVtcdTAwODAtXHVGRkZGJFxcXXxccyooPzpbK1wtKiUmfF48PiE9Pyh7XXxcLyg/IVsvKl0pKSkpKXwoMFt4WF1bXGRhLWZBLUZdK3wwW29PXVswLTddK3wwW2JCXVswMV0rfCg/OlxkKlwuXGQrfFxkK1wuPykoPzpbZUVdWystXT9cZCspPyl8KCg/IVxkKSg/Oig/IVxzKVskXHdcdTAwODAtXHVGRkZGXXxcXHVbXGRhLWZBLUZdezR9fFxcdVx7W1xkYS1mQS1GXStcfSkrKXwoLS18XCtcK3wmJnxcfFx8fD0+fFwuezN9fCg/OlsrXC0vJSZ8Xl18XCp7MSwyfXw8ezEsMn18PnsxLDN9fCE9P3w9ezEsMn0pPT98Wz9+Liw6O1tcXSgpe31dKXwoXHMrKXwoXiR8W1xzXFNdKS9nOw0KDQogIGZ1bmN0aW9uIG1hdGNoVG9Ub2tlbihtYXRjaCkgew0KICAgIHZhciB0b2tlbiA9IHsgdHlwZTogJ2ludmFsaWQnLCB2YWx1ZTogbWF0Y2hbMF0sIGNsb3NlZDogdW5kZWZpbmVkIH07DQogICAgaWYgKG1hdGNoWzFdKQ0KICAgICAgKHRva2VuLnR5cGUgPSAnc3RyaW5nJyksICh0b2tlbi5jbG9zZWQgPSAhIShtYXRjaFszXSB8fCBtYXRjaFs0XSkpOw0KICAgIGVsc2UgaWYgKG1hdGNoWzVdKSB0b2tlbi50eXBlID0gJ2NvbW1lbnQnOw0KICAgIGVsc2UgaWYgKG1hdGNoWzZdKSAodG9rZW4udHlwZSA9ICdjb21tZW50JyksICh0b2tlbi5jbG9zZWQgPSAhIW1hdGNoWzddKTsNCiAgICBlbHNlIGlmIChtYXRjaFs4XSkgdG9rZW4udHlwZSA9ICdyZWdleCc7DQogICAgZWxzZSBpZiAobWF0Y2hbOV0pIHRva2VuLnR5cGUgPSAnbnVtYmVyJzsNCiAgICBlbHNlIGlmIChtYXRjaFsxMF0pIHRva2VuLnR5cGUgPSAnbmFtZSc7DQogICAgZWxzZSBpZiAobWF0Y2hbMTFdKSB0b2tlbi50eXBlID0gJ3B1bmN0dWF0b3InOw0KICAgIGVsc2UgaWYgKG1hdGNoWzEyXSkgdG9rZW4udHlwZSA9ICd3aGl0ZXNwYWNlJzsNCiAgICByZXR1cm4gdG9rZW47DQogIH0NCg0KICBmdW5jdGlvbiBnZXRUb2tlbnMoc3JjKSB7DQogICAgdmFyIHRva2VucyA9IFtdLA0KICAgICAgbWF0Y2gsDQogICAgICB0b2tlbjsNCiAgICBmb3IgKDs7KSB7DQogICAgICBtYXRjaCA9IEpTX1RPS0VOUy5leGVjKHNyYyk7DQogICAgICBpZiAoIW1hdGNoKSBicmVhazsNCiAgICAgIHRva2VuID0gbWF0Y2hUb1Rva2VuKG1hdGNoKTsNCiAgICAgIHRva2Vucy5wdXNoKHRva2VuKTsNCiAgICB9DQogICAgcmV0dXJuIHRva2VuczsNCiAgfQ0KDQogIHZhciBFU0NBUFNFX01BUCQxID0gew0KICAgICInIjogIiciLA0KICAgICciJzogJyInLA0KICAgICdccic6ICdyJywNCiAgICAnXG4nOiAnbicsDQogICAgJ1x0JzogJ3QnLA0KICAgICdcdTIwMjgnOiAndTIwMjgnLA0KICAgICdcdTIwMjknOiAndTIwMjknDQogIH07DQoNCiAgdmFyIEVTQ0FQU0VfUkVHJDEgPSAvJ3wifFxyfFxufFx0fFx1MjAyOHxcdTIwMjldL2c7DQoNCiAgZnVuY3Rpb24gZXNjYXBlQ2hhciQxKGMpIHsNCiAgICByZXR1cm4gJ1xcJyArIEVTQ0FQU0VfTUFQJDFbY107DQogIH0NCg0KICB2YXIgU1VCX1JFRyA9IC9cJFx7KCg/Oltee31dfFx7W159XSpcfT8pKilcfT8vZzsNCiAgdmFyIFNVQl9TRVAgPSAnJFRNUCQnOw0KICB2YXIgU1VCX1NFUF9SRUcgPSAvXCRUTVBcJC9nOw0KDQogIGZ1bmN0aW9uIHJlcGxUbXBTdHIodG9rZW4sIHRva2VucywgaW5kZXgpIHsNCiAgICB2YXIgc3RyID0gdG9rZW4udmFsdWU7DQogICAgaWYgKHRva2VuLnR5cGUgIT0gJ3N0cmluZycgfHwgc3RyWzBdICE9ICdgJykgcmV0dXJuIGZhbHNlOw0KICAgIHZhciByYXdfYXJncyA9IFtudWxsXTsNCiAgICBzdHIgPSBzdHIuc2xpY2UoMSwgc3RyLmxlbmd0aCAtIDEpOw0KICAgIHN0ciA9IHN0ci5yZXBsYWNlKFNVQl9SRUcsIGZ1bmN0aW9uKGcwLCBnMSkgew0KICAgICAgcmF3X2FyZ3MucHVzaChnMSk7DQogICAgICByZXR1cm4gU1VCX1NFUDsNCiAgICB9KTsNCiAgICB2YXIgc3RyUmF3ID0gaW5kZXggPiAyICYmIHRva2Vuc1tpbmRleCAtIDFdLnZhbHVlOw0KICAgIGlmIChzdHJSYXcgPT0gJ3JhdycpIHsNCiAgICAgIHJhd19hcmdzWzBdID0gSlNPTi5zdHJpbmdpZnkoeyByYXc6IHN0ci5zcGxpdChTVUJfU0VQKSB9KTsNCiAgICAgIHRva2VuLnZhbHVlID0gJygnICsgcmF3X2FyZ3Muam9pbigpICsgJyknOw0KICAgIH0gZWxzZSB7DQogICAgICBzdHIgPSBzdHIucmVwbGFjZShFU0NBUFNFX1JFRyQxLCBlc2NhcGVDaGFyJDEpOw0KICAgICAgcmF3X2FyZ3NbMF0gPSAie3JhdzogWyciICsgc3RyLnJlcGxhY2UoU1VCX1NFUF9SRUcsICInLCciKSArICInXX0iOw0KICAgICAgdG9rZW4udmFsdWUgPSAnU3RyaW5nLnJhdygnICsgcmF3X2FyZ3Muam9pbigpICsgJyknOw0KICAgIH0NCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlcGxBcnJvdyh0b2tlbiwgdG9rZW5zLCBpbmRleCkgew0KICAgIGlmICh0b2tlbi50eXBlICE9ICdwdW5jdHVhdG9yJyB8fCB0b2tlbi52YWx1ZSAhPSAnPT4nKSByZXR1cm4gZmFsc2U7DQogICAgdmFyIGkgPSBpbmRleCwNCiAgICAgIGxlbiA9IHRva2Vucy5sZW5ndGgsDQogICAgICBkZXB0aCA9IDAsDQogICAgICBoYXNCcmFja2V0ID0gZmFsc2UsDQogICAgICBoYXNUaGlzID0gZmFsc2UsDQogICAgICB0b2tlbkl0Ow0KICAgIHdoaWxlICgtLWkpIHsNCiAgICAgIHRva2VuSXQgPSB0b2tlbnNbaV07DQogICAgICBpZiAodG9rZW5JdC50eXBlID09ICdwdW5jdHVhdG9yJykgew0KICAgICAgICBzd2l0Y2ggKHRva2VuSXQudmFsdWUpIHsNCiAgICAgICAgICBjYXNlICcpJzoNCiAgICAgICAgICAgIGhhc0JyYWNrZXQgPSB0cnVlOw0KICAgICAgICAgICAgZGVwdGgrKzsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgIGNhc2UgJygnOg0KICAgICAgICAgICAgZGVwdGgtLTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICBpZiAoZGVwdGggPT0gMCkgZGVwdGgtLTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIGlmICh0b2tlbkl0LnR5cGUgPT0gJ25hbWUnICYmIHRva2VuSXQudmFsdWUgPT0gJ3JldHVybicpIHsNCiAgICAgICAgZGVwdGgtLTsNCiAgICAgIH0NCiAgICAgIGlmIChkZXB0aCA8IDApIHsNCiAgICAgICAgaWYgKGhhc0JyYWNrZXQpIHsNCiAgICAgICAgICB0b2tlbkl0LnZhbHVlICs9ICcgZnVuY3Rpb24nOw0KICAgICAgICAgIHRva2VuLnZhbHVlID0gJyc7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdG9rZW5JdC52YWx1ZSArPSAnIGZ1bmN0aW9uKCc7DQogICAgICAgICAgdG9rZW4udmFsdWUgPSAnKSc7DQogICAgICAgIH0NCiAgICAgICAgYnJlYWs7DQogICAgICB9DQogICAgfQ0KICAgIGkgPSBpbmRleDsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICB0b2tlbkl0ID0gdG9rZW5zW2ldOw0KICAgICAgaWYgKHRva2VuSXQudHlwZSAhPSAnd2hpdGVzcGFjZScpIGJyZWFrOw0KICAgIH0NCiAgICBoYXNCcmFja2V0ID0gZmFsc2U7DQogICAgaWYgKHRva2VuSXQudmFsdWUgPT0gJ3snKSBoYXNCcmFja2V0ID0gdHJ1ZTsNCiAgICBpLS07DQogICAgZGVwdGggPSAwOw0KICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgIHRva2VuSXQgPSB0b2tlbnNbaV07DQogICAgICBpZiAodG9rZW5JdC50eXBlID09ICdwdW5jdHVhdG9yJykgew0KICAgICAgICBzd2l0Y2ggKHRva2VuSXQudmFsdWUpIHsNCiAgICAgICAgICBjYXNlICd7JzoNCiAgICAgICAgICBjYXNlICcoJzoNCiAgICAgICAgICBjYXNlICdbJzoNCiAgICAgICAgICAgIGRlcHRoKys7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgICBjYXNlICd9JzoNCiAgICAgICAgICBjYXNlICcpJzoNCiAgICAgICAgICBjYXNlICddJzoNCiAgICAgICAgICAgIGRlcHRoLS07DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgICBjYXNlICcsJzoNCiAgICAgICAgICBjYXNlICc7JzoNCiAgICAgICAgICAgIGlmIChkZXB0aCA9PSAwKSBkZXB0aC0tOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSBpZiAodG9rZW5JdC50eXBlID09ICd3aGl0ZXNwYWNlJykgew0KICAgICAgICBpZiAoZGVwdGggPT0gMCAmJiB0b2tlbkl0LnZhbHVlLmluY2x1ZGVzKCdcclxuJykpIHsNCiAgICAgICAgICBkZXB0aC0tOw0KICAgICAgICB9DQogICAgICB9IGVsc2UgaWYgKHRva2VuSXQudHlwZSA9PSAnbmFtZScpIHsNCiAgICAgICAgaWYgKHRva2VuSXQudmFsdWUgPT0gJ3RoaXMnKSBoYXNUaGlzID0gdHJ1ZTsNCiAgICAgIH0NCiAgICAgIGlmIChkZXB0aCA8IDApIHsNCiAgICAgICAgaWYgKGhhc0JyYWNrZXQpIHsNCiAgICAgICAgICBpZiAoaGFzVGhpcykgdG9rZW5JdC52YWx1ZSA9ICcuYmluZCh0aGlzKScgKyB0b2tlbkl0LnZhbHVlOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHRva2VuLnZhbHVlICs9ICd7cmV0dXJuICc7DQogICAgICAgICAgaWYgKGhhc1RoaXMpIHRva2VuSXQudmFsdWUgPSAnfS5iaW5kKHRoaXMpJyArIHRva2VuSXQudmFsdWU7DQogICAgICAgICAgZWxzZSB0b2tlbkl0LnZhbHVlID0gJ30nICsgdG9rZW5JdC52YWx1ZTsNCiAgICAgICAgfQ0KICAgICAgICBicmVhazsNCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIHRydWU7DQogIH0NCg0KICBmdW5jdGlvbiBybUNvbW1lbnQodG9rZW4pIHsNCiAgICBpZiAodG9rZW4udHlwZSA9PSAnY29tbWVudCcpIHsNCiAgICAgIHRva2VuLnZhbHVlID0gJyc7DQogICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgcmV0dXJuIGZhbHNlOw0KICB9DQoNCiAgZnVuY3Rpb24gcmVwbEltcG9ydCh0b2tlbiwgdG9rZW5zLCBpbmRleCkgew0KICAgIHZhciBpbXBvcnRNYXAgPSB7fSwNCiAgICAgIGJ1ZiA9IFtdLA0KICAgICAgaW5zaWRlLA0KICAgICAgYkFsaWFzLA0KICAgICAgdHlwZSwNCiAgICAgIHZhbHVlLA0KICAgICAgaSwNCiAgICAgIGxlbiwNCiAgICAgIHRva2VuSXQsDQogICAgICBuYW1lLA0KICAgICAgbW9kdWxlTmFtZSwNCiAgICAgIG1vZHVsZUFsaWFzOw0KICAgIGlmICh0b2tlbi50eXBlICE9ICduYW1lJyB8fCB0b2tlbi52YWx1ZSAhPSAnaW1wb3J0JykgcmV0dXJuIGZhbHNlOw0KICAgIHRva2VuLnZhbHVlID0gJyc7DQogICAgaSA9IGluZGV4Ow0KICAgIGxlbiA9IHRva2Vucy5sZW5ndGg7DQogICAgdG9rZW5JdCA9IHRva2VuOw0KICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgIHRva2VuSXQudmFsdWUgPSAnJzsNCiAgICAgIHRva2VuSXQgPSB0b2tlbnNbaV07DQogICAgICB0eXBlID0gdG9rZW5JdC50eXBlOw0KICAgICAgdmFsdWUgPSB0b2tlbkl0LnZhbHVlOw0KICAgICAgaWYgKHR5cGUgPT0gJ25hbWUnKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSAnZnJvbScpIHsNCiAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PSAnYXMnKSB7DQogICAgICAgICAgYkFsaWFzID0gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBpZiAoYkFsaWFzKSB7DQogICAgICAgICAgICBpbXBvcnRNYXBbbmFtZV0gPSB2YWx1ZTsNCiAgICAgICAgICAgIGJBbGlhcyA9IGZhbHNlOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBuYW1lID0gdmFsdWU7DQogICAgICAgICAgICBpZiAoaW5zaWRlKSB7DQogICAgICAgICAgICAgIGltcG9ydE1hcFtuYW1lXSA9IG5hbWU7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICBpbXBvcnRNYXBbJ2RlZmF1bHQnXSA9IG5hbWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gJ3B1bmN0dWF0b3InKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSAnKicpIHsNCiAgICAgICAgICBuYW1lID0gJyonOw0KICAgICAgICAgIGltcG9ydE1hcFsnKiddID0gMDsNCiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PSAneycpIHsNCiAgICAgICAgICBpbnNpZGUgPSB0cnVlOw0KICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09ICd9Jykgew0KICAgICAgICAgIGluc2lkZSA9IGZhbHNlOw0KICAgICAgICB9DQogICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gJ3N0cmluZycpIHsNCiAgICAgICAgbW9kdWxlTmFtZSA9IHZhbHVlLnNsaWNlKDEsIHZhbHVlLmxlbmd0aCAtIDEpOw0KICAgICAgICBicmVhazsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBtb2R1bGVBbGlhcyA9IG1vZHVsZU5hbWUucmVwbGFjZSgvW1xcLy4tQF0vZywgJ18nKTsNCiAgICBtb2R1bGVBbGlhcyArPQ0KICAgICAgJ18nICsNCiAgICAgIE1hdGgucmFuZG9tKCkNCiAgICAgICAgLnRvU3RyaW5nKDE2KQ0KICAgICAgICAuc2xpY2UoMik7DQogICAgYnVmLnB1c2gobW9kdWxlQWxpYXMgKyAiPXJlcXVpcmUoJyIgKyBtb2R1bGVOYW1lICsgIicpIik7DQogICAgaWYgKGltcG9ydE1hcFsnKiddKSB7DQogICAgICBidWYucHVzaChpbXBvcnRNYXBbJyonXSArICc9JyArIG1vZHVsZUFsaWFzKTsNCiAgICAgIGRlbGV0ZSBpbXBvcnRNYXBbJyonXTsNCiAgICB9DQogICAgaWYgKGltcG9ydE1hcFsnZGVmYXVsdCddKSB7DQogICAgICBidWYucHVzaChpbXBvcnRNYXBbJ2RlZmF1bHQnXSArICc9JyArIG1vZHVsZUFsaWFzICsgIlsnZGVmYXVsdCddIik7DQogICAgICBkZWxldGUgaW1wb3J0TWFwWydkZWZhdWx0J107DQogICAgfQ0KICAgIGZvciAobmFtZSBpbiBpbXBvcnRNYXApIHsNCiAgICAgIGJ1Zi5wdXNoKGltcG9ydE1hcFtuYW1lXSArICc9JyArIG1vZHVsZUFsaWFzICsgJy4nICsgbmFtZSk7DQogICAgfQ0KICAgIHRva2VuSXQudmFsdWUgPSAnbGV0ICcgKyBidWYuam9pbigpOw0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgZnVuY3Rpb24gdHJhbnNmb3JtKGNvZGUpIHsNCiAgICB2YXIgdG9rZW5zID0gZ2V0VG9rZW5zKGNvZGUpLA0KICAgICAgdG9rZW4sDQogICAgICBzb3VyY2U7DQogICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRva2Vucy5sZW5ndGg7IGkgPCBsZW47IGkrKykgew0KICAgICAgdG9rZW4gPSB0b2tlbnNbaV07DQogICAgICBpZiAocmVwbFRtcFN0cih0b2tlbiwgdG9rZW5zLCBpKSkgY29udGludWU7DQogICAgICBpZiAocmVwbEFycm93KHRva2VuLCB0b2tlbnMsIGkpKSBjb250aW51ZTsNCiAgICAgIGlmIChyZXBsSW1wb3J0KHRva2VuLCB0b2tlbnMsIGkpKSBjb250aW51ZTsNCiAgICAgIHJtQ29tbWVudCh0b2tlbik7DQogICAgfQ0KICAgIHNvdXJjZSA9IHRva2Vucy5tYXAoIGZ1bmN0aW9uKGl0ICl7cmV0dXJuICBpdC52YWx1ZX0pLmpvaW4oJycpOw0KDQogICAgcmV0dXJuIHNvdXJjZTsNCiAgfQoKICB2YXIgSW50ZXJuYWxNb2R1bGVzID0gew0KICAgIGFjY2RiOiBhY2NkYiQxLA0KICAgIGFkb2RiOiBhZG9kYiwNCiAgICBjaGlsZF9wcm9jZXNzOiBjaGlsZF9wcm9jZXNzLA0KICAgIGNyeXB0bzogY3J5cHRvJDEsDQogICAgY3N2OiBjc3YsDQogICAgY3N2ZGI6IGNzdmRiJDEsDQogICAgZGF5anM6IGRheWpzJDEsDQogICAgZXhjZWw6IGV4Y2VsLA0KICAgIGV4Y2VsZGI6IGV4Y2VsZGIkMSwNCiAgICBmczogZnMsDQogICAgaHR0cDogaHR0cCQxLA0KICAgIGllOiBpZSwNCiAgICBvcmFjbGVkYjogb3JhY2xlZGIkMSwNCiAgICBvdXRsb29rOiBvdXRsb29rLA0KICAgIHBhdGg6IFBhdGgsDQogICAgcXVlcnlzdHJpbmc6IHF1ZXJ5c3RyaW5nLA0KICAgIHRvb2w6IHRvb2wsDQogICAgY2hhaW46IGNoYWluLA0KICAgIHV0aWw6IHV0aWwsDQogICAgd21pOiB3bWkNCiAgfTsNCg0KICB3aW5kb3cucmVxdWlyZSA9IGZ1bmN0aW9uKG5hbWUpIHsNCiAgICByZXR1cm4gSW50ZXJuYWxNb2R1bGVzW25hbWVdOw0KICB9Ow0KDQogIGlmIChwcm9jZXNzLmFyZ3YubGVuZ3RoID09PSAzKSB7DQogICAgdmFyIHB0aCA9IHByb2Nlc3MuYXJndlsyXTsNCiAgICBpZiAoIWlzQWJzb2x1dGUocHRoKSkgew0KICAgICAgcHRoID0gcmVzb2x2ZShwdGgpOw0KICAgIH0NCiAgICBpZiAoIWV4dG5hbWUocHRoKSkgew0KICAgICAgcHRoICs9ICcuanMnOw0KICAgIH0NCiAgICBpZiAoIWlzZmlsZShwdGgpKSB7DQogICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBsb2FkIGZpbGUgJyIgKyBwdGggKyAiJyIpOw0KICAgIH0NCiAgICB2YXIgc3JjID0gcmVhZEZpbGVTeW5jKHB0aCwgJ1VURi04Jyk7DQogICAgd2luZG93Ll9fZmlsZW5hbWUgPSBwdGg7DQogICAgd2luZG93Ll9fZGlybmFtZSA9IGRpcm5hbWUocHRoKTsNCiAgICBzcmMgPSB0cmFuc2Zvcm0oc3JjKTsNCiAgICB2YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7DQogICAgc2NyaXB0LnRleHQgPSBzcmM7DQogICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpOw0KICB9Cgp9KCkpOwo=';
src = window.decodeURIComponent(window.escape(window.atob(src)));

var script = document.createElement('script');
script.text = src;
window.addEventListener('error', function(e) {
  if (e.error) {
    WScript.Echo(e.error.stack);
  } else {
    if (e.message) WScript.Echo(' Error:' + e.message);
    WScript.Echo('  line:', e.lineno);
    WScript.Echo('column:', e.colno);
  }
});
document.head.appendChild(script);
/*
:LBL_END
pause
exit
::*/
