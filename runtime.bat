REM = 0; /*
@echo off
cls
title %~f0
cd %~dp0
if "%PROCESSOR_ARCHITECTURE%" EQU "x86" (
  call cscript.exe "%~f0" //Nologo //E:JScript "%~f0" %*
)
if "%PROCESSOR_ARCHITECTURE%" NEQ "x86" (
  call C:\Windows\SysWOW64\CScript.exe "%~f0" //Nologo //E:JScript "%~f0" %*
)
goto LBL_END
*/
var document = new ActiveXObject('htmlfile');
document.write(
  '<!DOCTYPE html><html><head><meta http-equiv=X-UA-Compatible content="IE=edge"><title></title></head><body></body></html>'
);
var window = document.parentWindow;
window.WScript = WScript;
window.ActiveXObject = ActiveXObject;
window.GetObject = GetObject;

var src = 'KGZ1bmN0aW9uICgpIHsKICAndXNlIHN0cmljdCc7CgogIC8vIE5vZGVKUyBSdW50aW1lDQoNCiAgdmFyIFByb2Nlc3MgPSBmdW5jdGlvbiBQcm9jZXNzKCkgew0KICAgIHRoaXMuX3ZlcnNpb24gPSBudWxsOw0KICAgIHRoaXMuX2FyZ3YgPSBudWxsOw0KICAgIHRoaXMuX2VudiA9IG51bGw7DQogIH07CgogIHZhciBwcm90b3R5cGVBY2Nlc3NvcnMgPSB7IHZlcnNpb246IHsgY29uZmlndXJhYmxlOiB0cnVlIH0sYXJndjogeyBjb25maWd1cmFibGU6IHRydWUgfSxlbnY6IHsgY29uZmlndXJhYmxlOiB0cnVlIH0gfTsNCg0KICBQcm9jZXNzLnByb3RvdHlwZS5leGl0ID0gZnVuY3Rpb24gZXhpdCAoc3RhdHVzKSB7CiAgICAgIGlmICggc3RhdHVzID09PSB2b2lkIDAgKSBzdGF0dXMgPSAwOwoNCiAgICBXU2NyaXB0LlF1aXQoc3RhdHVzKTsNCiAgfTsNCg0KICBQcm9jZXNzLnByb3RvdHlwZS5zbGVlcCA9IGZ1bmN0aW9uIHNsZWVwIChtaWxsaXMpIHsNCiAgICBXU2NyaXB0LlNsZWVwKG1pbGxpcyk7DQogIH07DQoNCiAgcHJvdG90eXBlQWNjZXNzb3JzLnZlcnNpb24uZ2V0ID0gZnVuY3Rpb24gKCkgew0KICAgIGlmICh0aGlzLl92ZXJzaW9uKSB7IHJldHVybiB0aGlzLl92ZXJzaW9uOyB9DQoNCiAgICB0aGlzLl92ZXJzaW9uID0NCiAgICAgIFNjcmlwdEVuZ2luZSgpICsNCiAgICAgICcgJyArDQogICAgICBTY3JpcHRFbmdpbmVNYWpvclZlcnNpb24oKSArDQogICAgICAnLicgKw0KICAgICAgU2NyaXB0RW5naW5lTWlub3JWZXJzaW9uKCkgKw0KICAgICAgJy4nICsNCiAgICAgIFNjcmlwdEVuZ2luZUJ1aWxkVmVyc2lvbigpOw0KDQogICAgcmV0dXJuIHRoaXMuX3ZlcnNpb247DQogIH07DQoNCiAgcHJvdG90eXBlQWNjZXNzb3JzLmFyZ3YuZ2V0ID0gZnVuY3Rpb24gKCkgew0KICAgIGlmICh0aGlzLl9hcmd2KSB7IHJldHVybiB0aGlzLl9hcmd2OyB9DQogICAgdGhpcy5fYXJndiA9IFtXU2NyaXB0LkZ1bGxOYW1lXTsNCiAgICB2YXIgZW4gPSBuZXcgRW51bWVyYXRvcihXU2NyaXB0LkFyZ3VtZW50cyk7DQogICAgZm9yICg7ICFlbi5hdEVuZCgpOyBlbi5tb3ZlTmV4dCgpKSB7IHRoaXMuX2FyZ3YucHVzaChlbi5pdGVtKCkpOyB9DQogICAgcmV0dXJuIHRoaXMuX2FyZ3Y7DQogIH07DQoNCiAgcHJvdG90eXBlQWNjZXNzb3JzLmVudi5nZXQgPSBmdW5jdGlvbiAoKSB7DQogICAgaWYgKHRoaXMuX2VudikgeyByZXR1cm4gdGhpcy5fZW52OyB9DQogICAgdmFyIGl0LCBpOw0KICAgIHZhciBlbiA9IG5ldyBFbnVtZXJhdG9yKF9fV1NoZWxsLkVudmlyb25tZW50KCdQUk9DRVNTJykpOw0KICAgIHRoaXMuX2VudiA9IHt9Ow0KICAgIGZvciAoOyAhZW4uYXRFbmQoKTsgZW4ubW92ZU5leHQoKSkgew0KICAgICAgaXQgPSBlbi5pdGVtKCk7DQogICAgICBpID0gaXQuaW5kZXhPZignPScpOw0KICAgICAgaWYgKGkgPiAwKSB7DQogICAgICAgIHRoaXMuX2VudltpdC5zbGljZSgwLCBpKV0gPSBpdC5zbGljZShpICsgMSk7DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiB0aGlzLl9lbnY7DQogIH07CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCBQcm9jZXNzLnByb3RvdHlwZSwgcHJvdG90eXBlQWNjZXNzb3JzICk7DQoNCiAgdmFyIHByb2Nlc3MgPSBuZXcgUHJvY2VzcygpOwoKICB2YXIgX2RvYzsNCg0KICBmdW5jdGlvbiBnZXRYbWxEb2MoKSB7DQogICAgcmV0dXJuIF9kb2MgfHwgKF9kb2MgPSBuZXcgQWN0aXZlWE9iamVjdCgnTVNYTUwyLkRPTURvY3VtZW50LjYuMCcpKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHRleHQydmFsdWUodHlwZSwgdGV4dCkgew0KICAgIHZhciBlbCA9IGdldFhtbERvYygpLmNyZWF0ZUVsZW1lbnQoJ3RtcCcpOw0KICAgIGVsLmRhdGFUeXBlID0gdHlwZTsNCiAgICBlbC50ZXh0ID0gdGV4dDsNCiAgICByZXR1cm4gZWwubm9kZVR5cGVkVmFsdWU7DQogIH0NCg0KICBmdW5jdGlvbiB2YWx1ZTJ0ZXh0KHR5cGUsIHZhbHVlKSB7DQogICAgdmFyIGVsID0gZ2V0WG1sRG9jKCkuY3JlYXRlRWxlbWVudCgndG1wJyk7DQogICAgZWwuZGF0YVR5cGUgPSB0eXBlOw0KICAgIGVsLm5vZGVUeXBlZFZhbHVlID0gdmFsdWU7DQogICAgcmV0dXJuIGVsLnRleHQ7DQogIH0NCg0KICBmdW5jdGlvbiBiaW4yaGV4KGJ5dGVzKSB7DQogICAgcmV0dXJuIHZhbHVlMnRleHQoJ2Jpbi5oZXgnLCBieXRlcyk7DQogIH0NCg0KICBmdW5jdGlvbiBoZXgyYmluKGhleCkgew0KICAgIHJldHVybiB0ZXh0MnZhbHVlKCdiaW4uaGV4JywgaGV4KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGJpbjJiYXNlNjQoYnl0ZXMpIHsNCiAgICByZXR1cm4gdmFsdWUydGV4dCgnYmluLmJhc2U2NCcsIGJ5dGVzKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGJhc2U2NDJiaW4oYmFzZTY0KSB7DQogICAgcmV0dXJuIHRleHQydmFsdWUoJ2Jpbi5iYXNlNjQnLCBiYXNlNjQpOw0KICB9DQoNCiAgZnVuY3Rpb24gYmluMnN0cihieXRlcywgZW5jb2RpbmcpIHsNCiAgICB2YXIgc3QgPSBuZXcgQWN0aXZlWE9iamVjdCgnQURPREIuU3RyZWFtJyksDQogICAgICBzdHI7DQogICAgZW5jb2RpbmcgfHwgKGVuY29kaW5nID0gJ1VURi04Jyk7DQogICAgdHJ5IHsNCiAgICAgIHN0Lk9wZW4oKTsNCiAgICAgIHN0LlR5cGUgPSAxOw0KICAgICAgc3QuV3JpdGUoYnl0ZXMpOw0KICAgICAgc3QuUG9zaXRpb24gPSAwOw0KICAgICAgc3QuVHlwZSA9IDI7DQogICAgICBzdC5DaGFyc2V0ID0gZW5jb2Rpbmc7DQogICAgICBzdHIgPSBzdC5SZWFkVGV4dCgpOw0KICAgIH0gZmluYWxseSB7DQogICAgICBzdC5DbG9zZSgpOw0KICAgIH0NCiAgICByZXR1cm4gc3RyOw0KICB9DQoNCiAgZnVuY3Rpb24gc3RyMmJpbihzdHIsIGVuY29kaW5nKSB7DQogICAgdmFyIHN0ID0gbmV3IEFjdGl2ZVhPYmplY3QoJ0FET0RCLlN0cmVhbScpLA0KICAgICAgYmluOw0KICAgIGVuY29kaW5nIHx8IChlbmNvZGluZyA9ICdVVEYtOCcpOw0KICAgIHRyeSB7DQogICAgICBzdC5PcGVuKCk7DQogICAgICBzdC5UeXBlID0gMjsNCiAgICAgIHN0LkNoYXJzZXQgPSBlbmNvZGluZzsNCiAgICAgIHN0LldyaXRlVGV4dChzdHIpOw0KICAgICAgc3QuUG9zaXRpb24gPSAwOw0KICAgICAgc3QuVHlwZSA9IDE7DQogICAgICBlbmNvZGluZyA9IGVuY29kaW5nLnJlcGxhY2UoJy0nLCAnJykudG9Mb3dlckNhc2UoKTsNCiAgICAgIGlmIChlbmNvZGluZyA9PSAndXRmOCcgfHwgZW5jb2RpbmcgPT0gJ3VuaWNvZGUnKSB7IHN0LlBvc2l0aW9uID0gMzsgfQ0KICAgICAgZWxzZSBpZiAoZW5jb2RpbmcgPT0gJ3VmdDE2JykgeyBzdC5Qb3NpdGlvbiA9IDI7IH0NCiAgICAgIGJpbiA9IHN0LlJlYWQoKTsNCiAgICB9IGZpbmFsbHkgew0KICAgICAgc3QuQ2xvc2UoKTsNCiAgICB9DQogICAgcmV0dXJuIGJpbjsNCiAgfQ0KDQogIGZ1bmN0aW9uIGVuY29kZShzdHIsIGVuY29kaW5nKSB7DQogICAgc3dpdGNoIChlbmNvZGluZykgew0KICAgICAgY2FzZSAnaGV4JzoNCiAgICAgICAgcmV0dXJuIGhleDJiaW4oc3RyKTsNCiAgICAgIGNhc2UgJ2Jhc2U2NCc6DQogICAgICAgIHJldHVybiBiYXNlNjQyYmluKHN0cik7DQogICAgICBkZWZhdWx0Og0KICAgICAgICByZXR1cm4gc3RyMmJpbihzdHIsIGVuY29kaW5nKTsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBkZWNvZGUoYnl0ZXMsIGVuY29kaW5nKSB7DQogICAgc3dpdGNoIChlbmNvZGluZykgew0KICAgICAgY2FzZSAnaGV4JzoNCiAgICAgICAgcmV0dXJuIGJpbjJoZXgoYnl0ZXMpOw0KICAgICAgY2FzZSAnYmFzZTY0JzoNCiAgICAgICAgcmV0dXJuIGJpbjJiYXNlNjQoYnl0ZXMpOw0KICAgICAgY2FzZSAnYmluYXJ5JzoNCiAgICAgICAgcmV0dXJuIGJ5dGVzOw0KICAgICAgZGVmYXVsdDoNCiAgICAgICAgcmV0dXJuIGJpbjJzdHIoYnl0ZXMsIGVuY29kaW5nKTsNCiAgICB9DQogIH0NCg0KICB2YXIgQnVmZmVyID0gZnVuY3Rpb24gQnVmZmVyKG9iaiwgZW5jb2RpbmcpIHsNCiAgICB0aGlzLmJ1ZmZlciA9IG51bGw7DQogICAgaWYgKG9iaiA9PSBudWxsIHx8IG9iaiA9PSAnJyB8fCBvYmoubGVuZ3RoID09IDApIHsNCiAgICAgIHRoaXMuYnVmZmVyID0gbmV3IEFjdGl2ZVhPYmplY3QoJ1NjcmlwdGluZy5EaWN0aW9uYXJ5JykuSXRlbXMoKTsNCiAgICB9IGVsc2UgaWYgKEJ1ZmZlci5pc0J1ZmZlcihvYmopKSB7DQogICAgICB0aGlzLmJ1ZmZlciA9IG9iai5idWZmZXI7DQogICAgfSBlbHNlIGlmICh0eXBlb2Ygb2JqID09ICdzdHJpbmcnKSB7DQogICAgICB0aGlzLmJ1ZmZlciA9IGVuY29kZShvYmosIGVuY29kaW5nKTsNCiAgICB9IGVsc2UgaWYgKG9iaiAhPSBudWxsICYmIG9iai5jb25zdHJ1Y3RvciAmJiBvYmouY29uc3RydWN0b3IgPT09IFZCQXJyYXkpIHsNCiAgICAgIHRoaXMuYnVmZmVyID0gb2JqOw0KICAgIH0gZWxzZSB7DQogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdGYWlsZWQgdG8gY3JlYXRlIGJ1ZmZlci4nKTsNCiAgICB9DQogIH07CgogIHZhciBwcm90b3R5cGVBY2Nlc3NvcnMkMSA9IHsgbGVuZ3RoOiB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH07DQoNCiAgQnVmZmVyLmlzQnVmZmVyID0gZnVuY3Rpb24gaXNCdWZmZXIgKG9iaikgew0KICAgIHJldHVybiBvYmogJiYgb2JqIGluc3RhbmNlb2YgQnVmZmVyOw0KICB9Ow0KDQogIEJ1ZmZlci5mcm9tID0gZnVuY3Rpb24gZnJvbSAob2JqLCBlbmNvZGluZykgew0KICAgIHJldHVybiBuZXcgQnVmZmVyKG9iaiwgZW5jb2RpbmcpOw0KICB9OwoKICBCdWZmZXIucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gdG9TdHJpbmcgKGVuY29kaW5nKSB7DQogICAgcmV0dXJuIHRoaXMuYnVmZmVyLnVib3VuZCgpID09IC0xID8gJycgOiBkZWNvZGUodGhpcy5idWZmZXIsIGVuY29kaW5nKTsNCiAgfTsNCg0KICBwcm90b3R5cGVBY2Nlc3NvcnMkMS5sZW5ndGguZ2V0ID0gZnVuY3Rpb24gKCkgew0KICAgIHJldHVybiB0aGlzLmJ1ZmZlci51Ym91bmQoKSArIDE7DQogIH07CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCBCdWZmZXIucHJvdG90eXBlLCBwcm90b3R5cGVBY2Nlc3NvcnMkMSApOwoKICB2YXIgVE9fU1RSID0ge30udG9TdHJpbmc7DQogIHZhciBIQVNfT1dOID0ge30uaGFzT3duUHJvcGVydHk7DQoNCiAgLy8gI3JlZ2lvbiBVdGlsDQoNCiAgZnVuY3Rpb24gY2hyKG4pIHsNCiAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShuKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIG9yZChjKSB7DQogICAgcmV0dXJuIGMuY2hhckNvZGVBdCgwKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGhleCh4KSB7DQogICAgcmV0dXJuIE51bWJlcih4KS50b1N0cmluZygxNik7DQogIH0NCg0KICBmdW5jdGlvbiBiaW4oeCkgew0KICAgIHJldHVybiBOdW1iZXIoeCkudG9TdHJpbmcoMik7DQogIH0NCg0KICBmdW5jdGlvbiBvY3QoeCkgew0KICAgIHJldHVybiBOdW1iZXIoeCkudG9TdHJpbmcoOCk7DQogIH0NCg0KICBmdW5jdGlvbiBpbnQoeCwgYmFzZSkgew0KICAgIHJldHVybiBwYXJzZUludCh4LCBiYXNlKTsNCiAgfQ0KDQogIHZhciBGVU5DX05BTUVfUkVHID0gL2Z1bmN0aW9uICsoXHcrKS87DQoNCiAgZnVuY3Rpb24gZ2V0RnVuY05hbWUoZm4pIHsNCiAgICBpZiAoZm4ubmFtZSkgeyByZXR1cm4gZm4ubmFtZTsgfQ0KICAgIHZhciBtID0gZm4udG9TdHJpbmcoKS5tYXRjaChGVU5DX05BTUVfUkVHKTsNCiAgICByZXR1cm4gbSA/IG1bMV0gOiAnJzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGdldFRhZyh2YWx1ZSkgew0KICAgIHJldHVybiBUT19TVFIuY2FsbCh2YWx1ZSk7DQogIH0NCg0KICB2YXIgVFlQRV9SRUcgPSAvXFtvYmplY3QgKFteXF1dKylcXS87DQoNCiAgZnVuY3Rpb24gdHlwZU9mKG9iaikgew0KICAgIHZhciB0cCA9IG9iaiA9PT0gbnVsbCA/ICdudWxsJyA6IHR5cGVvZiBvYmo7DQogICAgaWYgKHRwID09ICdvYmplY3QnKQ0KICAgICAgeyB0cCA9IFRPX1NUUi5jYWxsKG9iaikNCiAgICAgICAgLm1hdGNoKFRZUEVfUkVHKVsxXQ0KICAgICAgICAudG9Mb3dlckNhc2UoKTsgfQ0KICAgIGlmICh0cCA9PSAnb2JqZWN0JyAmJiBvYmouY29uc3RydWN0b3IgJiYgdHlwZW9mIG9iai5jb25zdHJ1Y3RvciA9PSAnZnVuY3Rpb24nKQ0KICAgICAgeyB0cCA9IGdldEZ1bmNOYW1lKG9iai5jb25zdHJ1Y3RvcikudG9Mb3dlckNhc2UoKSB8fCB0cDsgfQ0KICAgIHJldHVybiB0cDsNCiAgfQ0KDQogIHZhciB0eXBlID0gdHlwZU9mOw0KDQogIGZ1bmN0aW9uIGhhcyQxKG9iaiwga2V5KSB7DQogICAgcmV0dXJuIG9iaiAhPSBudWxsICYmIEhBU19PV04uY2FsbChvYmosIGtleSk7DQogIH0NCg0KICBmdW5jdGlvbiBpc0FycmF5KG9iaikgew0KICAgIHJldHVybiBBcnJheS5pc0FycmF5KG9iaik7DQogIH0NCg0KICBmdW5jdGlvbiBpc09iamVjdChvYmopIHsNCiAgICB2YXIgdHlwZSA9IHR5cGVvZiBvYmo7DQogICAgcmV0dXJuIG9iaiAhPSBudWxsICYmICh0eXBlID09ICdvYmplY3QnIHx8IHR5cGUgPT0gJ2Z1bmN0aW9uJyk7DQogIH0NCg0KICBmdW5jdGlvbiBpc0Z1bmN0aW9uKG9iaikgew0KICAgIHJldHVybiB0eXBlb2Ygb2JqID09ICdmdW5jdGlvbic7DQogIH0NCg0KICBmdW5jdGlvbiBpc1N0cmluZyhvYmopIHsNCiAgICByZXR1cm4gdHlwZW9mIG9iaiA9PSAnc3RyaW5nJzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzTnVtYmVyKG9iaikgew0KICAgIHJldHVybiB0eXBlb2Ygb2JqID09ICdudW1iZXInOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNCb29sZWFuKG9iaikgew0KICAgIHJldHVybiBvYmogPT09IHRydWUgfHwgb2JqID09PSBmYWxzZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzRGF0ZShvYmopIHsNCiAgICByZXR1cm4gVE9fU1RSLmNhbGwob2JqKSA9PSAnW29iamVjdCBEYXRlXSc7DQogIH0NCg0KICBmdW5jdGlvbiBpc1JlZ0V4cChvYmopIHsNCiAgICByZXR1cm4gVE9fU1RSLmNhbGwob2JqKSA9PSAnW29iamVjdCBSZWdFeHBdJzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzRXJyb3Iob2JqKSB7DQogICAgcmV0dXJuIFRPX1NUUi5jYWxsKG9iaikgPT0gJ1tvYmplY3QgRXJyb3JdJzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzTWFwKG9iaikgew0KICAgIHJldHVybiBvYmogaW5zdGFuY2VvZiBNYXA7DQogIH0NCg0KICBmdW5jdGlvbiBpc1NldChvYmopIHsNCiAgICByZXR1cm4gb2JqIGluc3RhbmNlb2YgU2V0Ow0KICB9DQoNCiAgZnVuY3Rpb24gaXNXZWFrTWFwKG9iaikgew0KICAgIHJldHVybiBvYmogaW5zdGFuY2VvZiBXZWFrTWFwOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNJbnRlZ2VyKHZhbHVlKSB7DQogICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJyAmJiB2YWx1ZSAlIDEgPT0gMDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzQXJndW1lbnRzKG9iaikgew0KICAgIHJldHVybiBUT19TVFIuY2FsbChvYmopID09ICdbb2JqZWN0IEFyZ3VtZW50c10nOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNPYmplY3RMaWtlKHZhbHVlKSB7DQogICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PSAnb2JqZWN0JyAmJiB2YWx1ZSAhPSBudWxsOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNMZW5ndGgodmFsdWUpIHsNCiAgICByZXR1cm4gaXNJbnRlZ2VyKHZhbHVlKSAmJiB2YWx1ZSA+IC0xICYmIHZhbHVlIDwgOTAwNzE5OTI1NDc0MDk5MjsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzQXJyYXlMaWtlKG9iaikgew0KICAgIHJldHVybiBvYmogIT0gbnVsbCAmJiB0eXBlb2Ygb2JqICE9ICdmdW5jdGlvbicgJiYgaXNMZW5ndGgob2JqLmxlbmd0aCk7DQogIH0NCg0KICBmdW5jdGlvbiBpc0VtcHR5KG9iaikgew0KICAgIGlmIChvYmogPT0gbnVsbCkgeyByZXR1cm4gdHJ1ZTsgfQ0KICAgIGlmIChpc0FycmF5TGlrZShvYmopKSB7IHJldHVybiAhb2JqLmxlbmd0aDsgfQ0KICAgIGlmIChpc01hcChvYmopIHx8IGlzU2V0KG9iaikpIHsgcmV0dXJuICFvYmouc2l6ZTsgfQ0KICAgIGZvciAodmFyIGtleSBpbiBvYmopIHsNCiAgICAgIGlmIChIQVNfT1dOLmNhbGwob2JqLCBrZXkpKSB7IHJldHVybiBmYWxzZTsgfQ0KICAgIH0NCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzQnVmZmVyKG9iaikgew0KICAgIHJldHVybiBCdWZmZXIuaXNCdWZmZXIob2JqKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGFwcGx5KGZuLCB0aGlzQXJnLCBhcmdzKSB7DQogICAgdmFyIGFyZ0NudCA9IChhcmdzICYmIGFyZ3MubGVuZ3RoKSB8fCAwLA0KICAgICAgaGFzVGhpcyA9IHRoaXNBcmcgPT0gbnVsbDsNCiAgICBzd2l0Y2ggKGFyZ0NudCkgew0KICAgICAgY2FzZSAwOg0KICAgICAgICByZXR1cm4gaGFzVGhpcyA/IGZuKCkgOiBmbi5jYWxsKHRoaXNBcmcpOw0KICAgICAgY2FzZSAxOg0KICAgICAgICByZXR1cm4gaGFzVGhpcyA/IGZuKGFyZ3NbMF0pIDogZm4uY2FsbCh0aGlzQXJnLCBhcmdzWzBdKTsNCiAgICAgIGNhc2UgMjoNCiAgICAgICAgcmV0dXJuIGhhc1RoaXMNCiAgICAgICAgICA/IGZuKGFyZ3NbMF0sIGFyZ3NbMV0pDQogICAgICAgICAgOiBmbi5jYWxsKHRoaXNBcmcsIGFyZ3NbMF0sIGFyZ3NbMV0pOw0KICAgICAgY2FzZSAzOg0KICAgICAgICByZXR1cm4gaGFzVGhpcw0KICAgICAgICAgID8gZm4oYXJnc1swXSwgYXJnc1sxXSwgYXJnc1syXSkNCiAgICAgICAgICA6IGZuLmNhbGwodGhpc0FyZywgYXJnc1swXSwgYXJnc1sxXSwgYXJnc1syXSk7DQogICAgICBkZWZhdWx0Og0KICAgICAgICByZXR1cm4gZm4uYXBwbHkodGhpc0FyZywgYXJncyk7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gcmFuZ2Uoc3RhcnQsIGVuZCwgc3RlcCkgew0KICAgIHZhciBpID0gLTEsDQogICAgICBsZW4sDQogICAgICByZXN1bHQgPSBbXTsNCiAgICBpZiAoc3RhcnQgPT0gbnVsbCkgeyByZXR1cm4gcmVzdWx0OyB9DQogICAgaWYgKGVuZCA9PSBudWxsKSB7IChlbmQgPSBzdGFydCksIChzdGFydCA9IDApOyB9DQogICAgaWYgKHN0ZXAgPT0gbnVsbCkgeyBzdGVwID0gMTsgfQ0KICAgIHN0ZXAgPSBNYXRoLmFicyhzdGVwKTsNCiAgICBpZiAoc3RhcnQgPiBlbmQpIHsgc3RlcCA9IC1zdGVwOyB9DQogICAgbGVuID0gTWF0aC5tYXgoTWF0aC5jZWlsKChlbmQgLSBzdGFydCkgLyBzdGVwKSwgMCk7DQogICAgcmVzdWx0ID0gbmV3IEFycmF5KGxlbik7DQogICAgd2hpbGUgKCsraSA8IGxlbikgeyAocmVzdWx0W2ldID0gc3RhcnQpLCAoc3RhcnQgKz0gc3RlcCk7IH0NCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9DQoNCiAgZnVuY3Rpb24gdG9QYXRoKHB0aCkgew0KICAgIGlmIChpc1N0cmluZyhwdGgpKSB7IHB0aCA9IHB0aC5zcGxpdCgvWy5bXF1dLykuZmlsdGVyKGlkZW50aXR5KTsgfQ0KICAgIGVsc2UgaWYgKGlzTnVtYmVyKHB0aCkpIHsgcHRoID0gW3B0aF07IH0NCiAgICByZXR1cm4gaXNBcnJheShwdGgpID8gcHRoIDogW107DQogIH0NCg0KICBmdW5jdGlvbiBpZGVudGl0eSh2YWx1ZSkgew0KICAgIHJldHVybiB2YWx1ZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGl0ZXJhdGVlKHZhbHVlKSB7DQogICAgc3dpdGNoICh0eXBlT2YodmFsdWUpKSB7DQogICAgICBjYXNlICdmdW5jdGlvbic6DQogICAgICAgIHJldHVybiB2YWx1ZTsNCiAgICAgIGNhc2UgJ3N0cmluZyc6DQogICAgICBjYXNlICdudW1iZXInOg0KICAgICAgICByZXR1cm4gcHJvcGVydHkodmFsdWUpOw0KICAgICAgY2FzZSAnYXJyYXknOg0KICAgICAgICByZXR1cm4gcHJvcGVydGllcyh2YWx1ZSk7DQogICAgICBjYXNlICdvYmplY3QnOg0KICAgICAgICByZXR1cm4gbWF0Y2hlcyh2YWx1ZSk7DQogICAgICBkZWZhdWx0Og0KICAgICAgICByZXR1cm4gaWRlbnRpdHk7DQogICAgfQ0KICB9DQoNCiAgLy8gI2VuZHJlZ2lvbg0KDQogIC8vICNyZWdpb24gQ29sbGVjdGlvbg0KDQogIGZ1bmN0aW9uIGVhY2gob2JqLCBmbikgew0KICAgIHZhciBlbiwgaSwga2V5LCBsZW47DQogICAgaWYgKGlzQXJyYXlMaWtlKG9iaikpIHsNCiAgICAgIGZvciAoaSA9IDAsIGxlbiA9IG9iai5sZW5ndGg7IGkgPCBsZW47IGkrKykgew0KICAgICAgICBpZiAoZm4ob2JqW2ldLCBpLCBvYmopID09PSBmYWxzZSkgeyBicmVhazsgfQ0KICAgICAgfQ0KICAgIH0gZWxzZSBpZiAob2JqICYmICFvYmouY29uc3RydWN0b3IgJiYgJ0l0ZW0nIGluIG9iaikgew0KICAgICAgZW4gPSBuZXcgRW51bWVyYXRvcihvYmopOw0KICAgICAgZm9yIChpID0gMDsgIWVuLmF0RW5kKCk7IGVuLm1vdmVOZXh0KCksIGkrKykgew0KICAgICAgICBpZiAoZm4oZW4uaXRlbSgpLCBpLCBvYmopID09PSBmYWxzZSkgeyBicmVhazsgfQ0KICAgICAgfQ0KICAgIH0gZWxzZSBpZiAoaXNMZW5ndGgob2JqKSkgew0KICAgICAgZm9yIChpID0gMDsgaSA8IG9iajsgaSsrKSB7DQogICAgICAgIGlmIChmbihpLCBpLCBvYmopID09PSBmYWxzZSkgeyBicmVhazsgfQ0KICAgICAgfQ0KICAgIH0gZWxzZSBpZiAoaXNPYmplY3Qob2JqKSkgew0KICAgICAgZm9yIChrZXkgaW4gb2JqKSB7DQogICAgICAgIGlmIChoYXMkMShvYmosIGtleSkpIHsNCiAgICAgICAgICBpZiAoZm4ob2JqW2tleV0sIGtleSwgb2JqKSA9PT0gZmFsc2UpIHsgYnJlYWs7IH0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gb2JqOw0KICB9DQoNCiAgdmFyIGZvckVhY2ggPSBlYWNoOw0KDQogIGZ1bmN0aW9uIG1hcChvYmosIGZuKSB7DQogICAgdmFyIHJlc3VsdCA9IFtdLA0KICAgICAgaXRlID0gaXRlcmF0ZWUoZm4pOw0KICAgIGVhY2gob2JqLCBmdW5jdGlvbiAodiwgaywgbykgew0KICAgICAgcmVzdWx0LnB1c2goaXRlKHYsIGssIG8pKTsNCiAgICB9KTsNCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9DQoNCiAgdmFyIHNlbGVjdCA9IG1hcDsNCg0KICBmdW5jdGlvbiByZWR1Y2Uob2JqLCBmbiwgbWVtbykgew0KICAgIGVhY2gob2JqLCBmdW5jdGlvbih2LCBrLCBvKSB7DQogICAgICBtZW1vID0gZm4obWVtbywgdiwgaywgbyk7DQogICAgfSk7DQogICAgcmV0dXJuIG1lbW87DQogIH0NCg0KICBmdW5jdGlvbiBmaWx0ZXIob2JqLCBmbikgew0KICAgIHZhciByZXN1bHQgPSBbXSwNCiAgICAgIGl0ZSA9IGl0ZXJhdGVlKGZuKTsNCiAgICBlYWNoKG9iaiwgZnVuY3Rpb24gKHYsIGssIG8pIHsNCiAgICAgIGlmIChpdGUodiwgaywgbykpIHsgcmVzdWx0LnB1c2godik7IH0NCiAgICB9KTsNCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9DQoNCiAgdmFyIHdoZXJlID0gZmlsdGVyOw0KDQogIGZ1bmN0aW9uIHRvQXJyYXkob2JqKSB7DQogICAgdmFyIGksIGxlbiwgYXJyOw0KICAgIGlmIChpc0FycmF5KG9iaikpIHsgcmV0dXJuIG9iajsgfQ0KICAgIGlmIChpc0FycmF5TGlrZShvYmopKSB7DQogICAgICBpID0gLTE7DQogICAgICBsZW4gPSBvYmoubGVuZ3RoOw0KICAgICAgYXJyID0gQXJyYXkobGVuKTsNCiAgICAgIHdoaWxlICgrK2kgPCBsZW4pIHsgYXJyW2ldID0gb2JqW2ldOyB9DQogICAgICByZXR1cm4gYXJyOw0KICAgIH0NCiAgICBpZiAoaXNPYmplY3Qob2JqKSkgeyByZXR1cm4gbWFwKG9iaik7IH0NCiAgICByZXR1cm4gW107DQogIH0NCg0KICBmdW5jdGlvbiBiYXNlRmluZChhcnIsIGZuLCBfdGhpcykgew0KICAgIHZhciBpID0gLTEsDQogICAgICBsZW4gPSBhcnIubGVuZ3RoLA0KICAgICAgaXQ7DQogICAgaWYgKF90aGlzKSB7DQogICAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICAgIGl0ID0gYXJyW2ldOw0KICAgICAgICBpZiAoZm4uY2FsbChfdGhpcywgaXQsIGksIGFycikpIHsNCiAgICAgICAgICByZXR1cm4gW2l0LCBpXTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICAgIGl0ID0gYXJyW2ldOw0KICAgICAgICBpZiAoZm4oaXQsIGksIGFycikpIHsNCiAgICAgICAgICByZXR1cm4gW2l0LCBpXTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gW251bGwsIC0xXTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGZpbmQoYXJyLCBmbikgew0KICAgIHJldHVybiBiYXNlRmluZChhcnIsIGZuKVswXTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGZpbmRJbmRleChhcnIsIGZuKSB7DQogICAgcmV0dXJuIGJhc2VGaW5kKGFyciwgZm4pWzFdOw0KICB9DQoNCiAgZnVuY3Rpb24gZmlsbChhcnIsIHZhbCwgc3RhcnQsIGVuZCkgew0KICAgIHZhciBsZW4gPSBhcnIubGVuZ3RoOw0KICAgIGlmIChzdGFydCA9PSBudWxsKSB7IHN0YXJ0ID0gMDsgfQ0KICAgIGlmIChlbmQgPT0gbnVsbCkgeyBlbmQgPSBsZW47IH0NCiAgICBpZiAoZW5kIDwgMCkgeyBlbmQgPSBNYXRoLm1heChlbmQgKyBsZW4sIGxlbik7IH0NCiAgICB3aGlsZSAoc3RhcnQgPCBlbmQpIHsNCiAgICAgIGFycltzdGFydF0gPSB2YWw7DQogICAgICBzdGFydCsrOw0KICAgIH0NCiAgICByZXR1cm4gYXJyOw0KICB9DQoNCiAgZnVuY3Rpb24gZ3JvdXBCeShvYmosIGZuKSB7DQogICAgdmFyIHJlc3VsdCA9IHt9LA0KICAgICAgaXRlID0gaXRlcmF0ZWUoZm4pOw0KICAgIGVhY2gob2JqLCBmdW5jdGlvbih2LCBrLCBvKSB7DQogICAgICB2YXIga2V5ID0gaXRlKHYsIGssIG8pOw0KICAgICAgaGFzJDEocmVzdWx0LCBrZXkpID8gcmVzdWx0W2tleV0ucHVzaCh2KSA6IChyZXN1bHRba2V5XSA9IFt2XSk7DQogICAgfSk7DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNvdW50Qnkob2JqLCBmbikgew0KICAgIHZhciBpdGUgPSBpdGVyYXRlZShmbik7DQogICAgcmV0dXJuIHJlZHVjZSgNCiAgICAgIG9iaiwNCiAgICAgIGZ1bmN0aW9uIChyZXN1bHQsIHZhbHVlLCBrZXkpIHsNCiAgICAgICAga2V5ID0gaXRlKHZhbHVlKTsNCiAgICAgICAgaGFzJDEocmVzdWx0LCBrZXkpID8gcmVzdWx0W2tleV0rKyA6IChyZXN1bHRba2V5XSA9IDEpOw0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgfSwNCiAgICAgIHt9DQogICAgKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNpemUob2JqKSB7DQogICAgcmV0dXJuIGlzQXJyYXlMaWtlKG9iaikgPyBvYmoubGVuZ3RoIDogT2JqZWN0LmtleXMob2JqKS5sZW5ndGg7DQogIH0NCg0KICB2YXIgbGVuID0gc2l6ZTsNCg0KICAvLyAjZW5kcmVnaW9uDQoNCiAgLy8gI3JlZ2lvbiBBcnJheQ0KDQogIGZ1bmN0aW9uIHVuaXFCeShhcnIsIGZuKSB7DQogICAgdmFyIGl0ZSA9IGl0ZXJhdGVlKGZuKSwNCiAgICAgIHJlc3VsdCA9IFtdLA0KICAgICAgbWVtbyA9IG5ldyBTZXQoKSwNCiAgICAgIGkgPSAtMSwNCiAgICAgIGxlbiA9IGFyci5sZW5ndGgsDQogICAgICBpdGVtLA0KICAgICAgY29tcHV0ZWQ7DQogICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgaXRlbSA9IGFycltpXTsNCiAgICAgIGNvbXB1dGVkID0gaXRlKGl0ZW0pOw0KICAgICAgaWYgKCFtZW1vLmhhcyhjb21wdXRlZCkpIHsNCiAgICAgICAgcmVzdWx0LnB1c2goaXRlbSk7DQogICAgICAgIG1lbW8uYWRkKGNvbXB1dGVkKTsNCiAgICAgIH0NCiAgICB9DQogICAgbWVtby5jbGVhcigpOw0KICAgIHJldHVybiByZXN1bHQ7DQogIH0NCg0KICBmdW5jdGlvbiB1bmlxKGFycikgew0KICAgIHJldHVybiB1bmlxQnkoYXJyLCBpZGVudGl0eSk7DQogIH0NCg0KICB2YXIgZGlzdGluY3QgPSB1bmlxOw0KDQogIHZhciBkaXN0aW5jdEJ5ID0gdW5pcUJ5Ow0KDQogIGZ1bmN0aW9uIGNodW5rKGFyciwgbikgew0KICAgIGlmIChuID09IG51bGwgfHwgbiA8IDEpIHsgcmV0dXJuIFtdOyB9DQogICAgdmFyIHJlc3VsdCA9IFtdLA0KICAgICAgdG1wID0gQXJyYXkobiksDQogICAgICBpID0gLTEsDQogICAgICBsZW4gPSBhcnIubGVuZ3RoLA0KICAgICAgb2ZmID0gMDsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICB0bXBbb2ZmKytdID0gYXJyW2ldOw0KICAgICAgaWYgKG9mZiA9PSAxKSB7DQogICAgICAgIHJlc3VsdC5wdXNoKHRtcCk7DQogICAgICB9IGVsc2UgaWYgKG9mZiA9PSBuKSB7DQogICAgICAgIG9mZiA9IDA7DQogICAgICAgIHRtcCA9IEFycmF5KG4pOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9DQoNCiAgZnVuY3Rpb24gY29uY2F0KCkgewogICAgdmFyIGFyZ3VtZW50cyQxID0gYXJndW1lbnRzOwoNCiAgICB2YXIgaSA9IC0xLA0KICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aCwNCiAgICAgIHJlc3VsdCA9IFtdLA0KICAgICAgYXJyLA0KICAgICAgaWksDQogICAgICBsZW4yOw0KICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgIGFyciA9IGFyZ3VtZW50cyQxW2ldOw0KICAgICAgaWkgPSAtMTsNCiAgICAgIGxlbjIgPSBhcnIgJiYgYXJyLmxlbmd0aDsNCiAgICAgIGlmIChsZW4yID09IG51bGwpIHsNCiAgICAgICAgcmVzdWx0LnB1c2goYXJyKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHdoaWxlICgrK2lpIDwgbGVuMikgeyByZXN1bHQucHVzaChhcnJbaWldKTsgfQ0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9DQoNCiAgZnVuY3Rpb24gc2xpY2UoYXJyLCBzdGFydCwgZW5kKSB7DQogICAgdmFyIGkgPSAtMSwNCiAgICAgIGxlbiA9IChhcnIgJiYgYXJyLmxlbmd0aCkgfHwgMCwNCiAgICAgIHJlc3VsdDsNCiAgICBpZiAoIWxlbikgeyByZXR1cm4gW107IH0NCiAgICBpZiAoc3RhcnQgPT0gbnVsbCkgeyBzdGFydCA9IDA7IH0NCiAgICBpZiAoZW5kID09IG51bGwpIHsgZW5kID0gbGVuOyB9DQogICAgaWYgKHN0YXJ0IDwgMCkgeyBzdGFydCA9IC1zdGFydCA+IGxlbiA/IDAgOiBsZW4gKyBzdGFydDsgfQ0KICAgIGlmIChlbmQgPCAwKSB7IGVuZCArPSBsZW47IH0NCiAgICBlbHNlIGlmIChlbmQgPiBsZW4pIHsgZW5kID0gbGVuOyB9DQogICAgbGVuID0gc3RhcnQgPiBlbmQgPyAwIDogZW5kIC0gc3RhcnQ7DQogICAgcmVzdWx0ID0gbmV3IEFycmF5KGxlbik7DQogICAgd2hpbGUgKCsraSA8IGxlbikgeyByZXN1bHRbaV0gPSBhcnJbaSArIHN0YXJ0XTsgfQ0KICAgIHJldHVybiByZXN1bHQ7DQogIH0NCg0KICAvLyBkcm9wKFsxLCAyLCAzLCA0LCA1XSwgMikgPT4gWzMsIDQsIDVdDQogIGZ1bmN0aW9uIGRyb3AoYXJyLCBuKSB7DQogICAgcmV0dXJuIHNsaWNlKGFyciwgbiB8fCAxKTsNCiAgfQ0KDQogIC8vIHRhaWwoWzEsIDIsIDMsIDRdKSA9PiBbMiwgMywgNF0NCiAgZnVuY3Rpb24gdGFpbChhcnIpIHsNCiAgICByZXR1cm4gZHJvcChhcnIsIDEpOw0KICB9DQoNCiAgLy8gaW5pdGFpbChbMSwgMiwgMywgNF0pID0+IFsxLCAyLCAzXQ0KICBmdW5jdGlvbiBpbml0aWFsKGFycikgew0KICAgIHJldHVybiBzbGljZShhcnIsIDAsIE1hdGgubWF4KDAsIGFyci5sZW5ndGggLSAxKSk7DQogIH0NCg0KICAvLyB0YWtlKFsxLCAyLCAzLCA0LCA1XSwgMikgPT4gWzEsIDJdDQogIGZ1bmN0aW9uIHRha2UoYXJyLCBuKSB7DQogICAgcmV0dXJuIHNsaWNlKGFyciwgMCwgbik7DQogIH0NCg0KICBmdW5jdGlvbiB0YWtlUmlnaHQoYXJyLCBuKSB7DQogICAgcmV0dXJuIHNsaWNlKGFyciwgLW4pOw0KICB9DQoNCiAgZnVuY3Rpb24gY29udGFpbnMob2JqLCB2YWwsIHBvcykgew0KICAgIHJldHVybiBvYmouaW5kZXhPZih2YWwsIHBvcyB8fCAwKSAhPSAtMTsNCiAgfQ0KDQogIHZhciBpbmNsdWRlID0gY29udGFpbnM7DQoNCiAgdmFyIGluY2x1ZGVzID0gY29udGFpbnM7DQoNCiAgZnVuY3Rpb24gZmlyc3QoYXJyKSB7DQogICAgcmV0dXJuIGFyciAmJiBhcnJbMF07DQogIH0NCg0KICB2YXIgaGVhZCA9IGZpcnN0Ow0KDQogIGZ1bmN0aW9uIGxhc3QoYXJyKSB7DQogICAgcmV0dXJuIChhcnIgJiYgYXJyLmxlbmd0aCA+IDAgJiYgYXJyW2Fyci5sZW5ndGggLSAxXSkgfHwgdm9pZCAwOw0KICB9DQoNCiAgZnVuY3Rpb24gbnRoKGFyciwgbikgew0KICAgIHJldHVybiBhcnIgJiYgKG4gPCAwID8gYXJyW2Fyci5sZW5ndGggKyBuXSA6IGFycltuXSk7DQogIH0NCg0KICBmdW5jdGlvbiBwdWxsQWxsKGFyciwgdmFsdWVzKSB7DQogICAgaWYgKCFpc0FycmF5KHZhbHVlcykpIHsgcmV0dXJuIGFycjsgfQ0KICAgIHZhciBpID0gYXJyLmxlbmd0aDsNCiAgICB3aGlsZSAoaS0tKSB7DQogICAgICBpZiAodmFsdWVzLmluY2x1ZGVzKGFycltpXSkpIHsgYXJyLnNwbGljZShpLCAxKTsgfQ0KICAgIH0NCiAgICByZXR1cm4gYXJyOw0KICB9DQoNCiAgZnVuY3Rpb24gcHVsbChhcnIpIHsNCiAgICByZXR1cm4gcHVsbEFsbChhcnIsIHRhaWwoYXJndW1lbnRzKSk7DQogIH0NCg0KICBmdW5jdGlvbiByZW1vdmUoYXJyLCBmbikgew0KICAgIHZhciBpID0gYXJyLmxlbmd0aCwNCiAgICAgIGl0ZSA9IGl0ZXJhdGVlKGZuKTsNCiAgICB3aGlsZSAoaS0tKSB7DQogICAgICBpZiAoaXRlKGFycltpXSwgaSwgYXJyKSkgeyBhcnIuc3BsaWNlKGksIDEpOyB9DQogICAgfQ0KICAgIHJldHVybiBhcnI7DQogIH0NCg0KICBmdW5jdGlvbiBkaWZmZXJlbmNlKGFyciwgdmFsdWVzKSB7DQogICAgcmV0dXJuIGZpbHRlcihhcnIsIGZ1bmN0aW9uIChpdCkgeyByZXR1cm4gIWluY2x1ZGVzKHZhbHVlcywgaXQpOyB9KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHVuemlwKGFycikgew0KICAgIGlmIChhcnIgPT0gbnVsbCB8fCAhYXJyLmxlbmd0aCkgew0KICAgICAgcmV0dXJuIFtdOw0KICAgIH0NCiAgICB2YXIgbGVuID0gMDsNCiAgICBhcnIgPSBmaWx0ZXIoYXJyLCBmdW5jdGlvbiAoaXQpIHsNCiAgICAgIGlmIChoYXMkMShpdCwgJ2xlbmd0aCcpKSB7DQogICAgICAgIGxlbiA9IE1hdGgubWF4KGl0Lmxlbmd0aCwgbGVuKTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9DQogICAgfSk7DQogICAgdmFyIGkgPSAtMSwNCiAgICAgIHJlc3VsdCA9IEFycmF5KGxlbik7DQogICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgcmVzdWx0W2ldID0gbWFwKGFyciwgaSk7DQogICAgfQ0KICAgIHJldHVybiByZXN1bHQ7DQogIH0NCg0KICBmdW5jdGlvbiB6aXAoKSB7DQogICAgcmV0dXJuIHVuemlwKGFyZ3VtZW50cyk7DQogIH0NCg0KICBmdW5jdGlvbiBmbGF0dGVuKGFycikgew0KICAgIHJldHVybiByZWR1Y2UoDQogICAgICBhcnIsDQogICAgICBmdW5jdGlvbiAocnN0LCBpdCkgew0KICAgICAgICBpZiAoaXNBcnJheShpdCkpIHsgcnN0ID0gcnN0LmNvbmNhdChpdCk7IH0NCiAgICAgICAgZWxzZSB7IHJzdC5wdXNoKGl0KTsgfQ0KICAgICAgICByZXR1cm4gcnN0Ow0KICAgICAgfSwNCiAgICAgIFtdDQogICAgKTsNCiAgfQ0KDQogIC8vICNlbmRyZWdpb24NCg0KICAvLyAjcmVnaW9uIE9iamVjdA0KDQogIGZ1bmN0aW9uIGtleXMob2JqKSB7DQogICAgcmV0dXJuIG9iaiA/IE9iamVjdC5rZXlzKG9iaikgOiBbXTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHZhbHVlcyhvYmopIHsNCiAgICByZXR1cm4gb2JqID8ga2V5cyhvYmopLm1hcChwcm9wZXJ0eU9mKG9iaikpIDogW107DQogIH0NCg0KICBmdW5jdGlvbiBrZXlzSW4ob2JqKSB7DQogICAgdmFyIGFyciA9IFtdOw0KICAgIGlmIChvYmopIHsNCiAgICAgIGZvciAodmFyIGsgaW4gb2JqKSB7DQogICAgICAgIGFyci5wdXNoKGspOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gYXJyOw0KICB9DQoNCiAgZnVuY3Rpb24gdmFsdWVzSW4ob2JqKSB7DQogICAgcmV0dXJuIG9iaiA/IGtleXNJbihvYmopLm1hcChwcm9wZXJ0eU9mKG9iaikpIDogW107DQogIH0NCg0KICAvLyB6aXBPYmplY3QoWydhJywgJ2InLCAnYyddLCBbMSwgMiwgM10pDQogIC8vID0+IHsgYTogMSwgYjogMiwgYzogM30NCiAgZnVuY3Rpb24gemlwT2JqZWN0KHByb3BzLCB2YWx1ZXMpIHsNCiAgICB2YXIgaSA9IC0xLA0KICAgICAgbGVuID0gcHJvcHMubGVuZ3RoLA0KICAgICAgdkxlbiA9IHZhbHVlcy5sZW5ndGgsDQogICAgICByZXN1bHQgPSB7fTsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICByZXN1bHRbcHJvcHNbaV1dID0gaSA8IHZMZW4gPyB2YWx1ZXNbaV0gOiB2b2lkIDA7DQogICAgfQ0KICAgIHJldHVybiByZXN1bHQ7DQogIH0NCg0KICAvLyBvYmplY3QoWyBbJ2EnLCAxXSwgWydiJywgMl0sIFsnYycsIDNdIF0pDQogIC8vID0+IHsgYTogMSwgYjogMiwgYzogM30NCiAgZnVuY3Rpb24gZnJvbVBhaXJzKHBhaXJzKSB7DQogICAgdmFyIHJlc3VsdCA9IHt9LA0KICAgICAgaSA9IC0xLA0KICAgICAgbGVuID0gcGFpcnMubGVuZ3RoOw0KICAgIHdoaWxlICgrK2kgPCBsZW4pIHsgcmVzdWx0W3BhaXJzW2ldWzBdXSA9IHBhaXJzW2ldWzFdOyB9DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfQ0KDQogIGZ1bmN0aW9uIG9iamVjdChhcnIxLCBhcnIyKSB7DQogICAgcmV0dXJuIGFycjIgPyB6aXBPYmplY3QoYXJyMSwgYXJyMikgOiBmcm9tUGFpcnMoYXJyMSk7DQogIH0NCg0KICBmdW5jdGlvbiBnZXQob2JqLCBwdGgsIGRlZlZhbCkgew0KICAgIHZhciBpID0gLTEsDQogICAgICBfcHRoID0gdG9QYXRoKHB0aCksDQogICAgICBsZW4gPSBfcHRoLmxlbmd0aDsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICBpZiAob2JqID09IG51bGwpIHsgcmV0dXJuIGRlZlZhbDsgfQ0KICAgICAgb2JqID0gb2JqW19wdGhbaV1dOw0KICAgIH0NCiAgICByZXR1cm4gb2JqOw0KICB9DQoNCiAgZnVuY3Rpb24gYXQob2JqLCBwdGhzKSB7DQogICAgcmV0dXJuIHB0aHMubWFwKGZ1bmN0aW9uIChwdGgpIHsgcmV0dXJuIGdldChvYmosIHB0aCk7IH0pOw0KICB9DQoNCiAgZnVuY3Rpb24gcHJvcGVydHlPZihvYmopIHsNCiAgICByZXR1cm4gZnVuY3Rpb24gKHB0aCkgeyByZXR1cm4gZ2V0KG9iaiwgcHRoKTsgfTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHByb3BlcnR5KHB0aCkgew0KICAgIHJldHVybiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBnZXQob2JqLCBwdGgpOyB9Ow0KICB9DQoNCiAgZnVuY3Rpb24gcHJvcGVydGllcyhwdGhzKSB7DQogICAgcmV0dXJuIGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIGF0KG9iaiwgcHRocyk7IH07DQogIH0NCg0KICBmdW5jdGlvbiBzZXQob2JqLCBwdGgsIHZhbHVlKSB7DQogICAgdmFyIF9wdGggPSB0b1BhdGgocHRoKSwNCiAgICAgIGtleSA9IGxhc3QoX3B0aCksDQogICAgICBfb2JqID0gZ2V0KG9iaiwgaW5pdGlhbChfcHRoKSk7DQogICAgaWYgKF9vYmogIT0gbnVsbCkgew0KICAgICAgX29ialtrZXldID0gdmFsdWU7DQogICAgfQ0KICAgIHJldHVybiBvYmo7DQogIH0NCg0KICBmdW5jdGlvbiB1bnNldChvYmosIHB0aCkgew0KICAgIHZhciBfcHRoID0gdG9QYXRoKHB0aCksDQogICAgICBrZXkgPSBsYXN0KF9wdGgpLA0KICAgICAgX29iaiA9IGdldChvYmosIGluaXRpYWwoX3B0aCkpOw0KICAgIGlmIChfb2JqICE9IG51bGwgJiYgaGFzJDEoX29iaiwga2V5KSkgew0KICAgICAgZGVsZXRlIF9vYmpba2V5XTsNCiAgICB9DQogICAgcmV0dXJuIG9iajsNCiAgfQ0KDQogIGZ1bmN0aW9uIHVwZGF0ZShvYmosIHB0aCwgZm4pIHsNCiAgICB2YXIgX3B0aCA9IHRvUGF0aChwdGgpLA0KICAgICAga2V5ID0gbGFzdChfcHRoKSwNCiAgICAgIF9vYmogPSBnZXQob2JqLCBpbml0aWFsKF9wdGgpKTsNCiAgICBpZiAoX29iaiAhPSBudWxsKSB7DQogICAgICBfb2JqW2tleV0gPSBmbihfb2JqW2tleV0pOw0KICAgIH0NCiAgICByZXR1cm4gb2JqOw0KICB9DQoNCiAgZnVuY3Rpb24gcGljayhvYmosIHB0aHMpIHsNCiAgICB2YXIgX3B0aHMgPSBwdGhzLm1hcChmdW5jdGlvbiAoaXQpIHsgcmV0dXJuIHRvUGF0aChpdCk7IH0pOw0KICAgIHJldHVybiBfcHRocy5yZWR1Y2UoZnVuY3Rpb24gKHJlc3VsdCwgcHRoKSB7DQogICAgICB2YXIgdmFsdWUgPSBnZXQob2JqLCBwdGgpOw0KICAgICAgaWYgKHZhbHVlKSB7IHJlc3VsdFtsYXN0KHB0aCldID0gdmFsdWU7IH0NCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfSwge30pOw0KICB9DQoNCiAgLy8gaXNNYXRjaCh7YTogMSwgYjogMn0sIHsgYjogMiB9KSA9PiB0cnVlDQogIC8vIGlzTWF0Y2goe2E6IDEsIGI6IDJ9LCB7IGI6IDEgfSkgPT4gZmFsc2UNCiAgZnVuY3Rpb24gaXNNYXRjaChvYmosIGF0dHJzKSB7DQogICAgaWYgKG9iaiA9PSBudWxsIHx8IGF0dHJzID09IG51bGwpIHsgcmV0dXJuIGZhbHNlOyB9DQogICAgZm9yICh2YXIga2V5IGluIGF0dHJzKSB7DQogICAgICBpZiAoIWhhcyQxKGF0dHJzLCBrZXkpKSB7IGNvbnRpbnVlOyB9DQogICAgICBpZiAoIWhhcyQxKG9iaiwga2V5KSB8fCBhdHRyc1trZXldICE9PSBvYmpba2V5XSkgeyByZXR1cm4gZmFsc2U7IH0NCiAgICB9DQogICAgcmV0dXJuIHRydWU7DQogIH0NCg0KICAvLyBtYXRjaGVzKHtiOiAyfSkoeyBhOiAxLCBiOiAyfSkgPT4gdHJ1ZQ0KICBmdW5jdGlvbiBtYXRjaGVzKGF0dHJzKSB7DQogICAgcmV0dXJuIGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIGlzTWF0Y2gob2JqLCBhdHRycyk7IH07DQogIH0NCg0KICB2YXIgbWF0Y2hlciA9IG1hdGNoZXM7DQoNCiAgZnVuY3Rpb24gYXNzaWduKG9iaikgew0KICAgIHZhciBrZXksDQogICAgICBzcmMsDQogICAgICBpID0gMCwNCiAgICAgIGFyZ3MgPSBhcmd1bWVudHMsDQogICAgICBsZW4gPSBhcmdzLmxlbmd0aDsNCiAgICBvYmogfHwgKG9iaiA9IHt9KTsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICBzcmMgPSBhcmdzW2ldOw0KICAgICAgZm9yIChrZXkgaW4gc3JjKSB7DQogICAgICAgIGlmIChoYXMkMShzcmMsIGtleSkpIHsNCiAgICAgICAgICBvYmpba2V5XSA9IHNyY1trZXldOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiBvYmo7DQogIH0NCg0KICBmdW5jdGlvbiBhc3NpZ25JbihvYmopIHsNCiAgICB2YXIga2V5LA0KICAgICAgc3JjLA0KICAgICAgaSA9IDAsDQogICAgICBhcmdzID0gYXJndW1lbnRzLA0KICAgICAgbGVuID0gYXJncy5sZW5ndGg7DQogICAgb2JqIHx8IChvYmogPSB7fSk7DQogICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgc3JjID0gYXJnc1tpXTsNCiAgICAgIGZvciAoa2V5IGluIHNyYykgew0KICAgICAgICBpZiAoaGFzJDEoc3JjLCBrZXkpKSB7DQogICAgICAgICAgb2JqW2tleV0gPSBzcmNba2V5XTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gb2JqOw0KICB9DQoNCiAgdmFyIGV4dGVuZCA9IGFzc2lnbkluOw0KDQogIGZ1bmN0aW9uIGRlZmF1bHRzKG9iaikgew0KICAgIHZhciBrZXksDQogICAgICBzcmMsDQogICAgICBpID0gMCwNCiAgICAgIGFyZ3MgPSBhcmd1bWVudHMsDQogICAgICBsZW4gPSBhcmdzLmxlbmd0aDsNCiAgICBvYmogfHwgKG9iaiA9IHt9KTsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICBzcmMgPSBhcmdzW2ldOw0KICAgICAgZm9yIChrZXkgaW4gc3JjKSB7DQogICAgICAgIGlmICghaGFzJDEob2JqLCBrZXkpKSB7DQogICAgICAgICAgb2JqW2tleV0gPSBzcmNba2V5XTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gb2JqOw0KICB9DQoNCiAgZnVuY3Rpb24gZW50cmllcyhvYmopIHsNCiAgICByZXR1cm4gb2JqID8gbWFwKG9iaiwgZnVuY3Rpb24gKHYsIGspIHsgcmV0dXJuIFtrLCB2XTsgfSkgOiBbXTsNCiAgfQ0KDQogIHZhciB0b1BhaXJzID0gZW50cmllczsNCg0KICAvLyAjZW5kcmVnaW9uDQoNCiAgLy8gI3JlZ2lvbiBGdW5jdGlvbg0KDQogIGZ1bmN0aW9uIG1lbW9pemUoZm4sIHJlc29sdmVyKSB7DQogICAgdmFyIG1lbW9pemVkID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07Cg0KICAgICAgdmFyIGNhY2hlID0gbWVtb2l6ZWQuY2FjaGUsDQogICAgICAgIGFkZHIgPSByZXNvbHZlciA/IGFwcGx5KHJlc29sdmVyLCB0aGlzLCBhcmdzKSA6IGFyZ3NbMV07DQogICAgICBpZiAoIWNhY2hlLmhhcyhhZGRyKSkgew0KICAgICAgICBjYWNoZS5zZXQoYWRkciwgYXBwbHkoZm4sIHRoaXMsIGFyZ3MpKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBjYWNoZS5nZXQoYWRkcik7DQogICAgfTsNCiAgICBtZW1vaXplZC5jYWNoZSA9IG5ldyBNYXAoKTsNCiAgICByZXR1cm4gbWVtb2l6ZWQ7DQogIH0NCg0KICBmdW5jdGlvbiBwYXJ0aWFsKGZuKSB7CiAgICB2YXIgYm91bmRBcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGggLSAxOwogICAgd2hpbGUgKCBsZW4tLSA+IDAgKSBib3VuZEFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gKyAxIF07Cg0KICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgdmFyIF9hcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgIHdoaWxlICggbGVuLS0gKSBfYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdOwoNCiAgICAgIHZhciBpID0gMDsNCiAgICAgIHZhciBhcmdzID0gYm91bmRBcmdzLm1hcChmdW5jdGlvbiAoYXJnKSB7IHJldHVybiAoYXJnID09PSBwYXJ0aWFsLl8gPyBfYXJnc1tpKytdIDogYXJnKTsgfSk7DQogICAgICBhcmdzID0gYXJncy5jb25jYXQoX2FyZ3Muc2xpY2UoaSkpOw0KICAgICAgcmV0dXJuIGFwcGx5KGZuLCB0aGlzLCBhcmdzKTsNCiAgICB9Ow0KICB9DQogIHBhcnRpYWwuXyA9IHt9Ow0KDQogIGZ1bmN0aW9uIGN1cnJ5KGZuKSB7DQogICAgdmFyIGFyZ3NMZW4gPSBmbi5sZW5ndGgsDQogICAgICBhcmdzID0gW107DQogICAgdmFyIGN1cnJpZWQgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIF9hcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgIHdoaWxlICggbGVuLS0gKSBfYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdOwoNCiAgICAgIGFyZ3MgPSBbYXJncyBdLmNvbmNhdCggX2FyZ3MpOw0KICAgICAgaWYgKGFyZ3NMZW4gPT09IGFyZ3MubGVuZ3RoKSB7IHJldHVybiBhcHBseShmbiwgdGhpcywgYXJncyk7IH0NCiAgICAgIGVsc2UgeyByZXR1cm4gY3VycmllZDsgfQ0KICAgIH07DQogICAgcmV0dXJuIGFyZ3NMZW4gPCAyID8gZm4gOiBjdXJyaWVkOw0KICB9DQoNCiAgZnVuY3Rpb24gYXJ5KGZuLCBuKSB7DQogICAgcmV0dXJuIG4gPT0gbnVsbA0KICAgICAgPyBmbg0KICAgICAgOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgICAgICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdOwoNCiAgICAgICAgICByZXR1cm4gYXBwbHkoZm4sIHRoaXMsIGFyZ3Muc2xpY2UoMCwgbikpOw0KICAgICAgICB9Ow0KICB9DQoNCiAgZnVuY3Rpb24gd3JhcChmbiwgd3JhcHBlcikgew0KICAgIHdyYXBwZXIgfHwgKHdyYXBwZXIgPSBpZGVudGl0eSk7DQogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdOwoNCiAgICAgIHJldHVybiBhcHBseSh3cmFwcGVyLCB0aGlzLCBbZm4gXS5jb25jYXQoIGFyZ3MpKTsNCiAgICB9Ow0KICB9DQoNCiAgLy8gI2VuZHJlZ2lvbg0KDQogIC8vICNyZWdpb24gTWF0aA0KDQogIGZ1bmN0aW9uIHJhbmRvbShsb3dlciwgdXBwZXIpIHsNCiAgICBpZiAobG93ZXIgPT0gbnVsbCkgeyByZXR1cm4gTWF0aC5yYW5kb20oKTsgfQ0KICAgIGlmICh1cHBlciA9PSBudWxsKSB7DQogICAgICB1cHBlciA9IGxvd2VyOw0KICAgICAgbG93ZXIgPSAwOw0KICAgIH0NCiAgICBpZiAobG93ZXIgPiB1cHBlcikgew0KICAgICAgdmFyIHRlbXAgPSBsb3dlcjsNCiAgICAgIGxvd2VyID0gdXBwZXI7DQogICAgICB1cHBlciA9IHRlbXA7DQogICAgfQ0KICAgIHJldHVybiBsb3dlciArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICh1cHBlciAtIGxvd2VyICsgMSkpOw0KICB9DQoNCiAgZnVuY3Rpb24gc3VtKCkgew0KICAgIHZhciBhcnIgPSBhcmd1bWVudHMubGVuZ3RoID09PSAxID8gYXJndW1lbnRzWzBdIDogYXJndW1lbnRzOw0KICAgIHJldHVybiByZWR1Y2UoYXJyLCBmdW5jdGlvbiAocmVzdWx0LCBpdCkgeyByZXR1cm4gKHJlc3VsdCArPSBpdCk7IH0sIDApOw0KICB9DQoNCiAgZnVuY3Rpb24gYXZlcmFnZSgpIHsNCiAgICB2YXIgYXJyID0gYXJndW1lbnRzLmxlbmd0aCA9PT0gMSA/IGFyZ3VtZW50c1swXSA6IGFyZ3VtZW50czsNCiAgICB2YXIgbGVuID0gYXJyLmxlbmd0aDsNCiAgICByZXR1cm4gbGVuID09PSAwID8gMCA6IHN1bShhcnIpIC8gbGVuOw0KICB9DQoNCiAgdmFyIGF2ZyA9IGF2ZXJhZ2U7DQoNCiAgZnVuY3Rpb24gZGVjaW1hbEFkanVzdChtZXRob2ROYW1lLCBudW1iZXIsIHByZWNpc2lvbikgew0KICAgIGlmIChwcmVjaXNpb24pIHsNCiAgICAgIHZhciB2YWx1ZSA9IE1hdGhbbWV0aG9kTmFtZV0obnVtYmVyICsgJ2UnICsgcHJlY2lzaW9uKTsNCiAgICAgIHJldHVybiArKHZhbHVlICsgJ2UnICsgLXByZWNpc2lvbik7DQogICAgfQ0KICAgIHJldHVybiBNYXRoW21ldGhvZE5hbWVdKG51bWJlcik7DQogIH0NCg0KICBmdW5jdGlvbiByb3VuZChudW0sIHByZWNpc2lvbikgew0KICAgIHJldHVybiBkZWNpbWFsQWRqdXN0KCdyb3VuZCcsIG51bSwgcHJlY2lzaW9uKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGZsb29yKG51bSwgcHJlY2lzaW9uKSB7DQogICAgcmV0dXJuIGRlY2ltYWxBZGp1c3QoJ2Zsb29yJywgbnVtLCBwcmVjaXNpb24pOw0KICB9DQoNCiAgZnVuY3Rpb24gY2VpbChudW0sIHByZWNpc2lvbikgew0KICAgIHJldHVybiBkZWNpbWFsQWRqdXN0KCdjZWlsJywgbnVtLCBwcmVjaXNpb24pOw0KICB9DQoNCiAgZnVuY3Rpb24gcmFkaWFucyh4KSB7DQogICAgcmV0dXJuIChNYXRoLlBJIC8gMTgwKSAqIHg7DQogIH0NCg0KICAvLyAjZW5kcmVnaW9uDQoNCiAgLy8gI3JlZ2lvbiBTdHJpbmcNCg0KICBmdW5jdGlvbiB0b1VwcGVyKHgpIHsNCiAgICByZXR1cm4geC50b1VwcGVyQ2FzZSgpOw0KICB9DQoNCiAgZnVuY3Rpb24gdG9Mb3dlcih4KSB7DQogICAgcmV0dXJuIHgudG9Mb3dlckNhc2UoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHRyaW0oeCkgew0KICAgIHJldHVybiB4LnRyaW0oKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlcGVhdChzdHIsIG4pIHsNCiAgICB2YXIgcnN0ID0gJyc7DQogICAgaWYgKCFpc1N0cmluZyhzdHIpKSB7IHN0ciA9IFN0cmluZyhzdHIpOyB9DQogICAgaWYgKG4gPCAxIHx8ICFpc0Zpbml0ZShuKSkgeyByZXR1cm4gcnN0OyB9DQogICAgZG8gew0KICAgICAgaWYgKG4gJSAyKSB7IHJzdCArPSBzdHI7IH0NCiAgICAgIG4gPSBNYXRoLmZsb29yKG4gLyAyKTsNCiAgICAgIGlmIChuKSB7IHN0ciArPSBzdHI7IH0NCiAgICB9IHdoaWxlIChuKTsNCiAgICByZXR1cm4gcnN0Ow0KICB9DQoNCiAgZnVuY3Rpb24gY3JlYXRlUGFkZGluZyhsZW4sIGNocnMpIHsNCiAgICBjaHJzIHx8IChjaHJzID0gJyAnKTsNCiAgICB2YXIgcGFkID0gY2hycy5yZXBlYXQoTWF0aC5jZWlsKGxlbiAvIGNocnMubGVuZ3RoKSk7DQogICAgcmV0dXJuIHBhZC5sZW5ndGggPiBsZW4gPyBwYWQuc2xpY2UoMCwgbGVuKSA6IHBhZDsNCiAgfQ0KDQogIGZ1bmN0aW9uIHBhZFN0YXJ0KHN0ciwgbGVuLCBjaHJzKSB7DQogICAgaWYgKCFpc1N0cmluZyhzdHIpKSB7IHN0ciA9IFN0cmluZyhzdHIpOyB9DQogICAgdmFyIHN0ckxlbiA9IHN0ci5sZW5ndGg7DQogICAgaWYgKGxlbiA9PSBudWxsIHx8IGxlbiA8PSBzdHJMZW4pIHsgcmV0dXJuIHN0cjsgfQ0KICAgIHJldHVybiBjcmVhdGVQYWRkaW5nKGxlbiAtIHN0ckxlbiwgY2hycykgKyBzdHI7DQogIH0NCg0KICBmdW5jdGlvbiBwYWRFbmQoc3RyLCBsZW4sIGNocnMpIHsNCiAgICBpZiAoIWlzU3RyaW5nKHN0cikpIHsgc3RyID0gU3RyaW5nKHN0cik7IH0NCiAgICB2YXIgc3RyTGVuID0gc3RyLmxlbmd0aDsNCiAgICBpZiAobGVuID09IG51bGwgfHwgbGVuIDw9IHN0ckxlbikgeyByZXR1cm4gc3RyOyB9DQogICAgcmV0dXJuIHN0ciArIGNyZWF0ZVBhZGRpbmcobGVuIC0gc3RyTGVuLCBjaHJzKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHN0YXJ0c1dpdGgoc3RyLCB0YXJnZXQsIHBvcykgew0KICAgIHJldHVybiBzdHIuc3Vic3RyKCFwb3MgfHwgcG9zIDwgMCA/IDAgOiArcG9zLCB0YXJnZXQubGVuZ3RoKSA9PSB0YXJnZXQ7DQogIH0NCg0KICBmdW5jdGlvbiBlbmRzV2l0aChzdHIsIHRhcmdldCwgdGhpc19sZW4pIHsNCiAgICBpZiAodGhpc19sZW4gPT0gbnVsbCB8fCB0aGlzX2xlbiA+IHN0ci5sZW5ndGgpIHsgdGhpc19sZW4gPSBzdHIubGVuZ3RoOyB9DQogICAgcmV0dXJuIHN0ci5zdWJzdHJpbmcodGhpc19sZW4gLSB0YXJnZXQubGVuZ3RoLCB0aGlzX2xlbikgPT0gdGFyZ2V0Ow0KICB9DQoNCiAgZnVuY3Rpb24gZWFjaE1hdGNoKHN0ciwgcGF0dGVybiwgZm4pIHsNCiAgICBpZiAoIWlzU3RyaW5nKHN0cikgfHwgIWlzUmVnRXhwKHBhdHRlcm4pKSB7DQogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdpbnZhbGlkIGFyZ3VtZW50cycpOw0KICAgIH0NCiAgICBpZiAoIXBhdHRlcm4uZ2xvYmFsKSB7DQogICAgICBwYXR0ZXJuID0gUmVnRXhwKHBhdHRlcm4uc291cmNlLCAnZycpOw0KICAgIH0NCiAgICB2YXIgbWF0Y2g7DQogICAgZm9yICg7Oykgew0KICAgICAgbWF0Y2ggPSBwYXR0ZXJuLmV4ZWMoc3RyKTsNCiAgICAgIGlmICghbWF0Y2gpIHsgYnJlYWs7IH0NCiAgICAgIGlmIChhcHBseShmbiwgbnVsbCwgbWF0Y2gpID09PSBmYWxzZSkgeyBicmVhazsgfQ0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIGZpbmRBbGwoc3RyLCBwYXR0ZXJuKSB7CiAgICB2YXIgYXJndW1lbnRzJDEgPSBhcmd1bWVudHM7Cg0KICAgIHZhciByc3QgPSBbXTsNCiAgICBlYWNoTWF0Y2goc3RyLCBwYXR0ZXJuLCBmdW5jdGlvbiAoKSB7DQogICAgICByc3QucHVzaChhcmd1bWVudHMkMS5sZW5ndGggPT0gMSA/IGFyZ3VtZW50cyQxWzBdIDogYXJndW1lbnRzJDEpOw0KICAgIH0pOw0KICAgIHJldHVybiByc3Q7DQogIH0NCiAgLy8gI2VuZHJlZ2lvbgoKICB2YXIgdG9vbCA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgIGNocjogY2hyLAogICAgb3JkOiBvcmQsCiAgICBoZXg6IGhleCwKICAgIGJpbjogYmluLAogICAgb2N0OiBvY3QsCiAgICBpbnQ6IGludCwKICAgIGdldEZ1bmNOYW1lOiBnZXRGdW5jTmFtZSwKICAgIGdldFRhZzogZ2V0VGFnLAogICAgdHlwZU9mOiB0eXBlT2YsCiAgICB0eXBlOiB0eXBlLAogICAgaGFzOiBoYXMkMSwKICAgIGlzQXJyYXk6IGlzQXJyYXksCiAgICBpc09iamVjdDogaXNPYmplY3QsCiAgICBpc0Z1bmN0aW9uOiBpc0Z1bmN0aW9uLAogICAgaXNTdHJpbmc6IGlzU3RyaW5nLAogICAgaXNOdW1iZXI6IGlzTnVtYmVyLAogICAgaXNCb29sZWFuOiBpc0Jvb2xlYW4sCiAgICBpc0RhdGU6IGlzRGF0ZSwKICAgIGlzUmVnRXhwOiBpc1JlZ0V4cCwKICAgIGlzRXJyb3I6IGlzRXJyb3IsCiAgICBpc01hcDogaXNNYXAsCiAgICBpc1NldDogaXNTZXQsCiAgICBpc1dlYWtNYXA6IGlzV2Vha01hcCwKICAgIGlzSW50ZWdlcjogaXNJbnRlZ2VyLAogICAgaXNBcmd1bWVudHM6IGlzQXJndW1lbnRzLAogICAgaXNPYmplY3RMaWtlOiBpc09iamVjdExpa2UsCiAgICBpc0xlbmd0aDogaXNMZW5ndGgsCiAgICBpc0FycmF5TGlrZTogaXNBcnJheUxpa2UsCiAgICBpc0VtcHR5OiBpc0VtcHR5LAogICAgaXNCdWZmZXI6IGlzQnVmZmVyLAogICAgYXBwbHk6IGFwcGx5LAogICAgcmFuZ2U6IHJhbmdlLAogICAgdG9QYXRoOiB0b1BhdGgsCiAgICBpZGVudGl0eTogaWRlbnRpdHksCiAgICBpdGVyYXRlZTogaXRlcmF0ZWUsCiAgICBlYWNoOiBlYWNoLAogICAgZm9yRWFjaDogZm9yRWFjaCwKICAgIG1hcDogbWFwLAogICAgc2VsZWN0OiBzZWxlY3QsCiAgICByZWR1Y2U6IHJlZHVjZSwKICAgIGZpbHRlcjogZmlsdGVyLAogICAgd2hlcmU6IHdoZXJlLAogICAgdG9BcnJheTogdG9BcnJheSwKICAgIGZpbmQ6IGZpbmQsCiAgICBmaW5kSW5kZXg6IGZpbmRJbmRleCwKICAgIGZpbGw6IGZpbGwsCiAgICBncm91cEJ5OiBncm91cEJ5LAogICAgY291bnRCeTogY291bnRCeSwKICAgIHNpemU6IHNpemUsCiAgICBsZW46IGxlbiwKICAgIHVuaXFCeTogdW5pcUJ5LAogICAgdW5pcTogdW5pcSwKICAgIGRpc3RpbmN0OiBkaXN0aW5jdCwKICAgIGRpc3RpbmN0Qnk6IGRpc3RpbmN0QnksCiAgICBjaHVuazogY2h1bmssCiAgICBjb25jYXQ6IGNvbmNhdCwKICAgIHNsaWNlOiBzbGljZSwKICAgIGRyb3A6IGRyb3AsCiAgICB0YWlsOiB0YWlsLAogICAgaW5pdGlhbDogaW5pdGlhbCwKICAgIHRha2U6IHRha2UsCiAgICB0YWtlUmlnaHQ6IHRha2VSaWdodCwKICAgIGNvbnRhaW5zOiBjb250YWlucywKICAgIGluY2x1ZGU6IGluY2x1ZGUsCiAgICBpbmNsdWRlczogaW5jbHVkZXMsCiAgICBmaXJzdDogZmlyc3QsCiAgICBoZWFkOiBoZWFkLAogICAgbGFzdDogbGFzdCwKICAgIG50aDogbnRoLAogICAgcHVsbEFsbDogcHVsbEFsbCwKICAgIHB1bGw6IHB1bGwsCiAgICByZW1vdmU6IHJlbW92ZSwKICAgIGRpZmZlcmVuY2U6IGRpZmZlcmVuY2UsCiAgICB1bnppcDogdW56aXAsCiAgICB6aXA6IHppcCwKICAgIGZsYXR0ZW46IGZsYXR0ZW4sCiAgICBrZXlzOiBrZXlzLAogICAgdmFsdWVzOiB2YWx1ZXMsCiAgICBrZXlzSW46IGtleXNJbiwKICAgIHZhbHVlc0luOiB2YWx1ZXNJbiwKICAgIHppcE9iamVjdDogemlwT2JqZWN0LAogICAgZnJvbVBhaXJzOiBmcm9tUGFpcnMsCiAgICBvYmplY3Q6IG9iamVjdCwKICAgIGdldDogZ2V0LAogICAgYXQ6IGF0LAogICAgcHJvcGVydHlPZjogcHJvcGVydHlPZiwKICAgIHByb3BlcnR5OiBwcm9wZXJ0eSwKICAgIHByb3BlcnRpZXM6IHByb3BlcnRpZXMsCiAgICBzZXQ6IHNldCwKICAgIHVuc2V0OiB1bnNldCwKICAgIHVwZGF0ZTogdXBkYXRlLAogICAgcGljazogcGljaywKICAgIGlzTWF0Y2g6IGlzTWF0Y2gsCiAgICBtYXRjaGVzOiBtYXRjaGVzLAogICAgbWF0Y2hlcjogbWF0Y2hlciwKICAgIGFzc2lnbjogYXNzaWduLAogICAgYXNzaWduSW46IGFzc2lnbkluLAogICAgZXh0ZW5kOiBleHRlbmQsCiAgICBkZWZhdWx0czogZGVmYXVsdHMsCiAgICBlbnRyaWVzOiBlbnRyaWVzLAogICAgdG9QYWlyczogdG9QYWlycywKICAgIG1lbW9pemU6IG1lbW9pemUsCiAgICBwYXJ0aWFsOiBwYXJ0aWFsLAogICAgY3Vycnk6IGN1cnJ5LAogICAgYXJ5OiBhcnksCiAgICB3cmFwOiB3cmFwLAogICAgcmFuZG9tOiByYW5kb20sCiAgICBzdW06IHN1bSwKICAgIGF2ZXJhZ2U6IGF2ZXJhZ2UsCiAgICBhdmc6IGF2ZywKICAgIHJvdW5kOiByb3VuZCwKICAgIGZsb29yOiBmbG9vciwKICAgIGNlaWw6IGNlaWwsCiAgICByYWRpYW5zOiByYWRpYW5zLAogICAgdG9VcHBlcjogdG9VcHBlciwKICAgIHRvTG93ZXI6IHRvTG93ZXIsCiAgICB0cmltOiB0cmltLAogICAgcmVwZWF0OiByZXBlYXQsCiAgICBwYWRTdGFydDogcGFkU3RhcnQsCiAgICBwYWRFbmQ6IHBhZEVuZCwKICAgIHN0YXJ0c1dpdGg6IHN0YXJ0c1dpdGgsCiAgICBlbmRzV2l0aDogZW5kc1dpdGgsCiAgICBlYWNoTWF0Y2g6IGVhY2hNYXRjaCwKICAgIGZpbmRBbGw6IGZpbmRBbGwKICB9KTsKCiAgZnVuY3Rpb24gbG9nKG1zZykgewogICAgaWYgKCBtc2cgPT09IHZvaWQgMCApIG1zZyA9ICcnOwoNCiAgICBXU2NyaXB0LkVjaG8obXNnKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGluaGVyaXRzKGN0b3IsIHN1cGVyQ3Rvcikgew0KICAgIGN0b3Iuc3VwZXJfID0gc3VwZXJDdG9yOw0KICAgIGN0b3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckN0b3IucHJvdG90eXBlLCB7DQogICAgICBjb25zdHJ1Y3RvcjogY3Rvcg0KICAgIH0pOw0KICB9DQoNCiAgdmFyIEZNVF9SRUcgPSAvJVtzZGlmam9PJV0vZzsNCg0KICBmdW5jdGlvbiBmb3JtYXQoZikgew0KICAgIGlmICghaXNTdHJpbmcoZikpIHsNCiAgICAgIHJldHVybiBtYXAoYXJndW1lbnRzLCBmdW5jdGlvbiAoYXJnKSB7IHJldHVybiBpbnNwZWN0KGFyZyk7IH0pLmpvaW4oJyAnKTsNCiAgICB9DQoNCiAgICB2YXIgaSA9IDEsDQogICAgICBhcmdzID0gYXJndW1lbnRzLA0KICAgICAgbGVuID0gYXJncy5sZW5ndGgsDQogICAgICBzdHIgPSBmLnJlcGxhY2UoRk1UX1JFRywgZnVuY3Rpb24gKHgpIHsNCiAgICAgICAgaWYgKHggPT09ICclJScpIHsgcmV0dXJuICclJzsgfQ0KICAgICAgICBpZiAoaSA+PSBsZW4pIHsgcmV0dXJuIHg7IH0NCiAgICAgICAgc3dpdGNoICh4KSB7DQogICAgICAgICAgY2FzZSAnJXMnOg0KICAgICAgICAgIGNhc2UgJyVkJzoNCiAgICAgICAgICBjYXNlICclaSc6DQogICAgICAgICAgY2FzZSAnJWYnOg0KICAgICAgICAgICAgcmV0dXJuIGFyZ3NbaSsrXTsNCiAgICAgICAgICBjYXNlICclaic6DQogICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoYXJnc1tpKytdKTsNCiAgICAgICAgICBjYXNlICclbyc6DQogICAgICAgICAgY2FzZSAnJU8nOg0KICAgICAgICAgICAgcmV0dXJuIGluc3BlY3QoYXJnc1tpKytdKTsNCiAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgcmV0dXJuIHg7DQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgIGZvciAodmFyIHggPSBhcmdzW2ldOyBpIDwgbGVuOyB4ID0gYXJnc1srK2ldKSB7DQogICAgICBpZiAoaXNQcmltaXRpdmUoeCkpIHsgc3RyICs9ICcgJyArIHg7IH0NCiAgICAgIGVsc2UgeyBzdHIgKz0gJyAnICsgaW5zcGVjdCh4KTsgfQ0KICAgIH0NCiAgICByZXR1cm4gc3RyOw0KICB9DQoNCiAgLy8gTWFyayB0aGF0IGEgbWV0aG9kIHNob3VsZCBub3QgYmUgdXNlZC4NCiAgLy8gUmV0dXJucyBhIG1vZGlmaWVkIGZ1bmN0aW9uIHdoaWNoIHdhcm5zIG9uY2UgYnkgZGVmYXVsdC4NCiAgLy8gSWYgLS1uby1kZXByZWNhdGlvbiBpcyBzZXQsIHRoZW4gaXQgaXMgYSBuby1vcC4NCiAgZnVuY3Rpb24gZGVwcmVjYXRlKGZuLCBtc2cpIHsKICAgIHZhciBhcmd1bWVudHMkMSA9IGFyZ3VtZW50czsKDQogICAgLy8gQWxsb3cgZm9yIGRlcHJlY2F0aW5nIHRoaW5ncyBpbiB0aGUgcHJvY2VzcyBvZiBzdGFydGluZyB1cC4NCiAgICBpZiAoZ2xvYmFsLnByb2Nlc3MgPT09IHZvaWQgMCkgew0KICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsgcmV0dXJuIGFwcGx5KGRlcHJlY2F0ZShmbiwgbXNnKSwgbnVsbCwgYXJndW1lbnRzJDEpOyB9Ow0KICAgIH0NCg0KICAgIGlmIChwcm9jZXNzLm5vRGVwcmVjYXRpb24gPT09IHRydWUpIHsgcmV0dXJuIGZuOyB9DQoNCiAgICB2YXIgd2FybmVkID0gZmFsc2U7DQoNCiAgICBmdW5jdGlvbiBkZXByZWNhdGVkKCkgew0KICAgICAgaWYgKCF3YXJuZWQpIHsNCiAgICAgICAgaWYgKHByb2Nlc3MudGhyb3dEZXByZWNhdGlvbikgeyB0aHJvdyBuZXcgRXJyb3IobXNnKTsgfQ0KICAgICAgICBlbHNlIGlmIChwcm9jZXNzLnRyYWNlRGVwcmVjYXRpb24pIHsgbG9nKG1zZyk7IH0NCiAgICAgICAgZWxzZSB7IGxvZyhtc2cpOyB9DQogICAgICAgIHdhcm5lZCA9IHRydWU7DQogICAgICB9DQogICAgICByZXR1cm4gYXBwbHkoZm4sIG51bGwsIGFyZ3VtZW50cyk7DQogICAgfQ0KDQogICAgcmV0dXJuIGRlcHJlY2F0ZWQ7DQogIH0NCg0KICB2YXIgZGVidWdzID0ge307DQogIHZhciBkZWJ1Z0Vudmlyb247DQoNCiAgZnVuY3Rpb24gZGVidWdsb2coc2V0KSB7CiAgICB2YXIgYXJndW1lbnRzJDEgPSBhcmd1bWVudHM7Cg0KICAgIGlmIChkZWJ1Z0Vudmlyb24gPT0gbnVsbCkgeyBkZWJ1Z0Vudmlyb24gPSBwcm9jZXNzLmVudi5OT0RFX0RFQlVHIHx8ICcnOyB9DQogICAgc2V0ID0gc2V0LnRvVXBwZXJDYXNlKCk7DQogICAgaWYgKCFkZWJ1Z3Nbc2V0XSkgew0KICAgICAgaWYgKG5ldyBSZWdFeHAoJ1xcYicgKyBzZXQgKyAnXFxiJywgJ2knKS50ZXN0KGRlYnVnRW52aXJvbikpIHsNCiAgICAgICAgdmFyIHBpZCA9IHByb2Nlc3MucGlkOw0KICAgICAgICBkZWJ1Z3Nbc2V0XSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICB2YXIgbXNnID0gYXBwbHkoZm9ybWF0LCBudWxsLCBhcmd1bWVudHMkMSk7DQogICAgICAgICAgbG9nKChzZXQgKyAiICIgKyBwaWQgKyAiOiAiICsgbXNnKSk7DQogICAgICAgIH07DQogICAgICB9IGVsc2Ugew0KICAgICAgICBkZWJ1Z3Nbc2V0XSA9IGZ1bmN0aW9uKCkge307DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiBkZWJ1Z3Nbc2V0XTsNCiAgfQ0KDQogIC8qIG9iaiwgWyBzaG93SGlkZGVuL29wdGlvbnMsIGRlcHRoLCBjb2xvcnMgXSAqLw0KICBmdW5jdGlvbiBpbnNwZWN0KG9iaiwgc2hvd0hpZGRlbiwgZGVwdGgsIGNvbG9ycykgew0KICAgIC8vIGRlZmF1bHQgb3B0aW9ucw0KICAgIHZhciBjdHggPSB7DQogICAgICBzZWVuOiBbXSwNCiAgICAgIC8vIHN0eWxpemU6IHN0eWxpemVOb0NvbG9yLA0KICAgICAgc2hvd0hpZGRlbjogZmFsc2UsDQogICAgICBkZXB0aDogMiwNCiAgICAgIGNvbG9yczogZmFsc2UsDQogICAgICBjdXN0b21JbnNwZWN0OiBmYWxzZSwNCiAgICAgIG1heEFycmF5TGVuZ3RoOiAxMDAsDQogICAgICBicmVha0xlbmd0aDogNjANCiAgICB9Ow0KICAgIGlmIChpc0Jvb2xlYW4oc2hvd0hpZGRlbikpIHsgY3R4LnNob3dIaWRkZW4gPSBzaG93SGlkZGVuOyB9DQogICAgaWYgKGlzTnVtYmVyKGRlcHRoKSkgeyBjdHguZGVwdGggPSBkZXB0aDsgfQ0KICAgIGlmIChpc0Jvb2xlYW4oY29sb3JzKSkgeyBjdHguY29sb3JzID0gY29sb3JzOyB9DQogICAgaWYgKGlzT2JqZWN0KHNob3dIaWRkZW4pKSB7DQogICAgICAvLyBnb3QgYW4gIm9wdGlvbnMiIG9iamVjdA0KICAgICAgT2JqZWN0LmFzc2lnbihjdHgsIHNob3dIaWRkZW4pOw0KICAgIH0NCiAgICByZXR1cm4gZm9ybWF0VmFsdWUoY3R4LCBvYmosIDApOw0KICB9DQoNCiAgZnVuY3Rpb24gZm9ybWF0VmFsdWUoY3R4LCB2YWx1ZSwgcmVjdXJzZVRpbWVzKSB7DQogICAgdmFyIHJlc3VsdDsNCiAgICAvLyBQcm92aWRlIGEgaG9vayBmb3IgdXNlci1zcGVjaWZpZWQgaW5zcGVjdCBmdW5jdGlvbnMuDQogICAgLy8gQ2hlY2sgdGhhdCB2YWx1ZSBpcyBhbiBvYmplY3Qgd2l0aCBhbiBpbnNwZWN0IGZ1bmN0aW9uIG9uIGl0DQogICAgaWYgKA0KICAgICAgY3R4LmN1c3RvbUluc3BlY3QgJiYNCiAgICAgIHZhbHVlICYmDQogICAgICBpc0Z1bmN0aW9uKHZhbHVlLmluc3BlY3QpICYmDQogICAgICAvLyBGaWx0ZXIgb3V0IHRoZSB1dGlsIG1vZHVsZSwgaXQncyBpbnNwZWN0IGZ1bmN0aW9uIGlzIHNwZWNpYWwNCiAgICAgIHZhbHVlLmluc3BlY3QgIT09IGluc3BlY3QgJiYNCiAgICAgIC8vIEFsc28gZmlsdGVyIG91dCBhbnkgcHJvdG90eXBlIG9iamVjdHMgdXNpbmcgdGhlIGNpcmN1bGFyIGNoZWNrLg0KICAgICAgISh2YWx1ZS5jb25zdHJ1Y3RvciAmJiB2YWx1ZS5jb25zdHJ1Y3Rvci5wcm90b3R5cGUgPT09IHZhbHVlKQ0KICAgICkgew0KICAgICAgcmVzdWx0ID0gdmFsdWUuaW5zcGVjdChyZWN1cnNlVGltZXMsIGN0eCk7DQogICAgICBpZiAoIWlzU3RyaW5nKHJlc3VsdCkpIHsNCiAgICAgICAgcmVzdWx0ID0gZm9ybWF0VmFsdWUoY3R4LCByZXN1bHQsIHJlY3Vyc2VUaW1lcyk7DQogICAgICB9DQogICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIC8vIFByaW1pdGl2ZSB0eXBlcyBjYW5ub3QgaGF2ZSBwcm9wZXJ0aWVzDQogICAgcmVzdWx0ID0gZm9ybWF0VmFsdWVfc2ltcGxlKHZhbHVlKTsNCiAgICBpZiAocmVzdWx0ICE9PSBmYWxzZSkgeyByZXR1cm4gcmVzdWx0OyB9DQoNCiAgICAvLyBMb29rIHVwIHRoZSBrZXlzIG9mIHRoZSBvYmplY3QuDQogICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyh2YWx1ZSk7DQogICAgdmFyIHZpc2libGVLZXlzID0ga2V5cy5yZWR1Y2UoZnVuY3Rpb24gKG1lbW8sIGtleSkgeyByZXR1cm4gKChtZW1vW2tleV0gPSB0cnVlKSwgbWVtbyk7IH0sIHt9KTsNCg0KICAgIGlmIChjdHguc2hvd0hpZGRlbikgew0KICAgICAga2V5cyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHZhbHVlKTsNCiAgICB9DQoNCiAgICBpZiAocmVjdXJzZVRpbWVzID4gY3R4LmRlcHRoKSB7IHJldHVybiBnZXRUYWcodmFsdWUpOyB9DQoNCiAgICBjdHguc2Vlbi5wdXNoKHZhbHVlKTsNCg0KICAgIHZhciBvdXRwdXQsDQogICAgICB2VHlwZSA9IHR5cGVPZih2YWx1ZSk7DQogICAgb3V0cHV0ID0gZm9ybWF0T2JqZWN0KGN0eCwgdmFsdWUsIHJlY3Vyc2VUaW1lcywgdmlzaWJsZUtleXMsIGtleXMsIHZUeXBlKTsNCiAgICBjdHguc2Vlbi5wb3AoKTsNCg0KICAgIHJldHVybiByZWR1Y2VUb1NpbmdsZVN0cmluZyhjdHgsIG91dHB1dCwgcmVjdXJzZVRpbWVzLCB2VHlwZSk7DQogIH0NCg0KICB2YXIgRVNDQVBTRV9NQVAgPSB7DQogICAgIiciOiAiJyIsDQogICAgJ1xcJzogJ1xcJywNCiAgICAnXHInOiAncicsDQogICAgJ1xuJzogJ24nLA0KICAgICdcdTIwMjgnOiAndTIwMjgnLA0KICAgICdcdTIwMjknOiAndTIwMjknDQogIH07DQoNCiAgdmFyIEVTQ0FQU0VfUkVHID0gLyd8XFx8XHJ8XG58XHUyMDI4fFx1MjAyOV0vZzsNCg0KICBmdW5jdGlvbiBlc2NhcGVDaGFyKGMpIHsNCiAgICByZXR1cm4gJ1xcJyArIEVTQ0FQU0VfTUFQW2NdOw0KICB9DQoNCiAgZnVuY3Rpb24gZm9ybWF0VmFsdWVfc2ltcGxlKHZhbHVlKSB7DQogICAgaWYgKHZhbHVlID09PSB2b2lkIDApIHsgcmV0dXJuICd1bmRlZmluZWQnOyB9DQogICAgaWYgKHZhbHVlID09PSBudWxsKSB7IHJldHVybiAnbnVsbCc7IH0NCiAgICBzd2l0Y2ggKHR5cGVPZih2YWx1ZSkpIHsNCiAgICAgIGNhc2UgJ3N0cmluZyc6DQogICAgICAgIHJldHVybiAiJyIgKyB2YWx1ZS5yZXBsYWNlKEVTQ0FQU0VfUkVHLCBlc2NhcGVDaGFyKSArICInIjsNCiAgICAgIGNhc2UgJ251bWJlcic6DQogICAgICBjYXNlICdib29sZWFuJzoNCiAgICAgIGNhc2UgJ3JlZ2V4cCc6DQogICAgICAgIHJldHVybiBTdHJpbmcodmFsdWUpOw0KICAgICAgY2FzZSAnZGF0ZSc6DQogICAgICAgIHJldHVybiB2YWx1ZS50b0pTT04oKTsNCiAgICAgIGNhc2UgJ2Z1bmN0aW9uJzogew0KICAgICAgICB2YXIgbmFtZSA9IGdldEZ1bmNOYW1lKHZhbHVlKTsNCiAgICAgICAgcmV0dXJuIG5hbWUgPyAnW0Z1bmN0aW9uOiAnICsgbmFtZSArICddJyA6ICdbRnVuY3Rpb25dJzsNCiAgICAgIH0NCiAgICAgIGNhc2UgJ2Vycm9yJzoNCiAgICAgICAgcmV0dXJuICdbJyArIHZhbHVlICsgJ10nOw0KICAgICAgY2FzZSAnYnVmZmVyJzogew0KICAgICAgICB2YXIgYnl0ZXMgPSB2YWx1ZS5idWZmZXIsDQogICAgICAgICAgbGVuID0gdmFsdWUubGVuZ3RoLA0KICAgICAgICAgIGkgPSAtMSwNCiAgICAgICAgICBvdmVyZmxvdywNCiAgICAgICAgICBhcnI7DQogICAgICAgIGlmIChsZW4gPiA1MCkgew0KICAgICAgICAgIG92ZXJmbG93ID0gdHJ1ZTsNCiAgICAgICAgICBsZW4gPSA1MDsNCiAgICAgICAgICBhcnIgPSBBcnJheSg1MSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgYXJyID0gQXJyYXkobGVuKTsNCiAgICAgICAgfQ0KICAgICAgICB3aGlsZSAoKytpIDwgbGVuKSB7IGFycltpXSA9IGhleChieXRlcy5nZXRJdGVtKGkpKTsgfQ0KICAgICAgICBpZiAob3ZlcmZsb3cpIHsgYXJyWzUwXSA9ICcuLi4nOyB9DQogICAgICAgIHJldHVybiAnPEJ1ZmZlciAnICsgYXJyLmpvaW4oJyAnKSArICc+JzsNCiAgICAgIH0NCiAgICAgIGRlZmF1bHQ6DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBmb3JtYXRPYmplY3QoY3R4LCBvYmosIHJlY3Vyc2VUaW1lcywgdmlzaWJsZUtleXMsIGtleXMsIHZUeXBlKSB7DQogICAgdmFyIG91dHB1dCA9IFtdLA0KICAgICAgaSA9IDAsDQogICAgICBsZW4sDQogICAgICBrZXk7DQogICAgaWYgKHZUeXBlID09ICdhcnJheScpIHsNCiAgICAgIGxlbiA9IG9iai5sZW5ndGg7DQogICAgICBmb3IgKDsgaSA8IGxlbjsgaSsrKSB7DQogICAgICAgIGlmIChpID49IGN0eC5tYXhBcnJheUxlbmd0aCkgew0KICAgICAgICAgIG91dHB1dC5wdXNoKCcuLi4gJyArIChsZW4gLSBjdHgubWF4QXJyYXlMZW5ndGgpICsgJyBtb3JlIGl0ZW1zJyk7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgICAgb3V0cHV0LnB1c2goZm9ybWF0UHJvcGVydHkoY3R4LCBvYmpbaV0sIHJlY3Vyc2VUaW1lcywgbnVsbCwgdHJ1ZSwgbnVsbCkpOw0KICAgICAgfQ0KICAgICAgaSA9IGxlbjsNCiAgICB9IGVsc2UgaWYgKHZUeXBlID09ICdtYXAnKSB7DQogICAgICBvYmouZm9yRWFjaChmdW5jdGlvbiAodmFsdWUsIGtleSkgew0KICAgICAgICBvdXRwdXQucHVzaChmb3JtYXRQcm9wZXJ0eShjdHgsIHZhbHVlLCByZWN1cnNlVGltZXMsIGtleSwgdHJ1ZSwgJyA9PiAnKSk7DQogICAgICB9KTsNCiAgICB9IGVsc2UgaWYgKHZUeXBlID09ICdzZXQnKSB7DQogICAgICBvYmouZm9yRWFjaChmdW5jdGlvbiAodmFsdWUpIHsNCiAgICAgICAgb3V0cHV0LnB1c2goZm9ybWF0UHJvcGVydHkoY3R4LCB2YWx1ZSwgcmVjdXJzZVRpbWVzLCBudWxsLCB0cnVlLCBudWxsKSk7DQogICAgICB9KTsNCiAgICB9DQoNCiAgICBmb3IgKGxlbiA9IGtleXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCiAgICAgIGtleSA9IGtleXNbaV07DQogICAgICBvdXRwdXQucHVzaCgNCiAgICAgICAgZm9ybWF0UHJvcGVydHkoY3R4LCBvYmpba2V5XSwgcmVjdXJzZVRpbWVzLCBrZXksIHZpc2libGVLZXlzW2tleV0sICc6ICcpDQogICAgICApOw0KICAgIH0NCiAgICByZXR1cm4gb3V0cHV0Ow0KICB9DQoNCiAgZnVuY3Rpb24gZm9ybWF0UHJvcGVydHkoY3R4LCB2YWx1ZSwgcmVjdXJzZVRpbWVzLCBrZXksIGVudW1lcmFibGUsIHNlcCkgew0KICAgIHZhciBuYW1lLCBzdHI7DQoNCiAgICBpZiAoY3R4LnNlZW4uaW5kZXhPZih2YWx1ZSkgPT09IC0xKSB7DQogICAgICBzdHIgPSBmb3JtYXRWYWx1ZShjdHgsIHZhbHVlLCByZWN1cnNlVGltZXMgKyAxKTsNCiAgICB9IGVsc2Ugew0KICAgICAgc3RyID0gJ1tDaXJjdWxhcl0nOw0KICAgIH0NCg0KICAgIGlmIChrZXkgPT0gbnVsbCkgeyByZXR1cm4gc3RyOyB9DQoNCiAgICBuYW1lID0gZW51bWVyYWJsZSA/IFN0cmluZyhrZXkpIDogJ1snICsga2V5ICsgJ10nOw0KDQogICAgaWYgKCEvXlx3KyQvLnRlc3QobmFtZSkpIHsNCiAgICAgIG5hbWUgPSAiJyIgKyBuYW1lLnJlcGxhY2UoLycvZywgIlxcJyIpICsgIiciOw0KICAgIH0NCg0KICAgIHJldHVybiBuYW1lICsgc2VwICsgc3RyOw0KICB9DQoNCiAgZnVuY3Rpb24gcmVkdWNlVG9TaW5nbGVTdHJpbmcoY3R4LCBvdXRwdXQsIHJlY3Vyc2VUaW1lcywgdlR5cGUpIHsNCiAgICB2YXIgYnJhY2VzLA0KICAgICAgaW5kZW50LA0KICAgICAgYnJlYWtMaW5lID0gZmFsc2UsDQogICAgICBsZW4gPSBvdXRwdXQubGVuZ3RoLA0KICAgICAgaSA9IC0xLA0KICAgICAgY291bnQgPSAwOw0KICAgIGlmICh2VHlwZSA9PSAnYXJyYXknKSB7IGJyYWNlcyA9IFsnWycsICddJ107IH0NCiAgICBlbHNlIGlmICh2VHlwZSA9PSAnbWFwJykgeyBicmFjZXMgPSBbJ01hcCB7JywgJ30nXTsgfQ0KICAgIGVsc2UgaWYgKHZUeXBlID09ICdzZXQnKSB7IGJyYWNlcyA9IFsnU2V0IHsnLCAnfSddOyB9DQogICAgZWxzZSBpZiAodlR5cGUgPT0gJ2FyZ3VtZW50cycpIHsgYnJhY2VzID0gWydbQXJndW1lbnRzXSB7JywgJ30nXTsgfQ0KICAgIGVsc2UgeyBicmFjZXMgPSBbJ3snLCAnfSddOyB9DQoNCiAgICBpZiAobGVuID09IDApIHsgcmV0dXJuIGJyYWNlc1swXSArIGJyYWNlc1sxXTsgfQ0KDQogICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgY291bnQgKz0gb3V0cHV0W2ldLmxlbmd0aCArIDE7DQogICAgICBpZiAoY291bnQgPiBjdHguYnJlYWtMZW5ndGgpIHsNCiAgICAgICAgYnJlYWtMaW5lID0gdHJ1ZTsNCiAgICAgICAgYnJlYWs7DQogICAgICB9DQogICAgfQ0KDQogICAgbGVuID0gb3V0cHV0LnJlZHVjZShmdW5jdGlvbiAobWVtbywgY3VyKSB7IHJldHVybiBtZW1vICsgY3VyLmxlbmd0aCArIDE7IH0sIDApOw0KICAgIGluZGVudCA9IHJlcGVhdCgnICAnLCByZWN1cnNlVGltZXMpOw0KICAgIGlmIChicmVha0xpbmUpIHsNCiAgICAgIHJldHVybiB2VHlwZSA9PSAnYXJyYXknDQogICAgICAgID8gYnJhY2VzWzBdICsgJyAnICsgb3V0cHV0LmpvaW4oJyxcclxuICAnICsgaW5kZW50KSArICcgJyArIGJyYWNlc1sxXQ0KICAgICAgICA6IGJyYWNlc1swXSArDQogICAgICAgICAgICAnIFxyXG4gICcgKw0KICAgICAgICAgICAgaW5kZW50ICsNCiAgICAgICAgICAgIG91dHB1dC5qb2luKCcsXHJcbiAgJyArIGluZGVudCkgKw0KICAgICAgICAgICAgJyAnICsNCiAgICAgICAgICAgIGJyYWNlc1sxXTsNCiAgICB9DQogICAgcmV0dXJuIGJyYWNlc1swXSArICcgJyArIG91dHB1dC5qb2luKCcsICcpICsgJyAnICsgYnJhY2VzWzFdOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNQcmltaXRpdmUodmFsdWUpIHsNCiAgICByZXR1cm4gIWlzT2JqZWN0KHZhbHVlKTsNCiAgfQoKICB2YXIgdXRpbCA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgIGluaGVyaXRzOiBpbmhlcml0cywKICAgIGZvcm1hdDogZm9ybWF0LAogICAgZGVwcmVjYXRlOiBkZXByZWNhdGUsCiAgICBkZWJ1Z2xvZzogZGVidWdsb2csCiAgICBpbnNwZWN0OiBpbnNwZWN0LAogICAgaXNQcmltaXRpdmU6IGlzUHJpbWl0aXZlCiAgfSk7CgogIHZhciBDb25zb2xlID0gZnVuY3Rpb24gQ29uc29sZShzdGRvdXQsIHN0ZGVycikgew0KICAgIGlmICghc3Rkb3V0IHx8ICEoJ1dyaXRlJyBpbiBzdGRvdXQpKSB7DQogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvbnNvbGUgZXhwZWN0cyBhIHdyaXRhYmxlIHN0cmVhbSBpbnN0YW5jZScpOw0KICAgIH0NCiAgICBpZiAoIXN0ZGVycikgeyBzdGRlcnIgPSBzdGRvdXQ7IH0NCiAgICB0aGlzLl9zdGRvdXQgPSBzdGRvdXQ7DQogICAgdGhpcy5fc3RkZXJyID0gc3RkZXJyOw0KICAgIHRoaXMuX3RpbWVzID0ge307DQoNCiAgICBmb3IgKHZhciBrZXkgaW4gQ29uc29sZS5wcm90b3R5cGUpIHsNCiAgICAgIHRoaXNba2V5XSA9IHRoaXNba2V5XS5iaW5kKHRoaXMpOw0KICAgIH0NCiAgfTsNCg0KICBDb25zb2xlLnByb3RvdHlwZS5sb2cgPSBmdW5jdGlvbiBsb2cgKCkgewogICAgICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdOwoNCiAgICB0aGlzLl9zdGRvdXQuV3JpdGVMaW5lKGZvcm1hdC5hcHBseSh2b2lkIDAsIGFyZ3MpKTsNCiAgfTsNCg0KICBDb25zb2xlLnByb3RvdHlwZS5pbmZvID0gZnVuY3Rpb24gaW5mbyAoKSB7CiAgICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07Cg0KICAgIHRoaXMuX3N0ZG91dC5Xcml0ZUxpbmUoZm9ybWF0LmFwcGx5KHZvaWQgMCwgYXJncykpOw0KICB9Ow0KDQogIENvbnNvbGUucHJvdG90eXBlLndhcm4gPSBmdW5jdGlvbiB3YXJuICgpIHsKICAgICAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDsKICAgICAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTsKDQogICAgdGhpcy5fc3RkZXJyLldyaXRlTGluZShmb3JtYXQuYXBwbHkodm9pZCAwLCBhcmdzKSk7DQogIH07DQoNCiAgQ29uc29sZS5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiBlcnJvciAoKSB7CiAgICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07Cg0KICAgIHRoaXMuX3N0ZGVyci5Xcml0ZUxpbmUoZm9ybWF0LmFwcGx5KHZvaWQgMCwgYXJncykpOw0KICB9Ow0KDQogIENvbnNvbGUucHJvdG90eXBlLmRpciA9IGZ1bmN0aW9uIGRpciAob2JqZWN0KSB7DQogICAgdGhpcy5fc3Rkb3V0LldyaXRlTGluZSgNCiAgICAgIGluc3BlY3Qob2JqZWN0LCB7DQogICAgICAgIGN1c3RvbUluc3BlY3Q6IGZhbHNlDQogICAgICB9KQ0KICAgICk7DQogIH07DQoNCiAgQ29uc29sZS5wcm90b3R5cGUudGltZSA9IGZ1bmN0aW9uIHRpbWUgKGxhYmVsKSB7DQogICAgdGhpcy5fdGltZXNbbGFiZWxdID0gRGF0ZS5ub3coKTsNCiAgfTsNCg0KICBDb25zb2xlLnByb3RvdHlwZS50aW1lRW5kID0gZnVuY3Rpb24gdGltZUVuZCAobGFiZWwpIHsNCiAgICB2YXIgdGltZSA9IHRoaXMuX3RpbWVzW2xhYmVsXTsNCiAgICBpZiAoIXRpbWUpIHsNCiAgICAgIHRocm93IG5ldyBFcnJvcignTm8gc3VjaCBsYWJlbDogJyArIGxhYmVsKTsNCiAgICB9DQogICAgdmFyIGR1cmF0aW9uID0gRGF0ZS5ub3coKSAtIHRpbWU7DQogICAgdGhpcy5sb2coJyVzOiAlZG1zJywgbGFiZWwsIGR1cmF0aW9uKTsNCiAgfTsNCg0KICBDb25zb2xlLnByb3RvdHlwZS5hc3NlcnQgPSBmdW5jdGlvbiBhc3NlcnQgKHYpIHsKICAgICAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aCAtIDE7CiAgICAgIHdoaWxlICggbGVuLS0gPiAwICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiArIDEgXTsKDQogICAgaWYgKCF2KSB7IHRocm93IG5ldyBFcnJvcihmb3JtYXQuYXBwbHkodm9pZCAwLCBhcmdzKSk7IH0NCiAgfTsNCg0KICB2YXIgY29uc29sZSA9IG5ldyBDb25zb2xlKFdTY3JpcHQuU3RkT3V0LCBXU2NyaXB0LlN0ZEVycik7CgogIHZhciBST09UX1JFR0VYUCA9IC9eKFtBLXpdOnwpWy9cXF0vOw0KICB2YXIgU0VQX1JFR0VYUCA9IC9bL1xcXSsvOw0KICB2YXIgU0VQX1JFR0VYUF9FTkQgPSAvWy9cXF0kLzsNCiAgdmFyIExOS19SRUdFWFAgPSAvKFwubG5rfFwudXJsKSQvOw0KDQogIHZhciBTRVAgPSAnXFwnOw0KICB2YXIgc2VwID0gU0VQOw0KDQogIGZ1bmN0aW9uIGlzYWJzKHB0aCkgew0KICAgIHJldHVybiBwdGggJiYgUk9PVF9SRUdFWFAudGVzdChwdGgpOw0KICB9DQoNCiAgdmFyIGlzQWJzb2x1dGUgPSBpc2FiczsNCg0KICBmdW5jdGlvbiBkaXJuYW1lKHB0aCkgew0KICAgIHJldHVybiBfX0ZTTy5HZXRQYXJlbnRGb2xkZXJOYW1lKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiBiYXNlbmFtZShwdGgsIGV4dCkgew0KICAgIHJldHVybiBleHQgPyBfX0ZTTy5HZXRCYXNlTmFtZShwdGgpIDogX19GU08uR2V0RmlsZU5hbWUocHRoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGV4dG5hbWUocHRoKSB7DQogICAgcmV0dXJuIF9fRlNPLkdldEV4dGVuc2lvbk5hbWUocHRoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGFic3BhdGgocHRoKSB7DQogICAgaWYgKCFpc2FicyhwdGgpKSB7IHB0aCA9IF9fZGlybmFtZSArIFNFUCArIHB0aDsgfQ0KICAgIHJldHVybiBfX0ZTTy5HZXRBYnNvbHV0ZVBhdGhOYW1lKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiBub3JtcGF0aChwdGgpIHsNCiAgICB2YXIgcGFydHMgPSBwdGguc3BsaXQoU0VQX1JFR0VYUCksDQogICAgICBub3JtUGFydHMgPSBbXSwNCiAgICAgIGxlbiA9IHBhcnRzLmxlbmd0aCwNCiAgICAgIHBhcnQ7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgew0KICAgICAgcGFydCA9IHBhcnRzW2ldOw0KICAgICAgaWYgKHBhcnQgPT09ICcuLicpIHsgbm9ybVBhcnRzLnBvcCgpOyB9DQogICAgICBlbHNlIGlmIChwYXJ0ID09PSAnLicpIHsgY29udGludWU7IH0NCiAgICAgIGVsc2UgeyBub3JtUGFydHMucHVzaChwYXJ0KTsgfQ0KICAgIH0NCiAgICByZXR1cm4gbm9ybVBhcnRzLmpvaW4oU0VQKTsNCiAgfQ0KDQogIHZhciBub3JtYWxpemUgPSBub3JtcGF0aDsNCg0KICBmdW5jdGlvbiBqb2luKCkgewogICAgdmFyIGFyZ3VtZW50cyQxID0gYXJndW1lbnRzOwoNCiAgICB2YXIgcCwNCiAgICAgIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGgsDQogICAgICBwYXJ0cyA9IFtdOw0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsNCiAgICAgIHAgPSBhcmd1bWVudHMkMVtpXTsNCiAgICAgIGlmICh0eXBlb2YgcCA9PT0gJ3N0cmluZycpIHsgcGFydHMucHVzaChwKTsgfQ0KICAgIH0NCiAgICByZXR1cm4gbm9ybXBhdGgocGFydHMuam9pbihTRVApKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlc29sdmUoKSB7CiAgICB2YXIgYXJndW1lbnRzJDEgPSBhcmd1bWVudHM7Cg0KICAgIHZhciBwLA0KICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aCwNCiAgICAgIHBhcnRzID0gW107DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgew0KICAgICAgcCA9IGFyZ3VtZW50cyQxW2ldOw0KICAgICAgaWYgKHR5cGVvZiBwID09PSAnc3RyaW5nJykgew0KICAgICAgICBpZiAoUk9PVF9SRUdFWFAudGVzdChwKSkgew0KICAgICAgICAgIHBhcnRzLmxlbmd0aCA9IDA7DQogICAgICAgICAgcGFydHNbMF0gPSBwOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHBhcnRzLnB1c2gocCk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIGFic3BhdGgocGFydHMuam9pbihTRVApKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlbGF0aXZlKGZyb20sIHRvKSB7DQogICAgdmFyIGZyb21fID0gYWJzcGF0aChmcm9tKS50b0xvd2VyQ2FzZSgpLA0KICAgICAgdG9fID0gYWJzcGF0aCh0bykudG9Mb3dlckNhc2UoKSwNCiAgICAgIGZyb21QYXJ0cyA9IGZyb21fLnNwbGl0KFNFUF9SRUdFWFApLA0KICAgICAgdG9QYXJ0cyA9IHRvXy5zcGxpdChTRVBfUkVHRVhQKSwNCiAgICAgIGxlbiA9IE1hdGgubWluKGZyb21QYXJ0cy5sZW5ndGgsIHRvUGFydHMubGVuZ3RoKSwNCiAgICAgIHNhbWVQYXJ0c0xlbiA9IGxlbiwNCiAgICAgIGkgPSAtMTsNCg0KICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgIGlmIChmcm9tUGFydHNbaV0gIT09IHRvUGFydHNbaV0pIHsNCiAgICAgICAgc2FtZVBhcnRzTGVuID0gaTsNCiAgICAgICAgYnJlYWs7DQogICAgICB9DQogICAgfQ0KDQogICAgaWYgKHNhbWVQYXJ0c0xlbiA9PSAwKSB7IHJldHVybiB0bzsgfQ0KDQogICAgdmFyIG91dHB1dFBhcnRzID0gW107DQogICAgZm9yIChpID0gc2FtZVBhcnRzTGVuOyBpIDwgZnJvbVBhcnRzLmxlbmd0aDsgaSsrKSB7DQogICAgICBvdXRwdXRQYXJ0cy5wdXNoKCcuLicpOw0KICAgIH0NCg0KICAgIG91dHB1dFBhcnRzID0gb3V0cHV0UGFydHMuY29uY2F0KHRvUGFydHMuc2xpY2Uoc2FtZVBhcnRzTGVuKSk7DQoNCiAgICByZXR1cm4gb3V0cHV0UGFydHMuam9pbihTRVApOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNmaWxlKHB0aCkgew0KICAgIHJldHVybiBfX0ZTTy5GaWxlRXhpc3RzKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiBpc2RpcihwdGgpIHsNCiAgICByZXR1cm4gX19GU08uRm9sZGVyRXhpc3RzKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiBleGlzdHMocHRoKSB7DQogICAgcmV0dXJuIGlzZmlsZShwdGgpIHx8IGlzZGlyKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiBjcmVhdGVTaG9ydGN1dChwdGgsIG9wdGlvbnMpIHsNCiAgICB2YXIgc2hvcnRjdXQgPSBfX1dTaGVsbC5DcmVhdGVTaG9ydGN1dChwdGgpOw0KICAgIGlmIChvcHRpb25zLnRhcmdldCkgeyBzaG9ydGN1dC5UYXJnZXRQYXRoID0gb3B0aW9ucy50YXJnZXQ7IH0NCiAgICBpZiAob3B0aW9ucy5ydW5TdHlsZSkgeyBzaG9ydGN1dC5XaW5kb3dTdHlsZSA9IG9wdGlvbnMucnVuU3R5bGU7IH0gLy9OT1JNQUwoMSksTUFYKDMpLE1JTig3KQ0KICAgIGlmIChvcHRpb25zLmRlc2MpIHsgc2hvcnRjdXQuRGVzY3JpcHRpb24gPSBvcHRpb25zLmRlc2M7IH0NCiAgICBzaG9ydGN1dC5TYXZlKCk7DQogIH0NCg0KICBmdW5jdGlvbiBnZXRTaG9ydGN1dFRhcmdldChwdGgpIHsNCiAgICB2YXIgc2hvcnRjdXQgPSBfX1dTaGVsbC5DcmVhdGVTaG9ydGN1dChwdGgpOw0KICAgIHJldHVybiBzaG9ydGN1dC5UYXJnZXRQYXRoOw0KICB9DQoNCiAgdmFyIEZJTEVfUFJPVE8gPSB7DQogICAgaXNmaWxlOiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiAodGhpcy5fZmlsZS5BdHRyaWJ1dGVzICYgMTYpID09IDA7DQogICAgfSwNCiAgICBpc0ZpbGU6IGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuICh0aGlzLl9maWxlLkF0dHJpYnV0ZXMgJiAxNikgPT0gMDsNCiAgICB9LA0KICAgIGlzZGlyOiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiAodGhpcy5fZmlsZS5BdHRyaWJ1dGVzICYgMTYpID09IDE2Ow0KICAgIH0sDQogICAgaXNEaXJlY3Rvcnk6IGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuICh0aGlzLl9maWxlLkF0dHJpYnV0ZXMgJiAxNikgPT0gMTY7DQogICAgfSwNCiAgICBpc1Nob3J0Y3V0OiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiB0aGlzLmlzRmlsZSgpICYmIExOS19SRUdFWFAudGVzdCh0aGlzLnBhdGgpOw0KICAgIH0sDQogICAgY3JlYXRlU2hvcnRjdXQ6IGZ1bmN0aW9uKHB0aCwgb3B0aW9ucykgew0KICAgICAgb3B0aW9ucy50YXJnZXQgPSB0aGlzLnBhdGg7DQogICAgICBjcmVhdGVTaG9ydGN1dChwdGgsIG9wdGlvbnMpOw0KICAgIH0sDQogICAgY29weTogZnVuY3Rpb24oZHN0LCBvdykgew0KICAgICAgaWYgKCFpc2Ficyhkc3QpKSB7IGRzdCA9IGFic3BhdGgoZHN0KTsgfQ0KICAgICAgaWYgKCFTRVBfUkVHRVhQX0VORC50ZXN0KGRzdCkpIHsgZHN0ICs9IFNFUDsgfQ0KICAgICAgaWYgKCFpc2Rpcihkc3QpKSB7IG1rZGlycyhkc3QpOyB9DQogICAgICByZXR1cm4gdGhpcy5fZmlsZS5Db3B5KGRzdCwgb3cgPT0gbnVsbCA/IHRydWUgOiAhIW93KTsNCiAgICB9LA0KICAgIGRlbGV0ZTogZnVuY3Rpb24oZm9yY2UpIHsNCiAgICAgIHJldHVybiB0aGlzLl9maWxlLkRlbGV0ZSghIWZvcmNlKTsNCiAgICB9LA0KICAgIG1vdmU6IGZ1bmN0aW9uKGRzdCkgew0KICAgICAgaWYgKCFpc2Ficyhkc3QpKSB7IGRzdCA9IGFic3BhdGgoZHN0KTsgfQ0KICAgICAgaWYgKCFTRVBfUkVHRVhQX0VORC50ZXN0KGRzdCkpIHsgZHN0ICs9IFNFUDsgfQ0KICAgICAgaWYgKCFpc2Rpcihkc3QpKSB7IG1rZGlycyhkc3QpOyB9DQogICAgICByZXR1cm4gdGhpcy5fZmlsZS5Nb3ZlKGRzdCk7DQogICAgfSwNCiAgICBnZXRDaGlsZHJlbjogZnVuY3Rpb24oKSB7DQogICAgICB2YXIgc2VsZiA9IHRoaXMuaXNTaG9ydGN1dCgpID8gZ2V0U3RhdHModGhpcy50YXJnZXQpIDogdGhpczsNCiAgICAgIGlmIChzZWxmLmlzRmlsZSgpKSB7IHJldHVybiBudWxsOyB9DQogICAgICB2YXIgX2VudW0gPSBuZXcgRW51bWVyYXRvcihzZWxmLl9maWxlLkZpbGVzKTsNCiAgICAgIHZhciByc3QgPSBbXTsNCiAgICAgIGZvciAoOyAhX2VudW0uYXRFbmQoKTsgX2VudW0ubW92ZU5leHQoKSkgew0KICAgICAgICByc3QucHVzaChnZXRTdGF0cyhfZW51bS5pdGVtKCkpKTsNCiAgICAgIH0NCiAgICAgIF9lbnVtID0gbmV3IEVudW1lcmF0b3Ioc2VsZi5fZmlsZS5TdWJGb2xkZXJzKTsNCiAgICAgIGZvciAoOyAhX2VudW0uYXRFbmQoKTsgX2VudW0ubW92ZU5leHQoKSkgew0KICAgICAgICByc3QucHVzaChnZXRTdGF0cyhfZW51bS5pdGVtKCkpKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiByc3Q7DQogICAgfQ0KICB9Ow0KDQogIHZhciBGSUxFX1BST1BTID0gew0KICAgIF9maWxlOiB7DQogICAgICB2YWx1ZTogbnVsbCwNCiAgICAgIHdyaXRhYmxlOiB0cnVlDQogICAgfSwNCiAgICBuYW1lOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuX2ZpbGUuTmFtZTsNCiAgICAgIH0sDQogICAgICBzZXQ6IGZ1bmN0aW9uKHYpIHsNCiAgICAgICAgdGhpcy5fZmlsZS5OYW1lID0gdjsNCiAgICAgIH0NCiAgICB9LA0KICAgIHBhdGg6IHsNCiAgICAgIGVudW1lcmFibGU6IHRydWUsDQogICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5fZmlsZS5QYXRoOw0KICAgICAgfQ0KICAgIH0sDQogICAgZGlybmFtZTogew0KICAgICAgZW51bWVyYWJsZTogdHJ1ZSwNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB0aGlzLl9maWxlLlBhcmVudEZvbGRlci5QYXRoOw0KICAgICAgfQ0KICAgIH0sDQogICAgc2l6ZTogew0KICAgICAgZW51bWVyYWJsZTogdHJ1ZSwNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB0aGlzLl9maWxlLlNpemU7DQogICAgICB9DQogICAgfSwNCiAgICB0eXBlOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuX2ZpbGUuVHlwZTsNCiAgICAgIH0NCiAgICB9LA0KICAgIHRhcmdldDogew0KICAgICAgZW51bWVyYWJsZTogdHJ1ZSwNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB0aGlzLmlzU2hvcnRjdXQoKSA/IGdldFNob3J0Y3V0VGFyZ2V0KHRoaXMucGF0aCkgOiBudWxsOw0KICAgICAgfQ0KICAgIH0sDQogICAgYXRpbWU6IHsNCiAgICAgIGVudW1lcmFibGU6IHRydWUsDQogICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gbmV3IERhdGUodGhpcy5fZmlsZS5EYXRlTGFzdEFjY2Vzc2VkKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIG10aW1lOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKHRoaXMuX2ZpbGUuRGF0ZUxhc3RNb2RpZmllZCk7DQogICAgICB9DQogICAgfSwNCiAgICBjdGltZTogew0KICAgICAgZW51bWVyYWJsZTogdHJ1ZSwNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiBuZXcgRGF0ZSh0aGlzLl9maWxlLkRhdGVDcmVhdGVkKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIGF0aW1lTXM6IHsNCiAgICAgIGVudW1lcmFibGU6IHRydWUsDQogICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5hdGltZS5nZXRUaW1lKCk7DQogICAgICB9DQogICAgfSwNCiAgICBtdGltZU1zOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMubXRpbWUuZ2V0VGltZSgpOw0KICAgICAgfQ0KICAgIH0sDQogICAgY3RpbWVNczogew0KICAgICAgZW51bWVyYWJsZTogdHJ1ZSwNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB0aGlzLmN0aW1lLmdldFRpbWUoKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIHJlYWRvbmx5OiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuICEhKHRoaXMuX2ZpbGUuQXR0cmlidXRlcyAmIDEpOw0KICAgICAgfQ0KICAgIH0sDQogICAgaGlkZGVuOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuICEhKHRoaXMuX2ZpbGUuQXR0cmlidXRlcyAmIDIpOw0KICAgICAgfQ0KICAgIH0sDQogICAgc3lzdGVtOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuICEhKHRoaXMuX2ZpbGUuQXR0cmlidXRlcyAmIDQpOw0KICAgICAgfQ0KICAgIH0NCiAgfTsNCg0KICBmdW5jdGlvbiBnZXRTdGF0cyhwdGgpIHsNCiAgICB2YXIgZiwNCiAgICAgIGluc3RhbmNlID0gT2JqZWN0LmNyZWF0ZShGSUxFX1BST1RPLCBGSUxFX1BST1BTKTsNCiAgICBpZiAodHlwZW9mIHB0aCA9PSAnb2JqZWN0Jykgew0KICAgICAgZiA9IHB0aDsNCiAgICB9IGVsc2UgaWYgKHR5cGVvZiBwdGggPT0gJ3N0cmluZycpIHsNCiAgICAgIGlmICghaXNhYnMocHRoKSkgeyBwdGggPSBhYnNwYXRoKHB0aCk7IH0NCiAgICAgIGlmIChpc2ZpbGUocHRoKSkgew0KICAgICAgICBmID0gX19GU08uR2V0RmlsZShwdGgpOw0KICAgICAgfSBlbHNlIGlmIChpc2RpcihwdGgpKSB7DQogICAgICAgIGYgPSBfX0ZTTy5HZXRGb2xkZXIocHRoKTsNCiAgICAgIH0NCiAgICB9DQogICAgaWYgKCFmKSB7IHRocm93IG5ldyBFcnJvcigoIkVOT0VOVCwgbm8gc3VjaCBmaWxlIG9yIGRpcmVjdG9yeSAoIiArIHB0aCArICIpIikpOyB9DQogICAgaW5zdGFuY2UuX2ZpbGUgPSBmOw0KICAgIHJldHVybiBpbnN0YW5jZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNjYW5kaXIocHRoKSB7DQogICAgcmV0dXJuIGdldFN0YXRzKHB0aCkuZ2V0Q2hpbGRyZW4oKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1rZGlyKHB0aCkgew0KICAgIHJldHVybiBfX0ZTTy5DcmVhdGVGb2xkZXIocHRoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1rZGlycyhwdGgpIHsNCiAgICB2YXIgZGlyID0gcHRoLA0KICAgICAgZGlycyA9IFtdOw0KICAgIHdoaWxlIChkaXIpIHsNCiAgICAgIGlmIChpc2RpcihkaXIpKSB7IGJyZWFrOyB9DQogICAgICBkaXJzLnB1c2goZGlyKTsNCiAgICAgIGRpciA9IGRpcm5hbWUoZGlyKTsNCiAgICB9DQogICAgdmFyIGkgPSBkaXJzLmxlbmd0aDsNCiAgICB3aGlsZSAoaS0tKSB7IG1rZGlyKGRpcnNbaV0pOyB9DQogIH0NCg0KICBmdW5jdGlvbiBybWRpcihwdGgpIHsNCiAgICByZXR1cm4gaXNkaXIocHRoKSAmJiBfX0ZTTy5EZWxldGVGb2xkZXIocHRoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlbW92ZSQxKHB0aCkgew0KICAgIHJldHVybiBpc2ZpbGUocHRoKSAmJiBfX0ZTTy5EZWxldGVGaWxlKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiBjb3B5ZmlsZShwdGgsIGRzdCwgb3cpIHsNCiAgICBpZiAoIWlzYWJzKGRzdCkpIHsgZHN0ID0gYWJzcGF0aChkaXJuYW1lKHB0aCkgKyBTRVAgKyBkc3QpOyB9DQogICAgaWYgKCFTRVBfUkVHRVhQX0VORC50ZXN0KGRzdCkpIHsgZHN0ICs9IFNFUDsgfQ0KICAgIGlmICghaXNkaXIoZHN0KSkgeyBta2RpcnMoZHN0KTsgfQ0KICAgIF9fRlNPLkNvcHlGaWxlKHB0aCwgZHN0LCBvdyB8fCBmYWxzZSk7DQogIH0NCg0KICBmdW5jdGlvbiByZXBsKHB0aCwgZHN0KSB7DQogICAgaWYgKCFpc2Ficyhkc3QpKSB7IGRzdCA9IGFic3BhdGgoZGlybmFtZShwdGgpICsgU0VQICsgZHN0KTsgfQ0KICAgIHZhciBkaXIgPSBkaXJuYW1lKGRzdCk7DQogICAgdmFyIG5hbWUgPSBiYXNlbmFtZShkc3QpOw0KICAgIGlmIChpc2ZpbGUoZHN0KSkgeyB0aHJvdyBuZXcgRXJyb3IoZHN0ICsgJyBpcyBleGlzdHMuIHJlcGwgZmFpZC4nKTsgfQ0KICAgIGlmICghaXNkaXIoZGlyKSkgeyBta2RpcnMoZGlyKTsgfQ0KICAgIGVsc2UgaWYgKGlzZGlyKGRzdCkpIHsgcm1kaXIoZHN0KTsgfQ0KICAgIHZhciBmID0gZ2V0U3RhdHMocHRoKTsNCiAgICBpZiAoZi5uYW1lICE9IG5hbWUpIHsgZi5uYW1lID0gbmFtZTsgfQ0KICAgIGlmIChmLmRpcm5hbWUgIT0gZGlyKSB7IGYubW92ZShkaXIpOyB9DQogIH0KCiAgZnVuY3Rpb24gc3RhdFN5bmMocHRoKSB7DQogICAgcmV0dXJuIGdldFN0YXRzKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiByZWFkZGlyU3luYyhwdGgpIHsNCiAgICByZXR1cm4gc2NhbmRpcihwdGgpLm1hcChmdW5jdGlvbiAoaXQpIHsgcmV0dXJuIGl0Lm5hbWU7IH0pOw0KICB9DQoNCiAgZnVuY3Rpb24gd2l0aFN0cmVhbShvcHRpb25zLCBmbikgew0KICAgIHZhciBzdCA9IG5ldyBBY3RpdmVYT2JqZWN0KCdBRE9EQi5TdHJlYW0nKSwNCiAgICAgIGZpbGUgPSBvcHRpb25zLmZpbGUsDQogICAgICBlbmNvZGluZyA9IG9wdGlvbnMuZW5jb2RpbmcsDQogICAgICBmbGFnID0gb3B0aW9ucy5mbGFnLA0KICAgICAgcnN0Ow0KICAgIHRyeSB7DQogICAgICBpZiAoZW5jb2RpbmcgPT0gJ2JpbmFyeScpIHsgc3QuVHlwZSA9IDE7IH0NCiAgICAgIGVsc2UgeyBzdC5DaGFyc2V0ID0gZW5jb2Rpbmc7IH0NCiAgICAgIHN0Lk9wZW4oKTsNCiAgICAgIGlmIChmbGFnID09ICdyJyB8fCBmbGFnID09ICdhJykgew0KICAgICAgICBpZiAoIWlzZmlsZShmaWxlKSkNCiAgICAgICAgICB7IHRocm93IG5ldyBFcnJvcigoIndpdGhTdHJlYW06IGZpbGUgbm90IGV4aXN0cy4gKCIgKyBmaWxlICsgIikiKSk7IH0NCiAgICAgICAgc3QuTG9hZEZyb21GaWxlKGZpbGUpOw0KICAgICAgfQ0KICAgICAgaWYgKGZsYWcgPT0gJ2EnKSB7IHN0LlBvc2l0aW9uID0gc3QuU2l6ZTsgfQ0KICAgICAgcnN0ID0gZm4oc3QpOw0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgIHRocm93IGU7DQogICAgfSBmaW5hbGx5IHsNCiAgICAgIHN0ICYmIHN0LlN0YXRlID09IDEgJiYgc3QuY2xvc2UoKTsNCiAgICB9DQogICAgcmV0dXJuIHJzdDsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNhdmVTdHJlYW0oc3QsIG9wdGlvbnMpIHsNCiAgICB2YXIgc2tpcExlbiA9IDAsDQogICAgICBmaWxlID0gb3B0aW9ucy5maWxlLA0KICAgICAgZW5jb2RpbmcgPSBvcHRpb25zLmVuY29kaW5nLnJlcGxhY2UoJy0nLCAnJykudG9Mb3dlckNhc2UoKTsNCiAgICBpZiAoZW5jb2RpbmcgPT0gJ3V0ZjgnIHx8IGVuY29kaW5nID09ICd1bmljb2RlJykgeyBza2lwTGVuID0gMzsgfQ0KICAgIGVsc2UgaWYgKGVuY29kaW5nID09ICd1ZnQxNicpIHsgc2tpcExlbiA9IDI7IH0NCiAgICBzdC5TZXRFT1MoKTsNCiAgICBpZiAoc2tpcExlbikgew0KICAgICAgc3QuUG9zaXRpb24gPSAwOw0KICAgICAgc3QuVHlwZSA9IDE7DQogICAgICBzdC5Qb3NpdGlvbiA9IHNraXBMZW47DQogICAgICB2YXIgYmluRGF0YSA9IHN0LlJlYWQoLTEpOw0KICAgICAgc3QuUG9zaXRpb24gPSAwOw0KICAgICAgc3QuV3JpdGUoYmluRGF0YSk7DQogICAgICBzdC5TZXRFT1MoKTsNCiAgICB9DQogICAgc3QuU2F2ZVRvRmlsZShmaWxlLCAyKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGluaXRBcmdzKGZpbGUsIG9wdGlvbnMpIHsNCiAgICB2YXIgdHAsIGVuY29kaW5nLCBmbGFnOw0KICAgIGlmICghaXNhYnMoZmlsZSkpIHsgdGhyb3cgbmV3IEVycm9yKCdmczogcmVsYXRpdmUgcGF0aCBpcyBub3Qgc3VwcG9ydGVkJyk7IH0NCiAgICB0cCA9IHR5cGVvZiBvcHRpb25zOw0KICAgIGlmICh0cCA9PSAnc3RyaW5nJykgew0KICAgICAgZW5jb2RpbmcgPSBvcHRpb25zOw0KICAgIH0gZWxzZSBpZiAodHAgPT0gJ29iamVjdCcpIHsNCiAgICAgIGlmIChvcHRpb25zLmVuY29kaW5nKSB7IGVuY29kaW5nID0gb3B0aW9ucy5lbmNvZGluZzsgfQ0KICAgICAgaWYgKG9wdGlvbnMuZmxhZykgeyBmbGFnID0gb3B0aW9ucy5mbGFnOyB9DQogICAgICBlbHNlIGlmIChvcHRpb25zLmZsYWdzKSB7IGZsYWcgPSBvcHRpb25zLmZsYWdzOyB9DQogICAgfQ0KICAgIGlmIChmbGFnICYmIGZsYWcubGVuZ3RoID4gMSkgeyBmbGFnID0gZmxhZy5jaGFyQXQoMCk7IH0NCiAgICByZXR1cm4geyBmaWxlOiBmaWxlLCBlbmNvZGluZzogZW5jb2RpbmcsIGZsYWc6IGZsYWcgfTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlYWRGaWxlU3luYyhmaWxlLCBvcHRpb25zKSB7DQogICAgdmFyIG9wdHMgPSBpbml0QXJncyhmaWxlLCBvcHRpb25zKTsNCiAgICBvcHRzLmZsYWcgPSAncic7DQogICAgaWYgKCFvcHRzLmVuY29kaW5nKSB7IG9wdHMuZW5jb2RpbmcgPSAnYmluYXJ5JzsgfQ0KICAgIHJldHVybiB3aXRoU3RyZWFtKG9wdHMsIGZ1bmN0aW9uKHN0KSB7DQogICAgICByZXR1cm4gb3B0cy5lbmNvZGluZyA9PSAnYmluYXJ5Jw0KICAgICAgICA/IEJ1ZmZlci5mcm9tKHN0LlJlYWQoLTEpKQ0KICAgICAgICA6IHN0LlJlYWRUZXh0KC0xKTsNCiAgICB9KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHdyaXRlRmlsZVN5bmMoZmlsZSwgZGF0YSwgb3B0aW9ucykgew0KICAgIHZhciBvcHRzID0gaW5pdEFyZ3MoZmlsZSwgb3B0aW9ucyksDQogICAgICBpc0J1ZmZlciA9IEJ1ZmZlci5pc0J1ZmZlcihkYXRhKTsNCiAgICBvcHRzLmZsYWcgPSAndyc7DQogICAgaWYgKGlzQnVmZmVyKSB7IG9wdHMuZW5jb2RpbmcgPSAnYmluYXJ5JzsgfQ0KICAgIGVsc2UgaWYgKCFvcHRzLmVuY29kaW5nKSB7IG9wdHMuZW5jb2RpbmcgPSAnVVRGLTgnOyB9DQogICAgd2l0aFN0cmVhbShvcHRzLCBmdW5jdGlvbiAoc3QpIHsNCiAgICAgIGlzQnVmZmVyID8gc3QuV3JpdGUoZGF0YS5idWZmZXIpIDogc3QuV3JpdGVUZXh0KGRhdGEpOw0KICAgICAgc2F2ZVN0cmVhbShzdCwgb3B0cyk7DQogICAgfSk7DQogIH0NCg0KICBmdW5jdGlvbiBhcHBlbmRGaWxlU3luYyhmaWxlLCBkYXRhLCBvcHRpb25zKSB7DQogICAgdmFyIG9wdHMgPSBpbml0QXJncyhmaWxlLCBvcHRpb25zKSwNCiAgICAgIGlzQnVmZmVyID0gQnVmZmVyLmlzQnVmZmVyKGRhdGEpOw0KICAgIG9wdHMuZmxhZyA9ICdhJzsNCiAgICBpZiAoaXNCdWZmZXIpIHsgb3B0cy5lbmNvZGluZyA9ICdiaW5hcnknOyB9DQogICAgZWxzZSBpZiAoIW9wdHMuZW5jb2RpbmcpIHsgb3B0cy5lbmNvZGluZyA9ICdVVEYtOCc7IH0NCiAgICB3aXRoU3RyZWFtKG9wdHMsIGZ1bmN0aW9uIChzdCkgew0KICAgICAgaXNCdWZmZXIgPyBzdC5Xcml0ZShkYXRhLmJ1ZmZlcikgOiBzdC5Xcml0ZVRleHQoZGF0YSk7DQogICAgICBzYXZlU3RyZWFtKHN0LCBvcHRzKTsNCiAgICB9KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1rZGlyU3luYyhwdGgsIG9wdGlvbnMpIHsNCiAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnJlY3Vyc2l2ZSkgeyBta2RpcnMocHRoKTsgfQ0KICAgIG1rZGlyKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiBjb3B5RmlsZVN5bmMoc3JjLCBkZXN0KSB7DQogICAgY29weWZpbGUoc3JjLCBkZXN0LCB0cnVlKTsNCiAgfQ0KDQogIC8vIGZzLWV4dHJhDQoNCiAgZnVuY3Rpb24gbWtkaXJzU3luYyhwdGgpIHsNCiAgICBta2RpcnMocHRoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGVuc3VyZURpclN5bmMocHRoKSB7DQogICAgaWYgKCFpc2RpcihwdGgpKSB7IG1rZGlycyhwdGgpOyB9DQogIH0NCg0KICBmdW5jdGlvbiBlbnN1cmVGaWxlU3luYyhmaWxlKSB7DQogICAgaWYgKCFpc2FicyhmaWxlKSkgeyBmaWxlID0gYWJzcGF0aChmaWxlKTsgfQ0KICAgIHZhciBkaXIgPSBkaXJuYW1lKGZpbGUpOw0KICAgIGlmICghaXNkaXIoZGlyKSkgeyBta2RpcnMoZGlyKTsgfQ0KICB9DQoNCiAgZnVuY3Rpb24gb3V0cHV0RmlsZVN5bmMoZmlsZSwgZGF0YSwgb3B0aW9ucykgew0KICAgIGlmICghaXNhYnMoZmlsZSkpIHsgZmlsZSA9IGFic3BhdGgoZmlsZSk7IH0NCiAgICBlbnN1cmVGaWxlU3luYyhmaWxlKTsNCiAgICB3cml0ZUZpbGVTeW5jKGZpbGUsIGRhdGEsIG9wdGlvbnMpOw0KICB9DQoNCiAgZnVuY3Rpb24gb3V0cHV0SnNvblN5bmMoZmlsZSwgb2JqLCBvcHRpb25zKSB7DQogICAgaWYgKCFpc2FicyhmaWxlKSkgeyBmaWxlID0gYWJzcGF0aChmaWxlKTsgfQ0KICAgIGVuc3VyZUZpbGVTeW5jKGZpbGUpOw0KICAgIHdyaXRlRmlsZVN5bmMoZmlsZSwgSlNPTi5zdHJpbmdpZnkob2JqKSwgb3B0aW9ucyk7DQogIH0NCg0KICB2YXIgb3V0cHV0SlNPTlN5bmMgPSBvdXRwdXRKc29uU3luYzsNCg0KICBmdW5jdGlvbiByZWFkSnNvblN5bmMoZmlsZSwgb3B0aW9ucykgew0KICAgIGlmICghaXNhYnMoZmlsZSkpIHsgZmlsZSA9IGFic3BhdGgoZmlsZSk7IH0NCiAgICBpZiAoIW9wdGlvbnMgfHwgKHR5cGVvZiBvcHRpb25zID09ICdvYmplY3QnICYmICFvcHRpb25zLmVuY29kaW5nKSkNCiAgICAgIHsgb3B0aW9ucyA9ICdVVEYtOCc7IH0NCiAgICB2YXIgZGF0YSA9IHJlYWRGaWxlU3luYyhmaWxlLCBvcHRpb25zKTsNCiAgICByZXR1cm4gSlNPTi5wYXJzZShkYXRhKTsNCiAgfQ0KDQogIHZhciByZWFkSlNPTlN5bmMgPSByZWFkSnNvblN5bmM7DQoNCiAgZnVuY3Rpb24gZW1wdHlEaXJTeW5jKGRpcikgew0KICAgIHNjYW5kaXIoZGlyKS5mb3JFYWNoKGZ1bmN0aW9uIChpdCkgeyByZXR1cm4gaXQuZGVsZXRlKHRydWUpOyB9KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlYWRMaW5lc1N5bmMoZmlsZSwgb3B0aW9ucykgew0KICAgIGlmICghaXNhYnMoZmlsZSkpIHsgZmlsZSA9IGFic3BhdGgoZmlsZSk7IH0NCiAgICB2YXIgb3B0cyA9IGluaXRBcmdzKGZpbGUsIG9wdGlvbnMpOw0KICAgIG9wdHMuZmxhZyA9ICdyJzsNCiAgICBpZiAoIW9wdHMuZW5jb2RpbmcpIHsgb3B0cy5lbmNvZGluZyA9ICdVVEYtOCc7IH0NCiAgICByZXR1cm4gd2l0aFN0cmVhbShvcHRzLCBmdW5jdGlvbihzdCkgew0KICAgICAgdmFyIGxpbmVzID0gW107DQogICAgICB3aGlsZSAoIXN0LkVPUykgeyBsaW5lcy5wdXNoKHN0LlJlYWRUZXh0KC0yKSk7IH0NCiAgICAgIHJldHVybiBsaW5lczsNCiAgICB9KTsNCiAgfQoKICB2YXIgZnMgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICBzdGF0U3luYzogc3RhdFN5bmMsCiAgICByZWFkZGlyU3luYzogcmVhZGRpclN5bmMsCiAgICByZWFkRmlsZVN5bmM6IHJlYWRGaWxlU3luYywKICAgIHdyaXRlRmlsZVN5bmM6IHdyaXRlRmlsZVN5bmMsCiAgICBhcHBlbmRGaWxlU3luYzogYXBwZW5kRmlsZVN5bmMsCiAgICBta2RpclN5bmM6IG1rZGlyU3luYywKICAgIGNvcHlGaWxlU3luYzogY29weUZpbGVTeW5jLAogICAgbWtkaXJzU3luYzogbWtkaXJzU3luYywKICAgIGVuc3VyZURpclN5bmM6IGVuc3VyZURpclN5bmMsCiAgICBlbnN1cmVGaWxlU3luYzogZW5zdXJlRmlsZVN5bmMsCiAgICBvdXRwdXRGaWxlU3luYzogb3V0cHV0RmlsZVN5bmMsCiAgICBvdXRwdXRKc29uU3luYzogb3V0cHV0SnNvblN5bmMsCiAgICBvdXRwdXRKU09OU3luYzogb3V0cHV0SlNPTlN5bmMsCiAgICByZWFkSnNvblN5bmM6IHJlYWRKc29uU3luYywKICAgIHJlYWRKU09OU3luYzogcmVhZEpTT05TeW5jLAogICAgZW1wdHlEaXJTeW5jOiBlbXB0eURpclN5bmMsCiAgICByZWFkTGluZXNTeW5jOiByZWFkTGluZXNTeW5jLAogICAgZXhpc3RzU3luYzogZXhpc3RzLAogICAgcmVuYW1lU3luYzogcmVwbCwKICAgIHJtZGlyU3luYzogcm1kaXIsCiAgICB1bmxpbmtTeW5jOiByZW1vdmUkMQogIH0pOwoKICB2YXIgUEFSU0VfUkVHID0gL14oW0EtWmEtel06Wy9cXF18Wy9cXF18KSg/OihbXj8jXSopWy9cXF18KShbXi9cXD8jXSo/KShbLl1bXi4/I10rfCkkLzsNCiAgdmFyIENBUFRVUkUgPSBbJ3BhdGgnLCAncm9vdCcsICdkaXInLCAnbmFtZScsICdleHQnXTsNCg0KICBmdW5jdGlvbiBwYXJzZShwdGgpIHsNCiAgICBwdGggfHwgKHB0aCA9ICcnKTsNCiAgICB2YXIgbWF0Y2ggPSBwdGgubWF0Y2goUEFSU0VfUkVHKTsNCiAgICB2YXIgcmVzdWx0ID0gQ0FQVFVSRS5yZWR1Y2UoZnVuY3Rpb24obWVtbywgbmFtZSwgaW5kZXgpIHsNCiAgICAgIG1lbW9bbmFtZV0gPSBtYXRjaFtpbmRleF07DQogICAgICByZXR1cm4gbWVtbzsNCiAgICB9LCB7fSk7DQogICAgcmVzdWx0LmJhc2UgPSByZXN1bHQubmFtZSArIHJlc3VsdC5leHQ7DQogICAgcmVzdWx0LmRpcm5hbWUgPSByZXN1bHQucm9vdCArIHJlc3VsdC5kaXI7DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfQ0KDQogIHZhciBkZWxpbWl0ZXIgPSAnOyc7CgogIHZhciBQYXRoID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgcGFyc2U6IHBhcnNlLAogICAgZGVsaW1pdGVyOiBkZWxpbWl0ZXIsCiAgICBzZXA6IHNlcCwKICAgIGRpcm5hbWU6IGRpcm5hbWUsCiAgICBiYXNlbmFtZTogYmFzZW5hbWUsCiAgICBleHRuYW1lOiBleHRuYW1lLAogICAgaXNBYnNvbHV0ZTogaXNBYnNvbHV0ZSwKICAgIG5vcm1hbGl6ZTogbm9ybWFsaXplLAogICAgam9pbjogam9pbiwKICAgIHJlc29sdmU6IHJlc29sdmUsCiAgICByZWxhdGl2ZTogcmVsYXRpdmUKICB9KTsKCiAgaWYgKCFPYmplY3QuYXNzaWduKSB7DQogICAgT2JqZWN0LmFzc2lnbiA9IGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuIGFwcGx5KGFzc2lnbiwgbnVsbCwgYXJndW1lbnRzKTsNCiAgICB9Ow0KICB9DQoNCiAgaWYgKCFPYmplY3QudmFsdWVzKSB7DQogICAgT2JqZWN0LnZhbHVlcyA9IHZhbHVlczsNCiAgfQ0KDQogIGZ1bmN0aW9uIGRlZmluZU1ldGhvZHModGFyZ2V0LCBmdW5jRGljdCkgew0KICAgIHZhciBwcm9wcyA9IHt9Ow0KICAgIGZvciAodmFyIGtleSBpbiBmdW5jRGljdCkgew0KICAgICAgaWYgKCF0YXJnZXRba2V5XSkgew0KICAgICAgICBwcm9wc1trZXldID0gew0KICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlLA0KICAgICAgICAgIHZhbHVlOiBmdW5jRGljdFtrZXldDQogICAgICAgIH07DQogICAgICB9DQogICAgfQ0KICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpOw0KICB9DQoNCiAgZGVmaW5lTWV0aG9kcyhBcnJheS5wcm90b3R5cGUsIHsNCiAgICBpbmNsdWRlczogZnVuY3Rpb24odmFsLCBzdGFydCkgew0KICAgICAgcmV0dXJuIGluY2x1ZGVzKHRoaXMsIHZhbCwgc3RhcnQpOw0KICAgIH0sDQogICAgZmluZDogZnVuY3Rpb24oZm4sIF90aGlzKSB7DQogICAgICByZXR1cm4gZmluZCh0aGlzLCBmbiwgX3RoaXMpWzBdOw0KICAgIH0sDQogICAgZmluZEluZGV4OiBmdW5jdGlvbihmbiwgX3RoaXMpIHsNCiAgICAgIHJldHVybiBmaW5kSW5kZXgodGhpcywgZm4sIF90aGlzKVsxXTsNCiAgICB9LA0KICAgIGZpbGw6IGZ1bmN0aW9uKHZhbCwgc3RhcnQsIGVuZCkgew0KICAgICAgcmV0dXJuIGZpbGwodGhpcywgdmFsLCBzdGFydCwgZW5kKTsNCiAgICB9DQogIH0pOw0KDQogIGRlZmluZU1ldGhvZHMoU3RyaW5nLnByb3RvdHlwZSwgew0KICAgIHJlcGVhdDogZnVuY3Rpb24obikgew0KICAgICAgcmV0dXJuIHJlcGVhdCh0aGlzLCBuKTsNCiAgICB9LA0KICAgIHN0YXJ0c1dpdGg6IGZ1bmN0aW9uKHRhcmdldCwgcG9zKSB7DQogICAgICByZXR1cm4gc3RhcnRzV2l0aCh0aGlzLCB0YXJnZXQsIHBvcyk7DQogICAgfSwNCiAgICBlbmRzV2l0aDogZnVuY3Rpb24odGFyZ2V0LCB0aGlzX2xlbikgew0KICAgICAgcmV0dXJuIGVuZHNXaXRoKHRoaXMsIHRhcmdldCwgdGhpc19sZW4pOw0KICAgIH0sDQogICAgaW5jbHVkZXM6IGZ1bmN0aW9uKHRhcmdldCwgcG9zKSB7DQogICAgICByZXR1cm4gaW5jbHVkZXModGhpcywgdGFyZ2V0LCBwb3MpOw0KICAgIH0sDQogICAgcGFkU3RhcnQ6IGZ1bmN0aW9uKGxlbiwgY2hycykgew0KICAgICAgcmV0dXJuIHBhZFN0YXJ0KHRoaXMsIGxlbiwgY2hycyk7DQogICAgfSwNCiAgICBwYWRFbmQ6IGZ1bmN0aW9uKGxlbiwgY2hycykgew0KICAgICAgcmV0dXJuIHBhZEVuZCh0aGlzLCBsZW4sIGNocnMpOw0KICAgIH0NCiAgfSk7DQoNCiAgaWYgKCFTdHJpbmcucmF3KSB7DQogICAgU3RyaW5nLnJhdyA9IGZ1bmN0aW9uKGNhbGxTaXRlKSB7CiAgICAgIHZhciBhcmd1bWVudHMkMSA9IGFyZ3VtZW50czsKDQogICAgICB2YXIgaSA9IDAsDQogICAgICAgIGJ1ZiA9IFtdLA0KICAgICAgICBzdHJzID0gY2FsbFNpdGUucmF3LA0KICAgICAgICBsZW4gPSBzdHJzLmxlbmd0aCwNCiAgICAgICAgYXJnc0NudCA9IGFyZ3VtZW50cy5sZW5ndGg7DQogICAgICB3aGlsZSAoaSA8IGxlbikgew0KICAgICAgICBidWYucHVzaChzdHJzW2krK10pOw0KICAgICAgICBpZiAoaSA8IGFyZ3NDbnQgJiYgaSA8IGxlbikgew0KICAgICAgICAgIGJ1Zi5wdXNoKGFyZ3VtZW50cyQxW2ldKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIGJ1Zi5qb2luKCcnKTsNCiAgICB9Ow0KICB9DQoNCiAgd2luZG93Ll9fZmlsZW5hbWUgPSBXU2NyaXB0LlNjcmlwdEZ1bGxOYW1lOw0KICB3aW5kb3cuX19kaXJuYW1lID0gX19maWxlbmFtZS5tYXRjaCgvKC4qKVtcXC9dLylbMV07DQoNCiAgZnVuY3Rpb24gZGVmaW5lR2V0dGVyKHRhcmdldCwgZnVuY0RpY3QpIHsNCiAgICB2YXIgcHJvcHMgPSB7fTsNCiAgICBmb3IgKHZhciBrZXkgaW4gZnVuY0RpY3QpIHsNCiAgICAgIGlmICghdGFyZ2V0W2tleV0pIHsNCiAgICAgICAgcHJvcHNba2V5XSA9IHsNCiAgICAgICAgICBnZXQ6IGZ1bmNEaWN0W2tleV0NCiAgICAgICAgfTsNCiAgICAgIH0NCiAgICB9DQogICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcyk7DQogIH0NCg0KICB2YXIgX3ZicywgX3NoZWxsLCBfZnNvLCBfc2hlbGxfYXBwOw0KDQogIGRlZmluZUdldHRlcih3aW5kb3csIHsNCiAgICBfX1ZCUzogZnVuY3Rpb24oKSB7DQogICAgICBpZiAoIV92YnMpIHsNCiAgICAgICAgX3ZicyA9IG5ldyBBY3RpdmVYT2JqZWN0KCdTY3JpcHRDb250cm9sJyk7DQogICAgICAgIF92YnMuTGFuZ3VhZ2UgPSAnVkJTY3JpcHQnOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIF92YnM7DQogICAgfSwNCiAgICBfX1dTaGVsbDogZnVuY3Rpb24oKSB7DQogICAgICByZXR1cm4gX3NoZWxsIHx8IChfc2hlbGwgPSBuZXcgQWN0aXZlWE9iamVjdCgnV1NjcmlwdC5TaGVsbCcpKTsNCiAgICB9LA0KICAgIF9fRlNPOiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiBfZnNvIHx8IChfZnNvID0gbmV3IEFjdGl2ZVhPYmplY3QoJ1NjcmlwdGluZy5GaWxlU3lzdGVtT2JqZWN0JykpOw0KICAgIH0sDQogICAgX19TaGVsbEFwcDogZnVuY3Rpb24oKSB7DQogICAgICByZXR1cm4gX3NoZWxsX2FwcCB8fCAoX3NoZWxsX2FwcCA9IG5ldyBBY3RpdmVYT2JqZWN0KCdTaGVsbC5BcHBsaWNhdGlvbicpKTsNCiAgICB9DQogIH0pOw0KDQogIGZ1bmN0aW9uIGxvZyQxKG1zZykgewogICAgaWYgKCBtc2cgPT09IHZvaWQgMCApIG1zZyA9ICcnOwoNCiAgICBXU2NyaXB0LkVjaG8obXNnKTsNCiAgfQ0KDQogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGZ1bmN0aW9uKCkgew0KICAgIHZhciBzY3JpcHRzID0gZG9jdW1lbnQuc2NyaXB0czsNCiAgICB2YXIgaSA9IC0xLA0KICAgICAgbGVuID0gc2NyaXB0cy5sZW5ndGg7DQogICAgdmFyIG5hbWUgPSBiYXNlbmFtZShfX2ZpbGVuYW1lKS5yZXBsYWNlKC9cLlteLl0rJC8sICcnKTsNCiAgICB2YXIgZmlsZSwgZm9sZGVyOw0KICAgIGZvbGRlciA9IGpvaW4oX19kaXJuYW1lLCBuYW1lICsgJ19zcmMnKTsNCiAgICBpZiAoIWlzZGlyKGZvbGRlcikpIHsgbWtkaXJzU3luYyhmb2xkZXIpOyB9DQogICAgbG9nJDEoKTsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICBmaWxlID0gam9pbihmb2xkZXIsIGkgKyAnLmpzJyk7DQogICAgICBvdXRwdXRGaWxlU3luYyhmaWxlLCBzY3JpcHRzW2ldLnRleHQpOw0KICAgICAgbG9nJDEoKCJzb3VyY2UgIiArIGkgKyAiOiAiICsgZmlsZSkpOw0KICAgIH0NCiAgfSk7CgogIGZ1bmN0aW9uIGV4ZWNTeW5jKGNtZCkgew0KICAgIHZhciBwcm9jID0gX19XU2hlbGwuRXhlYyhjbWQpOw0KICAgIGZvciAoOzspIHsNCiAgICAgIGlmIChwcm9jLlN0YXRlcyAhPT0gMCkgeyBicmVhazsgfQ0KICAgIH0NCiAgICBpZiAoIXByb2MuU3RkT3V0LkF0RW5kT2ZTdHJlYW0pIHsNCiAgICAgIHJldHVybiBwcm9jLlN0ZE91dC5SZWFkQWxsKCk7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gZXhlYyhjbWQsIGZ1bmMpIHsNCiAgICB2YXIgcHJvYywgc3Rkb3V0LCBzdGRlcnI7DQogICAgdHJ5IHsNCiAgICAgIHByb2MgPSBfX1dTaGVsbC5FeGVjKGNtZCk7DQogICAgICBmb3IgKDs7KSB7DQogICAgICAgIGlmIChwcm9jLlN0YXRlcyAhPT0gMCkgeyBicmVhazsgfQ0KICAgICAgfQ0KICAgICAgaWYgKGZ1bmMgJiYgdHlwZW9mIGZ1bmMgPT09ICdmdW5jdGlvbicpIHsNCiAgICAgICAgaWYgKCFwcm9jLlN0ZE91dC5BdEVuZE9mU3RyZWFtKSB7DQogICAgICAgICAgc3Rkb3V0ID0gcHJvYy5TdGRPdXQuUmVhZEFsbCgpOw0KICAgICAgICB9DQogICAgICAgIGlmICghcHJvYy5TdGRFcnIuQXRFbmRPZlN0cmVhbSkgew0KICAgICAgICAgIHN0ZGVyciA9IHByb2MuU3RkRXJyLlJlYWRBbGwoKTsNCiAgICAgICAgfQ0KICAgICAgICBmdW5jKG51bGwsIHN0ZG91dCwgc3RkZXJyKTsNCiAgICAgIH0NCiAgICB9IGNhdGNoIChlKSB7DQogICAgICBpZiAoZnVuYyAmJiB0eXBlb2YgZnVuYyA9PT0gJ2Z1bmN0aW9uJykgew0KICAgICAgICBmdW5jKGUsIG51bGwsIG51bGwpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhyb3cgZTsNCiAgICAgIH0NCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBydW4oY21kLCBvcHRpb25zKSB7DQogICAgdmFyIGludFdpbmRvd1N0eWxlID0gMSwNCiAgICAgIGJXYWl0T25SZXR1cm4gPSB0cnVlOw0KICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7DQogICAgaWYgKG9wdGlvbnMuaGlkZSA9PT0gZmFsc2UgfHwgb3B0aW9ucy5oaWRkZW4gPT09IGZhbHNlKSB7IGludFdpbmRvd1N0eWxlID0gMDsgfQ0KICAgIGlmIChvcHRpb25zLndhaXQgPT09IGZhbHNlKSB7IGJXYWl0T25SZXR1cm4gPSBmYWxzZTsgfQ0KICAgIHJldHVybiBfX1dTaGVsbC5SdW4oY21kLCBpbnRXaW5kb3dTdHlsZSwgYldhaXRPblJldHVybik7DQogIH0KCiAgdmFyIGNoaWxkX3Byb2Nlc3MgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICBleGVjU3luYzogZXhlY1N5bmMsCiAgICBleGVjOiBleGVjLAogICAgcnVuOiBydW4KICB9KTsKCiAgdmFyIGVzY2FwZSA9IGVuY29kZVVSSUNvbXBvbmVudDsNCg0KICB2YXIgdW5lc2NhcGUgPSBkZWNvZGVVUklDb21wb25lbnQ7DQoNCiAgZnVuY3Rpb24gZm9ybWF0VmFsdWUkMSh2YWx1ZSkgew0KICAgIHN3aXRjaCAodHlwZW9mIHZhbHVlKSB7DQogICAgICBjYXNlICdzdHJpbmcnOg0KICAgICAgICByZXR1cm4gZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKTsNCiAgICAgIGNhc2UgJ251bWJlcic6DQogICAgICBjYXNlICdib29sZWFuJzoNCiAgICAgICAgcmV0dXJuIFN0cmluZyh2YWx1ZSk7DQogICAgICBkZWZhdWx0Og0KICAgICAgICByZXR1cm4gJyc7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gc3RyaW5naWZ5KG9iaiwgc2VwLCBlcSkgew0KICAgIGlmICghb2JqKSB7IHJldHVybiAnJzsgfQ0KICAgIHNlcCB8fCAoc2VwID0gJyYnKTsNCiAgICBlcSB8fCAoZXEgPSAnPScpOw0KICAgIHZhciBidWYgPSBbXSwNCiAgICAgIHZhbHVlLA0KICAgICAgaSwNCiAgICAgIGxlbjsNCiAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7DQogICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KGtleSkpIHsNCiAgICAgICAgdmFsdWUgPSBvYmpba2V5XTsNCiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7DQogICAgICAgICAgKGkgPSAtMSksIChsZW4gPSB2YWx1ZS5sZW5ndGgpOw0KICAgICAgICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgICAgICAgIGJ1Zi5wdXNoKGtleSArIGVxICsgZm9ybWF0VmFsdWUkMSh2YWx1ZVtpXSkpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBidWYucHVzaChrZXkgKyBlcSArIGZvcm1hdFZhbHVlJDEodmFsdWUpKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gYnVmLmpvaW4oc2VwKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHBhcnNlJDEoc3RyLCBzZXAsIGVxKSB7DQogICAgc2VwIHx8IChzZXAgPSAnJicpOw0KICAgIGVxIHx8IChlcSA9ICc9Jyk7DQogICAgdmFyIGJ1ZiA9IHN0ci5zcGxpdChzZXApOw0KICAgIHZhciBpID0gLTEsDQogICAgICBsZW4gPSBidWYubGVuZ3RoLA0KICAgICAgcmVzdWx0ID0ge30sDQogICAgICBrZXlEaWN0ID0ge30sDQogICAgICBwYWlyLA0KICAgICAga2V5LA0KICAgICAgdmFsdWU7DQogICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgcGFpciA9IGJ1ZltpXS5zcGxpdChlcSk7DQogICAgICBrZXkgPSBwYWlyWzBdOw0KICAgICAgdmFsdWUgPSBwYWlyWzFdOw0KICAgICAgaWYgKGtleURpY3Rba2V5XSkgew0KICAgICAgICBpZiAoa2V5RGljdFtrZXldID09PSAxKSB7DQogICAgICAgICAga2V5RGljdFtrZXldID0gMjsNCiAgICAgICAgICByZXN1bHRba2V5XSA9IFtyZXN1bHRba2V5XSwgdmFsdWVdOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJlc3VsdFtrZXldLnB1c2godmFsdWUpOw0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICBrZXlEaWN0W2tleV0gPSAxOw0KICAgICAgICByZXN1bHRba2V5XSA9IHZhbHVlOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9CgogIHZhciBxdWVyeXN0cmluZyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgIGVzY2FwZTogZXNjYXBlLAogICAgdW5lc2NhcGU6IHVuZXNjYXBlLAogICAgc3RyaW5naWZ5OiBzdHJpbmdpZnksCiAgICBwYXJzZTogcGFyc2UkMQogIH0pOwoKICB2YXIgQklOX1RZUEVTID0gWydhcnJheWJ1ZmZlcicsICdibG9iJ107DQoNCiAgZnVuY3Rpb24gcmVxdWVzdChvcHRpb25zKSB7DQogICAgdmFyIGh0dHAsIHVyaSwgbWV0aG9kLCB0aW1lb3V0Ow0KICAgIGh0dHAgPSBuZXcgQWN0aXZlWE9iamVjdCgnV2luSHR0cC5XaW5IdHRwUmVxdWVzdC41LjEnKTsNCiAgICB1cmkgPSBvcHRpb25zLnVyaSB8fCBvcHRpb25zLnVybCB8fCBvcHRpb25zLnBhdGg7DQogICAgbWV0aG9kID0gKG9wdGlvbnMubWV0aG9kIHx8ICdHRVQnKS50b1VwcGVyQ2FzZSgpOw0KICAgIHRpbWVvdXQgPSBvcHRpb25zLnRpbWVvdXQgfHwgMzAwMDsNCiAgICBodHRwLnNldFRpbWVvdXRzKHRpbWVvdXQsIHRpbWVvdXQsIHRpbWVvdXQsIHRpbWVvdXQpOw0KDQogICAgdHJ5IHsNCiAgICAgIHZhciBkYXRhID0gb3B0aW9ucy5mb3JtIHx8IG9wdGlvbnMuZGF0YSB8fCBudWxsOw0KICAgICAgaWYgKGRhdGEgJiYgdHlwZW9mIGRhdGEgIT09ICdzdHJpbmcnKSB7IGRhdGEgPSBzdHJpbmdpZnkoZGF0YSk7IH0NCiAgICAgIGlmIChkYXRhKSB7DQogICAgICAgIGlmIChtZXRob2QgPT09ICdHRVQnKSB7DQogICAgICAgICAgaHR0cC5vcGVuKG1ldGhvZCwgdXJpICsgJz8nICsgZGF0YSwgZmFsc2UpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGh0dHAub3BlbihtZXRob2QsIHVyaSwgZmFsc2UpOw0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICBodHRwLm9wZW4obWV0aG9kLCB1cmksIGZhbHNlKTsNCiAgICAgIH0NCiAgICAgIGFwcGx5T3B0aW9ucyhodHRwLCBvcHRpb25zKTsNCiAgICAgIGh0dHAuc2VuZChkYXRhKTsNCg0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgc3RhdHVzQ29kZTogaHR0cC5zdGF0dXMsDQogICAgICAgIGhlYWRlcnM6IHBhcnNlSGVhZGVycyhodHRwLmdldEFsbFJlc3BvbnNlSGVhZGVycygpKSwNCiAgICAgICAgYm9keTogQklOX1RZUEVTLmluY2x1ZGVzKG9wdGlvbnMucmVzcG9uc2VUeXBlKQ0KICAgICAgICAgID8gQnVmZmVyLmZyb20oaHR0cC5SZXNwb25zZUJvZHkpDQogICAgICAgICAgOiBodHRwLlJlc3BvbnNlVGV4dA0KICAgICAgfTsNCiAgICB9IGNhdGNoIChlKSB7DQogICAgICB0aHJvdyBlOw0KICAgIH0NCiAgfQ0KICAvKg0KICBXaW5IdHRwUmVxdWVzdE9wdGlvbg0KICAgIFVzZXJBZ2VudFN0cmluZyA9IDANCiAgICBVUkwgPSAxDQogICAgVVJMQ29kZVBhZ2UgPSAyDQogICAgRXNjYXBlUGVyY2VudEluVVJMID0gMw0KICAgIFNzbEVycm9ySWdub3JlRmxhZ3MgPSA0DQogICAgU2VsZWN0Q2VydGlmaWNhdGUgPSA1DQogICAgRW5hYmxlUmVkaXJlY3RzID0gNg0KICAgIFVybEVzY2FwZURpc2FibGUgPSA3DQogICAgVXJsRXNjYXBlRGlzYWJsZVF1ZXJ5ID0gOA0KICAgIFNlY3VyZVByb3RvY29scyA9IDkNCiAgICBFbmFibGVUcmFjaW5nID0gMTANCiAgICBSZXZlcnRJbXBlcnNvbmF0aW9uT3ZlclNzbCA9IDExDQogICAgRW5hYmxlSHR0cHNUb0h0dHBSZWRpcmVjdHMgPSAxMg0KICAgIEVuYWJsZVBhc3Nwb3J0QXV0aGVudGljYXRpb24gPSAxMw0KICAgIE1heEF1dG9tYXRpY1JlZGlyZWN0cyA9IDE0DQogICAgTWF4UmVzcG9uc2VIZWFkZXJTaXplID0gMTUNCiAgICBNYXhSZXNwb25zZURyYWluU2l6ZSA9IDE2DQogICAgRW5hYmxlSHR0cDFfMSA9IDE3DQogICAgRW5hYmxlQ2VydGlmaWNhdGVSZXZvY2F0aW9uQ2hlY2sgPSAxOA0KICAqLw0KICB2YXIgc2V0UmVxT3B0cyA9IEZ1bmN0aW9uKA0KICAgICdodHRwJywNCiAgICAiXG5odHRwLk9wdGlvbigwKSA9ICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjE7IFRyaWRlbnQvNy4wOyBydjoxMS4wKSBsaWtlIEdlY2tvJztcbmh0dHAuT3B0aW9uKDQpID0gMTMwNTY7XG5odHRwLk9wdGlvbig2KSA9IGZhbHNlOyINCiAgKTsNCg0KICBmdW5jdGlvbiBhcHBseU9wdGlvbnMoaHR0cCwgb3B0aW9ucykgew0KICAgIGlmIChvcHRpb25zLnByb3h5KSB7DQogICAgICBzZXRSZXFPcHRzKGh0dHApOw0KICAgICAgaHR0cC5zZXRQcm94eSgnMicsIG9wdGlvbnMucHJveHkpOw0KICAgICAgLy8gaHR0cC5TZXRDbGllbnRDZXJ0aWZpY2F0ZSgiTE9DQUxfTUFDSElORVxQZXJzb25hbFxNeSBDZXJ0aWZpY2F0ZSIpDQogICAgICAvLyBodHRwLlNldENyZWRlbnRpYWxzKCd1c2VyJywgJ3Bhc3MnLCAxKTsNCiAgICB9DQoNCiAgICBpZiAob3B0aW9ucy5tZXRob2QgIT09ICdHRVQnKSB7DQogICAgICBodHRwLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnKTsNCiAgICB9DQoNCiAgICB2YXIgaGVhZGVycyA9IG9wdGlvbnMuaGVhZGVyczsNCiAgICBpZiAoaGVhZGVycykgew0KICAgICAgZm9yICh2YXIga2V5IGluIGhlYWRlcnMpIHsNCiAgICAgICAgaWYgKGtleS50b0xvd2VyQ2FzZSgpID09ICdjb29raWUnKSB7DQogICAgICAgICAgaHR0cC5zZXRSZXF1ZXN0SGVhZGVyKCdDb29raWUnLCAnc3RyaW5nJyk7DQogICAgICAgICAgaHR0cC5zZXRSZXF1ZXN0SGVhZGVyKCdDb29raWUnLCBoZWFkZXJzW2tleV0pOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGh0dHAuc2V0UmVxdWVzdEhlYWRlcihrZXksIGhlYWRlcnNba2V5XSk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBwYXJzZUhlYWRlcnMoc3RyX2hlYWRlcnMpIHsNCiAgICB2YXIgcmVzdWx0ID0ge30sDQogICAgICBoZWFkZXJzLA0KICAgICAgaSwNCiAgICAgIGssDQogICAgICB2Ow0KICAgIGhlYWRlcnMgPSBzdHJfaGVhZGVycy50cmltKCkuc3BsaXQoL1xyP1xuLyk7DQogICAgaGVhZGVycy5mb3JFYWNoKGZ1bmN0aW9uIChoZWFkZXIpIHsNCiAgICAgIGkgPSBoZWFkZXIuaW5kZXhPZignOicpOw0KICAgICAgayA9IGhlYWRlci5zbGljZSgwLCBpKS50cmltKCk7DQogICAgICB2ID0gaGVhZGVyLnNsaWNlKGkgKyAxKS50cmltKCk7DQogICAgICBpZiAoay50b0xvd2VyQ2FzZSgpID09ICdzZXQtY29va2llJykgew0KICAgICAgICBpZiAocmVzdWx0W2tdKSB7IHJlc3VsdFtrXS5wdXNoKHYpOyB9DQogICAgICAgIGVsc2UgeyByZXN1bHRba10gPSBbdl07IH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJlc3VsdFtrXSA9IHY7DQogICAgICB9DQogICAgfSk7DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGdldE9wdGlvbihhcmdzKSB7DQogICAgdmFyIG9wdGlvbnM7DQogICAgaWYgKHR5cGVvZiBhcmdzWzBdID09PSAnc3RyaW5nJykgew0KICAgICAgb3B0aW9ucyA9IGFyZ3NbMV0gfHwge307DQogICAgICBvcHRpb25zLnVyaSA9IGFyZ3NbMF07DQogICAgfSBlbHNlIHsNCiAgICAgIG9wdGlvbnMgPSBhcmdzWzBdIHx8IHt9Ow0KICAgIH0NCiAgICByZXR1cm4gb3B0aW9uczsNCiAgfQ0KDQogIHZhciBodHRwID0gew0KICAgIHJlcXVlc3Q6IGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuIHJlcXVlc3QoZ2V0T3B0aW9uKGFyZ3VtZW50cykpOw0KICAgIH0sDQogICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgIHZhciBvcHRpb25zID0gZ2V0T3B0aW9uKGFyZ3VtZW50cyk7DQogICAgICBvcHRpb25zLm1ldGhvZCA9ICdHRVQnOw0KICAgICAgcmV0dXJuIHJlcXVlc3Qob3B0aW9ucyk7DQogICAgfSwNCiAgICBwb3N0OiBmdW5jdGlvbigpIHsNCiAgICAgIHZhciBvcHRpb25zID0gZ2V0T3B0aW9uKGFyZ3VtZW50cyk7DQogICAgICBvcHRpb25zLm1ldGhvZCA9ICdQT1NUJzsNCiAgICAgIHJldHVybiByZXF1ZXN0KG9wdGlvbnMpOw0KICAgIH0NCiAgfTsKCiAgdmFyIGh0dHAkMSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgICdkZWZhdWx0JzogaHR0cAogIH0pOwoKICBmdW5jdGlvbiBfY2lwaGVyKGVuYywgYnVmX3Bhc3N3b3JkLCBidWZfZGF0YSkgew0KICAgIHZhciBjcnlwdCA9IG5ldyBBY3RpdmVYT2JqZWN0KCdTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5LlJpam5kYWVsTWFuYWdlZCcpOw0KICAgIHZhciBrZXlIYXNoID0gbmV3IEFjdGl2ZVhPYmplY3QoJ1N5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHkuU0hBMjU2TWFuYWdlZCcpOw0KICAgIGtleUhhc2guQ29tcHV0ZUhhc2hfMihidWZfcGFzc3dvcmQuYnVmZmVyKTsNCiAgICBjcnlwdC5LZXkgPSBrZXlIYXNoLkhhc2g7DQogICAga2V5SGFzaC5DbGVhcigpOw0KDQogICAgdmFyIGl2SGFzaCA9IG5ldyBBY3RpdmVYT2JqZWN0KA0KICAgICAgJ1N5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHkuTUQ1Q3J5cHRvU2VydmljZVByb3ZpZGVyJw0KICAgICk7DQogICAgaXZIYXNoLkNvbXB1dGVIYXNoXzIoYnVmX3Bhc3N3b3JkLmJ1ZmZlcik7DQogICAgY3J5cHQuSVYgPSBpdkhhc2guSGFzaDsNCiAgICBpdkhhc2guQ2xlYXIoKTsNCg0KICAgIHZhciBkc3QgPSBudWxsOw0KICAgIHZhciB0cyA9IGVuYyA/IGNyeXB0LkNyZWF0ZUVuY3J5cHRvcigpIDogY3J5cHQuQ3JlYXRlRGVjcnlwdG9yKCk7DQogICAgdHJ5IHsNCiAgICAgIGRzdCA9IHRzLlRyYW5zZm9ybUZpbmFsQmxvY2soYnVmX2RhdGEuYnVmZmVyLCAwLCBidWZfZGF0YS5sZW5ndGgpOw0KICAgIH0gZmluYWxseSB7DQogICAgICBjcnlwdC5DbGVhcigpOw0KICAgIH0NCiAgICByZXR1cm4gZHN0Ow0KICB9DQoNCiAgdmFyIENpcGhlciA9IGZ1bmN0aW9uIENpcGhlcihhbGdvcml0aG0sIHBhc3N3b3JkLCBpc0VuY29kZSkgew0KICAgIHRoaXMuYWxnb3JpdGhtID0gYWxnb3JpdGhtOw0KICAgIHRoaXMucGFzc3dvcmQgPSBwYXNzd29yZDsNCiAgICB0aGlzLmlzRW5jb2RlID0gaXNFbmNvZGU7DQogICAgdGhpcy5kYXRhID0gbnVsbDsNCiAgICB0aGlzLmlucHV0RW5jb2RpbmcgPSBudWxsOw0KICAgIHRoaXMub3V0cHV0RW5jb2RpbmcgPSBudWxsOw0KICB9Ow0KDQogIENpcGhlci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gdXBkYXRlIChkYXRhLCBpbnB1dEVuY29kaW5nLCBvdXRwdXRFbmNvZGluZykgew0KICAgIHRoaXMuZGF0YSA9IGRhdGE7DQogICAgaWYgKGlucHV0RW5jb2RpbmcpIHsgdGhpcy5pbnB1dEVuY29kaW5nID0gaW5wdXRFbmNvZGluZzsgfQ0KICAgIGlmIChvdXRwdXRFbmNvZGluZykgeyB0aGlzLm91dHB1dEVuY29kaW5nID0gb3V0cHV0RW5jb2Rpbmc7IH0NCiAgICByZXR1cm4gdGhpczsNCiAgfTsNCg0KICBDaXBoZXIucHJvdG90eXBlLmZpbmFsID0gZnVuY3Rpb24gZmluYWwgKG91dHB1dEVuY29kaW5nKSB7DQogICAgaWYgKG91dHB1dEVuY29kaW5nKSB7IHRoaXMub3V0cHV0RW5jb2RpbmcgPSBvdXRwdXRFbmNvZGluZzsgfQ0KICAgIHZhciBieXRlcyA9IF9jaXBoZXIoDQogICAgICB0aGlzLmlzRW5jb2RlLA0KICAgICAgQnVmZmVyLmZyb20odGhpcy5wYXNzd29yZCksDQogICAgICBCdWZmZXIuZnJvbSh0aGlzLmRhdGEsIHRoaXMuaW5wdXRFbmNvZGluZykNCiAgICApOw0KICAgIGlmICh0aGlzLm91dHB1dEVuY29kaW5nID09IG51bGwgfHwgdGhpcy5vdXRwdXRFbmNvZGluZyA9PSAnYmluYXJ5Jykgew0KICAgICAgcmV0dXJuIEJ1ZmZlci5mcm9tKGJ5dGVzKTsNCiAgICB9IGVsc2Ugew0KICAgICAgcmV0dXJuIEJ1ZmZlci5mcm9tKGJ5dGVzKS50b1N0cmluZyh0aGlzLm91dHB1dEVuY29kaW5nKTsNCiAgICB9DQogIH07DQoNCiAgZnVuY3Rpb24gX2hhc2gob2JqbmFtZSwgYnVmX2RhdGEsIG9wdF90eXBlKSB7DQogICAgdmFyIHByb3ZpZGVyID0gbmV3IEFjdGl2ZVhPYmplY3Qob2JqbmFtZSk7DQogICAgcHJvdmlkZXIuQ29tcHV0ZUhhc2hfMihidWZfZGF0YS5idWZmZXIpOw0KICAgIHZhciBoYXNocyA9IHByb3ZpZGVyLkhhc2g7DQogICAgcHJvdmlkZXIuQ2xlYXIoKTsNCiAgICByZXR1cm4gQnVmZmVyLmZyb20oaGFzaHMpLnRvU3RyaW5nKG9wdF90eXBlIHx8ICdoZXgnKTsNCiAgfQ0KDQogIHZhciBIYXNoID0gZnVuY3Rpb24gSGFzaChhbGdvcml0aG0pIHsNCiAgICB0aGlzLmFsZ29yaXRobSA9IGFsZ29yaXRobTsNCiAgICB0aGlzLmRhdGEgPSBudWxsOw0KICAgIHRoaXMuaW5wdXRFbmNvZGluZyA9IG51bGw7DQogIH07DQoNCiAgSGFzaC5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gdXBkYXRlIChkYXRhLCBpbnB1dEVuY29kaW5nKSB7CiAgICAgIGlmICggaW5wdXRFbmNvZGluZyA9PT0gdm9pZCAwICkgaW5wdXRFbmNvZGluZyA9ICd1dGYtOCc7Cg0KICAgIHRoaXMuaW5wdXRFbmNvZGluZyA9IGlucHV0RW5jb2Rpbmc7DQogICAgdGhpcy5kYXRhID0gZGF0YTsNCiAgICByZXR1cm4gdGhpczsNCiAgfTsNCg0KICBIYXNoLnByb3RvdHlwZS5kaWdlc3QgPSBmdW5jdGlvbiBkaWdlc3QgKGVuY29kaW5nKSB7DQogICAgaWYgKHRoaXMuYWxnb3JpdGhtID09ICdtZDUnKSB7DQogICAgICByZXR1cm4gX2hhc2goDQogICAgICAgICdTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5Lk1ENUNyeXB0b1NlcnZpY2VQcm92aWRlcicsDQogICAgICAgIEJ1ZmZlci5mcm9tKHRoaXMuZGF0YSwgdGhpcy5pbnB1dEVuY29kaW5nKSwNCiAgICAgICAgZW5jb2RpbmcNCiAgICAgICk7DQogICAgfSBlbHNlIGlmICh0aGlzLmFsZ29yaXRobSA9PSAnc2hhMScpIHsNCiAgICAgIHJldHVybiBfaGFzaCgNCiAgICAgICAgJ1N5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHkuU0hBMUNyeXB0b1NlcnZpY2VQcm92aWRlcicsDQogICAgICAgIEJ1ZmZlci5mcm9tKHRoaXMuZGF0YSwgdGhpcy5pbnB1dEVuY29kaW5nKSwNCiAgICAgICAgZW5jb2RpbmcNCiAgICAgICk7DQogICAgfQ0KICB9Ow0KDQogIHZhciBjcnlwdG8gPSB7DQogICAgY3JlYXRlQ2lwaGVyOiBmdW5jdGlvbihhbGdvcml0aG0sIHBhc3N3b3JkKSB7DQogICAgICByZXR1cm4gbmV3IENpcGhlcihhbGdvcml0aG0sIHBhc3N3b3JkLCB0cnVlKTsNCiAgICB9LA0KDQogICAgY3JlYXRlRGVDaXBoZXI6IGZ1bmN0aW9uKGFsZ29yaXRobSwgcGFzc3dvcmQpIHsNCiAgICAgIHJldHVybiBuZXcgQ2lwaGVyKGFsZ29yaXRobSwgcGFzc3dvcmQsIGZhbHNlKTsNCiAgICB9LA0KDQogICAgY3JlYXRlSGFzaDogZnVuY3Rpb24oYWxnb3JpdGhtKSB7DQogICAgICByZXR1cm4gbmV3IEhhc2goYWxnb3JpdGhtKTsNCiAgICB9DQogIH07CgogIHZhciBjcnlwdG8kMSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgIENpcGhlcjogQ2lwaGVyLAogICAgJ2RlZmF1bHQnOiBjcnlwdG8KICB9KTsKCiAgdmFyIERFRkFVTFRfT1BUSU9OUyA9IHsNCiAgICBoZWFkZXJzOiBmYWxzZSwNCiAgICBkZWxpbWl0ZXI6ICcsJywNCiAgICBxdW90ZTogJyInLA0KICAgIGVzY2FwZTogJyInLA0KICAgIHRyaW06IGZhbHNlLA0KICAgIHJ0cmltOiBmYWxzZSwNCiAgICBsdHJpbTogZmFsc2UsDQogICAgbmV3bGluZTogJ1xyXG4nDQogIH07DQoNCiAgdmFyIEVNUFRZX0NIQVJfUkVHRVhQID0gL1xzLzsNCg0KICBmdW5jdGlvbiBQYXJzZXIob3B0aW9ucykgew0KICAgIE9iamVjdC5hc3NpZ24odGhpcywgREVGQVVMVF9PUFRJT05TKTsNCiAgICBpZiAob3B0aW9ucyAhPSBudWxsICYmIHR5cGVvZiBvcHRpb25zID09ICdvYmplY3QnKSB7DQogICAgICBPYmplY3QuYXNzaWduKHRoaXMsIG9wdGlvbnMpOw0KICAgIH0NCiAgfQ0KDQogIHZhciBQUCA9IFBhcnNlci5wcm90b3R5cGU7DQoNCiAgUFAuaW5pdCA9IGZ1bmN0aW9uKCkgew0KICAgIHRoaXMucm93cyA9IFtdOw0KICAgIHRoaXMucm93ID0gW107DQogICAgdGhpcy5jdXJzb3IgPSAwOw0KICAgIHRoaXMucG9zID0gMDsNCiAgICB0aGlzLmJ1ZiA9IFtdOw0KICAgIHRoaXMuYnVmTGVuID0gMDsNCiAgICB0aGlzLmVzY2FwaW5nID0gZmFsc2U7DQogIH07DQoNCiAgUFAucGFyc2UgPSBmdW5jdGlvbiBmcm9tU3RyaW5nKHN0cikgew0KICAgIHZhciBpID0gMCwNCiAgICAgIGxlbiA9IHN0ci5sZW5ndGg7DQogICAgdGhpcy5pbml0KCk7DQogICAgZm9yICg7IGkgPCBsZW47IGkrKykgew0KICAgICAgdGhpcy5fY2hhcihzdHIuY2hhckF0KGkpKTsNCiAgICB9DQogICAgcmV0dXJuIHRoaXMuX2dldFJlc3VsdCgpOw0KICB9Ow0KDQogIFBQLl9nZXRSZXN1bHQgPSBmdW5jdGlvbigpIHsNCiAgICB2YXIgcmVzdWx0LCBoZWFkZXJzLCBsZW47DQogICAgaWYgKHRoaXMucG9zICE9PSB0aGlzLmN1cnNvcikgew0KICAgICAgdGhpcy5fcm93KCk7DQogICAgfQ0KICAgIGxlbiA9IHRoaXMucm93cy5sZW5ndGg7DQogICAgcmVzdWx0ID0gdGhpcy5yb3dzOw0KICAgIGlmICh0aGlzLmhlYWRlcnMgPT09IHRydWUgJiYgbGVuID4gMSkgew0KICAgICAgaGVhZGVycyA9IHRoaXMucm93c1swXTsNCiAgICAgIHRoaXMucm93cy5zaGlmdCgpOw0KICAgIH0gZWxzZSBpZiAoaXNBcnJheSh0aGlzLmhlYWRlcnMpICYmIGxlbiA+IDApIHsNCiAgICAgIGhlYWRlcnMgPSB0aGlzLmhlYWRlcnM7DQogICAgfQ0KICAgIGlmIChoZWFkZXJzICYmIGhlYWRlcnMubGVuZ3RoID4gMCkgew0KICAgICAgcmVzdWx0ID0gdGhpcy5yb3dzLm1hcChmdW5jdGlvbiAocm93KSB7IHJldHVybiB6aXBPYmplY3QoaGVhZGVycywgcm93KTsgfSk7DQogICAgfQ0KICAgIHJldHVybiByZXN1bHQ7DQogIH07DQoNCiAgUFAuX2NoYXIgPSBmdW5jdGlvbihjKSB7DQogICAgaWYgKGMgPT09IHRoaXMuZGVsaW1pdGVyICYmICF0aGlzLmVzY2FwaW5nKSB7DQogICAgICB0aGlzLl9jZWxsKCk7DQogICAgfSBlbHNlIGlmIChjID09PSB0aGlzLnF1b3RlKSB7DQogICAgICB0aGlzLl9wdXNoKGMpOw0KICAgICAgdGhpcy5fcXVvdGUoKTsNCiAgICB9IGVsc2UgaWYgKGMgPT09IHRoaXMuZXNjYXBlKSB7DQogICAgICB0aGlzLl9wdXNoKGMpOw0KICAgICAgdGhpcy5fZXNjYXBlKCk7DQogICAgfSBlbHNlIGlmIChjID09PSAnXG4nICYmICF0aGlzLmVzY2FwaW5nKSB7DQogICAgICB0aGlzLl9yb3coKTsNCiAgICB9IGVsc2Ugew0KICAgICAgdGhpcy5fcHVzaChjKTsNCiAgICB9DQoNCiAgICB0aGlzLmN1cnNvcisrOw0KICB9Ow0KDQogIFBQLl9wdXNoID0gZnVuY3Rpb24oYykgew0KICAgIGlmICh0aGlzLmJ1ZkxlbiA9PT0gMCkgew0KICAgICAgaWYgKCh0aGlzLnRyaW0gfHwgdGhpcy5sdHJpbSkgJiYgRU1QVFlfQ0hBUl9SRUdFWFAudGVzdChjKSkgeyByZXR1cm47IH0NCiAgICAgIGlmIChjID09PSB0aGlzLnF1b3RlKSB7IHJldHVybjsgfQ0KICAgIH0NCiAgICB0aGlzLmJ1Zlt0aGlzLmJ1Zkxlbl0gPSBjOw0KICAgIHRoaXMuYnVmTGVuKys7DQogIH07DQoNCiAgUFAuX2NlbGwgPSBmdW5jdGlvbigpIHsNCiAgICB2YXIgaXRlbSA9IHRoaXMuX2dldFZhbHVlKCk7DQogICAgdGhpcy5yb3cucHVzaChpdGVtKTsNCiAgfTsNCg0KICBQUC5fZ2V0VmFsdWUgPSBmdW5jdGlvbigpIHsNCiAgICB2YXIgcmVzdWx0LCBjLCBpOw0KICAgIGkgPSB0aGlzLmJ1ZkxlbjsNCiAgICB3aGlsZSAoaS0tKSB7DQogICAgICBjID0gdGhpcy5idWZbaV07DQogICAgICBpZiAoRU1QVFlfQ0hBUl9SRUdFWFAudGVzdChjKSkgew0KICAgICAgICBpZiAodGhpcy50cmltIHx8IHRoaXMucnRyaW0pIHsNCiAgICAgICAgICB0aGlzLmJ1ZltpXSA9ICcnOw0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICBpZiAoYyA9PT0gdGhpcy5xdW90ZSkgew0KICAgICAgICAgIHRoaXMuYnVmW2ldID0gJyc7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogICAgcmVzdWx0ID0gdGhpcy5idWYuam9pbignJyk7DQogICAgdGhpcy5idWYubGVuZ3RoID0gMDsNCiAgICB0aGlzLmJ1ZkxlbiA9IDA7DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfTsNCg0KICBQUC5fcm93ID0gZnVuY3Rpb24oKSB7DQogICAgaWYgKHRoaXMuYnVmTGVuID4gMCAmJiB0aGlzLmJ1Zlt0aGlzLmJ1ZkxlbiAtIDFdID09PSAnXHInKSB7DQogICAgICB0aGlzLmJ1Zlt0aGlzLmJ1ZkxlbiAtIDFdID0gJyc7DQogICAgfQ0KICAgIHRoaXMuX2NlbGwoKTsNCiAgICB0aGlzLnJvd3MucHVzaCh0aGlzLnJvdyk7DQogICAgdGhpcy5yb3cgPSBbXTsNCiAgICB0aGlzLnBvcyA9IHRoaXMuY3Vyc29yOw0KICB9Ow0KDQogIFBQLl9xdW90ZSA9IGZ1bmN0aW9uKCkgew0KICAgIHRoaXMuZXNjYXBpbmcgPSAhdGhpcy5lc2NhcGluZzsNCiAgICBpZiAodGhpcy5idWZMZW4gPiAxICYmIHRoaXMuYnVmW3RoaXMuYnVmTGVuIC0gMl0gPT09IHRoaXMuZXNjYXBlKSB7DQogICAgICB0aGlzLmJ1Zlt0aGlzLmJ1ZkxlbiAtIDJdID0gdGhpcy5idWZbdGhpcy5idWZMZW4gLSAxXTsNCiAgICAgIHRoaXMuYnVmW3RoaXMuYnVmTGVuIC0gMV0gPSAnJzsNCiAgICB9DQogIH07DQoNCiAgUFAuX2VzY2FwZSA9IGZ1bmN0aW9uKCkgew0KICAgIHRoaXMuZXNjYXBpbmcgPSAhdGhpcy5lc2NhcGluZzsNCiAgfTsNCg0KICBmdW5jdGlvbiBjcmVhdGVQYXJzZXIob3B0aW9ucykgew0KICAgIHJldHVybiBuZXcgUGFyc2VyKG9wdGlvbnMpOw0KICB9DQoNCiAgZnVuY3Rpb24gcGFyc2UkMihzdHIsIG9wdGlvbnMpIHsNCiAgICByZXR1cm4gbmV3IFBhcnNlcihvcHRpb25zKS5wYXJzZShzdHIpOw0KICB9DQoNCiAgZnVuY3Rpb24gRm9ybWF0dGVyKG9wdGlvbnMpIHsNCiAgICBPYmplY3QuYXNzaWduKHRoaXMsIERFRkFVTFRfT1BUSU9OUyk7DQogICAgaWYgKG9wdGlvbnMgIT0gbnVsbCAmJiB0eXBlb2Ygb3B0aW9ucyA9PSAnb2JqZWN0JykNCiAgICAgIHsgT2JqZWN0LmFzc2lnbih0aGlzLCBvcHRpb25zKTsgfQ0KICB9DQoNCiAgdmFyIEZQID0gRm9ybWF0dGVyLnByb3RvdHlwZTsNCg0KICBGUC5pbml0ID0gZnVuY3Rpb24oKSB7DQogICAgdGhpcy5yb3dzID0gW107DQogIH07DQoNCiAgRlAuc3RyaW5naWZ5ID0gZnVuY3Rpb24oZGF0YSkgew0KICAgIHZhciByb3csIGksIGxlbiwgcm93RGF0YUlzQXJyYXk7DQogICAgdGhpcy5pbml0KCk7DQogICAgaWYgKGlzQXJyYXkodGhpcy5oZWFkZXJzKSkgew0KICAgICAgdGhpcy5fYXBwZW5kTGluZSh0aGlzLmhlYWRlcnMpOw0KICAgIH0NCiAgICBsZW4gPSBpc0FycmF5KGRhdGEpICYmIGRhdGEubGVuZ3RoOw0KICAgIGlmIChsZW4gJiYgbGVuID4gMCkgew0KICAgICAgaSA9IDA7DQogICAgICByb3cgPSBkYXRhWzBdOw0KICAgICAgcm93RGF0YUlzQXJyYXkgPSBpc0FycmF5KHJvdyk7DQogICAgICBpZiAocm93RGF0YUlzQXJyYXkpIHsNCiAgICAgICAgaWYgKHRoaXMuaGVhZGVycyA9PT0gdHJ1ZSkgew0KICAgICAgICAgIHRoaXMuaGVhZGVycyA9IHJvdzsNCiAgICAgICAgICB0aGlzLl9hcHBlbmRMaW5lKHRoaXMuaGVhZGVycyk7DQogICAgICAgICAgaSA9IDE7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMuaGVhZGVycyA9IE9iamVjdC5rZXlzKHJvdyk7DQogICAgICAgIHRoaXMuX2FwcGVuZExpbmUodGhpcy5oZWFkZXJzKTsNCiAgICAgIH0NCg0KICAgICAgZm9yICg7IGkgPCBsZW47IGkrKykgew0KICAgICAgICByb3cgPSBkYXRhW2ldOw0KICAgICAgICBpZiAocm93RGF0YUlzQXJyYXkpIHsgdGhpcy5fYXBwZW5kTGluZShyb3cpOyB9DQogICAgICAgIGVsc2UgeyB0aGlzLl9hcHBlbmRMaW5lKG1hcChyb3cpKTsgfQ0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gdGhpcy5fZ2V0UmVzdWx0KCk7DQogIH07DQoNCiAgRlAuX2FwcGVuZExpbmUgPSBmdW5jdGlvbihyb3cpIHsNCiAgICB2YXIgcXVvdGUgPSB0aGlzLnF1b3RlOw0KICAgIHZhciBlc2NhcGVfcXVvdGUgPSB0aGlzLmVzY2FwZSArIHF1b3RlOw0KICAgIHZhciBxdW90ZVJlZ2V4cCA9IC8iL2c7DQogICAgdmFyIGxpbmUgPSByb3cNCiAgICAgIC5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsNCiAgICAgICAgaWYgKGl0ZW0gPT0gbnVsbCkgew0KICAgICAgICAgIHJldHVybiAnJzsNCiAgICAgICAgfSBlbHNlIGlmIChpc1N0cmluZyhpdGVtKSkgew0KICAgICAgICAgIGlmIChpdGVtLmluY2x1ZGVzKHF1b3RlKSkgew0KICAgICAgICAgICAgcmV0dXJuIHF1b3RlICsgaXRlbS5yZXBsYWNlKHF1b3RlUmVnZXhwLCBlc2NhcGVfcXVvdGUpICsgcXVvdGU7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBpdGVtOw0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gaXRlbSArICcnOw0KICAgICAgICB9DQogICAgICB9KQ0KICAgICAgLmpvaW4odGhpcy5kZWxpbWl0ZXIpOw0KICAgIHRoaXMucm93cy5wdXNoKGxpbmUpOw0KICB9Ow0KDQogIEZQLl9nZXRSZXN1bHQgPSBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gdGhpcy5yb3dzLmpvaW4odGhpcy5uZXdsaW5lKTsNCiAgfTsNCg0KICBmdW5jdGlvbiBjcmVhdGVGb3JtYXR0ZXIob3B0aW9ucykgew0KICAgIHJldHVybiBuZXcgRm9ybWF0dGVyKG9wdGlvbnMpOw0KICB9DQoNCiAgZnVuY3Rpb24gc3RyaW5naWZ5JDEoZGF0YSwgb3B0aW9ucykgew0KICAgIHJldHVybiBuZXcgRm9ybWF0dGVyKG9wdGlvbnMpLnN0cmluZ2lmeShkYXRhKTsNCiAgfQoKICB2YXIgY3N2ID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgY3JlYXRlUGFyc2VyOiBjcmVhdGVQYXJzZXIsCiAgICBwYXJzZTogcGFyc2UkMiwKICAgIGNyZWF0ZUZvcm1hdHRlcjogY3JlYXRlRm9ybWF0dGVyLAogICAgc3RyaW5naWZ5OiBzdHJpbmdpZnkkMQogIH0pOwoKICB2YXIgQVBQX0lEID0gJ0V4Y2VsLkFwcGxpY2F0aW9uJzsNCg0KICBmdW5jdGlvbiBmaW5kJDEoaXRlbXMsIGZuKSB7DQogICAgdmFyIGVuID0gbmV3IEVudW1lcmF0b3IoaXRlbXMpOw0KICAgIHZhciBpdGVtOw0KICAgIGZvciAodmFyIGkgPSAwOyAhZW4uYXRFbmQoKTsgZW4ubW92ZU5leHQoKSwgaSsrKSB7DQogICAgICBpdGVtID0gZW4uaXRlbSgpOw0KICAgICAgaWYgKGZuKGl0ZW0sIGkpID09PSB0cnVlKSB7IHJldHVybiBpdGVtOyB9DQogICAgfQ0KICAgIHJldHVybiBudWxsOw0KICB9DQoNCiAgZnVuY3Rpb24gbWF0Y2hlciQxKHBhdHRlcm4pIHsNCiAgICB2YXIgaXNNYXRjaDsNCiAgICBpZiAoaXNGdW5jdGlvbihwYXR0ZXJuKSkgeyBpc01hdGNoID0gcGF0dGVybjsgfQ0KICAgIGVsc2UgaWYgKGlzU3RyaW5nKHBhdHRlcm4pKSB7IGlzTWF0Y2ggPSBmdW5jdGlvbiAoaXQpIHsgcmV0dXJuIGl0Lk5hbWUuaW5jbHVkZXMocGF0dGVybik7IH07IH0NCiAgICBlbHNlIGlmIChpc1JlZ0V4cChwYXR0ZXJuKSkgeyBpc01hdGNoID0gZnVuY3Rpb24gKGl0KSB7IHJldHVybiBwYXR0ZXJuLnRlc3QoaXQuTmFtZSk7IH07IH0NCiAgICBlbHNlIHsgaXNNYXRjaCA9IG51bGw7IH0NCiAgICByZXR1cm4gaXNNYXRjaDsNCiAgfQ0KDQogIHZhciBFeGNlbCA9IGZ1bmN0aW9uIEV4Y2VsKHB0aCkgewogICAgaWYgKCBwdGggPT09IHZvaWQgMCApIHB0aCA9ICcnOwoNCiAgICB2YXIgYXBwOw0KICAgIHRyeSB7DQogICAgICBhcHAgPSBHZXRPYmplY3QocHRoLCBBUFBfSUQpOw0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgIGFwcCA9IG5ldyBBY3RpdmVYT2JqZWN0KEFQUF9JRCk7DQogICAgfQ0KICAgIGlmICghYXBwLlZpc2libGUpIHsgYXBwLlZpc2libGUgPSB0cnVlOyB9DQogICAgaWYgKGFwcC5Xb3JrYm9va3MuQ291bnQgPT09IDApIHsgYXBwLldvcmtib29rcy5BZGQoKTsgfQ0KICAgIHRoaXMuYXBwID0gYXBwOw0KICB9OwoKICB2YXIgcHJvdG90eXBlQWNjZXNzb3JzJDIgPSB7IGFjdGl2ZUJvb2s6IHsgY29uZmlndXJhYmxlOiB0cnVlIH0sYWN0aXZlU2hlZXQ6IHsgY29uZmlndXJhYmxlOiB0cnVlIH0sYWN0aXZlQ2VsbDogeyBjb25maWd1cmFibGU6IHRydWUgfSxzZWxlY3Rpb246IHsgY29uZmlndXJhYmxlOiB0cnVlIH0sYm9va3M6IHsgY29uZmlndXJhYmxlOiB0cnVlIH0gfTsNCg0KICBwcm90b3R5cGVBY2Nlc3NvcnMkMi5hY3RpdmVCb29rLmdldCA9IGZ1bmN0aW9uICgpIHsNCiAgICByZXR1cm4gdGhpcy5hcHAuQWN0aXZlV29ya0Jvb2s7DQogIH07DQoNCiAgcHJvdG90eXBlQWNjZXNzb3JzJDIuYWN0aXZlU2hlZXQuZ2V0ID0gZnVuY3Rpb24gKCkgew0KICAgIHJldHVybiB0aGlzLmFwcC5BY3RpdmVTaGVldDsNCiAgfTsNCg0KICBwcm90b3R5cGVBY2Nlc3NvcnMkMi5hY3RpdmVDZWxsLmdldCA9IGZ1bmN0aW9uICgpIHsNCiAgICByZXR1cm4gdGhpcy5hcHAuQWN0aXZlQ2VsbDsNCiAgfTsNCg0KICBwcm90b3R5cGVBY2Nlc3NvcnMkMi5zZWxlY3Rpb24uZ2V0ID0gZnVuY3Rpb24gKCkgew0KICAgIHJldHVybiB0aGlzLmFwcC5TZWxlY3Rpb247DQogIH07DQoNCiAgcHJvdG90eXBlQWNjZXNzb3JzJDIuYm9va3MuZ2V0ID0gZnVuY3Rpb24gKCkgew0KICAgIHJldHVybiB0aGlzLmFwcC5Xb3JrQm9va3M7DQogIH07DQoNCiAgRXhjZWwucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gY2xvc2UgKCkgew0KICAgIHRoaXMuYXBwICYmIHRoaXMuYXBwLlF1aXQoKTsNCiAgICB0aGlzLmFwcCA9IG51bGw7DQogIH07DQoNCiAgRXhjZWwucHJvdG90eXBlLmdldEJvb2sgPSBmdW5jdGlvbiBnZXRCb29rIChuYW1lKSB7DQogICAgcmV0dXJuIG5hbWUgPyB0aGlzLmFwcC5Xb3JrQm9va3MobmFtZSkgOiB0aGlzLmFjdGl2ZUJvb2s7DQogIH07DQoNCiAgRXhjZWwucHJvdG90eXBlLmdldFNoZWV0ID0gZnVuY3Rpb24gZ2V0U2hlZXQgKHNoZWV0TmFtZSwgYm9va05hbWUpIHsNCiAgICByZXR1cm4gc2hlZXROYW1lDQogICAgICA/IHRoaXMuZ2V0Qm9vayhib29rTmFtZSkuU2hlZXRzKHNoZWV0TmFtZSkNCiAgICAgIDogdGhpcy5hY3RpdmVTaGVldDsNCiAgfTsNCg0KICBFeGNlbC5wcm90b3R5cGUucmFuZ2UgPSBmdW5jdGlvbiByYW5nZSAoYWRkcikgew0KICAgIHJldHVybiBhZGRyID8gdGhpcy5hcHAuUmFuZ2UoYWRkcikgOiB0aGlzLnNlbGVjdGlvbjsNCiAgfTsNCg0KICBFeGNlbC5wcm90b3R5cGUuZ2V0UmFuZ2UgPSBmdW5jdGlvbiBnZXRSYW5nZSAoc3RyUmFuZ2UsIHNoZWV0TmFtZSwgYm9va05hbWUpIHsNCiAgICByZXR1cm4gc3RyUmFuZ2UNCiAgICAgID8gdGhpcy5nZXRTaGVldChzaGVldE5hbWUsIGJvb2tOYW1lKS5SYW5nZShzdHJSYW5nZSkNCiAgICAgIDogdGhpcy5zZWxlY3Rpb247DQogIH07DQoNCiAgRXhjZWwucHJvdG90eXBlLmNlbGwgPSBmdW5jdGlvbiBjZWxsIChyb3csIGNvbCkgew0KICAgIHJldHVybiByb3cgJiYgY29sID8gdGhpcy5hcHAuQ2VsbHMocm93LCBjb2wpIDogdGhpcy5hY3RpdmVDZWxsOw0KICB9Ow0KDQogIEV4Y2VsLnByb3RvdHlwZS5nZXRDZWxsID0gZnVuY3Rpb24gZ2V0Q2VsbCAocm93LCBjb2wsIHNoZWV0TmFtZSwgYm9va05hbWUpIHsNCiAgICByZXR1cm4gcm93ICYmIGNvbA0KICAgICAgPyB0aGlzLmdldFNoZWV0KHNoZWV0TmFtZSwgYm9va05hbWUpLkNlbGxzKHJvdywgY29sKQ0KICAgICAgOiB0aGlzLmFjdGl2ZUNlbGw7DQogIH07DQoNCiAgRXhjZWwucHJvdG90eXBlLmdldEJvb2tzID0gZnVuY3Rpb24gZ2V0Qm9va3MgKCkgew0KICAgIHJldHVybiBtYXAodGhpcy5ib29rcyk7DQogIH07DQoNCiAgRXhjZWwucHJvdG90eXBlLm9wZW5Cb29rID0gZnVuY3Rpb24gb3BlbkJvb2sgKHBhdGgpIHsNCiAgICBpZiAoIWlzZmlsZShwYXRoKSkgeyByZXR1cm4gbnVsbDsgfQ0KICAgIHZhciB0YXJnZXQgPSBmaW5kJDEodGhpcy5ib29rcywgZnVuY3Rpb24gKGJvb2spIHsgcmV0dXJuIGJvb2suTmFtZSA9PSBiYXNlbmFtZShwYXRoKTsgfSk7DQogICAgcmV0dXJuIHRhcmdldCA/IHRhcmdldCA6IHRoaXMuYm9va3MuT3BlbihwYXRoKTsNCiAgfTsNCg0KICBFeGNlbC5wcm90b3R5cGUubmV3Qm9vayA9IGZ1bmN0aW9uIG5ld0Jvb2sgKCkgew0KICAgIHJldHVybiB0aGlzLmJvb2tzLmFkZCgpOw0KICB9Ow0KDQogIEV4Y2VsLnByb3RvdHlwZS5nZXRTaGVldHMgPSBmdW5jdGlvbiBnZXRTaGVldHMgKGJvb2spIHsNCiAgICByZXR1cm4gbWFwKHRoaXMuZ2V0Qm9vayhib29rKS5TaGVldHMpOw0KICB9Ow0KDQogIEV4Y2VsLnByb3RvdHlwZS5maW5kQm9vayA9IGZ1bmN0aW9uIGZpbmRCb29rIChwYXR0ZXJuKSB7DQogICAgdmFyIGlzTWF0Y2ggPSBtYXRjaGVyJDEocGF0dGVybik7DQogICAgcmV0dXJuIGlzTWF0Y2ggJiYgZmluZCQxKHRoaXMuYm9va3MsIGlzTWF0Y2gpOw0KICB9Ow0KDQogIEV4Y2VsLnByb3RvdHlwZS5maW5kU2hlZXQgPSBmdW5jdGlvbiBmaW5kU2hlZXQgKHBhdHRlcm4sIF9ib29rKSB7DQogICAgdmFyIGJvb2ssIGlzTWF0Y2g7DQogICAgaWYgKF9ib29rKSB7DQogICAgICBib29rID0gdGhpcy5maW5kQm9vayhfYm9vayk7DQogICAgICBpZiAoIWJvb2spIHsgYm9vayA9IF9ib29rOyB9DQogICAgfSBlbHNlIHsNCiAgICAgIGJvb2sgPSB0aGlzLmFjdGl2ZUJvb2s7DQogICAgfQ0KICAgIGlzTWF0Y2ggPSBtYXRjaGVyJDEocGF0dGVybik7DQogICAgcmV0dXJuIGlzTWF0Y2ggJiYgZmluZCQxKGJvb2suU2hlZXRzLCBpc01hdGNoKTsNCiAgfTsNCg0KICBFeGNlbC5wcm90b3R5cGUuZ2V0VmFsdWVzID0gZnVuY3Rpb24gZ2V0VmFsdWVzIChyYW5nZSkgew0KICAgIHZhciByb3dObywNCiAgICAgIHRibCA9IFtdLA0KICAgICAgcm93RGF0YTsNCiAgICBlYWNoKHJhbmdlLCBmdW5jdGlvbiAocikgew0KICAgICAgaWYgKHJvd05vICE9IHIuUm93KSB7DQogICAgICAgIGlmIChyb3dEYXRhKSB7IHRibC5wdXNoKHJvd0RhdGEpOyB9DQogICAgICAgIHJvd0RhdGEgPSBbXTsNCiAgICAgICAgcm93Tm8gPSByLlJvdzsNCiAgICAgIH0NCiAgICAgIHJvd0RhdGEucHVzaChyLnZhbHVlKTsNCiAgICB9KTsNCiAgICBpZiAocm93RGF0YSkgeyB0YmwucHVzaChyb3dEYXRhKTsgfQ0KICAgIHJldHVybiB0Ymw7DQogIH07DQoNCiAgRXhjZWwucHJvdG90eXBlLnNldFZhbHVlcyA9IGZ1bmN0aW9uIHNldFZhbHVlcyAocmFuZ2UsIHZhbHMpIHsNCiAgICBpZiAoaXNBcnJheSh2YWxzKSkgew0KICAgICAgZWFjaCh2YWxzLCBmdW5jdGlvbiAodmFsKSB7DQogICAgICAgIGlmIChpc0FycmF5KHZhbCkpIHsNCiAgICAgICAgICBlYWNoKHZhbCwgZnVuY3Rpb24gKGl0LCBpKSB7DQogICAgICAgICAgICByYW5nZS5vZmZzZXQoMCwgaSkudmFsdWUgPSBpdDsNCiAgICAgICAgICB9KTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByYW5nZS52YWx1ZSA9IHZhbDsNCiAgICAgICAgfQ0KICAgICAgICByYW5nZSA9IHJhbmdlLm9mZnNldCgxLCAwKTsNCiAgICAgIH0pOw0KICAgIH0NCiAgfTsNCg0KICBFeGNlbC5wcm90b3R5cGUubm9fdXBkYXRlID0gZnVuY3Rpb24gbm9fdXBkYXRlIChjYikgew0KICAgIHRyeSB7DQogICAgICB0aGlzLmFwcC5TY3JlZW5VcGRhdGluZyA9IGZhbHNlOw0KICAgICAgY2IoKTsNCiAgICB9IGZpbmFsbHkgew0KICAgICAgdGhpcy5hcHAuU2NyZWVuVXBkYXRpbmcgPSB0cnVlOw0KICAgIH0NCiAgfTsNCg0KICBFeGNlbC5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gdXBkYXRlIChjYikgew0KICAgIHRyeSB7DQogICAgICB0aGlzLmFwcC5TY3JlZW5VcGRhdGluZyA9IHRydWU7DQogICAgICBjYigpOw0KICAgIH0gZmluYWxseSB7DQogICAgICB0aGlzLmFwcC5TY3JlZW5VcGRhdGluZyA9IGZhbHNlOw0KICAgIH0NCiAgfTsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoIEV4Y2VsLnByb3RvdHlwZSwgcHJvdG90eXBlQWNjZXNzb3JzJDIgKTsKDQogIEV4Y2VsLnhsZG93biA9IC00MTIxOw0KICBFeGNlbC54bFRvTGVmdCA9IC00MTU5Ow0KICBFeGNlbC54bFRvUmlnaHQgPSAtNDE2MTsNCiAgRXhjZWwueGx1cCA9IC00MTYyOwoKICB2YXIgZXhjZWwgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICAnZGVmYXVsdCc6IEV4Y2VsCiAgfSk7CgogIGZ1bmN0aW9uIGdldFdpbmRvd3MoKSB7DQogICAgdmFyIHdpbnMgPSBbXTsNCiAgICBlYWNoKF9fU2hlbGxBcHAuV2luZG93cygpLCBmdW5jdGlvbiAoYXBwKSB7DQogICAgICBpZiAoYXBwICYmIGFwcC5OYW1lID09PSAnSW50ZXJuZXQgRXhwbG9yZXInKSB7DQogICAgICAgIHdpbnMucHVzaChhcHApOw0KICAgICAgfQ0KICAgIH0pOw0KICAgIHJldHVybiB3aW5zOw0KICB9DQoNCiAgZnVuY3Rpb24gZ2V0QWN0aXZlKCkgew0KICAgIHZhciBpZTsNCiAgICBlYWNoKF9fU2hlbGxBcHAuV2luZG93cygpLCBmdW5jdGlvbiAoYXBwKSB7DQogICAgICBpZiAoYXBwICYmIGFwcC5OYW1lID09PSAnSW50ZXJuZXQgRXhwbG9yZXInICYmICFhcHAuRG9jdW1lbnQuaGlkZGVuKSB7DQogICAgICAgIGllID0gYXBwOw0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICB9DQogICAgfSk7DQogICAgcmV0dXJuIGllOw0KICB9DQoNCiAgZnVuY3Rpb24gZ2V0SUUoKSB7DQogICAgdmFyIGllOw0KICAgIGVhY2goX19TaGVsbEFwcC5XaW5kb3dzKCksIGZ1bmN0aW9uIChhcHApIHsNCiAgICAgIGlmIChhcHAgJiYgYXBwLk5hbWUgPT09ICdJbnRlcm5ldCBFeHBsb3JlcicpIHsNCiAgICAgICAgaWUgPSBhcHA7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0NCiAgICB9KTsNCiAgICByZXR1cm4gaWU7DQogIH0NCg0KICBmdW5jdGlvbiB3YWl0KGllLCB0aW1lb3V0KSB7DQogICAgdmFyIGVsYXBzZWQgPSAwOw0KICAgIHRpbWVvdXQgfHwgKHRpbWVvdXQgPSA1MDAwKTsNCiAgICB3aGlsZSAoaWUuQnVzeSB8fCBpZS5SZWFkeVN0YXRlICE9PSA0KSB7DQogICAgICBpZiAoZWxhcHNlZCA+PSB0aW1lb3V0KSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcignSUUgdGltZW91dCcpOw0KICAgICAgfQ0KICAgICAgZWxhcHNlZCArPSAxMDA7DQogICAgICBwcm9jZXNzLnNsZWVwKDEwMCk7DQogICAgfQ0KICB9DQoNCiAgdmFyIElFX09QVElPTlMgPSBbDQogICAgJ0FkZHJlc3NCYXInLA0KICAgICdGdWxsU2NyZWVuJywNCiAgICAnV2lkdGgnLA0KICAgICdIZWlnaHQnLA0KICAgICdUb3AnLA0KICAgICdMZWZ0JywNCiAgICAnTWVudUJhcicsDQogICAgJ1Jlc2l6YWJsZScsDQogICAgJ1NpbGVudCcsDQogICAgJ1N0YXR1c0JhcicsDQogICAgJ1Rvb2xCYXInLA0KICAgICdWaXNpYmxlJw0KICBdLnJlZHVjZShmdW5jdGlvbiAobWVtbywgaXQpIHsNCiAgICBtZW1vW2l0XSA9IGl0Ow0KICAgIG1lbW9baXQudG9Mb3dlckNhc2UoKV0gPSBpdDsNCiAgICByZXR1cm4gbWVtbzsNCiAgfSwge30pOw0KDQogIGZ1bmN0aW9uIG9wZW4odXJsLCBvcHRpb25zKSB7DQogICAgdmFyIGllID0gbmV3IEFjdGl2ZVhPYmplY3QoJ0ludGVybmV0RXhwbG9yZXIuQXBwbGljYXRpb24nKTsNCiAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOw0KICAgIGVhY2gob3B0aW9ucywgZnVuY3Rpb24gKHYsIGspIHsNCiAgICAgIHZhciBwcm9wID0gSUVfT1BUSU9OU1trXTsNCiAgICAgIGlmIChwcm9wKSB7IGllW3Byb3BdID0gdjsgfQ0KICAgIH0pOw0KICAgIGlmICghaGFzJDEob3B0aW9ucywgJ3Zpc2libGUnKSAmJiAhaGFzJDEob3B0aW9ucywgJ1Zpc2libGUnKSkgew0KICAgICAgaWUuVmlzaWJsZSA9IHRydWU7DQogICAgfQ0KICAgIGllLk5hdmlnYXRlKHVybCB8fCAnYWJvdXQ6YmxhbmsnKTsNCiAgICB3YWl0KGllLCBvcHRpb25zLnRpbWVvdXQpOw0KICAgIHJldHVybiBpZTsNCiAgfQoKICB2YXIgaWUgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICBnZXRXaW5kb3dzOiBnZXRXaW5kb3dzLAogICAgZ2V0QWN0aXZlOiBnZXRBY3RpdmUsCiAgICBnZXRJRTogZ2V0SUUsCiAgICB3YWl0OiB3YWl0LAogICAgb3Blbjogb3BlbgogIH0pOwoKICB2YXIgQVBQX0lEJDEgPSAnT3V0bG9vay5BcHBsaWNhdGlvbic7DQogIHZhciBvbE1haWxJdGVtID0gMDsNCg0KICB2YXIgT1VUTE9PS19QUk9UTyA9IHsNCiAgICBjcmVhdGVNYWlsOiBmdW5jdGlvbihvcHRpb25zKSB7DQogICAgICB2YXIgaXRlbSA9IHRoaXMuYXBwLkNyZWF0ZUl0ZW0ob2xNYWlsSXRlbSk7DQogICAgICBpZiAob3B0aW9ucykgew0KICAgICAgICBlYWNoKG9wdGlvbnMsIGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7DQogICAgICAgICAgaXRlbVtrZXldID0gdmFsdWU7DQogICAgICAgIH0pOw0KICAgICAgfQ0KICAgICAgaXRlbS5EaXNwbGF5KCk7DQogICAgICByZXR1cm4gaXRlbTsNCiAgICB9DQogIH07DQoNCiAgdmFyIE9VVExPT0tfUFJPUFMgPSB7DQogICAgYXBwOiB7IHZhbHVlOiBudWxsLCB3cml0YWJsZTogdHJ1ZSB9DQogIH07DQoNCiAgZnVuY3Rpb24gT3V0bG9vaygpIHsNCiAgICB2YXIgYXBwOw0KICAgIHRyeSB7DQogICAgICBhcHAgPSBHZXRPYmplY3QoJycsIEFQUF9JRCQxKTsNCiAgICB9IGNhdGNoIChlKSB7DQogICAgICBhcHAgPSBuZXcgQWN0aXZlWE9iamVjdChBUFBfSUQkMSk7DQogICAgfQ0KICAgIHZhciBvbCA9IE9iamVjdC5jcmVhdGUoT1VUTE9PS19QUk9UTywgT1VUTE9PS19QUk9QUyk7DQogICAgb2wuYXBwID0gYXBwOw0KICAgIHJldHVybiBvbDsNCiAgfQoKICB2YXIgb3V0bG9vayA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgICdkZWZhdWx0JzogT3V0bG9vawogIH0pOwoKICAvKiBDdXJzb3JMb2NhdGlvbkVudW0gKi8NCiAgdmFyIGFkVXNlQ2xpZW50ID0gMzsNCiAgdmFyIGFkVXNlTm9uZSA9IDE7DQogIHZhciBhZFVzZVNlcnZlciA9IDI7DQogIC8qIExvY2tUeXBlRW51bSAqLw0KICB2YXIgYWRMb2NrVW5zcGVjaWZpZWQgPSAtMTsNCiAgdmFyIGFkTG9ja1JlYWRPbmx5ID0gMTsNCiAgdmFyIGFkTG9ja1Blc3NpbWlzdGljID0gMjsNCiAgdmFyIGFkTG9ja09wdGltaXN0aWMgPSAzOw0KICB2YXIgYWRMb2NrQmF0Y2hPcHRpbWlzdGljID0gNDsNCiAgLyogQ3Vyc29yVHlwZUVudW0gKi8NCiAgdmFyIGFkT3BlblVuc3BlY2lmaWVkID0gLTE7DQogIHZhciBhZE9wZW5Gb3J3YXJkT25seSA9IDA7DQogIHZhciBhZE9wZW5LZXlzZXQgPSAxOw0KICB2YXIgYWRPcGVuRHluYW1pYyA9IDI7DQogIHZhciBhZE9wZW5TdGF0aWMgPSAzOw0KICAvKiBEYXRhVHlwZUVudW0gKi8NCiAgdmFyIGFkQmlnSW50ID0gMjA7DQogIHZhciBhZEJpbmFyeSQxID0gMTI4Ow0KICB2YXIgYWRCb29sZWFuID0gMTE7DQogIHZhciBhZENoYXIgPSAxMjk7DQogIHZhciBhZEN1cnJlbmN5ID0gNjsNCiAgdmFyIGFkRGF0ZSA9IDc7DQogIHZhciBhZERCRGF0ZSA9IDEzMzsNCiAgdmFyIGFkREJUaW1lID0gMTM0Ow0KICB2YXIgYWREQlRpbWVTdGFtcCA9IDEzNTsNCiAgdmFyIGFkRGVjaW1hbCA9IDE0Ow0KICB2YXIgYWREb3VibGUgPSA1Ow0KICB2YXIgYWRHVUlEID0gNzI7DQogIHZhciBhZElEaXNwYXRjaCA9IDk7DQogIHZhciBhZEludGVnZXIgPSAzOw0KICB2YXIgYWRMb25nVmFyQmluYXJ5ID0gMjA1Ow0KICB2YXIgYWRMb25nVmFyQ2hhciA9IDIwMTsNCiAgdmFyIGFkTG9uZ1ZhcldDaGFyID0gMjAzOw0KICB2YXIgYWROdW1lcmljID0gMTMxOw0KICB2YXIgYWRTaW5nbGUgPSA0Ow0KICB2YXIgYWRTbWFsbEludCA9IDI7DQogIHZhciBhZFVuc2lnbmVkVGlueUludCA9IDE3Ow0KICB2YXIgYWRWYXJCaW5hcnkgPSAyMDQ7DQogIHZhciBhZFZhckNoYXIgPSAyMDA7DQogIHZhciBhZFZhcmlhbnQgPSAxMjsNCiAgdmFyIGFkVmFyV0NoYXIgPSAyMDI7DQogIHZhciBhZFdDaGFyID0gMTMwOw0KICAvKiBQYXJhbWV0ZXJEaXJlY3Rpb25FbnVtICovDQogIHZhciBhZFBhcmFtVW5rbm93biA9IDA7DQogIHZhciBhZFBhcmFtSW5wdXQgPSAxOw0KICB2YXIgYWRQYXJhbU91dHB1dCA9IDI7DQogIHZhciBhZFBhcmFtSW5wdXRPdXRwdXQgPSAzOw0KICB2YXIgYWRQYXJhbVJldHVyblZhbHVlID0gNDsNCiAgLyogU2NoZW1hRW51bSAqLw0KICB2YXIgYWRTY2hlbWFUYWJsZXMgPSAyMDsNCiAgdmFyIGFkU2NoZW1hQ29sdW1ucyA9IDQ7DQoNCiAgdmFyIEFkb2RiID0gZnVuY3Rpb24gQWRvZGIoKSB7DQogICAgdGhpcy5jb25uID0gbmV3IEFjdGl2ZVhPYmplY3QoJ0FET0RCLkNvbm5lY3Rpb24nKTsNCiAgfTsNCg0KICBBZG9kYi5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiBjbG9zZSAoKSB7DQogICAgdGhpcy5jb25uICYmIHRoaXMuY29ubi5TdGF0ZSAhPSAwICYmIHRoaXMuY29ubi5DbG9zZSgpOw0KICAgIHRoaXMuY29ubiA9IG51bGw7DQogIH07DQoNCiAgQWRvZGIucHJvdG90eXBlLmJlZ2luID0gZnVuY3Rpb24gYmVnaW4gKCkgew0KICAgIHRoaXMuY29ubi5CZWdpblRyYW5zKCk7DQogIH07DQoNCiAgQWRvZGIucHJvdG90eXBlLmNvbW1pdCA9IGZ1bmN0aW9uIGNvbW1pdCAoKSB7DQogICAgdGhpcy5jb25uLkNvbW1pdFRyYW5zKCk7DQogIH07DQoNCiAgQWRvZGIucHJvdG90eXBlLnJvbGxiYWNrID0gZnVuY3Rpb24gcm9sbGJhY2sgKCkgew0KICAgIHRoaXMuY29ubi5Sb2xsYmFja1RyYW5zKCk7DQogIH07DQoNCiAgQWRvZGIucHJvdG90eXBlLmdldE9wdGlvbnMgPSBmdW5jdGlvbiBnZXRPcHRpb25zIChhcmdzKSB7DQogICAgaWYgKHR5cGVvZiBhcmdzWzBdID09PSAnb2JqZWN0JyAmJiBhcmdzWzBdLl9pc19vcHRpb25zKSB7IHJldHVybiBhcmdzWzBdOyB9DQogICAgdmFyIGkgPSAtMSwNCiAgICAgIGxlbiA9IGFyZ3MubGVuZ3RoLA0KICAgICAgYXJnLA0KICAgICAgb3AgPSB7IF9pc19vcHRpb25zOiB0cnVlIH07DQogICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgYXJnID0gYXJnc1tpXTsNCiAgICAgIHN3aXRjaCAodHlwZU9mKGFyZykpIHsNCiAgICAgICAgY2FzZSAnc3RyaW5nJzoNCiAgICAgICAgICBvcC5zcWwgPSBhcmc7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgJ2FycmF5JzoNCiAgICAgICAgY2FzZSAnb2JqZWN0JzoNCiAgICAgICAgICBvcC5wYXJhbXMgPSBhcmc7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgJ2Jvb2xlYW4nOg0KICAgICAgICAgIG9wLnByZXBhcmVkID0gYXJnOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICdmdW5jdGlvbic6DQogICAgICAgICAgb3AuY2FsbGJhY2sgPSBhcmc7DQogICAgICAgICAgYnJlYWs7DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiBvcDsNCiAgfTsNCg0KICBBZG9kYi5wcm90b3R5cGUuZ2V0RGF0YVR5cGVNYXBwaW5nID0gZnVuY3Rpb24gZ2V0RGF0YVR5cGVNYXBwaW5nICgpIHsNCiAgICByZXR1cm4gew0KICAgICAgc3RyaW5nOiBhZFZhcldDaGFyLA0KICAgICAgaW50OiBhZFNtYWxsSW50LA0KICAgICAgZGVjaW1hbDogYWREb3VibGUsDQogICAgICBib29sZWFuOiBhZEJvb2xlYW4sDQogICAgICBkYXRlOiBhZERhdGUsDQogICAgICBidWZmZXI6IGFkQmluYXJ5JDEsDQogICAgICBudWxsOiBhZFZhcldDaGFyLA0KICAgICAgdW5kZWZpbmVkOiBhZFZhcldDaGFyDQogICAgfTsNCiAgfTsNCg0KICBBZG9kYi5wcm90b3R5cGUuY3JlYXRlUGFyYW1zID0gZnVuY3Rpb24gY3JlYXRlUGFyYW1zIChvcHRzKSB7DQogICAgdmFyIGNtZG9iaiA9IG9wdHMuY21kLA0KICAgICAgcGFyYW1zID0gb3B0cy5wYXJhbXM7DQogICAgaWYgKCFjbWRvYmogfHwgIXBhcmFtcykgeyByZXR1cm47IH0NCiAgICB2YXIganNUeXBlLA0KICAgICAgdHAsDQogICAgICBzaXplID0gMTAsDQogICAgICBkdG1hcCA9IHRoaXMuZ2V0RGF0YVR5cGVNYXBwaW5nKCk7DQogICAgZWFjaChwYXJhbXMsIGZ1bmN0aW9uICh2YWx1ZSwgbmFtZSkgew0KICAgICAganNUeXBlID0gdHlwZU9mKHZhbHVlKTsNCiAgICAgIGlmIChqc1R5cGUgPT0gJ3N0cmluZycpIHsNCiAgICAgICAgdHAgPSBkdG1hcFsnc3RyaW5nJ107DQogICAgICAgIHNpemUgPSB0cCA9PT0gYWRWYXJpYW50ID8gdmFsdWUubGVuZ3RoICogMiA6IHZhbHVlLmxlbmd0aDsNCiAgICAgIH0gZWxzZSBpZiAoanNUeXBlID09ICdudW1iZXInKSB7DQogICAgICAgIHRwID0gaXNJbnRlZ2VyKHZhbHVlKSA/IGR0bWFwWydpbnQnXSA6IGR0bWFwWydkZWNpbWFsJ107DQogICAgICB9IGVsc2UgaWYgKGhhcyhkdG1hcCwganNUeXBlKSkgew0KICAgICAgICB0cCA9IGR0bWFwW2pzVHlwZV07DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Fkb2RiLmNyZWF0ZVBhcmFtczogdW5leHBlY3RlZCB0eXBlICcgKyBqc1R5cGUpOw0KICAgICAgfQ0KICAgICAgdmFyIHBhcmFtb2JqID0gY21kb2JqLkNyZWF0ZVBhcmFtZXRlcigNCiAgICAgICAgbmFtZSwNCiAgICAgICAgdHAsDQogICAgICAgIGFkUGFyYW1JbnB1dCwNCiAgICAgICAgc2l6ZSwNCiAgICAgICAgdmFsdWUNCiAgICAgICk7DQogICAgICBjbWRvYmouUGFyYW1ldGVycy5BcHBlbmQocGFyYW1vYmopOw0KICAgIH0pOw0KICB9Ow0KDQogIEFkb2RiLnByb3RvdHlwZS5leGVjdXRlID0gZnVuY3Rpb24gZXhlY3V0ZSAoKSB7CiAgICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07Cg0KICAgIHZhciBvcCA9IHRoaXMuZ2V0T3B0aW9ucyhhcmdzKTsNCiAgICB0cnkgew0KICAgICAgdmFyIGNtZCA9IG5ldyBBY3RpdmVYT2JqZWN0KCdBRE9EQi5Db21tYW5kJyk7DQogICAgICBjbWQuQWN0aXZlQ29ubmVjdGlvbiA9IHRoaXMuY29ubjsNCiAgICAgIGNtZC5Db21tYW5kVHlwZSA9IDE7IC8qdGV4dCovDQogICAgICBjbWQuUHJlcGFyZWQgPSBvcC5wcmVwYXJlZCB8fCBmYWxzZTsNCiAgICAgIGNtZC5Db21tYW5kVGV4dCA9IG9wLnNxbDsNCiAgICAgIG9wLmNtZCA9IGNtZDsNCiAgICAgIHRoaXMuY3JlYXRlUGFyYW1zKG9wKTsNCiAgICAgIHJldHVybiBjbWQuRXhlY3V0ZSgpOw0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgIGUuc3FsID0gb3Auc3FsOw0KICAgICAgdGhyb3cgZTsNCiAgICB9DQogIH07DQoNCiAgQWRvZGIucHJvdG90eXBlLnNlbGVjdCA9IGZ1bmN0aW9uIHNlbGVjdCAoKSB7CiAgICAgIHZhciBhcmdzID0gW10sIGxlbiQxID0gYXJndW1lbnRzLmxlbmd0aDsKICAgICAgd2hpbGUgKCBsZW4kMS0tICkgYXJnc1sgbGVuJDEgXSA9IGFyZ3VtZW50c1sgbGVuJDEgXTsKDQogICAgdmFyIHJzLA0KICAgICAgcm93LA0KICAgICAgaSwNCiAgICAgIGxlbiwNCiAgICAgIG9wID0gdGhpcy5nZXRPcHRpb25zKGFyZ3MpOw0KICAgIHRyeSB7DQogICAgICBycyA9IHRoaXMuZXhlY3V0ZShvcCk7DQogICAgICB3aGlsZSAoIXJzLkVPRikgew0KICAgICAgICByb3cgPSB7fTsNCiAgICAgICAgaWYgKGxlbiA9PSBudWxsKSB7IGxlbiA9IHJzLkZpZWxkcy5Db3VudDsgfQ0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspIHsNCiAgICAgICAgICByb3dbcnMuRmllbGRzKGkpLk5hbWVdID0gdGhpcy5nZXRGaWVsZFZhbHVlKHJzLkZpZWxkcyhpKSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKG9wLmNhbGxiYWNrKHJvdykgPT09IGZhbHNlKSB7IGJyZWFrOyB9DQogICAgICAgIHJzLk1vdmVOZXh0KCk7DQogICAgICB9DQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgZS5zcWwgPSBvcC5zcWw7DQogICAgICB0aHJvdyBlOw0KICAgIH0gZmluYWxseSB7DQogICAgICBycyAmJiBycy5TdGF0ZSAhPSAwICYmIHJzLkNsb3NlKCk7DQogICAgfQ0KICB9Ow0KDQogIEFkb2RiLnByb3RvdHlwZS5nZXRGaWVsZFZhbHVlID0gZnVuY3Rpb24gZ2V0RmllbGRWYWx1ZSAoZmllbGQpIHsNCiAgICBzd2l0Y2ggKGZpZWxkLlR5cGUpIHsNCiAgICAgIGNhc2UgYWRCaW5hcnkkMToNCiAgICAgIGNhc2UgYWRWYXJCaW5hcnk6DQogICAgICAgIHJldHVybiAnW0xPQl0nOw0KICAgICAgY2FzZSBhZERhdGU6DQogICAgICBjYXNlIGFkREJEYXRlOg0KICAgICAgY2FzZSBhZERCVGltZToNCiAgICAgIGNhc2UgYWREQlRpbWVTdGFtcDoNCiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGZpZWxkLnZhbHVlKTsNCiAgICAgIGRlZmF1bHQ6DQogICAgICAgIHJldHVybiBmaWVsZC52YWx1ZTsNCiAgICB9DQogIH07DQoNCiAgQWRvZGIucHJvdG90eXBlLmVhY2hSb3cgPSBmdW5jdGlvbiBlYWNoUm93ICgpIHsKICAgICAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDsKICAgICAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTsKDQogICAgdmFyIG9wID0gdGhpcy5nZXRPcHRpb25zKGFyZ3MpOw0KICAgIHRoaXMuc2VsZWN0KG9wKTsNCiAgfTsNCg0KICBBZG9kYi5wcm90b3R5cGUuZmlyc3RSb3cgPSBmdW5jdGlvbiBmaXJzdFJvdyAoKSB7CiAgICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07Cg0KICAgIHZhciBvcCA9IHRoaXMuZ2V0T3B0aW9ucyhhcmdzKSwNCiAgICAgIF9yb3c7DQogICAgb3AuY2FsbGJhY2sgPSBmdW5jdGlvbiAocm93KSB7IHJldHVybiAoKF9yb3cgPSByb3cpLCBmYWxzZSk7IH07DQogICAgdGhpcy5zZWxlY3Qob3ApOw0KICAgIHJldHVybiBfcm93Ow0KICB9Ow0KDQogIEFkb2RiLnByb3RvdHlwZS5yb3dzID0gZnVuY3Rpb24gcm93cyAoKSB7CiAgICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07Cg0KICAgIHZhciBvcCA9IHRoaXMuZ2V0T3B0aW9ucyhhcmdzKSwNCiAgICAgIHJvd3MgPSBbXTsNCiAgICBvcC5jYWxsYmFjayA9IGZ1bmN0aW9uIChyb3cpIHsNCiAgICAgIHJvd3MucHVzaChyb3cpOw0KICAgIH07DQogICAgdGhpcy5zZWxlY3Qob3ApOw0KICAgIHJldHVybiByb3dzOw0KICB9Ow0KDQogIEFkb2RiLnByb3RvdHlwZS5iYXRjaCA9IGZ1bmN0aW9uIGJhdGNoIChjbWQsIGZuKSB7DQogICAgdmFyIGNvbm4sIHJzOw0KICAgIHRyeSB7DQogICAgICBjb25uID0gdGhpcy5jb25uOw0KICAgICAgcnMgPSBuZXcgQWN0aXZlWE9iamVjdCgnQURPREIuUmVjb3Jkc2V0Jyk7DQogICAgICBycy5DdXJzb3JMb2NhdGlvbiA9IGFkVXNlQ2xpZW50Ow0KICAgICAgcnMuTG9ja1R5cGUgPSBhZExvY2tCYXRjaE9wdGltaXN0aWM7DQogICAgICBycy5DdXJzb3JUeXBlID0gYWRPcGVuRHluYW1pYzsNCiAgICAgIHJzLk9wZW4oY21kLCBjb25uKTsNCiAgICAgIGZuKHJzKTsNCiAgICB9IGZpbmFsbHkgew0KICAgICAgcnMgJiYgcnMuU3RhdGUgIT0gMCAmJiBycy5DbG9zZSgpOw0KICAgIH0NCiAgfTsNCg0KICBBZG9kYi5wcm90b3R5cGUuc2V0RmllbGRWYWx1ZSA9IGZ1bmN0aW9uIHNldEZpZWxkVmFsdWUgKGZpZWxkLCB2YWx1ZSkgew0KICAgIHN3aXRjaCAodHlwZU9mKHZhbHVlKSkgew0KICAgICAgY2FzZSAnZGF0ZSc6DQogICAgICAgIGZpZWxkLlZhbHVlID0gZm9ybWF0RGF0ZSh2YWx1ZSk7DQogICAgICAgIGJyZWFrOw0KICAgICAgY2FzZSAnc3RyaW5nJzoNCiAgICAgIGNhc2UgJ251bWJlcic6DQogICAgICAgIGZpZWxkLlZhbHVlID0gdmFsdWU7DQogICAgICAgIGJyZWFrOw0KICAgICAgZGVmYXVsdDoNCiAgICAgICAgZmllbGQuVmFsdWUgPSBTdHJpbmcodmFsdWUpOw0KICAgICAgICBicmVhazsNCiAgICB9DQogIH07DQoNCiAgQWRvZGIucHJvdG90eXBlLmJhdGNoX2luc2VydCA9IGZ1bmN0aW9uIGJhdGNoX2luc2VydCAoY21kLCByb3dzKSB7DQogICAgdmFyIHNlbGYgPSB0aGlzOw0KICAgIHRoaXMuYmF0Y2goY21kLCBmdW5jdGlvbiAocnMpIHsNCiAgICAgIGVhY2gocm93cywgZnVuY3Rpb24gKHJvdykgew0KICAgICAgICBycy5BZGROZXcoKTsNCiAgICAgICAgZWFjaChyb3csIGZ1bmN0aW9uICh2LCBrKSB7DQogICAgICAgICAgc2VsZi5zZXRGaWVsZFZhbHVlKHJzLkZpZWxkcyhrKSwgdik7DQogICAgICAgIH0pOw0KICAgICAgfSk7DQogICAgICBycy5VcGRhdGVCYXRjaCgpOw0KICAgIH0pOw0KICB9Ow0KDQogIEFkb2RiLnByb3RvdHlwZS50YWJsZUV4aXN0cyA9IGZ1bmN0aW9uIHRhYmxlRXhpc3RzICh0YWJsZU5hbWUpIHsNCiAgICB2YXIgY29ubiwNCiAgICAgIHJzLA0KICAgICAgcmVzdWx0ID0gZmFsc2UsDQogICAgICBwYXJhbXMgPSBbbnVsbCwgbnVsbCwgdGFibGVOYW1lLCAnVEFCTEUnXTsNCiAgICB0cnkgew0KICAgICAgY29ubiA9IHRoaXMuY29ubjsNCiAgICAgIHJzID0gY29ubi5PcGVuU2NoZW1hKGFkU2NoZW1hVGFibGVzLCBwYXJhbXMpOw0KICAgICAgaWYgKCFycy5FT0YpIHsgcmVzdWx0ID0gdHJ1ZTsgfQ0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgIHRocm93IGU7DQogICAgfSBmaW5hbGx5IHsNCiAgICAgIHJzICYmIHJzLlN0YXRlICE9IDAgJiYgcnMuQ2xvc2UoKTsNCiAgICB9DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfTsNCg0KICBBZG9kYi5wcm90b3R5cGUuZ2V0VGFibGVzID0gZnVuY3Rpb24gZ2V0VGFibGVzICgpIHsNCiAgICB2YXIgY29ubiwNCiAgICAgIHJzLA0KICAgICAgcmVzdWx0ID0gW10sDQogICAgICBjb3VudCA9IDA7DQogICAgdHJ5IHsNCiAgICAgIGNvbm4gPSB0aGlzLmNvbm47DQogICAgICBycyA9IGNvbm4uT3BlblNjaGVtYShhZFNjaGVtYVRhYmxlcyk7DQogICAgICB3aGlsZSAoIXJzLkVPRikgew0KICAgICAgICBpZiAocnMuRmllbGRzKCdUQUJMRV9UWVBFJykuVmFsdWUgPT09ICdUQUJMRScpIHsNCiAgICAgICAgICByZXN1bHRbY291bnQrK10gPSBycy5GaWVsZHMoJ1RBQkxFX05BTUUnKS5WYWx1ZTsNCiAgICAgICAgfQ0KICAgICAgICBycy5Nb3ZlTmV4dCgpOw0KICAgICAgfQ0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgIHRocm93IGU7DQogICAgfSBmaW5hbGx5IHsNCiAgICAgIHJzICYmIHJzLlN0YXRlICE9IDAgJiYgcnMuQ2xvc2UoKTsNCiAgICB9DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfTsNCg0KICBmdW5jdGlvbiBmb3JtYXREYXRlKGQpIHsNCiAgICByZXR1cm4gKA0KICAgICAgZC5nZXRGdWxsWWVhcigpICsNCiAgICAgICcvJyArDQogICAgICAoZC5nZXRNb250aCgpICsgMSkgKw0KICAgICAgJy8nICsNCiAgICAgIGQuZ2V0RGF0ZSgpICsNCiAgICAgICcgJyArDQogICAgICBkLmdldEhvdXJzKCkgKw0KICAgICAgJzonICsNCiAgICAgIGQuZ2V0TWludXRlcygpICsNCiAgICAgICc6JyArDQogICAgICBkLmdldFNlY29uZHMoKQ0KICAgICk7DQogIH0KCiAgdmFyIGFkb2RiID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgYWRVc2VDbGllbnQ6IGFkVXNlQ2xpZW50LAogICAgYWRVc2VOb25lOiBhZFVzZU5vbmUsCiAgICBhZFVzZVNlcnZlcjogYWRVc2VTZXJ2ZXIsCiAgICBhZExvY2tVbnNwZWNpZmllZDogYWRMb2NrVW5zcGVjaWZpZWQsCiAgICBhZExvY2tSZWFkT25seTogYWRMb2NrUmVhZE9ubHksCiAgICBhZExvY2tQZXNzaW1pc3RpYzogYWRMb2NrUGVzc2ltaXN0aWMsCiAgICBhZExvY2tPcHRpbWlzdGljOiBhZExvY2tPcHRpbWlzdGljLAogICAgYWRMb2NrQmF0Y2hPcHRpbWlzdGljOiBhZExvY2tCYXRjaE9wdGltaXN0aWMsCiAgICBhZE9wZW5VbnNwZWNpZmllZDogYWRPcGVuVW5zcGVjaWZpZWQsCiAgICBhZE9wZW5Gb3J3YXJkT25seTogYWRPcGVuRm9yd2FyZE9ubHksCiAgICBhZE9wZW5LZXlzZXQ6IGFkT3BlbktleXNldCwKICAgIGFkT3BlbkR5bmFtaWM6IGFkT3BlbkR5bmFtaWMsCiAgICBhZE9wZW5TdGF0aWM6IGFkT3BlblN0YXRpYywKICAgIGFkQmlnSW50OiBhZEJpZ0ludCwKICAgIGFkQmluYXJ5OiBhZEJpbmFyeSQxLAogICAgYWRCb29sZWFuOiBhZEJvb2xlYW4sCiAgICBhZENoYXI6IGFkQ2hhciwKICAgIGFkQ3VycmVuY3k6IGFkQ3VycmVuY3ksCiAgICBhZERhdGU6IGFkRGF0ZSwKICAgIGFkREJEYXRlOiBhZERCRGF0ZSwKICAgIGFkREJUaW1lOiBhZERCVGltZSwKICAgIGFkREJUaW1lU3RhbXA6IGFkREJUaW1lU3RhbXAsCiAgICBhZERlY2ltYWw6IGFkRGVjaW1hbCwKICAgIGFkRG91YmxlOiBhZERvdWJsZSwKICAgIGFkR1VJRDogYWRHVUlELAogICAgYWRJRGlzcGF0Y2g6IGFkSURpc3BhdGNoLAogICAgYWRJbnRlZ2VyOiBhZEludGVnZXIsCiAgICBhZExvbmdWYXJCaW5hcnk6IGFkTG9uZ1ZhckJpbmFyeSwKICAgIGFkTG9uZ1ZhckNoYXI6IGFkTG9uZ1ZhckNoYXIsCiAgICBhZExvbmdWYXJXQ2hhcjogYWRMb25nVmFyV0NoYXIsCiAgICBhZE51bWVyaWM6IGFkTnVtZXJpYywKICAgIGFkU2luZ2xlOiBhZFNpbmdsZSwKICAgIGFkU21hbGxJbnQ6IGFkU21hbGxJbnQsCiAgICBhZFVuc2lnbmVkVGlueUludDogYWRVbnNpZ25lZFRpbnlJbnQsCiAgICBhZFZhckJpbmFyeTogYWRWYXJCaW5hcnksCiAgICBhZFZhckNoYXI6IGFkVmFyQ2hhciwKICAgIGFkVmFyaWFudDogYWRWYXJpYW50LAogICAgYWRWYXJXQ2hhcjogYWRWYXJXQ2hhciwKICAgIGFkV0NoYXI6IGFkV0NoYXIsCiAgICBhZFBhcmFtVW5rbm93bjogYWRQYXJhbVVua25vd24sCiAgICBhZFBhcmFtSW5wdXQ6IGFkUGFyYW1JbnB1dCwKICAgIGFkUGFyYW1PdXRwdXQ6IGFkUGFyYW1PdXRwdXQsCiAgICBhZFBhcmFtSW5wdXRPdXRwdXQ6IGFkUGFyYW1JbnB1dE91dHB1dCwKICAgIGFkUGFyYW1SZXR1cm5WYWx1ZTogYWRQYXJhbVJldHVyblZhbHVlLAogICAgYWRTY2hlbWFUYWJsZXM6IGFkU2NoZW1hVGFibGVzLAogICAgYWRTY2hlbWFDb2x1bW5zOiBhZFNjaGVtYUNvbHVtbnMsCiAgICBBZG9kYjogQWRvZGIKICB9KTsKCiAgdmFyIEFjY0RCID0gLypAX19QVVJFX18qLyhmdW5jdGlvbiAoQWRvZGIpIHsKICAgIGZ1bmN0aW9uIEFjY0RCKHBhdGgpIHsNCiAgICAgIGlmICghaXNBYnNvbHV0ZShwYXRoKSkgew0KICAgICAgICBwYXRoID0gbm9ybWFsaXplKHBhdGgpOw0KICAgICAgfQ0KICAgICAgaWYgKCFpc2ZpbGUocGF0aCkpIHsNCiAgICAgICAgdmFyIGFwcCA9IG5ldyBBY3RpdmVYT2JqZWN0KCdBY2Nlc3MuQXBwbGljYXRpb24nKTsNCiAgICAgICAgYXBwLk5ld0N1cnJlbnREYXRhYmFzZShwYXRoKTsNCiAgICAgIH0NCiAgICAgIEFkb2RiLmNhbGwodGhpcyk7DQogICAgICB0aGlzLmNvbm4uQ29ubmVjdGlvblN0cmluZyA9ICJQcm92aWRlcj1NaWNyb3NvZnQuQWNlLk9MRURCLjEyLjA7RGF0YSBTb3VyY2U9IiArIHBhdGg7DQogICAgICB0aGlzLmNvbm4uT3BlbigpOw0KICAgIH0KCiAgICBpZiAoIEFkb2RiICkgQWNjREIuX19wcm90b19fID0gQWRvZGI7CiAgICBBY2NEQi5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBBZG9kYiAmJiBBZG9kYi5wcm90b3R5cGUgKTsKICAgIEFjY0RCLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEFjY0RCOwoKICAgIHJldHVybiBBY2NEQjsKICB9KEFkb2RiKSk7DQoNCiAgZnVuY3Rpb24gYWNjZGIocHRoKSB7DQogICAgcmV0dXJuIG5ldyBBY2NEQihwdGgpOw0KICB9CgogIHZhciBhY2NkYiQxID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgQWNjREI6IEFjY0RCLAogICAgJ2RlZmF1bHQnOiBhY2NkYgogIH0pOwoKICB2YXIgQ3N2REIgPSAvKkBfX1BVUkVfXyovKGZ1bmN0aW9uIChBZG9kYikgewogICAgZnVuY3Rpb24gQ3N2REIocGF0aCwgaGFzSGVhZGVyKSB7DQogICAgICBpZiAoIWlzQWJzb2x1dGUocGF0aCkpIHsNCiAgICAgICAgcGF0aCA9IG5vcm1hbGl6ZShwYXRoKTsNCiAgICAgIH0NCiAgICAgIGlmIChpc2ZpbGUocGF0aCkpIHsgcGF0aCA9IGRpcm5hbWUocGF0aCk7IH0NCiAgICAgIHZhciBoZHIgPQ0KICAgICAgICBoYXNIZWFkZXIgPT0gbnVsbCB8fCBoYXNIZWFkZXIgPT0gdHJ1ZSB8fCBoYXNIZWFkZXIgPT0gJ1lFUycNCiAgICAgICAgICA/ICdZRVMnDQogICAgICAgICAgOiAnTk8nOw0KICAgICAgQWRvZGIuY2FsbCh0aGlzKTsNCiAgICAgIHRoaXMuY29ubi5Db25uZWN0aW9uU3RyaW5nID0gIlByb3ZpZGVyPU1pY3Jvc29mdC5BY2UuT0xFREIuMTIuMDtEYXRhIFNvdXJjZT0iICsgcGF0aCArICI7RXh0ZW5kZWQgUHJvcGVydGllcz1cIlRleHQ7SERSPSIgKyBoZHIgKyAiO0ZNVD1EZWxpbWl0ZWRcIiI7DQogICAgICB0aGlzLmNvbm4uT3BlbigpOw0KICAgIH0KCiAgICBpZiAoIEFkb2RiICkgQ3N2REIuX19wcm90b19fID0gQWRvZGI7CiAgICBDc3ZEQi5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBBZG9kYiAmJiBBZG9kYi5wcm90b3R5cGUgKTsKICAgIENzdkRCLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IENzdkRCOwoKICAgIHJldHVybiBDc3ZEQjsKICB9KEFkb2RiKSk7DQoNCiAgZnVuY3Rpb24gY3N2ZGIocGF0aCwgaGFzSGVhZGVyKSB7DQogICAgcmV0dXJuIG5ldyBDc3ZEQihwYXRoLCBoYXNIZWFkZXIpOw0KICB9CgogIHZhciBjc3ZkYiQxID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgQ3N2REI6IENzdkRCLAogICAgJ2RlZmF1bHQnOiBjc3ZkYgogIH0pOwoKICB2YXIgRVhDRUxfVFlQRSA9IHsNCiAgICB4bHM6ICdFeGNlbCA4LjAnLA0KICAgIHhsc3g6ICdFeGNlbCAxMi4wIFhtbCcsDQogICAgeGxzYjogJ0V4Y2VsIDEyLjAnLA0KICAgIHhsc206ICdFeGNlbCAxMi4wIE1hY3JvJw0KICB9Ow0KDQogIHZhciBFeGNlbERCID0gLypAX19QVVJFX18qLyhmdW5jdGlvbiAoQWRvZGIpIHsKICAgIGZ1bmN0aW9uIEV4Y2VsREIocGF0aCwgaGFzSGVhZGVyKSB7DQogICAgICBpZiAoIWlzQWJzb2x1dGUocGF0aCkpIHsNCiAgICAgICAgcGF0aCA9IG5vcm1hbGl6ZShwYXRoKTsNCiAgICAgIH0NCiAgICAgIHZhciBleHQgPSBleHRuYW1lKHBhdGgpLnRvTG93ZXJDYXNlKCk7DQogICAgICB2YXIgaGRyID0NCiAgICAgICAgaGFzSGVhZGVyID09IG51bGwgfHwgaGFzSGVhZGVyID09IHRydWUgfHwgaGFzSGVhZGVyID09ICdZRVMnDQogICAgICAgICAgPyAnWUVTJw0KICAgICAgICAgIDogJ05PJzsNCiAgICAgIGlmICghRVhDRUxfVFlQRVtleHRdKSB7IHRocm93IG5ldyBFcnJvcihleHQgKyAnIGZpbGUgaXMgbm90IHN1cHBvcnRlZCcpOyB9DQogICAgICBBZG9kYi5jYWxsKHRoaXMpOw0KICAgICAgdGhpcy5jb25uLkNvbm5lY3Rpb25TdHJpbmcgPSAiUHJvdmlkZXI9TWljcm9zb2Z0LkFjZS5PTEVEQi4xMi4wO0RhdGEgU291cmNlPSIgKyBwYXRoICsgIjtFeHRlbmRlZCBQcm9wZXJ0aWVzPVwiIiArIChFWENFTF9UWVBFW2V4dF0pICsgIjtIRFI9IiArIGhkciArICJcIiI7DQogICAgICB0aGlzLmNvbm4uT3BlbigpOw0KICAgIH0KCiAgICBpZiAoIEFkb2RiICkgRXhjZWxEQi5fX3Byb3RvX18gPSBBZG9kYjsKICAgIEV4Y2VsREIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggQWRvZGIgJiYgQWRvZGIucHJvdG90eXBlICk7CiAgICBFeGNlbERCLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEV4Y2VsREI7CgogICAgcmV0dXJuIEV4Y2VsREI7CiAgfShBZG9kYikpOw0KDQogIGZ1bmN0aW9uIGV4Y2VsZGIocGF0aCwgaGFzSGVhZGVyKSB7DQogICAgcmV0dXJuIG5ldyBFeGNlbERCKHBhdGgsIGhhc0hlYWRlcik7DQogIH0KCiAgdmFyIGV4Y2VsZGIkMSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgIEV4Y2VsREI6IEV4Y2VsREIsCiAgICAnZGVmYXVsdCc6IGV4Y2VsZGIKICB9KTsKCiAgdmFyIE9yYWNsZURCID0gLypAX19QVVJFX18qLyhmdW5jdGlvbiAoQWRvZGIpIHsKICAgIGZ1bmN0aW9uIE9yYWNsZURCKGRzLCB1c3IsIHBhc3MpIHsNCiAgICAgIHRyeSB7DQogICAgICAgIEFkb2RiLmNhbGwodGhpcyk7DQogICAgICAgIHRoaXMuY29ubi5Db25uZWN0aW9uU3RyaW5nID0NCiAgICAgICAgICAvLyA9IGBQcm92aWRlcj1PcmFPTEVEQi5PcmFjbGU7RGF0YSBTb3VyY2U9JHtkc307VXNlciBJRD0ke3Vzcn07UGFzc3dvcmQ9JHtwYXNzfWA7DQogICAgICAgICAgIlByb3ZpZGVyPU1TREFPUkE7RGF0YSBTb3VyY2U9IiArIGRzICsgIjtVc2VyIElEPSIgKyB1c3IgKyAiO1Bhc3N3b3JkPSIgKyBwYXNzOw0KICAgICAgICB0aGlzLmNvbm4uT3BlbigpOw0KICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICBjb25zb2xlLmxvZygnRGF0YWJhc2UgY29ubmVjdCBmYWlsZWQuJyk7DQogICAgICAgIGNvbnNvbGUubG9nKA0KICAgICAgICAgICdkYXRhc291cmNlOiAlc1xuICAgIHVzZXJpZDogJXNcbiAgcGFzc3dvcmQ6ICVzJywNCiAgICAgICAgICBkcywNCiAgICAgICAgICB1c3IsDQogICAgICAgICAgcGFzcw0KICAgICAgICApOw0KICAgICAgICB0aHJvdyBlOw0KICAgICAgfQ0KICAgIH0KCiAgICBpZiAoIEFkb2RiICkgT3JhY2xlREIuX19wcm90b19fID0gQWRvZGI7CiAgICBPcmFjbGVEQi5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBBZG9kYiAmJiBBZG9kYi5wcm90b3R5cGUgKTsKICAgIE9yYWNsZURCLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IE9yYWNsZURCOw0KDQogICAgT3JhY2xlREIucHJvdG90eXBlLmdldERhdGFUeXBlTWFwcGluZyA9IGZ1bmN0aW9uIGdldERhdGFUeXBlTWFwcGluZyAoKSB7DQogICAgICByZXR1cm4gew0KICAgICAgICBzdHJpbmc6IGFkVmFyaWFudCwNCiAgICAgICAgaW50OiBhZEludGVnZXIsDQogICAgICAgIGRlY2ltYWw6IGFkTnVtZXJpYywNCiAgICAgICAgYm9vbGVhbjogYWRCb29sZWFuLA0KICAgICAgICBkYXRlOiBhZERCVGltZVN0YW1wLA0KICAgICAgICBidWZmZXI6IGFkQmluYXJ5LA0KICAgICAgICBudWxsOiBhZFZhcmlhbnQsDQogICAgICAgIHVuZGVmaW5lZDogYWRWYXJpYW50DQogICAgICB9Ow0KICAgIH07DQoNCiAgICBPcmFjbGVEQi5wcm90b3R5cGUudGFibGVFeGlzdHMgPSBmdW5jdGlvbiB0YWJsZUV4aXN0cyAodGFibGVOYW1lKSB7DQogICAgICB2YXIgcm93ID0gdGhpcy5maXJzdFJvdygnc2VsZWN0IDEgZnJvbSB1c2VyX3RhYmxlcyB3aGVyZSB0YWJsZV9uYW1lID0gPycsIFsNCiAgICAgICAgdGFibGVOYW1lDQogICAgICBdKTsNCiAgICAgIHJldHVybiByb3cgIT0gbnVsbDsNCiAgICB9Ow0KDQogICAgT3JhY2xlREIucHJvdG90eXBlLmdldFRhYmxlcyA9IGZ1bmN0aW9uIGdldFRhYmxlcyAoKSB7DQogICAgICB2YXIgcm93cyA9IHRoaXMucm93cygnc2VsZWN0IHRhYmxlX25hbWUgZnJvbSB1c2VyX3RhYmxlcycpOw0KICAgICAgcmV0dXJuIHJvd3MubWFwKGZ1bmN0aW9uIChpdCkgeyByZXR1cm4gaXQuVEFCTEVfTkFNRTsgfSk7DQogICAgfTsKCiAgICByZXR1cm4gT3JhY2xlREI7CiAgfShBZG9kYikpOw0KDQogIGZ1bmN0aW9uIG9yYWNsZWRiKGRzLCB1c3IsIHBhc3MpIHsNCiAgICByZXR1cm4gbmV3IE9yYWNsZURCKGRzLCB1c3IsIHBhc3MpOw0KICB9DQoNCiAgLy8gT3JhT0xFREINCg0KICB2YXIgX3ZicyQxLCBfc2Vzc2lvbjsNCg0KICB2YXIgT280byA9IC8qQF9fUFVSRV9fKi8oZnVuY3Rpb24gKEFkb2RiKSB7CiAgICBmdW5jdGlvbiBPbzRvKGRzLCB1c2VyLCBwYXNzKSB7DQogICAgICBBZG9kYi5jYWxsKHRoaXMpOw0KICAgICAgdGhpcy5kYXRhQmFzZSA9IHRoaXMuc2Vzc2lvbi5PcGVuRGF0YWJhc2UoZHMsIHVzZXIgKyAnLycgKyBwYXNzLCAwKTsNCiAgICB9CgogICAgaWYgKCBBZG9kYiApIE9vNG8uX19wcm90b19fID0gQWRvZGI7CiAgICBPbzRvLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEFkb2RiICYmIEFkb2RiLnByb3RvdHlwZSApOwogICAgT280by5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBPbzRvOwoKICAgIHZhciBwcm90b3R5cGVBY2Nlc3NvcnMgPSB7IHZiczogeyBjb25maWd1cmFibGU6IHRydWUgfSxzZXNzaW9uOiB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH07DQoNCiAgICBwcm90b3R5cGVBY2Nlc3NvcnMudmJzLmdldCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgIGlmICghX3ZicyQxKSB7DQogICAgICAgIF92YnMkMSA9IF9fVkJTOw0KICAgICAgICBfdmJzJDEuQWRkQ29kZSgiXG5GdW5jdGlvbiBSZWFkQmxvYihmaWVsZClcbiAgRGltIGJ1ZigpXG4gIGZpZWxkLkdldENodW5rQnl0ZUV4IGJ1ZiwgMCwgZmllbGQuRmllbGRTaXplKClcbiAgUmVhZEJsb2IgPSBidWZcbkVuZCBGdW5jdGlvblxuXG5GdW5jdGlvbiBSZWFkQ2xvYihmaWVsZClcbiAgRGltIGJ1ZlxuICBmaWVsZC5WYWx1ZS5SZWFkIGJ1ZlxuICBSZWFkQ2xvYiA9IGJ1ZlxuRW5kIEZ1bmN0aW9uXG4gICAgICAiKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBfdmJzJDEuQ29kZU9iamVjdDsNCiAgICB9Ow0KDQogICAgcHJvdG90eXBlQWNjZXNzb3JzLnNlc3Npb24uZ2V0ID0gZnVuY3Rpb24gKCkgew0KICAgICAgaWYgKCFfc2Vzc2lvbikgew0KICAgICAgICBfc2Vzc2lvbiA9IG5ldyBBY3RpdmVYT2JqZWN0KCdPcmFjbGVJblByb2NTZXJ2ZXIuWE9yYVNlc3Npb24nKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBfc2Vzc2lvbjsNCiAgICB9OwoKICAgIE9vNG8ucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gY2xvc2UgKCkgew0KICAgICAgdGhpcy5kYXRhQmFzZS5DbG9zZSgpOw0KICAgICAgdGhpcy5kYXRhQmFzZSA9IG51bGw7DQogICAgICBfc2Vzc2lvbiA9IG51bGw7DQogICAgfTsNCg0KICAgIE9vNG8ucHJvdG90eXBlLmJlZ2luID0gZnVuY3Rpb24gYmVnaW4gKCkgew0KICAgICAgdGhpcy5zZXNzaW9uLkJlZ2luVHJhbnMoKTsNCiAgICB9Ow0KDQogICAgT280by5wcm90b3R5cGUuY29tbWl0ID0gZnVuY3Rpb24gY29tbWl0ICgpIHsNCiAgICAgIHRoaXMuc2Vzc2lvbi5Db21taXRUcmFucygpOw0KICAgIH07DQoNCiAgICBPbzRvLnByb3RvdHlwZS5yb2xsYmFjayA9IGZ1bmN0aW9uIHJvbGxiYWNrICgpIHsNCiAgICAgIHRoaXMuc2Vzc2lvbi5Sb2xsYmFjaygpOw0KICAgIH07DQoNCiAgICBPbzRvLnByb3RvdHlwZS5nZXREYXRhVHlwZU1hcHBpbmcgPSBmdW5jdGlvbiBnZXREYXRhVHlwZU1hcHBpbmcgKCkgew0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgc3RyaW5nOiAxLA0KICAgICAgICBpbnQ6IDIsDQogICAgICAgIGRlY2ltYWw6IDIsDQogICAgICAgIG51bWJlcjogMiwNCiAgICAgICAgYm9vbGVhbjogMSwNCiAgICAgICAgZGF0ZTogMTIsDQogICAgICAgIGJ1ZmZlcjogMTEzLA0KICAgICAgICBudWxsOiAxLA0KICAgICAgICB1bmRlZmluZWQ6IDENCiAgICAgIH07DQogICAgfTsNCg0KICAgIE9vNG8ucHJvdG90eXBlLmNyZWF0ZVBhcmFtcyA9IGZ1bmN0aW9uIGNyZWF0ZVBhcmFtcyAob3B0cykgew0KICAgICAgdmFyIHBhcmFtcyA9IG9wdHMucGFyYW1zLA0KICAgICAgICBzZWxmID0gdGhpczsNCiAgICAgIGlmICghcGFyYW1zKSB7IHJldHVybjsgfQ0KICAgICAgdmFyIGR0bWFwID0gdGhpcy5nZXREYXRhVHlwZU1hcHBpbmcoKTsNCiAgICAgIGVhY2gocGFyYW1zLCBmdW5jdGlvbiAodiwgaykgew0KICAgICAgICB2YXIgdHlwZSA9IGR0bWFwW3R5cGVPZih2KV0gfHwgMTsNCiAgICAgICAgc2VsZi5kYXRhQmFzZS5QYXJhbWV0ZXJzLkFkZChTdHJpbmcoayksIHYsIDEsIHR5cGUpOw0KDQogICAgICAgIGlmIChpc0FycmF5KHBhcmFtcykgJiYgb3B0cy5zcWwuaW5jbHVkZXMoJz8nKSkgew0KICAgICAgICAgIHZhciBpbmRleCA9IDA7DQogICAgICAgICAgb3B0cy5zcWwgPSBvcHRzLnNxbC5yZXBsYWNlKC9cPy9nLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICByZXR1cm4gJzonICsgaW5kZXgrKzsNCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfTsNCg0KICAgIE9vNG8ucHJvdG90eXBlLnJlbW92ZVBhcmFtcyA9IGZ1bmN0aW9uIHJlbW92ZVBhcmFtcyAob3B0cykgew0KICAgICAgdmFyIHBhcmFtcyA9IG9wdHMucGFyYW1zLA0KICAgICAgICBzZWxmID0gdGhpczsNCiAgICAgIGlmICghcGFyYW1zKSB7IHJldHVybjsgfQ0KICAgICAgZWFjaChwYXJhbXMsIGZ1bmN0aW9uICh2LCBrKSB7DQogICAgICAgIHNlbGYuZGF0YUJhc2UuUGFyYW1ldGVycy5SZW1vdmUoU3RyaW5nKGspKTsNCiAgICAgIH0pOw0KICAgIH07DQoNCiAgICBPbzRvLnByb3RvdHlwZS5leGVjdXRlID0gZnVuY3Rpb24gZXhlY3V0ZSAoKSB7CiAgICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07Cg0KICAgICAgdmFyIG9wdHMgPSB0aGlzLmdldE9wdGlvbnMoYXJncyk7DQogICAgICB0cnkgew0KICAgICAgICB0aGlzLmNyZWF0ZVBhcmFtcyhvcHRzKTsNCiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YUJhc2UuRXhlY3V0ZVNRTChvcHRzLnNxbCk7DQogICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIGUuc3FsID0gb3B0cy5zcWw7DQogICAgICAgIHRocm93IGU7DQogICAgICB9IGZpbmFsbHkgew0KICAgICAgICB0aGlzLnJlbW92ZVBhcmFtcyhvcHRzKTsNCiAgICAgIH0NCiAgICB9Ow0KDQogICAgT280by5wcm90b3R5cGUuc2VsZWN0ID0gZnVuY3Rpb24gc2VsZWN0ICgpIHsKICAgICAgdmFyIGFyZ3MgPSBbXSwgbGVuJDEgPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICB3aGlsZSAoIGxlbiQxLS0gKSBhcmdzWyBsZW4kMSBdID0gYXJndW1lbnRzWyBsZW4kMSBdOwoNCiAgICAgIHZhciBycywNCiAgICAgICAgcm93LA0KICAgICAgICBpLA0KICAgICAgICBsZW4sDQogICAgICAgIG9wdHMgPSB0aGlzLmdldE9wdGlvbnMoYXJncyk7DQogICAgICB0cnkgew0KICAgICAgICB0aGlzLmNyZWF0ZVBhcmFtcyhvcHRzKTsNCiAgICAgICAgcnMgPSB0aGlzLmRhdGFCYXNlLkNyZWF0ZUR5bmFzZXQob3B0cy5zcWwsIDApOw0KICAgICAgICB3aGlsZSAoIXJzLkVPRikgew0KICAgICAgICAgIHJvdyA9IHt9Ow0KICAgICAgICAgIGlmIChsZW4gPT0gbnVsbCkgeyBsZW4gPSBycy5GaWVsZHMuQ291bnQ7IH0NCiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspIHsNCiAgICAgICAgICAgIHJvd1tycy5GaWVsZHMoaSkuTmFtZV0gPSB0aGlzLmdldEZpZWxkVmFsdWUocnMuRmllbGRzKGkpKTsNCiAgICAgICAgICB9DQogICAgICAgICAgaWYgKG9wdHMuY2FsbGJhY2socm93KSA9PT0gZmFsc2UpIHsgYnJlYWs7IH0NCiAgICAgICAgICBycy5Nb3ZlTmV4dCgpOw0KICAgICAgICB9DQogICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIGUuc3FsID0gb3B0cy5zcWw7DQogICAgICAgIHRocm93IGU7DQogICAgICB9IGZpbmFsbHkgew0KICAgICAgICB0aGlzLnJlbW92ZVBhcmFtcyhvcHRzKTsNCiAgICAgICAgcnMgJiYgcnMuQ2xvc2UoKTsNCiAgICAgIH0NCiAgICB9Ow0KDQogICAgT280by5wcm90b3R5cGUuZ2V0RmllbGRWYWx1ZSA9IGZ1bmN0aW9uIGdldEZpZWxkVmFsdWUgKGZpZWxkKSB7DQogICAgICBzd2l0Y2ggKGZpZWxkLk9yYUlEYXRhVHlwZSkgew0KICAgICAgICBjYXNlIDI6DQogICAgICAgIGNhc2UgODoNCiAgICAgICAgICByZXR1cm4gTnVtYmVyKGZpZWxkLnZhbHVlKTsNCiAgICAgICAgY2FzZSAxMTI6DQogICAgICAgICAgcmV0dXJuIHRoaXMudmJzLlJlYWRDbG9iKGZpZWxkKTsNCiAgICAgICAgY2FzZSAxMTM6DQogICAgICAgICAgcmV0dXJuIEJ1ZmZlci5mcm9tKHRoaXMudmJzLlJlYWRCbG9iKGZpZWxkKSk7DQogICAgICAgIGNhc2UgMTI6DQogICAgICAgIGNhc2UgMTg3Og0KICAgICAgICBjYXNlIDE4ODoNCiAgICAgICAgY2FzZSAyMzI6DQogICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGZpZWxkLnZhbHVlKTsNCiAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICByZXR1cm4gZmllbGQudmFsdWU7DQogICAgICB9DQogICAgfTsNCg0KICAgIE9vNG8ucHJvdG90eXBlLmJhdGNoID0gZnVuY3Rpb24gYmF0Y2ggKCkge307DQoNCiAgICBPbzRvLnByb3RvdHlwZS5iYXRjaF9pbnNlcnQgPSBmdW5jdGlvbiBiYXRjaF9pbnNlcnQgKGNtZCwgcm93cykgew0KICAgICAgdmFyIHNlbGYgPSB0aGlzOw0KICAgICAgdmFyIHJzID0gdGhpcy5kYXRhQmFzZS5DcmVhdGVEeW5hc2V0KGNtZCwgMCk7DQogICAgICB0cnkgew0KICAgICAgICB0aGlzLmJlZ2luKCk7DQogICAgICAgIGVhY2gocm93cywgZnVuY3Rpb24gKHJvdykgew0KICAgICAgICAgIHJzLkFkZE5ldygpOw0KICAgICAgICAgIGVhY2gocm93LCBmdW5jdGlvbiAodiwgaykgew0KICAgICAgICAgICAgc2VsZi5zZXRGaWVsZFZhbHVlKHJzLkZpZWxkcyhrKSwgdik7DQogICAgICAgICAgfSk7DQogICAgICAgICAgcnMuVXBkYXRlKCk7DQogICAgICAgIH0pOw0KICAgICAgICB0aGlzLmNvbW1pdCgpOw0KICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICB0aGlzLnJvbGxiYWNrKCk7DQogICAgICAgIHRocm93IGU7DQogICAgICB9IGZpbmFsbHkgew0KICAgICAgICBycyAmJiBycy5DbG9zZSgpOw0KICAgICAgfQ0KICAgIH07CgogICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoIE9vNG8ucHJvdG90eXBlLCBwcm90b3R5cGVBY2Nlc3NvcnMgKTsKCiAgICByZXR1cm4gT280bzsKICB9KEFkb2RiKSk7DQoNCiAgZnVuY3Rpb24gb280byhkcywgdXNlciwgcGFzcykgew0KICAgIHJldHVybiBuZXcgT280byhkcywgdXNlciwgcGFzcyk7DQogIH0KCiAgdmFyIG9yYWNsZWRiJDEgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICBPcmFjbGVEQjogT3JhY2xlREIsCiAgICAnZGVmYXVsdCc6IG9yYWNsZWRiLAogICAgT280bzogT280bywKICAgIG9vNG86IG9vNG8KICB9KTsKCiAgdmFyIF9zZXJ2aWNlOw0KDQogIGZ1bmN0aW9uIGdldFNlcnZpY2UoKSB7DQogICAgaWYgKCFfc2VydmljZSkgew0KICAgICAgdmFyIGxvY2F0b3IgPSBuZXcgQWN0aXZlWE9iamVjdCgnV2JlbVNjcmlwdGluZy5TV2JlbUxvY2F0b3InKTsNCiAgICAgIF9zZXJ2aWNlID0gbG9jYXRvci5Db25uZWN0U2VydmVyKCcuJywgJ3Jvb3RcXENJTVYyJyk7DQogICAgfQ0KICAgIHJldHVybiBfc2VydmljZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGdldCQxKGNtZCkgew0KICAgIHJldHVybiBnZXRTZXJ2aWNlKCkuR2V0KGNtZCk7DQogIH0NCg0KICBmdW5jdGlvbiBleGVjJDEod3FsKSB7DQogICAgcmV0dXJuIGdldFNlcnZpY2UoKS5FeGVjUXVlcnkod3FsKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHF1ZXJ5KHdxbCkgew0KICAgIHZhciBycyA9IGV4ZWMkMSh3cWwpOw0KICAgIHZhciByb3dzID0gbWFwKHJzLCBmdW5jdGlvbiAocmVjb3JkKSB7DQogICAgICByZXR1cm4gcmVkdWNlKA0KICAgICAgICByZWNvcmQuUHJvcGVydGllc18sDQogICAgICAgIGZ1bmN0aW9uIChyb3dEYXRhLCBwcm9wKSB7DQogICAgICAgICAgaWYgKHByb3AuVmFsdWUgIT0gbnVsbCkgew0KICAgICAgICAgICAgcm93RGF0YVtwcm9wLm5hbWVdID0gcHJvcC5Jc0FycmF5DQogICAgICAgICAgICAgID8gbmV3IFZCQXJyYXkocHJvcC5WYWx1ZSkudG9BcnJheSgpDQogICAgICAgICAgICAgIDogcHJvcC5WYWx1ZTsNCiAgICAgICAgICB9DQogICAgICAgICAgcmV0dXJuIHJvd0RhdGE7DQogICAgICAgIH0sDQogICAgICAgIHt9DQogICAgICApOw0KICAgIH0pOw0KICAgIHJzID0gbnVsbDsNCiAgICByZXR1cm4gcm93czsNCiAgfQ0KDQogIGZ1bmN0aW9uIGVhY2hSb3cod3FsLCBjYikgew0KICAgIHZhciBycyA9IGV4ZWMkMSh3cWwpOw0KICAgIGVhY2gocnMsIGZ1bmN0aW9uIChpdCkgeyByZXR1cm4gY2IoaXQpOyB9KTsNCiAgICBycyA9IG51bGw7DQogIH0NCg0KICBmdW5jdGlvbiBmaXJzdFJvdyh3cWwpIHsNCiAgICB2YXIgb2JqOw0KICAgIHZhciBycyA9IGV4ZWMkMSh3cWwpOw0KICAgIGVhY2gocnMsIGZ1bmN0aW9uIChpdCkgew0KICAgICAgb2JqID0gaXQ7DQogICAgICByZXR1cm4gZmFsc2U7DQogICAgfSk7DQogICAgcnMgPSBudWxsOw0KICAgIHJldHVybiBvYmo7DQogIH0NCg0KICBmdW5jdGlvbiBjcHUoKSB7DQogICAgcmV0dXJuIHF1ZXJ5KCdzZWxlY3QgKiBmcm9tIFdpbjMyX1Byb2Nlc3NvcicpWzBdOw0KICB9DQoNCiAgZnVuY3Rpb24gc3lzKCkgew0KICAgIHJldHVybiBxdWVyeSgnc2VsZWN0ICogZnJvbSBXaW4zMl9Db21wdXRlclN5c3RlbScpWzBdOw0KICB9DQoNCiAgZnVuY3Rpb24gb3MoKSB7DQogICAgcmV0dXJuIHF1ZXJ5KCdzZWxlY3QgKiBmcm9tIFdpbjMyX09wZXJhdGluZ1N5c3RlbScpWzBdOw0KICB9DQoNCiAgZnVuY3Rpb24gc2h1dGRvd24oZm9yY2VkKSB7DQogICAgcmV0dXJuIGZpcnN0Um93KCdzZWxlY3QgKiBmcm9tIFdpbjMyX09wZXJhdGluZ1N5c3RlbScpLldpbjMyU2h1dGRvd24oDQogICAgICAxICsgKGZvcmNlZCA/IDQgOiAwKQ0KICAgICk7DQogIH0NCg0KICBmdW5jdGlvbiBsb2dvZmYoZm9yY2VkKSB7DQogICAgcmV0dXJuIGZpcnN0Um93KCdzZWxlY3QgKiBmcm9tIFdpbjMyX09wZXJhdGluZ1N5c3RlbScpLldpbjMyU2h1dGRvd24oDQogICAgICAwICsgKGZvcmNlZCA/IDQgOiAwKQ0KICAgICk7DQogIH0NCg0KICBmdW5jdGlvbiByZXN0YXJ0KGZvcmNlZCkgew0KICAgIHJldHVybiBmaXJzdFJvdygnc2VsZWN0ICogZnJvbSBXaW4zMl9PcGVyYXRpbmdTeXN0ZW0nKS5XaW4zMlNodXRkb3duKA0KICAgICAgMiArIChmb3JjZWQgPyA0IDogMCkNCiAgICApOw0KICB9DQoNCiAgZnVuY3Rpb24gcG93ZXJvZmYoZm9yY2VkKSB7DQogICAgcmV0dXJuIGZpcnN0Um93KCdzZWxlY3QgKiBmcm9tIFdpbjMyX09wZXJhdGluZ1N5c3RlbScpLldpbjMyU2h1dGRvd24oDQogICAgICA4ICsgKGZvcmNlZCA/IDQgOiAwKQ0KICAgICk7DQogIH0NCg0KICBmdW5jdGlvbiBwcyhsKSB7DQogICAgdmFyIHByb3BzID0gWydQcm9jZXNzSWQnLCAnQ2FwdGlvbiddOw0KICAgIGlmIChsKSB7IHByb3BzLnB1c2goJ1BhcmVudFByb2Nlc3NJZCcsICdDcmVhdGlvbkRhdGUnLCAnQ29tbWFuZExpbmUnKTsgfQ0KICAgIHJldHVybiBtYXAoZXhlYyQxKCdzZWxlY3QgKiBmcm9tIFdpbjMyX1Byb2Nlc3MnKSwgZnVuY3Rpb24gKGl0KSB7DQogICAgICByZXR1cm4gcmVkdWNlKHByb3BzLCBmdW5jdGlvbiAocm93LCBuYW1lKSB7IHJldHVybiAoKHJvd1tuYW1lXSA9IGl0W25hbWVdKSwgcm93KTsgfSwge30pOw0KICAgIH0pOw0KICB9DQoNCiAgZnVuY3Rpb24ga2lsbChhcmcpIHsNCiAgICB2YXIgd3FsID0gJ3NlbGVjdCAqIGZyb20gV2luMzJfUHJvY2Vzcyc7DQogICAgaWYgKGlzU3RyaW5nKGFyZykpIHsgd3FsICs9ICIgd2hlcmUgQ2FwdGlvbj0nIiArIGFyZyArICInIjsgfQ0KICAgIGVsc2UgaWYgKGlzTnVtYmVyKGFyZykpIHsgd3FsICs9ICIgd2hlcmUgUHJvY2Vzc0lkPSIgKyBhcmc7IH0NCiAgICBlbHNlIHsgcmV0dXJuIC0xOyB9DQogICAgcmV0dXJuIGZpcnN0Um93KHdxbCkuVGVybWluYXRlKCk7DQogIH0NCg0KICBmdW5jdGlvbiBlbnYoKSB7DQogICAgcmV0dXJuIHJlZHVjZSgNCiAgICAgIGV4ZWMkMSgnc2VsZWN0ICogZnJvbSBXaW4zMl9FbnZpcm9ubWVudCcpLA0KICAgICAgZnVuY3Rpb24gKHJlc3VsdCwgaXQpIHsgcmV0dXJuICgocmVzdWx0W2l0Lk5hbWVdID0gaXQuVmFyaWFibGVWYWx1ZSksIHJlc3VsdCk7IH0sDQogICAgICB7fQ0KICAgICk7DQogIH0KCiAgdmFyIHdtaSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgIGdldDogZ2V0JDEsCiAgICBleGVjOiBleGVjJDEsCiAgICBxdWVyeTogcXVlcnksCiAgICBlYWNoUm93OiBlYWNoUm93LAogICAgZmlyc3RSb3c6IGZpcnN0Um93LAogICAgY3B1OiBjcHUsCiAgICBzeXM6IHN5cywKICAgIG9zOiBvcywKICAgIHNodXRkb3duOiBzaHV0ZG93biwKICAgIGxvZ29mZjogbG9nb2ZmLAogICAgcmVzdGFydDogcmVzdGFydCwKICAgIHBvd2Vyb2ZmOiBwb3dlcm9mZiwKICAgIHBzOiBwcywKICAgIGtpbGw6IGtpbGwsCiAgICBlbnY6IGVudgogIH0pOwoKICB2YXIgUkVHRVhfUEFSU0UgPSAvXihcZHs0fSlbLS9dPyhcZHsxLDJ9KVstL10/KFxkezEsMn0pW14wLTldKihcZHsxLDJ9KT86PyhcZHsxLDJ9KT86PyhcZHsxLDJ9KT9cLj8oXGR7MSwzfSk/JC87DQogIHZhciBSRUdFWF9GT1JNQVQgPSAvXFsoW15cXV0rKV18WXsyLDR9fE17MSw0fXxEezEsMn18ZHsxLDR9fEh7MSwyfXxoezEsMn18YXxBfG17MSwyfXxzezEsMn18WnsxLDJ9fFNTUy9nOw0KICB2YXIgTVMgPSAnbWlsbGlzZWNvbmQnOw0KICB2YXIgUyA9ICdzZWNvbmQnOw0KICB2YXIgTUlOID0gJ21pbnV0ZSc7DQogIHZhciBIID0gJ2hvdXInOw0KICB2YXIgRCA9ICdkYXknOw0KICB2YXIgVyA9ICd3ZWVrJzsNCiAgdmFyIE0gPSAnbW9udGgnOw0KICB2YXIgUSA9ICdxdWFydGVyJzsNCiAgdmFyIFkgPSAneWVhcic7DQogIHZhciBEQVRFID0gJ2RhdGUnOw0KICB2YXIgRk9STUFUX0RFRkFVTFQgPSAnWVlZWS1NTS1ERFRISDptbTpzc1onOw0KICB2YXIgSU5WQUxJRF9EQVRFX1NUUklORyA9ICdJbnZhbGlkIERhdGUnOw0KDQogIHZhciBMcyA9IHsNCiAgICBlbjogew0KICAgICAgbmFtZTogJ2VuJywNCiAgICAgIHdlZWtkYXlzOiAnU3VuZGF5X01vbmRheV9UdWVzZGF5X1dlZG5lc2RheV9UaHVyc2RheV9GcmlkYXlfU2F0dXJkYXknLnNwbGl0KA0KICAgICAgICAnXycNCiAgICAgICksDQogICAgICBtb250aHM6ICdKYW51YXJ5X0ZlYnJ1YXJ5X01hcmNoX0FwcmlsX01heV9KdW5lX0p1bHlfQXVndXN0X1NlcHRlbWJlcl9PY3RvYmVyX05vdmVtYmVyX0RlY2VtYmVyJy5zcGxpdCgNCiAgICAgICAgJ18nDQogICAgICApDQogICAgfQ0KICB9Ow0KICB2YXIgTCA9ICdlbic7DQoNCiAgZnVuY3Rpb24gcGFyc2VMb2NhbGUocHJlc2V0LCBvYmplY3QsIGlzTG9jYWwpIHsNCiAgICB2YXIgbDsNCiAgICBpZiAoIXByZXNldCkgeyByZXR1cm4gbnVsbDsgfQ0KICAgIGlmIChpc1N0cmluZyhwcmVzZXQpKSB7DQogICAgICBpZiAoTHNbcHJlc2V0XSkgew0KICAgICAgICBsID0gcHJlc2V0Ow0KICAgICAgfQ0KICAgICAgaWYgKG9iamVjdCkgew0KICAgICAgICBMc1twcmVzZXRdID0gb2JqZWN0Ow0KICAgICAgICBsID0gcHJlc2V0Ow0KICAgICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICB2YXIgbmFtZSA9IHByZXNldC5uYW1lOw0KICAgICAgTHNbbmFtZV0gPSBwcmVzZXQ7DQogICAgICBsID0gbmFtZTsNCiAgICB9DQogICAgaWYgKCFpc0xvY2FsKSB7IEwgPSBsOyB9DQogICAgcmV0dXJuIGw7DQogIH0NCg0KICBmdW5jdGlvbiBpc0RheWpzKGRhdGUpIHsNCiAgICByZXR1cm4gZGF0ZSBpbnN0YW5jZW9mIERheWpzOw0KICB9DQoNCiAgZnVuY3Rpb24gZGF5anMoZGF0ZSwgY2ZnKSB7DQogICAgaWYgKGlzRGF5anMoZGF0ZSkpIHsgcmV0dXJuIGRhdGUuY2xvbmUoKTsgfQ0KICAgIHZhciBfY2ZnID0geyBkYXRlOiBkYXRlIH07DQogICAgaWYgKGlzU3RyaW5nKGNmZykpIHsNCiAgICAgIF9jZmcuZm9ybWF0ID0gY2ZnOw0KICAgIH0gZWxzZSBpZiAoaXNPYmplY3RMaWtlKGNmZykpIHsNCiAgICAgIGV4dGVuZChfY2ZnLCBjZmcpOw0KICAgIH0NCiAgICByZXR1cm4gbmV3IERheWpzKF9jZmcpOw0KICB9DQoNCiAgZnVuY3Rpb24gRGF5anMoY2ZnKSB7DQogICAgdGhpcy4kTCA9IHBhcnNlTG9jYWxlKGNmZy5sb2NhbGUsIG51bGwsIHRydWUpIHx8IEw7DQogICAgdGhpcy5wYXJzZShjZmcpOw0KICB9DQoNCiAgdmFyIF9wcm90byA9IERheWpzLnByb3RvdHlwZTsNCg0KICBfcHJvdG8ucGFyc2UgPSBmdW5jdGlvbihjZmcpIHsNCiAgICB0aGlzLiRkID0gcGFyc2VEYXRlKGNmZyk7DQogICAgdGhpcy5pbml0KCk7DQogIH07DQoNCiAgZnVuY3Rpb24gcGFyc2VEYXRlKGNmZykgew0KICAgIHZhciBkYXRlID0gY2ZnLmRhdGUsDQogICAgICB1dGMgPSBjZmcudXRjOw0KICAgIGlmIChkYXRlID09IG51bGwpIHsgcmV0dXJuIG5ldyBEYXRlKCk7IH0NCiAgICBpZiAoaXNEYXRlKGRhdGUpKSB7IHJldHVybiBuZXcgRGF0ZShkYXRlKTsgfQ0KICAgIGlmIChpc1N0cmluZyhkYXRlKSAmJiAhL1okL2kudGVzdChkYXRlKSkgew0KICAgICAgdmFyIG0gPSBkYXRlLm1hdGNoKFJFR0VYX1BBUlNFKTsNCiAgICAgIGlmIChtKSB7DQogICAgICAgIGlmICh1dGMpIHsNCiAgICAgICAgICByZXR1cm4gbmV3IERhdGUoDQogICAgICAgICAgICBEYXRlLlVUQygNCiAgICAgICAgICAgICAgbVsxXSwNCiAgICAgICAgICAgICAgbVsyXSAtIDEsDQogICAgICAgICAgICAgIG1bM10sDQogICAgICAgICAgICAgIG1bNF0gfHwgMCwNCiAgICAgICAgICAgICAgbVs1XSB8fCAwLA0KICAgICAgICAgICAgICBtWzZdIHx8IDAsDQogICAgICAgICAgICAgIG1bN10gfHwgMA0KICAgICAgICAgICAgKQ0KICAgICAgICAgICk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKA0KICAgICAgICAgIG1bMV0sDQogICAgICAgICAgbVsyXSAtIDEsDQogICAgICAgICAgbVszXSwNCiAgICAgICAgICBtWzRdIHx8IDAsDQogICAgICAgICAgbVs1XSB8fCAwLA0KICAgICAgICAgIG1bNl0gfHwgMCwNCiAgICAgICAgICBtWzddIHx8IDANCiAgICAgICAgKTsNCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIG5ldyBEYXRlKGRhdGUpOw0KICB9DQoNCiAgX3Byb3RvLmluaXQgPSBmdW5jdGlvbigpIHsNCiAgICB2YXIgJGQgPSB0aGlzLiRkOw0KICAgIGV4dGVuZCh0aGlzLCB7DQogICAgICAkeTogJGQuZ2V0RnVsbFllYXIoKSwNCiAgICAgICRNOiAkZC5nZXRNb250aCgpLA0KICAgICAgJEQ6ICRkLmdldERhdGUoKSwNCiAgICAgICRXOiAkZC5nZXREYXkoKSwNCiAgICAgICRIOiAkZC5nZXRIb3VycygpLA0KICAgICAgJG06ICRkLmdldE1pbnV0ZXMoKSwNCiAgICAgICRzOiAkZC5nZXRTZWNvbmRzKCksDQogICAgICAkbXM6ICRkLmdldE1pbGxpc2Vjb25kcygpDQogICAgfSk7DQogIH07DQoNCiAgX3Byb3RvLmlzVmFsaWQgPSBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gdGhpcy4kZC50b1N0cmluZygpICE9PSBJTlZBTElEX0RBVEVfU1RSSU5HOw0KICB9Ow0KDQogIF9wcm90by5pc1NhbWUgPSBmdW5jdGlvbih0aGF0LCB1bml0cykgew0KICAgIHZhciBvdGhlciA9IGRheWpzKHRoYXQpOw0KICAgIHJldHVybiB0aGlzLnN0YXJ0T2YodW5pdHMpIDw9IG90aGVyICYmIG90aGVyIDw9IHRoaXMuZW5kT2YodW5pdHMpOw0KICB9Ow0KDQogIF9wcm90by5pc0FmdGVyID0gZnVuY3Rpb24odGhhdCwgdW5pdHMpIHsNCiAgICByZXR1cm4gZGF5anModGhhdCkgPCB0aGlzLnN0YXJ0T2YodW5pdHMpOw0KICB9Ow0KDQogIF9wcm90by5pc0JlZm9yZSA9IGZ1bmN0aW9uKHRoYXQsIHVuaXRzKSB7DQogICAgcmV0dXJuIHRoaXMuZW5kT2YodW5pdHMpIDwgZGF5anModGhhdCk7DQogIH07DQoNCiAgZWFjaCgNCiAgICB7DQogICAgICAkeTogWSwNCiAgICAgICRNOiBNLA0KICAgICAgJFc6IEQsDQogICAgICAkRDogREFURSwNCiAgICAgICRIOiBILA0KICAgICAgJG06IE1JTiwNCiAgICAgICRzOiBTLA0KICAgICAgJG1zOiBNUw0KICAgIH0sDQogICAgZnVuY3Rpb24gKHVuaXQsIHByb3ApIHsNCiAgICAgIF9wcm90b1t1bml0XSA9IGZ1bmN0aW9uKGlucHV0KSB7DQogICAgICAgIHJldHVybiBpbnB1dCA9PSBudWxsID8gdGhpc1twcm9wXSA6IHRoaXMuY2xvbmUoKS4kc2V0KHVuaXQsIGlucHV0KTsNCiAgICAgIH07DQogICAgfQ0KICApOw0KDQogIF9wcm90by52YWx1ZU9mID0gZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuIHRoaXMuJGQuZ2V0VGltZSgpOw0KICB9Ow0KDQogIGZ1bmN0aW9uIHByZXR0eVVuaXQodSkgew0KICAgIHZhciBzcGVjaWFsID0gew0KICAgICAgTTogTSwNCiAgICAgIHk6IFksDQogICAgICB3OiBXLA0KICAgICAgZDogRCwNCiAgICAgIGg6IEgsDQogICAgICBtOiBNSU4sDQogICAgICBzOiBTLA0KICAgICAgbXM6IE1TLA0KICAgICAgUTogUQ0KICAgIH07DQogICAgcmV0dXJuICgNCiAgICAgIHNwZWNpYWxbdV0gfHwNCiAgICAgIFN0cmluZyh1IHx8ICcnKQ0KICAgICAgICAudG9Mb3dlckNhc2UoKQ0KICAgICAgICAucmVwbGFjZSgvcyQvLCAnJykNCiAgICApOw0KICB9DQoNCiAgX3Byb3RvLnN0YXJ0T2YgPSBmdW5jdGlvbih1bml0cywgX3N0YXJ0T2YpIHsNCiAgICAvLyBzdGFydE9mIC0+IGVuZE9mDQogICAgdmFyIGlzU3RhcnRPZiA9IF9zdGFydE9mID09IG51bGwgPyB0cnVlIDogX3N0YXJ0T2Y7DQogICAgdmFyIHVuaXQgPSBwcmV0dHlVbml0KHVuaXRzKTsNCiAgICB2YXIgJE0gPSB0aGlzLiRNLA0KICAgICAgJFcgPSB0aGlzLiRXLA0KICAgICAgJEQgPSB0aGlzLiREOw0KICAgIHZhciBjbG9uZSA9IHRoaXMuY2xvbmUoKTsNCg0KICAgIHN3aXRjaCAodW5pdCkgew0KICAgICAgY2FzZSBZOg0KICAgICAgICByZXR1cm4gY2xvbmUuJCRzZXQoaXNTdGFydE9mID8geyBNOiAwLCBkYXRlOiAxIH0gOiB7IE06IDExLCBkYXRlOiAzMSB9KTsNCiAgICAgIGNhc2UgTToNCiAgICAgICAgcmV0dXJuIGNsb25lLiQkc2V0KA0KICAgICAgICAgIGlzU3RhcnRPZiA/IHsgTTogJE0sIGRhdGU6IDEgfSA6IHsgTTogJE0gKyAxLCBkYXRlOiAwIH0NCiAgICAgICAgKTsNCiAgICAgIGNhc2UgRDoNCiAgICAgIGNhc2UgREFURToNCiAgICAgICAgcmV0dXJuIGNsb25lLiRzZXQoSCwgaXNTdGFydE9mID8gMCA6IDIzKTsNCiAgICAgIGNhc2UgSDoNCiAgICAgICAgcmV0dXJuIGNsb25lLiRzZXQoTUlOLCBpc1N0YXJ0T2YgPyAwIDogNTkpOw0KICAgICAgY2FzZSBNSU46DQogICAgICAgIHJldHVybiBjbG9uZS4kc2V0KFMsIGlzU3RhcnRPZiA/IDAgOiA1OSk7DQogICAgICBjYXNlIFM6DQogICAgICAgIHJldHVybiBjbG9uZS4kc2V0KE1TLCBpc1N0YXJ0T2YgPyAwIDogOTk5KTsNCiAgICAgIGNhc2UgVzogew0KICAgICAgICB2YXIgd2Vla1N0YXJ0ID0gdGhpcy4kbG9jYWxlKCkud2Vla1N0YXJ0IHx8IDA7DQogICAgICAgIHZhciBnYXAgPSAoJFcgPCB3ZWVrU3RhcnQgPyAkVyArIDcgOiAkVykgLSB3ZWVrU3RhcnQ7DQogICAgICAgIHJldHVybiBjbG9uZS4kc2V0KERBVEUsIGlzU3RhcnRPZiA/ICREIC0gZ2FwIDogJEQgKyAoNiAtIGdhcCkpOw0KICAgICAgfQ0KICAgICAgZGVmYXVsdDoNCiAgICAgICAgcmV0dXJuIGNsb25lOw0KICAgIH0NCiAgfTsNCg0KICBfcHJvdG8uZW5kT2YgPSBmdW5jdGlvbih1bml0cykgew0KICAgIHJldHVybiB0aGlzLnN0YXJ0T2YodW5pdHMsIGZhbHNlKTsNCiAgfTsNCg0KICB2YXIgVU5JVF9NRVRIT0QgPSBmcm9tUGFpcnMoWw0KICAgIFtELCAnRGF0ZSddLA0KICAgIFtEQVRFLCAnRGF0ZSddLA0KICAgIFtNLCAnTW9udGgnXSwNCiAgICBbWSwgJ0Z1bGxZZWFyJ10sDQogICAgW0gsICdIb3VycyddLA0KICAgIFtNSU4sICdNaW51dGVzJ10sDQogICAgW1MsICdTZWNvbmRzJ10sDQogICAgW01TLCAnTWlsbGlzZWNvbmRzJ10NCiAgXSk7DQoNCiAgZnVuY3Rpb24gX3NldChzZWxmLCB1bml0cywgX2ludCkgew0KICAgIHZhciB1bml0ID0gcHJldHR5VW5pdCh1bml0cyk7DQogICAgdmFyIHV0Y1BhZCA9ICdzZXQnICsgKHNlbGYuJHUgPyAnVVRDJyA6ICcnKTsNCiAgICB2YXIgbmFtZSA9IFVOSVRfTUVUSE9EW3VuaXRdOw0KICAgIHZhciBhcmcgPSB1bml0ID09IEQgPyBzZWxmLiREICsgKF9pbnQgLSBzZWxmLiRXKSA6IF9pbnQ7DQoNCiAgICBpZiAobmFtZSkgew0KICAgICAgaWYgKHVuaXQgPT0gTSB8fCB1bml0ID09IFkpIHsNCiAgICAgICAgdmFyIF9kID0gc2VsZi50b0RhdGUoKTsNCiAgICAgICAgX2Quc2V0RGF0ZSgxKTsNCiAgICAgICAgX2RbdXRjUGFkICsgbmFtZV0oYXJnKTsNCiAgICAgICAgX2Quc2V0TW9udGgoX2QuZ2V0TW9udGgoKSArIDEpOw0KICAgICAgICBfZC5zZXREYXRlKDApOw0KICAgICAgICB2YXIgX2xhc3REYXRlID0gX2QuZ2V0RGF0ZSgpOw0KICAgICAgICBpZiAoc2VsZi4kRCA8IF9sYXN0RGF0ZSkgew0KICAgICAgICAgIF9kLnNldERhdGUoc2VsZi4kRCk7DQogICAgICAgIH0NCiAgICAgICAgc2VsZi4kZCA9IF9kOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgc2VsZi4kZFt1dGNQYWQgKyBuYW1lXShhcmcpOw0KICAgICAgfQ0KICAgIH0NCiAgfQ0KDQogIF9wcm90by4kc2V0ID0gZnVuY3Rpb24odW5pdHMsIF9pbnQpIHsNCiAgICBfc2V0KHRoaXMsIHVuaXRzLCBfaW50KTsNCiAgICB0aGlzLmluaXQoKTsNCiAgICByZXR1cm4gdGhpczsNCiAgfTsNCg0KICBfcHJvdG8uJCRzZXQgPSBmdW5jdGlvbihvcHRpb25zKSB7DQogICAgdmFyIHNlbGYgPSB0aGlzOw0KICAgIGVhY2gob3B0aW9ucywgZnVuY3Rpb24gKF9pbnQsIHVuaXRzKSB7DQogICAgICBfc2V0KHNlbGYsIHVuaXRzLCBfaW50KTsNCiAgICB9KTsNCiAgICB0aGlzLmluaXQoKTsNCiAgICByZXR1cm4gdGhpczsNCiAgfTsNCg0KICBfcHJvdG8uc2V0ID0gZnVuY3Rpb24odW5pdCwgX2ludCkgew0KICAgIHZhciBjbG9uZSA9IHRoaXMuY2xvbmUoKTsNCiAgICBpZiAoaXNTdHJpbmcodW5pdCkpIHsNCiAgICAgIHJldHVybiBjbG9uZS4kc2V0KHVuaXQsIF9pbnQpOw0KICAgIH0gZWxzZSBpZiAoaXNPYmplY3RMaWtlKHVuaXQpKSB7DQogICAgICByZXR1cm4gY2xvbmUuJCRzZXQodW5pdCk7DQogICAgfQ0KICAgIHJldHVybiBjbG9uZTsNCiAgfTsNCg0KICBfcHJvdG8uZ2V0ID0gZnVuY3Rpb24odW5pdCkgew0KICAgIHJldHVybiB0aGlzW3ByZXR0eVVuaXQodW5pdCldKCk7DQogIH07DQoNCiAgX3Byb3RvLmFkZCA9IGZ1bmN0aW9uKG4sIHVuaXRzKSB7DQogICAgdmFyIG5hbWUgPSBwcmV0dHlVbml0KHVuaXRzKTsNCiAgICB2YXIgY2xvbmUgPSB0aGlzLmNsb25lKCk7DQogICAgbiA9IE51bWJlcihuKTsNCiAgICBpZiAobmFtZSA9PSBXKSB7IHJldHVybiBjbG9uZS4kc2V0KERBVEUsIHRoaXMuJEQgKyBNYXRoLnJvdW5kKG4gKiA3KSk7IH0NCiAgICBlbHNlIHsgcmV0dXJuIGNsb25lLiRzZXQobmFtZSwgdGhpc1tuYW1lXSgpICsgbik7IH0NCiAgfTsNCg0KICBfcHJvdG8uc3VidHJhY3QgPSBmdW5jdGlvbihuLCB1bml0KSB7DQogICAgcmV0dXJuIHRoaXMuYWRkKG4gKiAtMSwgdW5pdCk7DQogIH07DQoNCiAgX3Byb3RvLmZvcm1hdCA9IGZ1bmN0aW9uKGZtdCkgew0KICAgIGlmICghdGhpcy5pc1ZhbGlkKCkpIHsgcmV0dXJuIElOVkFMSURfREFURV9TVFJJTkc7IH0NCiAgICBmbXQgfHwgKGZtdCA9IEZPUk1BVF9ERUZBVUxUKTsNCiAgICB2YXIgJHkgPSB0aGlzLiR5LA0KICAgICAgJE0gPSB0aGlzLiRNLA0KICAgICAgJEQgPSB0aGlzLiRELA0KICAgICAgJFcgPSB0aGlzLiRXLA0KICAgICAgJEggPSB0aGlzLiRILA0KICAgICAgJG0gPSB0aGlzLiRtLA0KICAgICAgJHMgPSB0aGlzLiRzLA0KICAgICAgJE1TID0gdGhpcy4kTVM7DQogICAgdmFyIGxvY2FsZSA9IHRoaXMuJGxvY2FsZSgpOw0KICAgIHZhciB3ZWVrZGF5cyA9IGxvY2FsZS53ZWVrZGF5cywNCiAgICAgIG1vbnRocyA9IGxvY2FsZS5tb250aHM7DQogICAgdmFyIHR6T2Zmc2V0ID0gdGhpcy4kZC5nZXRUaW1lem9uZU9mZnNldCgpOw0KICAgIHZhciB0ek1pbnV0ZXMgPSBNYXRoLmFicyh0ek9mZnNldCk7DQogICAgdmFyIGhvdXJPZmZzZXQgPSBNYXRoLmZsb29yKHR6TWludXRlcyAvIDYwKTsNCiAgICB2YXIgbWluT2Zmc2V0ID0gdHpNaW51dGVzICUgNjA7DQogICAgdmFyIHpvbmVTdHIgPQ0KICAgICAgKHR6T2Zmc2V0IDwgMCA/ICctJyA6ICcrJykgKw0KICAgICAgcGFkU3RhcnQoaG91ck9mZnNldCwgMiwgJzAnKSArDQogICAgICAnOicgKw0KICAgICAgcGFkU3RhcnQobWluT2Zmc2V0LCAyLCAnMCcpOw0KICAgIHZhciBzZWxmID0gdGhpczsNCiAgICB2YXIgZ2V0U2hvcnQgPSBmdW5jdGlvbihhcnIsIGluZGV4LCBmdWxsLCBsZW5ndGgpIHsNCiAgICAgIHJldHVybiAoDQogICAgICAgIChhcnIgJiYgKGFycltpbmRleF0gfHwgYXJyKHNlbGYsIGZtdCkpKSB8fCBmdWxsW2luZGV4XS5zdWJzdHIoMCwgbGVuZ3RoKQ0KICAgICAgKTsNCiAgICB9Ow0KDQogICAgdmFyIG1hdGNoZXMgPSB7DQogICAgICBZWTogU3RyaW5nKCR5KS5zbGljZSgtMiksDQogICAgICBZWVlZOiAkeSwNCiAgICAgIE06ICRNICsgMSwNCiAgICAgIE1NOiBwYWRTdGFydCgkTSArIDEsIDIsICcwJyksDQogICAgICBNTU06IGdldFNob3J0KGxvY2FsZS5tb250aHNTaG9ydCwgJE0sIG1vbnRocywgMyksDQogICAgICBNTU1NOiBtb250aHNbJE1dIHx8IChpc0Z1bmN0aW9uKG1vbnRocykgJiYgbW9udGhzKHRoaXMsIGZtdCkpLA0KICAgICAgRDogJEQsDQogICAgICBERDogcGFkU3RhcnQoJEQsIDIsICcwJyksDQogICAgICBkOiAkVywNCiAgICAgIGRkOiBnZXRTaG9ydChsb2NhbGUud2Vla2RheXNNaW4sICRXLCB3ZWVrZGF5cywgMiksDQogICAgICBkZGQ6IGdldFNob3J0KGxvY2FsZS53ZWVrZGF5c1Nob3J0LCAkVywgd2Vla2RheXMsIDMpLA0KICAgICAgZGRkZDogd2Vla2RheXNbJFddLA0KICAgICAgSDogJEgsDQogICAgICBISDogcGFkU3RhcnQoJEgsIDIsICcwJyksDQogICAgICBoOiAkSCAlIDEyIHx8IDEyLA0KICAgICAgaGg6IHBhZFN0YXJ0KCRIICUgMTIgfHwgMTIsIDIsICcwJyksDQogICAgICBhOiAkSCA8IDEyID8gJ2FtJyA6ICdwbScsDQogICAgICBBOiAkSCA8IDEyID8gJ0FNJyA6ICdQTScsDQogICAgICBtOiAkbSwNCiAgICAgIG1tOiBwYWRTdGFydCgkbSwgMiwgJzAnKSwNCiAgICAgIHM6ICRzLA0KICAgICAgc3M6IHBhZFN0YXJ0KCRzLCAyLCAnMCcpLA0KICAgICAgU1NTOiBwYWRTdGFydCgkTVMsIDMsICcwJyksDQogICAgICBaOiB6b25lU3RyDQogICAgfTsNCiAgICByZXR1cm4gZm10LnJlcGxhY2UoUkVHRVhfRk9STUFULCBmdW5jdGlvbihtMCwgbTEpIHsNCiAgICAgIHJldHVybiBtMSB8fCBtYXRjaGVzW20wXSB8fCB6b25lU3RyLnJlcGxhY2UoJzonLCAnJyk7DQogICAgfSk7DQogIH07DQoNCiAgX3Byb3RvLnV0Y09mZnNldCA9IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiAtdGhpcy4kZC5nZXRUaW1lem9uZU9mZnNldCgpOw0KICB9Ow0KDQogIGZ1bmN0aW9uIG1vbnRoRGlmZihhLCBiKSB7DQogICAgdmFyIGRpZmYgPSAoYS55ZWFyKCkgLSBiLnllYXIoKSkgKiAxMiArIGEubW9udGgoKSAtIGIubW9udGgoKTsNCiAgICB2YXIgYW5jaG9yID0gYi5jbG9uZSgpLmFkZChkaWZmLCBNKTsNCiAgICB2YXIgYyA9IGEgLSBhbmNob3IgPiAwOw0KICAgIHZhciBhbmNob3IyID0gYi5jbG9uZSgpLmFkZChkaWZmICsgKGMgPyAxIDogLTEpLCBNKTsNCiAgICByZXR1cm4gZGlmZiArIChhIC0gYW5jaG9yKSAvIChjID8gYW5jaG9yMiAtIGFuY2hvciA6IGFuY2hvciAtIGFuY2hvcjIpOw0KICB9DQoNCiAgZnVuY3Rpb24gbWlsbGlTZWNvbmREaWZmKGEsIGIpIHsNCiAgICByZXR1cm4gYSAtIGIgKyAoYS51dGNPZmZzZXQoKSAtIGIudXRjT2Zmc2V0KCkpICogNjAwMDA7DQogIH0NCg0KICBmdW5jdGlvbiBhYnNGbG9vcihuKSB7DQogICAgcmV0dXJuIG4gPCAwID8gTWF0aC5jZWlsKG4pIDogTWF0aC5mbG9vcihuKTsNCiAgfQ0KDQogIF9wcm90by5kaWZmID0gZnVuY3Rpb24oaW5wdXQsIHVuaXRzLCBfZmxvYXQpIHsNCiAgICB2YXIgdW5pdCA9IHByZXR0eVVuaXQodW5pdHMpOw0KICAgIHZhciB0aGF0ID0gZGF5anMoaW5wdXQpOw0KICAgIHZhciByZXN1bHQ7DQoNCiAgICBzd2l0Y2ggKHVuaXQpIHsNCiAgICAgIGNhc2UgWToNCiAgICAgICAgcmVzdWx0ID0gbW9udGhEaWZmKHRoaXMsIHRoYXQpIC8gMTI7DQogICAgICAgIGJyZWFrOw0KICAgICAgY2FzZSBNOg0KICAgICAgICByZXN1bHQgPSBtb250aERpZmYodGhpcywgdGhhdCk7DQogICAgICAgIGJyZWFrOw0KICAgICAgY2FzZSBROg0KICAgICAgICByZXN1bHQgPSBtb250aERpZmYodGhpcywgdGhhdCkgLyAzOw0KICAgICAgICBicmVhazsNCiAgICAgIGNhc2UgVzoNCiAgICAgICAgcmVzdWx0ID0gbWlsbGlTZWNvbmREaWZmKHRoaXMsIHRoYXQpIC8gNjA0ODAwMDAwOw0KICAgICAgICBicmVhazsNCiAgICAgIGNhc2UgRDoNCiAgICAgICAgcmVzdWx0ID0gbWlsbGlTZWNvbmREaWZmKHRoaXMsIHRoYXQpIC8gODY0MDAwMDA7DQogICAgICAgIGJyZWFrOw0KICAgICAgY2FzZSBIOg0KICAgICAgICByZXN1bHQgPSBtaWxsaVNlY29uZERpZmYodGhpcywgdGhhdCkgLyAzNjAwMDAwOw0KICAgICAgICBicmVhazsNCiAgICAgIGNhc2UgTUlOOg0KICAgICAgICByZXN1bHQgPSBtaWxsaVNlY29uZERpZmYodGhpcywgdGhhdCkgLyA2MDAwMDsNCiAgICAgICAgYnJlYWs7DQogICAgICBjYXNlIFM6DQogICAgICAgIHJlc3VsdCA9IG1pbGxpU2Vjb25kRGlmZih0aGlzLCB0aGF0KSAvIDEwMDA7DQogICAgICAgIGJyZWFrOw0KICAgICAgZGVmYXVsdDoNCiAgICAgICAgcmVzdWx0ID0gbWlsbGlTZWNvbmREaWZmKHRoaXMsIHRoYXQpOw0KICAgICAgICBicmVhazsNCiAgICB9DQogICAgcmV0dXJuIF9mbG9hdCA/IHJlc3VsdCA6IGFic0Zsb29yKHJlc3VsdCk7DQogIH07DQoNCiAgX3Byb3RvLmRheXNJbk1vbnRoID0gZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuIHRoaXMuZW5kT2YoTSkuJEQ7DQogIH07DQoNCiAgX3Byb3RvLiRsb2NhbGUgPSBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gTHNbdGhpcy4kTF07DQogIH07DQoNCiAgX3Byb3RvLmxvY2FsZSA9IGZ1bmN0aW9uKHByZXNldCwgb2JqZWN0KSB7DQogICAgaWYgKCFwcmVzZXQpIHsgcmV0dXJuIHRoaXMuJEw7IH0NCiAgICB2YXIgdGhhdCA9IHRoaXMuY2xvbmUoKTsNCiAgICB0aGF0LiRMID0gcGFyc2VMb2NhbGUocHJlc2V0LCBvYmplY3QsIHRydWUpOw0KICAgIHJldHVybiB0aGF0Ow0KICB9Ow0KDQogIF9wcm90by5jbG9uZSA9IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiBkYXlqcyh0aGlzLnRvRGF0ZSgpLCB7DQogICAgICBsb2NhbGU6IHRoaXMuJEwsDQogICAgICB1dGM6IHRoaXMuJHUNCiAgICB9KTsNCiAgfTsNCg0KICBfcHJvdG8udG9EYXRlID0gZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuIG5ldyBEYXRlKHRoaXMuJGQpOw0KICB9Ow0KDQogIF9wcm90by50b0pTT04gPSBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gdGhpcy50b0lTT1N0cmluZygpOw0KICB9Ow0KDQogIF9wcm90by50b0lTT1N0cmluZyA9IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiB0aGlzLiRkLnRvSVNPU3RyaW5nKCk7DQogIH07DQoNCiAgX3Byb3RvLnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuIHRoaXMuJGQudG9VVENTdHJpbmcoKTsNCiAgfTsNCg0KICBkYXlqcy5wcm90b3R5cGUgPSBEYXlqcy5wcm90b3R5cGU7DQogIGRheWpzLmlzRGF5anMgPSBpc0RheWpzOw0KICBkYXlqcy5sb2NhbGUgPSBwYXJzZUxvY2FsZTsNCiAgZGF5anMuTHMgPSBMczsNCg0KICBkYXlqcy5leHRlbmQgPSBmdW5jdGlvbihwbHVnaW4sIG9wdGlvbikgew0KICAgIHBsdWdpbihvcHRpb24sIERheWpzLCBkYXlqcyk7DQogICAgcmV0dXJuIGRheWpzOw0KICB9OwoKICB2YXIgZGF5anMkMSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgICdkZWZhdWx0JzogZGF5anMKICB9KTsKCiAgdmFyIFBpcGUgPSBmdW5jdGlvbiBQaXBlKHRhcmdldCkgew0KICAgIGlmICh0aGlzIGluc3RhbmNlb2YgUGlwZSkgew0KICAgICAgdGhpcy5fdGFyZ2V0ID0gdGFyZ2V0Ow0KICAgICAgdGhpcy5fID0gdGhpcy5waXBlOw0KICAgIH0gZWxzZSB7DQogICAgICByZXR1cm4gbmV3IFBpcGUodGFyZ2V0KTsNCiAgICB9DQogIH07DQoNCiAgUGlwZS5wcm90b3R5cGUucGlwZSA9IGZ1bmN0aW9uIHBpcGUgKGZ1bmMpIHsKICAgICAgdmFyIHRoaXMkMSA9IHRoaXM7CiAgICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGggLSAxOwogICAgICB3aGlsZSAoIGxlbi0tID4gMCApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gKyAxIF07Cg0KICAgIGlmIChpc0Z1bmN0aW9uKGZ1bmMpKSB7DQogICAgICBpZiAoYXJncy5sZW5ndGggPT0gMCkgew0KICAgICAgICB0aGlzLl90YXJnZXQgPSBmdW5jKHRoaXMuX3RhcmdldCk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB2YXIgX2FyZ3MgPSBhcmdzLm1hcChmdW5jdGlvbiAoaXQpIHsgcmV0dXJuIChpdCA9PT0gUGlwZSA/IHRoaXMkMS5fdGFyZ2V0IDogaXQpOyB9KTsNCiAgICAgICAgdGhpcy5fdGFyZ2V0ID0gZnVuYy5hcHBseSh2b2lkIDAsIF9hcmdzKTsNCiAgICAgIH0NCiAgICB9IGVsc2Ugew0KICAgICAgdGhpcy5fdGFyZ2V0ID0gZnVuYzsNCiAgICB9DQogICAgcmV0dXJuIHRoaXM7DQogIH07DQoNCiAgUGlwZS5wcm90b3R5cGUudmFsdWUgPSBmdW5jdGlvbiB2YWx1ZSAoKSB7DQogICAgcmV0dXJuIHRoaXMuX3RhcmdldDsNCiAgfTsNCg0KICBQaXBlLnByb3RvdHlwZS5sb2cgPSBmdW5jdGlvbiBsb2cgKG1zZykgew0KICAgIG1zZyA/IGNvbnNvbGUubG9nKG1zZywgdGhpcy5fdGFyZ2V0KSA6IGNvbnNvbGUubG9nKHRoaXMuX3RhcmdldCk7DQogICAgcmV0dXJuIHRoaXM7DQogIH07Cg0KICBQaXBlLmNyZWF0ZSA9IFBpcGUuX18gPSBmdW5jdGlvbih0YXJnZXQpIHsNCiAgICByZXR1cm4gbmV3IFBpcGUodGFyZ2V0KTsNCiAgfTsKCiAgdmFyIHBpcGUgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICAnZGVmYXVsdCc6IFBpcGUKICB9KTsKCiAgdmFyIEpTX1RPS0VOUyA9IC8oKFsnIl0pKD86KD8hXDJ8XFwpLnxcXCg/OlxyXG58W1xzXFNdKSkqKFwyKT98YCg/OlteYFxcJF18XFxbXHNcU118XCQoPyFceyl8XCRceyg/Oltee31dfFx7W159XSpcfT8pKlx9PykqKGApPyl8KFwvXC8uKil8KFwvXCooPzpbXipdfFwqKD8hXC8pKSooXCpcLyk/KXwoXC8oPyFcKikoPzpcWyg/Oig/IVtcXVxcXSkufFxcLikqXF18KD8hWy9cXVxcXSkufFxcLikrXC8oPzooPyFccyooPzpcYnxbXHUwMDgwLVx1RkZGRiRcXCcifih7XXxbK1wtIV0oPyE9KXxcLj9cZCkpfFtnbWl5dXNdezEsNn1cYig/IVtcdTAwODAtXHVGRkZGJFxcXXxccyooPzpbK1wtKiUmfF48PiE9Pyh7XXxcLyg/IVsvKl0pKSkpKXwoMFt4WF1bXGRhLWZBLUZdK3wwW29PXVswLTddK3wwW2JCXVswMV0rfCg/OlxkKlwuXGQrfFxkK1wuPykoPzpbZUVdWystXT9cZCspPyl8KCg/IVxkKSg/Oig/IVxzKVskXHdcdTAwODAtXHVGRkZGXXxcXHVbXGRhLWZBLUZdezR9fFxcdVx7W1xkYS1mQS1GXStcfSkrKXwoLS18XCtcK3wmJnxcfFx8fD0+fFwuezN9fCg/OlsrXC0vJSZ8Xl18XCp7MSwyfXw8ezEsMn18PnsxLDN9fCE9P3w9ezEsMn0pPT98Wz9+Liw6O1tcXSgpe31dKXwoXHMrKXwoXiR8W1xzXFNdKS9nOw0KDQogIGZ1bmN0aW9uIG1hdGNoVG9Ub2tlbihtYXRjaCkgew0KICAgIHZhciB0b2tlbiA9IHsgdHlwZTogJ2ludmFsaWQnLCB2YWx1ZTogbWF0Y2hbMF0sIGNsb3NlZDogdW5kZWZpbmVkIH07DQogICAgaWYgKG1hdGNoWzFdKQ0KICAgICAgeyAodG9rZW4udHlwZSA9ICdzdHJpbmcnKSwgKHRva2VuLmNsb3NlZCA9ICEhKG1hdGNoWzNdIHx8IG1hdGNoWzRdKSk7IH0NCiAgICBlbHNlIGlmIChtYXRjaFs1XSkgeyB0b2tlbi50eXBlID0gJ2NvbW1lbnQnOyB9DQogICAgZWxzZSBpZiAobWF0Y2hbNl0pIHsgKHRva2VuLnR5cGUgPSAnY29tbWVudCcpLCAodG9rZW4uY2xvc2VkID0gISFtYXRjaFs3XSk7IH0NCiAgICBlbHNlIGlmIChtYXRjaFs4XSkgeyB0b2tlbi50eXBlID0gJ3JlZ2V4JzsgfQ0KICAgIGVsc2UgaWYgKG1hdGNoWzldKSB7IHRva2VuLnR5cGUgPSAnbnVtYmVyJzsgfQ0KICAgIGVsc2UgaWYgKG1hdGNoWzEwXSkgeyB0b2tlbi50eXBlID0gJ25hbWUnOyB9DQogICAgZWxzZSBpZiAobWF0Y2hbMTFdKSB7IHRva2VuLnR5cGUgPSAncHVuY3R1YXRvcic7IH0NCiAgICBlbHNlIGlmIChtYXRjaFsxMl0pIHsgdG9rZW4udHlwZSA9ICd3aGl0ZXNwYWNlJzsgfQ0KICAgIHJldHVybiB0b2tlbjsNCiAgfQ0KDQogIGZ1bmN0aW9uIGdldFRva2VucyhzcmMpIHsNCiAgICB2YXIgdG9rZW5zID0gW10sDQogICAgICBtYXRjaCwNCiAgICAgIHRva2VuOw0KICAgIGZvciAoOzspIHsNCiAgICAgIG1hdGNoID0gSlNfVE9LRU5TLmV4ZWMoc3JjKTsNCiAgICAgIGlmICghbWF0Y2gpIHsgYnJlYWs7IH0NCiAgICAgIHRva2VuID0gbWF0Y2hUb1Rva2VuKG1hdGNoKTsNCiAgICAgIHRva2Vucy5wdXNoKHRva2VuKTsNCiAgICB9DQogICAgcmV0dXJuIHRva2VuczsNCiAgfQ0KDQogIHZhciBFU0NBUFNFX01BUCQxID0gew0KICAgICInIjogIiciLA0KICAgICciJzogJyInLA0KICAgICdccic6ICdyJywNCiAgICAnXG4nOiAnbicsDQogICAgJ1x0JzogJ3QnLA0KICAgICdcdTIwMjgnOiAndTIwMjgnLA0KICAgICdcdTIwMjknOiAndTIwMjknDQogIH07DQoNCiAgdmFyIEVTQ0FQU0VfUkVHJDEgPSAvJ3wifFxyfFxufFx0fFx1MjAyOHxcdTIwMjldL2c7DQoNCiAgZnVuY3Rpb24gZXNjYXBlQ2hhciQxKGMpIHsNCiAgICByZXR1cm4gJ1xcJyArIEVTQ0FQU0VfTUFQJDFbY107DQogIH0NCg0KICB2YXIgU1VCX1JFRyA9IC9cJFx7KCg/Oltee31dfFx7W159XSpcfT8pKilcfT8vZzsNCiAgdmFyIFNVQl9TRVAgPSAnJFRNUCQnOw0KICB2YXIgU1VCX1NFUF9SRUcgPSAvXCRUTVBcJC9nOw0KDQogIGZ1bmN0aW9uIHJlcGxUbXBTdHIodG9rZW4sIHRva2VucywgaW5kZXgpIHsNCiAgICB2YXIgc3RyID0gdG9rZW4udmFsdWU7DQogICAgaWYgKHRva2VuLnR5cGUgIT0gJ3N0cmluZycgfHwgc3RyWzBdICE9ICdgJykgeyByZXR1cm4gZmFsc2U7IH0NCiAgICB2YXIgcmF3X2FyZ3MgPSBbbnVsbF07DQogICAgc3RyID0gc3RyLnNsaWNlKDEsIHN0ci5sZW5ndGggLSAxKTsNCiAgICBzdHIgPSBzdHIucmVwbGFjZShTVUJfUkVHLCBmdW5jdGlvbihnMCwgZzEpIHsNCiAgICAgIHJhd19hcmdzLnB1c2goZzEpOw0KICAgICAgcmV0dXJuIFNVQl9TRVA7DQogICAgfSk7DQogICAgdmFyIHN0clJhdyA9IGluZGV4ID4gMiAmJiB0b2tlbnNbaW5kZXggLSAxXS52YWx1ZTsNCiAgICBpZiAoc3RyUmF3ID09ICdyYXcnKSB7DQogICAgICByYXdfYXJnc1swXSA9IEpTT04uc3RyaW5naWZ5KHsgcmF3OiBzdHIuc3BsaXQoU1VCX1NFUCkgfSk7DQogICAgICB0b2tlbi52YWx1ZSA9ICcoJyArIHJhd19hcmdzLmpvaW4oKSArICcpJzsNCiAgICB9IGVsc2Ugew0KICAgICAgc3RyID0gc3RyLnJlcGxhY2UoRVNDQVBTRV9SRUckMSwgZXNjYXBlQ2hhciQxKTsNCiAgICAgIHJhd19hcmdzWzBdID0gIntyYXc6IFsnIiArIHN0ci5yZXBsYWNlKFNVQl9TRVBfUkVHLCAiJywnIikgKyAiJ119IjsNCiAgICAgIHRva2VuLnZhbHVlID0gJ1N0cmluZy5yYXcoJyArIHJhd19hcmdzLmpvaW4oKSArICcpJzsNCiAgICB9DQogICAgcmV0dXJuIHRydWU7DQogIH0NCg0KICBmdW5jdGlvbiByZXBsQXJyb3codG9rZW4sIHRva2VucywgaW5kZXgpIHsNCiAgICBpZiAodG9rZW4udHlwZSAhPSAncHVuY3R1YXRvcicgfHwgdG9rZW4udmFsdWUgIT0gJz0+JykgeyByZXR1cm4gZmFsc2U7IH0NCiAgICB2YXIgaSA9IGluZGV4LA0KICAgICAgbGVuID0gdG9rZW5zLmxlbmd0aCwNCiAgICAgIGRlcHRoID0gMCwNCiAgICAgIGhhc0JyYWNrZXQgPSBmYWxzZSwNCiAgICAgIGhhc1RoaXMgPSBmYWxzZSwNCiAgICAgIHRva2VuSXQ7DQogICAgd2hpbGUgKC0taSkgew0KICAgICAgdG9rZW5JdCA9IHRva2Vuc1tpXTsNCiAgICAgIGlmICh0b2tlbkl0LnR5cGUgPT0gJ3B1bmN0dWF0b3InKSB7DQogICAgICAgIHN3aXRjaCAodG9rZW5JdC52YWx1ZSkgew0KICAgICAgICAgIGNhc2UgJyknOg0KICAgICAgICAgICAgaGFzQnJhY2tldCA9IHRydWU7DQogICAgICAgICAgICBkZXB0aCsrOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgY2FzZSAnKCc6DQogICAgICAgICAgICBkZXB0aC0tOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgIGlmIChkZXB0aCA9PSAwKSB7IGRlcHRoLS07IH0NCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIGlmICh0b2tlbkl0LnR5cGUgPT0gJ25hbWUnICYmIHRva2VuSXQudmFsdWUgPT0gJ3JldHVybicpIHsNCiAgICAgICAgZGVwdGgtLTsNCiAgICAgIH0NCiAgICAgIGlmIChkZXB0aCA8IDApIHsNCiAgICAgICAgaWYgKGhhc0JyYWNrZXQpIHsNCiAgICAgICAgICB0b2tlbkl0LnZhbHVlICs9ICcgZnVuY3Rpb24nOw0KICAgICAgICAgIHRva2VuLnZhbHVlID0gJyc7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdG9rZW5JdC52YWx1ZSArPSAnIGZ1bmN0aW9uKCc7DQogICAgICAgICAgdG9rZW4udmFsdWUgPSAnKSc7DQogICAgICAgIH0NCiAgICAgICAgYnJlYWs7DQogICAgICB9DQogICAgfQ0KICAgIGkgPSBpbmRleDsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICB0b2tlbkl0ID0gdG9rZW5zW2ldOw0KICAgICAgaWYgKHRva2VuSXQudHlwZSAhPSAnd2hpdGVzcGFjZScpIHsgYnJlYWs7IH0NCiAgICB9DQogICAgaGFzQnJhY2tldCA9IGZhbHNlOw0KICAgIGlmICh0b2tlbkl0LnZhbHVlID09ICd7JykgeyBoYXNCcmFja2V0ID0gdHJ1ZTsgfQ0KICAgIGktLTsNCiAgICBkZXB0aCA9IDA7DQogICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgdG9rZW5JdCA9IHRva2Vuc1tpXTsNCiAgICAgIGlmICh0b2tlbkl0LnR5cGUgPT0gJ3B1bmN0dWF0b3InKSB7DQogICAgICAgIHN3aXRjaCAodG9rZW5JdC52YWx1ZSkgew0KICAgICAgICAgIGNhc2UgJ3snOg0KICAgICAgICAgIGNhc2UgJygnOg0KICAgICAgICAgIGNhc2UgJ1snOg0KICAgICAgICAgICAgZGVwdGgrKzsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgIGNhc2UgJ30nOg0KICAgICAgICAgIGNhc2UgJyknOg0KICAgICAgICAgIGNhc2UgJ10nOg0KICAgICAgICAgICAgZGVwdGgtLTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgIGNhc2UgJywnOg0KICAgICAgICAgIGNhc2UgJzsnOg0KICAgICAgICAgICAgaWYgKGRlcHRoID09IDApIHsgZGVwdGgtLTsgfQ0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSBpZiAodG9rZW5JdC50eXBlID09ICd3aGl0ZXNwYWNlJykgew0KICAgICAgICBpZiAoZGVwdGggPT0gMCAmJiB0b2tlbkl0LnZhbHVlLmluY2x1ZGVzKCdcclxuJykpIHsNCiAgICAgICAgICBkZXB0aC0tOw0KICAgICAgICB9DQogICAgICB9IGVsc2UgaWYgKHRva2VuSXQudHlwZSA9PSAnbmFtZScpIHsNCiAgICAgICAgaWYgKHRva2VuSXQudmFsdWUgPT0gJ3RoaXMnKSB7IGhhc1RoaXMgPSB0cnVlOyB9DQogICAgICB9DQogICAgICBpZiAoZGVwdGggPCAwKSB7DQogICAgICAgIGlmIChoYXNCcmFja2V0KSB7DQogICAgICAgICAgaWYgKGhhc1RoaXMpIHsgdG9rZW5JdC52YWx1ZSA9ICcuYmluZCh0aGlzKScgKyB0b2tlbkl0LnZhbHVlOyB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdG9rZW4udmFsdWUgKz0gJ3tyZXR1cm4gJzsNCiAgICAgICAgICBpZiAoaGFzVGhpcykgeyB0b2tlbkl0LnZhbHVlID0gJ30uYmluZCh0aGlzKScgKyB0b2tlbkl0LnZhbHVlOyB9DQogICAgICAgICAgZWxzZSB7IHRva2VuSXQudmFsdWUgPSAnfScgKyB0b2tlbkl0LnZhbHVlOyB9DQogICAgICAgIH0NCiAgICAgICAgYnJlYWs7DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgZnVuY3Rpb24gcm1Db21tZW50KHRva2VuKSB7DQogICAgaWYgKHRva2VuLnR5cGUgPT0gJ2NvbW1lbnQnKSB7DQogICAgICB0b2tlbi52YWx1ZSA9ICcnOw0KICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIHJldHVybiBmYWxzZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlcGxJbXBvcnQodG9rZW4sIHRva2VucywgaW5kZXgpIHsNCiAgICB2YXIgaW1wb3J0TWFwID0ge30sDQogICAgICBidWYgPSBbXSwNCiAgICAgIGluc2lkZSwNCiAgICAgIGJBbGlhcywNCiAgICAgIHR5cGUsDQogICAgICB2YWx1ZSwNCiAgICAgIGksDQogICAgICBsZW4sDQogICAgICB0b2tlbkl0LA0KICAgICAgbmFtZSwNCiAgICAgIG1vZHVsZU5hbWUsDQogICAgICBtb2R1bGVBbGlhczsNCiAgICBpZiAodG9rZW4udHlwZSAhPSAnbmFtZScgfHwgdG9rZW4udmFsdWUgIT0gJ2ltcG9ydCcpIHsgcmV0dXJuIGZhbHNlOyB9DQogICAgdG9rZW4udmFsdWUgPSAnJzsNCiAgICBpID0gaW5kZXg7DQogICAgbGVuID0gdG9rZW5zLmxlbmd0aDsNCiAgICB0b2tlbkl0ID0gdG9rZW47DQogICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgdG9rZW5JdC52YWx1ZSA9ICcnOw0KICAgICAgdG9rZW5JdCA9IHRva2Vuc1tpXTsNCiAgICAgIHR5cGUgPSB0b2tlbkl0LnR5cGU7DQogICAgICB2YWx1ZSA9IHRva2VuSXQudmFsdWU7DQogICAgICBpZiAodHlwZSA9PSAnbmFtZScpIHsNCiAgICAgICAgaWYgKHZhbHVlID09ICdmcm9tJykgew0KICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09ICdhcycpIHsNCiAgICAgICAgICBiQWxpYXMgPSB0cnVlOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGlmIChiQWxpYXMpIHsNCiAgICAgICAgICAgIGltcG9ydE1hcFtuYW1lXSA9IHZhbHVlOw0KICAgICAgICAgICAgYkFsaWFzID0gZmFsc2U7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIG5hbWUgPSB2YWx1ZTsNCiAgICAgICAgICAgIGlmIChpbnNpZGUpIHsNCiAgICAgICAgICAgICAgaW1wb3J0TWFwW25hbWVdID0gbmFtZTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIGltcG9ydE1hcFsnZGVmYXVsdCddID0gbmFtZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAncHVuY3R1YXRvcicpIHsNCiAgICAgICAgaWYgKHZhbHVlID09ICcqJykgew0KICAgICAgICAgIG5hbWUgPSAnKic7DQogICAgICAgICAgaW1wb3J0TWFwWycqJ10gPSAwOw0KICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09ICd7Jykgew0KICAgICAgICAgIGluc2lkZSA9IHRydWU7DQogICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT0gJ30nKSB7DQogICAgICAgICAgaW5zaWRlID0gZmFsc2U7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAnc3RyaW5nJykgew0KICAgICAgICBtb2R1bGVOYW1lID0gdmFsdWUuc2xpY2UoMSwgdmFsdWUubGVuZ3RoIC0gMSk7DQogICAgICAgIGJyZWFrOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIG1vZHVsZUFsaWFzID0gbW9kdWxlTmFtZS5yZXBsYWNlKC9bXFwvLi1AXS9nLCAnXycpOw0KICAgIG1vZHVsZUFsaWFzICs9DQogICAgICAnXycgKw0KICAgICAgTWF0aC5yYW5kb20oKQ0KICAgICAgICAudG9TdHJpbmcoMTYpDQogICAgICAgIC5zbGljZSgyKTsNCiAgICBidWYucHVzaChtb2R1bGVBbGlhcyArICI9cmVxdWlyZSgnIiArIG1vZHVsZU5hbWUgKyAiJykiKTsNCiAgICBpZiAoaW1wb3J0TWFwWycqJ10pIHsNCiAgICAgIGJ1Zi5wdXNoKGltcG9ydE1hcFsnKiddICsgJz0nICsgbW9kdWxlQWxpYXMpOw0KICAgICAgZGVsZXRlIGltcG9ydE1hcFsnKiddOw0KICAgIH0NCiAgICBpZiAoaW1wb3J0TWFwWydkZWZhdWx0J10pIHsNCiAgICAgIGJ1Zi5wdXNoKGltcG9ydE1hcFsnZGVmYXVsdCddICsgJz0nICsgbW9kdWxlQWxpYXMgKyAiWydkZWZhdWx0J10iKTsNCiAgICAgIGRlbGV0ZSBpbXBvcnRNYXBbJ2RlZmF1bHQnXTsNCiAgICB9DQogICAgZm9yIChuYW1lIGluIGltcG9ydE1hcCkgew0KICAgICAgYnVmLnB1c2goaW1wb3J0TWFwW25hbWVdICsgJz0nICsgbW9kdWxlQWxpYXMgKyAnLicgKyBuYW1lKTsNCiAgICB9DQogICAgdG9rZW5JdC52YWx1ZSA9ICdsZXQgJyArIGJ1Zi5qb2luKCk7DQogICAgcmV0dXJuIHRydWU7DQogIH0NCg0KICBmdW5jdGlvbiB0cmFuc3BpbGUoY29kZSkgew0KICAgIHZhciB0b2tlbnMgPSBnZXRUb2tlbnMoY29kZSksDQogICAgICB0b2tlbiwNCiAgICAgIHNvdXJjZTsNCiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdG9rZW5zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7DQogICAgICB0b2tlbiA9IHRva2Vuc1tpXTsNCiAgICAgIGlmIChyZXBsVG1wU3RyKHRva2VuLCB0b2tlbnMsIGkpKSB7IGNvbnRpbnVlOyB9DQogICAgICBpZiAocmVwbEFycm93KHRva2VuLCB0b2tlbnMsIGkpKSB7IGNvbnRpbnVlOyB9DQogICAgICBpZiAocmVwbEltcG9ydCh0b2tlbiwgdG9rZW5zLCBpKSkgeyBjb250aW51ZTsgfQ0KICAgICAgcm1Db21tZW50KHRva2VuKTsNCiAgICB9DQogICAgc291cmNlID0gdG9rZW5zLm1hcChmdW5jdGlvbiAoaXQpIHsgcmV0dXJuIGl0LnZhbHVlOyB9KS5qb2luKCcnKTsNCg0KICAgIHJldHVybiBzb3VyY2U7DQogIH0KCiAgdmFyIEludGVybmFsTW9kdWxlcyA9IHsNCiAgICBhY2NkYjogYWNjZGIkMSwNCiAgICBhZG9kYjogYWRvZGIsDQogICAgY2hpbGRfcHJvY2VzczogY2hpbGRfcHJvY2VzcywNCiAgICBjcnlwdG86IGNyeXB0byQxLA0KICAgIGNzdjogY3N2LA0KICAgIGNzdmRiOiBjc3ZkYiQxLA0KICAgIGRheWpzOiBkYXlqcyQxLA0KICAgIGV4Y2VsOiBleGNlbCwNCiAgICBleGNlbGRiOiBleGNlbGRiJDEsDQogICAgZnM6IGZzLA0KICAgIGh0dHA6IGh0dHAkMSwNCiAgICBpZTogaWUsDQogICAgb3JhY2xlZGI6IG9yYWNsZWRiJDEsDQogICAgb3V0bG9vazogb3V0bG9vaywNCiAgICBwYXRoOiBQYXRoLA0KICAgIHF1ZXJ5c3RyaW5nOiBxdWVyeXN0cmluZywNCiAgICB0b29sOiB0b29sLA0KICAgIHV0aWw6IHV0aWwsDQogICAgd21pOiB3bWksDQogICAgcGlwZTogcGlwZQ0KICB9Ow0KDQogIHdpbmRvdy5yZXF1aXJlID0gZnVuY3Rpb24obmFtZSkgew0KICAgIHJldHVybiBJbnRlcm5hbE1vZHVsZXNbbmFtZV07DQogIH07DQoNCiAgaWYgKHByb2Nlc3MuYXJndi5sZW5ndGggPT09IDMpIHsNCiAgICB2YXIgcHRoID0gcHJvY2Vzcy5hcmd2WzJdOw0KICAgIGlmICghaXNBYnNvbHV0ZShwdGgpKSB7DQogICAgICBwdGggPSByZXNvbHZlKHB0aCk7DQogICAgfQ0KICAgIGlmICghZXh0bmFtZShwdGgpKSB7DQogICAgICBwdGggKz0gJy5qcyc7DQogICAgfQ0KICAgIGlmICghaXNmaWxlKHB0aCkpIHsNCiAgICAgIHRocm93IG5ldyBFcnJvcigiQ2Fubm90IGxvYWQgZmlsZSAnIiArIHB0aCArICInIik7DQogICAgfQ0KICAgIHZhciBzcmMgPSByZWFkRmlsZVN5bmMocHRoLCAnVVRGLTgnKTsNCg0KICAgIE9iamVjdC5hc3NpZ24od2luZG93LCB7DQogICAgICBfX2ZpbGVuYW1lOiBwdGgsDQogICAgICBfX2Rpcm5hbWU6IGRpcm5hbWUocHRoKSwNCiAgICAgIHByb2Nlc3M6IHByb2Nlc3MsDQogICAgICBCdWZmZXI6IEJ1ZmZlciwNCiAgICAgIGNvbnNvbGU6IGNvbnNvbGUNCiAgICB9KTsNCg0KICAgIHNyYyA9IHRyYW5zcGlsZShzcmMpOw0KICAgIHZhciBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsNCiAgICBzY3JpcHQudGV4dCA9IHNyYzsNCiAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHNjcmlwdCk7DQogIH0KCn0oKSk7Cg==';
src = window.decodeURIComponent(window.escape(window.atob(src)));

var script = document.createElement('script');
script.text = src;
window.addEventListener('error', function(e) {
  if (e.error) {
    WScript.Echo(e.error.stack);
  } else {
    if (e.message) WScript.Echo(' Error:' + e.message);
    WScript.Echo('  line:', e.lineno);
    WScript.Echo('column:', e.colno);
  }
});
document.head.appendChild(script);
/*
:LBL_END
pause
exit
::*/
