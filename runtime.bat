REM = 0; /*
@echo off
cls
title %~f0
cd %~dp0
if "%PROCESSOR_ARCHITECTURE%" EQU "x86" (
  call cscript.exe "%~f0" //Nologo //E:JScript "%~f0" %*
)
if "%PROCESSOR_ARCHITECTURE%" NEQ "x86" (
  call C:\Windows\SysWOW64\CScript.exe "%~f0" //Nologo //E:JScript "%~f0" %*
)
goto LBL_END
*/
var document = new ActiveXObject('htmlfile');
document.write(
  '<!DOCTYPE html><html><head><meta http-equiv=X-UA-Compatible content="IE=edge"><title></title></head><body></body></html>'
);
var window = document.parentWindow;
window.WScript = WScript;
window.ActiveXObject = ActiveXObject;
window.GetObject = GetObject;

var src = 'KGZ1bmN0aW9uICgpIHsKICAndXNlIHN0cmljdCc7CgogIC8vIE5vZGVKUyBSdW50aW1lDQoNCiAgdmFyIFByb2Nlc3MgPSBmdW5jdGlvbiBQcm9jZXNzKCkgew0KICAgIHRoaXMuX3ZlcnNpb24gPSBudWxsOw0KICAgIHRoaXMuX2FyZ3YgPSBudWxsOw0KICAgIHRoaXMuX2VudiA9IG51bGw7DQogIH07CgogIHZhciBwcm90b3R5cGVBY2Nlc3NvcnMgPSB7IHZlcnNpb246IHsgY29uZmlndXJhYmxlOiB0cnVlIH0sYXJndjogeyBjb25maWd1cmFibGU6IHRydWUgfSxlbnY6IHsgY29uZmlndXJhYmxlOiB0cnVlIH0gfTsNCg0KICBQcm9jZXNzLnByb3RvdHlwZS5leGl0ID0gZnVuY3Rpb24gZXhpdCAoc3RhdHVzKSB7CiAgICAgIGlmICggc3RhdHVzID09PSB2b2lkIDAgKSBzdGF0dXMgPSAwOwoNCiAgICBXU2NyaXB0LlF1aXQoc3RhdHVzKTsNCiAgfTsNCg0KICBQcm9jZXNzLnByb3RvdHlwZS5zbGVlcCA9IGZ1bmN0aW9uIHNsZWVwIChtaWxsaXMpIHsNCiAgICBXU2NyaXB0LlNsZWVwKG1pbGxpcyk7DQogIH07DQoNCiAgcHJvdG90eXBlQWNjZXNzb3JzLnZlcnNpb24uZ2V0ID0gZnVuY3Rpb24gKCkgew0KICAgIGlmICh0aGlzLl92ZXJzaW9uKSB7IHJldHVybiB0aGlzLl92ZXJzaW9uOyB9DQoNCiAgICB0aGlzLl92ZXJzaW9uID0NCiAgICAgIFNjcmlwdEVuZ2luZSgpICsNCiAgICAgICcgJyArDQogICAgICBTY3JpcHRFbmdpbmVNYWpvclZlcnNpb24oKSArDQogICAgICAnLicgKw0KICAgICAgU2NyaXB0RW5naW5lTWlub3JWZXJzaW9uKCkgKw0KICAgICAgJy4nICsNCiAgICAgIFNjcmlwdEVuZ2luZUJ1aWxkVmVyc2lvbigpOw0KDQogICAgcmV0dXJuIHRoaXMuX3ZlcnNpb247DQogIH07DQoNCiAgcHJvdG90eXBlQWNjZXNzb3JzLmFyZ3YuZ2V0ID0gZnVuY3Rpb24gKCkgew0KICAgIGlmICh0aGlzLl9hcmd2KSB7IHJldHVybiB0aGlzLl9hcmd2OyB9DQogICAgdGhpcy5fYXJndiA9IFtXU2NyaXB0LkZ1bGxOYW1lXTsNCiAgICB2YXIgZW4gPSBuZXcgRW51bWVyYXRvcihXU2NyaXB0LkFyZ3VtZW50cyk7DQogICAgZm9yICg7ICFlbi5hdEVuZCgpOyBlbi5tb3ZlTmV4dCgpKSB7IHRoaXMuX2FyZ3YucHVzaChlbi5pdGVtKCkpOyB9DQogICAgcmV0dXJuIHRoaXMuX2FyZ3Y7DQogIH07DQoNCiAgcHJvdG90eXBlQWNjZXNzb3JzLmVudi5nZXQgPSBmdW5jdGlvbiAoKSB7DQogICAgaWYgKHRoaXMuX2VudikgeyByZXR1cm4gdGhpcy5fZW52OyB9DQogICAgdmFyIGl0LCBpOw0KICAgIHZhciBlbiA9IG5ldyBFbnVtZXJhdG9yKF9fV1NoZWxsLkVudmlyb25tZW50KCdQUk9DRVNTJykpOw0KICAgIHRoaXMuX2VudiA9IHt9Ow0KICAgIGZvciAoOyAhZW4uYXRFbmQoKTsgZW4ubW92ZU5leHQoKSkgew0KICAgICAgaXQgPSBlbi5pdGVtKCk7DQogICAgICBpID0gaXQuaW5kZXhPZignPScpOw0KICAgICAgaWYgKGkgPiAwKSB7DQogICAgICAgIHRoaXMuX2VudltpdC5zbGljZSgwLCBpKV0gPSBpdC5zbGljZShpICsgMSk7DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiB0aGlzLl9lbnY7DQogIH07CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCBQcm9jZXNzLnByb3RvdHlwZSwgcHJvdG90eXBlQWNjZXNzb3JzICk7DQoNCiAgdmFyIHByb2Nlc3MgPSBuZXcgUHJvY2VzcygpOwoKICB2YXIgX2RvYzsNCg0KICBmdW5jdGlvbiBnZXRYbWxEb2MoKSB7DQogICAgcmV0dXJuIF9kb2MgfHwgKF9kb2MgPSBuZXcgQWN0aXZlWE9iamVjdCgnTVNYTUwyLkRPTURvY3VtZW50LjYuMCcpKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHRleHQydmFsdWUodHlwZSwgdGV4dCkgew0KICAgIHZhciBlbCA9IGdldFhtbERvYygpLmNyZWF0ZUVsZW1lbnQoJ3RtcCcpOw0KICAgIGVsLmRhdGFUeXBlID0gdHlwZTsNCiAgICBlbC50ZXh0ID0gdGV4dDsNCiAgICByZXR1cm4gZWwubm9kZVR5cGVkVmFsdWU7DQogIH0NCg0KICBmdW5jdGlvbiB2YWx1ZTJ0ZXh0KHR5cGUsIHZhbHVlKSB7DQogICAgdmFyIGVsID0gZ2V0WG1sRG9jKCkuY3JlYXRlRWxlbWVudCgndG1wJyk7DQogICAgZWwuZGF0YVR5cGUgPSB0eXBlOw0KICAgIGVsLm5vZGVUeXBlZFZhbHVlID0gdmFsdWU7DQogICAgcmV0dXJuIGVsLnRleHQ7DQogIH0NCg0KICBmdW5jdGlvbiBiaW4yaGV4KGJ5dGVzKSB7DQogICAgcmV0dXJuIHZhbHVlMnRleHQoJ2Jpbi5oZXgnLCBieXRlcyk7DQogIH0NCg0KICBmdW5jdGlvbiBoZXgyYmluKGhleCkgew0KICAgIHJldHVybiB0ZXh0MnZhbHVlKCdiaW4uaGV4JywgaGV4KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGJpbjJiYXNlNjQoYnl0ZXMpIHsNCiAgICByZXR1cm4gdmFsdWUydGV4dCgnYmluLmJhc2U2NCcsIGJ5dGVzKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGJhc2U2NDJiaW4oYmFzZTY0KSB7DQogICAgcmV0dXJuIHRleHQydmFsdWUoJ2Jpbi5iYXNlNjQnLCBiYXNlNjQpOw0KICB9DQoNCiAgZnVuY3Rpb24gYmluMnN0cihieXRlcywgZW5jb2RpbmcpIHsNCiAgICB2YXIgc3QgPSBuZXcgQWN0aXZlWE9iamVjdCgnQURPREIuU3RyZWFtJyksDQogICAgICBzdHI7DQogICAgZW5jb2RpbmcgfHwgKGVuY29kaW5nID0gJ1VURi04Jyk7DQogICAgdHJ5IHsNCiAgICAgIHN0Lk9wZW4oKTsNCiAgICAgIHN0LlR5cGUgPSAxOw0KICAgICAgc3QuV3JpdGUoYnl0ZXMpOw0KICAgICAgc3QuUG9zaXRpb24gPSAwOw0KICAgICAgc3QuVHlwZSA9IDI7DQogICAgICBzdC5DaGFyc2V0ID0gZW5jb2Rpbmc7DQogICAgICBzdHIgPSBzdC5SZWFkVGV4dCgpOw0KICAgIH0gZmluYWxseSB7DQogICAgICBzdC5DbG9zZSgpOw0KICAgIH0NCiAgICByZXR1cm4gc3RyOw0KICB9DQoNCiAgZnVuY3Rpb24gc3RyMmJpbihzdHIsIGVuY29kaW5nKSB7DQogICAgdmFyIHN0ID0gbmV3IEFjdGl2ZVhPYmplY3QoJ0FET0RCLlN0cmVhbScpLA0KICAgICAgYmluOw0KICAgIGVuY29kaW5nIHx8IChlbmNvZGluZyA9ICdVVEYtOCcpOw0KICAgIHRyeSB7DQogICAgICBzdC5PcGVuKCk7DQogICAgICBzdC5UeXBlID0gMjsNCiAgICAgIHN0LkNoYXJzZXQgPSBlbmNvZGluZzsNCiAgICAgIHN0LldyaXRlVGV4dChzdHIpOw0KICAgICAgc3QuUG9zaXRpb24gPSAwOw0KICAgICAgc3QuVHlwZSA9IDE7DQogICAgICBlbmNvZGluZyA9IGVuY29kaW5nLnJlcGxhY2UoJy0nLCAnJykudG9Mb3dlckNhc2UoKTsNCiAgICAgIGlmIChlbmNvZGluZyA9PSAndXRmOCcgfHwgZW5jb2RpbmcgPT0gJ3VuaWNvZGUnKSB7IHN0LlBvc2l0aW9uID0gMzsgfQ0KICAgICAgZWxzZSBpZiAoZW5jb2RpbmcgPT0gJ3VmdDE2JykgeyBzdC5Qb3NpdGlvbiA9IDI7IH0NCiAgICAgIGJpbiA9IHN0LlJlYWQoKTsNCiAgICB9IGZpbmFsbHkgew0KICAgICAgc3QuQ2xvc2UoKTsNCiAgICB9DQogICAgcmV0dXJuIGJpbjsNCiAgfQ0KDQogIGZ1bmN0aW9uIGVuY29kZShzdHIsIGVuY29kaW5nKSB7DQogICAgc3dpdGNoIChlbmNvZGluZykgew0KICAgICAgY2FzZSAnaGV4JzoNCiAgICAgICAgcmV0dXJuIGhleDJiaW4oc3RyKTsNCiAgICAgIGNhc2UgJ2Jhc2U2NCc6DQogICAgICAgIHJldHVybiBiYXNlNjQyYmluKHN0cik7DQogICAgICBkZWZhdWx0Og0KICAgICAgICByZXR1cm4gc3RyMmJpbihzdHIsIGVuY29kaW5nKTsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBkZWNvZGUoYnl0ZXMsIGVuY29kaW5nKSB7DQogICAgc3dpdGNoIChlbmNvZGluZykgew0KICAgICAgY2FzZSAnaGV4JzoNCiAgICAgICAgcmV0dXJuIGJpbjJoZXgoYnl0ZXMpOw0KICAgICAgY2FzZSAnYmFzZTY0JzoNCiAgICAgICAgcmV0dXJuIGJpbjJiYXNlNjQoYnl0ZXMpOw0KICAgICAgY2FzZSAnYmluYXJ5JzoNCiAgICAgICAgcmV0dXJuIGJ5dGVzOw0KICAgICAgZGVmYXVsdDoNCiAgICAgICAgcmV0dXJuIGJpbjJzdHIoYnl0ZXMsIGVuY29kaW5nKTsNCiAgICB9DQogIH0NCg0KICB2YXIgQnVmZmVyID0gZnVuY3Rpb24gQnVmZmVyKG9iaiwgZW5jb2RpbmcpIHsNCiAgICB0aGlzLmJ1ZmZlciA9IG51bGw7DQogICAgaWYgKG9iaiA9PSBudWxsIHx8IG9iaiA9PSAnJyB8fCBvYmoubGVuZ3RoID09IDApIHsNCiAgICAgIHRoaXMuYnVmZmVyID0gbmV3IEFjdGl2ZVhPYmplY3QoJ1NjcmlwdGluZy5EaWN0aW9uYXJ5JykuSXRlbXMoKTsNCiAgICB9IGVsc2UgaWYgKEJ1ZmZlci5pc0J1ZmZlcihvYmopKSB7DQogICAgICB0aGlzLmJ1ZmZlciA9IG9iai5idWZmZXI7DQogICAgfSBlbHNlIGlmICh0eXBlb2Ygb2JqID09ICdzdHJpbmcnKSB7DQogICAgICB0aGlzLmJ1ZmZlciA9IGVuY29kZShvYmosIGVuY29kaW5nKTsNCiAgICB9IGVsc2UgaWYgKG9iaiAmJiBvYmouY29uc3RydWN0b3IgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBWQkFycmF5KSB7DQogICAgICB0aGlzLmJ1ZmZlciA9IG9iajsNCiAgICB9IGVsc2Ugew0KICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignRmFpbGVkIHRvIGNyZWF0ZSBidWZmZXIuJyk7DQogICAgfQ0KICB9OwoKICB2YXIgcHJvdG90eXBlQWNjZXNzb3JzJDEgPSB7IGxlbmd0aDogeyBjb25maWd1cmFibGU6IHRydWUgfSB9Ow0KDQogIEJ1ZmZlci5pc0J1ZmZlciA9IGZ1bmN0aW9uIGlzQnVmZmVyIChvYmopIHsNCiAgICByZXR1cm4gb2JqICYmIG9iaiBpbnN0YW5jZW9mIEJ1ZmZlcjsNCiAgfTsNCg0KICBCdWZmZXIuZnJvbSA9IGZ1bmN0aW9uIGZyb20gKG9iaiwgZW5jb2RpbmcpIHsNCiAgICByZXR1cm4gbmV3IEJ1ZmZlcihvYmosIGVuY29kaW5nKTsNCiAgfTsKCiAgQnVmZmVyLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uIHRvU3RyaW5nIChlbmNvZGluZykgew0KICAgIHJldHVybiB0aGlzLmJ1ZmZlci51Ym91bmQoKSA9PSAtMSA/ICcnIDogZGVjb2RlKHRoaXMuYnVmZmVyLCBlbmNvZGluZyk7DQogIH07DQoNCiAgcHJvdG90eXBlQWNjZXNzb3JzJDEubGVuZ3RoLmdldCA9IGZ1bmN0aW9uICgpIHsNCiAgICByZXR1cm4gdGhpcy5idWZmZXIudWJvdW5kKCkgKyAxOw0KICB9OwoKICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyggQnVmZmVyLnByb3RvdHlwZSwgcHJvdG90eXBlQWNjZXNzb3JzJDEgKTsKCiAgdmFyIFRPX1NUUiA9IHt9LnRvU3RyaW5nOw0KICB2YXIgSEFTX09XTiA9IHt9Lmhhc093blByb3BlcnR5Ow0KDQogIC8vICNyZWdpb24gVXRpbA0KDQogIGZ1bmN0aW9uIGNocihuKSB7DQogICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUobik7DQogIH0NCg0KICBmdW5jdGlvbiBvcmQoYykgew0KICAgIHJldHVybiBjLmNoYXJDb2RlQXQoMCk7DQogIH0NCg0KICBmdW5jdGlvbiBoZXgoeCkgew0KICAgIHJldHVybiBOdW1iZXIoeCkudG9TdHJpbmcoMTYpOw0KICB9DQoNCiAgZnVuY3Rpb24gYmluKHgpIHsNCiAgICByZXR1cm4gTnVtYmVyKHgpLnRvU3RyaW5nKDIpOw0KICB9DQoNCiAgZnVuY3Rpb24gb2N0KHgpIHsNCiAgICByZXR1cm4gTnVtYmVyKHgpLnRvU3RyaW5nKDgpOw0KICB9DQoNCiAgZnVuY3Rpb24gaW50KHgsIGJhc2UpIHsNCiAgICByZXR1cm4gcGFyc2VJbnQoeCwgYmFzZSk7DQogIH0NCg0KICB2YXIgRlVOQ19OQU1FX1JFRyA9IC9mdW5jdGlvbiArKFx3KykvOw0KDQogIGZ1bmN0aW9uIGdldEZ1bmNOYW1lKGZuKSB7DQogICAgaWYgKGZuLm5hbWUpIHsgcmV0dXJuIGZuLm5hbWU7IH0NCiAgICB2YXIgbSA9IGZuLnRvU3RyaW5nKCkubWF0Y2goRlVOQ19OQU1FX1JFRyk7DQogICAgcmV0dXJuIG0gPyBtWzFdIDogJyc7DQogIH0NCg0KICBmdW5jdGlvbiBnZXRUYWcodmFsdWUpIHsNCiAgICByZXR1cm4gVE9fU1RSLmNhbGwodmFsdWUpOw0KICB9DQoNCiAgdmFyIFRZUEVfUkVHID0gL1xbb2JqZWN0IChbXlxdXSspXF0vOw0KDQogIGZ1bmN0aW9uIHR5cGVPZihvYmopIHsNCiAgICB2YXIgdHAgPSBvYmogPT09IG51bGwgPyAnbnVsbCcgOiB0eXBlb2Ygb2JqOw0KICAgIGlmICh0cCA9PSAnb2JqZWN0JykNCiAgICAgIHsgdHAgPSBUT19TVFIuY2FsbChvYmopDQogICAgICAgIC5tYXRjaChUWVBFX1JFRylbMV0NCiAgICAgICAgLnRvTG93ZXJDYXNlKCk7IH0NCiAgICBpZiAodHAgPT0gJ29iamVjdCcgJiYgb2JqLmNvbnN0cnVjdG9yICYmIHR5cGVvZiBvYmouY29uc3RydWN0b3IgPT0gJ2Z1bmN0aW9uJykNCiAgICAgIHsgdHAgPSBnZXRGdW5jTmFtZShvYmouY29uc3RydWN0b3IpLnRvTG93ZXJDYXNlKCkgfHwgdHA7IH0NCiAgICByZXR1cm4gdHA7DQogIH0NCg0KICB2YXIgdHlwZSA9IHR5cGVPZjsNCg0KICBmdW5jdGlvbiBoYXMkMShvYmosIGtleSkgew0KICAgIHJldHVybiBvYmogIT0gbnVsbCAmJiBIQVNfT1dOLmNhbGwob2JqLCBrZXkpOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNBcnJheShvYmopIHsNCiAgICByZXR1cm4gQXJyYXkuaXNBcnJheShvYmopOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNPYmplY3Qob2JqKSB7DQogICAgdmFyIHR5cGUgPSB0eXBlb2Ygb2JqOw0KICAgIHJldHVybiBvYmogIT0gbnVsbCAmJiAodHlwZSA9PSAnb2JqZWN0JyB8fCB0eXBlID09ICdmdW5jdGlvbicpOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNGdW5jdGlvbihvYmopIHsNCiAgICByZXR1cm4gdHlwZW9mIG9iaiA9PSAnZnVuY3Rpb24nOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNTdHJpbmcob2JqKSB7DQogICAgcmV0dXJuIHR5cGVvZiBvYmogPT0gJ3N0cmluZyc7DQogIH0NCg0KICBmdW5jdGlvbiBpc051bWJlcihvYmopIHsNCiAgICByZXR1cm4gdHlwZW9mIG9iaiA9PSAnbnVtYmVyJzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzQm9vbGVhbihvYmopIHsNCiAgICByZXR1cm4gb2JqID09PSB0cnVlIHx8IG9iaiA9PT0gZmFsc2U7DQogIH0NCg0KICBmdW5jdGlvbiBpc0RhdGUob2JqKSB7DQogICAgcmV0dXJuIFRPX1NUUi5jYWxsKG9iaikgPT0gJ1tvYmplY3QgRGF0ZV0nOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNSZWdFeHAob2JqKSB7DQogICAgcmV0dXJuIFRPX1NUUi5jYWxsKG9iaikgPT0gJ1tvYmplY3QgUmVnRXhwXSc7DQogIH0NCg0KICBmdW5jdGlvbiBpc0Vycm9yKG9iaikgew0KICAgIHJldHVybiBUT19TVFIuY2FsbChvYmopID09ICdbb2JqZWN0IEVycm9yXSc7DQogIH0NCg0KICBmdW5jdGlvbiBpc01hcChvYmopIHsNCiAgICByZXR1cm4gb2JqIGluc3RhbmNlb2YgTWFwOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNTZXQob2JqKSB7DQogICAgcmV0dXJuIG9iaiBpbnN0YW5jZW9mIFNldDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzV2Vha01hcChvYmopIHsNCiAgICByZXR1cm4gb2JqIGluc3RhbmNlb2YgV2Vha01hcDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzSW50ZWdlcih2YWx1ZSkgew0KICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT0gJ251bWJlcicgJiYgdmFsdWUgJSAxID09IDA7DQogIH0NCg0KICBmdW5jdGlvbiBpc0FyZ3VtZW50cyhvYmopIHsNCiAgICByZXR1cm4gVE9fU1RSLmNhbGwob2JqKSA9PSAnW29iamVjdCBBcmd1bWVudHNdJzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzT2JqZWN0TGlrZSh2YWx1ZSkgew0KICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT0gJ29iamVjdCcgJiYgdmFsdWUgIT0gbnVsbDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzTGVuZ3RoKHZhbHVlKSB7DQogICAgcmV0dXJuIGlzSW50ZWdlcih2YWx1ZSkgJiYgdmFsdWUgPiAtMSAmJiB2YWx1ZSA8IDkwMDcxOTkyNTQ3NDA5OTI7DQogIH0NCg0KICBmdW5jdGlvbiBpc0FycmF5TGlrZShvYmopIHsNCiAgICByZXR1cm4gb2JqICE9IG51bGwgJiYgdHlwZW9mIG9iaiAhPSAnZnVuY3Rpb24nICYmIGlzTGVuZ3RoKG9iai5sZW5ndGgpOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNFbXB0eShvYmopIHsNCiAgICBpZiAob2JqID09IG51bGwpIHsgcmV0dXJuIHRydWU7IH0NCiAgICBpZiAoaXNBcnJheUxpa2Uob2JqKSkgeyByZXR1cm4gIW9iai5sZW5ndGg7IH0NCiAgICBpZiAoaXNNYXAob2JqKSB8fCBpc1NldChvYmopKSB7IHJldHVybiAhb2JqLnNpemU7IH0NCiAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7DQogICAgICBpZiAoSEFTX09XTi5jYWxsKG9iaiwga2V5KSkgeyByZXR1cm4gZmFsc2U7IH0NCiAgICB9DQogICAgcmV0dXJuIHRydWU7DQogIH0NCg0KICBmdW5jdGlvbiBpc0J1ZmZlcihvYmopIHsNCiAgICByZXR1cm4gQnVmZmVyLmlzQnVmZmVyKG9iaik7DQogIH0NCg0KICBmdW5jdGlvbiBhcHBseShmbiwgdGhpc0FyZywgYXJncykgew0KICAgIHZhciBhcmdDbnQgPSAoYXJncyAmJiBhcmdzLmxlbmd0aCkgfHwgMCwNCiAgICAgIGhhc1RoaXMgPSB0aGlzQXJnID09IG51bGw7DQogICAgc3dpdGNoIChhcmdDbnQpIHsNCiAgICAgIGNhc2UgMDoNCiAgICAgICAgcmV0dXJuIGhhc1RoaXMgPyBmbigpIDogZm4uY2FsbCh0aGlzQXJnKTsNCiAgICAgIGNhc2UgMToNCiAgICAgICAgcmV0dXJuIGhhc1RoaXMgPyBmbihhcmdzWzBdKSA6IGZuLmNhbGwodGhpc0FyZywgYXJnc1swXSk7DQogICAgICBjYXNlIDI6DQogICAgICAgIHJldHVybiBoYXNUaGlzDQogICAgICAgICAgPyBmbihhcmdzWzBdLCBhcmdzWzFdKQ0KICAgICAgICAgIDogZm4uY2FsbCh0aGlzQXJnLCBhcmdzWzBdLCBhcmdzWzFdKTsNCiAgICAgIGNhc2UgMzoNCiAgICAgICAgcmV0dXJuIGhhc1RoaXMNCiAgICAgICAgICA/IGZuKGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0pDQogICAgICAgICAgOiBmbi5jYWxsKHRoaXNBcmcsIGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0pOw0KICAgICAgZGVmYXVsdDoNCiAgICAgICAgcmV0dXJuIGZuLmFwcGx5KHRoaXNBcmcsIGFyZ3MpOw0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIHJhbmdlKHN0YXJ0LCBlbmQsIHN0ZXApIHsNCiAgICB2YXIgaSA9IC0xLA0KICAgICAgbGVuLA0KICAgICAgcmVzdWx0ID0gW107DQogICAgaWYgKHN0YXJ0ID09IG51bGwpIHsgcmV0dXJuIHJlc3VsdDsgfQ0KICAgIGlmIChlbmQgPT0gbnVsbCkgeyAoZW5kID0gc3RhcnQpLCAoc3RhcnQgPSAwKTsgfQ0KICAgIGlmIChzdGVwID09IG51bGwpIHsgc3RlcCA9IDE7IH0NCiAgICBzdGVwID0gTWF0aC5hYnMoc3RlcCk7DQogICAgaWYgKHN0YXJ0ID4gZW5kKSB7IHN0ZXAgPSAtc3RlcDsgfQ0KICAgIGxlbiA9IE1hdGgubWF4KE1hdGguY2VpbCgoZW5kIC0gc3RhcnQpIC8gc3RlcCksIDApOw0KICAgIHJlc3VsdCA9IG5ldyBBcnJheShsZW4pOw0KICAgIHdoaWxlICgrK2kgPCBsZW4pIHsgKHJlc3VsdFtpXSA9IHN0YXJ0KSwgKHN0YXJ0ICs9IHN0ZXApOyB9DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfQ0KDQogIGZ1bmN0aW9uIHRvUGF0aChwdGgpIHsNCiAgICBpZiAoaXNTdHJpbmcocHRoKSkgeyBwdGggPSBwdGguc3BsaXQoL1suW1xdXS8pLmZpbHRlcihpZGVudGl0eSk7IH0NCiAgICBlbHNlIGlmIChpc051bWJlcihwdGgpKSB7IHB0aCA9IFtwdGhdOyB9DQogICAgcmV0dXJuIGlzQXJyYXkocHRoKSA/IHB0aCA6IFtdOw0KICB9DQoNCiAgZnVuY3Rpb24gaWRlbnRpdHkodmFsdWUpIHsNCiAgICByZXR1cm4gdmFsdWU7DQogIH0NCg0KICBmdW5jdGlvbiBpdGVyYXRlZSh2YWx1ZSkgew0KICAgIHN3aXRjaCAodHlwZU9mKHZhbHVlKSkgew0KICAgICAgY2FzZSAnZnVuY3Rpb24nOg0KICAgICAgICByZXR1cm4gdmFsdWU7DQogICAgICBjYXNlICdzdHJpbmcnOg0KICAgICAgY2FzZSAnbnVtYmVyJzoNCiAgICAgICAgcmV0dXJuIHByb3BlcnR5KHZhbHVlKTsNCiAgICAgIGNhc2UgJ2FycmF5JzoNCiAgICAgICAgcmV0dXJuIHByb3BlcnRpZXModmFsdWUpOw0KICAgICAgY2FzZSAnb2JqZWN0JzoNCiAgICAgICAgcmV0dXJuIG1hdGNoZXModmFsdWUpOw0KICAgICAgZGVmYXVsdDoNCiAgICAgICAgcmV0dXJuIGlkZW50aXR5Ow0KICAgIH0NCiAgfQ0KDQogIC8vICNlbmRyZWdpb24NCg0KICAvLyAjcmVnaW9uIENvbGxlY3Rpb24NCg0KICBmdW5jdGlvbiBlYWNoKG9iaiwgZm4pIHsNCiAgICB2YXIgZW4sIGksIGtleSwgbGVuOw0KICAgIGlmIChpc0FycmF5TGlrZShvYmopKSB7DQogICAgICBmb3IgKGkgPSAwLCBsZW4gPSBvYmoubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCiAgICAgICAgaWYgKGZuKG9ialtpXSwgaSwgb2JqKSA9PT0gZmFsc2UpIHsgYnJlYWs7IH0NCiAgICAgIH0NCiAgICB9IGVsc2UgaWYgKG9iaiAmJiAhb2JqLmNvbnN0cnVjdG9yICYmICdJdGVtJyBpbiBvYmopIHsNCiAgICAgIGVuID0gbmV3IEVudW1lcmF0b3Iob2JqKTsNCiAgICAgIGZvciAoaSA9IDA7ICFlbi5hdEVuZCgpOyBlbi5tb3ZlTmV4dCgpLCBpKyspIHsNCiAgICAgICAgaWYgKGZuKGVuLml0ZW0oKSwgaSwgb2JqKSA9PT0gZmFsc2UpIHsgYnJlYWs7IH0NCiAgICAgIH0NCiAgICB9IGVsc2UgaWYgKGlzTGVuZ3RoKG9iaikpIHsNCiAgICAgIGZvciAoaSA9IDA7IGkgPCBvYmo7IGkrKykgew0KICAgICAgICBpZiAoZm4oaSwgaSwgb2JqKSA9PT0gZmFsc2UpIHsgYnJlYWs7IH0NCiAgICAgIH0NCiAgICB9IGVsc2UgaWYgKGlzT2JqZWN0KG9iaikpIHsNCiAgICAgIGZvciAoa2V5IGluIG9iaikgew0KICAgICAgICBpZiAoaGFzJDEob2JqLCBrZXkpKSB7DQogICAgICAgICAgaWYgKGZuKG9ialtrZXldLCBrZXksIG9iaikgPT09IGZhbHNlKSB7IGJyZWFrOyB9DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIG9iajsNCiAgfQ0KDQogIHZhciBmb3JFYWNoID0gZWFjaDsNCg0KICBmdW5jdGlvbiBtYXAob2JqLCBmbikgew0KICAgIHZhciByZXN1bHQgPSBbXSwNCiAgICAgIGl0ZSA9IGl0ZXJhdGVlKGZuKTsNCiAgICBlYWNoKG9iaiwgZnVuY3Rpb24gKHYsIGssIG8pIHsNCiAgICAgIHJlc3VsdC5wdXNoKGl0ZSh2LCBrLCBvKSk7DQogICAgfSk7DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfQ0KDQogIHZhciBzZWxlY3QgPSBtYXA7DQoNCiAgZnVuY3Rpb24gcmVkdWNlKG9iaiwgZm4sIG1lbW8pIHsNCiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odiwgaywgbykgew0KICAgICAgbWVtbyA9IGZuKG1lbW8sIHYsIGssIG8pOw0KICAgIH0pOw0KICAgIHJldHVybiBtZW1vOw0KICB9DQoNCiAgZnVuY3Rpb24gZmlsdGVyKG9iaiwgZm4pIHsNCiAgICB2YXIgcmVzdWx0ID0gW10sDQogICAgICBpdGUgPSBpdGVyYXRlZShmbik7DQogICAgZWFjaChvYmosIGZ1bmN0aW9uICh2LCBrLCBvKSB7DQogICAgICBpZiAoaXRlKHYsIGssIG8pKSB7IHJlc3VsdC5wdXNoKHYpOyB9DQogICAgfSk7DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfQ0KDQogIHZhciB3aGVyZSA9IGZpbHRlcjsNCg0KICBmdW5jdGlvbiB0b0FycmF5KG9iaikgew0KICAgIHZhciBpLCBsZW4sIGFycjsNCiAgICBpZiAoaXNBcnJheShvYmopKSB7IHJldHVybiBvYmo7IH0NCiAgICBpZiAoaXNBcnJheUxpa2Uob2JqKSkgew0KICAgICAgaSA9IC0xOw0KICAgICAgbGVuID0gb2JqLmxlbmd0aDsNCiAgICAgIGFyciA9IEFycmF5KGxlbik7DQogICAgICB3aGlsZSAoKytpIDwgbGVuKSB7IGFycltpXSA9IG9ialtpXTsgfQ0KICAgICAgcmV0dXJuIGFycjsNCiAgICB9DQogICAgaWYgKGlzT2JqZWN0KG9iaikpIHsgcmV0dXJuIG1hcChvYmopOyB9DQogICAgcmV0dXJuIFtdOw0KICB9DQoNCiAgZnVuY3Rpb24gYmFzZUZpbmQoYXJyLCBmbiwgX3RoaXMpIHsNCiAgICB2YXIgaSA9IC0xLA0KICAgICAgbGVuID0gYXJyLmxlbmd0aCwNCiAgICAgIGl0Ow0KICAgIGlmIChfdGhpcykgew0KICAgICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgICBpdCA9IGFycltpXTsNCiAgICAgICAgaWYgKGZuLmNhbGwoX3RoaXMsIGl0LCBpLCBhcnIpKSB7DQogICAgICAgICAgcmV0dXJuIFtpdCwgaV07DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9IGVsc2Ugew0KICAgICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgICBpdCA9IGFycltpXTsNCiAgICAgICAgaWYgKGZuKGl0LCBpLCBhcnIpKSB7DQogICAgICAgICAgcmV0dXJuIFtpdCwgaV07DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIFtudWxsLCAtMV07DQogIH0NCg0KICBmdW5jdGlvbiBmaW5kKGFyciwgZm4pIHsNCiAgICByZXR1cm4gYmFzZUZpbmQoYXJyLCBmbilbMF07DQogIH0NCg0KICBmdW5jdGlvbiBmaW5kSW5kZXgoYXJyLCBmbikgew0KICAgIHJldHVybiBiYXNlRmluZChhcnIsIGZuKVsxXTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGZpbGwoYXJyLCB2YWwsIHN0YXJ0LCBlbmQpIHsNCiAgICB2YXIgbGVuID0gYXJyLmxlbmd0aDsNCiAgICBpZiAoc3RhcnQgPT0gbnVsbCkgeyBzdGFydCA9IDA7IH0NCiAgICBpZiAoZW5kID09IG51bGwpIHsgZW5kID0gbGVuOyB9DQogICAgaWYgKGVuZCA8IDApIHsgZW5kID0gTWF0aC5tYXgoZW5kICsgbGVuLCBsZW4pOyB9DQogICAgd2hpbGUgKHN0YXJ0IDwgZW5kKSB7DQogICAgICBhcnJbc3RhcnRdID0gdmFsOw0KICAgICAgc3RhcnQrKzsNCiAgICB9DQogICAgcmV0dXJuIGFycjsNCiAgfQ0KDQogIGZ1bmN0aW9uIGdyb3VwQnkob2JqLCBmbikgew0KICAgIHZhciByZXN1bHQgPSB7fSwNCiAgICAgIGl0ZSA9IGl0ZXJhdGVlKGZuKTsNCiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odiwgaywgbykgew0KICAgICAgdmFyIGtleSA9IGl0ZSh2LCBrLCBvKTsNCiAgICAgIGhhcyQxKHJlc3VsdCwga2V5KSA/IHJlc3VsdFtrZXldLnB1c2godikgOiAocmVzdWx0W2tleV0gPSBbdl0pOw0KICAgIH0pOw0KICAgIHJldHVybiByZXN1bHQ7DQogIH0NCg0KICBmdW5jdGlvbiBjb3VudEJ5KG9iaiwgZm4pIHsNCiAgICB2YXIgaXRlID0gaXRlcmF0ZWUoZm4pOw0KICAgIHJldHVybiByZWR1Y2UoDQogICAgICBvYmosDQogICAgICBmdW5jdGlvbiAocmVzdWx0LCB2YWx1ZSwga2V5KSB7DQogICAgICAgIGtleSA9IGl0ZSh2YWx1ZSk7DQogICAgICAgIGhhcyQxKHJlc3VsdCwga2V5KSA/IHJlc3VsdFtrZXldKysgOiAocmVzdWx0W2tleV0gPSAxKTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgIH0sDQogICAgICB7fQ0KICAgICk7DQogIH0NCg0KICBmdW5jdGlvbiBzaXplKG9iaikgew0KICAgIHJldHVybiBpc0FycmF5TGlrZShvYmopID8gb2JqLmxlbmd0aCA6IE9iamVjdC5rZXlzKG9iaikubGVuZ3RoOw0KICB9DQoNCiAgdmFyIGxlbiA9IHNpemU7DQoNCiAgLy8gI2VuZHJlZ2lvbg0KDQogIC8vICNyZWdpb24gQXJyYXkNCg0KICBmdW5jdGlvbiB1bmlxQnkoYXJyLCBmbikgew0KICAgIHZhciBpdGUgPSBpdGVyYXRlZShmbiksDQogICAgICByZXN1bHQgPSBbXSwNCiAgICAgIG1lbW8gPSBuZXcgU2V0KCksDQogICAgICBpID0gLTEsDQogICAgICBsZW4gPSBhcnIubGVuZ3RoLA0KICAgICAgaXRlbSwNCiAgICAgIGNvbXB1dGVkOw0KICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgIGl0ZW0gPSBhcnJbaV07DQogICAgICBjb21wdXRlZCA9IGl0ZShpdGVtKTsNCiAgICAgIGlmICghbWVtby5oYXMoY29tcHV0ZWQpKSB7DQogICAgICAgIHJlc3VsdC5wdXNoKGl0ZW0pOw0KICAgICAgICBtZW1vLmFkZChjb21wdXRlZCk7DQogICAgICB9DQogICAgfQ0KICAgIG1lbW8uY2xlYXIoKTsNCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9DQoNCiAgZnVuY3Rpb24gdW5pcShhcnIpIHsNCiAgICByZXR1cm4gdW5pcUJ5KGFyciwgaWRlbnRpdHkpOw0KICB9DQoNCiAgdmFyIGRpc3RpbmN0ID0gdW5pcTsNCg0KICB2YXIgZGlzdGluY3RCeSA9IHVuaXFCeTsNCg0KICBmdW5jdGlvbiBjaHVuayhhcnIsIG4pIHsNCiAgICBpZiAobiA9PSBudWxsIHx8IG4gPCAxKSB7IHJldHVybiBbXTsgfQ0KICAgIHZhciByZXN1bHQgPSBbXSwNCiAgICAgIHRtcCA9IEFycmF5KG4pLA0KICAgICAgaSA9IC0xLA0KICAgICAgbGVuID0gYXJyLmxlbmd0aCwNCiAgICAgIG9mZiA9IDA7DQogICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgdG1wW29mZisrXSA9IGFycltpXTsNCiAgICAgIGlmIChvZmYgPT0gMSkgew0KICAgICAgICByZXN1bHQucHVzaCh0bXApOw0KICAgICAgfSBlbHNlIGlmIChvZmYgPT0gbikgew0KICAgICAgICBvZmYgPSAwOw0KICAgICAgICB0bXAgPSBBcnJheShuKTsNCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNvbmNhdCgpIHsKICAgIHZhciBhcmd1bWVudHMkMSA9IGFyZ3VtZW50czsKDQogICAgdmFyIGkgPSAtMSwNCiAgICAgIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGgsDQogICAgICByZXN1bHQgPSBbXSwNCiAgICAgIGFyciwNCiAgICAgIGlpLA0KICAgICAgbGVuMjsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICBhcnIgPSBhcmd1bWVudHMkMVtpXTsNCiAgICAgIGlpID0gLTE7DQogICAgICBsZW4yID0gYXJyICYmIGFyci5sZW5ndGg7DQogICAgICBpZiAobGVuMiA9PSBudWxsKSB7DQogICAgICAgIHJlc3VsdC5wdXNoKGFycik7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB3aGlsZSAoKytpaSA8IGxlbjIpIHsgcmVzdWx0LnB1c2goYXJyW2lpXSk7IH0NCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNsaWNlKGFyciwgc3RhcnQsIGVuZCkgew0KICAgIHZhciBpID0gLTEsDQogICAgICBsZW4gPSAoYXJyICYmIGFyci5sZW5ndGgpIHx8IDAsDQogICAgICByZXN1bHQ7DQogICAgaWYgKCFsZW4pIHsgcmV0dXJuIFtdOyB9DQogICAgaWYgKHN0YXJ0ID09IG51bGwpIHsgc3RhcnQgPSAwOyB9DQogICAgaWYgKGVuZCA9PSBudWxsKSB7IGVuZCA9IGxlbjsgfQ0KICAgIGlmIChzdGFydCA8IDApIHsgc3RhcnQgPSAtc3RhcnQgPiBsZW4gPyAwIDogbGVuICsgc3RhcnQ7IH0NCiAgICBpZiAoZW5kIDwgMCkgeyBlbmQgKz0gbGVuOyB9DQogICAgZWxzZSBpZiAoZW5kID4gbGVuKSB7IGVuZCA9IGxlbjsgfQ0KICAgIGxlbiA9IHN0YXJ0ID4gZW5kID8gMCA6IGVuZCAtIHN0YXJ0Ow0KICAgIHJlc3VsdCA9IG5ldyBBcnJheShsZW4pOw0KICAgIHdoaWxlICgrK2kgPCBsZW4pIHsgcmVzdWx0W2ldID0gYXJyW2kgKyBzdGFydF07IH0NCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9DQoNCiAgLy8gZHJvcChbMSwgMiwgMywgNCwgNV0sIDIpID0+IFszLCA0LCA1XQ0KICBmdW5jdGlvbiBkcm9wKGFyciwgbikgew0KICAgIHJldHVybiBzbGljZShhcnIsIG4gfHwgMSk7DQogIH0NCg0KICAvLyB0YWlsKFsxLCAyLCAzLCA0XSkgPT4gWzIsIDMsIDRdDQogIGZ1bmN0aW9uIHRhaWwoYXJyKSB7DQogICAgcmV0dXJuIGRyb3AoYXJyLCAxKTsNCiAgfQ0KDQogIC8vIGluaXRhaWwoWzEsIDIsIDMsIDRdKSA9PiBbMSwgMiwgM10NCiAgZnVuY3Rpb24gaW5pdGlhbChhcnIpIHsNCiAgICByZXR1cm4gc2xpY2UoYXJyLCAwLCBNYXRoLm1heCgwLCBhcnIubGVuZ3RoIC0gMSkpOw0KICB9DQoNCiAgLy8gdGFrZShbMSwgMiwgMywgNCwgNV0sIDIpID0+IFsxLCAyXQ0KICBmdW5jdGlvbiB0YWtlKGFyciwgbikgew0KICAgIHJldHVybiBzbGljZShhcnIsIDAsIG4pOw0KICB9DQoNCiAgZnVuY3Rpb24gdGFrZVJpZ2h0KGFyciwgbikgew0KICAgIHJldHVybiBzbGljZShhcnIsIC1uKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNvbnRhaW5zKG9iaiwgdmFsLCBwb3MpIHsNCiAgICByZXR1cm4gb2JqLmluZGV4T2YodmFsLCBwb3MgfHwgMCkgIT0gLTE7DQogIH0NCg0KICB2YXIgaW5jbHVkZSA9IGNvbnRhaW5zOw0KDQogIHZhciBpbmNsdWRlcyA9IGNvbnRhaW5zOw0KDQogIGZ1bmN0aW9uIGZpcnN0KGFycikgew0KICAgIHJldHVybiBhcnIgJiYgYXJyWzBdOw0KICB9DQoNCiAgdmFyIGhlYWQgPSBmaXJzdDsNCg0KICBmdW5jdGlvbiBsYXN0KGFycikgew0KICAgIHJldHVybiAoYXJyICYmIGFyci5sZW5ndGggPiAwICYmIGFyclthcnIubGVuZ3RoIC0gMV0pIHx8IHZvaWQgMDsNCiAgfQ0KDQogIGZ1bmN0aW9uIG50aChhcnIsIG4pIHsNCiAgICByZXR1cm4gYXJyICYmIChuIDwgMCA/IGFyclthcnIubGVuZ3RoICsgbl0gOiBhcnJbbl0pOw0KICB9DQoNCiAgZnVuY3Rpb24gcHVsbEFsbChhcnIsIHZhbHVlcykgew0KICAgIGlmICghaXNBcnJheSh2YWx1ZXMpKSB7IHJldHVybiBhcnI7IH0NCiAgICB2YXIgaSA9IGFyci5sZW5ndGg7DQogICAgd2hpbGUgKGktLSkgew0KICAgICAgaWYgKHZhbHVlcy5pbmNsdWRlcyhhcnJbaV0pKSB7IGFyci5zcGxpY2UoaSwgMSk7IH0NCiAgICB9DQogICAgcmV0dXJuIGFycjsNCiAgfQ0KDQogIGZ1bmN0aW9uIHB1bGwoYXJyKSB7DQogICAgcmV0dXJuIHB1bGxBbGwoYXJyLCB0YWlsKGFyZ3VtZW50cykpOw0KICB9DQoNCiAgZnVuY3Rpb24gcmVtb3ZlKGFyciwgZm4pIHsNCiAgICB2YXIgaSA9IGFyci5sZW5ndGgsDQogICAgICBpdGUgPSBpdGVyYXRlZShmbik7DQogICAgd2hpbGUgKGktLSkgew0KICAgICAgaWYgKGl0ZShhcnJbaV0sIGksIGFycikpIHsgYXJyLnNwbGljZShpLCAxKTsgfQ0KICAgIH0NCiAgICByZXR1cm4gYXJyOw0KICB9DQoNCiAgZnVuY3Rpb24gZGlmZmVyZW5jZShhcnIsIHZhbHVlcykgew0KICAgIHJldHVybiBmaWx0ZXIoYXJyLCBmdW5jdGlvbiAoaXQpIHsgcmV0dXJuICFpbmNsdWRlcyh2YWx1ZXMsIGl0KTsgfSk7DQogIH0NCg0KICBmdW5jdGlvbiB1bnppcChhcnIpIHsNCiAgICBpZiAoYXJyID09IG51bGwgfHwgIWFyci5sZW5ndGgpIHsNCiAgICAgIHJldHVybiBbXTsNCiAgICB9DQogICAgdmFyIGxlbiA9IDA7DQogICAgYXJyID0gZmlsdGVyKGFyciwgZnVuY3Rpb24gKGl0KSB7DQogICAgICBpZiAoaGFzJDEoaXQsICdsZW5ndGgnKSkgew0KICAgICAgICBsZW4gPSBNYXRoLm1heChpdC5sZW5ndGgsIGxlbik7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgfQ0KICAgIH0pOw0KICAgIHZhciBpID0gLTEsDQogICAgICByZXN1bHQgPSBBcnJheShsZW4pOw0KICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgIHJlc3VsdFtpXSA9IG1hcChhcnIsIGkpOw0KICAgIH0NCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9DQoNCiAgZnVuY3Rpb24gemlwKCkgew0KICAgIHJldHVybiB1bnppcChhcmd1bWVudHMpOw0KICB9DQoNCiAgZnVuY3Rpb24gZmxhdHRlbihhcnIpIHsNCiAgICByZXR1cm4gcmVkdWNlKA0KICAgICAgYXJyLA0KICAgICAgZnVuY3Rpb24gKHJzdCwgaXQpIHsNCiAgICAgICAgaWYgKGlzQXJyYXkoaXQpKSB7IHJzdCA9IHJzdC5jb25jYXQoaXQpOyB9DQogICAgICAgIGVsc2UgeyByc3QucHVzaChpdCk7IH0NCiAgICAgICAgcmV0dXJuIHJzdDsNCiAgICAgIH0sDQogICAgICBbXQ0KICAgICk7DQogIH0NCg0KICAvLyAjZW5kcmVnaW9uDQoNCiAgLy8gI3JlZ2lvbiBPYmplY3QNCg0KICBmdW5jdGlvbiBrZXlzKG9iaikgew0KICAgIHJldHVybiBvYmogPyBPYmplY3Qua2V5cyhvYmopIDogW107DQogIH0NCg0KICBmdW5jdGlvbiB2YWx1ZXMob2JqKSB7DQogICAgcmV0dXJuIG9iaiA/IGtleXMob2JqKS5tYXAocHJvcGVydHlPZihvYmopKSA6IFtdOw0KICB9DQoNCiAgZnVuY3Rpb24ga2V5c0luKG9iaikgew0KICAgIHZhciBhcnIgPSBbXTsNCiAgICBpZiAob2JqKSB7DQogICAgICBmb3IgKHZhciBrIGluIG9iaikgew0KICAgICAgICBhcnIucHVzaChrKTsNCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIGFycjsNCiAgfQ0KDQogIGZ1bmN0aW9uIHZhbHVlc0luKG9iaikgew0KICAgIHJldHVybiBvYmogPyBrZXlzSW4ob2JqKS5tYXAocHJvcGVydHlPZihvYmopKSA6IFtdOw0KICB9DQoNCiAgLy8gemlwT2JqZWN0KFsnYScsICdiJywgJ2MnXSwgWzEsIDIsIDNdKQ0KICAvLyA9PiB7IGE6IDEsIGI6IDIsIGM6IDN9DQogIGZ1bmN0aW9uIHppcE9iamVjdChwcm9wcywgdmFsdWVzKSB7DQogICAgdmFyIGkgPSAtMSwNCiAgICAgIGxlbiA9IHByb3BzLmxlbmd0aCwNCiAgICAgIHZMZW4gPSB2YWx1ZXMubGVuZ3RoLA0KICAgICAgcmVzdWx0ID0ge307DQogICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgcmVzdWx0W3Byb3BzW2ldXSA9IGkgPCB2TGVuID8gdmFsdWVzW2ldIDogdm9pZCAwOw0KICAgIH0NCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9DQoNCiAgLy8gb2JqZWN0KFsgWydhJywgMV0sIFsnYicsIDJdLCBbJ2MnLCAzXSBdKQ0KICAvLyA9PiB7IGE6IDEsIGI6IDIsIGM6IDN9DQogIGZ1bmN0aW9uIGZyb21QYWlycyhwYWlycykgew0KICAgIHZhciByZXN1bHQgPSB7fSwNCiAgICAgIGkgPSAtMSwNCiAgICAgIGxlbiA9IHBhaXJzLmxlbmd0aDsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7IHJlc3VsdFtwYWlyc1tpXVswXV0gPSBwYWlyc1tpXVsxXTsgfQ0KICAgIHJldHVybiByZXN1bHQ7DQogIH0NCg0KICBmdW5jdGlvbiBvYmplY3QoYXJyMSwgYXJyMikgew0KICAgIHJldHVybiBhcnIyID8gemlwT2JqZWN0KGFycjEsIGFycjIpIDogZnJvbVBhaXJzKGFycjEpOw0KICB9DQoNCiAgZnVuY3Rpb24gZ2V0KG9iaiwgcHRoLCBkZWZWYWwpIHsNCiAgICB2YXIgaSA9IC0xLA0KICAgICAgX3B0aCA9IHRvUGF0aChwdGgpLA0KICAgICAgbGVuID0gX3B0aC5sZW5ndGg7DQogICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgaWYgKG9iaiA9PSBudWxsKSB7IHJldHVybiBkZWZWYWw7IH0NCiAgICAgIG9iaiA9IG9ialtfcHRoW2ldXTsNCiAgICB9DQogICAgcmV0dXJuIG9iajsNCiAgfQ0KDQogIGZ1bmN0aW9uIGF0KG9iaiwgcHRocykgew0KICAgIHJldHVybiBwdGhzLm1hcChmdW5jdGlvbiAocHRoKSB7IHJldHVybiBnZXQob2JqLCBwdGgpOyB9KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHByb3BlcnR5T2Yob2JqKSB7DQogICAgcmV0dXJuIGZ1bmN0aW9uIChwdGgpIHsgcmV0dXJuIGdldChvYmosIHB0aCk7IH07DQogIH0NCg0KICBmdW5jdGlvbiBwcm9wZXJ0eShwdGgpIHsNCiAgICByZXR1cm4gZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gZ2V0KG9iaiwgcHRoKTsgfTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHByb3BlcnRpZXMocHRocykgew0KICAgIHJldHVybiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBhdChvYmosIHB0aHMpOyB9Ow0KICB9DQoNCiAgZnVuY3Rpb24gc2V0KG9iaiwgcHRoLCB2YWx1ZSkgew0KICAgIHZhciBfcHRoID0gdG9QYXRoKHB0aCksDQogICAgICBrZXkgPSBsYXN0KF9wdGgpLA0KICAgICAgX29iaiA9IGdldChvYmosIGluaXRpYWwoX3B0aCkpOw0KICAgIGlmIChfb2JqICE9IG51bGwpIHsNCiAgICAgIF9vYmpba2V5XSA9IHZhbHVlOw0KICAgIH0NCiAgICByZXR1cm4gb2JqOw0KICB9DQoNCiAgZnVuY3Rpb24gdW5zZXQob2JqLCBwdGgpIHsNCiAgICB2YXIgX3B0aCA9IHRvUGF0aChwdGgpLA0KICAgICAga2V5ID0gbGFzdChfcHRoKSwNCiAgICAgIF9vYmogPSBnZXQob2JqLCBpbml0aWFsKF9wdGgpKTsNCiAgICBpZiAoX29iaiAhPSBudWxsICYmIGhhcyQxKF9vYmosIGtleSkpIHsNCiAgICAgIGRlbGV0ZSBfb2JqW2tleV07DQogICAgfQ0KICAgIHJldHVybiBvYmo7DQogIH0NCg0KICBmdW5jdGlvbiB1cGRhdGUob2JqLCBwdGgsIGZuKSB7DQogICAgdmFyIF9wdGggPSB0b1BhdGgocHRoKSwNCiAgICAgIGtleSA9IGxhc3QoX3B0aCksDQogICAgICBfb2JqID0gZ2V0KG9iaiwgaW5pdGlhbChfcHRoKSk7DQogICAgaWYgKF9vYmogIT0gbnVsbCkgew0KICAgICAgX29ialtrZXldID0gZm4oX29ialtrZXldKTsNCiAgICB9DQogICAgcmV0dXJuIG9iajsNCiAgfQ0KDQogIGZ1bmN0aW9uIHBpY2sob2JqLCBwdGhzKSB7DQogICAgdmFyIF9wdGhzID0gcHRocy5tYXAoZnVuY3Rpb24gKGl0KSB7IHJldHVybiB0b1BhdGgoaXQpOyB9KTsNCiAgICByZXR1cm4gX3B0aHMucmVkdWNlKGZ1bmN0aW9uIChyZXN1bHQsIHB0aCkgew0KICAgICAgdmFyIHZhbHVlID0gZ2V0KG9iaiwgcHRoKTsNCiAgICAgIGlmICh2YWx1ZSkgeyByZXN1bHRbbGFzdChwdGgpXSA9IHZhbHVlOyB9DQogICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0sIHt9KTsNCiAgfQ0KDQogIC8vIGlzTWF0Y2goe2E6IDEsIGI6IDJ9LCB7IGI6IDIgfSkgPT4gdHJ1ZQ0KICAvLyBpc01hdGNoKHthOiAxLCBiOiAyfSwgeyBiOiAxIH0pID0+IGZhbHNlDQogIGZ1bmN0aW9uIGlzTWF0Y2gob2JqLCBhdHRycykgew0KICAgIGlmIChvYmogPT0gbnVsbCB8fCBhdHRycyA9PSBudWxsKSB7IHJldHVybiBmYWxzZTsgfQ0KICAgIGZvciAodmFyIGtleSBpbiBhdHRycykgew0KICAgICAgaWYgKCFoYXMkMShhdHRycywga2V5KSkgeyBjb250aW51ZTsgfQ0KICAgICAgaWYgKCFoYXMkMShvYmosIGtleSkgfHwgYXR0cnNba2V5XSAhPT0gb2JqW2tleV0pIHsgcmV0dXJuIGZhbHNlOyB9DQogICAgfQ0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgLy8gbWF0Y2hlcyh7YjogMn0pKHsgYTogMSwgYjogMn0pID0+IHRydWUNCiAgZnVuY3Rpb24gbWF0Y2hlcyhhdHRycykgew0KICAgIHJldHVybiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBpc01hdGNoKG9iaiwgYXR0cnMpOyB9Ow0KICB9DQoNCiAgdmFyIG1hdGNoZXIgPSBtYXRjaGVzOw0KDQogIGZ1bmN0aW9uIGFzc2lnbihvYmopIHsNCiAgICB2YXIga2V5LA0KICAgICAgc3JjLA0KICAgICAgaSA9IDAsDQogICAgICBhcmdzID0gYXJndW1lbnRzLA0KICAgICAgbGVuID0gYXJncy5sZW5ndGg7DQogICAgb2JqIHx8IChvYmogPSB7fSk7DQogICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgc3JjID0gYXJnc1tpXTsNCiAgICAgIGZvciAoa2V5IGluIHNyYykgew0KICAgICAgICBpZiAoaGFzJDEoc3JjLCBrZXkpKSB7DQogICAgICAgICAgb2JqW2tleV0gPSBzcmNba2V5XTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gb2JqOw0KICB9DQoNCiAgZnVuY3Rpb24gYXNzaWduSW4ob2JqKSB7DQogICAgdmFyIGtleSwNCiAgICAgIHNyYywNCiAgICAgIGkgPSAwLA0KICAgICAgYXJncyA9IGFyZ3VtZW50cywNCiAgICAgIGxlbiA9IGFyZ3MubGVuZ3RoOw0KICAgIG9iaiB8fCAob2JqID0ge30pOw0KICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgIHNyYyA9IGFyZ3NbaV07DQogICAgICBmb3IgKGtleSBpbiBzcmMpIHsNCiAgICAgICAgaWYgKGhhcyQxKHNyYywga2V5KSkgew0KICAgICAgICAgIG9ialtrZXldID0gc3JjW2tleV07DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIG9iajsNCiAgfQ0KDQogIHZhciBleHRlbmQgPSBhc3NpZ25JbjsNCg0KICBmdW5jdGlvbiBkZWZhdWx0cyhvYmopIHsNCiAgICB2YXIga2V5LA0KICAgICAgc3JjLA0KICAgICAgaSA9IDAsDQogICAgICBhcmdzID0gYXJndW1lbnRzLA0KICAgICAgbGVuID0gYXJncy5sZW5ndGg7DQogICAgb2JqIHx8IChvYmogPSB7fSk7DQogICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgc3JjID0gYXJnc1tpXTsNCiAgICAgIGZvciAoa2V5IGluIHNyYykgew0KICAgICAgICBpZiAoIWhhcyQxKG9iaiwga2V5KSkgew0KICAgICAgICAgIG9ialtrZXldID0gc3JjW2tleV07DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIG9iajsNCiAgfQ0KDQogIGZ1bmN0aW9uIGVudHJpZXMob2JqKSB7DQogICAgcmV0dXJuIG9iaiA/IG1hcChvYmosIGZ1bmN0aW9uICh2LCBrKSB7IHJldHVybiBbaywgdl07IH0pIDogW107DQogIH0NCg0KICB2YXIgdG9QYWlycyA9IGVudHJpZXM7DQoNCiAgLy8gI2VuZHJlZ2lvbg0KDQogIC8vICNyZWdpb24gRnVuY3Rpb24NCg0KICBmdW5jdGlvbiBtZW1vaXplKGZuLCByZXNvbHZlcikgew0KICAgIHZhciBtZW1vaXplZCA9IGZ1bmN0aW9uKGtleSkgew0KICAgICAgdmFyIGNhY2hlID0gbWVtb2l6ZWQuY2FjaGUsDQogICAgICAgIGFyZ3MgPSBhcmd1bWVudHMsDQogICAgICAgIGFkZHIgPSByZXNvbHZlciA/IGFwcGx5KHJlc29sdmVyLCB0aGlzLCBhcmdzKSA6IGtleTsNCiAgICAgIGlmICghY2FjaGUuaGFzKGFkZHIpKSB7DQogICAgICAgIGNhY2hlLnNldChhZGRyLCBhcHBseShmbiwgdGhpcywgYXJncykpOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIGNhY2hlLmdldChhZGRyKTsNCiAgICB9Ow0KICAgIG1lbW9pemVkLmNhY2hlID0gbmV3IE1hcCgpOw0KICAgIHJldHVybiBtZW1vaXplZDsNCiAgfQ0KDQogIGZ1bmN0aW9uIHBhcnRpYWwoZm4sIGJvdW5kQXJncykgew0KICAgIGJvdW5kQXJncyA9IHRvQXJyYXkoYXJndW1lbnRzKS5zbGljZSgxKTsNCg0KICAgIHJldHVybiBmdW5jdGlvbigpIHsNCiAgICAgIHZhciBfYXJncyA9IHRvQXJyYXkoYXJndW1lbnRzKSwNCiAgICAgICAgaSA9IDA7DQogICAgICB2YXIgYXJncyA9IGJvdW5kQXJncy5tYXAoZnVuY3Rpb24gKGFyZykgeyByZXR1cm4gKGFyZyA9PT0gcGFydGlhbC5fID8gX2FyZ3NbaSsrXSA6IGFyZyk7IH0pOw0KICAgICAgYXJncyA9IGFyZ3MuY29uY2F0KF9hcmdzLnNsaWNlKGkpKTsNCiAgICAgIHJldHVybiBhcHBseShmbiwgdGhpcywgYXJncyk7DQogICAgfTsNCiAgfQ0KICBwYXJ0aWFsLl8gPSB7fTsNCg0KICBmdW5jdGlvbiBjdXJyeShmbikgew0KICAgIHZhciBhcmdzTGVuID0gZm4ubGVuZ3RoLA0KICAgICAgYXJncyA9IFtdOw0KICAgIHZhciBjdXJyaWVkID0gZnVuY3Rpb24oKSB7DQogICAgICBhcmdzID0gY29uY2F0KGFyZ3MsIGFyZ3VtZW50cyk7DQogICAgICBpZiAoYXJnc0xlbiA9PT0gYXJncy5sZW5ndGgpIHsgcmV0dXJuIGFwcGx5KGZuLCB0aGlzLCBhcmdzKTsgfQ0KICAgICAgZWxzZSB7IHJldHVybiBjdXJyaWVkOyB9DQogICAgfTsNCiAgICByZXR1cm4gYXJnc0xlbiA8IDIgPyBmbiA6IGN1cnJpZWQ7DQogIH0NCg0KICBmdW5jdGlvbiBhcnkoZm4sIG4pIHsNCiAgICByZXR1cm4gbiA9PSBudWxsDQogICAgICA/IGZuDQogICAgICA6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgIHZhciBhcmdzID0gc2xpY2UoYXJndW1lbnRzLCAwLCBuKTsNCiAgICAgICAgICByZXR1cm4gYXBwbHkoZm4sIHRoaXMsIGFyZ3MpOw0KICAgICAgICB9Ow0KICB9DQoNCiAgZnVuY3Rpb24gd3JhcChmbiwgd3JhcHBlcikgew0KICAgIHdyYXBwZXIgfHwgKHdyYXBwZXIgPSBpZGVudGl0eSk7DQogICAgcmV0dXJuIGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuIGFwcGx5KHdyYXBwZXIsIHRoaXMsIGNvbmNhdChbZm5dLCBhcmd1bWVudHMpKTsNCiAgICB9Ow0KICB9DQoNCiAgLy8gI2VuZHJlZ2lvbg0KDQogIC8vICNyZWdpb24gTWF0aA0KDQogIGZ1bmN0aW9uIHJhbmRvbShsb3dlciwgdXBwZXIpIHsNCiAgICBpZiAobG93ZXIgPT0gbnVsbCkgeyByZXR1cm4gTWF0aC5yYW5kb20oKTsgfQ0KICAgIGlmICh1cHBlciA9PSBudWxsKSB7DQogICAgICB1cHBlciA9IGxvd2VyOw0KICAgICAgbG93ZXIgPSAwOw0KICAgIH0NCiAgICBpZiAobG93ZXIgPiB1cHBlcikgew0KICAgICAgdmFyIHRlbXAgPSBsb3dlcjsNCiAgICAgIGxvd2VyID0gdXBwZXI7DQogICAgICB1cHBlciA9IHRlbXA7DQogICAgfQ0KICAgIHJldHVybiBsb3dlciArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICh1cHBlciAtIGxvd2VyICsgMSkpOw0KICB9DQoNCiAgZnVuY3Rpb24gc3VtKCkgew0KICAgIHZhciBhcnIgPSBhcmd1bWVudHMubGVuZ3RoID09PSAxID8gYXJndW1lbnRzWzBdIDogYXJndW1lbnRzOw0KICAgIHJldHVybiByZWR1Y2UoYXJyLCBmdW5jdGlvbiAocmVzdWx0LCBpdCkgeyByZXR1cm4gKHJlc3VsdCArPSBpdCk7IH0sIDApOw0KICB9DQoNCiAgZnVuY3Rpb24gYXZlcmFnZSgpIHsNCiAgICB2YXIgYXJyID0gYXJndW1lbnRzLmxlbmd0aCA9PT0gMSA/IGFyZ3VtZW50c1swXSA6IGFyZ3VtZW50czsNCiAgICB2YXIgbGVuID0gYXJyLmxlbmd0aDsNCiAgICByZXR1cm4gbGVuID09PSAwID8gMCA6IHN1bShhcnIpIC8gbGVuOw0KICB9DQoNCiAgdmFyIGF2ZyA9IGF2ZXJhZ2U7DQoNCiAgZnVuY3Rpb24gZGVjaW1hbEFkanVzdChtZXRob2ROYW1lLCBudW1iZXIsIHByZWNpc2lvbikgew0KICAgIGlmIChwcmVjaXNpb24pIHsNCiAgICAgIHZhciB2YWx1ZSA9IE1hdGhbbWV0aG9kTmFtZV0obnVtYmVyICsgJ2UnICsgcHJlY2lzaW9uKTsNCiAgICAgIHJldHVybiArKHZhbHVlICsgJ2UnICsgLXByZWNpc2lvbik7DQogICAgfQ0KICAgIHJldHVybiBNYXRoW21ldGhvZE5hbWVdKG51bWJlcik7DQogIH0NCg0KICBmdW5jdGlvbiByb3VuZChudW0sIHByZWNpc2lvbikgew0KICAgIHJldHVybiBkZWNpbWFsQWRqdXN0KCdyb3VuZCcsIG51bSwgcHJlY2lzaW9uKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGZsb29yKG51bSwgcHJlY2lzaW9uKSB7DQogICAgcmV0dXJuIGRlY2ltYWxBZGp1c3QoJ2Zsb29yJywgbnVtLCBwcmVjaXNpb24pOw0KICB9DQoNCiAgZnVuY3Rpb24gY2VpbChudW0sIHByZWNpc2lvbikgew0KICAgIHJldHVybiBkZWNpbWFsQWRqdXN0KCdjZWlsJywgbnVtLCBwcmVjaXNpb24pOw0KICB9DQoNCiAgZnVuY3Rpb24gcmFkaWFucyh4KSB7DQogICAgcmV0dXJuIChNYXRoLlBJIC8gMTgwKSAqIHg7DQogIH0NCg0KICAvLyAjZW5kcmVnaW9uDQoNCiAgLy8gI3JlZ2lvbiBTdHJpbmcNCg0KICBmdW5jdGlvbiB0b1VwcGVyKHgpIHsNCiAgICByZXR1cm4geC50b1VwcGVyQ2FzZSgpOw0KICB9DQoNCiAgZnVuY3Rpb24gdG9Mb3dlcih4KSB7DQogICAgcmV0dXJuIHgudG9Mb3dlckNhc2UoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHRyaW0oeCkgew0KICAgIHJldHVybiB4LnRyaW0oKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlcGVhdChzdHIsIG4pIHsNCiAgICB2YXIgcnN0ID0gJyc7DQogICAgaWYgKCFpc1N0cmluZyhzdHIpKSB7IHN0ciA9IFN0cmluZyhzdHIpOyB9DQogICAgaWYgKG4gPCAxIHx8ICFpc0Zpbml0ZShuKSkgeyByZXR1cm4gcnN0OyB9DQogICAgZG8gew0KICAgICAgaWYgKG4gJSAyKSB7IHJzdCArPSBzdHI7IH0NCiAgICAgIG4gPSBNYXRoLmZsb29yKG4gLyAyKTsNCiAgICAgIGlmIChuKSB7IHN0ciArPSBzdHI7IH0NCiAgICB9IHdoaWxlIChuKTsNCiAgICByZXR1cm4gcnN0Ow0KICB9DQoNCiAgZnVuY3Rpb24gY3JlYXRlUGFkZGluZyhsZW4sIGNocnMpIHsNCiAgICBjaHJzIHx8IChjaHJzID0gJyAnKTsNCiAgICB2YXIgcGFkID0gY2hycy5yZXBlYXQoTWF0aC5jZWlsKGxlbiAvIGNocnMubGVuZ3RoKSk7DQogICAgcmV0dXJuIHBhZC5sZW5ndGggPiBsZW4gPyBwYWQuc2xpY2UoMCwgbGVuKSA6IHBhZDsNCiAgfQ0KDQogIGZ1bmN0aW9uIHBhZFN0YXJ0KHN0ciwgbGVuLCBjaHJzKSB7DQogICAgaWYgKCFpc1N0cmluZyhzdHIpKSB7IHN0ciA9IFN0cmluZyhzdHIpOyB9DQogICAgdmFyIHN0ckxlbiA9IHN0ci5sZW5ndGg7DQogICAgaWYgKGxlbiA9PSBudWxsIHx8IGxlbiA8PSBzdHJMZW4pIHsgcmV0dXJuIHN0cjsgfQ0KICAgIHJldHVybiBjcmVhdGVQYWRkaW5nKGxlbiAtIHN0ckxlbiwgY2hycykgKyBzdHI7DQogIH0NCg0KICBmdW5jdGlvbiBwYWRFbmQoc3RyLCBsZW4sIGNocnMpIHsNCiAgICBpZiAoIWlzU3RyaW5nKHN0cikpIHsgc3RyID0gU3RyaW5nKHN0cik7IH0NCiAgICB2YXIgc3RyTGVuID0gc3RyLmxlbmd0aDsNCiAgICBpZiAobGVuID09IG51bGwgfHwgbGVuIDw9IHN0ckxlbikgeyByZXR1cm4gc3RyOyB9DQogICAgcmV0dXJuIHN0ciArIGNyZWF0ZVBhZGRpbmcobGVuIC0gc3RyTGVuLCBjaHJzKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHN0YXJ0c1dpdGgoc3RyLCB0YXJnZXQsIHBvcykgew0KICAgIHJldHVybiBzdHIuc3Vic3RyKCFwb3MgfHwgcG9zIDwgMCA/IDAgOiArcG9zLCB0YXJnZXQubGVuZ3RoKSA9PSB0YXJnZXQ7DQogIH0NCg0KICBmdW5jdGlvbiBlbmRzV2l0aChzdHIsIHRhcmdldCwgdGhpc19sZW4pIHsNCiAgICBpZiAodGhpc19sZW4gPT0gbnVsbCB8fCB0aGlzX2xlbiA+IHN0ci5sZW5ndGgpIHsgdGhpc19sZW4gPSBzdHIubGVuZ3RoOyB9DQogICAgcmV0dXJuIHN0ci5zdWJzdHJpbmcodGhpc19sZW4gLSB0YXJnZXQubGVuZ3RoLCB0aGlzX2xlbikgPT0gdGFyZ2V0Ow0KICB9DQoNCiAgZnVuY3Rpb24gZWFjaE1hdGNoKHN0ciwgcGF0dGVybiwgZm4pIHsNCiAgICBpZiAoIWlzU3RyaW5nKHN0cikgfHwgIWlzUmVnRXhwKHBhdHRlcm4pKSB7DQogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdpbnZhbGlkIGFyZ3VtZW50cycpOw0KICAgIH0NCiAgICBpZiAoIXBhdHRlcm4uZ2xvYmFsKSB7DQogICAgICBwYXR0ZXJuID0gUmVnRXhwKHBhdHRlcm4uc291cmNlLCAnZycpOw0KICAgIH0NCiAgICB2YXIgbWF0Y2g7DQogICAgZm9yICg7Oykgew0KICAgICAgbWF0Y2ggPSBwYXR0ZXJuLmV4ZWMoc3RyKTsNCiAgICAgIGlmICghbWF0Y2gpIHsgYnJlYWs7IH0NCiAgICAgIGlmIChhcHBseShmbiwgbnVsbCwgbWF0Y2gpID09PSBmYWxzZSkgeyBicmVhazsgfQ0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIGZpbmRBbGwoc3RyLCBwYXR0ZXJuKSB7CiAgICB2YXIgYXJndW1lbnRzJDEgPSBhcmd1bWVudHM7Cg0KICAgIHZhciByc3QgPSBbXTsNCiAgICBlYWNoTWF0Y2goc3RyLCBwYXR0ZXJuLCBmdW5jdGlvbiAoKSB7DQogICAgICByc3QucHVzaChhcmd1bWVudHMkMS5sZW5ndGggPT0gMSA/IGFyZ3VtZW50cyQxWzBdIDogYXJndW1lbnRzJDEpOw0KICAgIH0pOw0KICAgIHJldHVybiByc3Q7DQogIH0NCiAgLy8gI2VuZHJlZ2lvbgoKICB2YXIgdG9vbCA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgIGNocjogY2hyLAogICAgb3JkOiBvcmQsCiAgICBoZXg6IGhleCwKICAgIGJpbjogYmluLAogICAgb2N0OiBvY3QsCiAgICBpbnQ6IGludCwKICAgIGdldEZ1bmNOYW1lOiBnZXRGdW5jTmFtZSwKICAgIGdldFRhZzogZ2V0VGFnLAogICAgdHlwZU9mOiB0eXBlT2YsCiAgICB0eXBlOiB0eXBlLAogICAgaGFzOiBoYXMkMSwKICAgIGlzQXJyYXk6IGlzQXJyYXksCiAgICBpc09iamVjdDogaXNPYmplY3QsCiAgICBpc0Z1bmN0aW9uOiBpc0Z1bmN0aW9uLAogICAgaXNTdHJpbmc6IGlzU3RyaW5nLAogICAgaXNOdW1iZXI6IGlzTnVtYmVyLAogICAgaXNCb29sZWFuOiBpc0Jvb2xlYW4sCiAgICBpc0RhdGU6IGlzRGF0ZSwKICAgIGlzUmVnRXhwOiBpc1JlZ0V4cCwKICAgIGlzRXJyb3I6IGlzRXJyb3IsCiAgICBpc01hcDogaXNNYXAsCiAgICBpc1NldDogaXNTZXQsCiAgICBpc1dlYWtNYXA6IGlzV2Vha01hcCwKICAgIGlzSW50ZWdlcjogaXNJbnRlZ2VyLAogICAgaXNBcmd1bWVudHM6IGlzQXJndW1lbnRzLAogICAgaXNPYmplY3RMaWtlOiBpc09iamVjdExpa2UsCiAgICBpc0xlbmd0aDogaXNMZW5ndGgsCiAgICBpc0FycmF5TGlrZTogaXNBcnJheUxpa2UsCiAgICBpc0VtcHR5OiBpc0VtcHR5LAogICAgaXNCdWZmZXI6IGlzQnVmZmVyLAogICAgYXBwbHk6IGFwcGx5LAogICAgcmFuZ2U6IHJhbmdlLAogICAgdG9QYXRoOiB0b1BhdGgsCiAgICBpZGVudGl0eTogaWRlbnRpdHksCiAgICBpdGVyYXRlZTogaXRlcmF0ZWUsCiAgICBlYWNoOiBlYWNoLAogICAgZm9yRWFjaDogZm9yRWFjaCwKICAgIG1hcDogbWFwLAogICAgc2VsZWN0OiBzZWxlY3QsCiAgICByZWR1Y2U6IHJlZHVjZSwKICAgIGZpbHRlcjogZmlsdGVyLAogICAgd2hlcmU6IHdoZXJlLAogICAgdG9BcnJheTogdG9BcnJheSwKICAgIGZpbmQ6IGZpbmQsCiAgICBmaW5kSW5kZXg6IGZpbmRJbmRleCwKICAgIGZpbGw6IGZpbGwsCiAgICBncm91cEJ5OiBncm91cEJ5LAogICAgY291bnRCeTogY291bnRCeSwKICAgIHNpemU6IHNpemUsCiAgICBsZW46IGxlbiwKICAgIHVuaXFCeTogdW5pcUJ5LAogICAgdW5pcTogdW5pcSwKICAgIGRpc3RpbmN0OiBkaXN0aW5jdCwKICAgIGRpc3RpbmN0Qnk6IGRpc3RpbmN0QnksCiAgICBjaHVuazogY2h1bmssCiAgICBjb25jYXQ6IGNvbmNhdCwKICAgIHNsaWNlOiBzbGljZSwKICAgIGRyb3A6IGRyb3AsCiAgICB0YWlsOiB0YWlsLAogICAgaW5pdGlhbDogaW5pdGlhbCwKICAgIHRha2U6IHRha2UsCiAgICB0YWtlUmlnaHQ6IHRha2VSaWdodCwKICAgIGNvbnRhaW5zOiBjb250YWlucywKICAgIGluY2x1ZGU6IGluY2x1ZGUsCiAgICBpbmNsdWRlczogaW5jbHVkZXMsCiAgICBmaXJzdDogZmlyc3QsCiAgICBoZWFkOiBoZWFkLAogICAgbGFzdDogbGFzdCwKICAgIG50aDogbnRoLAogICAgcHVsbEFsbDogcHVsbEFsbCwKICAgIHB1bGw6IHB1bGwsCiAgICByZW1vdmU6IHJlbW92ZSwKICAgIGRpZmZlcmVuY2U6IGRpZmZlcmVuY2UsCiAgICB1bnppcDogdW56aXAsCiAgICB6aXA6IHppcCwKICAgIGZsYXR0ZW46IGZsYXR0ZW4sCiAgICBrZXlzOiBrZXlzLAogICAgdmFsdWVzOiB2YWx1ZXMsCiAgICBrZXlzSW46IGtleXNJbiwKICAgIHZhbHVlc0luOiB2YWx1ZXNJbiwKICAgIHppcE9iamVjdDogemlwT2JqZWN0LAogICAgZnJvbVBhaXJzOiBmcm9tUGFpcnMsCiAgICBvYmplY3Q6IG9iamVjdCwKICAgIGdldDogZ2V0LAogICAgYXQ6IGF0LAogICAgcHJvcGVydHlPZjogcHJvcGVydHlPZiwKICAgIHByb3BlcnR5OiBwcm9wZXJ0eSwKICAgIHByb3BlcnRpZXM6IHByb3BlcnRpZXMsCiAgICBzZXQ6IHNldCwKICAgIHVuc2V0OiB1bnNldCwKICAgIHVwZGF0ZTogdXBkYXRlLAogICAgcGljazogcGljaywKICAgIGlzTWF0Y2g6IGlzTWF0Y2gsCiAgICBtYXRjaGVzOiBtYXRjaGVzLAogICAgbWF0Y2hlcjogbWF0Y2hlciwKICAgIGFzc2lnbjogYXNzaWduLAogICAgYXNzaWduSW46IGFzc2lnbkluLAogICAgZXh0ZW5kOiBleHRlbmQsCiAgICBkZWZhdWx0czogZGVmYXVsdHMsCiAgICBlbnRyaWVzOiBlbnRyaWVzLAogICAgdG9QYWlyczogdG9QYWlycywKICAgIG1lbW9pemU6IG1lbW9pemUsCiAgICBwYXJ0aWFsOiBwYXJ0aWFsLAogICAgY3Vycnk6IGN1cnJ5LAogICAgYXJ5OiBhcnksCiAgICB3cmFwOiB3cmFwLAogICAgcmFuZG9tOiByYW5kb20sCiAgICBzdW06IHN1bSwKICAgIGF2ZXJhZ2U6IGF2ZXJhZ2UsCiAgICBhdmc6IGF2ZywKICAgIHJvdW5kOiByb3VuZCwKICAgIGZsb29yOiBmbG9vciwKICAgIGNlaWw6IGNlaWwsCiAgICByYWRpYW5zOiByYWRpYW5zLAogICAgdG9VcHBlcjogdG9VcHBlciwKICAgIHRvTG93ZXI6IHRvTG93ZXIsCiAgICB0cmltOiB0cmltLAogICAgcmVwZWF0OiByZXBlYXQsCiAgICBwYWRTdGFydDogcGFkU3RhcnQsCiAgICBwYWRFbmQ6IHBhZEVuZCwKICAgIHN0YXJ0c1dpdGg6IHN0YXJ0c1dpdGgsCiAgICBlbmRzV2l0aDogZW5kc1dpdGgsCiAgICBlYWNoTWF0Y2g6IGVhY2hNYXRjaCwKICAgIGZpbmRBbGw6IGZpbmRBbGwKICB9KTsKCiAgZnVuY3Rpb24gbG9nKG1zZykgewogICAgaWYgKCBtc2cgPT09IHZvaWQgMCApIG1zZyA9ICcnOwoNCiAgICBXU2NyaXB0LkVjaG8obXNnKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGluaGVyaXRzKGN0b3IsIHN1cGVyQ3Rvcikgew0KICAgIGN0b3Iuc3VwZXJfID0gc3VwZXJDdG9yOw0KICAgIGN0b3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckN0b3IucHJvdG90eXBlLCB7DQogICAgICBjb25zdHJ1Y3RvcjogY3Rvcg0KICAgIH0pOw0KICB9DQoNCiAgdmFyIEZNVF9SRUcgPSAvJVtzZGlmam9PJV0vZzsNCg0KICBmdW5jdGlvbiBmb3JtYXQoZikgew0KICAgIGlmICghaXNTdHJpbmcoZikpIHsNCiAgICAgIHJldHVybiBtYXAoYXJndW1lbnRzLCBmdW5jdGlvbiAoYXJnKSB7IHJldHVybiBpbnNwZWN0KGFyZyk7IH0pLmpvaW4oJyAnKTsNCiAgICB9DQoNCiAgICB2YXIgaSA9IDEsDQogICAgICBhcmdzID0gYXJndW1lbnRzLA0KICAgICAgbGVuID0gYXJncy5sZW5ndGgsDQogICAgICBzdHIgPSBmLnJlcGxhY2UoRk1UX1JFRywgZnVuY3Rpb24gKHgpIHsNCiAgICAgICAgaWYgKHggPT09ICclJScpIHsgcmV0dXJuICclJzsgfQ0KICAgICAgICBpZiAoaSA+PSBsZW4pIHsgcmV0dXJuIHg7IH0NCiAgICAgICAgc3dpdGNoICh4KSB7DQogICAgICAgICAgY2FzZSAnJXMnOg0KICAgICAgICAgIGNhc2UgJyVkJzoNCiAgICAgICAgICBjYXNlICclaSc6DQogICAgICAgICAgY2FzZSAnJWYnOg0KICAgICAgICAgICAgcmV0dXJuIGFyZ3NbaSsrXTsNCiAgICAgICAgICBjYXNlICclaic6DQogICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoYXJnc1tpKytdKTsNCiAgICAgICAgICBjYXNlICclbyc6DQogICAgICAgICAgY2FzZSAnJU8nOg0KICAgICAgICAgICAgcmV0dXJuIGluc3BlY3QoYXJnc1tpKytdKTsNCiAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgcmV0dXJuIHg7DQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgIGZvciAodmFyIHggPSBhcmdzW2ldOyBpIDwgbGVuOyB4ID0gYXJnc1srK2ldKSB7DQogICAgICBpZiAoaXNQcmltaXRpdmUoeCkpIHsgc3RyICs9ICcgJyArIHg7IH0NCiAgICAgIGVsc2UgeyBzdHIgKz0gJyAnICsgaW5zcGVjdCh4KTsgfQ0KICAgIH0NCiAgICByZXR1cm4gc3RyOw0KICB9DQoNCiAgLy8gTWFyayB0aGF0IGEgbWV0aG9kIHNob3VsZCBub3QgYmUgdXNlZC4NCiAgLy8gUmV0dXJucyBhIG1vZGlmaWVkIGZ1bmN0aW9uIHdoaWNoIHdhcm5zIG9uY2UgYnkgZGVmYXVsdC4NCiAgLy8gSWYgLS1uby1kZXByZWNhdGlvbiBpcyBzZXQsIHRoZW4gaXQgaXMgYSBuby1vcC4NCiAgZnVuY3Rpb24gZGVwcmVjYXRlKGZuLCBtc2cpIHsKICAgIHZhciBhcmd1bWVudHMkMSA9IGFyZ3VtZW50czsKDQogICAgLy8gQWxsb3cgZm9yIGRlcHJlY2F0aW5nIHRoaW5ncyBpbiB0aGUgcHJvY2VzcyBvZiBzdGFydGluZyB1cC4NCiAgICBpZiAoZ2xvYmFsLnByb2Nlc3MgPT09IHZvaWQgMCkgew0KICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsgcmV0dXJuIGFwcGx5KGRlcHJlY2F0ZShmbiwgbXNnKSwgbnVsbCwgYXJndW1lbnRzJDEpOyB9Ow0KICAgIH0NCg0KICAgIGlmIChwcm9jZXNzLm5vRGVwcmVjYXRpb24gPT09IHRydWUpIHsgcmV0dXJuIGZuOyB9DQoNCiAgICB2YXIgd2FybmVkID0gZmFsc2U7DQoNCiAgICBmdW5jdGlvbiBkZXByZWNhdGVkKCkgew0KICAgICAgaWYgKCF3YXJuZWQpIHsNCiAgICAgICAgaWYgKHByb2Nlc3MudGhyb3dEZXByZWNhdGlvbikgeyB0aHJvdyBuZXcgRXJyb3IobXNnKTsgfQ0KICAgICAgICBlbHNlIGlmIChwcm9jZXNzLnRyYWNlRGVwcmVjYXRpb24pIHsgbG9nKG1zZyk7IH0NCiAgICAgICAgZWxzZSB7IGxvZyhtc2cpOyB9DQogICAgICAgIHdhcm5lZCA9IHRydWU7DQogICAgICB9DQogICAgICByZXR1cm4gYXBwbHkoZm4sIG51bGwsIGFyZ3VtZW50cyk7DQogICAgfQ0KDQogICAgcmV0dXJuIGRlcHJlY2F0ZWQ7DQogIH0NCg0KICB2YXIgZGVidWdzID0ge307DQogIHZhciBkZWJ1Z0Vudmlyb247DQoNCiAgZnVuY3Rpb24gZGVidWdsb2coc2V0KSB7CiAgICB2YXIgYXJndW1lbnRzJDEgPSBhcmd1bWVudHM7Cg0KICAgIGlmIChkZWJ1Z0Vudmlyb24gPT0gbnVsbCkgeyBkZWJ1Z0Vudmlyb24gPSBwcm9jZXNzLmVudi5OT0RFX0RFQlVHIHx8ICcnOyB9DQogICAgc2V0ID0gc2V0LnRvVXBwZXJDYXNlKCk7DQogICAgaWYgKCFkZWJ1Z3Nbc2V0XSkgew0KICAgICAgaWYgKG5ldyBSZWdFeHAoJ1xcYicgKyBzZXQgKyAnXFxiJywgJ2knKS50ZXN0KGRlYnVnRW52aXJvbikpIHsNCiAgICAgICAgdmFyIHBpZCA9IHByb2Nlc3MucGlkOw0KICAgICAgICBkZWJ1Z3Nbc2V0XSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICB2YXIgbXNnID0gYXBwbHkoZm9ybWF0LCBudWxsLCBhcmd1bWVudHMkMSk7DQogICAgICAgICAgbG9nKChzZXQgKyAiICIgKyBwaWQgKyAiOiAiICsgbXNnKSk7DQogICAgICAgIH07DQogICAgICB9IGVsc2Ugew0KICAgICAgICBkZWJ1Z3Nbc2V0XSA9IGZ1bmN0aW9uKCkge307DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiBkZWJ1Z3Nbc2V0XTsNCiAgfQ0KDQogIC8qIG9iaiwgWyBzaG93SGlkZGVuL29wdGlvbnMsIGRlcHRoLCBjb2xvcnMgXSAqLw0KICBmdW5jdGlvbiBpbnNwZWN0KG9iaiwgc2hvd0hpZGRlbiwgZGVwdGgsIGNvbG9ycykgew0KICAgIC8vIGRlZmF1bHQgb3B0aW9ucw0KICAgIHZhciBjdHggPSB7DQogICAgICBzZWVuOiBbXSwNCiAgICAgIC8vIHN0eWxpemU6IHN0eWxpemVOb0NvbG9yLA0KICAgICAgc2hvd0hpZGRlbjogZmFsc2UsDQogICAgICBkZXB0aDogMiwNCiAgICAgIGNvbG9yczogZmFsc2UsDQogICAgICBjdXN0b21JbnNwZWN0OiBmYWxzZSwNCiAgICAgIG1heEFycmF5TGVuZ3RoOiAxMDAsDQogICAgICBicmVha0xlbmd0aDogNjANCiAgICB9Ow0KICAgIGlmIChpc0Jvb2xlYW4oc2hvd0hpZGRlbikpIHsgY3R4LnNob3dIaWRkZW4gPSBzaG93SGlkZGVuOyB9DQogICAgaWYgKGlzTnVtYmVyKGRlcHRoKSkgeyBjdHguZGVwdGggPSBkZXB0aDsgfQ0KICAgIGlmIChpc0Jvb2xlYW4oY29sb3JzKSkgeyBjdHguY29sb3JzID0gY29sb3JzOyB9DQogICAgaWYgKGlzT2JqZWN0KHNob3dIaWRkZW4pKSB7DQogICAgICAvLyBnb3QgYW4gIm9wdGlvbnMiIG9iamVjdA0KICAgICAgT2JqZWN0LmFzc2lnbihjdHgsIHNob3dIaWRkZW4pOw0KICAgIH0NCiAgICByZXR1cm4gZm9ybWF0VmFsdWUoY3R4LCBvYmosIDApOw0KICB9DQoNCiAgZnVuY3Rpb24gZm9ybWF0VmFsdWUoY3R4LCB2YWx1ZSwgcmVjdXJzZVRpbWVzKSB7DQogICAgdmFyIHJlc3VsdDsNCiAgICAvLyBQcm92aWRlIGEgaG9vayBmb3IgdXNlci1zcGVjaWZpZWQgaW5zcGVjdCBmdW5jdGlvbnMuDQogICAgLy8gQ2hlY2sgdGhhdCB2YWx1ZSBpcyBhbiBvYmplY3Qgd2l0aCBhbiBpbnNwZWN0IGZ1bmN0aW9uIG9uIGl0DQogICAgaWYgKA0KICAgICAgY3R4LmN1c3RvbUluc3BlY3QgJiYNCiAgICAgIHZhbHVlICYmDQogICAgICBpc0Z1bmN0aW9uKHZhbHVlLmluc3BlY3QpICYmDQogICAgICAvLyBGaWx0ZXIgb3V0IHRoZSB1dGlsIG1vZHVsZSwgaXQncyBpbnNwZWN0IGZ1bmN0aW9uIGlzIHNwZWNpYWwNCiAgICAgIHZhbHVlLmluc3BlY3QgIT09IGluc3BlY3QgJiYNCiAgICAgIC8vIEFsc28gZmlsdGVyIG91dCBhbnkgcHJvdG90eXBlIG9iamVjdHMgdXNpbmcgdGhlIGNpcmN1bGFyIGNoZWNrLg0KICAgICAgISh2YWx1ZS5jb25zdHJ1Y3RvciAmJiB2YWx1ZS5jb25zdHJ1Y3Rvci5wcm90b3R5cGUgPT09IHZhbHVlKQ0KICAgICkgew0KICAgICAgcmVzdWx0ID0gdmFsdWUuaW5zcGVjdChyZWN1cnNlVGltZXMsIGN0eCk7DQogICAgICBpZiAoIWlzU3RyaW5nKHJlc3VsdCkpIHsNCiAgICAgICAgcmVzdWx0ID0gZm9ybWF0VmFsdWUoY3R4LCByZXN1bHQsIHJlY3Vyc2VUaW1lcyk7DQogICAgICB9DQogICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIC8vIFByaW1pdGl2ZSB0eXBlcyBjYW5ub3QgaGF2ZSBwcm9wZXJ0aWVzDQogICAgcmVzdWx0ID0gZm9ybWF0VmFsdWVfc2ltcGxlKHZhbHVlKTsNCiAgICBpZiAocmVzdWx0ICE9PSBmYWxzZSkgeyByZXR1cm4gcmVzdWx0OyB9DQoNCiAgICAvLyBMb29rIHVwIHRoZSBrZXlzIG9mIHRoZSBvYmplY3QuDQogICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyh2YWx1ZSk7DQogICAgdmFyIHZpc2libGVLZXlzID0ga2V5cy5yZWR1Y2UoZnVuY3Rpb24gKG1lbW8sIGtleSkgeyByZXR1cm4gKChtZW1vW2tleV0gPSB0cnVlKSwgbWVtbyk7IH0sIHt9KTsNCg0KICAgIGlmIChjdHguc2hvd0hpZGRlbikgew0KICAgICAga2V5cyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHZhbHVlKTsNCiAgICB9DQoNCiAgICBpZiAocmVjdXJzZVRpbWVzID4gY3R4LmRlcHRoKSB7IHJldHVybiBnZXRUYWcodmFsdWUpOyB9DQoNCiAgICBjdHguc2Vlbi5wdXNoKHZhbHVlKTsNCg0KICAgIHZhciBvdXRwdXQsDQogICAgICB2VHlwZSA9IHR5cGVPZih2YWx1ZSk7DQogICAgb3V0cHV0ID0gZm9ybWF0T2JqZWN0KGN0eCwgdmFsdWUsIHJlY3Vyc2VUaW1lcywgdmlzaWJsZUtleXMsIGtleXMsIHZUeXBlKTsNCiAgICBjdHguc2Vlbi5wb3AoKTsNCg0KICAgIHJldHVybiByZWR1Y2VUb1NpbmdsZVN0cmluZyhjdHgsIG91dHB1dCwgcmVjdXJzZVRpbWVzLCB2VHlwZSk7DQogIH0NCg0KICB2YXIgRVNDQVBTRV9NQVAgPSB7DQogICAgIiciOiAiJyIsDQogICAgJ1xcJzogJ1xcJywNCiAgICAnXHInOiAncicsDQogICAgJ1xuJzogJ24nLA0KICAgICdcdTIwMjgnOiAndTIwMjgnLA0KICAgICdcdTIwMjknOiAndTIwMjknDQogIH07DQoNCiAgdmFyIEVTQ0FQU0VfUkVHID0gLyd8XFx8XHJ8XG58XHUyMDI4fFx1MjAyOV0vZzsNCg0KICBmdW5jdGlvbiBlc2NhcGVDaGFyKGMpIHsNCiAgICByZXR1cm4gJ1xcJyArIEVTQ0FQU0VfTUFQW2NdOw0KICB9DQoNCiAgZnVuY3Rpb24gZm9ybWF0VmFsdWVfc2ltcGxlKHZhbHVlKSB7DQogICAgaWYgKHZhbHVlID09PSB2b2lkIDApIHsgcmV0dXJuICd1bmRlZmluZWQnOyB9DQogICAgaWYgKHZhbHVlID09PSBudWxsKSB7IHJldHVybiAnbnVsbCc7IH0NCiAgICBzd2l0Y2ggKHR5cGVPZih2YWx1ZSkpIHsNCiAgICAgIGNhc2UgJ3N0cmluZyc6DQogICAgICAgIHJldHVybiAiJyIgKyB2YWx1ZS5yZXBsYWNlKEVTQ0FQU0VfUkVHLCBlc2NhcGVDaGFyKSArICInIjsNCiAgICAgIGNhc2UgJ251bWJlcic6DQogICAgICBjYXNlICdib29sZWFuJzoNCiAgICAgIGNhc2UgJ3JlZ2V4cCc6DQogICAgICAgIHJldHVybiBTdHJpbmcodmFsdWUpOw0KICAgICAgY2FzZSAnZGF0ZSc6DQogICAgICAgIHJldHVybiB2YWx1ZS50b0pTT04oKTsNCiAgICAgIGNhc2UgJ2Z1bmN0aW9uJzogew0KICAgICAgICB2YXIgbmFtZSA9IGdldEZ1bmNOYW1lKHZhbHVlKTsNCiAgICAgICAgcmV0dXJuIG5hbWUgPyAnW0Z1bmN0aW9uOiAnICsgbmFtZSArICddJyA6ICdbRnVuY3Rpb25dJzsNCiAgICAgIH0NCiAgICAgIGNhc2UgJ2Vycm9yJzoNCiAgICAgICAgcmV0dXJuICdbJyArIHZhbHVlICsgJ10nOw0KICAgICAgY2FzZSAnYnVmZmVyJzogew0KICAgICAgICB2YXIgYnl0ZXMgPSB2YWx1ZS5idWZmZXIsDQogICAgICAgICAgbGVuID0gdmFsdWUubGVuZ3RoLA0KICAgICAgICAgIGkgPSAtMSwNCiAgICAgICAgICBvdmVyZmxvdywNCiAgICAgICAgICBhcnI7DQogICAgICAgIGlmIChsZW4gPiA1MCkgew0KICAgICAgICAgIG92ZXJmbG93ID0gdHJ1ZTsNCiAgICAgICAgICBsZW4gPSA1MDsNCiAgICAgICAgICBhcnIgPSBBcnJheSg1MSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgYXJyID0gQXJyYXkobGVuKTsNCiAgICAgICAgfQ0KICAgICAgICB3aGlsZSAoKytpIDwgbGVuKSB7IGFycltpXSA9IGhleChieXRlcy5nZXRJdGVtKGkpKTsgfQ0KICAgICAgICBpZiAob3ZlcmZsb3cpIHsgYXJyWzUwXSA9ICcuLi4nOyB9DQogICAgICAgIHJldHVybiAnPEJ1ZmZlciAnICsgYXJyLmpvaW4oJyAnKSArICc+JzsNCiAgICAgIH0NCiAgICAgIGRlZmF1bHQ6DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBmb3JtYXRPYmplY3QoY3R4LCBvYmosIHJlY3Vyc2VUaW1lcywgdmlzaWJsZUtleXMsIGtleXMsIHZUeXBlKSB7DQogICAgdmFyIG91dHB1dCA9IFtdLA0KICAgICAgaSA9IDAsDQogICAgICBsZW4sDQogICAgICBrZXk7DQogICAgaWYgKHZUeXBlID09ICdhcnJheScpIHsNCiAgICAgIGxlbiA9IG9iai5sZW5ndGg7DQogICAgICBmb3IgKDsgaSA8IGxlbjsgaSsrKSB7DQogICAgICAgIGlmIChpID49IGN0eC5tYXhBcnJheUxlbmd0aCkgew0KICAgICAgICAgIG91dHB1dC5wdXNoKCcuLi4gJyArIChsZW4gLSBjdHgubWF4QXJyYXlMZW5ndGgpICsgJyBtb3JlIGl0ZW1zJyk7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgICAgb3V0cHV0LnB1c2goZm9ybWF0UHJvcGVydHkoY3R4LCBvYmpbaV0sIHJlY3Vyc2VUaW1lcywgbnVsbCwgdHJ1ZSwgbnVsbCkpOw0KICAgICAgfQ0KICAgICAgaSA9IGxlbjsNCiAgICB9IGVsc2UgaWYgKHZUeXBlID09ICdtYXAnKSB7DQogICAgICBvYmouZm9yRWFjaChmdW5jdGlvbiAodmFsdWUsIGtleSkgew0KICAgICAgICBvdXRwdXQucHVzaChmb3JtYXRQcm9wZXJ0eShjdHgsIHZhbHVlLCByZWN1cnNlVGltZXMsIGtleSwgdHJ1ZSwgJyA9PiAnKSk7DQogICAgICB9KTsNCiAgICB9IGVsc2UgaWYgKHZUeXBlID09ICdzZXQnKSB7DQogICAgICBvYmouZm9yRWFjaChmdW5jdGlvbiAodmFsdWUpIHsNCiAgICAgICAgb3V0cHV0LnB1c2goZm9ybWF0UHJvcGVydHkoY3R4LCB2YWx1ZSwgcmVjdXJzZVRpbWVzLCBudWxsLCB0cnVlLCBudWxsKSk7DQogICAgICB9KTsNCiAgICB9DQoNCiAgICBmb3IgKGxlbiA9IGtleXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCiAgICAgIGtleSA9IGtleXNbaV07DQogICAgICBvdXRwdXQucHVzaCgNCiAgICAgICAgZm9ybWF0UHJvcGVydHkoY3R4LCBvYmpba2V5XSwgcmVjdXJzZVRpbWVzLCBrZXksIHZpc2libGVLZXlzW2tleV0sICc6ICcpDQogICAgICApOw0KICAgIH0NCiAgICByZXR1cm4gb3V0cHV0Ow0KICB9DQoNCiAgZnVuY3Rpb24gZm9ybWF0UHJvcGVydHkoY3R4LCB2YWx1ZSwgcmVjdXJzZVRpbWVzLCBrZXksIGVudW1lcmFibGUsIHNlcCkgew0KICAgIHZhciBuYW1lLCBzdHI7DQoNCiAgICBpZiAoY3R4LnNlZW4uaW5kZXhPZih2YWx1ZSkgPT09IC0xKSB7DQogICAgICBzdHIgPSBmb3JtYXRWYWx1ZShjdHgsIHZhbHVlLCByZWN1cnNlVGltZXMgKyAxKTsNCiAgICB9IGVsc2Ugew0KICAgICAgc3RyID0gJ1tDaXJjdWxhcl0nOw0KICAgIH0NCg0KICAgIGlmIChrZXkgPT0gbnVsbCkgeyByZXR1cm4gc3RyOyB9DQoNCiAgICBuYW1lID0gZW51bWVyYWJsZSA/IFN0cmluZyhrZXkpIDogJ1snICsga2V5ICsgJ10nOw0KDQogICAgaWYgKCEvXlx3KyQvLnRlc3QobmFtZSkpIHsNCiAgICAgIG5hbWUgPSAiJyIgKyBuYW1lLnJlcGxhY2UoLycvZywgIlxcJyIpICsgIiciOw0KICAgIH0NCg0KICAgIHJldHVybiBuYW1lICsgc2VwICsgc3RyOw0KICB9DQoNCiAgZnVuY3Rpb24gcmVkdWNlVG9TaW5nbGVTdHJpbmcoY3R4LCBvdXRwdXQsIHJlY3Vyc2VUaW1lcywgdlR5cGUpIHsNCiAgICB2YXIgYnJhY2VzLA0KICAgICAgaW5kZW50LA0KICAgICAgYnJlYWtMaW5lID0gZmFsc2UsDQogICAgICBsZW4gPSBvdXRwdXQubGVuZ3RoLA0KICAgICAgaSA9IC0xLA0KICAgICAgY291bnQgPSAwOw0KICAgIGlmICh2VHlwZSA9PSAnYXJyYXknKSB7IGJyYWNlcyA9IFsnWycsICddJ107IH0NCiAgICBlbHNlIGlmICh2VHlwZSA9PSAnbWFwJykgeyBicmFjZXMgPSBbJ01hcCB7JywgJ30nXTsgfQ0KICAgIGVsc2UgaWYgKHZUeXBlID09ICdzZXQnKSB7IGJyYWNlcyA9IFsnU2V0IHsnLCAnfSddOyB9DQogICAgZWxzZSBpZiAodlR5cGUgPT0gJ2FyZ3VtZW50cycpIHsgYnJhY2VzID0gWydbQXJndW1lbnRzXSB7JywgJ30nXTsgfQ0KICAgIGVsc2UgeyBicmFjZXMgPSBbJ3snLCAnfSddOyB9DQoNCiAgICBpZiAobGVuID09IDApIHsgcmV0dXJuIGJyYWNlc1swXSArIGJyYWNlc1sxXTsgfQ0KDQogICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgY291bnQgKz0gb3V0cHV0W2ldLmxlbmd0aCArIDE7DQogICAgICBpZiAoY291bnQgPiBjdHguYnJlYWtMZW5ndGgpIHsNCiAgICAgICAgYnJlYWtMaW5lID0gdHJ1ZTsNCiAgICAgICAgYnJlYWs7DQogICAgICB9DQogICAgfQ0KDQogICAgbGVuID0gb3V0cHV0LnJlZHVjZShmdW5jdGlvbiAobWVtbywgY3VyKSB7IHJldHVybiBtZW1vICsgY3VyLmxlbmd0aCArIDE7IH0sIDApOw0KICAgIGluZGVudCA9IHJlcGVhdCgnICAnLCByZWN1cnNlVGltZXMpOw0KICAgIGlmIChicmVha0xpbmUpIHsNCiAgICAgIHJldHVybiB2VHlwZSA9PSAnYXJyYXknDQogICAgICAgID8gYnJhY2VzWzBdICsgJyAnICsgb3V0cHV0LmpvaW4oJyxcclxuICAnICsgaW5kZW50KSArICcgJyArIGJyYWNlc1sxXQ0KICAgICAgICA6IGJyYWNlc1swXSArDQogICAgICAgICAgICAnIFxyXG4gICcgKw0KICAgICAgICAgICAgaW5kZW50ICsNCiAgICAgICAgICAgIG91dHB1dC5qb2luKCcsXHJcbiAgJyArIGluZGVudCkgKw0KICAgICAgICAgICAgJyAnICsNCiAgICAgICAgICAgIGJyYWNlc1sxXTsNCiAgICB9DQogICAgcmV0dXJuIGJyYWNlc1swXSArICcgJyArIG91dHB1dC5qb2luKCcsICcpICsgJyAnICsgYnJhY2VzWzFdOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNQcmltaXRpdmUodmFsdWUpIHsNCiAgICByZXR1cm4gIWlzT2JqZWN0KHZhbHVlKTsNCiAgfQoKICB2YXIgdXRpbCA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgIGluaGVyaXRzOiBpbmhlcml0cywKICAgIGZvcm1hdDogZm9ybWF0LAogICAgZGVwcmVjYXRlOiBkZXByZWNhdGUsCiAgICBkZWJ1Z2xvZzogZGVidWdsb2csCiAgICBpbnNwZWN0OiBpbnNwZWN0LAogICAgaXNQcmltaXRpdmU6IGlzUHJpbWl0aXZlCiAgfSk7CgogIHZhciBDb25zb2xlID0gZnVuY3Rpb24gQ29uc29sZShzdGRvdXQsIHN0ZGVycikgew0KICAgIGlmICghc3Rkb3V0IHx8ICEoJ1dyaXRlJyBpbiBzdGRvdXQpKSB7DQogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvbnNvbGUgZXhwZWN0cyBhIHdyaXRhYmxlIHN0cmVhbSBpbnN0YW5jZScpOw0KICAgIH0NCiAgICBpZiAoIXN0ZGVycikgeyBzdGRlcnIgPSBzdGRvdXQ7IH0NCiAgICB0aGlzLl9zdGRvdXQgPSBzdGRvdXQ7DQogICAgdGhpcy5fc3RkZXJyID0gc3RkZXJyOw0KICAgIHRoaXMuX3RpbWVzID0ge307DQoNCiAgICBmb3IgKHZhciBrZXkgaW4gQ29uc29sZS5wcm90b3R5cGUpIHsNCiAgICAgIHRoaXNba2V5XSA9IHRoaXNba2V5XS5iaW5kKHRoaXMpOw0KICAgIH0NCiAgfTsNCg0KICBDb25zb2xlLnByb3RvdHlwZS5sb2cgPSBmdW5jdGlvbiBsb2cgKCkgewogICAgICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdOwoNCiAgICB0aGlzLl9zdGRvdXQuV3JpdGVMaW5lKGZvcm1hdC5hcHBseSh2b2lkIDAsIGFyZ3MpKTsNCiAgfTsNCg0KICBDb25zb2xlLnByb3RvdHlwZS5pbmZvID0gZnVuY3Rpb24gaW5mbyAoKSB7CiAgICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07Cg0KICAgIHRoaXMuX3N0ZG91dC5Xcml0ZUxpbmUoZm9ybWF0LmFwcGx5KHZvaWQgMCwgYXJncykpOw0KICB9Ow0KDQogIENvbnNvbGUucHJvdG90eXBlLndhcm4gPSBmdW5jdGlvbiB3YXJuICgpIHsKICAgICAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDsKICAgICAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTsKDQogICAgdGhpcy5fc3RkZXJyLldyaXRlTGluZShmb3JtYXQuYXBwbHkodm9pZCAwLCBhcmdzKSk7DQogIH07DQoNCiAgQ29uc29sZS5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiBlcnJvciAoKSB7CiAgICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07Cg0KICAgIHRoaXMuX3N0ZGVyci5Xcml0ZUxpbmUoZm9ybWF0LmFwcGx5KHZvaWQgMCwgYXJncykpOw0KICB9Ow0KDQogIENvbnNvbGUucHJvdG90eXBlLmRpciA9IGZ1bmN0aW9uIGRpciAob2JqZWN0KSB7DQogICAgdGhpcy5fc3Rkb3V0LldyaXRlTGluZSgNCiAgICAgIGluc3BlY3Qob2JqZWN0LCB7DQogICAgICAgIGN1c3RvbUluc3BlY3Q6IGZhbHNlDQogICAgICB9KQ0KICAgICk7DQogIH07DQoNCiAgQ29uc29sZS5wcm90b3R5cGUudGltZSA9IGZ1bmN0aW9uIHRpbWUgKGxhYmVsKSB7DQogICAgdGhpcy5fdGltZXNbbGFiZWxdID0gRGF0ZS5ub3coKTsNCiAgfTsNCg0KICBDb25zb2xlLnByb3RvdHlwZS50aW1lRW5kID0gZnVuY3Rpb24gdGltZUVuZCAobGFiZWwpIHsNCiAgICB2YXIgdGltZSA9IHRoaXMuX3RpbWVzW2xhYmVsXTsNCiAgICBpZiAoIXRpbWUpIHsNCiAgICAgIHRocm93IG5ldyBFcnJvcignTm8gc3VjaCBsYWJlbDogJyArIGxhYmVsKTsNCiAgICB9DQogICAgdmFyIGR1cmF0aW9uID0gRGF0ZS5ub3coKSAtIHRpbWU7DQogICAgdGhpcy5sb2coJyVzOiAlZG1zJywgbGFiZWwsIGR1cmF0aW9uKTsNCiAgfTsNCg0KICBDb25zb2xlLnByb3RvdHlwZS5hc3NlcnQgPSBmdW5jdGlvbiBhc3NlcnQgKHYpIHsKICAgICAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aCAtIDE7CiAgICAgIHdoaWxlICggbGVuLS0gPiAwICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiArIDEgXTsKDQogICAgaWYgKCF2KSB7IHRocm93IG5ldyBFcnJvcihmb3JtYXQuYXBwbHkodm9pZCAwLCBhcmdzKSk7IH0NCiAgfTsNCg0KICB2YXIgY29uc29sZSA9IG5ldyBDb25zb2xlKFdTY3JpcHQuU3RkT3V0LCBXU2NyaXB0LlN0ZEVycik7CgogIHZhciBST09UX1JFR0VYUCA9IC9eKFtBLXpdOnwpWy9cXF0vOw0KICB2YXIgU0VQX1JFR0VYUCA9IC9bL1xcXSsvOw0KICB2YXIgU0VQX1JFR0VYUF9FTkQgPSAvWy9cXF0kLzsNCiAgdmFyIExOS19SRUdFWFAgPSAvKFwubG5rfFwudXJsKSQvOw0KDQogIHZhciBTRVAgPSAnXFwnOw0KICB2YXIgc2VwID0gU0VQOw0KDQogIGZ1bmN0aW9uIGlzYWJzKHB0aCkgew0KICAgIHJldHVybiBwdGggJiYgUk9PVF9SRUdFWFAudGVzdChwdGgpOw0KICB9DQoNCiAgdmFyIGlzQWJzb2x1dGUgPSBpc2FiczsNCg0KICBmdW5jdGlvbiBkaXJuYW1lKHB0aCkgew0KICAgIHJldHVybiBfX0ZTTy5HZXRQYXJlbnRGb2xkZXJOYW1lKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiBiYXNlbmFtZShwdGgsIGV4dCkgew0KICAgIHJldHVybiBleHQgPyBfX0ZTTy5HZXRCYXNlTmFtZShwdGgpIDogX19GU08uR2V0RmlsZU5hbWUocHRoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGV4dG5hbWUocHRoKSB7DQogICAgcmV0dXJuIF9fRlNPLkdldEV4dGVuc2lvbk5hbWUocHRoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGFic3BhdGgocHRoKSB7DQogICAgaWYgKCFpc2FicyhwdGgpKSB7IHB0aCA9IF9fZGlybmFtZSArIFNFUCArIHB0aDsgfQ0KICAgIHJldHVybiBfX0ZTTy5HZXRBYnNvbHV0ZVBhdGhOYW1lKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiBub3JtcGF0aChwdGgpIHsNCiAgICB2YXIgcGFydHMgPSBwdGguc3BsaXQoU0VQX1JFR0VYUCksDQogICAgICBub3JtUGFydHMgPSBbXSwNCiAgICAgIGxlbiA9IHBhcnRzLmxlbmd0aCwNCiAgICAgIHBhcnQ7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgew0KICAgICAgcGFydCA9IHBhcnRzW2ldOw0KICAgICAgaWYgKHBhcnQgPT09ICcuLicpIHsgbm9ybVBhcnRzLnBvcCgpOyB9DQogICAgICBlbHNlIGlmIChwYXJ0ID09PSAnLicpIHsgY29udGludWU7IH0NCiAgICAgIGVsc2UgeyBub3JtUGFydHMucHVzaChwYXJ0KTsgfQ0KICAgIH0NCiAgICByZXR1cm4gbm9ybVBhcnRzLmpvaW4oU0VQKTsNCiAgfQ0KDQogIHZhciBub3JtYWxpemUgPSBub3JtcGF0aDsNCg0KICBmdW5jdGlvbiBqb2luKCkgewogICAgdmFyIGFyZ3VtZW50cyQxID0gYXJndW1lbnRzOwoNCiAgICB2YXIgcCwNCiAgICAgIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGgsDQogICAgICBwYXJ0cyA9IFtdOw0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsNCiAgICAgIHAgPSBhcmd1bWVudHMkMVtpXTsNCiAgICAgIGlmICh0eXBlb2YgcCA9PT0gJ3N0cmluZycpIHsgcGFydHMucHVzaChwKTsgfQ0KICAgIH0NCiAgICByZXR1cm4gbm9ybXBhdGgocGFydHMuam9pbihTRVApKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlc29sdmUoKSB7CiAgICB2YXIgYXJndW1lbnRzJDEgPSBhcmd1bWVudHM7Cg0KICAgIHZhciBwLA0KICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aCwNCiAgICAgIHBhcnRzID0gW107DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgew0KICAgICAgcCA9IGFyZ3VtZW50cyQxW2ldOw0KICAgICAgaWYgKHR5cGVvZiBwID09PSAnc3RyaW5nJykgew0KICAgICAgICBpZiAoUk9PVF9SRUdFWFAudGVzdChwKSkgew0KICAgICAgICAgIHBhcnRzLmxlbmd0aCA9IDA7DQogICAgICAgICAgcGFydHNbMF0gPSBwOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHBhcnRzLnB1c2gocCk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIGFic3BhdGgocGFydHMuam9pbihTRVApKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlbGF0aXZlKGZyb20sIHRvKSB7DQogICAgdmFyIGZyb21fID0gYWJzcGF0aChmcm9tKS50b0xvd2VyQ2FzZSgpLA0KICAgICAgdG9fID0gYWJzcGF0aCh0bykudG9Mb3dlckNhc2UoKSwNCiAgICAgIGZyb21QYXJ0cyA9IGZyb21fLnNwbGl0KFNFUF9SRUdFWFApLA0KICAgICAgdG9QYXJ0cyA9IHRvXy5zcGxpdChTRVBfUkVHRVhQKSwNCiAgICAgIGxlbiA9IE1hdGgubWluKGZyb21QYXJ0cy5sZW5ndGgsIHRvUGFydHMubGVuZ3RoKSwNCiAgICAgIHNhbWVQYXJ0c0xlbiA9IGxlbiwNCiAgICAgIGkgPSAtMTsNCg0KICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgIGlmIChmcm9tUGFydHNbaV0gIT09IHRvUGFydHNbaV0pIHsNCiAgICAgICAgc2FtZVBhcnRzTGVuID0gaTsNCiAgICAgICAgYnJlYWs7DQogICAgICB9DQogICAgfQ0KDQogICAgaWYgKHNhbWVQYXJ0c0xlbiA9PSAwKSB7IHJldHVybiB0bzsgfQ0KDQogICAgdmFyIG91dHB1dFBhcnRzID0gW107DQogICAgZm9yIChpID0gc2FtZVBhcnRzTGVuOyBpIDwgZnJvbVBhcnRzLmxlbmd0aDsgaSsrKSB7DQogICAgICBvdXRwdXRQYXJ0cy5wdXNoKCcuLicpOw0KICAgIH0NCg0KICAgIG91dHB1dFBhcnRzID0gb3V0cHV0UGFydHMuY29uY2F0KHRvUGFydHMuc2xpY2Uoc2FtZVBhcnRzTGVuKSk7DQoNCiAgICByZXR1cm4gb3V0cHV0UGFydHMuam9pbihTRVApOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNmaWxlKHB0aCkgew0KICAgIHJldHVybiBfX0ZTTy5GaWxlRXhpc3RzKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiBpc2RpcihwdGgpIHsNCiAgICByZXR1cm4gX19GU08uRm9sZGVyRXhpc3RzKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiBleGlzdHMocHRoKSB7DQogICAgcmV0dXJuIGlzZmlsZShwdGgpIHx8IGlzZGlyKHB0aCk7DQogIH0NCg0KICBmdW5jdGlvbiBjcmVhdGVTaG9ydGN1dChwdGgsIG9wdGlvbnMpIHsNCiAgICB2YXIgc2hvcnRjdXQgPSBfX1dTaGVsbC5DcmVhdGVTaG9ydGN1dChwdGgpOw0KICAgIGlmIChvcHRpb25zLnRhcmdldCkgeyBzaG9ydGN1dC5UYXJnZXRQYXRoID0gb3B0aW9ucy50YXJnZXQ7IH0NCiAgICBpZiAob3B0aW9ucy5ydW5TdHlsZSkgeyBzaG9ydGN1dC5XaW5kb3dTdHlsZSA9IG9wdGlvbnMucnVuU3R5bGU7IH0gLy9OT1JNQUwoMSksTUFYKDMpLE1JTig3KQ0KICAgIGlmIChvcHRpb25zLmRlc2MpIHsgc2hvcnRjdXQuRGVzY3JpcHRpb24gPSBvcHRpb25zLmRlc2M7IH0NCiAgICBzaG9ydGN1dC5TYXZlKCk7DQogIH0NCg0KICBmdW5jdGlvbiBnZXRTaG9ydGN1dFRhcmdldChwdGgpIHsNCiAgICB2YXIgc2hvcnRjdXQgPSBfX1dTaGVsbC5DcmVhdGVTaG9ydGN1dChwdGgpOw0KICAgIHJldHVybiBzaG9ydGN1dC5UYXJnZXRQYXRoOw0KICB9DQoNCiAgdmFyIEZJTEVfUFJPVE8gPSB7DQogICAgaXNmaWxlOiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiAodGhpcy5fZmlsZS5BdHRyaWJ1dGVzICYgMTYpID09IDA7DQogICAgfSwNCiAgICBpc0ZpbGU6IGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuICh0aGlzLl9maWxlLkF0dHJpYnV0ZXMgJiAxNikgPT0gMDsNCiAgICB9LA0KICAgIGlzZGlyOiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiAodGhpcy5fZmlsZS5BdHRyaWJ1dGVzICYgMTYpID09IDE2Ow0KICAgIH0sDQogICAgaXNEaXJlY3Rvcnk6IGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuICh0aGlzLl9maWxlLkF0dHJpYnV0ZXMgJiAxNikgPT0gMTY7DQogICAgfSwNCiAgICBpc1Nob3J0Y3V0OiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiB0aGlzLmlzRmlsZSgpICYmIExOS19SRUdFWFAudGVzdCh0aGlzLnBhdGgpOw0KICAgIH0sDQogICAgY3JlYXRlU2hvcnRjdXQ6IGZ1bmN0aW9uKHB0aCwgb3B0aW9ucykgew0KICAgICAgb3B0aW9ucy50YXJnZXQgPSB0aGlzLnBhdGg7DQogICAgICBjcmVhdGVTaG9ydGN1dChwdGgsIG9wdGlvbnMpOw0KICAgIH0sDQogICAgY29weTogZnVuY3Rpb24oZHN0LCBvdykgew0KICAgICAgaWYgKCFpc2Ficyhkc3QpKSB7IGRzdCA9IGFic3BhdGgoZHN0KTsgfQ0KICAgICAgaWYgKCFTRVBfUkVHRVhQX0VORC50ZXN0KGRzdCkpIHsgZHN0ICs9IFNFUDsgfQ0KICAgICAgaWYgKCFpc2Rpcihkc3QpKSB7IG1rZGlycyhkc3QpOyB9DQogICAgICByZXR1cm4gdGhpcy5fZmlsZS5Db3B5KGRzdCwgb3cgPT0gbnVsbCA/IHRydWUgOiAhIW93KTsNCiAgICB9LA0KICAgIGRlbGV0ZTogZnVuY3Rpb24oZm9yY2UpIHsNCiAgICAgIHJldHVybiB0aGlzLl9maWxlLkRlbGV0ZSghIWZvcmNlKTsNCiAgICB9LA0KICAgIG1vdmU6IGZ1bmN0aW9uKGRzdCkgew0KICAgICAgaWYgKCFpc2Ficyhkc3QpKSB7IGRzdCA9IGFic3BhdGgoZHN0KTsgfQ0KICAgICAgaWYgKCFTRVBfUkVHRVhQX0VORC50ZXN0KGRzdCkpIHsgZHN0ICs9IFNFUDsgfQ0KICAgICAgaWYgKCFpc2Rpcihkc3QpKSB7IG1rZGlycyhkc3QpOyB9DQogICAgICByZXR1cm4gdGhpcy5fZmlsZS5Nb3ZlKGRzdCk7DQogICAgfSwNCiAgICBnZXRDaGlsZHJlbjogZnVuY3Rpb24oKSB7DQogICAgICB2YXIgc2VsZiA9IHRoaXMuaXNTaG9ydGN1dCgpID8gZ2V0U3RhdHModGhpcy50YXJnZXQpIDogdGhpczsNCiAgICAgIGlmIChzZWxmLmlzRmlsZSgpKSB7IHJldHVybiBudWxsOyB9DQogICAgICB2YXIgX2VudW0gPSBuZXcgRW51bWVyYXRvcihzZWxmLl9maWxlLkZpbGVzKTsNCiAgICAgIHZhciByc3QgPSBbXTsNCiAgICAgIGZvciAoOyAhX2VudW0uYXRFbmQoKTsgX2VudW0ubW92ZU5leHQoKSkgew0KICAgICAgICByc3QucHVzaChnZXRTdGF0cyhfZW51bS5pdGVtKCkpKTsNCiAgICAgIH0NCiAgICAgIF9lbnVtID0gbmV3IEVudW1lcmF0b3Ioc2VsZi5fZmlsZS5TdWJGb2xkZXJzKTsNCiAgICAgIGZvciAoOyAhX2VudW0uYXRFbmQoKTsgX2VudW0ubW92ZU5leHQoKSkgew0KICAgICAgICByc3QucHVzaChnZXRTdGF0cyhfZW51bS5pdGVtKCkpKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiByc3Q7DQogICAgfQ0KICB9Ow0KDQogIHZhciBGSUxFX1BST1BTID0gew0KICAgIF9maWxlOiB7DQogICAgICB2YWx1ZTogbnVsbCwNCiAgICAgIHdyaXRhYmxlOiB0cnVlDQogICAgfSwNCiAgICBuYW1lOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuX2ZpbGUuTmFtZTsNCiAgICAgIH0sDQogICAgICBzZXQ6IGZ1bmN0aW9uKHYpIHsNCiAgICAgICAgdGhpcy5fZmlsZS5OYW1lID0gdjsNCiAgICAgIH0NCiAgICB9LA0KICAgIHBhdGg6IHsNCiAgICAgIGVudW1lcmFibGU6IHRydWUsDQogICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5fZmlsZS5QYXRoOw0KICAgICAgfQ0KICAgIH0sDQogICAgZGlybmFtZTogew0KICAgICAgZW51bWVyYWJsZTogdHJ1ZSwNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB0aGlzLl9maWxlLlBhcmVudEZvbGRlci5QYXRoOw0KICAgICAgfQ0KICAgIH0sDQogICAgc2l6ZTogew0KICAgICAgZW51bWVyYWJsZTogdHJ1ZSwNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB0aGlzLl9maWxlLlNpemU7DQogICAgICB9DQogICAgfSwNCiAgICB0eXBlOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuX2ZpbGUuVHlwZTsNCiAgICAgIH0NCiAgICB9LA0KICAgIHRhcmdldDogew0KICAgICAgZW51bWVyYWJsZTogdHJ1ZSwNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB0aGlzLmlzU2hvcnRjdXQoKSA/IGdldFNob3J0Y3V0VGFyZ2V0KHRoaXMucGF0aCkgOiBudWxsOw0KICAgICAgfQ0KICAgIH0sDQogICAgYXRpbWU6IHsNCiAgICAgIGVudW1lcmFibGU6IHRydWUsDQogICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gbmV3IERhdGUodGhpcy5fZmlsZS5EYXRlTGFzdEFjY2Vzc2VkKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIG10aW1lOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKHRoaXMuX2ZpbGUuRGF0ZUxhc3RNb2RpZmllZCk7DQogICAgICB9DQogICAgfSwNCiAgICBjdGltZTogew0KICAgICAgZW51bWVyYWJsZTogdHJ1ZSwNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiBuZXcgRGF0ZSh0aGlzLl9maWxlLkRhdGVDcmVhdGVkKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIGF0aW1lTXM6IHsNCiAgICAgIGVudW1lcmFibGU6IHRydWUsDQogICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5hdGltZS5nZXRUaW1lKCk7DQogICAgICB9DQogICAgfSwNCiAgICBtdGltZU1zOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMubXRpbWUuZ2V0VGltZSgpOw0KICAgICAgfQ0KICAgIH0sDQogICAgY3RpbWVNczogew0KICAgICAgZW51bWVyYWJsZTogdHJ1ZSwNCiAgICAgIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB0aGlzLmN0aW1lLmdldFRpbWUoKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIHJlYWRvbmx5OiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuICEhKHRoaXMuX2ZpbGUuQXR0cmlidXRlcyAmIDEpOw0KICAgICAgfQ0KICAgIH0sDQogICAgaGlkZGVuOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuICEhKHRoaXMuX2ZpbGUuQXR0cmlidXRlcyAmIDIpOw0KICAgICAgfQ0KICAgIH0sDQogICAgc3lzdGVtOiB7DQogICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuICEhKHRoaXMuX2ZpbGUuQXR0cmlidXRlcyAmIDQpOw0KICAgICAgfQ0KICAgIH0NCiAgfTsNCg0KICBmdW5jdGlvbiBnZXRTdGF0cyhwdGgpIHsNCiAgICB2YXIgZiwNCiAgICAgIGluc3RhbmNlID0gT2JqZWN0LmNyZWF0ZShGSUxFX1BST1RPLCBGSUxFX1BST1BTKTsNCiAgICBpZiAodHlwZW9mIHB0aCA9PSAnb2JqZWN0Jykgew0KICAgICAgZiA9IHB0aDsNCiAgICB9IGVsc2UgaWYgKHR5cGVvZiBwdGggPT0gJ3N0cmluZycpIHsNCiAgICAgIGlmICghaXNhYnMocHRoKSkgeyBwdGggPSBhYnNwYXRoKHB0aCk7IH0NCiAgICAgIGlmIChpc2ZpbGUocHRoKSkgew0KICAgICAgICBmID0gX19GU08uR2V0RmlsZShwdGgpOw0KICAgICAgfSBlbHNlIGlmIChpc2RpcihwdGgpKSB7DQogICAgICAgIGYgPSBfX0ZTTy5HZXRGb2xkZXIocHRoKTsNCiAgICAgIH0NCiAgICB9DQogICAgaWYgKCFmKSB7IHRocm93IG5ldyBFcnJvcigoIkVOT0VOVCwgbm8gc3VjaCBmaWxlIG9yIGRpcmVjdG9yeSAoIiArIHB0aCArICIpIikpOyB9DQogICAgaW5zdGFuY2UuX2ZpbGUgPSBmOw0KICAgIHJldHVybiBpbnN0YW5jZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNjYW5kaXIocHRoKSB7DQogICAgcmV0dXJuIGdldFN0YXRzKHB0aCkuZ2V0Q2hpbGRyZW4oKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHdhbGsocHRoLCBmbikgew0KICAgIGlmICghaXNkaXIocHRoKSkgeyByZXR1cm47IH0NCiAgICB2YXIgZGlyLA0KICAgICAgaXRlbXMsDQogICAgICBpdGVtLA0KICAgICAgaSwNCiAgICAgIGxlbiwNCiAgICAgIGJ1ZiA9IFtnZXRTdGF0cyhwdGgpXTsNCiAgICB3aGlsZSAoYnVmLmxlbmd0aCA+IDApIHsNCiAgICAgIGRpciA9IGJ1Zi5zaGlmdCgpOw0KICAgICAgaXRlbXMgPSBkaXIuZ2V0Q2hpbGRyZW4oKTsNCiAgICAgIGkgPSAtMTsNCiAgICAgIGxlbiA9IGl0ZW1zLmxlbmd0aDsNCiAgICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgICAgaXRlbSA9IGl0ZW1zW2ldOw0KICAgICAgICBpZiAoaXRlbS5pc0RpcmVjdG9yeSgpKSB7IGJ1Zi5wdXNoKGl0ZW0pOyB9DQogICAgICAgIGlmIChmbihpdGVtKSA9PT0gZmFsc2UpIHsgcmV0dXJuOyB9DQogICAgICB9DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gbWtkaXIocHRoKSB7DQogICAgcmV0dXJuIF9fRlNPLkNyZWF0ZUZvbGRlcihwdGgpOw0KICB9DQoNCiAgZnVuY3Rpb24gbWtkaXJzKHB0aCkgew0KICAgIHZhciBkaXIgPSBwdGgsDQogICAgICBkaXJzID0gW107DQogICAgd2hpbGUgKGRpcikgew0KICAgICAgaWYgKGlzZGlyKGRpcikpIHsgYnJlYWs7IH0NCiAgICAgIGRpcnMucHVzaChkaXIpOw0KICAgICAgZGlyID0gZGlybmFtZShkaXIpOw0KICAgIH0NCiAgICB2YXIgaSA9IGRpcnMubGVuZ3RoOw0KICAgIHdoaWxlIChpLS0pIHsgbWtkaXIoZGlyc1tpXSk7IH0NCiAgfQ0KDQogIGZ1bmN0aW9uIHJtZGlyKHB0aCkgew0KICAgIHJldHVybiBpc2RpcihwdGgpICYmIF9fRlNPLkRlbGV0ZUZvbGRlcihwdGgpOw0KICB9DQoNCiAgZnVuY3Rpb24gcmVtb3ZlJDEocHRoKSB7DQogICAgcmV0dXJuIGlzZmlsZShwdGgpICYmIF9fRlNPLkRlbGV0ZUZpbGUocHRoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNvcHlmaWxlKHB0aCwgZHN0LCBvdykgew0KICAgIGlmICghaXNhYnMoZHN0KSkgeyBkc3QgPSBhYnNwYXRoKGRpcm5hbWUocHRoKSArIFNFUCArIGRzdCk7IH0NCiAgICBpZiAoIVNFUF9SRUdFWFBfRU5ELnRlc3QoZHN0KSkgeyBkc3QgKz0gU0VQOyB9DQogICAgaWYgKCFpc2Rpcihkc3QpKSB7IG1rZGlycyhkc3QpOyB9DQogICAgX19GU08uQ29weUZpbGUocHRoLCBkc3QsIG93IHx8IGZhbHNlKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlcGwocHRoLCBkc3QpIHsNCiAgICBpZiAoIWlzYWJzKGRzdCkpIHsgZHN0ID0gYWJzcGF0aChkaXJuYW1lKHB0aCkgKyBTRVAgKyBkc3QpOyB9DQogICAgdmFyIGRpciA9IGRpcm5hbWUoZHN0KTsNCiAgICB2YXIgbmFtZSA9IGJhc2VuYW1lKGRzdCk7DQogICAgaWYgKGlzZmlsZShkc3QpKSB7IHRocm93IG5ldyBFcnJvcihkc3QgKyAnIGlzIGV4aXN0cy4gcmVwbCBmYWlkLicpOyB9DQogICAgaWYgKCFpc2RpcihkaXIpKSB7IG1rZGlycyhkaXIpOyB9DQogICAgZWxzZSBpZiAoaXNkaXIoZHN0KSkgeyBybWRpcihkc3QpOyB9DQogICAgdmFyIGYgPSBnZXRTdGF0cyhwdGgpOw0KICAgIGlmIChmLm5hbWUgIT0gbmFtZSkgeyBmLm5hbWUgPSBuYW1lOyB9DQogICAgaWYgKGYuZGlybmFtZSAhPSBkaXIpIHsgZi5tb3ZlKGRpcik7IH0NCiAgfQoKICBmdW5jdGlvbiBzdGF0U3luYyhwdGgpIHsNCiAgICByZXR1cm4gZ2V0U3RhdHMocHRoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlYWRkaXJTeW5jKHB0aCkgew0KICAgIHJldHVybiBzY2FuZGlyKHB0aCkubWFwKGZ1bmN0aW9uIChpdCkgeyByZXR1cm4gaXQubmFtZTsgfSk7DQogIH0NCg0KICBmdW5jdGlvbiB3aXRoU3RyZWFtKG9wdGlvbnMsIGZuKSB7DQogICAgdmFyIHN0ID0gbmV3IEFjdGl2ZVhPYmplY3QoJ0FET0RCLlN0cmVhbScpLA0KICAgICAgZmlsZSA9IG9wdGlvbnMuZmlsZSwNCiAgICAgIGVuY29kaW5nID0gb3B0aW9ucy5lbmNvZGluZywNCiAgICAgIGZsYWcgPSBvcHRpb25zLmZsYWcsDQogICAgICByc3Q7DQogICAgdHJ5IHsNCiAgICAgIGlmIChlbmNvZGluZyA9PSAnYmluYXJ5JykgeyBzdC5UeXBlID0gMTsgfQ0KICAgICAgZWxzZSB7IHN0LkNoYXJzZXQgPSBlbmNvZGluZzsgfQ0KICAgICAgc3QuT3BlbigpOw0KICAgICAgaWYgKGZsYWcgPT0gJ3InIHx8IGZsYWcgPT0gJ2EnKSB7DQogICAgICAgIGlmICghaXNmaWxlKGZpbGUpKQ0KICAgICAgICAgIHsgdGhyb3cgbmV3IEVycm9yKCgid2l0aFN0cmVhbTogZmlsZSBub3QgZXhpc3RzLiAoIiArIGZpbGUgKyAiKSIpKTsgfQ0KICAgICAgICBzdC5Mb2FkRnJvbUZpbGUoZmlsZSk7DQogICAgICB9DQogICAgICBpZiAoZmxhZyA9PSAnYScpIHsgc3QuUG9zaXRpb24gPSBzdC5TaXplOyB9DQogICAgICByc3QgPSBmbihzdCk7DQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgdGhyb3cgZTsNCiAgICB9IGZpbmFsbHkgew0KICAgICAgc3QgJiYgc3QuU3RhdGUgPT0gMSAmJiBzdC5jbG9zZSgpOw0KICAgIH0NCiAgICByZXR1cm4gcnN0Ow0KICB9DQoNCiAgZnVuY3Rpb24gc2F2ZVN0cmVhbShzdCwgb3B0aW9ucykgew0KICAgIHZhciBza2lwTGVuID0gMCwNCiAgICAgIGZpbGUgPSBvcHRpb25zLmZpbGUsDQogICAgICBlbmNvZGluZyA9IG9wdGlvbnMuZW5jb2RpbmcucmVwbGFjZSgnLScsICcnKS50b0xvd2VyQ2FzZSgpOw0KICAgIGlmIChlbmNvZGluZyA9PSAndXRmOCcgfHwgZW5jb2RpbmcgPT0gJ3VuaWNvZGUnKSB7IHNraXBMZW4gPSAzOyB9DQogICAgZWxzZSBpZiAoZW5jb2RpbmcgPT0gJ3VmdDE2JykgeyBza2lwTGVuID0gMjsgfQ0KICAgIHN0LlNldEVPUygpOw0KICAgIGlmIChza2lwTGVuKSB7DQogICAgICBzdC5Qb3NpdGlvbiA9IDA7DQogICAgICBzdC5UeXBlID0gMTsNCiAgICAgIHN0LlBvc2l0aW9uID0gc2tpcExlbjsNCiAgICAgIHZhciBiaW5EYXRhID0gc3QuUmVhZCgtMSk7DQogICAgICBzdC5Qb3NpdGlvbiA9IDA7DQogICAgICBzdC5Xcml0ZShiaW5EYXRhKTsNCiAgICAgIHN0LlNldEVPUygpOw0KICAgIH0NCiAgICBzdC5TYXZlVG9GaWxlKGZpbGUsIDIpOw0KICB9DQoNCiAgZnVuY3Rpb24gaW5pdEFyZ3MoZmlsZSwgb3B0aW9ucykgew0KICAgIHZhciB0cCwgZW5jb2RpbmcsIGZsYWc7DQogICAgaWYgKCFpc2FicyhmaWxlKSkgeyB0aHJvdyBuZXcgRXJyb3IoJ2ZzOiByZWxhdGl2ZSBwYXRoIGlzIG5vdCBzdXBwb3J0ZWQnKTsgfQ0KICAgIHRwID0gdHlwZW9mIG9wdGlvbnM7DQogICAgaWYgKHRwID09ICdzdHJpbmcnKSB7DQogICAgICBlbmNvZGluZyA9IG9wdGlvbnM7DQogICAgfSBlbHNlIGlmICh0cCA9PSAnb2JqZWN0Jykgew0KICAgICAgaWYgKG9wdGlvbnMuZW5jb2RpbmcpIHsgZW5jb2RpbmcgPSBvcHRpb25zLmVuY29kaW5nOyB9DQogICAgICBpZiAob3B0aW9ucy5mbGFnKSB7IGZsYWcgPSBvcHRpb25zLmZsYWc7IH0NCiAgICAgIGVsc2UgaWYgKG9wdGlvbnMuZmxhZ3MpIHsgZmxhZyA9IG9wdGlvbnMuZmxhZ3M7IH0NCiAgICB9DQogICAgaWYgKGZsYWcgJiYgZmxhZy5sZW5ndGggPiAxKSB7IGZsYWcgPSBmbGFnLmNoYXJBdCgwKTsgfQ0KICAgIHJldHVybiB7IGZpbGU6IGZpbGUsIGVuY29kaW5nOiBlbmNvZGluZywgZmxhZzogZmxhZyB9Ow0KICB9DQoNCiAgZnVuY3Rpb24gcmVhZEZpbGVTeW5jKGZpbGUsIG9wdGlvbnMpIHsNCiAgICB2YXIgb3B0cyA9IGluaXRBcmdzKGZpbGUsIG9wdGlvbnMpOw0KICAgIG9wdHMuZmxhZyA9ICdyJzsNCiAgICBpZiAoIW9wdHMuZW5jb2RpbmcpIHsgb3B0cy5lbmNvZGluZyA9ICdiaW5hcnknOyB9DQogICAgcmV0dXJuIHdpdGhTdHJlYW0ob3B0cywgZnVuY3Rpb24oc3QpIHsNCiAgICAgIHJldHVybiBvcHRzLmVuY29kaW5nID09ICdiaW5hcnknDQogICAgICAgID8gQnVmZmVyLmZyb20oc3QuUmVhZCgtMSkpDQogICAgICAgIDogc3QuUmVhZFRleHQoLTEpOw0KICAgIH0pOw0KICB9DQoNCiAgZnVuY3Rpb24gd3JpdGVGaWxlU3luYyhmaWxlLCBkYXRhLCBvcHRpb25zKSB7DQogICAgdmFyIG9wdHMgPSBpbml0QXJncyhmaWxlLCBvcHRpb25zKSwNCiAgICAgIGlzQnVmZmVyID0gQnVmZmVyLmlzQnVmZmVyKGRhdGEpOw0KICAgIG9wdHMuZmxhZyA9ICd3JzsNCiAgICBpZiAoaXNCdWZmZXIpIHsgb3B0cy5lbmNvZGluZyA9ICdiaW5hcnknOyB9DQogICAgZWxzZSBpZiAoIW9wdHMuZW5jb2RpbmcpIHsgb3B0cy5lbmNvZGluZyA9ICdVVEYtOCc7IH0NCiAgICB3aXRoU3RyZWFtKG9wdHMsIGZ1bmN0aW9uIChzdCkgew0KICAgICAgaXNCdWZmZXIgPyBzdC5Xcml0ZShkYXRhLmJ1ZmZlcikgOiBzdC5Xcml0ZVRleHQoZGF0YSk7DQogICAgICBzYXZlU3RyZWFtKHN0LCBvcHRzKTsNCiAgICB9KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGFwcGVuZEZpbGVTeW5jKGZpbGUsIGRhdGEsIG9wdGlvbnMpIHsNCiAgICB2YXIgb3B0cyA9IGluaXRBcmdzKGZpbGUsIG9wdGlvbnMpLA0KICAgICAgaXNCdWZmZXIgPSBCdWZmZXIuaXNCdWZmZXIoZGF0YSk7DQogICAgb3B0cy5mbGFnID0gJ2EnOw0KICAgIGlmIChpc0J1ZmZlcikgeyBvcHRzLmVuY29kaW5nID0gJ2JpbmFyeSc7IH0NCiAgICBlbHNlIGlmICghb3B0cy5lbmNvZGluZykgeyBvcHRzLmVuY29kaW5nID0gJ1VURi04JzsgfQ0KICAgIHdpdGhTdHJlYW0ob3B0cywgZnVuY3Rpb24gKHN0KSB7DQogICAgICBpc0J1ZmZlciA/IHN0LldyaXRlKGRhdGEuYnVmZmVyKSA6IHN0LldyaXRlVGV4dChkYXRhKTsNCiAgICAgIHNhdmVTdHJlYW0oc3QsIG9wdHMpOw0KICAgIH0pOw0KICB9DQoNCiAgZnVuY3Rpb24gbWtkaXJTeW5jKHB0aCwgb3B0aW9ucykgew0KICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMucmVjdXJzaXZlKSB7IG1rZGlycyhwdGgpOyB9DQogICAgbWtkaXIocHRoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNvcHlGaWxlU3luYyhzcmMsIGRlc3QpIHsNCiAgICBjb3B5ZmlsZShzcmMsIGRlc3QsIHRydWUpOw0KICB9DQoNCiAgLy8gZnMtZXh0cmENCg0KICBmdW5jdGlvbiBta2RpcnNTeW5jKHB0aCkgew0KICAgIG1rZGlycyhwdGgpOw0KICB9DQoNCiAgZnVuY3Rpb24gZW5zdXJlRGlyU3luYyhwdGgpIHsNCiAgICBpZiAoIWlzZGlyKHB0aCkpIHsgbWtkaXJzKHB0aCk7IH0NCiAgfQ0KDQogIGZ1bmN0aW9uIGVuc3VyZUZpbGVTeW5jKGZpbGUpIHsNCiAgICBpZiAoIWlzYWJzKGZpbGUpKSB7IGZpbGUgPSBhYnNwYXRoKGZpbGUpOyB9DQogICAgdmFyIGRpciA9IGRpcm5hbWUoZmlsZSk7DQogICAgaWYgKCFpc2RpcihkaXIpKSB7IG1rZGlycyhkaXIpOyB9DQogIH0NCg0KICBmdW5jdGlvbiBvdXRwdXRGaWxlU3luYyhmaWxlLCBkYXRhLCBvcHRpb25zKSB7DQogICAgaWYgKCFpc2FicyhmaWxlKSkgeyBmaWxlID0gYWJzcGF0aChmaWxlKTsgfQ0KICAgIGVuc3VyZUZpbGVTeW5jKGZpbGUpOw0KICAgIHdyaXRlRmlsZVN5bmMoZmlsZSwgZGF0YSwgb3B0aW9ucyk7DQogIH0NCg0KICBmdW5jdGlvbiBvdXRwdXRKc29uU3luYyhmaWxlLCBvYmosIG9wdGlvbnMpIHsNCiAgICBpZiAoIWlzYWJzKGZpbGUpKSB7IGZpbGUgPSBhYnNwYXRoKGZpbGUpOyB9DQogICAgZW5zdXJlRmlsZVN5bmMoZmlsZSk7DQogICAgd3JpdGVGaWxlU3luYyhmaWxlLCBKU09OLnN0cmluZ2lmeShvYmopLCBvcHRpb25zKTsNCiAgfQ0KDQogIHZhciBvdXRwdXRKU09OU3luYyA9IG91dHB1dEpzb25TeW5jOw0KDQogIGZ1bmN0aW9uIHJlYWRKc29uU3luYyhmaWxlLCBvcHRpb25zKSB7DQogICAgaWYgKCFpc2FicyhmaWxlKSkgeyBmaWxlID0gYWJzcGF0aChmaWxlKTsgfQ0KICAgIGlmICghb3B0aW9ucyB8fCAodHlwZW9mIG9wdGlvbnMgPT0gJ29iamVjdCcgJiYgIW9wdGlvbnMuZW5jb2RpbmcpKQ0KICAgICAgeyBvcHRpb25zID0gJ1VURi04JzsgfQ0KICAgIHZhciBkYXRhID0gcmVhZEZpbGVTeW5jKGZpbGUsIG9wdGlvbnMpOw0KICAgIHJldHVybiBKU09OLnBhcnNlKGRhdGEpOw0KICB9DQoNCiAgdmFyIHJlYWRKU09OU3luYyA9IHJlYWRKc29uU3luYzsNCg0KICBmdW5jdGlvbiBlbXB0eURpclN5bmMoZGlyKSB7DQogICAgc2NhbmRpcihkaXIpLmZvckVhY2goZnVuY3Rpb24gKGl0KSB7IHJldHVybiBpdC5kZWxldGUodHJ1ZSk7IH0pOw0KICB9DQoNCiAgZnVuY3Rpb24gcmVhZExpbmVzU3luYyhmaWxlLCBvcHRpb25zKSB7DQogICAgaWYgKCFpc2FicyhmaWxlKSkgeyBmaWxlID0gYWJzcGF0aChmaWxlKTsgfQ0KICAgIHZhciBvcHRzID0gaW5pdEFyZ3MoZmlsZSwgb3B0aW9ucyk7DQogICAgb3B0cy5mbGFnID0gJ3InOw0KICAgIGlmICghb3B0cy5lbmNvZGluZykgeyBvcHRzLmVuY29kaW5nID0gJ1VURi04JzsgfQ0KICAgIHJldHVybiB3aXRoU3RyZWFtKG9wdHMsIGZ1bmN0aW9uKHN0KSB7DQogICAgICB2YXIgbGluZXMgPSBbXTsNCiAgICAgIHdoaWxlICghc3QuRU9TKSB7IGxpbmVzLnB1c2goc3QuUmVhZFRleHQoLTIpKTsgfQ0KICAgICAgcmV0dXJuIGxpbmVzOw0KICAgIH0pOw0KICB9CgogIHZhciBmcyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgIHN0YXRTeW5jOiBzdGF0U3luYywKICAgIHJlYWRkaXJTeW5jOiByZWFkZGlyU3luYywKICAgIHJlYWRGaWxlU3luYzogcmVhZEZpbGVTeW5jLAogICAgd3JpdGVGaWxlU3luYzogd3JpdGVGaWxlU3luYywKICAgIGFwcGVuZEZpbGVTeW5jOiBhcHBlbmRGaWxlU3luYywKICAgIG1rZGlyU3luYzogbWtkaXJTeW5jLAogICAgY29weUZpbGVTeW5jOiBjb3B5RmlsZVN5bmMsCiAgICBta2RpcnNTeW5jOiBta2RpcnNTeW5jLAogICAgZW5zdXJlRGlyU3luYzogZW5zdXJlRGlyU3luYywKICAgIGVuc3VyZUZpbGVTeW5jOiBlbnN1cmVGaWxlU3luYywKICAgIG91dHB1dEZpbGVTeW5jOiBvdXRwdXRGaWxlU3luYywKICAgIG91dHB1dEpzb25TeW5jOiBvdXRwdXRKc29uU3luYywKICAgIG91dHB1dEpTT05TeW5jOiBvdXRwdXRKU09OU3luYywKICAgIHJlYWRKc29uU3luYzogcmVhZEpzb25TeW5jLAogICAgcmVhZEpTT05TeW5jOiByZWFkSlNPTlN5bmMsCiAgICBlbXB0eURpclN5bmM6IGVtcHR5RGlyU3luYywKICAgIHJlYWRMaW5lc1N5bmM6IHJlYWRMaW5lc1N5bmMsCiAgICBleGlzdHNTeW5jOiBleGlzdHMsCiAgICByZW5hbWVTeW5jOiByZXBsLAogICAgcm1kaXJTeW5jOiBybWRpciwKICAgIHVubGlua1N5bmM6IHJlbW92ZSQxCiAgfSk7CgogIHZhciBQQVJTRV9SRUcgPSAvXihbQS1aYS16XTpbL1xcXXxbL1xcXXwpKD86KFtePyNdKilbL1xcXXwpKFteL1xcPyNdKj8pKFsuXVteLj8jXSt8KSQvOw0KICB2YXIgQ0FQVFVSRSA9IFsncGF0aCcsICdyb290JywgJ2RpcicsICduYW1lJywgJ2V4dCddOw0KDQogIGZ1bmN0aW9uIHBhcnNlKHB0aCkgew0KICAgIHB0aCB8fCAocHRoID0gJycpOw0KICAgIHZhciBtYXRjaCA9IHB0aC5tYXRjaChQQVJTRV9SRUcpOw0KICAgIHZhciByZXN1bHQgPSBDQVBUVVJFLnJlZHVjZShmdW5jdGlvbihtZW1vLCBuYW1lLCBpbmRleCkgew0KICAgICAgbWVtb1tuYW1lXSA9IG1hdGNoW2luZGV4XTsNCiAgICAgIHJldHVybiBtZW1vOw0KICAgIH0sIHt9KTsNCiAgICByZXN1bHQuYmFzZSA9IHJlc3VsdC5uYW1lICsgcmVzdWx0LmV4dDsNCiAgICByZXN1bHQuZGlybmFtZSA9IHJlc3VsdC5yb290ICsgcmVzdWx0LmRpcjsNCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9DQoNCiAgdmFyIGRlbGltaXRlciA9ICc7JzsKCiAgdmFyIFBhdGggPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICBwYXJzZTogcGFyc2UsCiAgICBkZWxpbWl0ZXI6IGRlbGltaXRlciwKICAgIHNlcDogc2VwLAogICAgZGlybmFtZTogZGlybmFtZSwKICAgIGJhc2VuYW1lOiBiYXNlbmFtZSwKICAgIGV4dG5hbWU6IGV4dG5hbWUsCiAgICBpc0Fic29sdXRlOiBpc0Fic29sdXRlLAogICAgbm9ybWFsaXplOiBub3JtYWxpemUsCiAgICBqb2luOiBqb2luLAogICAgcmVzb2x2ZTogcmVzb2x2ZSwKICAgIHJlbGF0aXZlOiByZWxhdGl2ZQogIH0pOwoKICBpZiAoIU9iamVjdC5hc3NpZ24pIHsNCiAgICBPYmplY3QuYXNzaWduID0gZnVuY3Rpb24oKSB7DQogICAgICByZXR1cm4gYXBwbHkoYXNzaWduLCBudWxsLCBhcmd1bWVudHMpOw0KICAgIH07DQogIH0NCg0KICBpZiAoIU9iamVjdC52YWx1ZXMpIHsNCiAgICBPYmplY3QudmFsdWVzID0gdmFsdWVzOw0KICB9DQoNCiAgZnVuY3Rpb24gZGVmaW5lTWV0aG9kcyh0YXJnZXQsIGZ1bmNEaWN0KSB7DQogICAgdmFyIHByb3BzID0ge307DQogICAgZm9yICh2YXIga2V5IGluIGZ1bmNEaWN0KSB7DQogICAgICBpZiAoIXRhcmdldFtrZXldKSB7DQogICAgICAgIHByb3BzW2tleV0gPSB7DQogICAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsDQogICAgICAgICAgdmFsdWU6IGZ1bmNEaWN0W2tleV0NCiAgICAgICAgfTsNCiAgICAgIH0NCiAgICB9DQogICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcyk7DQogIH0NCg0KICBkZWZpbmVNZXRob2RzKEFycmF5LnByb3RvdHlwZSwgew0KICAgIGluY2x1ZGVzOiBmdW5jdGlvbih2YWwsIHN0YXJ0KSB7DQogICAgICByZXR1cm4gaW5jbHVkZXModGhpcywgdmFsLCBzdGFydCk7DQogICAgfSwNCiAgICBmaW5kOiBmdW5jdGlvbihmbiwgX3RoaXMpIHsNCiAgICAgIHJldHVybiBmaW5kKHRoaXMsIGZuLCBfdGhpcylbMF07DQogICAgfSwNCiAgICBmaW5kSW5kZXg6IGZ1bmN0aW9uKGZuLCBfdGhpcykgew0KICAgICAgcmV0dXJuIGZpbmRJbmRleCh0aGlzLCBmbiwgX3RoaXMpWzFdOw0KICAgIH0sDQogICAgZmlsbDogZnVuY3Rpb24odmFsLCBzdGFydCwgZW5kKSB7DQogICAgICByZXR1cm4gZmlsbCh0aGlzLCB2YWwsIHN0YXJ0LCBlbmQpOw0KICAgIH0NCiAgfSk7DQoNCiAgZGVmaW5lTWV0aG9kcyhTdHJpbmcucHJvdG90eXBlLCB7DQogICAgcmVwZWF0OiBmdW5jdGlvbihuKSB7DQogICAgICByZXR1cm4gcmVwZWF0KHRoaXMsIG4pOw0KICAgIH0sDQogICAgc3RhcnRzV2l0aDogZnVuY3Rpb24odGFyZ2V0LCBwb3MpIHsNCiAgICAgIHJldHVybiBzdGFydHNXaXRoKHRoaXMsIHRhcmdldCwgcG9zKTsNCiAgICB9LA0KICAgIGVuZHNXaXRoOiBmdW5jdGlvbih0YXJnZXQsIHRoaXNfbGVuKSB7DQogICAgICByZXR1cm4gZW5kc1dpdGgodGhpcywgdGFyZ2V0LCB0aGlzX2xlbik7DQogICAgfSwNCiAgICBpbmNsdWRlczogZnVuY3Rpb24odGFyZ2V0LCBwb3MpIHsNCiAgICAgIHJldHVybiBpbmNsdWRlcyh0aGlzLCB0YXJnZXQsIHBvcyk7DQogICAgfSwNCiAgICBwYWRTdGFydDogZnVuY3Rpb24obGVuLCBjaHJzKSB7DQogICAgICByZXR1cm4gcGFkU3RhcnQodGhpcywgbGVuLCBjaHJzKTsNCiAgICB9LA0KICAgIHBhZEVuZDogZnVuY3Rpb24obGVuLCBjaHJzKSB7DQogICAgICByZXR1cm4gcGFkRW5kKHRoaXMsIGxlbiwgY2hycyk7DQogICAgfQ0KICB9KTsNCg0KICBpZiAoIVN0cmluZy5yYXcpIHsNCiAgICBTdHJpbmcucmF3ID0gZnVuY3Rpb24oY2FsbFNpdGUpIHsKICAgICAgdmFyIGFyZ3VtZW50cyQxID0gYXJndW1lbnRzOwoNCiAgICAgIHZhciBpID0gMCwNCiAgICAgICAgYnVmID0gW10sDQogICAgICAgIHN0cnMgPSBjYWxsU2l0ZS5yYXcsDQogICAgICAgIGxlbiA9IHN0cnMubGVuZ3RoLA0KICAgICAgICBhcmdzQ250ID0gYXJndW1lbnRzLmxlbmd0aDsNCiAgICAgIHdoaWxlIChpIDwgbGVuKSB7DQogICAgICAgIGJ1Zi5wdXNoKHN0cnNbaSsrXSk7DQogICAgICAgIGlmIChpIDwgYXJnc0NudCAmJiBpIDwgbGVuKSB7DQogICAgICAgICAgYnVmLnB1c2goYXJndW1lbnRzJDFbaV0pOw0KICAgICAgICB9DQogICAgICB9DQogICAgICByZXR1cm4gYnVmLmpvaW4oJycpOw0KICAgIH07DQogIH0NCg0KICB3aW5kb3cuX19maWxlbmFtZSA9IFdTY3JpcHQuU2NyaXB0RnVsbE5hbWU7DQogIHdpbmRvdy5fX2Rpcm5hbWUgPSBfX2ZpbGVuYW1lLm1hdGNoKC8oLiopW1xcL10vKVsxXTsNCg0KICBmdW5jdGlvbiBkZWZpbmVHZXR0ZXIodGFyZ2V0LCBmdW5jRGljdCkgew0KICAgIHZhciBwcm9wcyA9IHt9Ow0KICAgIGZvciAodmFyIGtleSBpbiBmdW5jRGljdCkgew0KICAgICAgaWYgKCF0YXJnZXRba2V5XSkgew0KICAgICAgICBwcm9wc1trZXldID0gew0KICAgICAgICAgIGdldDogZnVuY0RpY3Rba2V5XQ0KICAgICAgICB9Ow0KICAgICAgfQ0KICAgIH0NCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKTsNCiAgfQ0KDQogIHZhciBfdmJzLCBfc2hlbGwsIF9mc28sIF9zaGVsbF9hcHA7DQoNCiAgZGVmaW5lR2V0dGVyKHdpbmRvdywgew0KICAgIF9fVkJTOiBmdW5jdGlvbigpIHsNCiAgICAgIGlmICghX3Zicykgew0KICAgICAgICBfdmJzID0gbmV3IEFjdGl2ZVhPYmplY3QoJ1NjcmlwdENvbnRyb2wnKTsNCiAgICAgICAgX3Zicy5MYW5ndWFnZSA9ICdWQlNjcmlwdCc7DQogICAgICB9DQogICAgICByZXR1cm4gX3ZiczsNCiAgICB9LA0KICAgIF9fV1NoZWxsOiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiBfc2hlbGwgfHwgKF9zaGVsbCA9IG5ldyBBY3RpdmVYT2JqZWN0KCdXU2NyaXB0LlNoZWxsJykpOw0KICAgIH0sDQogICAgX19GU086IGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuIF9mc28gfHwgKF9mc28gPSBuZXcgQWN0aXZlWE9iamVjdCgnU2NyaXB0aW5nLkZpbGVTeXN0ZW1PYmplY3QnKSk7DQogICAgfSwNCiAgICBfX1NoZWxsQXBwOiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiBfc2hlbGxfYXBwIHx8IChfc2hlbGxfYXBwID0gbmV3IEFjdGl2ZVhPYmplY3QoJ1NoZWxsLkFwcGxpY2F0aW9uJykpOw0KICAgIH0NCiAgfSk7DQoNCiAgZnVuY3Rpb24gbG9nJDEobXNnKSB7CiAgICBpZiAoIG1zZyA9PT0gdm9pZCAwICkgbXNnID0gJyc7Cg0KICAgIFdTY3JpcHQuRWNobyhtc2cpOw0KICB9DQoNCiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgZnVuY3Rpb24oKSB7DQogICAgdmFyIHNjcmlwdHMgPSBkb2N1bWVudC5zY3JpcHRzOw0KICAgIHZhciBpID0gLTEsDQogICAgICBsZW4gPSBzY3JpcHRzLmxlbmd0aDsNCiAgICB2YXIgbmFtZSA9IGJhc2VuYW1lKF9fZmlsZW5hbWUpLnJlcGxhY2UoL1wuW14uXSskLywgJycpOw0KICAgIHZhciBmaWxlLCBmb2xkZXI7DQogICAgZm9sZGVyID0gam9pbihfX2Rpcm5hbWUsIG5hbWUgKyAnX3NyYycpOw0KICAgIGlmICghaXNkaXIoZm9sZGVyKSkgeyBta2RpcnNTeW5jKGZvbGRlcik7IH0NCiAgICBsb2ckMSgpOw0KICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgIGZpbGUgPSBqb2luKGZvbGRlciwgaSArICcuanMnKTsNCiAgICAgIG91dHB1dEZpbGVTeW5jKGZpbGUsIHNjcmlwdHNbaV0udGV4dCk7DQogICAgICBsb2ckMSgoInNvdXJjZSAiICsgaSArICI6ICIgKyBmaWxlKSk7DQogICAgfQ0KICB9KTsKCiAgZnVuY3Rpb24gZXhlY1N5bmMoY21kKSB7DQogICAgdmFyIHByb2MgPSBfX1dTaGVsbC5FeGVjKGNtZCk7DQogICAgZm9yICg7Oykgew0KICAgICAgaWYgKHByb2MuU3RhdGVzICE9PSAwKSB7IGJyZWFrOyB9DQogICAgfQ0KICAgIGlmICghcHJvYy5TdGRPdXQuQXRFbmRPZlN0cmVhbSkgew0KICAgICAgcmV0dXJuIHByb2MuU3RkT3V0LlJlYWRBbGwoKTsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBleGVjKGNtZCwgZnVuYykgew0KICAgIHZhciBwcm9jLCBzdGRvdXQsIHN0ZGVycjsNCiAgICB0cnkgew0KICAgICAgcHJvYyA9IF9fV1NoZWxsLkV4ZWMoY21kKTsNCiAgICAgIGZvciAoOzspIHsNCiAgICAgICAgaWYgKHByb2MuU3RhdGVzICE9PSAwKSB7IGJyZWFrOyB9DQogICAgICB9DQogICAgICBpZiAoZnVuYyAmJiB0eXBlb2YgZnVuYyA9PT0gJ2Z1bmN0aW9uJykgew0KICAgICAgICBpZiAoIXByb2MuU3RkT3V0LkF0RW5kT2ZTdHJlYW0pIHsNCiAgICAgICAgICBzdGRvdXQgPSBwcm9jLlN0ZE91dC5SZWFkQWxsKCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFwcm9jLlN0ZEVyci5BdEVuZE9mU3RyZWFtKSB7DQogICAgICAgICAgc3RkZXJyID0gcHJvYy5TdGRFcnIuUmVhZEFsbCgpOw0KICAgICAgICB9DQogICAgICAgIGZ1bmMobnVsbCwgc3Rkb3V0LCBzdGRlcnIpOw0KICAgICAgfQ0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgIGlmIChmdW5jICYmIHR5cGVvZiBmdW5jID09PSAnZnVuY3Rpb24nKSB7DQogICAgICAgIGZ1bmMoZSwgbnVsbCwgbnVsbCk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aHJvdyBlOw0KICAgICAgfQ0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIHJ1bihjbWQsIG9wdGlvbnMpIHsNCiAgICB2YXIgaW50V2luZG93U3R5bGUgPSAxLA0KICAgICAgYldhaXRPblJldHVybiA9IHRydWU7DQogICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsNCiAgICBpZiAob3B0aW9ucy5oaWRlID09PSBmYWxzZSB8fCBvcHRpb25zLmhpZGRlbiA9PT0gZmFsc2UpIHsgaW50V2luZG93U3R5bGUgPSAwOyB9DQogICAgaWYgKG9wdGlvbnMud2FpdCA9PT0gZmFsc2UpIHsgYldhaXRPblJldHVybiA9IGZhbHNlOyB9DQogICAgcmV0dXJuIF9fV1NoZWxsLlJ1bihjbWQsIGludFdpbmRvd1N0eWxlLCBiV2FpdE9uUmV0dXJuKTsNCiAgfQoKICB2YXIgY2hpbGRfcHJvY2VzcyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgIGV4ZWNTeW5jOiBleGVjU3luYywKICAgIGV4ZWM6IGV4ZWMsCiAgICBydW46IHJ1bgogIH0pOwoKICB2YXIgZXNjYXBlID0gZW5jb2RlVVJJQ29tcG9uZW50Ow0KDQogIHZhciB1bmVzY2FwZSA9IGRlY29kZVVSSUNvbXBvbmVudDsNCg0KICBmdW5jdGlvbiBmb3JtYXRWYWx1ZSQxKHZhbHVlKSB7DQogICAgc3dpdGNoICh0eXBlb2YgdmFsdWUpIHsNCiAgICAgIGNhc2UgJ3N0cmluZyc6DQogICAgICAgIHJldHVybiBlbmNvZGVVUklDb21wb25lbnQodmFsdWUpOw0KICAgICAgY2FzZSAnbnVtYmVyJzoNCiAgICAgIGNhc2UgJ2Jvb2xlYW4nOg0KICAgICAgICByZXR1cm4gU3RyaW5nKHZhbHVlKTsNCiAgICAgIGRlZmF1bHQ6DQogICAgICAgIHJldHVybiAnJzsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBzdHJpbmdpZnkob2JqLCBzZXAsIGVxKSB7DQogICAgaWYgKCFvYmopIHsgcmV0dXJuICcnOyB9DQogICAgc2VwIHx8IChzZXAgPSAnJicpOw0KICAgIGVxIHx8IChlcSA9ICc9Jyk7DQogICAgdmFyIGJ1ZiA9IFtdLA0KICAgICAgdmFsdWUsDQogICAgICBpLA0KICAgICAgbGVuOw0KICAgIGZvciAodmFyIGtleSBpbiBvYmopIHsNCiAgICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoa2V5KSkgew0KICAgICAgICB2YWx1ZSA9IG9ialtrZXldOw0KICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHsNCiAgICAgICAgICAoaSA9IC0xKSwgKGxlbiA9IHZhbHVlLmxlbmd0aCk7DQogICAgICAgICAgd2hpbGUgKCsraSA8IGxlbikgew0KICAgICAgICAgICAgYnVmLnB1c2goa2V5ICsgZXEgKyBmb3JtYXRWYWx1ZSQxKHZhbHVlW2ldKSk7DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGJ1Zi5wdXNoKGtleSArIGVxICsgZm9ybWF0VmFsdWUkMSh2YWx1ZSkpOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiBidWYuam9pbihzZXApOw0KICB9DQoNCiAgZnVuY3Rpb24gcGFyc2UkMShzdHIsIHNlcCwgZXEpIHsNCiAgICBzZXAgfHwgKHNlcCA9ICcmJyk7DQogICAgZXEgfHwgKGVxID0gJz0nKTsNCiAgICB2YXIgYnVmID0gc3RyLnNwbGl0KHNlcCk7DQogICAgdmFyIGkgPSAtMSwNCiAgICAgIGxlbiA9IGJ1Zi5sZW5ndGgsDQogICAgICByZXN1bHQgPSB7fSwNCiAgICAgIGtleURpY3QgPSB7fSwNCiAgICAgIHBhaXIsDQogICAgICBrZXksDQogICAgICB2YWx1ZTsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICBwYWlyID0gYnVmW2ldLnNwbGl0KGVxKTsNCiAgICAgIGtleSA9IHBhaXJbMF07DQogICAgICB2YWx1ZSA9IHBhaXJbMV07DQogICAgICBpZiAoa2V5RGljdFtrZXldKSB7DQogICAgICAgIGlmIChrZXlEaWN0W2tleV0gPT09IDEpIHsNCiAgICAgICAgICBrZXlEaWN0W2tleV0gPSAyOw0KICAgICAgICAgIHJlc3VsdFtrZXldID0gW3Jlc3VsdFtrZXldLCB2YWx1ZV07DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmVzdWx0W2tleV0ucHVzaCh2YWx1ZSk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGtleURpY3Rba2V5XSA9IDE7DQogICAgICAgIHJlc3VsdFtrZXldID0gdmFsdWU7DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiByZXN1bHQ7DQogIH0KCiAgdmFyIHF1ZXJ5c3RyaW5nID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgZXNjYXBlOiBlc2NhcGUsCiAgICB1bmVzY2FwZTogdW5lc2NhcGUsCiAgICBzdHJpbmdpZnk6IHN0cmluZ2lmeSwKICAgIHBhcnNlOiBwYXJzZSQxCiAgfSk7CgogIHZhciBCSU5fVFlQRVMgPSBbJ2FycmF5YnVmZmVyJywgJ2Jsb2InXTsNCg0KICBmdW5jdGlvbiByZXF1ZXN0KG9wdGlvbnMpIHsNCiAgICB2YXIgaHR0cCwgdXJpLCBtZXRob2QsIHRpbWVvdXQ7DQogICAgaHR0cCA9IG5ldyBBY3RpdmVYT2JqZWN0KCdXaW5IdHRwLldpbkh0dHBSZXF1ZXN0LjUuMScpOw0KICAgIHVyaSA9IG9wdGlvbnMudXJpIHx8IG9wdGlvbnMudXJsIHx8IG9wdGlvbnMucGF0aDsNCiAgICBtZXRob2QgPSAob3B0aW9ucy5tZXRob2QgfHwgJ0dFVCcpLnRvVXBwZXJDYXNlKCk7DQogICAgdGltZW91dCA9IG9wdGlvbnMudGltZW91dCB8fCAzMDAwOw0KICAgIGh0dHAuc2V0VGltZW91dHModGltZW91dCwgdGltZW91dCwgdGltZW91dCwgdGltZW91dCk7DQoNCiAgICB0cnkgew0KICAgICAgdmFyIGRhdGEgPSBvcHRpb25zLmZvcm0gfHwgb3B0aW9ucy5kYXRhIHx8IG51bGw7DQogICAgICBpZiAoZGF0YSAmJiB0eXBlb2YgZGF0YSAhPT0gJ3N0cmluZycpIHsgZGF0YSA9IHN0cmluZ2lmeShkYXRhKTsgfQ0KICAgICAgaWYgKGRhdGEpIHsNCiAgICAgICAgaWYgKG1ldGhvZCA9PT0gJ0dFVCcpIHsNCiAgICAgICAgICBodHRwLm9wZW4obWV0aG9kLCB1cmkgKyAnPycgKyBkYXRhLCBmYWxzZSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgaHR0cC5vcGVuKG1ldGhvZCwgdXJpLCBmYWxzZSk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGh0dHAub3BlbihtZXRob2QsIHVyaSwgZmFsc2UpOw0KICAgICAgfQ0KICAgICAgYXBwbHlPcHRpb25zKGh0dHAsIG9wdGlvbnMpOw0KICAgICAgaHR0cC5zZW5kKGRhdGEpOw0KDQogICAgICByZXR1cm4gew0KICAgICAgICBzdGF0dXNDb2RlOiBodHRwLnN0YXR1cywNCiAgICAgICAgaGVhZGVyczogcGFyc2VIZWFkZXJzKGh0dHAuZ2V0QWxsUmVzcG9uc2VIZWFkZXJzKCkpLA0KICAgICAgICBib2R5OiBCSU5fVFlQRVMuaW5jbHVkZXMob3B0aW9ucy5yZXNwb25zZVR5cGUpDQogICAgICAgICAgPyBCdWZmZXIuZnJvbShodHRwLlJlc3BvbnNlQm9keSkNCiAgICAgICAgICA6IGh0dHAuUmVzcG9uc2VUZXh0DQogICAgICB9Ow0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgIHRocm93IGU7DQogICAgfQ0KICB9DQogIC8qDQogIFdpbkh0dHBSZXF1ZXN0T3B0aW9uDQogICAgVXNlckFnZW50U3RyaW5nID0gMA0KICAgIFVSTCA9IDENCiAgICBVUkxDb2RlUGFnZSA9IDINCiAgICBFc2NhcGVQZXJjZW50SW5VUkwgPSAzDQogICAgU3NsRXJyb3JJZ25vcmVGbGFncyA9IDQNCiAgICBTZWxlY3RDZXJ0aWZpY2F0ZSA9IDUNCiAgICBFbmFibGVSZWRpcmVjdHMgPSA2DQogICAgVXJsRXNjYXBlRGlzYWJsZSA9IDcNCiAgICBVcmxFc2NhcGVEaXNhYmxlUXVlcnkgPSA4DQogICAgU2VjdXJlUHJvdG9jb2xzID0gOQ0KICAgIEVuYWJsZVRyYWNpbmcgPSAxMA0KICAgIFJldmVydEltcGVyc29uYXRpb25PdmVyU3NsID0gMTENCiAgICBFbmFibGVIdHRwc1RvSHR0cFJlZGlyZWN0cyA9IDEyDQogICAgRW5hYmxlUGFzc3BvcnRBdXRoZW50aWNhdGlvbiA9IDEzDQogICAgTWF4QXV0b21hdGljUmVkaXJlY3RzID0gMTQNCiAgICBNYXhSZXNwb25zZUhlYWRlclNpemUgPSAxNQ0KICAgIE1heFJlc3BvbnNlRHJhaW5TaXplID0gMTYNCiAgICBFbmFibGVIdHRwMV8xID0gMTcNCiAgICBFbmFibGVDZXJ0aWZpY2F0ZVJldm9jYXRpb25DaGVjayA9IDE4DQogICovDQogIHZhciBzZXRSZXFPcHRzID0gRnVuY3Rpb24oDQogICAgJ2h0dHAnLA0KICAgICJcbmh0dHAuT3B0aW9uKDApID0gJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgVHJpZGVudC83LjA7IHJ2OjExLjApIGxpa2UgR2Vja28nO1xuaHR0cC5PcHRpb24oNCkgPSAxMzA1Njtcbmh0dHAuT3B0aW9uKDYpID0gZmFsc2U7Ig0KICApOw0KDQogIGZ1bmN0aW9uIGFwcGx5T3B0aW9ucyhodHRwLCBvcHRpb25zKSB7DQogICAgaWYgKG9wdGlvbnMucHJveHkpIHsNCiAgICAgIHNldFJlcU9wdHMoaHR0cCk7DQogICAgICBodHRwLnNldFByb3h5KCcyJywgb3B0aW9ucy5wcm94eSk7DQogICAgICAvLyBodHRwLlNldENsaWVudENlcnRpZmljYXRlKCJMT0NBTF9NQUNISU5FXFBlcnNvbmFsXE15IENlcnRpZmljYXRlIikNCiAgICAgIC8vIGh0dHAuU2V0Q3JlZGVudGlhbHMoJ3VzZXInLCAncGFzcycsIDEpOw0KICAgIH0NCg0KICAgIGlmIChvcHRpb25zLm1ldGhvZCAhPT0gJ0dFVCcpIHsNCiAgICAgIGh0dHAuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcpOw0KICAgIH0NCg0KICAgIHZhciBoZWFkZXJzID0gb3B0aW9ucy5oZWFkZXJzOw0KICAgIGlmIChoZWFkZXJzKSB7DQogICAgICBmb3IgKHZhciBrZXkgaW4gaGVhZGVycykgew0KICAgICAgICBpZiAoa2V5LnRvTG93ZXJDYXNlKCkgPT0gJ2Nvb2tpZScpIHsNCiAgICAgICAgICBodHRwLnNldFJlcXVlc3RIZWFkZXIoJ0Nvb2tpZScsICdzdHJpbmcnKTsNCiAgICAgICAgICBodHRwLnNldFJlcXVlc3RIZWFkZXIoJ0Nvb2tpZScsIGhlYWRlcnNba2V5XSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgaHR0cC5zZXRSZXF1ZXN0SGVhZGVyKGtleSwgaGVhZGVyc1trZXldKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIHBhcnNlSGVhZGVycyhzdHJfaGVhZGVycykgew0KICAgIHZhciByZXN1bHQgPSB7fSwNCiAgICAgIGhlYWRlcnMsDQogICAgICBpLA0KICAgICAgaywNCiAgICAgIHY7DQogICAgaGVhZGVycyA9IHN0cl9oZWFkZXJzLnRyaW0oKS5zcGxpdCgvXHI/XG4vKTsNCiAgICBoZWFkZXJzLmZvckVhY2goZnVuY3Rpb24gKGhlYWRlcikgew0KICAgICAgaSA9IGhlYWRlci5pbmRleE9mKCc6Jyk7DQogICAgICBrID0gaGVhZGVyLnNsaWNlKDAsIGkpLnRyaW0oKTsNCiAgICAgIHYgPSBoZWFkZXIuc2xpY2UoaSArIDEpLnRyaW0oKTsNCiAgICAgIGlmIChrLnRvTG93ZXJDYXNlKCkgPT0gJ3NldC1jb29raWUnKSB7DQogICAgICAgIGlmIChyZXN1bHRba10pIHsgcmVzdWx0W2tdLnB1c2godik7IH0NCiAgICAgICAgZWxzZSB7IHJlc3VsdFtrXSA9IFt2XTsgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmVzdWx0W2tdID0gdjsNCiAgICAgIH0NCiAgICB9KTsNCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9DQoNCiAgZnVuY3Rpb24gZ2V0T3B0aW9uKGFyZ3MpIHsNCiAgICB2YXIgb3B0aW9uczsNCiAgICBpZiAodHlwZW9mIGFyZ3NbMF0gPT09ICdzdHJpbmcnKSB7DQogICAgICBvcHRpb25zID0gYXJnc1sxXSB8fCB7fTsNCiAgICAgIG9wdGlvbnMudXJpID0gYXJnc1swXTsNCiAgICB9IGVsc2Ugew0KICAgICAgb3B0aW9ucyA9IGFyZ3NbMF0gfHwge307DQogICAgfQ0KICAgIHJldHVybiBvcHRpb25zOw0KICB9DQoNCiAgdmFyIGh0dHAgPSB7DQogICAgcmVxdWVzdDogZnVuY3Rpb24oKSB7DQogICAgICByZXR1cm4gcmVxdWVzdChnZXRPcHRpb24oYXJndW1lbnRzKSk7DQogICAgfSwNCiAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgdmFyIG9wdGlvbnMgPSBnZXRPcHRpb24oYXJndW1lbnRzKTsNCiAgICAgIG9wdGlvbnMubWV0aG9kID0gJ0dFVCc7DQogICAgICByZXR1cm4gcmVxdWVzdChvcHRpb25zKTsNCiAgICB9LA0KICAgIHBvc3Q6IGZ1bmN0aW9uKCkgew0KICAgICAgdmFyIG9wdGlvbnMgPSBnZXRPcHRpb24oYXJndW1lbnRzKTsNCiAgICAgIG9wdGlvbnMubWV0aG9kID0gJ1BPU1QnOw0KICAgICAgcmV0dXJuIHJlcXVlc3Qob3B0aW9ucyk7DQogICAgfQ0KICB9OwoKICB2YXIgaHR0cCQxID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgJ2RlZmF1bHQnOiBodHRwCiAgfSk7CgogIGZ1bmN0aW9uIF9jaXBoZXIoZW5jLCBidWZfcGFzc3dvcmQsIGJ1Zl9kYXRhKSB7DQogICAgdmFyIGNyeXB0ID0gbmV3IEFjdGl2ZVhPYmplY3QoJ1N5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHkuUmlqbmRhZWxNYW5hZ2VkJyk7DQogICAgdmFyIGtleUhhc2ggPSBuZXcgQWN0aXZlWE9iamVjdCgnU3lzdGVtLlNlY3VyaXR5LkNyeXB0b2dyYXBoeS5TSEEyNTZNYW5hZ2VkJyk7DQogICAga2V5SGFzaC5Db21wdXRlSGFzaF8yKGJ1Zl9wYXNzd29yZC5idWZmZXIpOw0KICAgIGNyeXB0LktleSA9IGtleUhhc2guSGFzaDsNCiAgICBrZXlIYXNoLkNsZWFyKCk7DQoNCiAgICB2YXIgaXZIYXNoID0gbmV3IEFjdGl2ZVhPYmplY3QoDQogICAgICAnU3lzdGVtLlNlY3VyaXR5LkNyeXB0b2dyYXBoeS5NRDVDcnlwdG9TZXJ2aWNlUHJvdmlkZXInDQogICAgKTsNCiAgICBpdkhhc2guQ29tcHV0ZUhhc2hfMihidWZfcGFzc3dvcmQuYnVmZmVyKTsNCiAgICBjcnlwdC5JViA9IGl2SGFzaC5IYXNoOw0KICAgIGl2SGFzaC5DbGVhcigpOw0KDQogICAgdmFyIGRzdCA9IG51bGw7DQogICAgdmFyIHRzID0gZW5jID8gY3J5cHQuQ3JlYXRlRW5jcnlwdG9yKCkgOiBjcnlwdC5DcmVhdGVEZWNyeXB0b3IoKTsNCiAgICB0cnkgew0KICAgICAgZHN0ID0gdHMuVHJhbnNmb3JtRmluYWxCbG9jayhidWZfZGF0YS5idWZmZXIsIDAsIGJ1Zl9kYXRhLmxlbmd0aCk7DQogICAgfSBmaW5hbGx5IHsNCiAgICAgIGNyeXB0LkNsZWFyKCk7DQogICAgfQ0KICAgIHJldHVybiBkc3Q7DQogIH0NCg0KICB2YXIgQ2lwaGVyID0gZnVuY3Rpb24gQ2lwaGVyKGFsZ29yaXRobSwgcGFzc3dvcmQsIGlzRW5jb2RlKSB7DQogICAgdGhpcy5hbGdvcml0aG0gPSBhbGdvcml0aG07DQogICAgdGhpcy5wYXNzd29yZCA9IHBhc3N3b3JkOw0KICAgIHRoaXMuaXNFbmNvZGUgPSBpc0VuY29kZTsNCiAgICB0aGlzLmRhdGEgPSBudWxsOw0KICAgIHRoaXMuaW5wdXRFbmNvZGluZyA9IG51bGw7DQogICAgdGhpcy5vdXRwdXRFbmNvZGluZyA9IG51bGw7DQogIH07DQoNCiAgQ2lwaGVyLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiB1cGRhdGUgKGRhdGEsIGlucHV0RW5jb2RpbmcsIG91dHB1dEVuY29kaW5nKSB7DQogICAgdGhpcy5kYXRhID0gZGF0YTsNCiAgICBpZiAoaW5wdXRFbmNvZGluZykgeyB0aGlzLmlucHV0RW5jb2RpbmcgPSBpbnB1dEVuY29kaW5nOyB9DQogICAgaWYgKG91dHB1dEVuY29kaW5nKSB7IHRoaXMub3V0cHV0RW5jb2RpbmcgPSBvdXRwdXRFbmNvZGluZzsgfQ0KICAgIHJldHVybiB0aGlzOw0KICB9Ow0KDQogIENpcGhlci5wcm90b3R5cGUuZmluYWwgPSBmdW5jdGlvbiBmaW5hbCAob3V0cHV0RW5jb2RpbmcpIHsNCiAgICBpZiAob3V0cHV0RW5jb2RpbmcpIHsgdGhpcy5vdXRwdXRFbmNvZGluZyA9IG91dHB1dEVuY29kaW5nOyB9DQogICAgdmFyIGJ5dGVzID0gX2NpcGhlcigNCiAgICAgIHRoaXMuaXNFbmNvZGUsDQogICAgICBCdWZmZXIuZnJvbSh0aGlzLnBhc3N3b3JkKSwNCiAgICAgIEJ1ZmZlci5mcm9tKHRoaXMuZGF0YSwgdGhpcy5pbnB1dEVuY29kaW5nKQ0KICAgICk7DQogICAgaWYgKHRoaXMub3V0cHV0RW5jb2RpbmcgPT0gbnVsbCB8fCB0aGlzLm91dHB1dEVuY29kaW5nID09ICdiaW5hcnknKSB7DQogICAgICByZXR1cm4gQnVmZmVyLmZyb20oYnl0ZXMpOw0KICAgIH0gZWxzZSB7DQogICAgICByZXR1cm4gQnVmZmVyLmZyb20oYnl0ZXMpLnRvU3RyaW5nKHRoaXMub3V0cHV0RW5jb2RpbmcpOw0KICAgIH0NCiAgfTsNCg0KICBmdW5jdGlvbiBfaGFzaChvYmpuYW1lLCBidWZfZGF0YSwgb3B0X3R5cGUpIHsNCiAgICB2YXIgcHJvdmlkZXIgPSBuZXcgQWN0aXZlWE9iamVjdChvYmpuYW1lKTsNCiAgICBwcm92aWRlci5Db21wdXRlSGFzaF8yKGJ1Zl9kYXRhLmJ1ZmZlcik7DQogICAgdmFyIGhhc2hzID0gcHJvdmlkZXIuSGFzaDsNCiAgICBwcm92aWRlci5DbGVhcigpOw0KICAgIHJldHVybiBCdWZmZXIuZnJvbShoYXNocykudG9TdHJpbmcob3B0X3R5cGUgfHwgJ2hleCcpOw0KICB9DQoNCiAgdmFyIEhhc2ggPSBmdW5jdGlvbiBIYXNoKGFsZ29yaXRobSkgew0KICAgIHRoaXMuYWxnb3JpdGhtID0gYWxnb3JpdGhtOw0KICAgIHRoaXMuZGF0YSA9IG51bGw7DQogICAgdGhpcy5pbnB1dEVuY29kaW5nID0gbnVsbDsNCiAgfTsNCg0KICBIYXNoLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiB1cGRhdGUgKGRhdGEsIGlucHV0RW5jb2RpbmcpIHsKICAgICAgaWYgKCBpbnB1dEVuY29kaW5nID09PSB2b2lkIDAgKSBpbnB1dEVuY29kaW5nID0gJ3V0Zi04JzsKDQogICAgdGhpcy5pbnB1dEVuY29kaW5nID0gaW5wdXRFbmNvZGluZzsNCiAgICB0aGlzLmRhdGEgPSBkYXRhOw0KICAgIHJldHVybiB0aGlzOw0KICB9Ow0KDQogIEhhc2gucHJvdG90eXBlLmRpZ2VzdCA9IGZ1bmN0aW9uIGRpZ2VzdCAoZW5jb2RpbmcpIHsNCiAgICBpZiAodGhpcy5hbGdvcml0aG0gPT0gJ21kNScpIHsNCiAgICAgIHJldHVybiBfaGFzaCgNCiAgICAgICAgJ1N5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHkuTUQ1Q3J5cHRvU2VydmljZVByb3ZpZGVyJywNCiAgICAgICAgQnVmZmVyLmZyb20odGhpcy5kYXRhLCB0aGlzLmlucHV0RW5jb2RpbmcpLA0KICAgICAgICBlbmNvZGluZw0KICAgICAgKTsNCiAgICB9IGVsc2UgaWYgKHRoaXMuYWxnb3JpdGhtID09ICdzaGExJykgew0KICAgICAgcmV0dXJuIF9oYXNoKA0KICAgICAgICAnU3lzdGVtLlNlY3VyaXR5LkNyeXB0b2dyYXBoeS5TSEExQ3J5cHRvU2VydmljZVByb3ZpZGVyJywNCiAgICAgICAgQnVmZmVyLmZyb20odGhpcy5kYXRhLCB0aGlzLmlucHV0RW5jb2RpbmcpLA0KICAgICAgICBlbmNvZGluZw0KICAgICAgKTsNCiAgICB9DQogIH07DQoNCiAgdmFyIGNyeXB0byA9IHsNCiAgICBjcmVhdGVDaXBoZXI6IGZ1bmN0aW9uKGFsZ29yaXRobSwgcGFzc3dvcmQpIHsNCiAgICAgIHJldHVybiBuZXcgQ2lwaGVyKGFsZ29yaXRobSwgcGFzc3dvcmQsIHRydWUpOw0KICAgIH0sDQoNCiAgICBjcmVhdGVEZUNpcGhlcjogZnVuY3Rpb24oYWxnb3JpdGhtLCBwYXNzd29yZCkgew0KICAgICAgcmV0dXJuIG5ldyBDaXBoZXIoYWxnb3JpdGhtLCBwYXNzd29yZCwgZmFsc2UpOw0KICAgIH0sDQoNCiAgICBjcmVhdGVIYXNoOiBmdW5jdGlvbihhbGdvcml0aG0pIHsNCiAgICAgIHJldHVybiBuZXcgSGFzaChhbGdvcml0aG0pOw0KICAgIH0NCiAgfTsKCiAgdmFyIGNyeXB0byQxID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgQ2lwaGVyOiBDaXBoZXIsCiAgICAnZGVmYXVsdCc6IGNyeXB0bwogIH0pOwoKICB2YXIgREVGQVVMVF9PUFRJT05TID0gew0KICAgIGhlYWRlcnM6IGZhbHNlLA0KICAgIGRlbGltaXRlcjogJywnLA0KICAgIHF1b3RlOiAnIicsDQogICAgZXNjYXBlOiAnIicsDQogICAgdHJpbTogZmFsc2UsDQogICAgcnRyaW06IGZhbHNlLA0KICAgIGx0cmltOiBmYWxzZSwNCiAgICBuZXdsaW5lOiAnXHJcbicNCiAgfTsNCg0KICB2YXIgRU1QVFlfQ0hBUl9SRUdFWFAgPSAvXHMvOw0KDQogIGZ1bmN0aW9uIFBhcnNlcihvcHRpb25zKSB7DQogICAgT2JqZWN0LmFzc2lnbih0aGlzLCBERUZBVUxUX09QVElPTlMpOw0KICAgIGlmIChvcHRpb25zICE9IG51bGwgJiYgdHlwZW9mIG9wdGlvbnMgPT0gJ29iamVjdCcpIHsNCiAgICAgIE9iamVjdC5hc3NpZ24odGhpcywgb3B0aW9ucyk7DQogICAgfQ0KICB9DQoNCiAgdmFyIFBQID0gUGFyc2VyLnByb3RvdHlwZTsNCg0KICBQUC5pbml0ID0gZnVuY3Rpb24oKSB7DQogICAgdGhpcy5yb3dzID0gW107DQogICAgdGhpcy5yb3cgPSBbXTsNCiAgICB0aGlzLmN1cnNvciA9IDA7DQogICAgdGhpcy5wb3MgPSAwOw0KICAgIHRoaXMuYnVmID0gW107DQogICAgdGhpcy5idWZMZW4gPSAwOw0KICAgIHRoaXMuZXNjYXBpbmcgPSBmYWxzZTsNCiAgfTsNCg0KICBQUC5wYXJzZSA9IGZ1bmN0aW9uIGZyb21TdHJpbmcoc3RyKSB7DQogICAgdmFyIGkgPSAwLA0KICAgICAgbGVuID0gc3RyLmxlbmd0aDsNCiAgICB0aGlzLmluaXQoKTsNCiAgICBmb3IgKDsgaSA8IGxlbjsgaSsrKSB7DQogICAgICB0aGlzLl9jaGFyKHN0ci5jaGFyQXQoaSkpOw0KICAgIH0NCiAgICByZXR1cm4gdGhpcy5fZ2V0UmVzdWx0KCk7DQogIH07DQoNCiAgUFAuX2dldFJlc3VsdCA9IGZ1bmN0aW9uKCkgew0KICAgIHZhciByZXN1bHQsIGhlYWRlcnMsIGxlbjsNCiAgICBpZiAodGhpcy5wb3MgIT09IHRoaXMuY3Vyc29yKSB7DQogICAgICB0aGlzLl9yb3coKTsNCiAgICB9DQogICAgbGVuID0gdGhpcy5yb3dzLmxlbmd0aDsNCiAgICByZXN1bHQgPSB0aGlzLnJvd3M7DQogICAgaWYgKHRoaXMuaGVhZGVycyA9PT0gdHJ1ZSAmJiBsZW4gPiAxKSB7DQogICAgICBoZWFkZXJzID0gdGhpcy5yb3dzWzBdOw0KICAgICAgdGhpcy5yb3dzLnNoaWZ0KCk7DQogICAgfSBlbHNlIGlmIChpc0FycmF5KHRoaXMuaGVhZGVycykgJiYgbGVuID4gMCkgew0KICAgICAgaGVhZGVycyA9IHRoaXMuaGVhZGVyczsNCiAgICB9DQogICAgaWYgKGhlYWRlcnMgJiYgaGVhZGVycy5sZW5ndGggPiAwKSB7DQogICAgICByZXN1bHQgPSB0aGlzLnJvd3MubWFwKGZ1bmN0aW9uIChyb3cpIHsgcmV0dXJuIHppcE9iamVjdChoZWFkZXJzLCByb3cpOyB9KTsNCiAgICB9DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfTsNCg0KICBQUC5fY2hhciA9IGZ1bmN0aW9uKGMpIHsNCiAgICBpZiAoYyA9PT0gdGhpcy5kZWxpbWl0ZXIgJiYgIXRoaXMuZXNjYXBpbmcpIHsNCiAgICAgIHRoaXMuX2NlbGwoKTsNCiAgICB9IGVsc2UgaWYgKGMgPT09IHRoaXMucXVvdGUpIHsNCiAgICAgIHRoaXMuX3B1c2goYyk7DQogICAgICB0aGlzLl9xdW90ZSgpOw0KICAgIH0gZWxzZSBpZiAoYyA9PT0gdGhpcy5lc2NhcGUpIHsNCiAgICAgIHRoaXMuX3B1c2goYyk7DQogICAgICB0aGlzLl9lc2NhcGUoKTsNCiAgICB9IGVsc2UgaWYgKGMgPT09ICdcbicgJiYgIXRoaXMuZXNjYXBpbmcpIHsNCiAgICAgIHRoaXMuX3JvdygpOw0KICAgIH0gZWxzZSB7DQogICAgICB0aGlzLl9wdXNoKGMpOw0KICAgIH0NCg0KICAgIHRoaXMuY3Vyc29yKys7DQogIH07DQoNCiAgUFAuX3B1c2ggPSBmdW5jdGlvbihjKSB7DQogICAgaWYgKHRoaXMuYnVmTGVuID09PSAwKSB7DQogICAgICBpZiAoKHRoaXMudHJpbSB8fCB0aGlzLmx0cmltKSAmJiBFTVBUWV9DSEFSX1JFR0VYUC50ZXN0KGMpKSB7IHJldHVybjsgfQ0KICAgICAgaWYgKGMgPT09IHRoaXMucXVvdGUpIHsgcmV0dXJuOyB9DQogICAgfQ0KICAgIHRoaXMuYnVmW3RoaXMuYnVmTGVuXSA9IGM7DQogICAgdGhpcy5idWZMZW4rKzsNCiAgfTsNCg0KICBQUC5fY2VsbCA9IGZ1bmN0aW9uKCkgew0KICAgIHZhciBpdGVtID0gdGhpcy5fZ2V0VmFsdWUoKTsNCiAgICB0aGlzLnJvdy5wdXNoKGl0ZW0pOw0KICB9Ow0KDQogIFBQLl9nZXRWYWx1ZSA9IGZ1bmN0aW9uKCkgew0KICAgIHZhciByZXN1bHQsIGMsIGk7DQogICAgaSA9IHRoaXMuYnVmTGVuOw0KICAgIHdoaWxlIChpLS0pIHsNCiAgICAgIGMgPSB0aGlzLmJ1ZltpXTsNCiAgICAgIGlmIChFTVBUWV9DSEFSX1JFR0VYUC50ZXN0KGMpKSB7DQogICAgICAgIGlmICh0aGlzLnRyaW0gfHwgdGhpcy5ydHJpbSkgew0KICAgICAgICAgIHRoaXMuYnVmW2ldID0gJyc7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGlmIChjID09PSB0aGlzLnF1b3RlKSB7DQogICAgICAgICAgdGhpcy5idWZbaV0gPSAnJzsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgICByZXN1bHQgPSB0aGlzLmJ1Zi5qb2luKCcnKTsNCiAgICB0aGlzLmJ1Zi5sZW5ndGggPSAwOw0KICAgIHRoaXMuYnVmTGVuID0gMDsNCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9Ow0KDQogIFBQLl9yb3cgPSBmdW5jdGlvbigpIHsNCiAgICBpZiAodGhpcy5idWZMZW4gPiAwICYmIHRoaXMuYnVmW3RoaXMuYnVmTGVuIC0gMV0gPT09ICdccicpIHsNCiAgICAgIHRoaXMuYnVmW3RoaXMuYnVmTGVuIC0gMV0gPSAnJzsNCiAgICB9DQogICAgdGhpcy5fY2VsbCgpOw0KICAgIHRoaXMucm93cy5wdXNoKHRoaXMucm93KTsNCiAgICB0aGlzLnJvdyA9IFtdOw0KICAgIHRoaXMucG9zID0gdGhpcy5jdXJzb3I7DQogIH07DQoNCiAgUFAuX3F1b3RlID0gZnVuY3Rpb24oKSB7DQogICAgdGhpcy5lc2NhcGluZyA9ICF0aGlzLmVzY2FwaW5nOw0KICAgIGlmICh0aGlzLmJ1ZkxlbiA+IDEgJiYgdGhpcy5idWZbdGhpcy5idWZMZW4gLSAyXSA9PT0gdGhpcy5lc2NhcGUpIHsNCiAgICAgIHRoaXMuYnVmW3RoaXMuYnVmTGVuIC0gMl0gPSB0aGlzLmJ1Zlt0aGlzLmJ1ZkxlbiAtIDFdOw0KICAgICAgdGhpcy5idWZbdGhpcy5idWZMZW4gLSAxXSA9ICcnOw0KICAgIH0NCiAgfTsNCg0KICBQUC5fZXNjYXBlID0gZnVuY3Rpb24oKSB7DQogICAgdGhpcy5lc2NhcGluZyA9ICF0aGlzLmVzY2FwaW5nOw0KICB9Ow0KDQogIGZ1bmN0aW9uIGNyZWF0ZVBhcnNlcihvcHRpb25zKSB7DQogICAgcmV0dXJuIG5ldyBQYXJzZXIob3B0aW9ucyk7DQogIH0NCg0KICBmdW5jdGlvbiBwYXJzZSQyKHN0ciwgb3B0aW9ucykgew0KICAgIHJldHVybiBuZXcgUGFyc2VyKG9wdGlvbnMpLnBhcnNlKHN0cik7DQogIH0NCg0KICBmdW5jdGlvbiBGb3JtYXR0ZXIob3B0aW9ucykgew0KICAgIE9iamVjdC5hc3NpZ24odGhpcywgREVGQVVMVF9PUFRJT05TKTsNCiAgICBpZiAob3B0aW9ucyAhPSBudWxsICYmIHR5cGVvZiBvcHRpb25zID09ICdvYmplY3QnKQ0KICAgICAgeyBPYmplY3QuYXNzaWduKHRoaXMsIG9wdGlvbnMpOyB9DQogIH0NCg0KICB2YXIgRlAgPSBGb3JtYXR0ZXIucHJvdG90eXBlOw0KDQogIEZQLmluaXQgPSBmdW5jdGlvbigpIHsNCiAgICB0aGlzLnJvd3MgPSBbXTsNCiAgfTsNCg0KICBGUC5zdHJpbmdpZnkgPSBmdW5jdGlvbihkYXRhKSB7DQogICAgdmFyIHJvdywgaSwgbGVuLCByb3dEYXRhSXNBcnJheTsNCiAgICB0aGlzLmluaXQoKTsNCiAgICBpZiAoaXNBcnJheSh0aGlzLmhlYWRlcnMpKSB7DQogICAgICB0aGlzLl9hcHBlbmRMaW5lKHRoaXMuaGVhZGVycyk7DQogICAgfQ0KICAgIGxlbiA9IGlzQXJyYXkoZGF0YSkgJiYgZGF0YS5sZW5ndGg7DQogICAgaWYgKGxlbiAmJiBsZW4gPiAwKSB7DQogICAgICBpID0gMDsNCiAgICAgIHJvdyA9IGRhdGFbMF07DQogICAgICByb3dEYXRhSXNBcnJheSA9IGlzQXJyYXkocm93KTsNCiAgICAgIGlmIChyb3dEYXRhSXNBcnJheSkgew0KICAgICAgICBpZiAodGhpcy5oZWFkZXJzID09PSB0cnVlKSB7DQogICAgICAgICAgdGhpcy5oZWFkZXJzID0gcm93Ow0KICAgICAgICAgIHRoaXMuX2FwcGVuZExpbmUodGhpcy5oZWFkZXJzKTsNCiAgICAgICAgICBpID0gMTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy5oZWFkZXJzID0gT2JqZWN0LmtleXMocm93KTsNCiAgICAgICAgdGhpcy5fYXBwZW5kTGluZSh0aGlzLmhlYWRlcnMpOw0KICAgICAgfQ0KDQogICAgICBmb3IgKDsgaSA8IGxlbjsgaSsrKSB7DQogICAgICAgIHJvdyA9IGRhdGFbaV07DQogICAgICAgIGlmIChyb3dEYXRhSXNBcnJheSkgeyB0aGlzLl9hcHBlbmRMaW5lKHJvdyk7IH0NCiAgICAgICAgZWxzZSB7IHRoaXMuX2FwcGVuZExpbmUobWFwKHJvdykpOyB9DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiB0aGlzLl9nZXRSZXN1bHQoKTsNCiAgfTsNCg0KICBGUC5fYXBwZW5kTGluZSA9IGZ1bmN0aW9uKHJvdykgew0KICAgIHZhciBxdW90ZSA9IHRoaXMucXVvdGU7DQogICAgdmFyIGVzY2FwZV9xdW90ZSA9IHRoaXMuZXNjYXBlICsgcXVvdGU7DQogICAgdmFyIHF1b3RlUmVnZXhwID0gLyIvZzsNCiAgICB2YXIgbGluZSA9IHJvdw0KICAgICAgLm1hcChmdW5jdGlvbiAoaXRlbSkgew0KICAgICAgICBpZiAoaXRlbSA9PSBudWxsKSB7DQogICAgICAgICAgcmV0dXJuICcnOw0KICAgICAgICB9IGVsc2UgaWYgKGlzU3RyaW5nKGl0ZW0pKSB7DQogICAgICAgICAgaWYgKGl0ZW0uaW5jbHVkZXMocXVvdGUpKSB7DQogICAgICAgICAgICByZXR1cm4gcXVvdGUgKyBpdGVtLnJlcGxhY2UocXVvdGVSZWdleHAsIGVzY2FwZV9xdW90ZSkgKyBxdW90ZTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIGl0ZW07DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiBpdGVtICsgJyc7DQogICAgICAgIH0NCiAgICAgIH0pDQogICAgICAuam9pbih0aGlzLmRlbGltaXRlcik7DQogICAgdGhpcy5yb3dzLnB1c2gobGluZSk7DQogIH07DQoNCiAgRlAuX2dldFJlc3VsdCA9IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiB0aGlzLnJvd3Muam9pbih0aGlzLm5ld2xpbmUpOw0KICB9Ow0KDQogIGZ1bmN0aW9uIGNyZWF0ZUZvcm1hdHRlcihvcHRpb25zKSB7DQogICAgcmV0dXJuIG5ldyBGb3JtYXR0ZXIob3B0aW9ucyk7DQogIH0NCg0KICBmdW5jdGlvbiBzdHJpbmdpZnkkMShkYXRhLCBvcHRpb25zKSB7DQogICAgcmV0dXJuIG5ldyBGb3JtYXR0ZXIob3B0aW9ucykuc3RyaW5naWZ5KGRhdGEpOw0KICB9CgogIHZhciBjc3YgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICBjcmVhdGVQYXJzZXI6IGNyZWF0ZVBhcnNlciwKICAgIHBhcnNlOiBwYXJzZSQyLAogICAgY3JlYXRlRm9ybWF0dGVyOiBjcmVhdGVGb3JtYXR0ZXIsCiAgICBzdHJpbmdpZnk6IHN0cmluZ2lmeSQxCiAgfSk7CgogIHZhciBBUFBfSUQgPSAnRXhjZWwuQXBwbGljYXRpb24nOw0KDQogIGZ1bmN0aW9uIGZpbmQkMShpdGVtcywgZm4pIHsNCiAgICB2YXIgZW4gPSBuZXcgRW51bWVyYXRvcihpdGVtcyk7DQogICAgdmFyIGl0ZW07DQogICAgZm9yICh2YXIgaSA9IDA7ICFlbi5hdEVuZCgpOyBlbi5tb3ZlTmV4dCgpLCBpKyspIHsNCiAgICAgIGl0ZW0gPSBlbi5pdGVtKCk7DQogICAgICBpZiAoZm4oaXRlbSwgaSkgPT09IHRydWUpIHsgcmV0dXJuIGl0ZW07IH0NCiAgICB9DQogICAgcmV0dXJuIG51bGw7DQogIH0NCg0KICBmdW5jdGlvbiBtYXRjaGVyJDEocGF0dGVybikgew0KICAgIHZhciBpc01hdGNoOw0KICAgIGlmIChpc0Z1bmN0aW9uKHBhdHRlcm4pKSB7IGlzTWF0Y2ggPSBwYXR0ZXJuOyB9DQogICAgZWxzZSBpZiAoaXNTdHJpbmcocGF0dGVybikpIHsgaXNNYXRjaCA9IGZ1bmN0aW9uIChpdCkgeyByZXR1cm4gaXQuTmFtZS5pbmNsdWRlcyhwYXR0ZXJuKTsgfTsgfQ0KICAgIGVsc2UgaWYgKGlzUmVnRXhwKHBhdHRlcm4pKSB7IGlzTWF0Y2ggPSBmdW5jdGlvbiAoaXQpIHsgcmV0dXJuIHBhdHRlcm4udGVzdChpdC5OYW1lKTsgfTsgfQ0KICAgIGVsc2UgeyBpc01hdGNoID0gbnVsbDsgfQ0KICAgIHJldHVybiBpc01hdGNoOw0KICB9DQoNCiAgdmFyIEV4Y2VsID0gZnVuY3Rpb24gRXhjZWwocHRoKSB7CiAgICBpZiAoIHB0aCA9PT0gdm9pZCAwICkgcHRoID0gJyc7Cg0KICAgIHZhciBhcHA7DQogICAgdHJ5IHsNCiAgICAgIGFwcCA9IEdldE9iamVjdChwdGgsIEFQUF9JRCk7DQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgYXBwID0gbmV3IEFjdGl2ZVhPYmplY3QoQVBQX0lEKTsNCiAgICB9DQogICAgaWYgKCFhcHAuVmlzaWJsZSkgeyBhcHAuVmlzaWJsZSA9IHRydWU7IH0NCiAgICBpZiAoYXBwLldvcmtib29rcy5Db3VudCA9PT0gMCkgeyBhcHAuV29ya2Jvb2tzLkFkZCgpOyB9DQogICAgdGhpcy5hcHAgPSBhcHA7DQogIH07CgogIHZhciBwcm90b3R5cGVBY2Nlc3NvcnMkMiA9IHsgYWN0aXZlQm9vazogeyBjb25maWd1cmFibGU6IHRydWUgfSxhY3RpdmVTaGVldDogeyBjb25maWd1cmFibGU6IHRydWUgfSxhY3RpdmVDZWxsOiB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSB9LHNlbGVjdGlvbjogeyBjb25maWd1cmFibGU6IHRydWUgfSxib29rczogeyBjb25maWd1cmFibGU6IHRydWUgfSB9Ow0KDQogIHByb3RvdHlwZUFjY2Vzc29ycyQyLmFjdGl2ZUJvb2suZ2V0ID0gZnVuY3Rpb24gKCkgew0KICAgIHJldHVybiB0aGlzLmFwcC5BY3RpdmVXb3JrQm9vazsNCiAgfTsNCg0KICBwcm90b3R5cGVBY2Nlc3NvcnMkMi5hY3RpdmVTaGVldC5nZXQgPSBmdW5jdGlvbiAoKSB7DQogICAgcmV0dXJuIHRoaXMuYXBwLkFjdGl2ZVNoZWV0Ow0KICB9Ow0KDQogIHByb3RvdHlwZUFjY2Vzc29ycyQyLmFjdGl2ZUNlbGwuZ2V0ID0gZnVuY3Rpb24gKCkgew0KICAgIHJldHVybiB0aGlzLmFwcC5BY3RpdmVDZWxsOw0KICB9Ow0KDQogIHByb3RvdHlwZUFjY2Vzc29ycyQyLnNlbGVjdGlvbi5nZXQgPSBmdW5jdGlvbiAoKSB7DQogICAgcmV0dXJuIHRoaXMuYXBwLlNlbGVjdGlvbjsNCiAgfTsNCg0KICBwcm90b3R5cGVBY2Nlc3NvcnMkMi5ib29rcy5nZXQgPSBmdW5jdGlvbiAoKSB7DQogICAgcmV0dXJuIHRoaXMuYXBwLldvcmtCb29rczsNCiAgfTsNCg0KICBFeGNlbC5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiBjbG9zZSAoKSB7DQogICAgdGhpcy5hcHAgJiYgdGhpcy5hcHAuUXVpdCgpOw0KICAgIHRoaXMuYXBwID0gbnVsbDsNCiAgfTsNCg0KICBFeGNlbC5wcm90b3R5cGUuZ2V0Qm9vayA9IGZ1bmN0aW9uIGdldEJvb2sgKG5hbWUpIHsNCiAgICByZXR1cm4gbmFtZSA/IHRoaXMuYXBwLldvcmtCb29rcyhuYW1lKSA6IHRoaXMuYWN0aXZlQm9vazsNCiAgfTsNCg0KICBFeGNlbC5wcm90b3R5cGUuZ2V0U2hlZXQgPSBmdW5jdGlvbiBnZXRTaGVldCAoc2hlZXROYW1lLCBib29rTmFtZSkgew0KICAgIHJldHVybiBzaGVldE5hbWUNCiAgICAgID8gdGhpcy5nZXRCb29rKGJvb2tOYW1lKS5TaGVldHMoc2hlZXROYW1lKQ0KICAgICAgOiB0aGlzLmFjdGl2ZVNoZWV0Ow0KICB9Ow0KDQogIEV4Y2VsLnByb3RvdHlwZS5yYW5nZSA9IGZ1bmN0aW9uIHJhbmdlIChhZGRyKSB7DQogICAgcmV0dXJuIGFkZHIgPyB0aGlzLmFwcC5SYW5nZShhZGRyKSA6IHRoaXMuc2VsZWN0aW9uOw0KICB9Ow0KDQogIEV4Y2VsLnByb3RvdHlwZS5nZXRSYW5nZSA9IGZ1bmN0aW9uIGdldFJhbmdlIChzdHJSYW5nZSwgc2hlZXROYW1lLCBib29rTmFtZSkgew0KICAgIHJldHVybiBzdHJSYW5nZQ0KICAgICAgPyB0aGlzLmdldFNoZWV0KHNoZWV0TmFtZSwgYm9va05hbWUpLlJhbmdlKHN0clJhbmdlKQ0KICAgICAgOiB0aGlzLnNlbGVjdGlvbjsNCiAgfTsNCg0KICBFeGNlbC5wcm90b3R5cGUuY2VsbCA9IGZ1bmN0aW9uIGNlbGwgKHJvdywgY29sKSB7DQogICAgcmV0dXJuIHJvdyAmJiBjb2wgPyB0aGlzLmFwcC5DZWxscyhyb3csIGNvbCkgOiB0aGlzLmFjdGl2ZUNlbGw7DQogIH07DQoNCiAgRXhjZWwucHJvdG90eXBlLmdldENlbGwgPSBmdW5jdGlvbiBnZXRDZWxsIChyb3csIGNvbCwgc2hlZXROYW1lLCBib29rTmFtZSkgew0KICAgIHJldHVybiByb3cgJiYgY29sDQogICAgICA/IHRoaXMuZ2V0U2hlZXQoc2hlZXROYW1lLCBib29rTmFtZSkuQ2VsbHMocm93LCBjb2wpDQogICAgICA6IHRoaXMuYWN0aXZlQ2VsbDsNCiAgfTsNCg0KICBFeGNlbC5wcm90b3R5cGUuZ2V0Qm9va3MgPSBmdW5jdGlvbiBnZXRCb29rcyAoKSB7DQogICAgcmV0dXJuIG1hcCh0aGlzLmJvb2tzKTsNCiAgfTsNCg0KICBFeGNlbC5wcm90b3R5cGUub3BlbkJvb2sgPSBmdW5jdGlvbiBvcGVuQm9vayAocGF0aCkgew0KICAgIGlmICghaXNmaWxlKHBhdGgpKSB7IHJldHVybiBudWxsOyB9DQogICAgdmFyIHRhcmdldCA9IGZpbmQkMSh0aGlzLmJvb2tzLCBmdW5jdGlvbiAoYm9vaykgeyByZXR1cm4gYm9vay5OYW1lID09IGJhc2VuYW1lKHBhdGgpOyB9KTsNCiAgICByZXR1cm4gdGFyZ2V0ID8gdGFyZ2V0IDogdGhpcy5ib29rcy5PcGVuKHBhdGgpOw0KICB9Ow0KDQogIEV4Y2VsLnByb3RvdHlwZS5uZXdCb29rID0gZnVuY3Rpb24gbmV3Qm9vayAoKSB7DQogICAgcmV0dXJuIHRoaXMuYm9va3MuYWRkKCk7DQogIH07DQoNCiAgRXhjZWwucHJvdG90eXBlLmdldFNoZWV0cyA9IGZ1bmN0aW9uIGdldFNoZWV0cyAoYm9vaykgew0KICAgIHJldHVybiBtYXAodGhpcy5nZXRCb29rKGJvb2spLlNoZWV0cyk7DQogIH07DQoNCiAgRXhjZWwucHJvdG90eXBlLmZpbmRCb29rID0gZnVuY3Rpb24gZmluZEJvb2sgKHBhdHRlcm4pIHsNCiAgICB2YXIgaXNNYXRjaCA9IG1hdGNoZXIkMShwYXR0ZXJuKTsNCiAgICByZXR1cm4gaXNNYXRjaCAmJiBmaW5kJDEodGhpcy5ib29rcywgaXNNYXRjaCk7DQogIH07DQoNCiAgRXhjZWwucHJvdG90eXBlLmZpbmRTaGVldCA9IGZ1bmN0aW9uIGZpbmRTaGVldCAocGF0dGVybiwgX2Jvb2spIHsNCiAgICB2YXIgYm9vaywgaXNNYXRjaDsNCiAgICBpZiAoX2Jvb2spIHsNCiAgICAgIGJvb2sgPSB0aGlzLmZpbmRCb29rKF9ib29rKTsNCiAgICAgIGlmICghYm9vaykgeyBib29rID0gX2Jvb2s7IH0NCiAgICB9IGVsc2Ugew0KICAgICAgYm9vayA9IHRoaXMuYWN0aXZlQm9vazsNCiAgICB9DQogICAgaXNNYXRjaCA9IG1hdGNoZXIkMShwYXR0ZXJuKTsNCiAgICByZXR1cm4gaXNNYXRjaCAmJiBmaW5kJDEoYm9vay5TaGVldHMsIGlzTWF0Y2gpOw0KICB9Ow0KDQogIEV4Y2VsLnByb3RvdHlwZS5nZXRWYWx1ZXMgPSBmdW5jdGlvbiBnZXRWYWx1ZXMgKHJhbmdlKSB7DQogICAgdmFyIHJvd05vLA0KICAgICAgdGJsID0gW10sDQogICAgICByb3dEYXRhOw0KICAgIGVhY2gocmFuZ2UsIGZ1bmN0aW9uIChyKSB7DQogICAgICBpZiAocm93Tm8gIT0gci5Sb3cpIHsNCiAgICAgICAgaWYgKHJvd0RhdGEpIHsgdGJsLnB1c2gocm93RGF0YSk7IH0NCiAgICAgICAgcm93RGF0YSA9IFtdOw0KICAgICAgICByb3dObyA9IHIuUm93Ow0KICAgICAgfQ0KICAgICAgcm93RGF0YS5wdXNoKHIudmFsdWUpOw0KICAgIH0pOw0KICAgIGlmIChyb3dEYXRhKSB7IHRibC5wdXNoKHJvd0RhdGEpOyB9DQogICAgcmV0dXJuIHRibDsNCiAgfTsNCg0KICBFeGNlbC5wcm90b3R5cGUuc2V0VmFsdWVzID0gZnVuY3Rpb24gc2V0VmFsdWVzIChyYW5nZSwgdmFscykgew0KICAgIGlmIChpc0FycmF5KHZhbHMpKSB7DQogICAgICBlYWNoKHZhbHMsIGZ1bmN0aW9uICh2YWwpIHsNCiAgICAgICAgaWYgKGlzQXJyYXkodmFsKSkgew0KICAgICAgICAgIGVhY2godmFsLCBmdW5jdGlvbiAoaXQsIGkpIHsNCiAgICAgICAgICAgIHJhbmdlLm9mZnNldCgwLCBpKS52YWx1ZSA9IGl0Ow0KICAgICAgICAgIH0pOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJhbmdlLnZhbHVlID0gdmFsOw0KICAgICAgICB9DQogICAgICAgIHJhbmdlID0gcmFuZ2Uub2Zmc2V0KDEsIDApOw0KICAgICAgfSk7DQogICAgfQ0KICB9Ow0KDQogIEV4Y2VsLnByb3RvdHlwZS5ub191cGRhdGUgPSBmdW5jdGlvbiBub191cGRhdGUgKGNiKSB7DQogICAgdHJ5IHsNCiAgICAgIHRoaXMuYXBwLlNjcmVlblVwZGF0aW5nID0gZmFsc2U7DQogICAgICBjYigpOw0KICAgIH0gZmluYWxseSB7DQogICAgICB0aGlzLmFwcC5TY3JlZW5VcGRhdGluZyA9IHRydWU7DQogICAgfQ0KICB9Ow0KDQogIEV4Y2VsLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiB1cGRhdGUgKGNiKSB7DQogICAgdHJ5IHsNCiAgICAgIHRoaXMuYXBwLlNjcmVlblVwZGF0aW5nID0gdHJ1ZTsNCiAgICAgIGNiKCk7DQogICAgfSBmaW5hbGx5IHsNCiAgICAgIHRoaXMuYXBwLlNjcmVlblVwZGF0aW5nID0gZmFsc2U7DQogICAgfQ0KICB9OwoKICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyggRXhjZWwucHJvdG90eXBlLCBwcm90b3R5cGVBY2Nlc3NvcnMkMiApOwoNCiAgRXhjZWwueGxkb3duID0gLTQxMjE7DQogIEV4Y2VsLnhsVG9MZWZ0ID0gLTQxNTk7DQogIEV4Y2VsLnhsVG9SaWdodCA9IC00MTYxOw0KICBFeGNlbC54bHVwID0gLTQxNjI7CgogIHZhciBleGNlbCA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgICdkZWZhdWx0JzogRXhjZWwKICB9KTsKCiAgZnVuY3Rpb24gZ2V0V2luZG93cygpIHsNCiAgICB2YXIgd2lucyA9IFtdOw0KICAgIGVhY2goX19TaGVsbEFwcC5XaW5kb3dzKCksIGZ1bmN0aW9uIChhcHApIHsNCiAgICAgIGlmIChhcHAgJiYgYXBwLk5hbWUgPT09ICdJbnRlcm5ldCBFeHBsb3JlcicpIHsNCiAgICAgICAgd2lucy5wdXNoKGFwcCk7DQogICAgICB9DQogICAgfSk7DQogICAgcmV0dXJuIHdpbnM7DQogIH0NCg0KICBmdW5jdGlvbiBnZXRBY3RpdmUoKSB7DQogICAgdmFyIGllOw0KICAgIGVhY2goX19TaGVsbEFwcC5XaW5kb3dzKCksIGZ1bmN0aW9uIChhcHApIHsNCiAgICAgIGlmIChhcHAgJiYgYXBwLk5hbWUgPT09ICdJbnRlcm5ldCBFeHBsb3JlcicgJiYgIWFwcC5Eb2N1bWVudC5oaWRkZW4pIHsNCiAgICAgICAgaWUgPSBhcHA7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0NCiAgICB9KTsNCiAgICByZXR1cm4gaWU7DQogIH0NCg0KICBmdW5jdGlvbiBnZXRJRSgpIHsNCiAgICB2YXIgaWU7DQogICAgZWFjaChfX1NoZWxsQXBwLldpbmRvd3MoKSwgZnVuY3Rpb24gKGFwcCkgew0KICAgICAgaWYgKGFwcCAmJiBhcHAuTmFtZSA9PT0gJ0ludGVybmV0IEV4cGxvcmVyJykgew0KICAgICAgICBpZSA9IGFwcDsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgfQ0KICAgIH0pOw0KICAgIHJldHVybiBpZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHdhaXQoaWUsIHRpbWVvdXQpIHsNCiAgICB2YXIgZWxhcHNlZCA9IDA7DQogICAgdGltZW91dCB8fCAodGltZW91dCA9IDUwMDApOw0KICAgIHdoaWxlIChpZS5CdXN5IHx8IGllLlJlYWR5U3RhdGUgIT09IDQpIHsNCiAgICAgIGlmIChlbGFwc2VkID49IHRpbWVvdXQpIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJRSB0aW1lb3V0Jyk7DQogICAgICB9DQogICAgICBlbGFwc2VkICs9IDEwMDsNCiAgICAgIHByb2Nlc3Muc2xlZXAoMTAwKTsNCiAgICB9DQogIH0NCg0KICB2YXIgSUVfT1BUSU9OUyA9IFsNCiAgICAnQWRkcmVzc0JhcicsDQogICAgJ0Z1bGxTY3JlZW4nLA0KICAgICdXaWR0aCcsDQogICAgJ0hlaWdodCcsDQogICAgJ1RvcCcsDQogICAgJ0xlZnQnLA0KICAgICdNZW51QmFyJywNCiAgICAnUmVzaXphYmxlJywNCiAgICAnU2lsZW50JywNCiAgICAnU3RhdHVzQmFyJywNCiAgICAnVG9vbEJhcicsDQogICAgJ1Zpc2libGUnDQogIF0ucmVkdWNlKGZ1bmN0aW9uIChtZW1vLCBpdCkgew0KICAgIG1lbW9baXRdID0gaXQ7DQogICAgbWVtb1tpdC50b0xvd2VyQ2FzZSgpXSA9IGl0Ow0KICAgIHJldHVybiBtZW1vOw0KICB9LCB7fSk7DQoNCiAgZnVuY3Rpb24gb3Blbih1cmwsIG9wdGlvbnMpIHsNCiAgICB2YXIgaWUgPSBuZXcgQWN0aXZlWE9iamVjdCgnSW50ZXJuZXRFeHBsb3Jlci5BcHBsaWNhdGlvbicpOw0KICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7DQogICAgZWFjaChvcHRpb25zLCBmdW5jdGlvbiAodiwgaykgew0KICAgICAgdmFyIHByb3AgPSBJRV9PUFRJT05TW2tdOw0KICAgICAgaWYgKHByb3ApIHsgaWVbcHJvcF0gPSB2OyB9DQogICAgfSk7DQogICAgaWYgKCFoYXMkMShvcHRpb25zLCAndmlzaWJsZScpICYmICFoYXMkMShvcHRpb25zLCAnVmlzaWJsZScpKSB7DQogICAgICBpZS5WaXNpYmxlID0gdHJ1ZTsNCiAgICB9DQogICAgaWUuTmF2aWdhdGUodXJsIHx8ICdhYm91dDpibGFuaycpOw0KICAgIHdhaXQoaWUsIG9wdGlvbnMudGltZW91dCk7DQogICAgcmV0dXJuIGllOw0KICB9CgogIHZhciBpZSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgIGdldFdpbmRvd3M6IGdldFdpbmRvd3MsCiAgICBnZXRBY3RpdmU6IGdldEFjdGl2ZSwKICAgIGdldElFOiBnZXRJRSwKICAgIHdhaXQ6IHdhaXQsCiAgICBvcGVuOiBvcGVuCiAgfSk7CgogIHZhciBBUFBfSUQkMSA9ICdPdXRsb29rLkFwcGxpY2F0aW9uJzsNCiAgdmFyIG9sTWFpbEl0ZW0gPSAwOw0KDQogIHZhciBPVVRMT09LX1BST1RPID0gew0KICAgIGNyZWF0ZU1haWw6IGZ1bmN0aW9uKG9wdGlvbnMpIHsNCiAgICAgIHZhciBpdGVtID0gdGhpcy5hcHAuQ3JlYXRlSXRlbShvbE1haWxJdGVtKTsNCiAgICAgIGlmIChvcHRpb25zKSB7DQogICAgICAgIGVhY2gob3B0aW9ucywgZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHsNCiAgICAgICAgICBpdGVtW2tleV0gPSB2YWx1ZTsNCiAgICAgICAgfSk7DQogICAgICB9DQogICAgICBpdGVtLkRpc3BsYXkoKTsNCiAgICAgIHJldHVybiBpdGVtOw0KICAgIH0NCiAgfTsNCg0KICB2YXIgT1VUTE9PS19QUk9QUyA9IHsNCiAgICBhcHA6IHsgdmFsdWU6IG51bGwsIHdyaXRhYmxlOiB0cnVlIH0NCiAgfTsNCg0KICBmdW5jdGlvbiBPdXRsb29rKCkgew0KICAgIHZhciBhcHA7DQogICAgdHJ5IHsNCiAgICAgIGFwcCA9IEdldE9iamVjdCgnJywgQVBQX0lEJDEpOw0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgIGFwcCA9IG5ldyBBY3RpdmVYT2JqZWN0KEFQUF9JRCQxKTsNCiAgICB9DQogICAgdmFyIG9sID0gT2JqZWN0LmNyZWF0ZShPVVRMT09LX1BST1RPLCBPVVRMT09LX1BST1BTKTsNCiAgICBvbC5hcHAgPSBhcHA7DQogICAgcmV0dXJuIG9sOw0KICB9CgogIHZhciBvdXRsb29rID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgJ2RlZmF1bHQnOiBPdXRsb29rCiAgfSk7CgogIC8qIEN1cnNvckxvY2F0aW9uRW51bSAqLw0KICB2YXIgYWRVc2VDbGllbnQgPSAzOw0KICB2YXIgYWRVc2VOb25lID0gMTsNCiAgdmFyIGFkVXNlU2VydmVyID0gMjsNCiAgLyogTG9ja1R5cGVFbnVtICovDQogIHZhciBhZExvY2tVbnNwZWNpZmllZCA9IC0xOw0KICB2YXIgYWRMb2NrUmVhZE9ubHkgPSAxOw0KICB2YXIgYWRMb2NrUGVzc2ltaXN0aWMgPSAyOw0KICB2YXIgYWRMb2NrT3B0aW1pc3RpYyA9IDM7DQogIHZhciBhZExvY2tCYXRjaE9wdGltaXN0aWMgPSA0Ow0KICAvKiBDdXJzb3JUeXBlRW51bSAqLw0KICB2YXIgYWRPcGVuVW5zcGVjaWZpZWQgPSAtMTsNCiAgdmFyIGFkT3BlbkZvcndhcmRPbmx5ID0gMDsNCiAgdmFyIGFkT3BlbktleXNldCA9IDE7DQogIHZhciBhZE9wZW5EeW5hbWljID0gMjsNCiAgdmFyIGFkT3BlblN0YXRpYyA9IDM7DQogIC8qIERhdGFUeXBlRW51bSAqLw0KICB2YXIgYWRCaWdJbnQgPSAyMDsNCiAgdmFyIGFkQmluYXJ5JDEgPSAxMjg7DQogIHZhciBhZEJvb2xlYW4gPSAxMTsNCiAgdmFyIGFkQ2hhciA9IDEyOTsNCiAgdmFyIGFkQ3VycmVuY3kgPSA2Ow0KICB2YXIgYWREYXRlID0gNzsNCiAgdmFyIGFkREJEYXRlID0gMTMzOw0KICB2YXIgYWREQlRpbWUgPSAxMzQ7DQogIHZhciBhZERCVGltZVN0YW1wID0gMTM1Ow0KICB2YXIgYWREZWNpbWFsID0gMTQ7DQogIHZhciBhZERvdWJsZSA9IDU7DQogIHZhciBhZEdVSUQgPSA3MjsNCiAgdmFyIGFkSURpc3BhdGNoID0gOTsNCiAgdmFyIGFkSW50ZWdlciA9IDM7DQogIHZhciBhZExvbmdWYXJCaW5hcnkgPSAyMDU7DQogIHZhciBhZExvbmdWYXJDaGFyID0gMjAxOw0KICB2YXIgYWRMb25nVmFyV0NoYXIgPSAyMDM7DQogIHZhciBhZE51bWVyaWMgPSAxMzE7DQogIHZhciBhZFNpbmdsZSA9IDQ7DQogIHZhciBhZFNtYWxsSW50ID0gMjsNCiAgdmFyIGFkVW5zaWduZWRUaW55SW50ID0gMTc7DQogIHZhciBhZFZhckJpbmFyeSA9IDIwNDsNCiAgdmFyIGFkVmFyQ2hhciA9IDIwMDsNCiAgdmFyIGFkVmFyaWFudCA9IDEyOw0KICB2YXIgYWRWYXJXQ2hhciA9IDIwMjsNCiAgdmFyIGFkV0NoYXIgPSAxMzA7DQogIC8qIFBhcmFtZXRlckRpcmVjdGlvbkVudW0gKi8NCiAgdmFyIGFkUGFyYW1Vbmtub3duID0gMDsNCiAgdmFyIGFkUGFyYW1JbnB1dCA9IDE7DQogIHZhciBhZFBhcmFtT3V0cHV0ID0gMjsNCiAgdmFyIGFkUGFyYW1JbnB1dE91dHB1dCA9IDM7DQogIHZhciBhZFBhcmFtUmV0dXJuVmFsdWUgPSA0Ow0KICAvKiBTY2hlbWFFbnVtICovDQogIHZhciBhZFNjaGVtYVRhYmxlcyA9IDIwOw0KICB2YXIgYWRTY2hlbWFDb2x1bW5zID0gNDsNCg0KICB2YXIgQWRvZGIgPSBmdW5jdGlvbiBBZG9kYigpIHsNCiAgICB0aGlzLmNvbm4gPSBuZXcgQWN0aXZlWE9iamVjdCgnQURPREIuQ29ubmVjdGlvbicpOw0KICB9Ow0KDQogIEFkb2RiLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uIGNsb3NlICgpIHsNCiAgICB0aGlzLmNvbm4gJiYgdGhpcy5jb25uLlN0YXRlICE9IDAgJiYgdGhpcy5jb25uLkNsb3NlKCk7DQogICAgdGhpcy5jb25uID0gbnVsbDsNCiAgfTsNCg0KICBBZG9kYi5wcm90b3R5cGUuYmVnaW4gPSBmdW5jdGlvbiBiZWdpbiAoKSB7DQogICAgdGhpcy5jb25uLkJlZ2luVHJhbnMoKTsNCiAgfTsNCg0KICBBZG9kYi5wcm90b3R5cGUuY29tbWl0ID0gZnVuY3Rpb24gY29tbWl0ICgpIHsNCiAgICB0aGlzLmNvbm4uQ29tbWl0VHJhbnMoKTsNCiAgfTsNCg0KICBBZG9kYi5wcm90b3R5cGUucm9sbGJhY2sgPSBmdW5jdGlvbiByb2xsYmFjayAoKSB7DQogICAgdGhpcy5jb25uLlJvbGxiYWNrVHJhbnMoKTsNCiAgfTsNCg0KICBBZG9kYi5wcm90b3R5cGUuZ2V0T3B0aW9ucyA9IGZ1bmN0aW9uIGdldE9wdGlvbnMgKGFyZ3MpIHsNCiAgICBpZiAodHlwZW9mIGFyZ3NbMF0gPT09ICdvYmplY3QnICYmIGFyZ3NbMF0uX2lzX29wdGlvbnMpIHsgcmV0dXJuIGFyZ3NbMF07IH0NCiAgICB2YXIgaSA9IC0xLA0KICAgICAgbGVuID0gYXJncy5sZW5ndGgsDQogICAgICBhcmcsDQogICAgICBvcCA9IHsgX2lzX29wdGlvbnM6IHRydWUgfTsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICBhcmcgPSBhcmdzW2ldOw0KICAgICAgc3dpdGNoICh0eXBlT2YoYXJnKSkgew0KICAgICAgICBjYXNlICdzdHJpbmcnOg0KICAgICAgICAgIG9wLnNxbCA9IGFyZzsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAnYXJyYXknOg0KICAgICAgICBjYXNlICdvYmplY3QnOg0KICAgICAgICAgIG9wLnBhcmFtcyA9IGFyZzsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAnYm9vbGVhbic6DQogICAgICAgICAgb3AucHJlcGFyZWQgPSBhcmc7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgJ2Z1bmN0aW9uJzoNCiAgICAgICAgICBvcC5jYWxsYmFjayA9IGFyZzsNCiAgICAgICAgICBicmVhazsNCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIG9wOw0KICB9Ow0KDQogIEFkb2RiLnByb3RvdHlwZS5nZXREYXRhVHlwZU1hcHBpbmcgPSBmdW5jdGlvbiBnZXREYXRhVHlwZU1hcHBpbmcgKCkgew0KICAgIHJldHVybiB7DQogICAgICBzdHJpbmc6IGFkVmFyV0NoYXIsDQogICAgICBpbnQ6IGFkU21hbGxJbnQsDQogICAgICBkZWNpbWFsOiBhZERvdWJsZSwNCiAgICAgIGJvb2xlYW46IGFkQm9vbGVhbiwNCiAgICAgIGRhdGU6IGFkRGF0ZSwNCiAgICAgIGJ1ZmZlcjogYWRCaW5hcnkkMSwNCiAgICAgIG51bGw6IGFkVmFyV0NoYXIsDQogICAgICB1bmRlZmluZWQ6IGFkVmFyV0NoYXINCiAgICB9Ow0KICB9Ow0KDQogIEFkb2RiLnByb3RvdHlwZS5jcmVhdGVQYXJhbXMgPSBmdW5jdGlvbiBjcmVhdGVQYXJhbXMgKG9wdHMpIHsNCiAgICB2YXIgY21kb2JqID0gb3B0cy5jbWQsDQogICAgICBwYXJhbXMgPSBvcHRzLnBhcmFtczsNCiAgICBpZiAoIWNtZG9iaiB8fCAhcGFyYW1zKSB7IHJldHVybjsgfQ0KICAgIHZhciBqc1R5cGUsDQogICAgICB0cCwNCiAgICAgIHNpemUgPSAxMCwNCiAgICAgIGR0bWFwID0gdGhpcy5nZXREYXRhVHlwZU1hcHBpbmcoKTsNCiAgICBlYWNoKHBhcmFtcywgZnVuY3Rpb24gKHZhbHVlLCBuYW1lKSB7DQogICAgICBqc1R5cGUgPSB0eXBlT2YodmFsdWUpOw0KICAgICAgaWYgKGpzVHlwZSA9PSAnc3RyaW5nJykgew0KICAgICAgICB0cCA9IGR0bWFwWydzdHJpbmcnXTsNCiAgICAgICAgc2l6ZSA9IHRwID09PSBhZFZhcmlhbnQgPyB2YWx1ZS5sZW5ndGggKiAyIDogdmFsdWUubGVuZ3RoOw0KICAgICAgfSBlbHNlIGlmIChqc1R5cGUgPT0gJ251bWJlcicpIHsNCiAgICAgICAgdHAgPSBpc0ludGVnZXIodmFsdWUpID8gZHRtYXBbJ2ludCddIDogZHRtYXBbJ2RlY2ltYWwnXTsNCiAgICAgIH0gZWxzZSBpZiAoaGFzKGR0bWFwLCBqc1R5cGUpKSB7DQogICAgICAgIHRwID0gZHRtYXBbanNUeXBlXTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcignQWRvZGIuY3JlYXRlUGFyYW1zOiB1bmV4cGVjdGVkIHR5cGUgJyArIGpzVHlwZSk7DQogICAgICB9DQogICAgICB2YXIgcGFyYW1vYmogPSBjbWRvYmouQ3JlYXRlUGFyYW1ldGVyKA0KICAgICAgICBuYW1lLA0KICAgICAgICB0cCwNCiAgICAgICAgYWRQYXJhbUlucHV0LA0KICAgICAgICBzaXplLA0KICAgICAgICB2YWx1ZQ0KICAgICAgKTsNCiAgICAgIGNtZG9iai5QYXJhbWV0ZXJzLkFwcGVuZChwYXJhbW9iaik7DQogICAgfSk7DQogIH07DQoNCiAgQWRvZGIucHJvdG90eXBlLmV4ZWN1dGUgPSBmdW5jdGlvbiBleGVjdXRlICgpIHsKICAgICAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDsKICAgICAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTsKDQogICAgdmFyIG9wID0gdGhpcy5nZXRPcHRpb25zKGFyZ3MpOw0KICAgIHRyeSB7DQogICAgICB2YXIgY21kID0gbmV3IEFjdGl2ZVhPYmplY3QoJ0FET0RCLkNvbW1hbmQnKTsNCiAgICAgIGNtZC5BY3RpdmVDb25uZWN0aW9uID0gdGhpcy5jb25uOw0KICAgICAgY21kLkNvbW1hbmRUeXBlID0gMTsgLyp0ZXh0Ki8NCiAgICAgIGNtZC5QcmVwYXJlZCA9IG9wLnByZXBhcmVkIHx8IGZhbHNlOw0KICAgICAgY21kLkNvbW1hbmRUZXh0ID0gb3Auc3FsOw0KICAgICAgb3AuY21kID0gY21kOw0KICAgICAgdGhpcy5jcmVhdGVQYXJhbXMob3ApOw0KICAgICAgcmV0dXJuIGNtZC5FeGVjdXRlKCk7DQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgZS5zcWwgPSBvcC5zcWw7DQogICAgICB0aHJvdyBlOw0KICAgIH0NCiAgfTsNCg0KICBBZG9kYi5wcm90b3R5cGUuc2VsZWN0ID0gZnVuY3Rpb24gc2VsZWN0ICgpIHsKICAgICAgdmFyIGFyZ3MgPSBbXSwgbGVuJDEgPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICB3aGlsZSAoIGxlbiQxLS0gKSBhcmdzWyBsZW4kMSBdID0gYXJndW1lbnRzWyBsZW4kMSBdOwoNCiAgICB2YXIgcnMsDQogICAgICByb3csDQogICAgICBpLA0KICAgICAgbGVuLA0KICAgICAgb3AgPSB0aGlzLmdldE9wdGlvbnMoYXJncyk7DQogICAgdHJ5IHsNCiAgICAgIHJzID0gdGhpcy5leGVjdXRlKG9wKTsNCiAgICAgIHdoaWxlICghcnMuRU9GKSB7DQogICAgICAgIHJvdyA9IHt9Ow0KICAgICAgICBpZiAobGVuID09IG51bGwpIHsgbGVuID0gcnMuRmllbGRzLkNvdW50OyB9DQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykgew0KICAgICAgICAgIHJvd1tycy5GaWVsZHMoaSkuTmFtZV0gPSB0aGlzLmdldEZpZWxkVmFsdWUocnMuRmllbGRzKGkpKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAob3AuY2FsbGJhY2socm93KSA9PT0gZmFsc2UpIHsgYnJlYWs7IH0NCiAgICAgICAgcnMuTW92ZU5leHQoKTsNCiAgICAgIH0NCiAgICB9IGNhdGNoIChlKSB7DQogICAgICBlLnNxbCA9IG9wLnNxbDsNCiAgICAgIHRocm93IGU7DQogICAgfSBmaW5hbGx5IHsNCiAgICAgIHJzICYmIHJzLlN0YXRlICE9IDAgJiYgcnMuQ2xvc2UoKTsNCiAgICB9DQogIH07DQoNCiAgQWRvZGIucHJvdG90eXBlLmdldEZpZWxkVmFsdWUgPSBmdW5jdGlvbiBnZXRGaWVsZFZhbHVlIChmaWVsZCkgew0KICAgIHN3aXRjaCAoZmllbGQuVHlwZSkgew0KICAgICAgY2FzZSBhZEJpbmFyeSQxOg0KICAgICAgY2FzZSBhZFZhckJpbmFyeToNCiAgICAgICAgcmV0dXJuICdbTE9CXSc7DQogICAgICBjYXNlIGFkRGF0ZToNCiAgICAgIGNhc2UgYWREQkRhdGU6DQogICAgICBjYXNlIGFkREJUaW1lOg0KICAgICAgY2FzZSBhZERCVGltZVN0YW1wOg0KICAgICAgICByZXR1cm4gbmV3IERhdGUoZmllbGQudmFsdWUpOw0KICAgICAgZGVmYXVsdDoNCiAgICAgICAgcmV0dXJuIGZpZWxkLnZhbHVlOw0KICAgIH0NCiAgfTsNCg0KICBBZG9kYi5wcm90b3R5cGUuZWFjaFJvdyA9IGZ1bmN0aW9uIGVhY2hSb3cgKCkgewogICAgICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdOwoNCiAgICB2YXIgb3AgPSB0aGlzLmdldE9wdGlvbnMoYXJncyk7DQogICAgdGhpcy5zZWxlY3Qob3ApOw0KICB9Ow0KDQogIEFkb2RiLnByb3RvdHlwZS5maXJzdFJvdyA9IGZ1bmN0aW9uIGZpcnN0Um93ICgpIHsKICAgICAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDsKICAgICAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTsKDQogICAgdmFyIG9wID0gdGhpcy5nZXRPcHRpb25zKGFyZ3MpLA0KICAgICAgX3JvdzsNCiAgICBvcC5jYWxsYmFjayA9IGZ1bmN0aW9uIChyb3cpIHsgcmV0dXJuICgoX3JvdyA9IHJvdyksIGZhbHNlKTsgfTsNCiAgICB0aGlzLnNlbGVjdChvcCk7DQogICAgcmV0dXJuIF9yb3c7DQogIH07DQoNCiAgQWRvZGIucHJvdG90eXBlLnJvd3MgPSBmdW5jdGlvbiByb3dzICgpIHsKICAgICAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDsKICAgICAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTsKDQogICAgdmFyIG9wID0gdGhpcy5nZXRPcHRpb25zKGFyZ3MpLA0KICAgICAgcm93cyA9IFtdOw0KICAgIG9wLmNhbGxiYWNrID0gZnVuY3Rpb24gKHJvdykgew0KICAgICAgcm93cy5wdXNoKHJvdyk7DQogICAgfTsNCiAgICB0aGlzLnNlbGVjdChvcCk7DQogICAgcmV0dXJuIHJvd3M7DQogIH07DQoNCiAgQWRvZGIucHJvdG90eXBlLmJhdGNoID0gZnVuY3Rpb24gYmF0Y2ggKGNtZCwgZm4pIHsNCiAgICB2YXIgY29ubiwgcnM7DQogICAgdHJ5IHsNCiAgICAgIGNvbm4gPSB0aGlzLmNvbm47DQogICAgICBycyA9IG5ldyBBY3RpdmVYT2JqZWN0KCdBRE9EQi5SZWNvcmRzZXQnKTsNCiAgICAgIHJzLkN1cnNvckxvY2F0aW9uID0gYWRVc2VDbGllbnQ7DQogICAgICBycy5Mb2NrVHlwZSA9IGFkTG9ja0JhdGNoT3B0aW1pc3RpYzsNCiAgICAgIHJzLkN1cnNvclR5cGUgPSBhZE9wZW5EeW5hbWljOw0KICAgICAgcnMuT3BlbihjbWQsIGNvbm4pOw0KICAgICAgZm4ocnMpOw0KICAgIH0gZmluYWxseSB7DQogICAgICBycyAmJiBycy5TdGF0ZSAhPSAwICYmIHJzLkNsb3NlKCk7DQogICAgfQ0KICB9Ow0KDQogIEFkb2RiLnByb3RvdHlwZS5zZXRGaWVsZFZhbHVlID0gZnVuY3Rpb24gc2V0RmllbGRWYWx1ZSAoZmllbGQsIHZhbHVlKSB7DQogICAgc3dpdGNoICh0eXBlT2YodmFsdWUpKSB7DQogICAgICBjYXNlICdkYXRlJzoNCiAgICAgICAgZmllbGQuVmFsdWUgPSBmb3JtYXREYXRlKHZhbHVlKTsNCiAgICAgICAgYnJlYWs7DQogICAgICBjYXNlICdzdHJpbmcnOg0KICAgICAgY2FzZSAnbnVtYmVyJzoNCiAgICAgICAgZmllbGQuVmFsdWUgPSB2YWx1ZTsNCiAgICAgICAgYnJlYWs7DQogICAgICBkZWZhdWx0Og0KICAgICAgICBmaWVsZC5WYWx1ZSA9IFN0cmluZyh2YWx1ZSk7DQogICAgICAgIGJyZWFrOw0KICAgIH0NCiAgfTsNCg0KICBBZG9kYi5wcm90b3R5cGUuYmF0Y2hfaW5zZXJ0ID0gZnVuY3Rpb24gYmF0Y2hfaW5zZXJ0IChjbWQsIHJvd3MpIHsNCiAgICB2YXIgc2VsZiA9IHRoaXM7DQogICAgdGhpcy5iYXRjaChjbWQsIGZ1bmN0aW9uIChycykgew0KICAgICAgZWFjaChyb3dzLCBmdW5jdGlvbiAocm93KSB7DQogICAgICAgIHJzLkFkZE5ldygpOw0KICAgICAgICBlYWNoKHJvdywgZnVuY3Rpb24gKHYsIGspIHsNCiAgICAgICAgICBzZWxmLnNldEZpZWxkVmFsdWUocnMuRmllbGRzKGspLCB2KTsNCiAgICAgICAgfSk7DQogICAgICB9KTsNCiAgICAgIHJzLlVwZGF0ZUJhdGNoKCk7DQogICAgfSk7DQogIH07DQoNCiAgQWRvZGIucHJvdG90eXBlLnRhYmxlRXhpc3RzID0gZnVuY3Rpb24gdGFibGVFeGlzdHMgKHRhYmxlTmFtZSkgew0KICAgIHZhciBjb25uLA0KICAgICAgcnMsDQogICAgICByZXN1bHQgPSBmYWxzZSwNCiAgICAgIHBhcmFtcyA9IFtudWxsLCBudWxsLCB0YWJsZU5hbWUsICdUQUJMRSddOw0KICAgIHRyeSB7DQogICAgICBjb25uID0gdGhpcy5jb25uOw0KICAgICAgcnMgPSBjb25uLk9wZW5TY2hlbWEoYWRTY2hlbWFUYWJsZXMsIHBhcmFtcyk7DQogICAgICBpZiAoIXJzLkVPRikgeyByZXN1bHQgPSB0cnVlOyB9DQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgdGhyb3cgZTsNCiAgICB9IGZpbmFsbHkgew0KICAgICAgcnMgJiYgcnMuU3RhdGUgIT0gMCAmJiBycy5DbG9zZSgpOw0KICAgIH0NCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9Ow0KDQogIEFkb2RiLnByb3RvdHlwZS5nZXRUYWJsZXMgPSBmdW5jdGlvbiBnZXRUYWJsZXMgKCkgew0KICAgIHZhciBjb25uLA0KICAgICAgcnMsDQogICAgICByZXN1bHQgPSBbXSwNCiAgICAgIGNvdW50ID0gMDsNCiAgICB0cnkgew0KICAgICAgY29ubiA9IHRoaXMuY29ubjsNCiAgICAgIHJzID0gY29ubi5PcGVuU2NoZW1hKGFkU2NoZW1hVGFibGVzKTsNCiAgICAgIHdoaWxlICghcnMuRU9GKSB7DQogICAgICAgIGlmIChycy5GaWVsZHMoJ1RBQkxFX1RZUEUnKS5WYWx1ZSA9PT0gJ1RBQkxFJykgew0KICAgICAgICAgIHJlc3VsdFtjb3VudCsrXSA9IHJzLkZpZWxkcygnVEFCTEVfTkFNRScpLlZhbHVlOw0KICAgICAgICB9DQogICAgICAgIHJzLk1vdmVOZXh0KCk7DQogICAgICB9DQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgdGhyb3cgZTsNCiAgICB9IGZpbmFsbHkgew0KICAgICAgcnMgJiYgcnMuU3RhdGUgIT0gMCAmJiBycy5DbG9zZSgpOw0KICAgIH0NCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9Ow0KDQogIGZ1bmN0aW9uIGZvcm1hdERhdGUoZCkgew0KICAgIHJldHVybiAoDQogICAgICBkLmdldEZ1bGxZZWFyKCkgKw0KICAgICAgJy8nICsNCiAgICAgIChkLmdldE1vbnRoKCkgKyAxKSArDQogICAgICAnLycgKw0KICAgICAgZC5nZXREYXRlKCkgKw0KICAgICAgJyAnICsNCiAgICAgIGQuZ2V0SG91cnMoKSArDQogICAgICAnOicgKw0KICAgICAgZC5nZXRNaW51dGVzKCkgKw0KICAgICAgJzonICsNCiAgICAgIGQuZ2V0U2Vjb25kcygpDQogICAgKTsNCiAgfQoKICB2YXIgYWRvZGIgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICBhZFVzZUNsaWVudDogYWRVc2VDbGllbnQsCiAgICBhZFVzZU5vbmU6IGFkVXNlTm9uZSwKICAgIGFkVXNlU2VydmVyOiBhZFVzZVNlcnZlciwKICAgIGFkTG9ja1Vuc3BlY2lmaWVkOiBhZExvY2tVbnNwZWNpZmllZCwKICAgIGFkTG9ja1JlYWRPbmx5OiBhZExvY2tSZWFkT25seSwKICAgIGFkTG9ja1Blc3NpbWlzdGljOiBhZExvY2tQZXNzaW1pc3RpYywKICAgIGFkTG9ja09wdGltaXN0aWM6IGFkTG9ja09wdGltaXN0aWMsCiAgICBhZExvY2tCYXRjaE9wdGltaXN0aWM6IGFkTG9ja0JhdGNoT3B0aW1pc3RpYywKICAgIGFkT3BlblVuc3BlY2lmaWVkOiBhZE9wZW5VbnNwZWNpZmllZCwKICAgIGFkT3BlbkZvcndhcmRPbmx5OiBhZE9wZW5Gb3J3YXJkT25seSwKICAgIGFkT3BlbktleXNldDogYWRPcGVuS2V5c2V0LAogICAgYWRPcGVuRHluYW1pYzogYWRPcGVuRHluYW1pYywKICAgIGFkT3BlblN0YXRpYzogYWRPcGVuU3RhdGljLAogICAgYWRCaWdJbnQ6IGFkQmlnSW50LAogICAgYWRCaW5hcnk6IGFkQmluYXJ5JDEsCiAgICBhZEJvb2xlYW46IGFkQm9vbGVhbiwKICAgIGFkQ2hhcjogYWRDaGFyLAogICAgYWRDdXJyZW5jeTogYWRDdXJyZW5jeSwKICAgIGFkRGF0ZTogYWREYXRlLAogICAgYWREQkRhdGU6IGFkREJEYXRlLAogICAgYWREQlRpbWU6IGFkREJUaW1lLAogICAgYWREQlRpbWVTdGFtcDogYWREQlRpbWVTdGFtcCwKICAgIGFkRGVjaW1hbDogYWREZWNpbWFsLAogICAgYWREb3VibGU6IGFkRG91YmxlLAogICAgYWRHVUlEOiBhZEdVSUQsCiAgICBhZElEaXNwYXRjaDogYWRJRGlzcGF0Y2gsCiAgICBhZEludGVnZXI6IGFkSW50ZWdlciwKICAgIGFkTG9uZ1ZhckJpbmFyeTogYWRMb25nVmFyQmluYXJ5LAogICAgYWRMb25nVmFyQ2hhcjogYWRMb25nVmFyQ2hhciwKICAgIGFkTG9uZ1ZhcldDaGFyOiBhZExvbmdWYXJXQ2hhciwKICAgIGFkTnVtZXJpYzogYWROdW1lcmljLAogICAgYWRTaW5nbGU6IGFkU2luZ2xlLAogICAgYWRTbWFsbEludDogYWRTbWFsbEludCwKICAgIGFkVW5zaWduZWRUaW55SW50OiBhZFVuc2lnbmVkVGlueUludCwKICAgIGFkVmFyQmluYXJ5OiBhZFZhckJpbmFyeSwKICAgIGFkVmFyQ2hhcjogYWRWYXJDaGFyLAogICAgYWRWYXJpYW50OiBhZFZhcmlhbnQsCiAgICBhZFZhcldDaGFyOiBhZFZhcldDaGFyLAogICAgYWRXQ2hhcjogYWRXQ2hhciwKICAgIGFkUGFyYW1Vbmtub3duOiBhZFBhcmFtVW5rbm93biwKICAgIGFkUGFyYW1JbnB1dDogYWRQYXJhbUlucHV0LAogICAgYWRQYXJhbU91dHB1dDogYWRQYXJhbU91dHB1dCwKICAgIGFkUGFyYW1JbnB1dE91dHB1dDogYWRQYXJhbUlucHV0T3V0cHV0LAogICAgYWRQYXJhbVJldHVyblZhbHVlOiBhZFBhcmFtUmV0dXJuVmFsdWUsCiAgICBhZFNjaGVtYVRhYmxlczogYWRTY2hlbWFUYWJsZXMsCiAgICBhZFNjaGVtYUNvbHVtbnM6IGFkU2NoZW1hQ29sdW1ucywKICAgIEFkb2RiOiBBZG9kYgogIH0pOwoKICB2YXIgQWNjREIgPSAvKkBfX1BVUkVfXyovKGZ1bmN0aW9uIChBZG9kYikgewogICAgZnVuY3Rpb24gQWNjREIocGF0aCkgew0KICAgICAgaWYgKCFpc0Fic29sdXRlKHBhdGgpKSB7DQogICAgICAgIHBhdGggPSBub3JtYWxpemUocGF0aCk7DQogICAgICB9DQogICAgICBpZiAoIWlzZmlsZShwYXRoKSkgew0KICAgICAgICB2YXIgYXBwID0gbmV3IEFjdGl2ZVhPYmplY3QoJ0FjY2Vzcy5BcHBsaWNhdGlvbicpOw0KICAgICAgICBhcHAuTmV3Q3VycmVudERhdGFiYXNlKHBhdGgpOw0KICAgICAgfQ0KICAgICAgQWRvZGIuY2FsbCh0aGlzKTsNCiAgICAgIHRoaXMuY29ubi5Db25uZWN0aW9uU3RyaW5nID0gIlByb3ZpZGVyPU1pY3Jvc29mdC5BY2UuT0xFREIuMTIuMDtEYXRhIFNvdXJjZT0iICsgcGF0aDsNCiAgICAgIHRoaXMuY29ubi5PcGVuKCk7DQogICAgfQoKICAgIGlmICggQWRvZGIgKSBBY2NEQi5fX3Byb3RvX18gPSBBZG9kYjsKICAgIEFjY0RCLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEFkb2RiICYmIEFkb2RiLnByb3RvdHlwZSApOwogICAgQWNjREIucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gQWNjREI7CgogICAgcmV0dXJuIEFjY0RCOwogIH0oQWRvZGIpKTsNCg0KICBmdW5jdGlvbiBhY2NkYihwdGgpIHsNCiAgICByZXR1cm4gbmV3IEFjY0RCKHB0aCk7DQogIH0KCiAgdmFyIGFjY2RiJDEgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICBBY2NEQjogQWNjREIsCiAgICAnZGVmYXVsdCc6IGFjY2RiCiAgfSk7CgogIHZhciBDc3ZEQiA9IC8qQF9fUFVSRV9fKi8oZnVuY3Rpb24gKEFkb2RiKSB7CiAgICBmdW5jdGlvbiBDc3ZEQihwYXRoLCBoYXNIZWFkZXIpIHsNCiAgICAgIGlmICghaXNBYnNvbHV0ZShwYXRoKSkgew0KICAgICAgICBwYXRoID0gbm9ybWFsaXplKHBhdGgpOw0KICAgICAgfQ0KICAgICAgaWYgKGlzZmlsZShwYXRoKSkgeyBwYXRoID0gZGlybmFtZShwYXRoKTsgfQ0KICAgICAgdmFyIGhkciA9DQogICAgICAgIGhhc0hlYWRlciA9PSBudWxsIHx8IGhhc0hlYWRlciA9PSB0cnVlIHx8IGhhc0hlYWRlciA9PSAnWUVTJw0KICAgICAgICAgID8gJ1lFUycNCiAgICAgICAgICA6ICdOTyc7DQogICAgICBBZG9kYi5jYWxsKHRoaXMpOw0KICAgICAgdGhpcy5jb25uLkNvbm5lY3Rpb25TdHJpbmcgPSAiUHJvdmlkZXI9TWljcm9zb2Z0LkFjZS5PTEVEQi4xMi4wO0RhdGEgU291cmNlPSIgKyBwYXRoICsgIjtFeHRlbmRlZCBQcm9wZXJ0aWVzPVwiVGV4dDtIRFI9IiArIGhkciArICI7Rk1UPURlbGltaXRlZFwiIjsNCiAgICAgIHRoaXMuY29ubi5PcGVuKCk7DQogICAgfQoKICAgIGlmICggQWRvZGIgKSBDc3ZEQi5fX3Byb3RvX18gPSBBZG9kYjsKICAgIENzdkRCLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEFkb2RiICYmIEFkb2RiLnByb3RvdHlwZSApOwogICAgQ3N2REIucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gQ3N2REI7CgogICAgcmV0dXJuIENzdkRCOwogIH0oQWRvZGIpKTsNCg0KICBmdW5jdGlvbiBjc3ZkYihwYXRoLCBoYXNIZWFkZXIpIHsNCiAgICByZXR1cm4gbmV3IENzdkRCKHBhdGgsIGhhc0hlYWRlcik7DQogIH0KCiAgdmFyIGNzdmRiJDEgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICBDc3ZEQjogQ3N2REIsCiAgICAnZGVmYXVsdCc6IGNzdmRiCiAgfSk7CgogIHZhciBFWENFTF9UWVBFID0gew0KICAgIHhsczogJ0V4Y2VsIDguMCcsDQogICAgeGxzeDogJ0V4Y2VsIDEyLjAgWG1sJywNCiAgICB4bHNiOiAnRXhjZWwgMTIuMCcsDQogICAgeGxzbTogJ0V4Y2VsIDEyLjAgTWFjcm8nDQogIH07DQoNCiAgdmFyIEV4Y2VsREIgPSAvKkBfX1BVUkVfXyovKGZ1bmN0aW9uIChBZG9kYikgewogICAgZnVuY3Rpb24gRXhjZWxEQihwYXRoLCBoYXNIZWFkZXIpIHsNCiAgICAgIGlmICghaXNBYnNvbHV0ZShwYXRoKSkgew0KICAgICAgICBwYXRoID0gbm9ybWFsaXplKHBhdGgpOw0KICAgICAgfQ0KICAgICAgdmFyIGV4dCA9IGV4dG5hbWUocGF0aCkudG9Mb3dlckNhc2UoKTsNCiAgICAgIHZhciBoZHIgPQ0KICAgICAgICBoYXNIZWFkZXIgPT0gbnVsbCB8fCBoYXNIZWFkZXIgPT0gdHJ1ZSB8fCBoYXNIZWFkZXIgPT0gJ1lFUycNCiAgICAgICAgICA/ICdZRVMnDQogICAgICAgICAgOiAnTk8nOw0KICAgICAgaWYgKCFFWENFTF9UWVBFW2V4dF0pIHsgdGhyb3cgbmV3IEVycm9yKGV4dCArICcgZmlsZSBpcyBub3Qgc3VwcG9ydGVkJyk7IH0NCiAgICAgIEFkb2RiLmNhbGwodGhpcyk7DQogICAgICB0aGlzLmNvbm4uQ29ubmVjdGlvblN0cmluZyA9ICJQcm92aWRlcj1NaWNyb3NvZnQuQWNlLk9MRURCLjEyLjA7RGF0YSBTb3VyY2U9IiArIHBhdGggKyAiO0V4dGVuZGVkIFByb3BlcnRpZXM9XCIiICsgKEVYQ0VMX1RZUEVbZXh0XSkgKyAiO0hEUj0iICsgaGRyICsgIlwiIjsNCiAgICAgIHRoaXMuY29ubi5PcGVuKCk7DQogICAgfQoKICAgIGlmICggQWRvZGIgKSBFeGNlbERCLl9fcHJvdG9fXyA9IEFkb2RiOwogICAgRXhjZWxEQi5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBBZG9kYiAmJiBBZG9kYi5wcm90b3R5cGUgKTsKICAgIEV4Y2VsREIucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gRXhjZWxEQjsKCiAgICByZXR1cm4gRXhjZWxEQjsKICB9KEFkb2RiKSk7DQoNCiAgZnVuY3Rpb24gZXhjZWxkYihwYXRoLCBoYXNIZWFkZXIpIHsNCiAgICByZXR1cm4gbmV3IEV4Y2VsREIocGF0aCwgaGFzSGVhZGVyKTsNCiAgfQoKICB2YXIgZXhjZWxkYiQxID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgRXhjZWxEQjogRXhjZWxEQiwKICAgICdkZWZhdWx0JzogZXhjZWxkYgogIH0pOwoKICB2YXIgT3JhY2xlREIgPSAvKkBfX1BVUkVfXyovKGZ1bmN0aW9uIChBZG9kYikgewogICAgZnVuY3Rpb24gT3JhY2xlREIoZHMsIHVzciwgcGFzcykgew0KICAgICAgdHJ5IHsNCiAgICAgICAgQWRvZGIuY2FsbCh0aGlzKTsNCiAgICAgICAgdGhpcy5jb25uLkNvbm5lY3Rpb25TdHJpbmcgPQ0KICAgICAgICAgIC8vID0gYFByb3ZpZGVyPU9yYU9MRURCLk9yYWNsZTtEYXRhIFNvdXJjZT0ke2RzfTtVc2VyIElEPSR7dXNyfTtQYXNzd29yZD0ke3Bhc3N9YDsNCiAgICAgICAgICAiUHJvdmlkZXI9TVNEQU9SQTtEYXRhIFNvdXJjZT0iICsgZHMgKyAiO1VzZXIgSUQ9IiArIHVzciArICI7UGFzc3dvcmQ9IiArIHBhc3M7DQogICAgICAgIHRoaXMuY29ubi5PcGVuKCk7DQogICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIGNvbnNvbGUubG9nKCdEYXRhYmFzZSBjb25uZWN0IGZhaWxlZC4nKTsNCiAgICAgICAgY29uc29sZS5sb2coDQogICAgICAgICAgJ2RhdGFzb3VyY2U6ICVzXG4gICAgdXNlcmlkOiAlc1xuICBwYXNzd29yZDogJXMnLA0KICAgICAgICAgIGRzLA0KICAgICAgICAgIHVzciwNCiAgICAgICAgICBwYXNzDQogICAgICAgICk7DQogICAgICAgIHRocm93IGU7DQogICAgICB9DQogICAgfQoKICAgIGlmICggQWRvZGIgKSBPcmFjbGVEQi5fX3Byb3RvX18gPSBBZG9kYjsKICAgIE9yYWNsZURCLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEFkb2RiICYmIEFkb2RiLnByb3RvdHlwZSApOwogICAgT3JhY2xlREIucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gT3JhY2xlREI7DQoNCiAgICBPcmFjbGVEQi5wcm90b3R5cGUuZ2V0RGF0YVR5cGVNYXBwaW5nID0gZnVuY3Rpb24gZ2V0RGF0YVR5cGVNYXBwaW5nICgpIHsNCiAgICAgIHJldHVybiB7DQogICAgICAgIHN0cmluZzogYWRWYXJpYW50LA0KICAgICAgICBpbnQ6IGFkSW50ZWdlciwNCiAgICAgICAgZGVjaW1hbDogYWROdW1lcmljLA0KICAgICAgICBib29sZWFuOiBhZEJvb2xlYW4sDQogICAgICAgIGRhdGU6IGFkREJUaW1lU3RhbXAsDQogICAgICAgIGJ1ZmZlcjogYWRCaW5hcnksDQogICAgICAgIG51bGw6IGFkVmFyaWFudCwNCiAgICAgICAgdW5kZWZpbmVkOiBhZFZhcmlhbnQNCiAgICAgIH07DQogICAgfTsNCg0KICAgIE9yYWNsZURCLnByb3RvdHlwZS50YWJsZUV4aXN0cyA9IGZ1bmN0aW9uIHRhYmxlRXhpc3RzICh0YWJsZU5hbWUpIHsNCiAgICAgIHZhciByb3cgPSB0aGlzLmZpcnN0Um93KCdzZWxlY3QgMSBmcm9tIHVzZXJfdGFibGVzIHdoZXJlIHRhYmxlX25hbWUgPSA/JywgWw0KICAgICAgICB0YWJsZU5hbWUNCiAgICAgIF0pOw0KICAgICAgcmV0dXJuIHJvdyAhPSBudWxsOw0KICAgIH07DQoNCiAgICBPcmFjbGVEQi5wcm90b3R5cGUuZ2V0VGFibGVzID0gZnVuY3Rpb24gZ2V0VGFibGVzICgpIHsNCiAgICAgIHZhciByb3dzID0gdGhpcy5yb3dzKCdzZWxlY3QgdGFibGVfbmFtZSBmcm9tIHVzZXJfdGFibGVzJyk7DQogICAgICByZXR1cm4gcm93cy5tYXAoZnVuY3Rpb24gKGl0KSB7IHJldHVybiBpdC5UQUJMRV9OQU1FOyB9KTsNCiAgICB9OwoKICAgIHJldHVybiBPcmFjbGVEQjsKICB9KEFkb2RiKSk7DQoNCiAgZnVuY3Rpb24gb3JhY2xlZGIoZHMsIHVzciwgcGFzcykgew0KICAgIHJldHVybiBuZXcgT3JhY2xlREIoZHMsIHVzciwgcGFzcyk7DQogIH0NCg0KICAvLyBPcmFPTEVEQg0KDQogIHZhciBfdmJzJDEsIF9zZXNzaW9uOw0KDQogIHZhciBPbzRvID0gLypAX19QVVJFX18qLyhmdW5jdGlvbiAoQWRvZGIpIHsKICAgIGZ1bmN0aW9uIE9vNG8oZHMsIHVzZXIsIHBhc3MpIHsNCiAgICAgIEFkb2RiLmNhbGwodGhpcyk7DQogICAgICB0aGlzLmRhdGFCYXNlID0gdGhpcy5zZXNzaW9uLk9wZW5EYXRhYmFzZShkcywgdXNlciArICcvJyArIHBhc3MsIDApOw0KICAgIH0KCiAgICBpZiAoIEFkb2RiICkgT280by5fX3Byb3RvX18gPSBBZG9kYjsKICAgIE9vNG8ucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggQWRvZGIgJiYgQWRvZGIucHJvdG90eXBlICk7CiAgICBPbzRvLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IE9vNG87CgogICAgdmFyIHByb3RvdHlwZUFjY2Vzc29ycyA9IHsgdmJzOiB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSB9LHNlc3Npb246IHsgY29uZmlndXJhYmxlOiB0cnVlIH0gfTsNCg0KICAgIHByb3RvdHlwZUFjY2Vzc29ycy52YnMuZ2V0ID0gZnVuY3Rpb24gKCkgew0KICAgICAgaWYgKCFfdmJzJDEpIHsNCiAgICAgICAgX3ZicyQxID0gX19WQlM7DQogICAgICAgIF92YnMkMS5BZGRDb2RlKCJcbkZ1bmN0aW9uIFJlYWRCbG9iKGZpZWxkKVxuICBEaW0gYnVmKClcbiAgZmllbGQuR2V0Q2h1bmtCeXRlRXggYnVmLCAwLCBmaWVsZC5GaWVsZFNpemUoKVxuICBSZWFkQmxvYiA9IGJ1ZlxuRW5kIEZ1bmN0aW9uXG5cbkZ1bmN0aW9uIFJlYWRDbG9iKGZpZWxkKVxuICBEaW0gYnVmXG4gIGZpZWxkLlZhbHVlLlJlYWQgYnVmXG4gIFJlYWRDbG9iID0gYnVmXG5FbmQgRnVuY3Rpb25cbiAgICAgICIpOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIF92YnMkMS5Db2RlT2JqZWN0Ow0KICAgIH07DQoNCiAgICBwcm90b3R5cGVBY2Nlc3NvcnMuc2Vzc2lvbi5nZXQgPSBmdW5jdGlvbiAoKSB7DQogICAgICBpZiAoIV9zZXNzaW9uKSB7DQogICAgICAgIF9zZXNzaW9uID0gbmV3IEFjdGl2ZVhPYmplY3QoJ09yYWNsZUluUHJvY1NlcnZlci5YT3JhU2Vzc2lvbicpOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIF9zZXNzaW9uOw0KICAgIH07CgogICAgT280by5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiBjbG9zZSAoKSB7DQogICAgICB0aGlzLmRhdGFCYXNlLkNsb3NlKCk7DQogICAgICB0aGlzLmRhdGFCYXNlID0gbnVsbDsNCiAgICAgIF9zZXNzaW9uID0gbnVsbDsNCiAgICB9Ow0KDQogICAgT280by5wcm90b3R5cGUuYmVnaW4gPSBmdW5jdGlvbiBiZWdpbiAoKSB7DQogICAgICB0aGlzLnNlc3Npb24uQmVnaW5UcmFucygpOw0KICAgIH07DQoNCiAgICBPbzRvLnByb3RvdHlwZS5jb21taXQgPSBmdW5jdGlvbiBjb21taXQgKCkgew0KICAgICAgdGhpcy5zZXNzaW9uLkNvbW1pdFRyYW5zKCk7DQogICAgfTsNCg0KICAgIE9vNG8ucHJvdG90eXBlLnJvbGxiYWNrID0gZnVuY3Rpb24gcm9sbGJhY2sgKCkgew0KICAgICAgdGhpcy5zZXNzaW9uLlJvbGxiYWNrKCk7DQogICAgfTsNCg0KICAgIE9vNG8ucHJvdG90eXBlLmdldERhdGFUeXBlTWFwcGluZyA9IGZ1bmN0aW9uIGdldERhdGFUeXBlTWFwcGluZyAoKSB7DQogICAgICByZXR1cm4gew0KICAgICAgICBzdHJpbmc6IDEsDQogICAgICAgIGludDogMiwNCiAgICAgICAgZGVjaW1hbDogMiwNCiAgICAgICAgbnVtYmVyOiAyLA0KICAgICAgICBib29sZWFuOiAxLA0KICAgICAgICBkYXRlOiAxMiwNCiAgICAgICAgYnVmZmVyOiAxMTMsDQogICAgICAgIG51bGw6IDEsDQogICAgICAgIHVuZGVmaW5lZDogMQ0KICAgICAgfTsNCiAgICB9Ow0KDQogICAgT280by5wcm90b3R5cGUuY3JlYXRlUGFyYW1zID0gZnVuY3Rpb24gY3JlYXRlUGFyYW1zIChvcHRzKSB7DQogICAgICB2YXIgcGFyYW1zID0gb3B0cy5wYXJhbXMsDQogICAgICAgIHNlbGYgPSB0aGlzOw0KICAgICAgaWYgKCFwYXJhbXMpIHsgcmV0dXJuOyB9DQogICAgICB2YXIgZHRtYXAgPSB0aGlzLmdldERhdGFUeXBlTWFwcGluZygpOw0KICAgICAgZWFjaChwYXJhbXMsIGZ1bmN0aW9uICh2LCBrKSB7DQogICAgICAgIHZhciB0eXBlID0gZHRtYXBbdHlwZU9mKHYpXSB8fCAxOw0KICAgICAgICBzZWxmLmRhdGFCYXNlLlBhcmFtZXRlcnMuQWRkKFN0cmluZyhrKSwgdiwgMSwgdHlwZSk7DQoNCiAgICAgICAgaWYgKGlzQXJyYXkocGFyYW1zKSAmJiBvcHRzLnNxbC5pbmNsdWRlcygnPycpKSB7DQogICAgICAgICAgdmFyIGluZGV4ID0gMDsNCiAgICAgICAgICBvcHRzLnNxbCA9IG9wdHMuc3FsLnJlcGxhY2UoL1w/L2csIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHJldHVybiAnOicgKyBpbmRleCsrOw0KICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9Ow0KDQogICAgT280by5wcm90b3R5cGUucmVtb3ZlUGFyYW1zID0gZnVuY3Rpb24gcmVtb3ZlUGFyYW1zIChvcHRzKSB7DQogICAgICB2YXIgcGFyYW1zID0gb3B0cy5wYXJhbXMsDQogICAgICAgIHNlbGYgPSB0aGlzOw0KICAgICAgaWYgKCFwYXJhbXMpIHsgcmV0dXJuOyB9DQogICAgICBlYWNoKHBhcmFtcywgZnVuY3Rpb24gKHYsIGspIHsNCiAgICAgICAgc2VsZi5kYXRhQmFzZS5QYXJhbWV0ZXJzLlJlbW92ZShTdHJpbmcoaykpOw0KICAgICAgfSk7DQogICAgfTsNCg0KICAgIE9vNG8ucHJvdG90eXBlLmV4ZWN1dGUgPSBmdW5jdGlvbiBleGVjdXRlICgpIHsKICAgICAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDsKICAgICAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTsKDQogICAgICB2YXIgb3B0cyA9IHRoaXMuZ2V0T3B0aW9ucyhhcmdzKTsNCiAgICAgIHRyeSB7DQogICAgICAgIHRoaXMuY3JlYXRlUGFyYW1zKG9wdHMpOw0KICAgICAgICByZXR1cm4gdGhpcy5kYXRhQmFzZS5FeGVjdXRlU1FMKG9wdHMuc3FsKTsNCiAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgZS5zcWwgPSBvcHRzLnNxbDsNCiAgICAgICAgdGhyb3cgZTsNCiAgICAgIH0gZmluYWxseSB7DQogICAgICAgIHRoaXMucmVtb3ZlUGFyYW1zKG9wdHMpOw0KICAgICAgfQ0KICAgIH07DQoNCiAgICBPbzRvLnByb3RvdHlwZS5zZWxlY3QgPSBmdW5jdGlvbiBzZWxlY3QgKCkgewogICAgICB2YXIgYXJncyA9IFtdLCBsZW4kMSA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgIHdoaWxlICggbGVuJDEtLSApIGFyZ3NbIGxlbiQxIF0gPSBhcmd1bWVudHNbIGxlbiQxIF07Cg0KICAgICAgdmFyIHJzLA0KICAgICAgICByb3csDQogICAgICAgIGksDQogICAgICAgIGxlbiwNCiAgICAgICAgb3B0cyA9IHRoaXMuZ2V0T3B0aW9ucyhhcmdzKTsNCiAgICAgIHRyeSB7DQogICAgICAgIHRoaXMuY3JlYXRlUGFyYW1zKG9wdHMpOw0KICAgICAgICBycyA9IHRoaXMuZGF0YUJhc2UuQ3JlYXRlRHluYXNldChvcHRzLnNxbCwgMCk7DQogICAgICAgIHdoaWxlICghcnMuRU9GKSB7DQogICAgICAgICAgcm93ID0ge307DQogICAgICAgICAgaWYgKGxlbiA9PSBudWxsKSB7IGxlbiA9IHJzLkZpZWxkcy5Db3VudDsgfQ0KICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykgew0KICAgICAgICAgICAgcm93W3JzLkZpZWxkcyhpKS5OYW1lXSA9IHRoaXMuZ2V0RmllbGRWYWx1ZShycy5GaWVsZHMoaSkpOw0KICAgICAgICAgIH0NCiAgICAgICAgICBpZiAob3B0cy5jYWxsYmFjayhyb3cpID09PSBmYWxzZSkgeyBicmVhazsgfQ0KICAgICAgICAgIHJzLk1vdmVOZXh0KCk7DQogICAgICAgIH0NCiAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgZS5zcWwgPSBvcHRzLnNxbDsNCiAgICAgICAgdGhyb3cgZTsNCiAgICAgIH0gZmluYWxseSB7DQogICAgICAgIHRoaXMucmVtb3ZlUGFyYW1zKG9wdHMpOw0KICAgICAgICBycyAmJiBycy5DbG9zZSgpOw0KICAgICAgfQ0KICAgIH07DQoNCiAgICBPbzRvLnByb3RvdHlwZS5nZXRGaWVsZFZhbHVlID0gZnVuY3Rpb24gZ2V0RmllbGRWYWx1ZSAoZmllbGQpIHsNCiAgICAgIHN3aXRjaCAoZmllbGQuT3JhSURhdGFUeXBlKSB7DQogICAgICAgIGNhc2UgMjoNCiAgICAgICAgY2FzZSA4Og0KICAgICAgICAgIHJldHVybiBOdW1iZXIoZmllbGQudmFsdWUpOw0KICAgICAgICBjYXNlIDExMjoNCiAgICAgICAgICByZXR1cm4gdGhpcy52YnMuUmVhZENsb2IoZmllbGQpOw0KICAgICAgICBjYXNlIDExMzoNCiAgICAgICAgICByZXR1cm4gQnVmZmVyLmZyb20odGhpcy52YnMuUmVhZEJsb2IoZmllbGQpKTsNCiAgICAgICAgY2FzZSAxMjoNCiAgICAgICAgY2FzZSAxODc6DQogICAgICAgIGNhc2UgMTg4Og0KICAgICAgICBjYXNlIDIzMjoNCiAgICAgICAgICByZXR1cm4gbmV3IERhdGUoZmllbGQudmFsdWUpOw0KICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgIHJldHVybiBmaWVsZC52YWx1ZTsNCiAgICAgIH0NCiAgICB9Ow0KDQogICAgT280by5wcm90b3R5cGUuYmF0Y2ggPSBmdW5jdGlvbiBiYXRjaCAoKSB7fTsNCg0KICAgIE9vNG8ucHJvdG90eXBlLmJhdGNoX2luc2VydCA9IGZ1bmN0aW9uIGJhdGNoX2luc2VydCAoY21kLCByb3dzKSB7DQogICAgICB2YXIgc2VsZiA9IHRoaXM7DQogICAgICB2YXIgcnMgPSB0aGlzLmRhdGFCYXNlLkNyZWF0ZUR5bmFzZXQoY21kLCAwKTsNCiAgICAgIHRyeSB7DQogICAgICAgIHRoaXMuYmVnaW4oKTsNCiAgICAgICAgZWFjaChyb3dzLCBmdW5jdGlvbiAocm93KSB7DQogICAgICAgICAgcnMuQWRkTmV3KCk7DQogICAgICAgICAgZWFjaChyb3csIGZ1bmN0aW9uICh2LCBrKSB7DQogICAgICAgICAgICBzZWxmLnNldEZpZWxkVmFsdWUocnMuRmllbGRzKGspLCB2KTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgICBycy5VcGRhdGUoKTsNCiAgICAgICAgfSk7DQogICAgICAgIHRoaXMuY29tbWl0KCk7DQogICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIHRoaXMucm9sbGJhY2soKTsNCiAgICAgICAgdGhyb3cgZTsNCiAgICAgIH0gZmluYWxseSB7DQogICAgICAgIHJzICYmIHJzLkNsb3NlKCk7DQogICAgICB9DQogICAgfTsKCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyggT280by5wcm90b3R5cGUsIHByb3RvdHlwZUFjY2Vzc29ycyApOwoKICAgIHJldHVybiBPbzRvOwogIH0oQWRvZGIpKTsNCg0KICBmdW5jdGlvbiBvbzRvKGRzLCB1c2VyLCBwYXNzKSB7DQogICAgcmV0dXJuIG5ldyBPbzRvKGRzLCB1c2VyLCBwYXNzKTsNCiAgfQoKICB2YXIgb3JhY2xlZGIkMSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgIE9yYWNsZURCOiBPcmFjbGVEQiwKICAgICdkZWZhdWx0Jzogb3JhY2xlZGIsCiAgICBPbzRvOiBPbzRvLAogICAgb280bzogb280bwogIH0pOwoKICB2YXIgX3NlcnZpY2U7DQoNCiAgZnVuY3Rpb24gZ2V0U2VydmljZSgpIHsNCiAgICBpZiAoIV9zZXJ2aWNlKSB7DQogICAgICB2YXIgbG9jYXRvciA9IG5ldyBBY3RpdmVYT2JqZWN0KCdXYmVtU2NyaXB0aW5nLlNXYmVtTG9jYXRvcicpOw0KICAgICAgX3NlcnZpY2UgPSBsb2NhdG9yLkNvbm5lY3RTZXJ2ZXIoJy4nLCAncm9vdFxcQ0lNVjInKTsNCiAgICB9DQogICAgcmV0dXJuIF9zZXJ2aWNlOw0KICB9DQoNCiAgZnVuY3Rpb24gZ2V0JDEoY21kKSB7DQogICAgcmV0dXJuIGdldFNlcnZpY2UoKS5HZXQoY21kKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGV4ZWMkMSh3cWwpIHsNCiAgICByZXR1cm4gZ2V0U2VydmljZSgpLkV4ZWNRdWVyeSh3cWwpOw0KICB9DQoNCiAgZnVuY3Rpb24gcXVlcnkod3FsKSB7DQogICAgdmFyIHJzID0gZXhlYyQxKHdxbCk7DQogICAgdmFyIHJvd3MgPSBtYXAocnMsIGZ1bmN0aW9uIChyZWNvcmQpIHsNCiAgICAgIHJldHVybiByZWR1Y2UoDQogICAgICAgIHJlY29yZC5Qcm9wZXJ0aWVzXywNCiAgICAgICAgZnVuY3Rpb24gKHJvd0RhdGEsIHByb3ApIHsNCiAgICAgICAgICBpZiAocHJvcC5WYWx1ZSAhPSBudWxsKSB7DQogICAgICAgICAgICByb3dEYXRhW3Byb3AubmFtZV0gPSBwcm9wLklzQXJyYXkNCiAgICAgICAgICAgICAgPyBuZXcgVkJBcnJheShwcm9wLlZhbHVlKS50b0FycmF5KCkNCiAgICAgICAgICAgICAgOiBwcm9wLlZhbHVlOw0KICAgICAgICAgIH0NCiAgICAgICAgICByZXR1cm4gcm93RGF0YTsNCiAgICAgICAgfSwNCiAgICAgICAge30NCiAgICAgICk7DQogICAgfSk7DQogICAgcnMgPSBudWxsOw0KICAgIHJldHVybiByb3dzOw0KICB9DQoNCiAgZnVuY3Rpb24gZWFjaFJvdyh3cWwsIGNiKSB7DQogICAgdmFyIHJzID0gZXhlYyQxKHdxbCk7DQogICAgZWFjaChycywgZnVuY3Rpb24gKGl0KSB7IHJldHVybiBjYihpdCk7IH0pOw0KICAgIHJzID0gbnVsbDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGZpcnN0Um93KHdxbCkgew0KICAgIHZhciBvYmo7DQogICAgdmFyIHJzID0gZXhlYyQxKHdxbCk7DQogICAgZWFjaChycywgZnVuY3Rpb24gKGl0KSB7DQogICAgICBvYmogPSBpdDsNCiAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9KTsNCiAgICBycyA9IG51bGw7DQogICAgcmV0dXJuIG9iajsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNwdSgpIHsNCiAgICByZXR1cm4gcXVlcnkoJ3NlbGVjdCAqIGZyb20gV2luMzJfUHJvY2Vzc29yJylbMF07DQogIH0NCg0KICBmdW5jdGlvbiBzeXMoKSB7DQogICAgcmV0dXJuIHF1ZXJ5KCdzZWxlY3QgKiBmcm9tIFdpbjMyX0NvbXB1dGVyU3lzdGVtJylbMF07DQogIH0NCg0KICBmdW5jdGlvbiBvcygpIHsNCiAgICByZXR1cm4gcXVlcnkoJ3NlbGVjdCAqIGZyb20gV2luMzJfT3BlcmF0aW5nU3lzdGVtJylbMF07DQogIH0NCg0KICBmdW5jdGlvbiBzaHV0ZG93bihmb3JjZWQpIHsNCiAgICByZXR1cm4gZmlyc3RSb3coJ3NlbGVjdCAqIGZyb20gV2luMzJfT3BlcmF0aW5nU3lzdGVtJykuV2luMzJTaHV0ZG93bigNCiAgICAgIDEgKyAoZm9yY2VkID8gNCA6IDApDQogICAgKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGxvZ29mZihmb3JjZWQpIHsNCiAgICByZXR1cm4gZmlyc3RSb3coJ3NlbGVjdCAqIGZyb20gV2luMzJfT3BlcmF0aW5nU3lzdGVtJykuV2luMzJTaHV0ZG93bigNCiAgICAgIDAgKyAoZm9yY2VkID8gNCA6IDApDQogICAgKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlc3RhcnQoZm9yY2VkKSB7DQogICAgcmV0dXJuIGZpcnN0Um93KCdzZWxlY3QgKiBmcm9tIFdpbjMyX09wZXJhdGluZ1N5c3RlbScpLldpbjMyU2h1dGRvd24oDQogICAgICAyICsgKGZvcmNlZCA/IDQgOiAwKQ0KICAgICk7DQogIH0NCg0KICBmdW5jdGlvbiBwb3dlcm9mZihmb3JjZWQpIHsNCiAgICByZXR1cm4gZmlyc3RSb3coJ3NlbGVjdCAqIGZyb20gV2luMzJfT3BlcmF0aW5nU3lzdGVtJykuV2luMzJTaHV0ZG93bigNCiAgICAgIDggKyAoZm9yY2VkID8gNCA6IDApDQogICAgKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHBzKGwpIHsNCiAgICB2YXIgcHJvcHMgPSBbJ1Byb2Nlc3NJZCcsICdDYXB0aW9uJ107DQogICAgaWYgKGwpIHsgcHJvcHMucHVzaCgnUGFyZW50UHJvY2Vzc0lkJywgJ0NyZWF0aW9uRGF0ZScsICdDb21tYW5kTGluZScpOyB9DQogICAgcmV0dXJuIG1hcChleGVjJDEoJ3NlbGVjdCAqIGZyb20gV2luMzJfUHJvY2VzcycpLCBmdW5jdGlvbiAoaXQpIHsNCiAgICAgIHJldHVybiByZWR1Y2UocHJvcHMsIGZ1bmN0aW9uIChyb3csIG5hbWUpIHsgcmV0dXJuICgocm93W25hbWVdID0gaXRbbmFtZV0pLCByb3cpOyB9LCB7fSk7DQogICAgfSk7DQogIH0NCg0KICBmdW5jdGlvbiBraWxsKGFyZykgew0KICAgIHZhciB3cWwgPSAnc2VsZWN0ICogZnJvbSBXaW4zMl9Qcm9jZXNzJzsNCiAgICBpZiAoaXNTdHJpbmcoYXJnKSkgeyB3cWwgKz0gIiB3aGVyZSBDYXB0aW9uPSciICsgYXJnICsgIiciOyB9DQogICAgZWxzZSBpZiAoaXNOdW1iZXIoYXJnKSkgeyB3cWwgKz0gIiB3aGVyZSBQcm9jZXNzSWQ9IiArIGFyZzsgfQ0KICAgIGVsc2UgeyByZXR1cm4gLTE7IH0NCiAgICByZXR1cm4gZmlyc3RSb3cod3FsKS5UZXJtaW5hdGUoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGVudigpIHsNCiAgICByZXR1cm4gcmVkdWNlKA0KICAgICAgZXhlYyQxKCdzZWxlY3QgKiBmcm9tIFdpbjMyX0Vudmlyb25tZW50JyksDQogICAgICBmdW5jdGlvbiAocmVzdWx0LCBpdCkgeyByZXR1cm4gKChyZXN1bHRbaXQuTmFtZV0gPSBpdC5WYXJpYWJsZVZhbHVlKSwgcmVzdWx0KTsgfSwNCiAgICAgIHt9DQogICAgKTsNCiAgfQoKICB2YXIgd21pID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgZ2V0OiBnZXQkMSwKICAgIGV4ZWM6IGV4ZWMkMSwKICAgIHF1ZXJ5OiBxdWVyeSwKICAgIGVhY2hSb3c6IGVhY2hSb3csCiAgICBmaXJzdFJvdzogZmlyc3RSb3csCiAgICBjcHU6IGNwdSwKICAgIHN5czogc3lzLAogICAgb3M6IG9zLAogICAgc2h1dGRvd246IHNodXRkb3duLAogICAgbG9nb2ZmOiBsb2dvZmYsCiAgICByZXN0YXJ0OiByZXN0YXJ0LAogICAgcG93ZXJvZmY6IHBvd2Vyb2ZmLAogICAgcHM6IHBzLAogICAga2lsbDoga2lsbCwKICAgIGVudjogZW52CiAgfSk7CgogIHZhciBDSEFJTl9BUEkgPSAiXG5Db2xsZWN0aW9uXG4gZWFjaChmb3JFYWNoKVxuIG1hcChzZWxlY3QpXG4gcmVkdWNlXG4gZmlsdGVyKHdoZXJlKVxuIHRvQXJyYXlcbiBmaW5kXG4gZmluZEluZGV4XG4gZ3JvdXBCeVxuIGNvdW50QnlcbiBzaXplKGxlbilcbkFycmF5XG4gdW5pcUJ5KGRpc3RpbmN0QnkpXG4gdW5pcShkaXN0aW5jdClcbiBjaHVua1xuIGNvbmNhdFxuIHNsaWNlXG4gZHJvcFxuIHRhaWxcbiBpbml0aWFsXG4gdGFrZVxuIGNvbnRhaW5zKGluY2x1ZGUsaW5jbHVkZXMpXG4gZmlyc3QoaGVhZClcbiBsYXN0XG4gbnRoXG4gcHVsbEFsbFxuIHB1bGxcbiByZW1vdmVcbiBkaWZmZXJlbmNlXG4gdW56aXBcbiB6aXBcbiBmbGF0dGVuXG5PYmplY3RcbiBrZXlzXG4gdmFsdWVzXG4gemlwT2JqZWN0XG4gZnJvbVBhaXJzXG4gb2JqZWN0XG4gZ2V0XG4gc2V0XG4gdW5zZXRcbiB1cGRhdGVcbiBwaWNrXG4gZXh0ZW5kKGFzc2lnbkluKVxuIGRlZmF1bHRzXG4gZW50cmllcyh0b1BhaXJzKVxuTWF0aFxuIHN1bVxuIGF2ZXJhZ2UoYXZnKVxuU3RyaW5nXG4gZWFjaE1hdGNoXG4gZmluZEFsbFxuIjsNCg0KICBmdW5jdGlvbiBjaGFpbl9pbml0KG9iaikgew0KICAgIHRoaXMuX29iaiA9IG9iajsNCiAgfQ0KDQogIGZ1bmN0aW9uIENoYWluKG9iaikgew0KICAgIHJldHVybiBuZXcgY2hhaW5faW5pdChvYmopOw0KICB9DQoNCiAgdmFyIENIQUlOX1BST1RPID0gKGNoYWluX2luaXQucHJvdG90eXBlID0gQ2hhaW4ucHJvdG90eXBlKTsNCg0KICBleHRlbmQoQ2hhaW4sIHRvb2wpOw0KDQogIGVhY2hNYXRjaChDSEFJTl9BUEksIC8gKyhcdyspKD86XCgoLispXCkpPy9nLCBmdW5jdGlvbiAobTAsIG5hbWUsIGFsaWFzKSB7DQogICAgdmFyIGZuID0gdG9vbFtuYW1lXTsNCiAgICBpZiAoIWZuKSB7IHRocm93IG5ldyBFcnJvcigobmFtZSArICIgbm90IGV4aXRzIGluIHRvb2wiKSk7IH0NCiAgICB2YXIgd3JhcHBlZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgdGhpcy5fb2JqID0gYXBwbHkoZm4sIG51bGwsIGNvbmNhdChbdGhpcy5fb2JqXSwgYXJndW1lbnRzKSk7DQogICAgICByZXR1cm4gdGhpczsNCiAgICB9Ow0KICAgIENIQUlOX1BST1RPW25hbWVdID0gd3JhcHBlZDsNCiAgICBpZiAoYWxpYXMpIHsNCiAgICAgIGFsaWFzLnNwbGl0KCcsJykuZm9yRWFjaChmdW5jdGlvbiAoX25hbWUpIHsNCiAgICAgICAgQ0hBSU5fUFJPVE9bX25hbWVdID0gd3JhcHBlZDsNCiAgICAgIH0pOw0KICAgIH0NCiAgfSk7DQoNCiAgZXh0ZW5kKENIQUlOX1BST1RPLCB7DQogICAgdmFsdWU6IGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuIHRoaXMuX29iajsNCiAgICB9LA0KDQogICAgdGFwOiBmdW5jdGlvbihmbikgew0KICAgICAgZm4odGhpcy5fb2JqKTsNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0sDQoNCiAgICB0aHJ1OiBmdW5jdGlvbihmbikgew0KICAgICAgdGhpcy5fb2JqID0gZm4odGhpcy5fb2JqKTsNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0sDQoNCiAgICBsb2c6IGZ1bmN0aW9uKG1zZykgew0KICAgICAgbXNnID8gY29uc29sZS5sb2cobXNnLCB0aGlzLl9vYmopIDogY29uc29sZS5sb2codGhpcy5fb2JqKTsNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0sDQoNCiAgICB0b0ZpbGU6IGZ1bmN0aW9uKHB0aCwgb3B0aW9ucykgew0KICAgICAgdmFyIGRhdGEgPSB0aGlzLl9vYmo7DQogICAgICBpZiAoaXNPYmplY3QoZGF0YSkpIHsNCiAgICAgICAgZGF0YSA9IGluc3BlY3QoZGF0YSwgb3B0aW9ucyk7DQogICAgICB9DQogICAgICBvdXRwdXRGaWxlU3luYyhwdGgsIGRhdGEsIG9wdGlvbnMpOw0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfSwNCg0KICAgIHRvSlNPTjogZnVuY3Rpb24ocHRoLCBvcHRpb25zKSB7DQogICAgICBvdXRwdXRKc29uU3luYyhwdGgsIHRoaXMuX29iaiwgb3B0aW9ucyk7DQogICAgICByZXR1cm4gdGhpczsNCiAgICB9LA0KDQogICAgdG9Kc29uOiBmdW5jdGlvbihwdGgsIG9wdGlvbnMpIHsNCiAgICAgIHJldHVybiB0aGlzLnRvSlNPTihwdGgsIG9wdGlvbnMpOw0KICAgIH0sDQoNCiAgICB0b0NTVjogZnVuY3Rpb24ocHRoLCBvcHRpb25zKSB7DQogICAgICB2YXIgZGF0YSA9IHN0cmluZ2lmeSQxKHRoaXMuX29iaiwgb3B0aW9ucyk7DQogICAgICBvdXRwdXRGaWxlU3luYyhwdGgsIGRhdGEsIG9wdGlvbnMpOw0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfSwNCg0KICAgIHRvQ3N2OiBmdW5jdGlvbihwdGgsIG9wdGlvbnMpIHsNCiAgICAgIHJldHVybiB0aGlzLnRvQ1NWKHB0aCwgb3B0aW9ucyk7DQogICAgfQ0KICB9KTsNCg0KICBDaGFpbi5yYW5nZSA9IGZ1bmN0aW9uKCkgew0KICAgIHZhciBkYXRhID0gYXBwbHkocmFuZ2UsIG51bGwsIGFyZ3VtZW50cyk7DQogICAgcmV0dXJuIENoYWluKGRhdGEpOw0KICB9Ow0KDQogIENoYWluLnRleHQgPSBmdW5jdGlvbihwdGgsIGVuY29kaW5nKSB7DQogICAgaWYgKCFpc2FicyhwdGgpKSB7IHB0aCA9IGFic3BhdGgocHRoKTsgfQ0KICAgIHZhciBkYXRhID0gcmVhZEZpbGVTeW5jKHB0aCwgZW5jb2RpbmcgfHwgJ1VURi04Jyk7DQogICAgcmV0dXJuIENoYWluKGRhdGEpOw0KICB9Ow0KDQogIENoYWluLmxpbmVzID0gZnVuY3Rpb24ocHRoKSB7DQogICAgaWYgKCFpc2FicyhwdGgpKSB7IHB0aCA9IGFic3BhdGgocHRoKTsgfQ0KICAgIHZhciBkYXRhID0gcmVhZExpbmVzU3luYyhwdGgpOw0KICAgIHJldHVybiBDaGFpbihkYXRhKTsNCiAgfTsNCg0KICBDaGFpbi5qc29uID0gZnVuY3Rpb24ocHRoKSB7DQogICAgdmFyIGRhdGEgPSByZWFkSnNvblN5bmMocHRoKTsNCiAgICByZXR1cm4gQ2hhaW4oZGF0YSk7DQogIH07DQoNCiAgQ2hhaW4uY3N2ID0gZnVuY3Rpb24ocHRoLCBlbmNvZGluZykgew0KICAgIGlmICghaXNhYnMocHRoKSkgeyBwdGggPSBhYnNwYXRoKHB0aCk7IH0NCiAgICB2YXIgZGF0YSA9IHJlYWRGaWxlU3luYyhwdGgsIGVuY29kaW5nIHx8ICdVVEYtOCcpOw0KICAgIHJldHVybiBDaGFpbihwYXJzZSQyKGRhdGEpKTsNCiAgfTsNCg0KICBDaGFpbi5yZWFkZGlyID0gZnVuY3Rpb24ocHRoKSB7DQogICAgaWYgKCFpc2FicyhwdGgpKSB7IHB0aCA9IGFic3BhdGgocHRoKTsgfQ0KICAgIHZhciBkYXRhID0gcmVhZGRpclN5bmMocHRoKTsNCiAgICByZXR1cm4gQ2hhaW4oZGF0YSk7DQogIH07DQoNCiAgQ2hhaW4uc2NhbmRpciA9IGZ1bmN0aW9uKHB0aCkgew0KICAgIGlmICghaXNhYnMocHRoKSkgeyBwdGggPSBhYnNwYXRoKHB0aCk7IH0NCiAgICB2YXIgZGF0YSA9IHNjYW5kaXIocHRoKTsNCiAgICByZXR1cm4gQ2hhaW4oZGF0YSk7DQogIH07DQoNCiAgQ2hhaW4ud2FsayA9IGZ1bmN0aW9uKHB0aCwgc2VsZWN0KSB7DQogICAgdmFyIGRhdGEgPSBbXTsNCiAgICBpZiAoIXNlbGVjdCkgeyBzZWxlY3QgPSBmdW5jdGlvbiAoaXQpIHsgcmV0dXJuIGl0LnBhdGg7IH07IH0NCiAgICB3YWxrKHB0aCwgZnVuY3Rpb24gKGl0KSB7DQogICAgICBkYXRhLnB1c2goc2VsZWN0KGl0KSk7DQogICAgfSk7DQogICAgcmV0dXJuIENoYWluKGRhdGEpOw0KICB9Ow0KDQogIENoYWluLm1hdGNoID0gZnVuY3Rpb24oc3RyLCBwYXR0ZXJuKSB7CiAgICB2YXIgYXJndW1lbnRzJDEgPSBhcmd1bWVudHM7Cg0KICAgIHZhciBtYXRjaGVzID0gW107DQogICAgZWFjaE1hdGNoKHN0ciwgcGF0dGVybiwgZnVuY3Rpb24gKCkgew0KICAgICAgbWF0Y2hlcy5wdXNoKGFyZ3VtZW50cyQxKTsNCiAgICB9KTsNCiAgICByZXR1cm4gQ2hhaW4obWF0Y2hlcyk7DQogIH07DQoNCiAgQ2hhaW4uYXBpID0gQ0hBSU5fQVBJOwoKICB2YXIgY2hhaW4gPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICAnZGVmYXVsdCc6IENoYWluCiAgfSk7CgogIHZhciBSRUdFWF9QQVJTRSA9IC9eKFxkezR9KVstL10/KFxkezEsMn0pWy0vXT8oXGR7MSwyfSlbXjAtOV0qKFxkezEsMn0pPzo/KFxkezEsMn0pPzo/KFxkezEsMn0pP1wuPyhcZHsxLDN9KT8kLzsNCiAgdmFyIFJFR0VYX0ZPUk1BVCA9IC9cWyhbXlxdXSspXXxZezIsNH18TXsxLDR9fER7MSwyfXxkezEsNH18SHsxLDJ9fGh7MSwyfXxhfEF8bXsxLDJ9fHN7MSwyfXxaezEsMn18U1NTL2c7DQogIHZhciBNUyA9ICdtaWxsaXNlY29uZCc7DQogIHZhciBTID0gJ3NlY29uZCc7DQogIHZhciBNSU4gPSAnbWludXRlJzsNCiAgdmFyIEggPSAnaG91cic7DQogIHZhciBEID0gJ2RheSc7DQogIHZhciBXID0gJ3dlZWsnOw0KICB2YXIgTSA9ICdtb250aCc7DQogIHZhciBRID0gJ3F1YXJ0ZXInOw0KICB2YXIgWSA9ICd5ZWFyJzsNCiAgdmFyIERBVEUgPSAnZGF0ZSc7DQogIHZhciBGT1JNQVRfREVGQVVMVCA9ICdZWVlZLU1NLUREVEhIOm1tOnNzWic7DQogIHZhciBJTlZBTElEX0RBVEVfU1RSSU5HID0gJ0ludmFsaWQgRGF0ZSc7DQoNCiAgdmFyIExzID0gew0KICAgIGVuOiB7DQogICAgICBuYW1lOiAnZW4nLA0KICAgICAgd2Vla2RheXM6ICdTdW5kYXlfTW9uZGF5X1R1ZXNkYXlfV2VkbmVzZGF5X1RodXJzZGF5X0ZyaWRheV9TYXR1cmRheScuc3BsaXQoDQogICAgICAgICdfJw0KICAgICAgKSwNCiAgICAgIG1vbnRoczogJ0phbnVhcnlfRmVicnVhcnlfTWFyY2hfQXByaWxfTWF5X0p1bmVfSnVseV9BdWd1c3RfU2VwdGVtYmVyX09jdG9iZXJfTm92ZW1iZXJfRGVjZW1iZXInLnNwbGl0KA0KICAgICAgICAnXycNCiAgICAgICkNCiAgICB9DQogIH07DQogIHZhciBMID0gJ2VuJzsNCg0KICBmdW5jdGlvbiBwYXJzZUxvY2FsZShwcmVzZXQsIG9iamVjdCwgaXNMb2NhbCkgew0KICAgIHZhciBsOw0KICAgIGlmICghcHJlc2V0KSB7IHJldHVybiBudWxsOyB9DQogICAgaWYgKGlzU3RyaW5nKHByZXNldCkpIHsNCiAgICAgIGlmIChMc1twcmVzZXRdKSB7DQogICAgICAgIGwgPSBwcmVzZXQ7DQogICAgICB9DQogICAgICBpZiAob2JqZWN0KSB7DQogICAgICAgIExzW3ByZXNldF0gPSBvYmplY3Q7DQogICAgICAgIGwgPSBwcmVzZXQ7DQogICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgIHZhciBuYW1lID0gcHJlc2V0Lm5hbWU7DQogICAgICBMc1tuYW1lXSA9IHByZXNldDsNCiAgICAgIGwgPSBuYW1lOw0KICAgIH0NCiAgICBpZiAoIWlzTG9jYWwpIHsgTCA9IGw7IH0NCiAgICByZXR1cm4gbDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzRGF5anMoZGF0ZSkgew0KICAgIHJldHVybiBkYXRlIGluc3RhbmNlb2YgRGF5anM7DQogIH0NCg0KICBmdW5jdGlvbiBkYXlqcyhkYXRlLCBjZmcpIHsNCiAgICBpZiAoaXNEYXlqcyhkYXRlKSkgeyByZXR1cm4gZGF0ZS5jbG9uZSgpOyB9DQogICAgdmFyIF9jZmcgPSB7IGRhdGU6IGRhdGUgfTsNCiAgICBpZiAoaXNTdHJpbmcoY2ZnKSkgew0KICAgICAgX2NmZy5mb3JtYXQgPSBjZmc7DQogICAgfSBlbHNlIGlmIChpc09iamVjdExpa2UoY2ZnKSkgew0KICAgICAgZXh0ZW5kKF9jZmcsIGNmZyk7DQogICAgfQ0KICAgIHJldHVybiBuZXcgRGF5anMoX2NmZyk7DQogIH0NCg0KICBmdW5jdGlvbiBEYXlqcyhjZmcpIHsNCiAgICB0aGlzLiRMID0gcGFyc2VMb2NhbGUoY2ZnLmxvY2FsZSwgbnVsbCwgdHJ1ZSkgfHwgTDsNCiAgICB0aGlzLnBhcnNlKGNmZyk7DQogIH0NCg0KICB2YXIgX3Byb3RvID0gRGF5anMucHJvdG90eXBlOw0KDQogIF9wcm90by5wYXJzZSA9IGZ1bmN0aW9uKGNmZykgew0KICAgIHRoaXMuJGQgPSBwYXJzZURhdGUoY2ZnKTsNCiAgICB0aGlzLmluaXQoKTsNCiAgfTsNCg0KICBmdW5jdGlvbiBwYXJzZURhdGUoY2ZnKSB7DQogICAgdmFyIGRhdGUgPSBjZmcuZGF0ZSwNCiAgICAgIHV0YyA9IGNmZy51dGM7DQogICAgaWYgKGRhdGUgPT0gbnVsbCkgeyByZXR1cm4gbmV3IERhdGUoKTsgfQ0KICAgIGlmIChpc0RhdGUoZGF0ZSkpIHsgcmV0dXJuIG5ldyBEYXRlKGRhdGUpOyB9DQogICAgaWYgKGlzU3RyaW5nKGRhdGUpICYmICEvWiQvaS50ZXN0KGRhdGUpKSB7DQogICAgICB2YXIgbSA9IGRhdGUubWF0Y2goUkVHRVhfUEFSU0UpOw0KICAgICAgaWYgKG0pIHsNCiAgICAgICAgaWYgKHV0Yykgew0KICAgICAgICAgIHJldHVybiBuZXcgRGF0ZSgNCiAgICAgICAgICAgIERhdGUuVVRDKA0KICAgICAgICAgICAgICBtWzFdLA0KICAgICAgICAgICAgICBtWzJdIC0gMSwNCiAgICAgICAgICAgICAgbVszXSwNCiAgICAgICAgICAgICAgbVs0XSB8fCAwLA0KICAgICAgICAgICAgICBtWzVdIHx8IDAsDQogICAgICAgICAgICAgIG1bNl0gfHwgMCwNCiAgICAgICAgICAgICAgbVs3XSB8fCAwDQogICAgICAgICAgICApDQogICAgICAgICAgKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbmV3IERhdGUoDQogICAgICAgICAgbVsxXSwNCiAgICAgICAgICBtWzJdIC0gMSwNCiAgICAgICAgICBtWzNdLA0KICAgICAgICAgIG1bNF0gfHwgMCwNCiAgICAgICAgICBtWzVdIHx8IDAsDQogICAgICAgICAgbVs2XSB8fCAwLA0KICAgICAgICAgIG1bN10gfHwgMA0KICAgICAgICApOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gbmV3IERhdGUoZGF0ZSk7DQogIH0NCg0KICBfcHJvdG8uaW5pdCA9IGZ1bmN0aW9uKCkgew0KICAgIHZhciAkZCA9IHRoaXMuJGQ7DQogICAgZXh0ZW5kKHRoaXMsIHsNCiAgICAgICR5OiAkZC5nZXRGdWxsWWVhcigpLA0KICAgICAgJE06ICRkLmdldE1vbnRoKCksDQogICAgICAkRDogJGQuZ2V0RGF0ZSgpLA0KICAgICAgJFc6ICRkLmdldERheSgpLA0KICAgICAgJEg6ICRkLmdldEhvdXJzKCksDQogICAgICAkbTogJGQuZ2V0TWludXRlcygpLA0KICAgICAgJHM6ICRkLmdldFNlY29uZHMoKSwNCiAgICAgICRtczogJGQuZ2V0TWlsbGlzZWNvbmRzKCkNCiAgICB9KTsNCiAgfTsNCg0KICBfcHJvdG8uaXNWYWxpZCA9IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiB0aGlzLiRkLnRvU3RyaW5nKCkgIT09IElOVkFMSURfREFURV9TVFJJTkc7DQogIH07DQoNCiAgX3Byb3RvLmlzU2FtZSA9IGZ1bmN0aW9uKHRoYXQsIHVuaXRzKSB7DQogICAgdmFyIG90aGVyID0gZGF5anModGhhdCk7DQogICAgcmV0dXJuIHRoaXMuc3RhcnRPZih1bml0cykgPD0gb3RoZXIgJiYgb3RoZXIgPD0gdGhpcy5lbmRPZih1bml0cyk7DQogIH07DQoNCiAgX3Byb3RvLmlzQWZ0ZXIgPSBmdW5jdGlvbih0aGF0LCB1bml0cykgew0KICAgIHJldHVybiBkYXlqcyh0aGF0KSA8IHRoaXMuc3RhcnRPZih1bml0cyk7DQogIH07DQoNCiAgX3Byb3RvLmlzQmVmb3JlID0gZnVuY3Rpb24odGhhdCwgdW5pdHMpIHsNCiAgICByZXR1cm4gdGhpcy5lbmRPZih1bml0cykgPCBkYXlqcyh0aGF0KTsNCiAgfTsNCg0KICBlYWNoKA0KICAgIHsNCiAgICAgICR5OiBZLA0KICAgICAgJE06IE0sDQogICAgICAkVzogRCwNCiAgICAgICREOiBEQVRFLA0KICAgICAgJEg6IEgsDQogICAgICAkbTogTUlOLA0KICAgICAgJHM6IFMsDQogICAgICAkbXM6IE1TDQogICAgfSwNCiAgICBmdW5jdGlvbiAodW5pdCwgcHJvcCkgew0KICAgICAgX3Byb3RvW3VuaXRdID0gZnVuY3Rpb24oaW5wdXQpIHsNCiAgICAgICAgcmV0dXJuIGlucHV0ID09IG51bGwgPyB0aGlzW3Byb3BdIDogdGhpcy5jbG9uZSgpLiRzZXQodW5pdCwgaW5wdXQpOw0KICAgICAgfTsNCiAgICB9DQogICk7DQoNCiAgX3Byb3RvLnZhbHVlT2YgPSBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gdGhpcy4kZC5nZXRUaW1lKCk7DQogIH07DQoNCiAgZnVuY3Rpb24gcHJldHR5VW5pdCh1KSB7DQogICAgdmFyIHNwZWNpYWwgPSB7DQogICAgICBNOiBNLA0KICAgICAgeTogWSwNCiAgICAgIHc6IFcsDQogICAgICBkOiBELA0KICAgICAgaDogSCwNCiAgICAgIG06IE1JTiwNCiAgICAgIHM6IFMsDQogICAgICBtczogTVMsDQogICAgICBROiBRDQogICAgfTsNCiAgICByZXR1cm4gKA0KICAgICAgc3BlY2lhbFt1XSB8fA0KICAgICAgU3RyaW5nKHUgfHwgJycpDQogICAgICAgIC50b0xvd2VyQ2FzZSgpDQogICAgICAgIC5yZXBsYWNlKC9zJC8sICcnKQ0KICAgICk7DQogIH0NCg0KICBfcHJvdG8uc3RhcnRPZiA9IGZ1bmN0aW9uKHVuaXRzLCBfc3RhcnRPZikgew0KICAgIC8vIHN0YXJ0T2YgLT4gZW5kT2YNCiAgICB2YXIgaXNTdGFydE9mID0gX3N0YXJ0T2YgPT0gbnVsbCA/IHRydWUgOiBfc3RhcnRPZjsNCiAgICB2YXIgdW5pdCA9IHByZXR0eVVuaXQodW5pdHMpOw0KICAgIHZhciAkTSA9IHRoaXMuJE0sDQogICAgICAkVyA9IHRoaXMuJFcsDQogICAgICAkRCA9IHRoaXMuJEQ7DQogICAgdmFyIGNsb25lID0gdGhpcy5jbG9uZSgpOw0KDQogICAgc3dpdGNoICh1bml0KSB7DQogICAgICBjYXNlIFk6DQogICAgICAgIHJldHVybiBjbG9uZS4kJHNldChpc1N0YXJ0T2YgPyB7IE06IDAsIGRhdGU6IDEgfSA6IHsgTTogMTEsIGRhdGU6IDMxIH0pOw0KICAgICAgY2FzZSBNOg0KICAgICAgICByZXR1cm4gY2xvbmUuJCRzZXQoDQogICAgICAgICAgaXNTdGFydE9mID8geyBNOiAkTSwgZGF0ZTogMSB9IDogeyBNOiAkTSArIDEsIGRhdGU6IDAgfQ0KICAgICAgICApOw0KICAgICAgY2FzZSBEOg0KICAgICAgY2FzZSBEQVRFOg0KICAgICAgICByZXR1cm4gY2xvbmUuJHNldChILCBpc1N0YXJ0T2YgPyAwIDogMjMpOw0KICAgICAgY2FzZSBIOg0KICAgICAgICByZXR1cm4gY2xvbmUuJHNldChNSU4sIGlzU3RhcnRPZiA/IDAgOiA1OSk7DQogICAgICBjYXNlIE1JTjoNCiAgICAgICAgcmV0dXJuIGNsb25lLiRzZXQoUywgaXNTdGFydE9mID8gMCA6IDU5KTsNCiAgICAgIGNhc2UgUzoNCiAgICAgICAgcmV0dXJuIGNsb25lLiRzZXQoTVMsIGlzU3RhcnRPZiA/IDAgOiA5OTkpOw0KICAgICAgY2FzZSBXOiB7DQogICAgICAgIHZhciB3ZWVrU3RhcnQgPSB0aGlzLiRsb2NhbGUoKS53ZWVrU3RhcnQgfHwgMDsNCiAgICAgICAgdmFyIGdhcCA9ICgkVyA8IHdlZWtTdGFydCA/ICRXICsgNyA6ICRXKSAtIHdlZWtTdGFydDsNCiAgICAgICAgcmV0dXJuIGNsb25lLiRzZXQoREFURSwgaXNTdGFydE9mID8gJEQgLSBnYXAgOiAkRCArICg2IC0gZ2FwKSk7DQogICAgICB9DQogICAgICBkZWZhdWx0Og0KICAgICAgICByZXR1cm4gY2xvbmU7DQogICAgfQ0KICB9Ow0KDQogIF9wcm90by5lbmRPZiA9IGZ1bmN0aW9uKHVuaXRzKSB7DQogICAgcmV0dXJuIHRoaXMuc3RhcnRPZih1bml0cywgZmFsc2UpOw0KICB9Ow0KDQogIHZhciBVTklUX01FVEhPRCA9IGZyb21QYWlycyhbDQogICAgW0QsICdEYXRlJ10sDQogICAgW0RBVEUsICdEYXRlJ10sDQogICAgW00sICdNb250aCddLA0KICAgIFtZLCAnRnVsbFllYXInXSwNCiAgICBbSCwgJ0hvdXJzJ10sDQogICAgW01JTiwgJ01pbnV0ZXMnXSwNCiAgICBbUywgJ1NlY29uZHMnXSwNCiAgICBbTVMsICdNaWxsaXNlY29uZHMnXQ0KICBdKTsNCg0KICBmdW5jdGlvbiBfc2V0KHNlbGYsIHVuaXRzLCBfaW50KSB7DQogICAgdmFyIHVuaXQgPSBwcmV0dHlVbml0KHVuaXRzKTsNCiAgICB2YXIgdXRjUGFkID0gJ3NldCcgKyAoc2VsZi4kdSA/ICdVVEMnIDogJycpOw0KICAgIHZhciBuYW1lID0gVU5JVF9NRVRIT0RbdW5pdF07DQogICAgdmFyIGFyZyA9IHVuaXQgPT0gRCA/IHNlbGYuJEQgKyAoX2ludCAtIHNlbGYuJFcpIDogX2ludDsNCg0KICAgIGlmIChuYW1lKSB7DQogICAgICBpZiAodW5pdCA9PSBNIHx8IHVuaXQgPT0gWSkgew0KICAgICAgICB2YXIgX2QgPSBzZWxmLnRvRGF0ZSgpOw0KICAgICAgICBfZC5zZXREYXRlKDEpOw0KICAgICAgICBfZFt1dGNQYWQgKyBuYW1lXShhcmcpOw0KICAgICAgICBfZC5zZXRNb250aChfZC5nZXRNb250aCgpICsgMSk7DQogICAgICAgIF9kLnNldERhdGUoMCk7DQogICAgICAgIHZhciBfbGFzdERhdGUgPSBfZC5nZXREYXRlKCk7DQogICAgICAgIGlmIChzZWxmLiREIDwgX2xhc3REYXRlKSB7DQogICAgICAgICAgX2Quc2V0RGF0ZShzZWxmLiREKTsNCiAgICAgICAgfQ0KICAgICAgICBzZWxmLiRkID0gX2Q7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBzZWxmLiRkW3V0Y1BhZCArIG5hbWVdKGFyZyk7DQogICAgICB9DQogICAgfQ0KICB9DQoNCiAgX3Byb3RvLiRzZXQgPSBmdW5jdGlvbih1bml0cywgX2ludCkgew0KICAgIF9zZXQodGhpcywgdW5pdHMsIF9pbnQpOw0KICAgIHRoaXMuaW5pdCgpOw0KICAgIHJldHVybiB0aGlzOw0KICB9Ow0KDQogIF9wcm90by4kJHNldCA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsNCiAgICB2YXIgc2VsZiA9IHRoaXM7DQogICAgZWFjaChvcHRpb25zLCBmdW5jdGlvbiAoX2ludCwgdW5pdHMpIHsNCiAgICAgIF9zZXQoc2VsZiwgdW5pdHMsIF9pbnQpOw0KICAgIH0pOw0KICAgIHRoaXMuaW5pdCgpOw0KICAgIHJldHVybiB0aGlzOw0KICB9Ow0KDQogIF9wcm90by5zZXQgPSBmdW5jdGlvbih1bml0LCBfaW50KSB7DQogICAgdmFyIGNsb25lID0gdGhpcy5jbG9uZSgpOw0KICAgIGlmIChpc1N0cmluZyh1bml0KSkgew0KICAgICAgcmV0dXJuIGNsb25lLiRzZXQodW5pdCwgX2ludCk7DQogICAgfSBlbHNlIGlmIChpc09iamVjdExpa2UodW5pdCkpIHsNCiAgICAgIHJldHVybiBjbG9uZS4kJHNldCh1bml0KTsNCiAgICB9DQogICAgcmV0dXJuIGNsb25lOw0KICB9Ow0KDQogIF9wcm90by5nZXQgPSBmdW5jdGlvbih1bml0KSB7DQogICAgcmV0dXJuIHRoaXNbcHJldHR5VW5pdCh1bml0KV0oKTsNCiAgfTsNCg0KICBfcHJvdG8uYWRkID0gZnVuY3Rpb24obiwgdW5pdHMpIHsNCiAgICB2YXIgbmFtZSA9IHByZXR0eVVuaXQodW5pdHMpOw0KICAgIHZhciBjbG9uZSA9IHRoaXMuY2xvbmUoKTsNCiAgICBuID0gTnVtYmVyKG4pOw0KICAgIGlmIChuYW1lID09IFcpIHsgcmV0dXJuIGNsb25lLiRzZXQoREFURSwgdGhpcy4kRCArIE1hdGgucm91bmQobiAqIDcpKTsgfQ0KICAgIGVsc2UgeyByZXR1cm4gY2xvbmUuJHNldChuYW1lLCB0aGlzW25hbWVdKCkgKyBuKTsgfQ0KICB9Ow0KDQogIF9wcm90by5zdWJ0cmFjdCA9IGZ1bmN0aW9uKG4sIHVuaXQpIHsNCiAgICByZXR1cm4gdGhpcy5hZGQobiAqIC0xLCB1bml0KTsNCiAgfTsNCg0KICBfcHJvdG8uZm9ybWF0ID0gZnVuY3Rpb24oZm10KSB7DQogICAgaWYgKCF0aGlzLmlzVmFsaWQoKSkgeyByZXR1cm4gSU5WQUxJRF9EQVRFX1NUUklORzsgfQ0KICAgIGZtdCB8fCAoZm10ID0gRk9STUFUX0RFRkFVTFQpOw0KICAgIHZhciAkeSA9IHRoaXMuJHksDQogICAgICAkTSA9IHRoaXMuJE0sDQogICAgICAkRCA9IHRoaXMuJEQsDQogICAgICAkVyA9IHRoaXMuJFcsDQogICAgICAkSCA9IHRoaXMuJEgsDQogICAgICAkbSA9IHRoaXMuJG0sDQogICAgICAkcyA9IHRoaXMuJHMsDQogICAgICAkTVMgPSB0aGlzLiRNUzsNCiAgICB2YXIgbG9jYWxlID0gdGhpcy4kbG9jYWxlKCk7DQogICAgdmFyIHdlZWtkYXlzID0gbG9jYWxlLndlZWtkYXlzLA0KICAgICAgbW9udGhzID0gbG9jYWxlLm1vbnRoczsNCiAgICB2YXIgdHpPZmZzZXQgPSB0aGlzLiRkLmdldFRpbWV6b25lT2Zmc2V0KCk7DQogICAgdmFyIHR6TWludXRlcyA9IE1hdGguYWJzKHR6T2Zmc2V0KTsNCiAgICB2YXIgaG91ck9mZnNldCA9IE1hdGguZmxvb3IodHpNaW51dGVzIC8gNjApOw0KICAgIHZhciBtaW5PZmZzZXQgPSB0ek1pbnV0ZXMgJSA2MDsNCiAgICB2YXIgem9uZVN0ciA9DQogICAgICAodHpPZmZzZXQgPCAwID8gJy0nIDogJysnKSArDQogICAgICBwYWRTdGFydChob3VyT2Zmc2V0LCAyLCAnMCcpICsNCiAgICAgICc6JyArDQogICAgICBwYWRTdGFydChtaW5PZmZzZXQsIDIsICcwJyk7DQogICAgdmFyIHNlbGYgPSB0aGlzOw0KICAgIHZhciBnZXRTaG9ydCA9IGZ1bmN0aW9uKGFyciwgaW5kZXgsIGZ1bGwsIGxlbmd0aCkgew0KICAgICAgcmV0dXJuICgNCiAgICAgICAgKGFyciAmJiAoYXJyW2luZGV4XSB8fCBhcnIoc2VsZiwgZm10KSkpIHx8IGZ1bGxbaW5kZXhdLnN1YnN0cigwLCBsZW5ndGgpDQogICAgICApOw0KICAgIH07DQoNCiAgICB2YXIgbWF0Y2hlcyA9IHsNCiAgICAgIFlZOiBTdHJpbmcoJHkpLnNsaWNlKC0yKSwNCiAgICAgIFlZWVk6ICR5LA0KICAgICAgTTogJE0gKyAxLA0KICAgICAgTU06IHBhZFN0YXJ0KCRNICsgMSwgMiwgJzAnKSwNCiAgICAgIE1NTTogZ2V0U2hvcnQobG9jYWxlLm1vbnRoc1Nob3J0LCAkTSwgbW9udGhzLCAzKSwNCiAgICAgIE1NTU06IG1vbnRoc1skTV0gfHwgKGlzRnVuY3Rpb24obW9udGhzKSAmJiBtb250aHModGhpcywgZm10KSksDQogICAgICBEOiAkRCwNCiAgICAgIEREOiBwYWRTdGFydCgkRCwgMiwgJzAnKSwNCiAgICAgIGQ6ICRXLA0KICAgICAgZGQ6IGdldFNob3J0KGxvY2FsZS53ZWVrZGF5c01pbiwgJFcsIHdlZWtkYXlzLCAyKSwNCiAgICAgIGRkZDogZ2V0U2hvcnQobG9jYWxlLndlZWtkYXlzU2hvcnQsICRXLCB3ZWVrZGF5cywgMyksDQogICAgICBkZGRkOiB3ZWVrZGF5c1skV10sDQogICAgICBIOiAkSCwNCiAgICAgIEhIOiBwYWRTdGFydCgkSCwgMiwgJzAnKSwNCiAgICAgIGg6ICRIICUgMTIgfHwgMTIsDQogICAgICBoaDogcGFkU3RhcnQoJEggJSAxMiB8fCAxMiwgMiwgJzAnKSwNCiAgICAgIGE6ICRIIDwgMTIgPyAnYW0nIDogJ3BtJywNCiAgICAgIEE6ICRIIDwgMTIgPyAnQU0nIDogJ1BNJywNCiAgICAgIG06ICRtLA0KICAgICAgbW06IHBhZFN0YXJ0KCRtLCAyLCAnMCcpLA0KICAgICAgczogJHMsDQogICAgICBzczogcGFkU3RhcnQoJHMsIDIsICcwJyksDQogICAgICBTU1M6IHBhZFN0YXJ0KCRNUywgMywgJzAnKSwNCiAgICAgIFo6IHpvbmVTdHINCiAgICB9Ow0KICAgIHJldHVybiBmbXQucmVwbGFjZShSRUdFWF9GT1JNQVQsIGZ1bmN0aW9uKG0wLCBtMSkgew0KICAgICAgcmV0dXJuIG0xIHx8IG1hdGNoZXNbbTBdIHx8IHpvbmVTdHIucmVwbGFjZSgnOicsICcnKTsNCiAgICB9KTsNCiAgfTsNCg0KICBfcHJvdG8udXRjT2Zmc2V0ID0gZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuIC10aGlzLiRkLmdldFRpbWV6b25lT2Zmc2V0KCk7DQogIH07DQoNCiAgZnVuY3Rpb24gbW9udGhEaWZmKGEsIGIpIHsNCiAgICB2YXIgZGlmZiA9IChhLnllYXIoKSAtIGIueWVhcigpKSAqIDEyICsgYS5tb250aCgpIC0gYi5tb250aCgpOw0KICAgIHZhciBhbmNob3IgPSBiLmNsb25lKCkuYWRkKGRpZmYsIE0pOw0KICAgIHZhciBjID0gYSAtIGFuY2hvciA+IDA7DQogICAgdmFyIGFuY2hvcjIgPSBiLmNsb25lKCkuYWRkKGRpZmYgKyAoYyA/IDEgOiAtMSksIE0pOw0KICAgIHJldHVybiBkaWZmICsgKGEgLSBhbmNob3IpIC8gKGMgPyBhbmNob3IyIC0gYW5jaG9yIDogYW5jaG9yIC0gYW5jaG9yMik7DQogIH0NCg0KICBmdW5jdGlvbiBtaWxsaVNlY29uZERpZmYoYSwgYikgew0KICAgIHJldHVybiBhIC0gYiArIChhLnV0Y09mZnNldCgpIC0gYi51dGNPZmZzZXQoKSkgKiA2MDAwMDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGFic0Zsb29yKG4pIHsNCiAgICByZXR1cm4gbiA8IDAgPyBNYXRoLmNlaWwobikgOiBNYXRoLmZsb29yKG4pOw0KICB9DQoNCiAgX3Byb3RvLmRpZmYgPSBmdW5jdGlvbihpbnB1dCwgdW5pdHMsIF9mbG9hdCkgew0KICAgIHZhciB1bml0ID0gcHJldHR5VW5pdCh1bml0cyk7DQogICAgdmFyIHRoYXQgPSBkYXlqcyhpbnB1dCk7DQogICAgdmFyIHJlc3VsdDsNCg0KICAgIHN3aXRjaCAodW5pdCkgew0KICAgICAgY2FzZSBZOg0KICAgICAgICByZXN1bHQgPSBtb250aERpZmYodGhpcywgdGhhdCkgLyAxMjsNCiAgICAgICAgYnJlYWs7DQogICAgICBjYXNlIE06DQogICAgICAgIHJlc3VsdCA9IG1vbnRoRGlmZih0aGlzLCB0aGF0KTsNCiAgICAgICAgYnJlYWs7DQogICAgICBjYXNlIFE6DQogICAgICAgIHJlc3VsdCA9IG1vbnRoRGlmZih0aGlzLCB0aGF0KSAvIDM7DQogICAgICAgIGJyZWFrOw0KICAgICAgY2FzZSBXOg0KICAgICAgICByZXN1bHQgPSBtaWxsaVNlY29uZERpZmYodGhpcywgdGhhdCkgLyA2MDQ4MDAwMDA7DQogICAgICAgIGJyZWFrOw0KICAgICAgY2FzZSBEOg0KICAgICAgICByZXN1bHQgPSBtaWxsaVNlY29uZERpZmYodGhpcywgdGhhdCkgLyA4NjQwMDAwMDsNCiAgICAgICAgYnJlYWs7DQogICAgICBjYXNlIEg6DQogICAgICAgIHJlc3VsdCA9IG1pbGxpU2Vjb25kRGlmZih0aGlzLCB0aGF0KSAvIDM2MDAwMDA7DQogICAgICAgIGJyZWFrOw0KICAgICAgY2FzZSBNSU46DQogICAgICAgIHJlc3VsdCA9IG1pbGxpU2Vjb25kRGlmZih0aGlzLCB0aGF0KSAvIDYwMDAwOw0KICAgICAgICBicmVhazsNCiAgICAgIGNhc2UgUzoNCiAgICAgICAgcmVzdWx0ID0gbWlsbGlTZWNvbmREaWZmKHRoaXMsIHRoYXQpIC8gMTAwMDsNCiAgICAgICAgYnJlYWs7DQogICAgICBkZWZhdWx0Og0KICAgICAgICByZXN1bHQgPSBtaWxsaVNlY29uZERpZmYodGhpcywgdGhhdCk7DQogICAgICAgIGJyZWFrOw0KICAgIH0NCiAgICByZXR1cm4gX2Zsb2F0ID8gcmVzdWx0IDogYWJzRmxvb3IocmVzdWx0KTsNCiAgfTsNCg0KICBfcHJvdG8uZGF5c0luTW9udGggPSBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gdGhpcy5lbmRPZihNKS4kRDsNCiAgfTsNCg0KICBfcHJvdG8uJGxvY2FsZSA9IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiBMc1t0aGlzLiRMXTsNCiAgfTsNCg0KICBfcHJvdG8ubG9jYWxlID0gZnVuY3Rpb24ocHJlc2V0LCBvYmplY3QpIHsNCiAgICBpZiAoIXByZXNldCkgeyByZXR1cm4gdGhpcy4kTDsgfQ0KICAgIHZhciB0aGF0ID0gdGhpcy5jbG9uZSgpOw0KICAgIHRoYXQuJEwgPSBwYXJzZUxvY2FsZShwcmVzZXQsIG9iamVjdCwgdHJ1ZSk7DQogICAgcmV0dXJuIHRoYXQ7DQogIH07DQoNCiAgX3Byb3RvLmNsb25lID0gZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuIGRheWpzKHRoaXMudG9EYXRlKCksIHsNCiAgICAgIGxvY2FsZTogdGhpcy4kTCwNCiAgICAgIHV0YzogdGhpcy4kdQ0KICAgIH0pOw0KICB9Ow0KDQogIF9wcm90by50b0RhdGUgPSBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gbmV3IERhdGUodGhpcy4kZCk7DQogIH07DQoNCiAgX3Byb3RvLnRvSlNPTiA9IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiB0aGlzLnRvSVNPU3RyaW5nKCk7DQogIH07DQoNCiAgX3Byb3RvLnRvSVNPU3RyaW5nID0gZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuIHRoaXMuJGQudG9JU09TdHJpbmcoKTsNCiAgfTsNCg0KICBfcHJvdG8udG9TdHJpbmcgPSBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gdGhpcy4kZC50b1VUQ1N0cmluZygpOw0KICB9Ow0KDQogIGRheWpzLnByb3RvdHlwZSA9IERheWpzLnByb3RvdHlwZTsNCiAgZGF5anMuaXNEYXlqcyA9IGlzRGF5anM7DQogIGRheWpzLmxvY2FsZSA9IHBhcnNlTG9jYWxlOw0KICBkYXlqcy5McyA9IExzOw0KDQogIGRheWpzLmV4dGVuZCA9IGZ1bmN0aW9uKHBsdWdpbiwgb3B0aW9uKSB7DQogICAgcGx1Z2luKG9wdGlvbiwgRGF5anMsIGRheWpzKTsNCiAgICByZXR1cm4gZGF5anM7DQogIH07CgogIHZhciBkYXlqcyQxID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgJ2RlZmF1bHQnOiBkYXlqcwogIH0pOwoKICB2YXIgSlNfVE9LRU5TID0gLygoWyciXSkoPzooPyFcMnxcXCkufFxcKD86XHJcbnxbXHNcU10pKSooXDIpP3xgKD86W15gXFwkXXxcXFtcc1xTXXxcJCg/IVx7KXxcJFx7KD86W157fV18XHtbXn1dKlx9PykqXH0/KSooYCk/KXwoXC9cLy4qKXwoXC9cKig/OlteKl18XCooPyFcLykpKihcKlwvKT8pfChcLyg/IVwqKSg/OlxbKD86KD8hW1xdXFxdKS58XFwuKSpcXXwoPyFbL1xdXFxdKS58XFwuKStcLyg/Oig/IVxzKig/OlxifFtcdTAwODAtXHVGRkZGJFxcJyJ+KHtdfFsrXC0hXSg/IT0pfFwuP1xkKSl8W2dtaXl1c117MSw2fVxiKD8hW1x1MDA4MC1cdUZGRkYkXFxdfFxzKig/OlsrXC0qJSZ8Xjw+IT0/KHtdfFwvKD8hWy8qXSkpKSkpfCgwW3hYXVtcZGEtZkEtRl0rfDBbb09dWzAtN10rfDBbYkJdWzAxXSt8KD86XGQqXC5cZCt8XGQrXC4/KSg/OltlRV1bKy1dP1xkKyk/KXwoKD8hXGQpKD86KD8hXHMpWyRcd1x1MDA4MC1cdUZGRkZdfFxcdVtcZGEtZkEtRl17NH18XFx1XHtbXGRhLWZBLUZdK1x9KSspfCgtLXxcK1wrfCYmfFx8XHx8PT58XC57M318KD86WytcLS8lJnxeXXxcKnsxLDJ9fDx7MSwyfXw+ezEsM318IT0/fD17MSwyfSk9P3xbP34uLDo7W1xdKCl7fV0pfChccyspfCheJHxbXHNcU10pL2c7DQoNCiAgZnVuY3Rpb24gbWF0Y2hUb1Rva2VuKG1hdGNoKSB7DQogICAgdmFyIHRva2VuID0geyB0eXBlOiAnaW52YWxpZCcsIHZhbHVlOiBtYXRjaFswXSwgY2xvc2VkOiB1bmRlZmluZWQgfTsNCiAgICBpZiAobWF0Y2hbMV0pDQogICAgICB7ICh0b2tlbi50eXBlID0gJ3N0cmluZycpLCAodG9rZW4uY2xvc2VkID0gISEobWF0Y2hbM10gfHwgbWF0Y2hbNF0pKTsgfQ0KICAgIGVsc2UgaWYgKG1hdGNoWzVdKSB7IHRva2VuLnR5cGUgPSAnY29tbWVudCc7IH0NCiAgICBlbHNlIGlmIChtYXRjaFs2XSkgeyAodG9rZW4udHlwZSA9ICdjb21tZW50JyksICh0b2tlbi5jbG9zZWQgPSAhIW1hdGNoWzddKTsgfQ0KICAgIGVsc2UgaWYgKG1hdGNoWzhdKSB7IHRva2VuLnR5cGUgPSAncmVnZXgnOyB9DQogICAgZWxzZSBpZiAobWF0Y2hbOV0pIHsgdG9rZW4udHlwZSA9ICdudW1iZXInOyB9DQogICAgZWxzZSBpZiAobWF0Y2hbMTBdKSB7IHRva2VuLnR5cGUgPSAnbmFtZSc7IH0NCiAgICBlbHNlIGlmIChtYXRjaFsxMV0pIHsgdG9rZW4udHlwZSA9ICdwdW5jdHVhdG9yJzsgfQ0KICAgIGVsc2UgaWYgKG1hdGNoWzEyXSkgeyB0b2tlbi50eXBlID0gJ3doaXRlc3BhY2UnOyB9DQogICAgcmV0dXJuIHRva2VuOw0KICB9DQoNCiAgZnVuY3Rpb24gZ2V0VG9rZW5zKHNyYykgew0KICAgIHZhciB0b2tlbnMgPSBbXSwNCiAgICAgIG1hdGNoLA0KICAgICAgdG9rZW47DQogICAgZm9yICg7Oykgew0KICAgICAgbWF0Y2ggPSBKU19UT0tFTlMuZXhlYyhzcmMpOw0KICAgICAgaWYgKCFtYXRjaCkgeyBicmVhazsgfQ0KICAgICAgdG9rZW4gPSBtYXRjaFRvVG9rZW4obWF0Y2gpOw0KICAgICAgdG9rZW5zLnB1c2godG9rZW4pOw0KICAgIH0NCiAgICByZXR1cm4gdG9rZW5zOw0KICB9DQoNCiAgdmFyIEVTQ0FQU0VfTUFQJDEgPSB7DQogICAgIiciOiAiJyIsDQogICAgJyInOiAnIicsDQogICAgJ1xyJzogJ3InLA0KICAgICdcbic6ICduJywNCiAgICAnXHQnOiAndCcsDQogICAgJ1x1MjAyOCc6ICd1MjAyOCcsDQogICAgJ1x1MjAyOSc6ICd1MjAyOScNCiAgfTsNCg0KICB2YXIgRVNDQVBTRV9SRUckMSA9IC8nfCJ8XHJ8XG58XHR8XHUyMDI4fFx1MjAyOV0vZzsNCg0KICBmdW5jdGlvbiBlc2NhcGVDaGFyJDEoYykgew0KICAgIHJldHVybiAnXFwnICsgRVNDQVBTRV9NQVAkMVtjXTsNCiAgfQ0KDQogIHZhciBTVUJfUkVHID0gL1wkXHsoKD86W157fV18XHtbXn1dKlx9PykqKVx9Py9nOw0KICB2YXIgU1VCX1NFUCA9ICckVE1QJCc7DQogIHZhciBTVUJfU0VQX1JFRyA9IC9cJFRNUFwkL2c7DQoNCiAgZnVuY3Rpb24gcmVwbFRtcFN0cih0b2tlbiwgdG9rZW5zLCBpbmRleCkgew0KICAgIHZhciBzdHIgPSB0b2tlbi52YWx1ZTsNCiAgICBpZiAodG9rZW4udHlwZSAhPSAnc3RyaW5nJyB8fCBzdHJbMF0gIT0gJ2AnKSB7IHJldHVybiBmYWxzZTsgfQ0KICAgIHZhciByYXdfYXJncyA9IFtudWxsXTsNCiAgICBzdHIgPSBzdHIuc2xpY2UoMSwgc3RyLmxlbmd0aCAtIDEpOw0KICAgIHN0ciA9IHN0ci5yZXBsYWNlKFNVQl9SRUcsIGZ1bmN0aW9uKGcwLCBnMSkgew0KICAgICAgcmF3X2FyZ3MucHVzaChnMSk7DQogICAgICByZXR1cm4gU1VCX1NFUDsNCiAgICB9KTsNCiAgICB2YXIgc3RyUmF3ID0gaW5kZXggPiAyICYmIHRva2Vuc1tpbmRleCAtIDFdLnZhbHVlOw0KICAgIGlmIChzdHJSYXcgPT0gJ3JhdycpIHsNCiAgICAgIHJhd19hcmdzWzBdID0gSlNPTi5zdHJpbmdpZnkoeyByYXc6IHN0ci5zcGxpdChTVUJfU0VQKSB9KTsNCiAgICAgIHRva2VuLnZhbHVlID0gJygnICsgcmF3X2FyZ3Muam9pbigpICsgJyknOw0KICAgIH0gZWxzZSB7DQogICAgICBzdHIgPSBzdHIucmVwbGFjZShFU0NBUFNFX1JFRyQxLCBlc2NhcGVDaGFyJDEpOw0KICAgICAgcmF3X2FyZ3NbMF0gPSAie3JhdzogWyciICsgc3RyLnJlcGxhY2UoU1VCX1NFUF9SRUcsICInLCciKSArICInXX0iOw0KICAgICAgdG9rZW4udmFsdWUgPSAnU3RyaW5nLnJhdygnICsgcmF3X2FyZ3Muam9pbigpICsgJyknOw0KICAgIH0NCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlcGxBcnJvdyh0b2tlbiwgdG9rZW5zLCBpbmRleCkgew0KICAgIGlmICh0b2tlbi50eXBlICE9ICdwdW5jdHVhdG9yJyB8fCB0b2tlbi52YWx1ZSAhPSAnPT4nKSB7IHJldHVybiBmYWxzZTsgfQ0KICAgIHZhciBpID0gaW5kZXgsDQogICAgICBsZW4gPSB0b2tlbnMubGVuZ3RoLA0KICAgICAgZGVwdGggPSAwLA0KICAgICAgaGFzQnJhY2tldCA9IGZhbHNlLA0KICAgICAgaGFzVGhpcyA9IGZhbHNlLA0KICAgICAgdG9rZW5JdDsNCiAgICB3aGlsZSAoLS1pKSB7DQogICAgICB0b2tlbkl0ID0gdG9rZW5zW2ldOw0KICAgICAgaWYgKHRva2VuSXQudHlwZSA9PSAncHVuY3R1YXRvcicpIHsNCiAgICAgICAgc3dpdGNoICh0b2tlbkl0LnZhbHVlKSB7DQogICAgICAgICAgY2FzZSAnKSc6DQogICAgICAgICAgICBoYXNCcmFja2V0ID0gdHJ1ZTsNCiAgICAgICAgICAgIGRlcHRoKys7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgICBjYXNlICcoJzoNCiAgICAgICAgICAgIGRlcHRoLS07DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgaWYgKGRlcHRoID09IDApIHsgZGVwdGgtLTsgfQ0KICAgICAgICB9DQogICAgICB9IGVsc2UgaWYgKHRva2VuSXQudHlwZSA9PSAnbmFtZScgJiYgdG9rZW5JdC52YWx1ZSA9PSAncmV0dXJuJykgew0KICAgICAgICBkZXB0aC0tOw0KICAgICAgfQ0KICAgICAgaWYgKGRlcHRoIDwgMCkgew0KICAgICAgICBpZiAoaGFzQnJhY2tldCkgew0KICAgICAgICAgIHRva2VuSXQudmFsdWUgKz0gJyBmdW5jdGlvbic7DQogICAgICAgICAgdG9rZW4udmFsdWUgPSAnJzsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICB0b2tlbkl0LnZhbHVlICs9ICcgZnVuY3Rpb24oJzsNCiAgICAgICAgICB0b2tlbi52YWx1ZSA9ICcpJzsNCiAgICAgICAgfQ0KICAgICAgICBicmVhazsNCiAgICAgIH0NCiAgICB9DQogICAgaSA9IGluZGV4Ow0KICAgIHdoaWxlICgrK2kgPCBsZW4pIHsNCiAgICAgIHRva2VuSXQgPSB0b2tlbnNbaV07DQogICAgICBpZiAodG9rZW5JdC50eXBlICE9ICd3aGl0ZXNwYWNlJykgeyBicmVhazsgfQ0KICAgIH0NCiAgICBoYXNCcmFja2V0ID0gZmFsc2U7DQogICAgaWYgKHRva2VuSXQudmFsdWUgPT0gJ3snKSB7IGhhc0JyYWNrZXQgPSB0cnVlOyB9DQogICAgaS0tOw0KICAgIGRlcHRoID0gMDsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICB0b2tlbkl0ID0gdG9rZW5zW2ldOw0KICAgICAgaWYgKHRva2VuSXQudHlwZSA9PSAncHVuY3R1YXRvcicpIHsNCiAgICAgICAgc3dpdGNoICh0b2tlbkl0LnZhbHVlKSB7DQogICAgICAgICAgY2FzZSAneyc6DQogICAgICAgICAgY2FzZSAnKCc6DQogICAgICAgICAgY2FzZSAnWyc6DQogICAgICAgICAgICBkZXB0aCsrOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgY2FzZSAnfSc6DQogICAgICAgICAgY2FzZSAnKSc6DQogICAgICAgICAgY2FzZSAnXSc6DQogICAgICAgICAgICBkZXB0aC0tOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgY2FzZSAnLCc6DQogICAgICAgICAgY2FzZSAnOyc6DQogICAgICAgICAgICBpZiAoZGVwdGggPT0gMCkgeyBkZXB0aC0tOyB9DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIGlmICh0b2tlbkl0LnR5cGUgPT0gJ3doaXRlc3BhY2UnKSB7DQogICAgICAgIGlmIChkZXB0aCA9PSAwICYmIHRva2VuSXQudmFsdWUuaW5jbHVkZXMoJ1xyXG4nKSkgew0KICAgICAgICAgIGRlcHRoLS07DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSBpZiAodG9rZW5JdC50eXBlID09ICduYW1lJykgew0KICAgICAgICBpZiAodG9rZW5JdC52YWx1ZSA9PSAndGhpcycpIHsgaGFzVGhpcyA9IHRydWU7IH0NCiAgICAgIH0NCiAgICAgIGlmIChkZXB0aCA8IDApIHsNCiAgICAgICAgaWYgKGhhc0JyYWNrZXQpIHsNCiAgICAgICAgICBpZiAoaGFzVGhpcykgeyB0b2tlbkl0LnZhbHVlID0gJy5iaW5kKHRoaXMpJyArIHRva2VuSXQudmFsdWU7IH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICB0b2tlbi52YWx1ZSArPSAne3JldHVybiAnOw0KICAgICAgICAgIGlmIChoYXNUaGlzKSB7IHRva2VuSXQudmFsdWUgPSAnfS5iaW5kKHRoaXMpJyArIHRva2VuSXQudmFsdWU7IH0NCiAgICAgICAgICBlbHNlIHsgdG9rZW5JdC52YWx1ZSA9ICd9JyArIHRva2VuSXQudmFsdWU7IH0NCiAgICAgICAgfQ0KICAgICAgICBicmVhazsNCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIHRydWU7DQogIH0NCg0KICBmdW5jdGlvbiBybUNvbW1lbnQodG9rZW4pIHsNCiAgICBpZiAodG9rZW4udHlwZSA9PSAnY29tbWVudCcpIHsNCiAgICAgIHRva2VuLnZhbHVlID0gJyc7DQogICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgcmV0dXJuIGZhbHNlOw0KICB9DQoNCiAgZnVuY3Rpb24gcmVwbEltcG9ydCh0b2tlbiwgdG9rZW5zLCBpbmRleCkgew0KICAgIHZhciBpbXBvcnRNYXAgPSB7fSwNCiAgICAgIGJ1ZiA9IFtdLA0KICAgICAgaW5zaWRlLA0KICAgICAgYkFsaWFzLA0KICAgICAgdHlwZSwNCiAgICAgIHZhbHVlLA0KICAgICAgaSwNCiAgICAgIGxlbiwNCiAgICAgIHRva2VuSXQsDQogICAgICBuYW1lLA0KICAgICAgbW9kdWxlTmFtZSwNCiAgICAgIG1vZHVsZUFsaWFzOw0KICAgIGlmICh0b2tlbi50eXBlICE9ICduYW1lJyB8fCB0b2tlbi52YWx1ZSAhPSAnaW1wb3J0JykgeyByZXR1cm4gZmFsc2U7IH0NCiAgICB0b2tlbi52YWx1ZSA9ICcnOw0KICAgIGkgPSBpbmRleDsNCiAgICBsZW4gPSB0b2tlbnMubGVuZ3RoOw0KICAgIHRva2VuSXQgPSB0b2tlbjsNCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7DQogICAgICB0b2tlbkl0LnZhbHVlID0gJyc7DQogICAgICB0b2tlbkl0ID0gdG9rZW5zW2ldOw0KICAgICAgdHlwZSA9IHRva2VuSXQudHlwZTsNCiAgICAgIHZhbHVlID0gdG9rZW5JdC52YWx1ZTsNCiAgICAgIGlmICh0eXBlID09ICduYW1lJykgew0KICAgICAgICBpZiAodmFsdWUgPT0gJ2Zyb20nKSB7DQogICAgICAgICAgY29udGludWU7DQogICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT0gJ2FzJykgew0KICAgICAgICAgIGJBbGlhcyA9IHRydWU7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgaWYgKGJBbGlhcykgew0KICAgICAgICAgICAgaW1wb3J0TWFwW25hbWVdID0gdmFsdWU7DQogICAgICAgICAgICBiQWxpYXMgPSBmYWxzZTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgbmFtZSA9IHZhbHVlOw0KICAgICAgICAgICAgaWYgKGluc2lkZSkgew0KICAgICAgICAgICAgICBpbXBvcnRNYXBbbmFtZV0gPSBuYW1lOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgaW1wb3J0TWFwWydkZWZhdWx0J10gPSBuYW1lOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIGlmICh0eXBlID09ICdwdW5jdHVhdG9yJykgew0KICAgICAgICBpZiAodmFsdWUgPT0gJyonKSB7DQogICAgICAgICAgbmFtZSA9ICcqJzsNCiAgICAgICAgICBpbXBvcnRNYXBbJyonXSA9IDA7DQogICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT0gJ3snKSB7DQogICAgICAgICAgaW5zaWRlID0gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PSAnfScpIHsNCiAgICAgICAgICBpbnNpZGUgPSBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIGlmICh0eXBlID09ICdzdHJpbmcnKSB7DQogICAgICAgIG1vZHVsZU5hbWUgPSB2YWx1ZS5zbGljZSgxLCB2YWx1ZS5sZW5ndGggLSAxKTsNCiAgICAgICAgYnJlYWs7DQogICAgICB9DQogICAgfQ0KDQogICAgbW9kdWxlQWxpYXMgPSBtb2R1bGVOYW1lLnJlcGxhY2UoL1tcXC8uLUBdL2csICdfJyk7DQogICAgbW9kdWxlQWxpYXMgKz0NCiAgICAgICdfJyArDQogICAgICBNYXRoLnJhbmRvbSgpDQogICAgICAgIC50b1N0cmluZygxNikNCiAgICAgICAgLnNsaWNlKDIpOw0KICAgIGJ1Zi5wdXNoKG1vZHVsZUFsaWFzICsgIj1yZXF1aXJlKCciICsgbW9kdWxlTmFtZSArICInKSIpOw0KICAgIGlmIChpbXBvcnRNYXBbJyonXSkgew0KICAgICAgYnVmLnB1c2goaW1wb3J0TWFwWycqJ10gKyAnPScgKyBtb2R1bGVBbGlhcyk7DQogICAgICBkZWxldGUgaW1wb3J0TWFwWycqJ107DQogICAgfQ0KICAgIGlmIChpbXBvcnRNYXBbJ2RlZmF1bHQnXSkgew0KICAgICAgYnVmLnB1c2goaW1wb3J0TWFwWydkZWZhdWx0J10gKyAnPScgKyBtb2R1bGVBbGlhcyArICJbJ2RlZmF1bHQnXSIpOw0KICAgICAgZGVsZXRlIGltcG9ydE1hcFsnZGVmYXVsdCddOw0KICAgIH0NCiAgICBmb3IgKG5hbWUgaW4gaW1wb3J0TWFwKSB7DQogICAgICBidWYucHVzaChpbXBvcnRNYXBbbmFtZV0gKyAnPScgKyBtb2R1bGVBbGlhcyArICcuJyArIG5hbWUpOw0KICAgIH0NCiAgICB0b2tlbkl0LnZhbHVlID0gJ2xldCAnICsgYnVmLmpvaW4oKTsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHRyYW5zcGlsZShjb2RlKSB7DQogICAgdmFyIHRva2VucyA9IGdldFRva2Vucyhjb2RlKSwNCiAgICAgIHRva2VuLA0KICAgICAgc291cmNlOw0KICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0b2tlbnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCiAgICAgIHRva2VuID0gdG9rZW5zW2ldOw0KICAgICAgaWYgKHJlcGxUbXBTdHIodG9rZW4sIHRva2VucywgaSkpIHsgY29udGludWU7IH0NCiAgICAgIGlmIChyZXBsQXJyb3codG9rZW4sIHRva2VucywgaSkpIHsgY29udGludWU7IH0NCiAgICAgIGlmIChyZXBsSW1wb3J0KHRva2VuLCB0b2tlbnMsIGkpKSB7IGNvbnRpbnVlOyB9DQogICAgICBybUNvbW1lbnQodG9rZW4pOw0KICAgIH0NCiAgICBzb3VyY2UgPSB0b2tlbnMubWFwKGZ1bmN0aW9uIChpdCkgeyByZXR1cm4gaXQudmFsdWU7IH0pLmpvaW4oJycpOw0KDQogICAgcmV0dXJuIHNvdXJjZTsNCiAgfQoKICB2YXIgSW50ZXJuYWxNb2R1bGVzID0gew0KICAgIGFjY2RiOiBhY2NkYiQxLA0KICAgIGFkb2RiOiBhZG9kYiwNCiAgICBjaGlsZF9wcm9jZXNzOiBjaGlsZF9wcm9jZXNzLA0KICAgIGNyeXB0bzogY3J5cHRvJDEsDQogICAgY3N2OiBjc3YsDQogICAgY3N2ZGI6IGNzdmRiJDEsDQogICAgZGF5anM6IGRheWpzJDEsDQogICAgZXhjZWw6IGV4Y2VsLA0KICAgIGV4Y2VsZGI6IGV4Y2VsZGIkMSwNCiAgICBmczogZnMsDQogICAgaHR0cDogaHR0cCQxLA0KICAgIGllOiBpZSwNCiAgICBvcmFjbGVkYjogb3JhY2xlZGIkMSwNCiAgICBvdXRsb29rOiBvdXRsb29rLA0KICAgIHBhdGg6IFBhdGgsDQogICAgcXVlcnlzdHJpbmc6IHF1ZXJ5c3RyaW5nLA0KICAgIHRvb2w6IHRvb2wsDQogICAgY2hhaW46IGNoYWluLA0KICAgIHV0aWw6IHV0aWwsDQogICAgd21pOiB3bWkNCiAgfTsNCg0KICB3aW5kb3cucmVxdWlyZSA9IGZ1bmN0aW9uKG5hbWUpIHsNCiAgICByZXR1cm4gSW50ZXJuYWxNb2R1bGVzW25hbWVdOw0KICB9Ow0KDQogIGlmIChwcm9jZXNzLmFyZ3YubGVuZ3RoID09PSAzKSB7DQogICAgdmFyIHB0aCA9IHByb2Nlc3MuYXJndlsyXTsNCiAgICBpZiAoIWlzQWJzb2x1dGUocHRoKSkgew0KICAgICAgcHRoID0gcmVzb2x2ZShwdGgpOw0KICAgIH0NCiAgICBpZiAoIWV4dG5hbWUocHRoKSkgew0KICAgICAgcHRoICs9ICcuanMnOw0KICAgIH0NCiAgICBpZiAoIWlzZmlsZShwdGgpKSB7DQogICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBsb2FkIGZpbGUgJyIgKyBwdGggKyAiJyIpOw0KICAgIH0NCiAgICB2YXIgc3JjID0gcmVhZEZpbGVTeW5jKHB0aCwgJ1VURi04Jyk7DQoNCiAgICBPYmplY3QuYXNzaWduKHdpbmRvdywgew0KICAgICAgX19maWxlbmFtZTogcHRoLA0KICAgICAgX19kaXJuYW1lOiBkaXJuYW1lKHB0aCksDQogICAgICBwcm9jZXNzOiBwcm9jZXNzLA0KICAgICAgQnVmZmVyOiBCdWZmZXIsDQogICAgICBjb25zb2xlOiBjb25zb2xlDQogICAgfSk7DQoNCiAgICBzcmMgPSB0cmFuc3BpbGUoc3JjKTsNCiAgICB2YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7DQogICAgc2NyaXB0LnRleHQgPSBzcmM7DQogICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpOw0KICB9Cgp9KCkpOwo=';
src = window.decodeURIComponent(window.escape(window.atob(src)));

var script = document.createElement('script');
script.text = src;
window.addEventListener('error', function(e) {
  if (e.error) {
    WScript.Echo(e.error.stack);
  } else {
    if (e.message) WScript.Echo(' Error:' + e.message);
    WScript.Echo('  line:', e.lineno);
    WScript.Echo('column:', e.colno);
  }
});
document.head.appendChild(script);
/*
:LBL_END
pause
exit
::*/
